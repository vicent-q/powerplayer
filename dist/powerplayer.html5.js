!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports["pwplayer"]=e():t["pwplayer"]=e()}("undefined"!=typeof self?self:this,function(){return function(t){function e(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,e),i.l=!0,i.exports}var n={};return e.m=t,e.c=n,e.d=function(t,n,r){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:r})},e.n=function(t){var n=t&&t.__esModule?function(){return t["default"]}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="<%=baseUrl%>/",e(e.s=138)}([function(t,e,n){"use strict";e.__esModule=!0,e.default=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}},function(t,e,n){"use strict";e.__esModule=!0;var r=n(26),i=function(t){return t&&t.__esModule?t:{default:t}}(r);e.default=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==(void 0===e?"undefined":(0,i.default)(e))&&"function"!=typeof e?t:e}},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}e.__esModule=!0;var i=n(80),a=r(i),o=n(55),s=r(o),u=n(26),l=r(u);e.default=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+(void 0===e?"undefined":(0,l.default)(e)));t.prototype=(0,s.default)(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(a.default?(0,a.default)(t,e):t.__proto__=e)}},function(t,e,n){"use strict";e.__esModule=!0;var r=n(54),i=function(t){return t&&t.__esModule?t:{default:t}}(r);e.default=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),(0,i.default)(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}()},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=n(28),a=r(i),o=n(0),s=r(o),u=n(26),l=r(u),c=n(27),d=r(c),h=n(8),f=Array.prototype.slice,p=/\s+/,m=function(t,e,n,r){if(!n)return!0;if("object"===(void 0===n?"undefined":(0,l.default)(n))){for(var i in n)t[e].apply(t,[i,n[i]].concat(r));return!1}if(p.test(n)){for(var a=n.split(p),o=0,s=a.length;o<s;o++)t[e].apply(t,[a[o]].concat(r));return!1}return!0},g=function(t,e,n,r){function i(){try{switch(e.length){case 0:for(;++o<s;)(a=t[o]).callback.call(a.ctx);return;case 1:for(;++o<s;)(a=t[o]).callback.call(a.ctx,u);return;case 2:for(;++o<s;)(a=t[o]).callback.call(a.ctx,u,l);return;case 3:for(;++o<s;)(a=t[o]).callback.call(a.ctx,u,l,c);return;default:for(;++o<s;)(a=t[o]).callback.apply(a.ctx,e);return}}catch(h){d.default.error.apply(d.default,[n,"error on event",r,"trigger","-",h]),i()}}var a=void 0,o=-1,s=t.length,u=e[0],l=e[1],c=e[2];i()},v=function(){function t(){(0,s.default)(this,t)}return t.prototype.on=function(t,e,n){return m(this,"on",t,[e,n])&&e?(this._events||(this._events={}),(this._events[t]||(this._events[t]=[])).push({callback:e,context:n,ctx:n||this}),this):this},t.prototype.once=function(t,e,n){var r=this;if(!m(this,"once",t,[e,n])||!e)return this;var i=function(){return r.off(t,a)},a=function(){i(),e.apply(this,arguments)};return this.on(t,a,n)},t.prototype.off=function(t,e,n){var r=void 0,i=void 0,o=void 0,s=void 0,u=void 0,l=void 0,c=void 0,d=void 0;if(!this._events||!m(this,"off",t,[e,n]))return this;if(!t&&!e&&!n)return this._events=void 0,this;for(s=t?[t]:(0,a.default)(this._events),u=0,l=s.length;u<l;u++)if(t=s[u],o=this._events[t]){if(this._events[t]=r=[],e||n)for(c=0,d=o.length;c<d;c++)i=o[c],(e&&e!==i.callback&&e!==i.callback._callback||n&&n!==i.context)&&r.push(i);r.length||delete this._events[t]}return this},t.prototype.trigger=function(t){var e=this.name||this.constructor.name;if(d.default.debug.apply(d.default,[e].concat(Array.prototype.slice.call(arguments))),!this._events)return this;var n=f.call(arguments,1);if(!m(this,"trigger",t,n))return this;var r=this._events[t],i=this._events.all;return r&&g(r,n,e,t),i&&g(i,arguments,e,t),this},t.prototype.stopListening=function(t,e,n){var r=this._listeningTo;if(!r)return this;var i=!e&&!n;n||"object"!==(void 0===e?"undefined":(0,l.default)(e))||(n=this),t&&((r={})[t._listenId]=t);for(var o in r)t=r[o],t.off(e,n,this),(i||0===(0,a.default)(t._events).length)&&delete this._listeningTo[o];return this},t.register=function(e){t.Custom||(t.Custom={});var n="string"==typeof e&&e.toUpperCase().trim();n&&!t.Custom[n]?t.Custom[n]=n.toLowerCase().split("_").map(function(t,e){return 0==e?t:t=t[0].toUpperCase()+t.slice(1)}).join(""):d.default.error("Events","Error when register event: "+e)},t.listAvailableCustomEvents=function(){return t.Custom||(t.Custom={}),(0,a.default)(t.Custom).filter(function(e){return"string"==typeof t.Custom[e]})},t}();e.default=v;var y={listenTo:"on",listenToOnce:"once"};(0,a.default)(y).forEach(function(t){v.prototype[t]=function(e,n,r){return(this._listeningTo||(this._listeningTo={}))[e._listenId||(e._listenId=(0,h.uniqueId)("l"))]=e,r||"object"!==(void 0===n?"undefined":(0,l.default)(n))||(r=this),e[y[t]](n,r,this),this}}),v.PLAYER_READY="ready",v.PLAYER_RESIZE="resize",v.PLAYER_FULLSCREEN="fullscreen",v.PLAYER_PLAY="play",v.PLAYER_PAUSE="pause",v.PLAYER_STOP="stop",v.PLAYER_ENDED="ended",v.PLAYER_SEEK="seek",v.PLAYER_ERROR="error",v.PLAYER_TIMEUPDATE="timeupdate",v.PLAYER_VOLUMEUPDATE="volumeupdate",v.PLAYER_SUBTITLE_AVAILABLE="subtitleavailable",v.PLAYBACK_PROGRESS="playback:progress",v.PLAYBACK_TIMEUPDATE="playback:timeupdate",v.PLAYBACK_READY="playback:ready",v.PLAYBACK_BUFFERING="playback:buffering",v.PLAYBACK_BUFFERFULL="playback:bufferfull",v.PLAYBACK_SETTINGSUPDATE="playback:settingsupdate",v.PLAYBACK_LOADEDMETADATA="playback:loadedmetadata",v.PLAYBACK_HIGHDEFINITIONUPDATE="playback:highdefinitionupdate",v.PLAYBACK_BITRATE="playback:bitrate",v.PLAYBACK_LEVELS_AVAILABLE="playback:levels:available",v.PLAYBACK_LEVEL_SWITCH_START="playback:levels:switch:start",v.PLAYBACK_LEVEL_SWITCH_END="playback:levels:switch:end",v.PLAYBACK_PLAYBACKSTATE="playback:playbackstate",v.PLAYBACK_DVR="playback:dvr",v.PLAYBACK_MEDIACONTROL_DISABLE="playback:mediacontrol:disable",v.PLAYBACK_MEDIACONTROL_ENABLE="playback:mediacontrol:enable",v.PLAYBACK_ENDED="playback:ended",v.PLAYBACK_PLAY_INTENT="playback:play:intent",v.PLAYBACK_PLAY="playback:play",v.PLAYBACK_PAUSE="playback:pause",v.PLAYBACK_STOP="playback:stop",v.PLAYBACK_ERROR="playback:error",v.PLAYBACK_ERRORPLAY="playback:errorplay",v.PLAYBACK_STATS_ADD="playback:stats:add",v.PLAYBACK_FRAGMENT_LOADED="playback:fragment:loaded",v.PLAYBACK_LEVEL_SWITCH="playback:level:switch",v.PLAYBACK_P2P_STATUS="playback:p2p:status",v.PLAYBACK_SEEK_LASTPOSTION="playback:seek:lastpostion",v.PLAYBACK_SUBTITLE_AVAILABLE="playback:subtitle:available",v.PLAYBACK_SUBTITLE_CHANGED="playback:subtitle:changed",v.PLAYBACK_AUTOPLAY_MUTED="playback:autoplay:muted",v.CORE_CONTAINERS_CREATED="core:containers:created",v.CORE_OPTIONS_CHANGE="core:options:change",v.CORE_READY="core:ready",v.CORE_FULLSCREEN="core:fullscreen",v.CORE_SCREEN_ORIENTATION_CHANGED="core:screen:orientation:changed",v.CONTAINER_PLAYBACKSTATE="container:playbackstate",v.CONTAINER_PLAYBACKDVRSTATECHANGED="container:dvr",v.CONTAINER_BITRATE="container:bitrate",v.CONTAINER_STATS_REPORT="container:stats:report",v.CONTAINER_DESTROYED="container:destroyed",v.CONTAINER_READY="container:ready",v.CONTAINER_ERROR="container:error",v.CONTAINER_ERRORPLAY="container:errorplay",v.CONTAINER_LOADEDMETADATA="container:loadedmetadata",v.CONTAINER_SUBTITLE_AVAILABLE="container:subtitle:available",v.CONTAINER_SUBTITLE_CHANGED="container:subtitle:changed",v.CONTAINER_TIMEUPDATE="container:timeupdate",v.CONTAINER_PROGRESS="container:progress",v.CONTAINER_PLAY="container:play",v.CONTAINER_STOP="container:stop",v.CONTAINER_PAUSE="container:pause",v.CONTAINER_ENDED="container:ended",v.CONTAINER_CLICK="container:click",v.CONTAINER_DBLCLICK="container:dblclick",v.CONTAINER_CONTEXTMENU="container:contextmenu",v.CONTAINER_MOUSE_ENTER="container:mouseenter",v.CONTAINER_MOUSE_LEAVE="container:mouseleave",v.CONTAINER_SEEK="container:seek",v.CONTAINER_VOLUME="container:volume",v.CONTAINER_FULLSCREEN="container:fullscreen",v.CONTAINER_STATE_BUFFERING="container:state:buffering",v.CONTAINER_STATE_BUFFERFULL="container:state:bufferfull",v.CONTAINER_SETTINGSUPDATE="container:settingsupdate",v.CONTAINER_HIGHDEFINITIONUPDATE="container:highdefinitionupdate",v.CONTAINER_MEDIACONTROL_SHOW="container:mediacontrol:show",v.CONTAINER_MEDIACONTROL_HIDE="container:mediacontrol:hide",v.CONTAINER_MEDIACONTROL_DISABLE="container:mediacontrol:disable",v.CONTAINER_MEDIACONTROL_ENABLE="container:mediacontrol:enable",v.CONTAINER_STATS_ADD="container:stats:add",v.CONTAINER_OPTIONS_CHANGE="container:options:change",v.CONTAINER_OPEN_LIVE="container:openlive",v.CONTAINER_CLOSE_LIVE="container:closelive",v.MEDIACONTROL_RENDERED="mediacontrol:rendered",v.MEDIACONTROL_FULLSCREEN="mediacontrol:fullscreen",v.MEDIACONTROL_SHOW="mediacontrol:show",v.MEDIACONTROL_HIDE="mediacontrol:hide",v.MEDIACONTROL_MOUSEMOVE_SEEKBAR="mediacontrol:mousemove:seekbar",v.MEDIACONTROL_MOUSELEAVE_SEEKBAR="mediacontrol:mouseleave:seekbar",v.MEDIACONTROL_PLAYING="mediacontrol:playing",v.MEDIACONTROL_NOTPLAYING="mediacontrol:notplaying",v.MEDIACONTROL_CONTAINERCHANGED="mediacontrol:containerchanged",t.exports=e["default"]},function(t,e){var n=t.exports={version:"2.5.0"};"number"==typeof __e&&(__e=n)},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=n(9),a=r(i),o=n(10),s=r(o),u={getStyleFor:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{baseUrl:""};return(0,a.default)('<style class="pwplayer-style"></style>').html((0,s.default)(t.toString())(e))}};e.default=u,t.exports=e["default"]},function(t,e){function n(t,e){var n=t[1]||"",i=t[3];if(!i)return n;if(e&&"function"==typeof btoa){var a=r(i);return[n].concat(i.sources.map(function(t){return"/*# sourceURL="+i.sourceRoot+t+" */"})).concat([a]).join("\n")}return[n].join("\n")}function r(t){return"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(t))))+" */"}t.exports=function(t){var e=[];return e.toString=function(){return this.map(function(e){var r=n(e,t);return e[2]?"@media "+e[2]+"{"+r+"}":r}).join("")},e.i=function(t,n){"string"==typeof t&&(t=[[null,t,""]]);for(var r={},i=0;i<this.length;i++){var a=this[i][0];"number"==typeof a&&(r[a]=!0)}for(i=0;i<t.length;i++){var o=t[i];"number"==typeof o[0]&&r[o[0]]||(n&&!o[2]?o[2]=n:n&&(o[2]="("+o[2]+") and ("+n+")"),e.push(o))}},e}},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function i(t,e){if(e)for(var n in e){var r=(0,C.default)(e,n);r?(0,x.default)(t,n,r):t[n]=e[n]}return t}function a(t,e){var n=function(t){function n(){(0,b.default)(this,n);for(var r=arguments.length,i=Array(r),a=0;a<r;a++)i[a]=arguments[a];var o=(0,w.default)(this,t.call.apply(t,[this].concat(i)));return e.initialize&&e.initialize.apply(o,i),o}return(0,S.default)(n,t),n}(t);return i(n.prototype,e),n}function o(t,e){if(!isFinite(t))return"--:--";t*=1e3,t=parseInt(t/1e3);var n=t%60;t=parseInt(t/60);var r=t%60;t=parseInt(t/60);var i=t%24,a=parseInt(t/24),o="";return a&&a>0&&(o+=a+":",i<1&&(o+="00:")),(i&&i>0||e)&&(o+=("0"+i).slice(-2)+":"),o+=("0"+r).slice(-2)+":",o+=("0"+n).slice(-2),o.trim()}function s(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"t",e=0,n=U.params[t]||U.hashParams[t]||"",r=n.match(/[0-9]+[hms]+/g)||[];if(r.length>0){var i={h:3600,m:60,s:1};r.forEach(function(t){if(t){var n=t[t.length-1],r=parseInt(t.slice(0,t.length-1),10);e+=r*i[n]}})}else n&&(e=parseInt(n,10));return e}function u(t){return F[t]||(F[t]=0),t+ ++F[t]}function l(t){return t-parseFloat(t)+1>=0}function c(){var t=document.getElementsByTagName("script");return t.length?t[t.length-1].src:""}function d(){return window.navigator&&window.navigator.language}function h(){return window.performance&&window.performance.now?performance.now():Date.now()}function f(t,e){var n=t.indexOf(e);n>=0&&t.splice(n,1)}function p(t,e){e=(0,g.default)({inline:!1,muted:!1,timeout:250,type:"video",source:O.default.mp4,element:null},e);var n=e.element?e.element:document.createElement(e.type);n.muted=e.muted,!0===e.muted&&n.setAttribute("muted","muted"),!0===e.inline&&n.setAttribute("playsinline","playsinline"),n.src=e.source;var r=n.play(),i=setTimeout(function(){a(!1,new Error("Timeout "+e.timeout+" ms has been reached"))},e.timeout),a=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;clearTimeout(i),t(e,n)};void 0!==r?r.then(function(){return a(!0)}).catch(function(t){return a(!1,t)}):a(!0)}Object.defineProperty(e,"__esModule",{value:!0}),e.DomRecycler=e.cancelAnimationFrame=e.requestAnimationFrame=e.QueryString=e.Config=e.Fullscreen=void 0;var m=n(81),g=r(m),v=n(3),y=r(v),_=n(0),b=r(_),E=n(1),w=r(E),A=n(2),S=r(A),T=n(54),x=r(T),k=n(82),C=r(k);e.extend=a,e.formatTime=o,e.seekStringToSeconds=s,e.uniqueId=u,e.isNumber=l,e.currentScriptUrl=c,e.getBrowserLanguage=d,e.now=h,e.removeArrayItem=f,e.canAutoPlayMedia=p,n(168);var M=n(29),R=r(M),L=n(9),I=r(L),P=n(169),O=r(P),D=e.Fullscreen={isFullscreen:function(){return!!(document.webkitFullscreenElement||document.webkitIsFullScreen||document.mozFullScreen||document.msFullscreenElement)},requestFullscreen:function(t){t.requestFullscreen?t.requestFullscreen():t.webkitRequestFullscreen?t.webkitRequestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.msRequestFullscreen?t.msRequestFullscreen():t.querySelector&&t.querySelector("video")&&t.querySelector("video").webkitEnterFullScreen?t.querySelector("video").webkitEnterFullScreen():t.webkitEnterFullScreen&&t.webkitEnterFullScreen()},cancelFullscreen:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document;t.exitFullscreen?t.exitFullscreen():t.webkitCancelFullScreen?t.webkitCancelFullScreen():t.webkitExitFullscreen?t.webkitExitFullscreen():t.mozCancelFullScreen?t.mozCancelFullScreen():t.msExitFullscreen&&t.msExitFullscreen()},fullscreenEnabled:function(){return!!(document.fullscreenEnabled||document.webkitFullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled)}},N=e.Config=function(){function t(){(0,b.default)(this,t)}return t._defaultConfig=function(){return{volume:{value:100,parse:parseInt}}},t._defaultValueFor=function(t){try{return this._defaultConfig()[t].parse(this._defaultConfig()[t].value)}catch(e){return}},t._createKeyspace=function(t){return"pwplayer."+document.domain+"."+t},t.restore=function(t){return R.default.hasLocalstorage&&localStorage[this._createKeyspace(t)]?this._defaultConfig()[t].parse(localStorage[this._createKeyspace(t)]):this._defaultValueFor(t)},t.persist=function(t,e){if(R.default.hasLocalstorage)try{return localStorage[this._createKeyspace(t)]=e,!0}catch(n){return!1}},t}(),U=e.QueryString=function(){function t(){(0,b.default)(this,t)}return t.parse=function(t){for(var e=void 0,n=/\+/g,r=/([^&=]+)=?([^&]*)/g,i=function(t){return decodeURIComponent(t.replace(n," "))},a={};e=r.exec(t);)a[i(e[1]).toLowerCase()]=i(e[2]);return a},(0,y.default)(t,null,[{key:"params",get:function(){var t=window.location.search.substring(1);return t!==this.query&&(this._urlParams=this.parse(t),this.query=t),this._urlParams}},{key:"hashParams",get:function(){var t=window.location.hash.substring(1);return t!==this.hash&&(this._hashParams=this.parse(t),this.hash=t),this._hashParams}}]),t}(),F={},B=e.requestAnimationFrame=(window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)}).bind(window),j=e.cancelAnimationFrame=(window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.clearTimeout).bind(window),V=[],G=e.DomRecycler=function(){function t(){(0,b.default)(this,t)}return t.configure=function(t){this.options=I.default.extend(this.options,t)},t.create=function(t){return this.options.recycleVideo&&"video"===t&&V.length>0?V.shift():(0,I.default)("<"+t+">")},t.garbage=function(t){this.options.recycleVideo&&"VIDEO"===t[0].tagName.toUpperCase()&&(t.children().remove(),V.push(t))},t}();G.options={recycleVideo:!1},e.default={Config:N,Fullscreen:D,QueryString:U,DomRecycler:G,extend:a,formatTime:o,seekStringToSeconds:s,uniqueId:u,currentScriptUrl:c,isNumber:l,requestAnimationFrame:B,cancelAnimationFrame:j,getBrowserLanguage:d,now:h,removeArrayItem:f}},function(t,e){var n=function(){function t(t){return null==t?String(t):q[X.call(t)]||"object"}function e(e){return"function"==t(e)}function n(t){return null!=t&&t==t.window}function r(t){return null!=t&&t.nodeType==t.DOCUMENT_NODE}function i(e){return"object"==t(e)}function a(t){return i(t)&&!n(t)&&Object.getPrototypeOf(t)==Object.prototype}function o(t){var e=!!t&&"length"in t&&t.length,r=S.type(t);return"function"!=r&&!n(t)&&("array"==r||0===e||"number"==typeof e&&e>0&&e-1 in t)}function s(t){return R.call(t,function(t){return null!=t})}function u(t){return t.length>0?S.fn.concat.apply([],t):t}function l(t){return t.replace(/::/g,"/").replace(/([A-Z]+)([A-Z][a-z])/g,"$1_$2").replace(/([a-z\d])([A-Z])/g,"$1_$2").replace(/_/g,"-").toLowerCase()}function c(t){return t in O?O[t]:O[t]=new RegExp("(^|\\s)"+t+"(\\s|$)")}function d(t,e){return"number"!=typeof e||D[l(t)]?e:e+"px"}function h(t){var e,n;return P[t]||(e=I.createElement(t),I.body.appendChild(e),n=getComputedStyle(e,"").getPropertyValue("display"),e.parentNode.removeChild(e),"none"==n&&(n="block"),P[t]=n),P[t]}function f(t){return"children"in t?L.call(t.children):S.map(t.childNodes,function(t){if(1==t.nodeType)return t})}function p(t,e){var n,r=t?t.length:0;for(n=0;n<r;n++)this[n]=t[n];this.length=r,this.selector=e||""}function m(t,e,n){for(A in e)n&&(a(e[A])||J(e[A]))?(a(e[A])&&!a(t[A])&&(t[A]={}),J(e[A])&&!J(t[A])&&(t[A]=[]),m(t[A],e[A],n)):e[A]!==w&&(t[A]=e[A])}function g(t,e){return null==e?S(t):S(t).filter(e)}function v(t,n,r,i){return e(n)?n.call(t,r,i):n}function y(t,e,n){null==n?t.removeAttribute(e):t.setAttribute(e,n)}function _(t,e){var n=t.className||"",r=n&&n.baseVal!==w;if(e===w)return r?n.baseVal:n;r?n.baseVal=e:t.className=e}function b(t){try{return t?"true"==t||"false"!=t&&("null"==t?null:+t+""==t?+t:/^[\[\{]/.test(t)?S.parseJSON(t):t):t}catch(e){return t}}function E(t,e){e(t);for(var n=0,r=t.childNodes.length;n<r;n++)E(t.childNodes[n],e)}var w,A,S,T,x,k,C=[],M=C.concat,R=C.filter,L=C.slice,I=window.document,P={},O={},D={"column-count":1,columns:1,"font-weight":1,"line-height":1,opacity:1,"z-index":1,zoom:1},N=/^\s*<(\w+|!)[^>]*>/,U=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,F=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,B=/^(?:body|html)$/i,j=/([A-Z])/g,V=["val","css","html","text","data","width","height","offset"],G=["after","prepend","before","append"],z=I.createElement("table"),H=I.createElement("tr"),K={tr:I.createElement("tbody"),tbody:z,thead:z,tfoot:z,td:H,th:H,"*":I.createElement("div")},Y=/complete|loaded|interactive/,W=/^[\w-]*$/,q={},X=q.toString,$={},Z=I.createElement("div"),Q={tabindex:"tabIndex",readonly:"readOnly",for:"htmlFor",class:"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},J=Array.isArray||function(t){return t instanceof Array};return $.matches=function(t,e){if(!e||!t||1!==t.nodeType)return!1;var n=t.matches||t.webkitMatchesSelector||t.mozMatchesSelector||t.oMatchesSelector||t.matchesSelector;if(n)return n.call(t,e);var r,i=t.parentNode,a=!i;return a&&(i=Z).appendChild(t),r=~$.qsa(i,e).indexOf(t),a&&Z.removeChild(t),r},x=function(t){return t.replace(/-+(.)?/g,function(t,e){return e?e.toUpperCase():""})},k=function(t){return R.call(t,function(e,n){return t.indexOf(e)==n})},$.fragment=function(t,e,n){var r,i,o;return U.test(t)&&(r=S(I.createElement(RegExp.$1))),r||(t.replace&&(t=t.replace(F,"<$1></$2>")),e===w&&(e=N.test(t)&&RegExp.$1),e in K||(e="*"),o=K[e],o.innerHTML=""+t,r=S.each(L.call(o.childNodes),function(){o.removeChild(this)})),a(n)&&(i=S(r),S.each(n,function(t,e){V.indexOf(t)>-1?i[t](e):i.attr(t,e)})),r},$.Z=function(t,e){return new p(t,e)},$.isZ=function(t){return t instanceof $.Z},$.init=function(t,n){var r;if(!t)return $.Z();if("string"==typeof t)if(t=t.trim(),"<"==t[0]&&N.test(t))r=$.fragment(t,RegExp.$1,n),t=null;else{if(n!==w)return S(n).find(t);r=$.qsa(I,t)}else{if(e(t))return S(I).ready(t);if($.isZ(t))return t;if(J(t))r=s(t);else if(i(t))r=[t],t=null;else if(N.test(t))r=$.fragment(t.trim(),RegExp.$1,n),t=null;else{if(n!==w)return S(n).find(t);r=$.qsa(I,t)}}return $.Z(r,t)},S=function(t,e){return $.init(t,e)},S.extend=function(t){var e,n=L.call(arguments,1);return"boolean"==typeof t&&(e=t,t=n.shift()),n.forEach(function(n){m(t,n,e)}),t},$.qsa=function(t,e){var n,r="#"==e[0],i=!r&&"."==e[0],a=r||i?e.slice(1):e,o=W.test(a);return t.getElementById&&o&&r?(n=t.getElementById(a))?[n]:[]:1!==t.nodeType&&9!==t.nodeType&&11!==t.nodeType?[]:L.call(o&&!r&&t.getElementsByClassName?i?t.getElementsByClassName(a):t.getElementsByTagName(e):t.querySelectorAll(e))},S.contains=I.documentElement.contains?function(t,e){return t!==e&&t.contains(e)}:function(t,e){for(;e&&(e=e.parentNode);)if(e===t)return!0;return!1},S.type=t,S.isFunction=e,S.isWindow=n,S.isArray=J,S.isPlainObject=a,S.isEmptyObject=function(t){var e;for(e in t)return!1;return!0},S.isNumeric=function(t){var e=Number(t),n=typeof t;return null!=t&&"boolean"!=n&&("string"!=n||t.length)&&!isNaN(e)&&isFinite(e)||!1},S.inArray=function(t,e,n){return C.indexOf.call(e,t,n)},S.camelCase=x,S.trim=function(t){return null==t?"":String.prototype.trim.call(t)},S.uuid=0,S.support={},S.expr={},S.noop=function(){},S.map=function(t,e){var n,r,i,a=[];if(o(t))for(r=0;r<t.length;r++)null!=(n=e(t[r],r))&&a.push(n);else for(i in t)null!=(n=e(t[i],i))&&a.push(n);return u(a)},S.each=function(t,e){var n,r;if(o(t)){for(n=0;n<t.length;n++)if(!1===e.call(t[n],n,t[n]))return t}else for(r in t)if(!1===e.call(t[r],r,t[r]))return t;return t},S.grep=function(t,e){return R.call(t,e)},window.JSON&&(S.parseJSON=JSON.parse),S.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(t,e){q["[object "+e+"]"]=e.toLowerCase()}),S.fn={constructor:$.Z,length:0,forEach:C.forEach,reduce:C.reduce,push:C.push,sort:C.sort,splice:C.splice,indexOf:C.indexOf,concat:function(){var t,e,n=[];for(t=0;t<arguments.length;t++)e=arguments[t],n[t]=$.isZ(e)?e.toArray():e;return M.apply($.isZ(this)?this.toArray():this,n)},map:function(t){return S(S.map(this,function(e,n){return t.call(e,n,e)}))},slice:function(){return S(L.apply(this,arguments))},ready:function(t){return Y.test(I.readyState)&&I.body?t(S):I.addEventListener("DOMContentLoaded",function(){t(S)},!1),this},get:function(t){return t===w?L.call(this):this[t>=0?t:t+this.length]},toArray:function(){return this.get()},size:function(){return this.length},remove:function(){return this.each(function(){null!=this.parentNode&&this.parentNode.removeChild(this)})},each:function(t){return C.every.call(this,function(e,n){return!1!==t.call(e,n,e)}),this},filter:function(t){return e(t)?this.not(this.not(t)):S(R.call(this,function(e){return $.matches(e,t)}))},add:function(t,e){return S(k(this.concat(S(t,e))))},is:function(t){return this.length>0&&$.matches(this[0],t)},not:function(t){var n=[];if(e(t)&&t.call!==w)this.each(function(e){t.call(this,e)||n.push(this)});else{var r="string"==typeof t?this.filter(t):o(t)&&e(t.item)?L.call(t):S(t);this.forEach(function(t){r.indexOf(t)<0&&n.push(t)})}return S(n)},has:function(t){return this.filter(function(){return i(t)?S.contains(this,t):S(this).find(t).size()})},eq:function(t){return-1===t?this.slice(t):this.slice(t,+t+1)},first:function(){var t=this[0];return t&&!i(t)?t:S(t)},last:function(){var t=this[this.length-1];return t&&!i(t)?t:S(t)},find:function(t){var e=this;return t?"object"==typeof t?S(t).filter(function(){var t=this;return C.some.call(e,function(e){return S.contains(e,t)})}):1==this.length?S($.qsa(this[0],t)):this.map(function(){return $.qsa(this,t)}):S()},closest:function(t,e){var n=[],i="object"==typeof t&&S(t);return this.each(function(a,o){for(;o&&!(i?i.indexOf(o)>=0:$.matches(o,t));)o=o!==e&&!r(o)&&o.parentNode;o&&n.indexOf(o)<0&&n.push(o)}),S(n)},parents:function(t){for(var e=[],n=this;n.length>0;)n=S.map(n,function(t){if((t=t.parentNode)&&!r(t)&&e.indexOf(t)<0)return e.push(t),t});return g(e,t)},parent:function(t){return g(k(this.pluck("parentNode")),t)},children:function(t){return g(this.map(function(){return f(this)}),t)},contents:function(){return this.map(function(){return this.contentDocument||L.call(this.childNodes)})},siblings:function(t){return g(this.map(function(t,e){return R.call(f(e.parentNode),function(t){return t!==e})}),t)},empty:function(){return this.each(function(){this.innerHTML=""})},pluck:function(t){return S.map(this,function(e){return e[t]})},show:function(){return this.each(function(){"none"==this.style.display&&(this.style.display=""),"none"==getComputedStyle(this,"").getPropertyValue("display")&&(this.style.display=h(this.nodeName))})},replaceWith:function(t){return this.before(t).remove()},wrap:function(t){var n=e(t);if(this[0]&&!n)var r=S(t).get(0),i=r.parentNode||this.length>1;return this.each(function(e){S(this).wrapAll(n?t.call(this,e):i?r.cloneNode(!0):r)})},wrapAll:function(t){if(this[0]){S(this[0]).before(t=S(t));for(var e;(e=t.children()).length;)t=e.first();S(t).append(this)}return this},wrapInner:function(t){var n=e(t);return this.each(function(e){var r=S(this),i=r.contents(),a=n?t.call(this,e):t;i.length?i.wrapAll(a):r.append(a)})},unwrap:function(){return this.parent().each(function(){S(this).replaceWith(S(this).children())}),this},clone:function(){return this.map(function(){return this.cloneNode(!0)})},hide:function(){return this.css("display","none")},toggle:function(t){return this.each(function(){var e=S(this);(t===w?"none"==e.css("display"):t)?e.show():e.hide()})},prev:function(t){return S(this.pluck("previousElementSibling")).filter(t||"*")},next:function(t){return S(this.pluck("nextElementSibling")).filter(t||"*")},html:function(t){return 0 in arguments?this.each(function(e){var n=this.innerHTML;S(this).empty().append(v(this,t,e,n))}):0 in this?this[0].innerHTML:null},text:function(t){return 0 in arguments?this.each(function(e){var n=v(this,t,e,this.textContent);this.textContent=null==n?"":""+n}):0 in this?this.pluck("textContent").join(""):null},attr:function(t,e){var n;return"string"!=typeof t||1 in arguments?this.each(function(n){if(1===this.nodeType)if(i(t))for(A in t)y(this,A,t[A]);else y(this,t,v(this,e,n,this.getAttribute(t)))}):0 in this&&1==this[0].nodeType&&null!=(n=this[0].getAttribute(t))?n:w},removeAttr:function(t){return this.each(function(){1===this.nodeType&&t.split(" ").forEach(function(t){y(this,t)},this)})},prop:function(t,e){return t=Q[t]||t,1 in arguments?this.each(function(n){this[t]=v(this,e,n,this[t])}):this[0]&&this[0][t]},removeProp:function(t){return t=Q[t]||t,this.each(function(){delete this[t]})},data:function(t,e){var n="data-"+t.replace(j,"-$1").toLowerCase(),r=1 in arguments?this.attr(n,e):this.attr(n);return null!==r?b(r):w},val:function(t){return 0 in arguments?(null==t&&(t=""),this.each(function(e){this.value=v(this,t,e,this.value)})):this[0]&&(this[0].multiple?S(this[0]).find("option").filter(function(){return this.selected}).pluck("value"):this[0].value)},offset:function(t){if(t)return this.each(function(e){var n=S(this),r=v(this,t,e,n.offset()),i=n.offsetParent().offset(),a={top:r.top-i.top,left:r.left-i.left};"static"==n.css("position")&&(a["position"]="relative"),n.css(a)});if(!this.length)return null;if(I.documentElement!==this[0]&&!S.contains(I.documentElement,this[0]))return{top:0,left:0};var e=this[0].getBoundingClientRect();return{left:e.left+window.pageXOffset,top:e.top+window.pageYOffset,width:Math.round(e.width),height:Math.round(e.height)}},css:function(e,n){if(arguments.length<2){var r=this[0];if("string"==typeof e){if(!r)return;return r.style[x(e)]||getComputedStyle(r,"").getPropertyValue(e)}if(J(e)){if(!r)return;var i={},a=getComputedStyle(r,"");return S.each(e,function(t,e){i[e]=r.style[x(e)]||a.getPropertyValue(e)}),i}}var o="";if("string"==t(e))n||0===n?o=l(e)+":"+d(e,n):this.each(function(){this.style.removeProperty(l(e))});else for(A in e)e[A]||0===e[A]?o+=l(A)+":"+d(A,e[A])+";":this.each(function(){this.style.removeProperty(l(A))});return this.each(function(){this.style.cssText+=";"+o})},index:function(t){return t?this.indexOf(S(t)[0]):this.parent().children().indexOf(this[0])},hasClass:function(t){return!!t&&C.some.call(this,function(t){return this.test(_(t))},c(t))},addClass:function(t){return t?this.each(function(e){if("className"in this){T=[];var n=_(this);v(this,t,e,n).split(/\s+/g).forEach(function(t){S(this).hasClass(t)||T.push(t)},this),T.length&&_(this,n+(n?" ":"")+T.join(" "))}}):this},removeClass:function(t){return this.each(function(e){if("className"in this){if(t===w)return _(this,"");T=_(this),v(this,t,e,T).split(/\s+/g).forEach(function(t){T=T.replace(c(t)," ")}),_(this,T.trim())}})},toggleClass:function(t,e){return t?this.each(function(n){var r=S(this);v(this,t,n,_(this)).split(/\s+/g).forEach(function(t){(e===w?!r.hasClass(t):e)?r.addClass(t):r.removeClass(t)})}):this},scrollTop:function(t){if(this.length){var e="scrollTop"in this[0];return t===w?e?this[0].scrollTop:this[0].pageYOffset:this.each(e?function(){this.scrollTop=t}:function(){this.scrollTo(this.scrollX,t)})}},scrollLeft:function(t){if(this.length){var e="scrollLeft"in this[0];return t===w?e?this[0].scrollLeft:this[0].pageXOffset:this.each(e?function(){this.scrollLeft=t}:function(){this.scrollTo(t,this.scrollY)})}},position:function(){if(this.length){var t=this[0],e=this.offsetParent(),n=this.offset(),r=B.test(e[0].nodeName)?{top:0,left:0}:e.offset();return n.top-=parseFloat(S(t).css("margin-top"))||0,n.left-=parseFloat(S(t).css("margin-left"))||0,r.top+=parseFloat(S(e[0]).css("border-top-width"))||0,r.left+=parseFloat(S(e[0]).css("border-left-width"))||0,{top:n.top-r.top,left:n.left-r.left}}},offsetParent:function(){return this.map(function(){for(var t=this.offsetParent||I.body;t&&!B.test(t.nodeName)&&"static"==S(t).css("position");)t=t.offsetParent;return t})}},S.fn.detach=S.fn.remove,["width","height"].forEach(function(t){var e=t.replace(/./,function(t){return t[0].toUpperCase()});S.fn[t]=function(i){var a,o=this[0];return i===w?n(o)?o["inner"+e]:r(o)?o.documentElement["scroll"+e]:(a=this.offset())&&a[t]:this.each(function(e){o=S(this),o.css(t,v(this,i,e,o[t]()))})}}),G.forEach(function(e,n){var r=n%2;S.fn[e]=function(){var e,i,a=S.map(arguments,function(n){var r=[];return e=t(n),"array"==e?(n.forEach(function(t){return t.nodeType!==w?r.push(t):S.zepto.isZ(t)?r=r.concat(t.get()):void(r=r.concat($.fragment(t)))}),r):"object"==e||null==n?n:$.fragment(n)}),o=this.length>1;return a.length<1?this:this.each(function(t,e){i=r?e:e.parentNode,e=0==n?e.nextSibling:1==n?e.firstChild:2==n?e:null;var s=S.contains(I.documentElement,i);a.forEach(function(t){if(o)t=t.cloneNode(!0);else if(!i)return S(t).remove();i.insertBefore(t,e),s&&E(t,function(t){if(!(null==t.nodeName||"SCRIPT"!==t.nodeName.toUpperCase()||t.type&&"text/javascript"!==t.type||t.src)){var e=t.ownerDocument?t.ownerDocument.defaultView:window;e["eval"].call(e,t.innerHTML)}})})})},S.fn[r?e+"To":"insert"+(n?"Before":"After")]=function(t){return S(t)[e](this),this}}),$.Z.prototype=p.prototype=S.fn,$.uniq=k,$.deserializeValue=b,S.zepto=$,S}();window.Zepto=n,void 0===window.$&&(window.$=n),function(t){function e(e,n,r){var i=t.Event(n);return t(e).trigger(i,r),!i.isDefaultPrevented()}function n(t,n,r,i){if(t.global)return e(n||_,r,i)}function r(e){e.global&&0==t.active++&&n(e,null,"ajaxStart")}function i(e){e.global&&!--t.active&&n(e,null,"ajaxStop")}function a(t,e){var r=e.context;if(!1===e.beforeSend.call(r,t,e)||!1===n(e,r,"ajaxBeforeSend",[t,e]))return!1;n(e,r,"ajaxSend",[t,e])}function o(t,e,r,i){var a=r.context;r.success.call(a,t,"success",e),i&&i.resolveWith(a,[t,"success",e]),n(r,a,"ajaxSuccess",[e,r,t]),u("success",e,r)}function s(t,e,r,i,a){var o=i.context;i.error.call(o,r,e,t),a&&a.rejectWith(o,[r,e,t]),n(i,o,"ajaxError",[r,i,t||e]),u(e,r,i)}function u(t,e,r){var a=r.context;r.complete.call(a,e,t),n(r,a,"ajaxComplete",[e,r]),i(r)}function l(t,e,n){if(n.dataFilter==c)return t;var r=n.context;return n.dataFilter.call(r,t,e)}function c(){}function d(t){return t&&(t=t.split(";",2)[0]),t&&(t==S?"html":t==A?"json":E.test(t)?"script":w.test(t)&&"xml")||"text"}function h(t,e){return""==e?t:(t+"&"+e).replace(/[&?]{1,2}/,"?")}function f(e){e.processData&&e.data&&"string"!=t.type(e.data)&&(e.data=t.param(e.data,e.traditional)),!e.data||e.type&&"GET"!=e.type.toUpperCase()&&"jsonp"!=e.dataType||(e.url=h(e.url,e.data),e.data=void 0)}function p(e,n,r,i){return t.isFunction(n)&&(i=r,r=n,n=void 0),t.isFunction(r)||(i=r,r=void 0),{url:e,data:n,success:r,dataType:i}}function m(e,n,r,i){var a,o=t.isArray(n),s=t.isPlainObject(n);t.each(n,function(n,u){a=t.type(u),i&&(n=r?i:i+"["+(s||"object"==a||"array"==a?n:"")+"]"),!i&&o?e.add(u.name,u.value):"array"==a||!r&&"object"==a?m(e,u,r,n):e.add(n,u)})}var g,v,y=+new Date,_=window.document,b=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,E=/^(?:text|application)\/javascript/i,w=/^(?:text|application)\/xml/i,A="application/json",S="text/html",T=/^\s*$/,x=_.createElement("a");x.href=window.location.href,t.active=0,t.ajaxJSONP=function(e,n){if(!("type"in e))return t.ajax(e);var r,i,u=e.jsonpCallback,l=(t.isFunction(u)?u():u)||"Zepto"+y++,c=_.createElement("script"),d=window[l],h=function(e){t(c).triggerHandler("error",e||"abort")},f={abort:h};return n&&n.promise(f),t(c).on("load error",function(a,u){clearTimeout(i),t(c).off().remove(),"error"!=a.type&&r?o(r[0],f,e,n):s(null,u||"error",f,e,n),window[l]=d,r&&t.isFunction(d)&&d(r[0]),d=r=void 0}),!1===a(f,e)?(h("abort"),f):(window[l]=function(){r=arguments},c.src=e.url.replace(/\?(.+)=\?/,"?$1="+l),_.head.appendChild(c),e.timeout>0&&(i=setTimeout(function(){h("timeout")},e.timeout)),f)},t.ajaxSettings={type:"GET",beforeSend:c,success:c,error:c,complete:c,context:null,global:!0,xhr:function(){return new window.XMLHttpRequest},accepts:{script:"text/javascript, application/javascript, application/x-javascript",json:A,xml:"application/xml, text/xml",html:S,text:"text/plain"},crossDomain:!1,timeout:0,processData:!0,cache:!0,dataFilter:c},t.ajax=function(e){var n,i,u=t.extend({},e||{}),p=t.Deferred&&t.Deferred();for(g in t.ajaxSettings)void 0===u[g]&&(u[g]=t.ajaxSettings[g]);r(u),u.crossDomain||(n=_.createElement("a"),n.href=u.url,n.href=n.href,u.crossDomain=x.protocol+"//"+x.host!=n.protocol+"//"+n.host),u.url||(u.url=window.location.toString()),(i=u.url.indexOf("#"))>-1&&(u.url=u.url.slice(0,i)),f(u);var m=u.dataType,y=/\?.+=\?/.test(u.url);if(y&&(m="jsonp"),!1!==u.cache&&(e&&!0===e.cache||"script"!=m&&"jsonp"!=m)||(u.url=h(u.url,"_="+Date.now())),"jsonp"==m)return y||(u.url=h(u.url,u.jsonp?u.jsonp+"=?":!1===u.jsonp?"":"callback=?")),t.ajaxJSONP(u,p);var b,E=u.accepts[m],w={},A=function(t,e){w[t.toLowerCase()]=[t,e]},S=/^([\w-]+:)\/\//.test(u.url)?RegExp.$1:window.location.protocol,k=u.xhr(),C=k.setRequestHeader;if(p&&p.promise(k),u.crossDomain||A("X-Requested-With","XMLHttpRequest"),A("Accept",E||"*/*"),(E=u.mimeType||E)&&(E.indexOf(",")>-1&&(E=E.split(",",2)[0]),k.overrideMimeType&&k.overrideMimeType(E)),(u.contentType||!1!==u.contentType&&u.data&&"GET"!=u.type.toUpperCase())&&A("Content-Type",u.contentType||"application/x-www-form-urlencoded"),u.headers)for(v in u.headers)A(v,u.headers[v]);if(k.setRequestHeader=A,k.onreadystatechange=function(){if(4==k.readyState){k.onreadystatechange=c,clearTimeout(b);var e,n=!1;if(k.status>=200&&k.status<300||304==k.status||0==k.status&&"file:"==S){if(m=m||d(u.mimeType||k.getResponseHeader("content-type")),"arraybuffer"==k.responseType||"blob"==k.responseType)e=k.response;else{e=k.responseText;try{e=l(e,m,u),"script"==m?(0,eval)(e):"xml"==m?e=k.responseXML:"json"==m&&(e=T.test(e)?null:t.parseJSON(e))}catch(r){n=r}if(n)return s(n,"parsererror",k,u,p)}o(e,k,u,p)}else s(k.statusText||null,k.status?"error":"abort",k,u,p)}},!1===a(k,u))return k.abort(),s(null,"abort",k,u,p),k;var M=!("async"in u)||u.async;if(k.open(u.type,u.url,M,u.username,u.password),u.xhrFields)for(v in u.xhrFields)k[v]=u.xhrFields[v];for(v in w)C.apply(k,w[v]);return u.timeout>0&&(b=setTimeout(function(){k.onreadystatechange=c,k.abort(),s(null,"timeout",k,u,p)},u.timeout)),k.send(u.data?u.data:null),k},t.get=function(){return t.ajax(p.apply(null,arguments))},t.post=function(){var e=p.apply(null,arguments);return e.type="POST",t.ajax(e)},t.getJSON=function(){var e=p.apply(null,arguments);return e.dataType="json",t.ajax(e)},t.fn.load=function(e,n,r){if(!this.length)return this;var i,a=this,o=e.split(/\s/),s=p(e,n,r),u=s.success;return o.length>1&&(s.url=o[0],i=o[1]),s.success=function(e){a.html(i?t("<div>").html(e.replace(b,"")).find(i):e),u&&u.apply(a,arguments)},t.ajax(s),this};var k=encodeURIComponent;t.param=function(e,n){var r=[];return r.add=function(e,n){t.isFunction(n)&&(n=n()),null==n&&(n=""),this.push(k(e)+"="+k(n))},m(r,e,n),r.join("&").replace(/%20/g,"+")}}(n),function(t){t.Callbacks=function(e){e=t.extend({},e);var n,r,i,a,o,s,u=[],l=!e.once&&[],c=function(t){for(n=e.memory&&t,r=!0,s=a||0,a=0,o=u.length,i=!0;u&&s<o;++s)if(!1===u[s].apply(t[0],t[1])&&e.stopOnFalse){n=!1;break}i=!1,u&&(l?l.length&&c(l.shift()):n?u.length=0:d.disable())},d={add:function(){if(u){var r=u.length,s=function(n){t.each(n,function(t,n){"function"==typeof n?e.unique&&d.has(n)||u.push(n):n&&n.length&&"string"!=typeof n&&s(n)})};s(arguments),i?o=u.length:n&&(a=r,c(n))}return this},remove:function(){return u&&t.each(arguments,function(e,n){for(var r;(r=t.inArray(n,u,r))>-1;)u.splice(r,1),i&&(r<=o&&--o,r<=s&&--s)}),this},has:function(e){return!(!u||!(e?t.inArray(e,u)>-1:u.length))},empty:function(){return o=u.length=0,this},disable:function(){return u=l=n=void 0,this},disabled:function(){return!u},lock:function(){return l=void 0,n||d.disable(),this},locked:function(){return!l},fireWith:function(t,e){return!u||r&&!l||(e=e||[],e=[t,e.slice?e.slice():e],i?l.push(e):c(e)),this},fire:function(){return d.fireWith(this,arguments)},fired:function(){return!!r}};return d}}(n),function(t){function e(n){var r=[["resolve","done",t.Callbacks({once:1,memory:1}),"resolved"],["reject","fail",t.Callbacks({once:1,memory:1}),"rejected"],["notify","progress",t.Callbacks({memory:1})]],i="pending",a={state:function(){return i},always:function(){return o.done(arguments).fail(arguments),this},then:function(){var n=arguments;return e(function(e){t.each(r,function(r,i){var s=t.isFunction(n[r])&&n[r];o[i[1]](function(){var n=s&&s.apply(this,arguments);if(n&&t.isFunction(n.promise))n.promise().done(e.resolve).fail(e.reject).progress(e.notify);else{var r=this===a?e.promise():this,o=s?[n]:arguments;e[i[0]+"With"](r,o)}})}),n=null}).promise()},promise:function(e){return null!=e?t.extend(e,a):a}},o={};return t.each(r,function(t,e){var n=e[2],s=e[3];a[e[1]]=n.add,s&&n.add(function(){i=s},r[1^t][2].disable,r[2][2].lock),o[e[0]]=function(){return o[e[0]+"With"](this===o?a:this,arguments),this},o[e[0]+"With"]=n.fireWith}),a.promise(o),n&&n.call(o,o),o}var n=Array.prototype.slice;t.when=function(r){var i,a,o,s=n.call(arguments),u=s.length,l=0,c=1!==u||r&&t.isFunction(r.promise)?u:0,d=1===c?r:e(),h=function(t,e,r){return function(a){e[t]=this,r[t]=arguments.length>1?n.call(arguments):a,r===i?d.notifyWith(e,r):--c||d.resolveWith(e,r)}};if(u>1)for(i=new Array(u),a=new Array(u),o=new Array(u);l<u;++l)s[l]&&t.isFunction(s[l].promise)?s[l].promise().done(h(l,o,s)).fail(d.reject).progress(h(l,a,i)):--c;return c||d.resolveWith(o,s),d.promise()},t.Deferred=e}(n),function(t){function e(t){return t._zid||(t._zid=h++)}function n(t,n,a,o){if(n=r(n),n.ns)var s=i(n.ns);return(g[e(t)]||[]).filter(function(t){return t&&(!n.e||t.e==n.e)&&(!n.ns||s.test(t.ns))&&(!a||e(t.fn)===e(a))&&(!o||t.sel==o)})}function r(t){var e=(""+t).split(".");return{e:e[0],ns:e.slice(1).sort().join(" ")}}function i(t){return new RegExp("(?:^| )"+t.replace(" "," .* ?")+"(?: |$)")}function a(t,e){return t.del&&!y&&t.e in _||!!e}function o(t){return b[t]||y&&_[t]||t}function s(n,i,s,u,c,h,f){var p=e(n),m=g[p]||(g[p]=[]);i.split(/\s/).forEach(function(e){if("ready"==e)return t(document).ready(s);var i=r(e);i.fn=s,i.sel=c,i.e in b&&(s=function(e){var n=e.relatedTarget;if(!n||n!==this&&!t.contains(this,n))return i.fn.apply(this,arguments)}),i.del=h;var p=h||s;i.proxy=function(t){if(t=l(t),!t.isImmediatePropagationStopped()){t.data=u;var e=p.apply(n,t._args==d?[t]:[t].concat(t._args));return!1===e&&(t.preventDefault(),t.stopPropagation()),e}},i.i=m.length,m.push(i),"addEventListener"in n&&n.addEventListener(o(i.e),i.proxy,a(i,f))})}function u(t,r,i,s,u){var l=e(t);(r||"").split(/\s/).forEach(function(e){n(t,e,i,s).forEach(function(e){delete g[l][e.i],"removeEventListener"in t&&t.removeEventListener(o(e.e),e.proxy,a(e,u))})})}function l(e,n){return!n&&e.isDefaultPrevented||(n||(n=e),t.each(S,function(t,r){var i=n[t];e[t]=function(){return this[r]=E,i&&i.apply(n,arguments)},e[r]=w}),e.timeStamp||(e.timeStamp=Date.now()),(n.defaultPrevented!==d?n.defaultPrevented:"returnValue"in n?!1===n.returnValue:n.getPreventDefault&&n.getPreventDefault())&&(e.isDefaultPrevented=E)),e}function c(t){var e,n={originalEvent:t};for(e in t)A.test(e)||t[e]===d||(n[e]=t[e]);return l(n,t)}var d,h=1,f=Array.prototype.slice,p=t.isFunction,m=function(t){return"string"==typeof t},g={},v={},y="onfocusin"in window,_={focus:"focusin",blur:"focusout"},b={mouseenter:"mouseover",mouseleave:"mouseout"};v.click=v.mousedown=v.mouseup=v.mousemove="MouseEvents",t.event={add:s,remove:u},t.proxy=function(n,r){var i=2 in arguments&&f.call(arguments,2);if(p(n)){var a=function(){return n.apply(r,i?i.concat(f.call(arguments)):arguments)};return a._zid=e(n),a}if(m(r))return i?(i.unshift(n[r],n),t.proxy.apply(null,i)):t.proxy(n[r],n);throw new TypeError("expected function")},t.fn.bind=function(t,e,n){return this.on(t,e,n)},t.fn.unbind=function(t,e){return this.off(t,e)},t.fn.one=function(t,e,n,r){return this.on(t,e,n,r,1)};var E=function(){return!0},w=function(){return!1},A=/^([A-Z]|returnValue$|layer[XY]$|webkitMovement[XY]$)/,S={preventDefault:"isDefaultPrevented",stopImmediatePropagation:"isImmediatePropagationStopped",stopPropagation:"isPropagationStopped"};t.fn.delegate=function(t,e,n){return this.on(e,t,n)},t.fn.undelegate=function(t,e,n){return this.off(e,t,n)},t.fn.live=function(e,n){return t(document.body).delegate(this.selector,e,n),this},t.fn.die=function(e,n){return t(document.body).undelegate(this.selector,e,n),this},t.fn.on=function(e,n,r,i,a){var o,l,h=this;return e&&!m(e)?(t.each(e,function(t,e){h.on(t,n,r,e,a)}),h):(m(n)||p(i)||!1===i||(i=r,r=n,n=d),i!==d&&!1!==r||(i=r,r=d),!1===i&&(i=w),h.each(function(d,h){a&&(o=function(t){return u(h,t.type,i),i.apply(this,arguments)}),n&&(l=function(e){var r,a=t(e.target).closest(n,h).get(0);if(a&&a!==h)return r=t.extend(c(e),{currentTarget:a,liveFired:h}),(o||i).apply(a,[r].concat(f.call(arguments,1)))}),s(h,e,i,r,n,l||o)}))},t.fn.off=function(e,n,r){var i=this;return e&&!m(e)?(t.each(e,function(t,e){i.off(t,n,e)}),i):(m(n)||p(r)||!1===r||(r=n,n=d),!1===r&&(r=w),i.each(function(){u(this,e,r,n)}))},t.fn.trigger=function(e,n){return e=m(e)||t.isPlainObject(e)?t.Event(e):l(e),e._args=n,this.each(function(){e.type in _&&"function"==typeof this[e.type]?this[e.type]():"dispatchEvent"in this?this.dispatchEvent(e):t(this).triggerHandler(e,n)})},t.fn.triggerHandler=function(e,r){var i,a;return this.each(function(o,s){i=c(m(e)?t.Event(e):e),i._args=r,i.target=s,t.each(n(s,e.type||e),function(t,e){if(a=e.proxy(i),i.isImmediatePropagationStopped())return!1})}),a},"focusin focusout focus blur load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select keydown keypress keyup error".split(" ").forEach(function(e){t.fn[e]=function(t){return 0 in arguments?this.bind(e,t):this.trigger(e)}}),t.Event=function(t,e){m(t)||(e=t,t=e.type);var n=document.createEvent(v[t]||"Events"),r=!0;if(e)for(var i in e)"bubbles"==i?r=!!e[i]:n[i]=e[i];return n.initEvent(t,r,!0),l(n)}}(n),function(){try{getComputedStyle(void 0)}catch(e){var t=getComputedStyle;window.getComputedStyle=function(e,n){try{return t(e,n)}catch(e){return null}}}}(),function(t){function e(e){return e=t(e),!(!e.width()&&!e.height())&&"none"!==e.css("display")}function n(t,e){t=t.replace(/=#\]/g,'="#"]');var n,r,i=s.exec(t);if(i&&i[2]in o&&(n=o[i[2]],r=i[3],t=i[1],r)){var a=Number(r);r=isNaN(a)?r.replace(/^["']|["']$/g,""):a}return e(t,n,r)}var r=t.zepto,i=r.qsa,a=r.matches,o=t.expr[":"]={visible:function(){if(e(this))return this},hidden:function(){if(!e(this))return this},selected:function(){if(this.selected)return this},checked:function(){if(this.checked)return this},parent:function(){return this.parentNode},first:function(t){if(0===t)return this},last:function(t,e){if(t===e.length-1)return this},eq:function(t,e,n){if(t===n)return this},contains:function(e,n,r){if(t(this).text().indexOf(r)>-1)return this},has:function(t,e,n){if(r.qsa(this,n).length)return this}},s=new RegExp("(.*):(\\w+)(?:\\(([^)]+)\\))?$\\s*"),u=/^\s*>/,l="Zepto"+ +new Date;r.qsa=function(e,a){return n(a,function(n,o,s){try{var c;!n&&o?n="*":u.test(n)&&(c=t(e).addClass(l),n="."+l+" "+n);var d=i(e,n)}catch(h){throw console.error("error performing selector: %o",a),h}finally{c&&c.removeClass(l)}return o?r.uniq(t.map(d,function(t,e){return o.call(t,e,d,s)})):d})},r.matches=function(t,e){return n(e,function(e,n,r){return(!e||a(t,e))&&(!n||n.call(t,null,r)===t)})}}(n),t.exports=n},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g},i=/(.)^/,a={"'":"'","\\":"\\","\r":"r","\n":"n","\t":"t","\u2028":"u2028","\u2029":"u2029"},o=/\\|'|\r|\n|\t|\u2028|\u2029/g,s={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"},u=new RegExp("[&<>\"']","g"),l=function(t){return null===t?"":(""+t).replace(u,function(t){return s[t]})},c=0,d=function(t,e){var n,s=new RegExp([(r.escape||i).source,(r.interpolate||i).source,(r.evaluate||i).source].join("|")+"|$","g"),u=0,d="__p+='";t.replace(s,function(e,n,r,i,s){return d+=t.slice(u,s).replace(o,function(t){return"\\"+a[t]}),n&&(d+="'+\n((__t=("+n+"))==null?'':escapeExpr(__t))+\n'"),r&&(d+="'+\n((__t=("+r+"))==null?'':__t)+\n'"),i&&(d+="';\n"+i+"\n__p+='"),u=s+e.length,e}),d+="';\n",r.variable||(d="with(obj||{}){\n"+d+"}\n"),d="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+d+"return __p;\n//# sourceURL=/microtemplates/source["+c+++"]";try{n=new Function(r.variable||"obj","escapeExpr",d)}catch(f){throw f.source=d,f}if(e)return n(e,l);var h=function(t){return n.call(this,t,l)};return h.source="function("+(r.variable||"obj")+"){\n"+d+"}",h};d.settings=r,e.default=d,t.exports=e["default"]},function(t,e,n){var r=n(67)("wks"),i=n(49),a=n(14).Symbol,o="function"==typeof a;(t.exports=function(t){return r[t]||(r[t]=o&&a[t]||(o?a:i)("Symbol."+t))}).store=r},function(t,e,n){var r=n(14),i=n(5),a=n(20),o=n(24),s=function(t,e,n){var u,l,c,d=t&s.F,h=t&s.G,f=t&s.S,p=t&s.P,m=t&s.B,g=t&s.W,v=h?i:i[e]||(i[e]={}),y=v["prototype"],_=h?r:f?r[e]:(r[e]||{})["prototype"];h&&(n=e);for(u in n)(l=!d&&_&&void 0!==_[u])&&u in v||(c=l?_[u]:n[u],v[u]=h&&"function"!=typeof _[u]?n[u]:m&&l?a(c,r):g&&_[u]==c?function(t){var e=function(e,n,r){if(this instanceof t){switch(arguments.length){case 0:return new t;case 1:return new t(e);case 2:return new t(e,n)}return new t(e,n,r)}return t.apply(this,arguments)};return e["prototype"]=t["prototype"],e}(c):p&&"function"==typeof c?a(Function.call,c):c,p&&((v.virtual||(v.virtual={}))[u]=c,t&s.R&&y&&!y[u]&&o(y,u,c)))};s.F=1,s.G=2,s.S=4,s.P=8,s.B=16,s.W=32,s.U=64,s.R=128,t.exports=s},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),u=n(3),l=r(u),c=n(2),d=r(c),h=n(8),f=n(30),p=r(f),m=function(t){function e(n,r){(0,a.default)(this,e);var i=(0,s.default)(this,t.call(this,n));return i.settings={},i._i18n=r,i._consented=!1,i}return(0,d.default)(e,t),(0,l.default)(e,[{key:"isAudioOnly",get:function(){return!1}},{key:"ended",get:function(){return!1}},{key:"i18n",get:function(){return this._i18n}},{key:"buffering",get:function(){return!1}},{key:"consented",get:function(){return this._consented}}]),e.prototype.consent=function(){this._consented=!0},e.prototype.play=function(){},e.prototype.pause=function(){},e.prototype.stop=function(){},e.prototype.seek=function(t){},e.prototype.seekPercentage=function(t){},e.prototype.getStartTimeOffset=function(){return 0},e.prototype.getDuration=function(){return 0},e.prototype.isPlaying=function(){return!1},e.prototype.getPlaybackType=function(){return e.NO_OP},e.prototype.isHighDefinitionInUse=function(){return!1},e.prototype.volume=function(t){},e.prototype.destroy=function(){this.$el.remove()},e.prototype.attemptAutoPlay=function(){var t=this;this.canAutoPlay(function(e,n){e&&t.play()})},e.prototype.canAutoPlay=function(t){t(!0,null)},(0,l.default)(e,[{key:"isReady",get:function(){return!1}},{key:"hasClosedCaptionsTracks",get:function(){return this.closedCaptionsTracks.length>0}},{key:"closedCaptionsTracks",get:function(){return[]}},{key:"closedCaptionsTrackId",get:function(){return-1},set:function(t){}}]),e}(p.default);e.default=m,m.extend=function(t){return(0,h.extend)(m,t)},m.canPlay=function(t,e){return!1},m.VOD="vod",m.AOD="aod",m.LIVE="live",m.NO_OP="no_op",m.type="playback",t.exports=e["default"]},function(t,e){var n=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=n)},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),u=n(2),l=r(u),c=n(8),d=n(30),h=r(d),f=function(t){function e(n){(0,a.default)(this,e);var r=(0,s.default)(this,t.call(this,n.options));return r.core=n,r.enabled=!0,r.bindEvents(),r.render(),r}return(0,l.default)(e,t),e.prototype.bindEvents=function(){},e.prototype.getExternalInterface=function(){return{}},e.prototype.enable=function(){this.enabled||(this.bindEvents(),this.$el.show(),this.enabled=!0)},e.prototype.disable=function(){this.stopListening(),this.$el.hide(),this.enabled=!1},e.prototype.destroy=function(){this.remove()},e.prototype.render=function(){return this},e}(h.default);e.default=f,f.extend=function(t){return(0,c.extend)(f,t)},f.type="core",t.exports=e["default"]},function(t,e,n){var r=n(18),i=n(91),a=n(71),o=Object.defineProperty;e.f=n(19)?Object.defineProperty:function(t,e,n){if(r(t),e=a(e,!0),r(n),i)try{return o(t,e,n)}catch(s){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(t[e]=n.value),t}},function(t,e){t.exports=function(t){return"object"==typeof t?null!==t:"function"==typeof t}},function(t,e,n){var r=n(17);t.exports=function(t){if(!r(t))throw TypeError(t+" is not an object!");return t}},function(t,e,n){t.exports=!n(25)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},function(t,e,n){var r=n(41);t.exports=function(t,e,n){if(r(t),void 0===e)return t;switch(n){case 1:return function(n){return t.call(e,n)};case 2:return function(n,r){return t.call(e,n,r)};case 3:return function(n,r,i){return t.call(e,n,r,i)}}return function(){return t.apply(e,arguments)}}},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),u=n(3),l=r(u),c=n(2),d=r(c),h=n(8),f=n(4),p=r(f),m=function(t){function e(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,a.default)(this,e);var r=(0,s.default)(this,t.call(this,n));return r._options=n,r.uniqueId=(0,h.uniqueId)("o"),r}return(0,d.default)(e,t),(0,l.default)(e,[{key:"options",get:function(){return this._options}}]),e}(p.default);e.default=m,t.exports=e["default"]},function(t,e){var n={}.hasOwnProperty;t.exports=function(t,e){return n.call(t,e)}},function(t,e,n){var r=n(64),i=n(63);t.exports=function(t){return r(i(t))}},function(t,e,n){var r=n(16),i=n(42);t.exports=n(19)?function(t,e,n){return r.f(t,e,i(1,n))}:function(t,e,n){return t[e]=n,t}},function(t,e){t.exports=function(t){try{return!!t()}catch(e){return!0}}},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}e.__esModule=!0;var i=n(72),a=r(i),o=n(76),s=r(o),u="function"==typeof s.default&&"symbol"==typeof a.default?function(t){return typeof t}:function(t){return t&&"function"==typeof s.default&&t.constructor===s.default&&t!==s.default.prototype?"symbol":typeof t};e.default="function"==typeof s.default&&"symbol"===u(a.default)?function(t){return void 0===t?"undefined":u(t)}:function(t){return t&&"function"==typeof s.default&&t.constructor===s.default&&t!==s.default.prototype?"symbol":void 0===t?"undefined":u(t)}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(170),i=function(t){return t&&t.__esModule?t:{default:t}}(r);e.default=i.default,t.exports=e["default"]},function(t,e,n){t.exports={default:n(140),__esModule:!0}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r={},i=function(){var t=navigator.userAgent,e=t.match(/\b(playstation 4|nx|opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[],n=void 0;if(/trident/i.test(e[1]))return n=/\brv[ :]+(\d+)/g.exec(t)||[],{name:"IE",version:parseInt(n[1]||"")};if("Chrome"===e[1]){if(null!=(n=t.match(/\bOPR\/(\d+)/)))return{name:"Opera",version:parseInt(n[1])};if(null!=(n=t.match(/\bEdge\/(\d+)/)))return{name:"Edge",version:parseInt(n[1])}}return e=e[2]?[e[1],e[2]]:[navigator.appName,navigator.appVersion,"-?"],(n=t.match(/version\/(\d+)/i))&&e.splice(1,1,n[1]),{name:e[0],version:parseInt(e[1])}}();r.isEdge=/edge/i.test(navigator.userAgent),r.isChrome=/chrome|CriOS/i.test(navigator.userAgent)&&!r.isEdge,r.isSafari=/safari/i.test(navigator.userAgent)&&!r.isChrome&&!r.isEdge,r.isFirefox=/firefox/i.test(navigator.userAgent),r.isLegacyIE=!!window.ActiveXObject,r.isIE=r.isLegacyIE||/trident.*rv:1\d/i.test(navigator.userAgent),r.isIE11=/trident.*rv:11/i.test(navigator.userAgent),r.isChromecast=r.isChrome&&/CrKey/i.test(navigator.userAgent),r.isMobile=/Android|webOS|iPhone|iPad|iPod|BlackBerry|Windows Phone|IEMobile|Mobile Safari|Opera Mini/i.test(navigator.userAgent),r.isiOS=/iPad|iPhone|iPod/i.test(navigator.userAgent),r.isAndroid=/Android/i.test(navigator.userAgent),r.isWindowsPhone=/Windows Phone/i.test(navigator.userAgent),r.isWin8App=/MSAppHost/i.test(navigator.userAgent),r.isWiiU=/WiiU/i.test(navigator.userAgent),r.isPS4=/PlayStation 4/i.test(navigator.userAgent),r.hasLocalstorage=function(){try{return localStorage.setItem("pwplayer","pwplayer"),localStorage.removeItem("pwplayer"),!0}catch(t){return!1}}(),r.hasFlash=function(){try{return!!new ActiveXObject("ShockwaveFlash.ShockwaveFlash")}catch(t){return!(!navigator.mimeTypes||void 0===navigator.mimeTypes["application/x-shockwave-flash"]||!navigator.mimeTypes["application/x-shockwave-flash"].enabledPlugin)}}(),r.name=i.name,r.version=i.version,e.default=r,t.exports=e["default"]},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),u=n(3),l=r(u),c=n(2),d=r(c),h=n(9),f=r(h),p=n(8),m=n(21),g=r(m),v=/^(\S+)\s*(.*)$/,y=function(t){function e(n){(0,a.default)(this,e);var r=(0,s.default)(this,t.call(this,n));return r.cid=(0,p.uniqueId)("c"),r._ensureElement(),r.delegateEvents(),r}return(0,d.default)(e,t),(0,l.default)(e,[{key:"tagName",get:function(){return"div"}},{key:"events",get:function(){return{}}},{key:"attributes",get:function(){return{}}}]),e.prototype.$=function(t){return this.$el.find(t)},e.prototype.render=function(){return this},e.prototype.remove=function(){return this.$el.remove(),this.stopListening(),this.undelegateEvents(),this},e.prototype.setElement=function(t,e){return this.$el&&this.undelegateEvents(),this.$el=t instanceof f.default?t:(0,f.default)(t),this.el=this.$el[0],!1!==e&&this.delegateEvents(),this},e.prototype.delegateEvents=function(t){if(!t&&!(t=this.events))return this;this.undelegateEvents();for(var e in t){var n=t[e];if(n&&n.constructor!==Function&&(n=this[t[e]]),n){var r=e.match(v),i=r[1],a=r[2];i+=".delegateEvents"+this.cid,""===a?this.$el.on(i,n.bind(this)):this.$el.on(i,a,n.bind(this))}}return this},e.prototype.undelegateEvents=function(){return this.$el.off(".delegateEvents"+this.cid),this},e.prototype._ensureElement=function(){if(this.el)this.setElement(this.el,!1);else{var t=f.default.extend({},this.attributes);this.id&&(t.id=this.id),this.className&&(t["class"]=this.className);var e=p.DomRecycler.create(this.tagName).attr(t);this.setElement(e,!1)}},e}(g.default);e.default=y,t.exports=e["default"]},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),u=n(2),l=r(u),c=n(8),d=n(30),h=r(d),f=function(t){function e(n){(0,a.default)(this,e);var r=(0,s.default)(this,t.call(this,n.options));return r.container=n,r.enabled=!0,r.bindEvents(),r}return(0,l.default)(e,t),e.prototype.enable=function(){this.enabled||(this.bindEvents(),this.$el.show(),this.enabled=!0)},e.prototype.disable=function(){this.stopListening(),this.$el.hide(),this.enabled=!1},e.prototype.bindEvents=function(){},e.prototype.destroy=function(){this.remove()},e}(h.default);e.default=f,f.extend=function(t){return(0,c.extend)(f,t)},f.type="container",t.exports=e["default"]},function(t,e,n){var r=n(63);t.exports=function(t){return Object(r(t))}},function(t,e,n){var r=n(90),i=n(68);t.exports=Object.keys||function(t){return r(t,i)}},function(t,e,n){"use strict";var r=n(145)(!0);n(73)(String,"String",function(t){this._t=String(t),this._i=0},function(){var t,e=this._t,n=this._i;return n>=e.length?{value:void 0,done:!0}:(t=r(e,n),this._i+=t.length,{value:t,done:!1})})},function(t,e){t.exports={}},function(t,e,n){n(148);for(var r=n(14),i=n(24),a=n(35),o=n(11)("toStringTag"),s="CSSRuleList,CSSStyleDeclaration,CSSValueList,ClientRectList,DOMRectList,DOMStringList,DOMTokenList,DataTransferItemList,FileList,HTMLAllCollection,HTMLCollection,HTMLFormElement,HTMLSelectElement,MediaList,MimeTypeArray,NamedNodeMap,NodeList,PaintRequestList,Plugin,PluginArray,SVGLengthList,SVGNumberList,SVGPathSegList,SVGPointList,SVGStringList,SVGTransformList,SourceBufferList,StyleSheetList,TextTrackCueList,TextTrackList,TouchList".split(","),u=0;u<s.length;u++){var l=s[u],c=r[l],d=c&&c.prototype;d&&!d[o]&&i(d,o,l),a[l]=a.Array}},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(4),s=r(o),u=new s.default,l=function c(){(0,a.default)(this,c)};e.default=l,l.on=function(t,e,n){u.on(t,e,n)},l.once=function(t,e,n){u.once(t,e,n)},l.off=function(t,e,n){u.off(t,e,n)},l.trigger=function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];u.trigger.apply(u,[t].concat(n))},l.stopListening=function(t,e,n){u.stopListening(t,e,n)},t.exports=e["default"]},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(193),i=function(t){return t&&t.__esModule?t:{default:t}}(r);e.default=i.default,t.exports=e["default"]},function(t,e,n){var r=n(20),i=n(104),a=n(105),o=n(18),s=n(48),u=n(86),l={},c={},e=t.exports=function(t,e,n,d,h){var f,p,m,g,v=h?function(){return t}:u(t),y=r(n,d,e?2:1),_=0;if("function"!=typeof v)throw TypeError(t+" is not iterable!");if(a(v)){for(f=s(t.length);f>_;_++)if((g=e?y(o(p=t[_])[0],p[1]):y(t[_]))===l||g===c)return g}else for(m=v.call(t);!(p=m.next()).done;)if((g=i(m,y,p.value,e))===l||g===c)return g};e.BREAK=l,e.RETURN=c},function(t,e){var n={}.toString;t.exports=function(t){return n.call(t).slice(8,-1)}},function(t,e){t.exports=function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!");return t}},function(t,e){t.exports=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}}},function(t,e,n){var r=n(16).f,i=n(22),a=n(11)("toStringTag");t.exports=function(t,e,n){t&&!i(t=n?t:t.prototype,a)&&r(t,a,{configurable:!0,value:e})}},function(t,e,n){e.f=n(11)},function(t,e,n){var r=n(49)("meta"),i=n(17),a=n(22),o=n(16).f,s=0,u=Object.isExtensible||function(){return!0},l=!n(25)(function(){return u(Object.preventExtensions({}))}),c=function(t){o(t,r,{value:{i:"O"+ ++s,w:{}}})},d=function(t,e){if(!i(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!a(t,r)){if(!u(t))return"F";if(!e)return"E";c(t)}return t[r].i},h=function(t,e){if(!a(t,r)){if(!u(t))return!0;if(!e)return!1;c(t)}return t[r].w},f=function(t){return l&&p.NEED&&u(t)&&!a(t,r)&&c(t),t},p=t.exports={KEY:r,NEED:!1,fastKey:d,getWeak:h,onFreeze:f}},function(t,e){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(r){"object"==typeof window&&(n=window)}t.exports=n},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),u=n(2),l=r(u),c=n(21),d=r(c),h=n(8),f=function(t){function e(n){(0,a.default)(this,e);var r=(0,s.default)(this,t.call(this,n.options));return r.container=n,r.enabled=!0,r.bindEvents(),r}return(0,l.default)(e,t),e.prototype.enable=function(){this.enabled||(this.bindEvents(),this.enabled=!0)},e.prototype.disable=function(){this.enabled&&(this.stopListening(),this.enabled=!1)},e.prototype.bindEvents=function(){},e.prototype.destroy=function(){this.stopListening()},e}(d.default);e.default=f,f.extend=function(t){return(0,h.extend)(f,t)},f.type="container",t.exports=e["default"]},function(t,e,n){var r=n(65),i=Math.min;t.exports=function(t){return t>0?i(r(t),9007199254740991):0}},function(t,e){var n=0,r=Math.random();t.exports=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++n+r).toString(36))}},function(t,e){t.exports=!0},function(t,e,n){var r=n(18),i=n(147),a=n(68),o=n(66)("IE_PROTO"),s=function(){},u=function(){var t,e=n(70)("iframe"),r=a.length;for(e.style.display="none",n(92).appendChild(e),e.src="javascript:",t=e.contentWindow.document,t.open(),t.write("<script>document.F=Object<\/script>"),t.close(),u=t.F;r--;)delete u["prototype"][a[r]];return u()};t.exports=Object.create||function(t,e){var n;return null!==t?(s["prototype"]=r(t),n=new s,s["prototype"]=null,n[o]=t):n=u(),void 0===e?n:i(n,e)}},function(t,e){e.f={}.propertyIsEnumerable},function(t,e){},function(t,e,n){t.exports={default:n(157),__esModule:!0}},function(t,e,n){t.exports={default:n(162),__esModule:!0}},function(t,e,n){t.exports={default:n(180),__esModule:!0}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(0),i=function(t){return t&&t.__esModule?t:{default:t}}(r),a=function o(){(0,i.default)(this,o),this.options={},this.playbackPlugins=[],this.currentSize={width:0,height:0}};a._players={},a.getInstance=function(t){return a._players[t]||(a._players[t]=new a)},e.default=a,t.exports=e["default"]},function(t,e,n){var r=n(40),i=n(11)("toStringTag"),a="Arguments"==r(function(){return arguments}()),o=function(t,e){try{return t[e]}catch(n){}};t.exports=function(t){var e,n,s;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(n=o(e=Object(t),i))?n:a?r(e):"Object"==(s=r(e))&&"function"==typeof e.callee?"Arguments":s}},function(t,e){t.exports=function(t,e,n,r){if(!(t instanceof e)||void 0!==r&&r in t)throw TypeError(n+": incorrect invocation!");return t}},function(t,e,n){var r=n(24);t.exports=function(t,e,n){for(var i in e)n&&t[i]?t[i]=e[i]:r(t,i,e[i]);return t}},function(t,e,n){var r=n(17);t.exports=function(t,e){if(!r(t)||t._t!==e)throw TypeError("Incompatible receiver, "+e+" required!");return t}},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),u=n(2),l=r(u),c=n(8),d=n(21),h=r(d),f=function(t){function e(n){(0,a.default)(this,e);var r=(0,s.default)(this,t.call(this,n.options));return r.core=n,r.enabled=!0,r.bindEvents(),r}return(0,l.default)(e,t),e.prototype.bindEvents=function(){},e.prototype.enable=function(){this.enabled||(this.bindEvents(),this.enabled=!0)},e.prototype.disable=function(){this.enabled&&(this.stopListening(),this.enabled=!1)},e.prototype.getExternalInterface=function(){return{}},e.prototype.destroy=function(){this.stopListening()},e}(h.default);e.default=f,f.extend=function(t){return(0,c.extend)(f,t)},f.type="core",t.exports=e["default"]},function(t,e){t.exports=function(t){if(void 0==t)throw TypeError("Can't call method on  "+t);return t}},function(t,e,n){var r=n(40);t.exports=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==r(t)?t.split(""):Object(t)}},function(t,e){var n=Math.ceil,r=Math.floor;t.exports=function(t){return isNaN(t=+t)?0:(t>0?r:n)(t)}},function(t,e,n){var r=n(67)("keys"),i=n(49);t.exports=function(t){return r[t]||(r[t]=i(t))}},function(t,e,n){var r=n(14),i=r["__core-js_shared__"]||(r["__core-js_shared__"]={});t.exports=function(t){return i[t]||(i[t]={})}},function(t,e){t.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(t,e,n){var r=n(12),i=n(5),a=n(25);t.exports=function(t,e){var n=(i.Object||{})[t]||Object[t],o={};o[t]=e(n),r(r.S+r.F*a(function(){n(1)}),"Object",o)}},function(t,e,n){var r=n(17),i=n(14).document,a=r(i)&&r(i.createElement);t.exports=function(t){return a?i.createElement(t):{}}},function(t,e,n){var r=n(17);t.exports=function(t,e){if(!r(t))return t;var n,i;if(e&&"function"==typeof(n=t.toString)&&!r(i=n.call(t)))return i;if("function"==typeof(n=t.valueOf)&&!r(i=n.call(t)))return i;if(!e&&"function"==typeof(n=t.toString)&&!r(i=n.call(t)))return i;throw TypeError("Can't convert object to primitive value")}},function(t,e,n){t.exports={default:n(144),__esModule:!0}},function(t,e,n){"use strict";var r=n(50),i=n(12),a=n(74),o=n(24),s=n(22),u=n(35),l=n(146),c=n(43),d=n(75),h=n(11)("iterator"),f=!([].keys&&"next"in[].keys()),p=function(){return this};t.exports=function(t,e,n,m,g,v,y){l(n,e,m);var _,b,E,w=function(t){if(!f&&t in x)return x[t];switch(t){case"keys":case"values":return function(){return new n(this,t)}}return function(){return new n(this,t)}},A=e+" Iterator",S="values"==g,T=!1,x=t.prototype,k=x[h]||x["@@iterator"]||g&&x[g],C=k||w(g),M=g?S?w("entries"):C:void 0,R="Array"==e?x.entries||k:k;if(R&&(E=d(R.call(new t)))!==Object.prototype&&E.next&&(c(E,A,!0),r||s(E,h)||o(E,h,p)),S&&k&&"values"!==k.name&&(T=!0,C=function(){return k.call(this)}),r&&!y||!f&&!T&&x[h]||o(x,h,C),u[e]=C,u[A]=p,g)if(_={values:S?C:w("values"),keys:v?C:w("keys"),entries:M},y)for(b in _)b in x||a(x,b,_[b]);else i(i.P+i.F*(f||T),e,_);return _}},function(t,e,n){t.exports=n(24)},function(t,e,n){var r=n(22),i=n(32),a=n(66)("IE_PROTO"),o=Object.prototype;t.exports=Object.getPrototypeOf||function(t){return t=i(t),r(t,a)?t[a]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?o:null}},function(t,e,n){t.exports={default:n(150),__esModule:!0}},function(t,e,n){var r=n(14),i=n(5),a=n(50),o=n(44),s=n(16).f;t.exports=function(t){var e=i.Symbol||(i.Symbol=a?{}:r.Symbol||{});"_"==t.charAt(0)||t in e||s(e,t,{value:o.f(t)})}},function(t,e){e.f=Object.getOwnPropertySymbols},function(t,e,n){var r=n(52),i=n(42),a=n(23),o=n(71),s=n(22),u=n(91),l=Object.getOwnPropertyDescriptor;e.f=n(19)?l:function(t,e){if(t=a(t),e=o(e,!0),u)try{return l(t,e)}catch(n){}if(s(t,e))return i(!r.f.call(t,e),t[e])}},function(t,e,n){t.exports={default:n(159),__esModule:!0}},function(t,e,n){t.exports={default:n(164),__esModule:!0}},function(t,e,n){t.exports={default:n(166),__esModule:!0}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(171),i=function(t){return t&&t.__esModule?t:{default:t}}(r);e.default={Kibo:i.default},t.exports=e["default"]},function(t,e){function n(){throw new Error("setTimeout has not been defined")}function r(){throw new Error("clearTimeout has not been defined")}function i(t){if(c===setTimeout)return setTimeout(t,0);if((c===n||!c)&&setTimeout)return c=setTimeout,setTimeout(t,0);try{return c(t,0)}catch(e){try{return c.call(null,t,0)}catch(e){return c.call(this,t,0)}}}function a(t){if(d===clearTimeout)return clearTimeout(t);if((d===r||!d)&&clearTimeout)return d=clearTimeout,clearTimeout(t);try{return d(t)}catch(e){try{return d.call(null,t)}catch(e){return d.call(this,t)}}}function o(){m&&f&&(m=!1,f.length?p=f.concat(p):g=-1,p.length&&s())}function s(){if(!m){var t=i(o);m=!0;for(var e=p.length;e;){for(f=p,p=[];++g<e;)f&&f[g].run();g=-1,e=p.length}f=null,m=!1,a(t)}}function u(t,e){this.fun=t,this.array=e}function l(){}var c,d,h=t.exports={};!function(){try{c="function"==typeof setTimeout?setTimeout:n}catch(t){c=n}try{d="function"==typeof clearTimeout?clearTimeout:r}catch(t){d=r}}();var f,p=[],m=!1,g=-1;h.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];p.push(new u(t,e)),1!==p.length||m||i(s)},u.prototype.run=function(){this.fun.apply(null,this.array)},h.title="browser",h.browser=!0,h.env={},h.argv=[],h.version="",h.versions={},h.on=l,h.addListener=l,h.once=l,h.off=l,h.removeListener=l,h.removeAllListeners=l,h.emit=l,h.prependListener=l,h.prependOnceListener=l,h.listeners=function(t){return[]},h.binding=function(t){throw new Error("process.binding is not supported")},h.cwd=function(){return"/"},h.chdir=function(t){throw new Error("process.chdir is not supported")},h.umask=function(){return 0}},function(t,e,n){t.exports={default:n(194),__esModule:!0}},function(t,e,n){var r=n(58),i=n(11)("iterator"),a=n(35);t.exports=n(5).getIteratorMethod=function(t){if(void 0!=t)return t[i]||t["@@iterator"]||a[r(t)]}},function(t,e,n){"use strict";function r(t){var e,n;this.promise=new t(function(t,r){if(void 0!==e||void 0!==n)throw TypeError("Bad Promise constructor");e=t,n=r}),this.resolve=i(e),this.reject=i(n)}var i=n(41);t.exports.f=function(t){return new r(t)}},function(t,e,n){var r=n(20),i=n(64),a=n(32),o=n(48),s=n(221);t.exports=function(t,e){var n=1==t,u=2==t,l=3==t,c=4==t,d=6==t,h=5==t||d,f=e||s;return function(e,s,p){for(var m,g,v=a(e),y=i(v),_=r(s,p,3),b=o(y.length),E=0,w=n?f(e,b):u?f(e,0):void 0;b>E;E++)if((h||E in y)&&(m=y[E],g=_(m,E,v),t))if(n)w[E]=g;else if(g)switch(t){case 3:return!0;case 5:return m;case 6:return E;case 2:w.push(m)}else if(c)return!1;return d?-1:l||c?c:w}}},function(t,e,n){"use strict";var r=n(309)();t.exports=function(t){return t!==r&&null!==t}},function(t,e,n){var r=n(22),i=n(23),a=n(142)(!1),o=n(66)("IE_PROTO");t.exports=function(t,e){var n,s=i(t),u=0,l=[];for(n in s)n!=o&&r(s,n)&&l.push(n);for(;e.length>u;)r(s,n=e[u++])&&(~a(l,n)||l.push(n));return l}},function(t,e,n){t.exports=!n(19)&&!n(25)(function(){return 7!=Object.defineProperty(n(70)("div"),"a",{get:function(){return 7}}).a})},function(t,e,n){var r=n(14).document;t.exports=r&&r.documentElement},function(t,e){t.exports=function(t,e){return{value:e,done:!!t}}},function(t,e,n){var r=n(40);t.exports=Array.isArray||function(t){return"Array"==r(t)}},function(t,e,n){var r=n(90),i=n(68).concat("length","prototype");e.f=Object.getOwnPropertyNames||function(t){return r(t,i)}},function(t,e,n){"use strict";var r=n(33),i=n(78),a=n(52),o=n(32),s=n(64),u=Object.assign;t.exports=!u||n(25)(function(){var t={},e={},n=Symbol(),r="abcdefghijklmnopqrst";return t[n]=7,r.split("").forEach(function(t){e[t]=t}),7!=u({},t)[n]||Object.keys(u({},e)).join("")!=r})?function(t,e){for(var n=o(t),u=arguments.length,l=1,c=i.f,d=a.f;u>l;)for(var h,f=s(arguments[l++]),p=c?r(f).concat(c(f)):r(f),m=p.length,g=0;m>g;)d.call(f,h=p[g++])&&(n[h]=f[h]);return n}:u},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(174),i=function(t){return t&&t.__esModule?t:{default:t}}(r);e.default=i.default,t.exports=e["default"]},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(177),i=function(t){return t&&t.__esModule?t:{default:t}}(r);e.default=i.default,t.exports=e["default"]},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(179),i=function(t){return t&&t.__esModule?t:{default:t}}(r);e.default=i.default,t.exports=e["default"]},function(t,e){t.exports=function(t){return"string"!=typeof t?t:(/^['"].*['"]$/.test(t)&&(t=t.slice(1,-1)),/["'() \t\n]/.test(t)?'"'+t.replace(/"/g,'\\"').replace(/\n/g,"\\n")+'"':t)}},function(t,e,n){t.exports=n.p+"a8c874b93b3d848f39a71260c57e3863.cur"},function(t,e){t.exports='<svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve"><g><g><path fill-rule="evenodd" clip-rule="evenodd" fill="#333333" d="M20.573,11.225C20.573,11.225,20.573,11.225,20.573,11.225 c-0.001-0.001-0.001-0.001-0.002-0.001c0,0,0-0.001-0.001-0.001c-0.383-0.388-1.001-0.388-1.384,0.001s-0.383,1.021,0,1.411 c0.001,0.002,0.002,0.003,0.004,0.004c0.898,0.918,1.393,2.138,1.393,3.437c0,1.3-0.499,2.525-1.404,3.447 c-0.383,0.391-0.383,1.021,0,1.412c0.382,0.39,1.003,0.39,1.386,0l0.005,0.005C23.201,18.262,23.201,13.904,20.573,11.225z M23.03,8.723c-0.383-0.39-1.003-0.39-1.386,0c-0.384,0.39-0.384,1.022,0,1.411c3.211,3.272,3.214,8.597,0.006,11.877 c-0.005,0.005-0.01,0.009-0.015,0.014c-0.382,0.389-0.382,1.021,0,1.411c0.383,0.39,1.003,0.39,1.386,0l0.005,0.005 C27.01,19.384,27.013,12.78,23.03,8.723z M15.307,8c-0.23,0-0.433,0.117-0.553,0.294V8.292l-4.839,4.688H6.651 c-0.368,0-0.667,0.299-0.667,0.667v4.677c0,0.368,0.298,0.666,0.667,0.666h3.264l4.839,4.719v-0.002 C14.875,23.884,15.077,24,15.307,24c0.368,0,0.667-0.299,0.667-0.667V8.667C15.974,8.298,15.676,8,15.307,8z"></path></g></g></svg>'},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(192),i=function(t){return t&&t.__esModule?t:{default:t}}(r);e.default=i.default,t.exports=e["default"]},function(t,e,n){var r=n(18);t.exports=function(t,e,n,i){try{return i?e(r(n)[0],n[1]):e(n)}catch(o){var a=t["return"];throw void 0!==a&&r(a.call(t)),o}}},function(t,e,n){var r=n(35),i=n(11)("iterator"),a=Array.prototype;t.exports=function(t){return void 0!==t&&(r.Array===t||a[i]===t)}},function(t,e,n){var r=n(11)("iterator"),i=!1;try{var a=[7][r]();a["return"]=function(){i=!0},Array.from(a,function(){throw 2})}catch(o){}t.exports=function(t,e){if(!e&&!i)return!1;var n=!1;try{var a=[7],o=a[r]();o.next=function(){return{done:n=!0}},a[r]=function(){return o},t(a)}catch(o){}return n}},function(t,e,n){"use strict";e.__esModule=!0;var r=n(85),i=function(t){return t&&t.__esModule?t:{default:t}}(r);e.default=function(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return(0,i.default)(t)}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(199),i=function(t){return t&&t.__esModule?t:{default:t}}(r);e.default=i.default,t.exports=e["default"]},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(110),i=function(t){return t&&t.__esModule?t:{default:t}}(r);e.default=i.default,t.exports=e["default"]},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=n(107),a=r(i),o=n(0),s=r(o),u=n(1),l=r(u),c=n(3),d=r(c),h=n(2),f=r(h),p=n(38),m=r(p),g=n(111),v=r(g),y=n(4),_=r(y),b=n(13),E=r(b),w=n(8),A=n(27),S=r(A),T=function(t){function e(){(0,s.default)(this,e);for(var n=arguments.length,r=Array(n),i=0;i<n;i++)r[i]=arguments[i];var a=(0,l.default)(this,t.call.apply(t,[this].concat(r)));return a.options.playback||(a.options.playback=a.options),a._minDvrSize=void 0===a.options.hlsMinimumDvrSize?60:a.options.hlsMinimumDvrSize,a._extrapolatedWindowNumSegments=a.options.playback&&void 0!==a.options.playback.extrapolatedWindowNumSegments?a.options.playback.extrapolatedWindowNumSegments:2,a._playbackType=E.default.VOD,a._lastTimeUpdate=null,a._lastDuration=null,a._playableRegionStartTime=0,a._localStartTimeCorrelation=null,a._localEndTimeCorrelation=null,a._playableRegionDuration=0,a._durationExcludesAfterLiveSyncPoint=!1,a._segmentTargetDuration=null,a._playlistType=null,a._recoverAttemptsRemaining=a.options.hlsRecoverAttempts||16,a._levelSwitching=!1,a._startTimeUpdateTimer(),a}return(0,f.default)(e,t),(0,d.default)(e,[{key:"name",get:function(){return"hls"}},{key:"levels",get:function(){return this._levels||[]}},{key:"currentLevel",get:function(){return null===this._currentLevel||void 0===this._currentLevel?-1:this._currentLevel},set:function(t){this._levelSwitching=!0,this._currentLevel=t,this.trigger(_.default.PLAYBACK_LEVEL_SWITCH_START),this.options.playback.hlsUseNextLevel?this._hls.nextLevel=this._currentLevel:this._hls.currentLevel=this._currentLevel}},{key:"_startTime",get:function(){return this._playbackType===E.default.LIVE&&"EVENT"!==this._playlistType?this._extrapolatedStartTime:this._playableRegionStartTime}},{key:"_now",get:function(){return(0,w.now)()}},{key:"_extrapolatedStartTime",get:function(){if(!this._localStartTimeCorrelation)return this._playableRegionStartTime;var t=this._localStartTimeCorrelation,e=this._now-t.local,n=(t.remote+e)/1e3;return Math.min(n,this._playableRegionStartTime+this._extrapolatedWindowDuration)}},{key:"_extrapolatedEndTime",get:function(){var t=this._playableRegionStartTime+this._playableRegionDuration;if(!this._localEndTimeCorrelation)return t;var e=this._localEndTimeCorrelation,n=this._now-e.local,r=(e.remote+n)/1e3;return Math.max(t-this._extrapolatedWindowDuration,Math.min(r,t))}},{key:"_duration",get:function(){return this._extrapolatedEndTime-this._startTime}},{key:"_extrapolatedWindowDuration",get:function(){return null===this._segmentTargetDuration?0:this._extrapolatedWindowNumSegments*this._segmentTargetDuration}}],[{key:"HLSJS",get:function(){return v.default}}]),e.prototype._setupHls=function(){var t=this;this._ccIsSetup=!1,this._ccTracksUpdated=!1;var e=this.options.playback.hlsjsConfig||{};e.mirrorServers=this.options.mirrorServers,this._hls=new v.default(e),this._hls.on(v.default.Events.MEDIA_ATTACHED,function(){return t._hls.loadSource(t.options.src)}),this._hls.on(v.default.Events.LEVEL_LOADED,function(e,n){return t._updatePlaybackType(e,n)}),this._hls.on(v.default.Events.LEVEL_UPDATED,function(e,n){return t._onLevelUpdated(e,n)}),this._hls.on(v.default.Events.LEVEL_SWITCHING,function(e,n){return t._onLevelSwitch(e,n)}),this._hls.on(v.default.Events.LEVEL_SWITCHED,function(e,n){return t._onLevelSwitched(e,n)}),this._hls.on(v.default.Events.FRAG_LOADED,function(e,n){return t._onFragmentLoaded(e,n)}),this._hls.on(v.default.Events.ERROR,function(e,n){return t._onHLSJSError(e,n)}),this._hls.on(v.default.Events.SUBTITLE_TRACK_LOADED,function(e,n){return t._onSubtitleLoaded(e,n)}),this._hls.on(v.default.Events.SUBTITLE_TRACKS_UPDATED,function(){return t._ccTracksUpdated=!0}),this._hls.attachMedia(this.el)},e.prototype._recover=function(t,e){this._recoveredDecodingError?this._recoveredAudioCodecError?(S.default.error("hlsjs: failed to recover"),this.trigger(_.default.PLAYBACK_ERROR,"hlsjs: could not recover from error, evt "+t+", data "+e+" ",this.name)):(this._recoveredAudioCodecError=!0,this._hls.swapAudioCodec(),this._hls.recoverMediaError()):(this._recoveredDecodingError=!0,this._hls.recoverMediaError())},e.prototype._setupSrc=function(t){},e.prototype._startTimeUpdateTimer=function(){var t=this;this._timeUpdateTimer=setInterval(function(){t._onDurationChange(),t._onTimeUpdate()},100)},e.prototype._stopTimeUpdateTimer=function(){clearInterval(this._timeUpdateTimer)},e.prototype.getDuration=function(){return this._duration},e.prototype.getCurrentTime=function(){return Math.max(0,this.el.currentTime-this._startTime)},e.prototype.getStartTimeOffset=function(){return this._startTime},e.prototype.seekPercentage=function(t){var e=this._duration;t>0&&(e=this._duration*(t/100)),this.seek(e)},e.prototype.seek=function(e){e<0&&(S.default.warn("Attempt to seek to a negative time. Resetting to live point. Use seekToLivePoint() to seek to the live point."),e=this.getDuration()),this.dvrEnabled&&this._updateDvr(e<this.getDuration()-3),e+=this._startTime,t.prototype.seek.call(this,e)},e.prototype.seekToLivePoint=function(){this.seek(this.getDuration())},e.prototype._updateDvr=function(t){this.trigger(_.default.PLAYBACK_DVR,t),this.trigger(_.default.PLAYBACK_STATS_ADD,{dvr:t})},e.prototype._updateSettings=function(){this._playbackType===E.default.VOD?this.settings.left=["playpause","position","duration"]:this.dvrEnabled?this.settings.left=["playpause"]:this.settings.left=["playstop"],this.settings.seekEnabled=this.isSeekEnabled(),this.trigger(_.default.PLAYBACK_SETTINGSUPDATE)},e.prototype._onHLSJSError=function(t,e){if(e.fatal)if(this._recoverAttemptsRemaining>0)switch(this._recoverAttemptsRemaining-=1,e.type){case v.default.ErrorTypes.NETWORK_ERROR:switch(e.details){case v.default.ErrorDetails.MANIFEST_LOAD_ERROR:case v.default.ErrorDetails.MANIFEST_LOAD_TIMEOUT:case v.default.ErrorDetails.MANIFEST_PARSING_ERROR:case v.default.ErrorDetails.LEVEL_LOAD_ERROR:case v.default.ErrorDetails.LEVEL_LOAD_TIMEOUT:S.default.error("hlsjs: unrecoverable network fatal error, evt "+t+", data "+e+" "),this.trigger(_.default.PLAYBACK_ERROR,{evt:t,data:e},this.name);break;default:S.default.warn("hlsjs: trying to recover from network error, evt "+t+", data "+e+" "),this._hls.startLoad()}break;case v.default.ErrorTypes.MEDIA_ERROR:S.default.warn("hlsjs: trying to recover from media error, evt "+t+", data "+e+" "),this._recover(t,e);break;default:S.default.error("hlsjs: trying to recover from error, evt "+t+", data "+e+" "),this.trigger(_.default.PLAYBACK_ERROR,"hlsjs: could not recover from error, evt "+t+", data "+e+" ",this.name)}else S.default.error("hlsjs: could not recover from error after maximum number of attempts, evt "+t+", data "+e+" "),this.trigger(_.default.PLAYBACK_ERROR,{evt:t,data:e},this.name);else S.default.warn("hlsjs: non-fatal error occurred, evt "+t+", data "+e+" ")},e.prototype._onTimeUpdate=function(){var t={current:this.getCurrentTime(),total:this.getDuration()};this._lastTimeUpdate&&t.current===this._lastTimeUpdate.current&&t.total===this._lastTimeUpdate.total||(this._lastTimeUpdate=t,this.trigger(_.default.PLAYBACK_TIMEUPDATE,t,this.name))},e.prototype._onDurationChange=function(){var e=this.getDuration();this._lastDuration!==e&&(this._lastDuration=e,t.prototype._onDurationChange.call(this))},e.prototype._onProgress=function(){if(this.el.buffered.length){for(var t=[],e=0,n=0;n<this.el.buffered.length;n++)t=[].concat((0,a.default)(t),[{start:Math.max(0,this.el.buffered.start(n)-this._playableRegionStartTime),end:Math.max(0,this.el.buffered.end(n)-this._playableRegionStartTime)}]),this.el.currentTime>=t[n].start&&this.el.currentTime<=t[n].end&&(e=n);var r={start:t[e].start,current:t[e].end,total:this.getDuration()};this.trigger(_.default.PLAYBACK_PROGRESS,r,t)}},e.prototype.play=function(){this._hls||this._setupHls(),t.prototype.play.call(this)},e.prototype.pause=function(){this._hls&&(t.prototype.pause.call(this),this.dvrEnabled&&this._updateDvr(!0))},e.prototype.stop=function(){this._hls&&(t.prototype.stop.call(this),this._hls.destroy(),delete this._hls)},e.prototype.destroy=function(){this._stopTimeUpdateTimer(),this._hls&&(this._hls.destroy(),delete this._hls),t.prototype.destroy.call(this)},e.prototype._updatePlaybackType=function(t,e){this._playbackType=e.details.live?E.default.LIVE:E.default.VOD,this._fillLevels(),this._onLevelUpdated(t,e),this._ccTracksUpdated&&this._playbackType===E.default.LIVE&&this.hasClosedCaptionsTracks&&this._onSubtitleLoaded()},e.prototype._fillLevels=function(){this._levels=this._hls.levels.map(function(t,e){return{id:e,level:t,label:t.bitrate/1e3+"Kbps",definition:t.definition}}),this.trigger(_.default.PLAYBACK_LEVELS_AVAILABLE,this._levels)},e.prototype._onLevelUpdated=function(t,e){this._segmentTargetDuration=e.details.targetduration,this._playlistType=e.details.type||null;var n=!1,r=!1,i=e.details.fragments,a=this._playableRegionStartTime,o=this._playableRegionDuration;if(0!==i.length){if(this._playableRegionStartTime!==i[0].start&&(n=!0,this._playableRegionStartTime=i[0].start),n)if(this._localStartTimeCorrelation){var s=this._localStartTimeCorrelation,u=this._now-s.local,l=(s.remote+u)/1e3;l<i[0].start?this._localStartTimeCorrelation={local:this._now,remote:1e3*i[0].start}:l>a+this._extrapolatedWindowDuration&&(this._localStartTimeCorrelation={local:this._now,remote:1e3*Math.max(i[0].start,a+this._extrapolatedWindowDuration)})}else this._localStartTimeCorrelation={local:this._now,remote:1e3*(i[0].start+this._extrapolatedWindowDuration/2)};var c=e.details.totalduration;if(this._playbackType===E.default.LIVE){var d=e.details.targetduration,h=this.options.playback||{},f=h.liveSyncDurationCount||v.default.DefaultConfig.liveSyncDurationCount,p=d*f;p<=c?(c-=p,this._durationExcludesAfterLiveSyncPoint=!0):this._durationExcludesAfterLiveSyncPoint=!1}c!==this._playableRegionDuration&&(r=!0,this._playableRegionDuration=c);var m=i[0].start+c,g=a+o;if(m!==g)if(this._localEndTimeCorrelation){var y=this._localEndTimeCorrelation,_=this._now-y.local,b=(y.remote+_)/1e3;b>m?this._localEndTimeCorrelation={local:this._now,remote:1e3*m}:b<m-this._extrapolatedWindowDuration?this._localEndTimeCorrelation={local:this._now,remote:1e3*(m-this._extrapolatedWindowDuration)}:b>g&&(this._localEndTimeCorrelation={local:this._now,remote:1e3*g})}else this._localEndTimeCorrelation={local:this._now,remote:1e3*m};r&&this._onDurationChange(),n&&this._onProgress()}},e.prototype._onFragmentLoaded=function(t,e){this.trigger(_.default.PLAYBACK_FRAGMENT_LOADED,e)},e.prototype._onSubtitleLoaded=function(){if(!this._ccIsSetup){this.trigger(_.default.PLAYBACK_SUBTITLE_AVAILABLE);var t=this._playbackType===E.default.LIVE?-1:this.closedCaptionsTrackId;this.closedCaptionsTrackId=t,this._ccIsSetup=!0}},e.prototype._onLevelSwitch=function(t,e){this.levels.length||this._fillLevels(),this.trigger(_.default.PLAYBACK_LEVEL_SWITCH_END),this.trigger(_.default.PLAYBACK_LEVEL_SWITCH,e);var n=this._hls.levels[e.level];n&&(this.highDefinition=n.height>=720||n.bitrate/1e3>=2e3,this.trigger(_.default.PLAYBACK_HIGHDEFINITIONUPDATE,this.highDefinition),this.trigger(_.default.PLAYBACK_BITRATE,{height:n.height,width:n.width,bandwidth:n.bitrate,bitrate:n.bitrate,level:e.level,url:n.url}))},e.prototype._onLevelSwitched=function(t,e){this._levelSwitching=!1},e.prototype.getPlaybackType=function(){return this.options.playbacktype&&"LIVE"===this.options.playbacktype?E.default.LIVE:this._playbackType},e.prototype.isSeekEnabled=function(){return this._playbackType===E.default.VOD||this.dvrEnabled},(0,d.default)(e,[{key:"dvrEnabled",get:function(){return this._durationExcludesAfterLiveSyncPoint&&this._duration>=this._minDvrSize&&this.getPlaybackType()===E.default.LIVE}}]),e}(m.default);e.default=T,T.canPlay=function(t,e){var n=t.split("?")[0].match(/.*\.(.*)$/)||[],r=n.length>1&&"m3u8"===n[1].toLowerCase()||"application/x-mpegURL"===e||"application/vnd.apple.mpegurl"===e;return!(!v.default.isSupported()||!r)},t.exports=e["default"]},function(t,e,n){"undefined"!=typeof window&&function(e,n){t.exports=n()}(0,function(){return function(t){function e(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,e),i.l=!0,i.exports}var n={};return e.m=t,e.c=n,e.d=function(t,n,r){e.o(t,n)||Object.defineProperty(t,n,{enumerable:!0,get:r})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,n){if(1&n&&(t=e(t)),8&n)return t;if(4&n&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(e.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&n&&"string"!=typeof t)for(var i in t)e.d(r,i,function(e){return t[e]}.bind(null,i));return r},e.n=function(t){var n=t&&t.__esModule?function(){return t["default"]}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="/dist/",e(e.s="./src/hls.js")}({"./node_modules/eventemitter3/index.js":function(t,e,n){"use strict";function r(){}function i(t,e,n){this.fn=t,this.context=e,this.once=n||!1}function a(t,e,n,r,a){if("function"!=typeof n)throw new TypeError("The listener must be a function");var o=new i(n,r||t,a),s=l?l+e:e;return t._events[s]?t._events[s].fn?t._events[s]=[t._events[s],o]:t._events[s].push(o):(t._events[s]=o,t._eventsCount++),t}function o(t,e){0==--t._eventsCount?t._events=new r:delete t._events[e]}function s(){this._events=new r,this._eventsCount=0}var u=Object.prototype.hasOwnProperty,l="~";Object.create&&(r.prototype=Object.create(null),(new r).__proto__||(l=!1)),s.prototype.eventNames=function(){var t,e,n=[];if(0===this._eventsCount)return n;for(e in t=this._events)u.call(t,e)&&n.push(l?e.slice(1):e);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(t)):n},s.prototype.listeners=function(t){var e=l?l+t:t,n=this._events[e];if(!n)return[];if(n.fn)return[n.fn];for(var r=0,i=n.length,a=new Array(i);r<i;r++)a[r]=n[r].fn;return a},s.prototype.listenerCount=function(t){var e=l?l+t:t,n=this._events[e];return n?n.fn?1:n.length:0},s.prototype.emit=function(t,e,n,r,i,a){var o=l?l+t:t;if(!this._events[o])return!1;var s,u,c=this._events[o],d=arguments.length;if(c.fn){switch(c.once&&this.removeListener(t,c.fn,void 0,!0),d){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,e),!0;case 3:return c.fn.call(c.context,e,n),!0;case 4:return c.fn.call(c.context,e,n,r),!0;case 5:return c.fn.call(c.context,e,n,r,i),!0;case 6:return c.fn.call(c.context,e,n,r,i,a),!0}for(u=1,s=new Array(d-1);u<d;u++)s[u-1]=arguments[u];c.fn.apply(c.context,s)}else{var h,f=c.length;for(u=0;u<f;u++)switch(c[u].once&&this.removeListener(t,c[u].fn,void 0,!0),d){case 1:c[u].fn.call(c[u].context);break;case 2:c[u].fn.call(c[u].context,e);break;case 3:c[u].fn.call(c[u].context,e,n);break;case 4:c[u].fn.call(c[u].context,e,n,r);break;default:if(!s)for(h=1,s=new Array(d-1);h<d;h++)s[h-1]=arguments[h];c[u].fn.apply(c[u].context,s)}}return!0},s.prototype.on=function(t,e,n){return a(this,t,e,n,!1)},s.prototype.once=function(t,e,n){return a(this,t,e,n,!0)},s.prototype.removeListener=function(t,e,n,r){var i=l?l+t:t;if(!this._events[i])return this;if(!e)return o(this,i),this;var a=this._events[i];if(a.fn)a.fn!==e||r&&!a.once||n&&a.context!==n||o(this,i);else{for(var s=0,u=[],c=a.length;s<c;s++)(a[s].fn!==e||r&&!a[s].once||n&&a[s].context!==n)&&u.push(a[s]);u.length?this._events[i]=1===u.length?u[0]:u:o(this,i)}return this},s.prototype.removeAllListeners=function(t){var e;return t?(e=l?l+t:t,this._events[e]&&o(this,e)):(this._events=new r,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=l,s.EventEmitter=s,t.exports=s},"./node_modules/events/events.js":function(t,e,n){"use strict";(function(e){function n(t){console&&console.warn&&console.warn(t)}function r(){r.init.call(this)}function i(t){return void 0===t._maxListeners?r.defaultMaxListeners:t._maxListeners}function a(t,e,r,a){var o,s,u;if("function"!=typeof r)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof r);if(s=t._events,void 0===s?(s=t._events=Object.create(null),t._eventsCount=0):(void 0!==s.newListener&&(t.emit("newListener",e,r.listener?r.listener:r),s=t._events),u=s[e]),void 0===u)u=s[e]=r,++t._eventsCount;else if("function"==typeof u?u=s[e]=a?[r,u]:[u,r]:a?u.unshift(r):u.push(r),(o=i(t))>0&&u.length>o&&!u.warned){u.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+u.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");l.name="MaxListenersExceededWarning",l.emitter=t,l.type=e,l.count=u.length,n(l)}return t}function o(){for(var t=[],e=0;e<arguments.length;e++)t.push(arguments[e]);this.fired||(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,m(this.listener,this.target,t))}function s(t,e,n){var r={fired:!1,wrapFn:void 0,target:t,type:e,listener:n},i=o.bind(r);return i.listener=n,r.wrapFn=i,i}function u(t,e,n){var r=t._events;if(void 0===r)return[];var i=r[e];return void 0===i?[]:"function"==typeof i?n?[i.listener||i]:[i]:n?h(i):c(i,i.length)}function l(t){var e=this._events;if(void 0!==e){var n=e[t];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function c(t,e){for(var n=new Array(e),r=0;r<e;++r)n[r]=t[r];return n}function d(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}function h(t){for(var e=new Array(t.length),n=0;n<e.length;++n)e[n]=t[n].listener||t[n];return e}var f,p="object"==typeof Reflect?Reflect:null,m=p&&"function"==typeof p.apply?p.apply:function(t,e,n){return Function.prototype.apply.call(t,e,n)};f=p&&"function"==typeof p.ownKeys?p.ownKeys:Object.getOwnPropertySymbols?function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:function(t){return Object.getOwnPropertyNames(t)};var g=e.isNaN||function(t){return t!==t};t.exports=r,r.EventEmitter=r,r.prototype._events=void 0,r.prototype._eventsCount=0,r.prototype._maxListeners=void 0;var v=10;Object.defineProperty(r,"defaultMaxListeners",{enumerable:!0,get:function(){return v},set:function(t){if("number"!=typeof t||t<0||g(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");v=t}}),r.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},r.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||g(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this},r.prototype.getMaxListeners=function(){return i(this)},r.prototype.emit=function(t){for(var e=[],n=1;n<arguments.length;n++)e.push(arguments[n]);var r="error"===t,i=this._events;if(void 0!==i)r=r&&void 0===i.error;else if(!r)return!1;if(r){var a;if(e.length>0&&(a=e[0]),a instanceof Error)throw a;var o=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw o.context=a,o}var s=i[t];if(void 0===s)return!1;if("function"==typeof s)m(s,this,e);else for(var u=s.length,l=c(s,u),n=0;n<u;++n)m(l[n],this,e);return!0},r.prototype.addListener=function(t,e){return a(this,t,e,!1)},r.prototype.on=r.prototype.addListener,r.prototype.prependListener=function(t,e){return a(this,t,e,!0)},r.prototype.once=function(t,e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e);return this.on(t,s(this,t,e)),this},r.prototype.prependOnceListener=function(t,e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e);return this.prependListener(t,s(this,t,e)),this},r.prototype.removeListener=function(t,e){var n,r,i,a,o;if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e);if(void 0===(r=this._events))return this;if(void 0===(n=r[t]))return this;if(n===e||n.listener===e)0==--this._eventsCount?this._events=Object.create(null):(delete r[t],r.removeListener&&this.emit("removeListener",t,n.listener||e));else if("function"!=typeof n){for(i=-1,a=n.length-1;a>=0;a--)if(n[a]===e||n[a].listener===e){o=n[a].listener,i=a;break}if(i<0)return this;0===i?n.shift():d(n,i),1===n.length&&(r[t]=n[0]),void 0!==r.removeListener&&this.emit("removeListener",t,o||e)}return this},r.prototype.off=r.prototype.removeListener,r.prototype.removeAllListeners=function(t){var e,n,r;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[t]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[t]),this;if(0===arguments.length){var i,a=Object.keys(n);for(r=0;r<a.length;++r)"removeListener"!==(i=a[r])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(e=n[t]))this.removeListener(t,e);else if(void 0!==e)for(r=e.length-1;r>=0;r--)this.removeListener(t,e[r]);return this},r.prototype.listeners=function(t){return u(this,t,!0)},r.prototype.rawListeners=function(t){return u(this,t,!1)},r.listenerCount=function(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):l.call(t,e)},r.prototype.listenerCount=l,r.prototype.eventNames=function(){return this._eventsCount>0?f(this._events):[]}}).call(this,n("./src/polyfills/number.js")["Number"])},"./node_modules/url-toolkit/src/url-toolkit.js":function(t,e,n){!function(e){var n=/^((?:[a-zA-Z0-9+\-.]+:)?)(\/\/[^\/?#]*)?((?:[^\/\?#]*\/)*.*?)??(;.*?)?(\?.*?)?(#.*?)?$/,r=/^([^\/?#]*)(.*)$/,i=/(?:\/|^)\.(?=\/)/g,a=/(?:\/|^)\.\.\/(?!\.\.\/).*?(?=\/)/g,o={buildAbsoluteURL:function(t,e,n){if(n=n||{},t=t.trim(),!(e=e.trim())){if(!n.alwaysNormalize)return t;var i=o.parseURL(t);if(!i)throw new Error("Error trying to parse base URL.");return i.path=o.normalizePath(i.path),o.buildURLFromParts(i)}var a=o.parseURL(e);if(!a)throw new Error("Error trying to parse relative URL.");if(a.scheme)return n.alwaysNormalize?(a.path=o.normalizePath(a.path),o.buildURLFromParts(a)):e;var s=o.parseURL(t);if(!s)throw new Error("Error trying to parse base URL.");if(!s.netLoc&&s.path&&"/"!==s.path[0]){var u=r.exec(s.path);s.netLoc=u[1],s.path=u[2]}s.netLoc&&!s.path&&(s.path="/");var l={scheme:s.scheme,netLoc:a.netLoc,path:null,params:a.params,query:a.query,fragment:a.fragment};if(!a.netLoc&&(l.netLoc=s.netLoc,"/"!==a.path[0]))if(a.path){var c=s.path,d=c.substring(0,c.lastIndexOf("/")+1)+a.path;l.path=o.normalizePath(d)}else l.path=s.path,a.params||(l.params=s.params,a.query||(l.query=s.query));return null===l.path&&(l.path=n.alwaysNormalize?o.normalizePath(a.path):a.path),o.buildURLFromParts(l)},parseURL:function(t){var e=n.exec(t);return e?{scheme:e[1]||"",netLoc:e[2]||"",path:e[3]||"",params:e[4]||"",query:e[5]||"",fragment:e[6]||""}:null},normalizePath:function(t){for(t=t.split("").reverse().join("").replace(i,"");t.length!==(t=t.replace(a,"")).length;);return t.split("").reverse().join("")},buildURLFromParts:function(t){return t.scheme+t.netLoc+t.path+t.params+t.query+t.fragment}};t.exports=o}()},"./node_modules/webworkify-webpack/index.js":function(t,e,n){function r(t){function e(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,e),i.l=!0,i.exports}var n={};e.m=t,e.c=n,e.i=function(t){return t},e.d=function(t,n,r){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:r})},e.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},e.n=function(t){var n=t&&t.__esModule?function(){return t["default"]}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="/",e.oe=function(t){throw console.error(t),t};var r=e(e.s=ENTRY_MODULE);return r.default||r}function i(t){return(t+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function a(t){return!isNaN(1*t)}function o(t,e,r){var o={};o[r]=[];var s=e.toString(),u=s.match(/^function\s?\(\w+,\s*\w+,\s*(\w+)\)/);if(!u)return o;for(var d,h=u[1],f=new RegExp("(\\\\n|\\W)"+i(h)+c,"g");d=f.exec(s);)"dll-reference"!==d[3]&&o[r].push(d[3]);for(f=new RegExp("\\("+i(h)+'\\("(dll-reference\\s('+l+'))"\\)\\)'+c,"g");d=f.exec(s);)t[d[2]]||(o[r].push(d[1]),t[d[2]]=n(d[1]).m),o[d[2]]=o[d[2]]||[],o[d[2]].push(d[4]);for(var p=Object.keys(o),m=0;m<p.length;m++)for(var g=0;g<o[p[m]].length;g++)a(o[p[m]][g])&&(o[p[m]][g]=1*o[p[m]][g]);return o}function s(t){return Object.keys(t).reduce(function(e,n){return e||t[n].length>0},!1)}function u(t,e){for(var n={main:[e]},r={main:[]},i={main:{}};s(n);)for(var a=Object.keys(n),u=0;u<a.length;u++){var l=a[u],c=n[l],d=c.pop();if(i[l]=i[l]||{},!i[l][d]&&t[l][d]){i[l][d]=!0,r[l]=r[l]||[],r[l].push(d);for(var h=o(t,t[l][d],l),f=Object.keys(h),p=0;p<f.length;p++)n[f[p]]=n[f[p]]||[],n[f[p]]=n[f[p]].concat(h[f[p]])}}return r}var l="[\\.|\\-|\\+|\\w|/|@]+",c="\\((/\\*.*?\\*/)?s?.*?("+l+").*?\\)";t.exports=function(t,e){e=e||{};var i={main:n.m},a=e.all?{main:Object.keys(i.main)}:u(i,t),o="";Object.keys(a).filter(function(t){return"main"!==t}).forEach(function(t){for(var e=0;a[t][e];)e++;a[t].push(e),i[t][e]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",o=o+"var "+t+" = ("+r.toString().replace("ENTRY_MODULE",JSON.stringify(e))+")({"+a[t].map(function(e){return JSON.stringify(e)+": "+i[t][e].toString()}).join(",")+"});\n"}),o=o+"new (("+r.toString().replace("ENTRY_MODULE",JSON.stringify(t))+")({"+a.main.map(function(t){return JSON.stringify(t)+": "+i.main[t].toString()}).join(",")+"}))(self);";var s=new window.Blob([o],{type:"text/javascript"});if(e.bare)return s;var l=window.URL||window.webkitURL||window.mozURL||window.msURL,c=l.createObjectURL(s),d=new window.Worker(c);return d.objectURL=c,d}},"./src/config.js":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n("./src/controller/abr-controller.js"),i=n("./src/controller/buffer-controller.js"),a=n("./src/controller/cap-level-controller.js"),o=n("./src/controller/fps-controller.js"),s=n("./src/utils/xhr-loader.js"),u=n("./src/controller/audio-track-controller.js"),l=n("./src/controller/audio-stream-controller.js"),c=n("./src/utils/cues.js"),d=n("./src/controller/timeline-controller.js"),h=n("./src/controller/subtitle-track-controller.js"),f=n("./src/controller/subtitle-stream-controller.js"),p=n("./src/controller/eme-controller.js"),m=n("./src/utils/mediakeys-helper.js");e.hlsDefaultConfig={autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,initialLiveManifestSize:1,maxBufferLength:30,maxBufferSize:6e7,maxBufferHole:.5,lowBufferWatchdogPeriod:.5,highBufferWatchdogPeriod:3,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,liveDurationInfinity:!1,liveBackBufferLength:1/0,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:s.default,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,abrController:r.default,bufferController:i.default,capLevelController:a.default,fpsController:o.default,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,requestMediaKeySystemAccessFunc:m.requestMediaKeySystemAccess,mirrorServer:void 0},e.hlsDefaultConfig.subtitleStreamController=f.SubtitleStreamController,e.hlsDefaultConfig.subtitleTrackController=h.default,e.hlsDefaultConfig.timelineController=d.default,e.hlsDefaultConfig.cueHandler=c,e.hlsDefaultConfig.enableCEA708Captions=!0,e.hlsDefaultConfig.enableWebVTT=!0,e.hlsDefaultConfig.captionsTextTrack1Label="English",e.hlsDefaultConfig.captionsTextTrack1LanguageCode="en",e.hlsDefaultConfig.captionsTextTrack2Label="Spanish",e.hlsDefaultConfig.captionsTextTrack2LanguageCode="es",e.hlsDefaultConfig.audioStreamController=l.default,e.hlsDefaultConfig.audioTrackController=u.default,e.hlsDefaultConfig.emeController=p.default},"./src/controller/abr-controller.js":function(t,e,n){"use strict";(function(t){var r=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var i=n("./src/events.js"),a=n("./src/event-handler.js"),o=n("./src/utils/buffer-helper.js"),s=n("./src/errors.js"),u=n("./src/utils/logger.js"),l=n("./src/utils/ewma-bandwidth-estimator.js"),c=window.performance,d=function(e){function n(t){var n=e.call(this,t,i.default.FRAG_LOADING,i.default.FRAG_LOADED,i.default.FRAG_BUFFERED,i.default.ERROR)||this;return n.lastLoadedFragLevel=0,n._nextAutoLevel=-1,n.hls=t,n.timer=null,n._bwEstimator=null,n.onCheck=n._abandonRulesCheck.bind(n),n}return r(n,e),n.prototype.destroy=function(){this.clearTimer(),a.default.prototype.destroy.call(this)},n.prototype.onFragLoading=function(t){var e=t.frag;if("main"===e.type&&(this.timer||(this.fragCurrent=e,this.timer=setInterval(this.onCheck,100)),!this._bwEstimator)){var n=this.hls,r=n.config,i=e.level,a=n.levels[i].details.live,o=void 0,s=void 0;a?(o=r.abrEwmaFastLive,s=r.abrEwmaSlowLive):(o=r.abrEwmaFastVoD,s=r.abrEwmaSlowVoD),this._bwEstimator=new l.default(n,s,o,r.abrEwmaDefaultEstimate)}},n.prototype._abandonRulesCheck=function(){var t=this.hls,e=t.media,n=this.fragCurrent;if(n){var r=n.loader,a=t.minAutoLevel;if(!r||r.stats&&r.stats.aborted)return u.logger.warn("frag loader destroy or aborted, disarm abandonRules"),this.clearTimer(),void(this._nextAutoLevel=-1);var s=r.stats;if(e&&s&&(!e.paused&&0!==e.playbackRate||!e.readyState)&&n.autoLevel&&n.level){var l=c.now()-s.trequest,d=Math.abs(e.playbackRate);if(l>500*n.duration/d){var h=t.levels,f=Math.max(1,s.bw?s.bw/8:1e3*s.loaded/l),p=h[n.level],m=p.realBitrate?Math.max(p.realBitrate,p.bitrate):p.bitrate,g=s.total?s.total:Math.max(s.loaded,Math.round(n.duration*m/8)),v=e.currentTime,y=(g-s.loaded)/f,_=(o.BufferHelper.bufferInfo(e,v,t.config.maxBufferHole).end-v)/d;if(_<2*n.duration/d&&y>_){var b=void 0,E=void 0;for(E=n.level-1;E>a;E--){var w=h[E].realBitrate?Math.max(h[E].realBitrate,h[E].bitrate):h[E].bitrate;if((b=n.duration*w/(6.4*f))<_)break}b<y&&(u.logger.warn("loading too slow, abort fragment loading and switch to level "+E+":fragLoadedDelay["+E+"]<fragLoadedDelay["+(n.level-1)+"];bufferStarvationDelay:"+b.toFixed(1)+"<"+y.toFixed(1)+":"+_.toFixed(1)),t.nextLoadLevel=E,this._bwEstimator.sample(l,s.loaded),r.abort(),this.clearTimer(),t.trigger(i.default.FRAG_LOAD_EMERGENCY_ABORTED,{frag:n,stats:s}))}}}}},n.prototype.onFragLoaded=function(e){var n=e.frag;if("main"===n.type&&t.isFinite(n.sn)){if(this.clearTimer(),this.lastLoadedFragLevel=n.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var r=this.hls.levels[n.level],i=(r.loaded?r.loaded.bytes:0)+e.stats.loaded,a=(r.loaded?r.loaded.duration:0)+e.frag.duration;r.loaded={bytes:i,duration:a},r.realBitrate=Math.round(8*i/a)}if(e.frag.bitrateTest){var o=e.stats;o.tparsed=o.tbuffered=o.tload,this.onFragBuffered(e)}}},n.prototype.onFragBuffered=function(e){var n=e.stats,r=e.frag;if(!0!==n.aborted&&"main"===r.type&&t.isFinite(r.sn)&&(!r.bitrateTest||n.tload===n.tbuffered)){var i=n.tparsed-n.trequest;u.logger.log("latency/loading/parsing/append/kbps:"+Math.round(n.tfirst-n.trequest)+"/"+Math.round(n.tload-n.tfirst)+"/"+Math.round(n.tparsed-n.tload)+"/"+Math.round(n.tbuffered-n.tparsed)+"/"+Math.round(8*n.loaded/(n.tbuffered-n.trequest))),this._bwEstimator.sample(i,n.loaded),n.bwEstimate=this._bwEstimator.getEstimate(),r.bitrateTest?this.bitrateTestDelay=i/1e3:this.bitrateTestDelay=0}},n.prototype.onError=function(t){switch(t.details){case s.ErrorDetails.FRAG_LOAD_ERROR:case s.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer()}},n.prototype.clearTimer=function(){clearInterval(this.timer),this.timer=null},Object.defineProperty(n.prototype,"nextAutoLevel",{get:function(){var t=this._nextAutoLevel,e=this._bwEstimator;if(!(-1===t||e&&e.canEstimate()))return t;var n=this._nextABRAutoLevel;return-1!==t&&(n=Math.min(t,n)),n},set:function(t){this._nextAutoLevel=t},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"_nextABRAutoLevel",{get:function(){var t=this.hls,e=t.maxAutoLevel,n=t.levels,r=t.config,i=t.minAutoLevel,a=t.media,s=this.lastLoadedFragLevel,l=this.fragCurrent?this.fragCurrent.duration:0,c=a?a.currentTime:0,d=a&&0!==a.playbackRate?Math.abs(a.playbackRate):1,h=this._bwEstimator?this._bwEstimator.getEstimate():r.abrEwmaDefaultEstimate,f=(o.BufferHelper.bufferInfo(a,c,r.maxBufferHole).end-c)/d,p=this._findBestLevel(s,l,h,i,e,f,r.abrBandWidthFactor,r.abrBandWidthUpFactor,n);if(p>=0)return p;u.logger.trace("rebuffering expected to happen, lets try to find a quality level minimizing the rebuffering");var m=l?Math.min(l,r.maxStarvationDelay):r.maxStarvationDelay,g=r.abrBandWidthFactor,v=r.abrBandWidthUpFactor;if(0===f){var y=this.bitrateTestDelay;if(y){m=(l?Math.min(l,r.maxLoadingDelay):r.maxLoadingDelay)-y,u.logger.trace("bitrate test took "+Math.round(1e3*y)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*m)+" ms"),g=v=1}}return p=this._findBestLevel(s,l,h,i,e,f+m,g,v,n),Math.max(p,0)},enumerable:!0,configurable:!0}),n.prototype._findBestLevel=function(t,e,n,r,i,a,o,s,l){for(var c=i;c>=r;c--){var d=l[c];if(d){var h=d.details,f=h?h.totalduration/h.fragments.length:e,p=!!h&&h.live,m=void 0;m=c<=t?o*n:s*n;var g=l[c].realBitrate?Math.max(l[c].realBitrate,l[c].bitrate):l[c].bitrate,v=g*f/m;if(u.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+c+"/"+Math.round(m)+"/"+g+"/"+f+"/"+a+"/"+v),m>g&&(!v||p&&!this.bitrateTestDelay||v<a))return c}}return-1},n}(a.default);e.default=d}).call(this,n("./src/polyfills/number.js")["Number"])},"./src/controller/audio-stream-controller.js":function(t,e,n){"use strict";(function(t){var r=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var i=n("./src/utils/binary-search.js"),a=n("./src/utils/buffer-helper.js"),o=n("./src/demux/demuxer.js"),s=n("./src/events.js"),u=n("./src/controller/level-helper.js"),l=n("./src/utils/time-ranges.js"),c=n("./src/errors.js"),d=n("./src/utils/logger.js"),h=n("./src/utils/discontinuities.js"),f=n("./src/controller/fragment-tracker.js"),p=n("./src/loader/fragment.js"),m=n("./src/controller/base-stream-controller.js"),g=window.performance,v=function(e){function n(t,n){var r=e.call(this,t,s.default.MEDIA_ATTACHED,s.default.MEDIA_DETACHING,s.default.AUDIO_TRACKS_UPDATED,s.default.AUDIO_TRACK_SWITCHING,s.default.AUDIO_TRACK_LOADED,s.default.KEY_LOADED,s.default.FRAG_LOADED,s.default.FRAG_PARSING_INIT_SEGMENT,s.default.FRAG_PARSING_DATA,s.default.FRAG_PARSED,s.default.ERROR,s.default.BUFFER_RESET,s.default.BUFFER_CREATED,s.default.BUFFER_APPENDED,s.default.BUFFER_FLUSHED,s.default.INIT_PTS_FOUND)||this;return r.fragmentTracker=n,r.config=t.config,r.audioCodecSwap=!1,r._state=m.State.STOPPED,r.initPTS=[],r.waitingFragment=null,r.videoTrackCC=null,r}return r(n,e),n.prototype.onHandlerDestroying=function(){this.stopLoad(),e.prototype.onHandlerDestroying.call(this)},n.prototype.onHandlerDestroyed=function(){this.state=m.State.STOPPED,this.fragmentTracker=null,e.prototype.onHandlerDestroyed.call(this)},n.prototype.onInitPtsFound=function(t){var e=t.id,n=t.frag.cc,r=t.initPTS;"main"===e&&(this.initPTS[n]=r,this.videoTrackCC=n,d.logger.log("InitPTS for cc: "+n+" found from video track: "+r),this.state===m.State.WAITING_INIT_PTS&&this.tick())},n.prototype.startLoad=function(t){if(this.tracks){var e=this.lastCurrentTime;this.stopLoad(),this.setInterval(100),this.fragLoadError=0,e>0&&-1===t?(d.logger.log("audio:override startPosition with lastCurrentTime @"+e.toFixed(3)),this.state=m.State.IDLE):(this.lastCurrentTime=this.startPosition?this.startPosition:t,this.state=m.State.STARTING),this.nextLoadPosition=this.startPosition=this.lastCurrentTime,this.tick()}else this.startPosition=t,this.state=m.State.STOPPED},n.prototype.stopLoad=function(){var t=this.fragCurrent;t&&(t.loader&&t.loader.abort(),this.fragmentTracker.removeFragment(t),this.fragCurrent=null),this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=m.State.STOPPED},Object.defineProperty(n.prototype,"state",{get:function(){return this._state},set:function(t){if(this.state!==t){var e=this.state;this._state=t,d.logger.log("audio stream:"+e+"->"+t)}},enumerable:!0,configurable:!0}),n.prototype.doTick=function(){var e,n,r,o=this.hls,u=o.config;switch(this.state){case m.State.ERROR:case m.State.PAUSED:case m.State.BUFFER_FLUSHING:break;case m.State.STARTING:this.state=m.State.WAITING_TRACK,this.loadedmetadata=!1;break;case m.State.IDLE:var l=this.tracks;if(!l)break;if(!this.media&&(this.startFragRequested||!u.startFragPrefetch))break;if(this.loadedmetadata)e=this.media.currentTime;else if(void 0===(e=this.nextLoadPosition))break;var c=this.mediaBuffer?this.mediaBuffer:this.media,p=this.videoBuffer?this.videoBuffer:this.media,v=a.BufferHelper.bufferInfo(c,e,u.maxBufferHole),y=a.BufferHelper.bufferInfo(p,e,u.maxBufferHole),_=v.len,b=v.end,E=this.fragPrevious,w=Math.min(u.maxBufferLength,u.maxMaxBufferLength),A=Math.max(w,y.len),S=this.audioSwitch,T=this.trackId;if((_<A||S)&&T<l.length){if(void 0===(r=l[T].details)){this.state=m.State.WAITING_TRACK;break}if(!S&&this._streamEnded(v,r))return this.hls.trigger(s.default.BUFFER_EOS,{type:"audio"}),void(this.state=m.State.ENDED);var x=r.fragments,k=x.length,C=x[0].start,M=x[k-1].start+x[k-1].duration,R=void 0;if(S)if(r.live&&!r.PTSKnown)d.logger.log("switching audiotrack, live stream, unknown PTS,load first fragment"),b=0;else if(b=e,r.PTSKnown&&e<C){if(!(v.end>C||v.nextStart))return;d.logger.log("alt audio track ahead of main track, seek to start of alt audio track"),this.media.currentTime=C+.05}if(r.initSegment&&!r.initSegment.data)R=r.initSegment;else if(b<=C){if(R=x[0],null!==this.videoTrackCC&&R.cc!==this.videoTrackCC&&(R=h.findFragWithCC(x,this.videoTrackCC)),r.live&&R.loadIdx&&R.loadIdx===this.fragLoadIdx){var L=v.nextStart?v.nextStart:C;return d.logger.log("no alt audio available @currentTime:"+this.media.currentTime+", seeking @"+(L+.05)),void(this.media.currentTime=L+.05)}}else{var I=void 0,P=u.maxFragLookUpTolerance,O=E?x[E.sn-x[0].sn+1]:void 0,D=function(t){var e=Math.min(P,t.duration);return t.start+t.duration-e<=b?1:t.start-e>b&&t.start?-1:0};b<M?(b>M-P&&(P=0),I=O&&!D(O)?O:i.default.search(x,D)):I=x[k-1],I&&(R=I,C=I.start,E&&R.level===E.level&&R.sn===E.sn&&(R.sn<r.endSN?(R=x[R.sn+1-r.startSN],d.logger.log("SN just loaded, load next one: "+R.sn)):R=null))}R&&(R.encrypted?(d.logger.log("Loading key for "+R.sn+" of ["+r.startSN+" ,"+r.endSN+"],track "+T),this.state=m.State.KEY_LOADING,o.trigger(s.default.KEY_LOADING,{frag:R})):(d.logger.log("Loading "+R.sn+", cc: "+R.cc+" of ["+r.startSN+" ,"+r.endSN+"],track "+T+", currentTime:"+e+",bufferEnd:"+b.toFixed(3)),this.fragCurrent=R,(S||this.fragmentTracker.getState(R)===f.FragmentState.NOT_LOADED)&&(this.startFragRequested=!0,t.isFinite(R.sn)&&(this.nextLoadPosition=R.start+R.duration),o.trigger(s.default.FRAG_LOADING,{frag:R}),this.state=m.State.FRAG_LOADING)))}break;case m.State.WAITING_TRACK:n=this.tracks[this.trackId],n&&n.details&&(this.state=m.State.IDLE);break;case m.State.FRAG_LOADING_WAITING_RETRY:var N=g.now(),U=this.retryDate;c=this.media;var F=c&&c.seeking;(!U||N>=U||F)&&(d.logger.log("audioStreamController: retryDate reached, switch back to IDLE state"),this.state=m.State.IDLE);break;case m.State.WAITING_INIT_PTS:var B=this.videoTrackCC;if(void 0===this.initPTS[B])break;var j=this.waitingFragment;if(j){var V=j.frag.cc;B!==V?(n=this.tracks[this.trackId],n.details&&n.details.live&&(d.logger.warn("Waiting fragment CC ("+V+") does not match video track CC ("+B+")"),this.waitingFragment=null,this.state=m.State.IDLE)):(this.state=m.State.FRAG_LOADING,this.onFragLoaded(this.waitingFragment),this.waitingFragment=null)}else this.state=m.State.IDLE;break;case m.State.STOPPED:case m.State.FRAG_LOADING:case m.State.PARSING:case m.State.PARSED:case m.State.ENDED:}},n.prototype.onMediaAttached=function(t){var e=this.media=this.mediaBuffer=t.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),e.addEventListener("seeking",this.onvseeking),e.addEventListener("ended",this.onvended);var n=this.config;this.tracks&&n.autoStartLoad&&this.startLoad(n.startPosition)},n.prototype.onMediaDetaching=function(){var t=this.media;t&&t.ended&&(d.logger.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),t&&(t.removeEventListener("seeking",this.onvseeking),t.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.media=this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1,this.stopLoad()},n.prototype.onAudioTracksUpdated=function(t){d.logger.log("audio tracks updated"),this.tracks=t.audioTracks},n.prototype.onAudioTrackSwitching=function(t){var e=!!t.url;this.trackId=t.id,this.fragCurrent=null,this.state=m.State.PAUSED,this.waitingFragment=null,e?this.setInterval(100):this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),e&&(this.audioSwitch=!0,this.state=m.State.IDLE),this.tick()},n.prototype.onAudioTrackLoaded=function(e){var n=e.details,r=e.id,i=this.tracks[r],a=n.totalduration,o=0;if(d.logger.log("track "+r+" loaded ["+n.startSN+","+n.endSN+"],duration:"+a),n.live){var s=i.details;s&&n.fragments.length>0?(u.mergeDetails(s,n),o=n.fragments[0].start,n.PTSKnown?d.logger.log("live audio playlist sliding:"+o.toFixed(3)):d.logger.log("live audio playlist - outdated PTS, unknown sliding")):(n.PTSKnown=!1,d.logger.log("live audio playlist - first load, unknown sliding"))}else n.PTSKnown=!1;if(i.details=n,!this.startFragRequested){if(-1===this.startPosition){var l=n.startTimeOffset;t.isFinite(l)?(d.logger.log("start time offset found in playlist, adjust startPosition to "+l),this.startPosition=l):this.startPosition=0}this.nextLoadPosition=this.startPosition}this.state===m.State.WAITING_TRACK&&(this.state=m.State.IDLE),this.tick()},n.prototype.onKeyLoaded=function(){this.state===m.State.KEY_LOADING&&(this.state=m.State.IDLE,this.tick())},n.prototype.onFragLoaded=function(t){var e=this.fragCurrent,n=t.frag;if(this.state===m.State.FRAG_LOADING&&e&&"audio"===n.type&&n.level===e.level&&n.sn===e.sn){var r=this.tracks[this.trackId],i=r.details,a=i.totalduration,u=e.level,l=e.sn,c=e.cc,h=this.config.defaultAudioCodec||r.audioCodec||"mp4a.40.2",f=this.stats=t.stats;if("initSegment"===l)this.state=m.State.IDLE,f.tparsed=f.tbuffered=g.now(),i.initSegment.data=t.payload,this.hls.trigger(s.default.FRAG_BUFFERED,{stats:f,frag:e,id:"audio"}),this.tick();else{this.state=m.State.PARSING,this.appended=!1,this.demuxer||(this.demuxer=new o.default(this.hls,"audio"));var p=this.initPTS[c],v=i.initSegment?i.initSegment.data:[];if(i.initSegment||void 0!==p){this.pendingBuffering=!0,d.logger.log("Demuxing "+l+" of ["+i.startSN+" ,"+i.endSN+"],track "+u);this.demuxer.push(t.payload,v,h,null,e,a,!1,p)}else d.logger.log("unknown video PTS for continuity counter "+c+", waiting for video PTS before demuxing audio frag "+l+" of ["+i.startSN+" ,"+i.endSN+"],track "+u),this.waitingFragment=t,this.state=m.State.WAITING_INIT_PTS}}this.fragLoadError=0},n.prototype.onFragParsingInitSegment=function(t){var e=this.fragCurrent,n=t.frag;if(e&&"audio"===t.id&&n.sn===e.sn&&n.level===e.level&&this.state===m.State.PARSING){var r=t.tracks,i=void 0;if(r.video&&delete r.video,i=r.audio){i.levelCodec=i.codec,i.id=t.id,this.hls.trigger(s.default.BUFFER_CODECS,r),d.logger.log("audio track:audio,container:"+i.container+",codecs[level/parsed]=["+i.levelCodec+"/"+i.codec+"]");var a=i.initSegment;if(a){var o={type:"audio",data:a,parent:"audio",content:"initSegment"};this.audioSwitch?this.pendingData=[o]:(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(s.default.BUFFER_APPENDING,o))}this.tick()}}},n.prototype.onFragParsingData=function(e){var n=this,r=this.fragCurrent,i=e.frag;if(r&&"audio"===e.id&&"audio"===e.type&&i.sn===r.sn&&i.level===r.level&&this.state===m.State.PARSING){var a=this.trackId,o=this.tracks[a],l=this.hls;t.isFinite(e.endPTS)||(e.endPTS=e.startPTS+r.duration,e.endDTS=e.startDTS+r.duration),r.addElementaryStream(p.default.ElementaryStreamTypes.AUDIO),d.logger.log("parsed "+e.type+",PTS:["+e.startPTS.toFixed(3)+","+e.endPTS.toFixed(3)+"],DTS:["+e.startDTS.toFixed(3)+"/"+e.endDTS.toFixed(3)+"],nb:"+e.nb),u.updateFragPTSDTS(o.details,r,e.startPTS,e.endPTS);var h=this.audioSwitch,f=this.media,g=!1;if(h&&f)if(f.readyState){var v=f.currentTime;d.logger.log("switching audio track : currentTime:"+v),v>=e.startPTS&&(d.logger.log("switching audio track : flushing all audio"),this.state=m.State.BUFFER_FLUSHING,l.trigger(s.default.BUFFER_FLUSHING,{startOffset:0,endOffset:t.POSITIVE_INFINITY,type:"audio"}),g=!0,this.audioSwitch=!1,l.trigger(s.default.AUDIO_TRACK_SWITCHED,{id:a}))}else this.audioSwitch=!1,l.trigger(s.default.AUDIO_TRACK_SWITCHED,{id:a});var y=this.pendingData;if(!y)return d.logger.warn("Apparently attempt to enqueue media payload without codec initialization data upfront"),void l.trigger(s.default.ERROR,{type:c.ErrorTypes.MEDIA_ERROR,details:null,fatal:!0});this.audioSwitch||([e.data1,e.data2].forEach(function(t){t&&t.length&&y.push({type:e.type,data:t,parent:"audio",content:"data"})}),!g&&y.length&&(y.forEach(function(t){n.state===m.State.PARSING&&(n.pendingBuffering=!0,n.hls.trigger(s.default.BUFFER_APPENDING,t))}),this.pendingData=[],this.appended=!0)),this.tick()}},n.prototype.onFragParsed=function(t){var e=this.fragCurrent,n=t.frag;e&&"audio"===t.id&&n.sn===e.sn&&n.level===e.level&&this.state===m.State.PARSING&&(this.stats.tparsed=g.now(),this.state=m.State.PARSED,this._checkAppendedParsed())},n.prototype.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},n.prototype.onBufferCreated=function(t){var e=t.tracks.audio;e&&(this.mediaBuffer=e.buffer,this.loadedmetadata=!0),t.tracks.video&&(this.videoBuffer=t.tracks.video.buffer)},n.prototype.onBufferAppended=function(t){if("audio"===t.parent){var e=this.state;e!==m.State.PARSING&&e!==m.State.PARSED||(this.pendingBuffering=t.pending>0,this._checkAppendedParsed())}},n.prototype._checkAppendedParsed=function(){if(!(this.state!==m.State.PARSED||this.appended&&this.pendingBuffering)){var t=this.fragCurrent,e=this.stats,n=this.hls;if(t){this.fragPrevious=t,e.tbuffered=g.now(),n.trigger(s.default.FRAG_BUFFERED,{stats:e,frag:t,id:"audio"});var r=this.mediaBuffer?this.mediaBuffer:this.media;d.logger.log("audio buffered : "+l.default.toString(r.buffered)),this.audioSwitch&&this.appended&&(this.audioSwitch=!1,n.trigger(s.default.AUDIO_TRACK_SWITCHED,{id:this.trackId})),this.state=m.State.IDLE}this.tick()}},n.prototype.onError=function(e){var n=e.frag;if(!n||"audio"===n.type)switch(e.details){case c.ErrorDetails.FRAG_LOAD_ERROR:case c.ErrorDetails.FRAG_LOAD_TIMEOUT:var r=e.frag;if(r&&"audio"!==r.type)break;if(!e.fatal){var i=this.fragLoadError;i?i++:i=1;var o=this.config;if(i<=o.fragLoadingMaxRetry){this.fragLoadError=i;var u=Math.min(Math.pow(2,i-1)*o.fragLoadingRetryDelay,o.fragLoadingMaxRetryTimeout);d.logger.warn("AudioStreamController: frag loading failed, retry in "+u+" ms"),this.retryDate=g.now()+u,this.state=m.State.FRAG_LOADING_WAITING_RETRY}else d.logger.error("AudioStreamController: "+e.details+" reaches max retry, redispatch as fatal ..."),e.fatal=!0,this.state=m.State.ERROR}break;case c.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case c.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:case c.ErrorDetails.KEY_LOAD_ERROR:case c.ErrorDetails.KEY_LOAD_TIMEOUT:this.state!==m.State.ERROR&&(this.state=e.fatal?m.State.ERROR:m.State.IDLE,d.logger.warn("AudioStreamController: "+e.details+" while loading frag, now switching to "+this.state+" state ..."));break;case c.ErrorDetails.BUFFER_FULL_ERROR:if("audio"===e.parent&&(this.state===m.State.PARSING||this.state===m.State.PARSED)){var l=this.mediaBuffer,h=this.media.currentTime;if(l&&a.BufferHelper.isBuffered(l,h)&&a.BufferHelper.isBuffered(l,h+.5)){var o=this.config;o.maxMaxBufferLength>=o.maxBufferLength&&(o.maxMaxBufferLength/=2,d.logger.warn("AudioStreamController: reduce max buffer length to "+o.maxMaxBufferLength+"s")),this.state=m.State.IDLE}else d.logger.warn("AudioStreamController: buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,this.state=m.State.BUFFER_FLUSHING,this.hls.trigger(s.default.BUFFER_FLUSHING,{startOffset:0,endOffset:t.POSITIVE_INFINITY,type:"audio"})}}},n.prototype.onBufferFlushed=function(){var t=this,e=this.pendingData;e&&e.length?(d.logger.log("AudioStreamController: appending pending audio data after buffer flushed"),e.forEach(function(e){t.hls.trigger(s.default.BUFFER_APPENDING,e)}),this.appended=!0,this.pendingData=[],this.state=m.State.PARSED):(this.state=m.State.IDLE,this.fragPrevious=null,this.tick())},n}(m.default);e.default=v}).call(this,n("./src/polyfills/number.js")["Number"])},"./src/controller/audio-track-controller.js":function(t,e,n){"use strict";var r=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var i=n("./src/events.js"),a=n("./src/task-loop.js"),o=n("./src/utils/logger.js"),s=n("./src/errors.js"),u=function(t){function e(e){var n=t.call(this,e,i.default.MANIFEST_LOADING,i.default.MANIFEST_PARSED,i.default.AUDIO_TRACK_LOADED,i.default.AUDIO_TRACK_SWITCHED,i.default.LEVEL_LOADED,i.default.ERROR)||this;return n._trackId=-1,n._selectDefaultTrack=!0,n.tracks=[],n.trackIdBlacklist=Object.create(null),n.audioGroupId=null,n}return r(e,t),e.prototype.onManifestLoading=function(){this.tracks=[],this._trackId=-1,this._selectDefaultTrack=!0},e.prototype.onManifestParsed=function(t){var e=this.tracks=t.audioTracks||[];this.hls.trigger(i.default.AUDIO_TRACKS_UPDATED,{audioTracks:e})},e.prototype.onAudioTrackLoaded=function(t){if(t.id>=this.tracks.length)return void o.logger.warn("Invalid audio track id:",t.id);if(o.logger.log("audioTrack "+t.id+" loaded"),this.tracks[t.id].details=t.details,t.details.live&&!this.hasInterval()){var e=1e3*t.details.targetduration;this.setInterval(e)}!t.details.live&&this.hasInterval()&&this.clearInterval()},e.prototype.onAudioTrackSwitched=function(t){var e=this.tracks[t.id].groupId;e&&this.audioGroupId!==e&&(this.audioGroupId=e)},e.prototype.onLevelLoaded=function(t){var e=this.hls.levels[t.level];if(e.audioGroupIds){var n=e.audioGroupIds[e.urlId];this.audioGroupId!==n&&(this.audioGroupId=n,this._selectInitialAudioTrack())}},e.prototype.onError=function(t){t.type===s.ErrorTypes.NETWORK_ERROR&&(t.fatal&&this.clearInterval(),t.details===s.ErrorDetails.AUDIO_TRACK_LOAD_ERROR&&(o.logger.warn("Network failure on audio-track id:",t.context.id),this._handleLoadError()))},Object.defineProperty(e.prototype,"audioTracks",{get:function(){return this.tracks},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"audioTrack",{get:function(){return this._trackId},set:function(t){this._setAudioTrack(t),this._selectDefaultTrack=!1},enumerable:!0,configurable:!0}),e.prototype._setAudioTrack=function(t){if(this._trackId===t&&this.tracks[this._trackId].details)return void o.logger.debug("Same id as current audio-track passed, and track details available -> no-op");if(t<0||t>=this.tracks.length)return void o.logger.warn("Invalid id passed to audio-track controller");var e=this.tracks[t];o.logger.log("Now switching to audio-track index "+t),this.clearInterval(),this._trackId=t;var n=e.url,r=e.type,a=e.id;this.hls.trigger(i.default.AUDIO_TRACK_SWITCHING,{id:a,type:r,url:n}),this._loadTrackDetailsIfNeeded(e)},e.prototype.doTick=function(){this._updateTrack(this._trackId)},e.prototype._selectInitialAudioTrack=function(){var t=this,e=this.tracks;if(e.length){var n=this.tracks[this._trackId],r=null;if(n&&(r=n.name),this._selectDefaultTrack){var a=e.filter(function(t){return t.default});a.length?e=a:o.logger.warn("No default audio tracks defined")}var u=!1,l=function(){e.forEach(function(e){u||t.audioGroupId&&e.groupId!==t.audioGroupId||r&&r!==e.name||(t._setAudioTrack(e.id),u=!0)})};l(),u||(r=null,l()),u||(o.logger.error("No track found for running audio group-ID: "+this.audioGroupId),this.hls.trigger(i.default.ERROR,{type:s.ErrorTypes.MEDIA_ERROR,details:s.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,fatal:!0}))}},e.prototype._needsTrackLoading=function(t){var e=t.details,n=t.url;return!(e&&!e.live)&&!!n},e.prototype._loadTrackDetailsIfNeeded=function(t){if(this._needsTrackLoading(t)){var e=t.url,n=t.id;o.logger.log("loading audio-track playlist for id: "+n),this.hls.trigger(i.default.AUDIO_TRACK_LOADING,{url:e,id:n})}},e.prototype._updateTrack=function(t){if(!(t<0||t>=this.tracks.length)){this.clearInterval(),this._trackId=t,o.logger.log("trying to update audio-track "+t);var e=this.tracks[t];this._loadTrackDetailsIfNeeded(e)}},e.prototype._handleLoadError=function(){this.trackIdBlacklist[this._trackId]=!0;var t=this._trackId,e=this.tracks[t],n=e.name,r=e.language,i=e.groupId;o.logger.warn("Loading failed on audio track id: "+t+", group-id: "+i+', name/language: "'+n+'" / "'+r+'"');for(var a=t,s=0;s<this.tracks.length;s++)if(!this.trackIdBlacklist[s]){var u=this.tracks[s];if(u.name===n){a=s;break}}if(a===t)return void o.logger.warn('No fallback audio-track found for name/language: "'+n+'" / "'+r+'"');o.logger.log("Attempting audio-track fallback id:",a,"group-id:",this.tracks[a].groupId),this._setAudioTrack(a)},e}(a.default);e.default=u},"./src/controller/base-stream-controller.js":function(t,e,n){"use strict";(function(t){var r=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var i=n("./src/task-loop.js"),a=n("./src/controller/fragment-tracker.js"),o=n("./src/utils/buffer-helper.js"),s=n("./src/utils/logger.js");e.State={STOPPED:"STOPPED",STARTING:"STARTING",IDLE:"IDLE",PAUSED:"PAUSED",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",BUFFER_FLUSHING:"BUFFER_FLUSHING",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"};var u=function(n){function i(){return null!==n&&n.apply(this,arguments)||this}return r(i,n),i.prototype.doTick=function(){},i.prototype._streamEnded=function(t,e){var n=this,r=n.fragCurrent,i=n.fragmentTracker;if(!e.live&&r&&!r.backtracked&&r.sn===e.endSN&&!t.nextStart){var o=i.getState(r);return o===a.FragmentState.PARTIAL||o===a.FragmentState.OK}return!1},i.prototype.onMediaSeeking=function(){var n=this,r=n.config,i=n.media,a=n.mediaBuffer,u=n.state,l=i?i.currentTime:null,c=o.BufferHelper.bufferInfo(a||i,l,this.config.maxBufferHole);if(t.isFinite(l)&&s.logger.log("media seeking to "+l.toFixed(3)),u===e.State.FRAG_LOADING){var d=this.fragCurrent;if(0===c.len&&d){var h=r.maxFragLookUpTolerance,f=d.start-h,p=d.start+d.duration+h;l<f||l>p?(d.loader&&(s.logger.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),d.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.state=e.State.IDLE):s.logger.log("seeking outside of buffer but within currently loaded fragment range")}}else u===e.State.ENDED&&(0===c.len&&(this.fragPrevious=null,this.fragCurrent=null),this.state=e.State.IDLE);i&&(this.lastCurrentTime=l),this.loadedmetadata||(this.nextLoadPosition=this.startPosition=l),this.tick()},i.prototype.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},i}(i.default);e.default=u}).call(this,n("./src/polyfills/number.js")["Number"])},"./src/controller/buffer-controller.js":function(t,e,n){"use strict";(function(t){var r=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var i=n("./src/events.js"),a=n("./src/event-handler.js"),o=n("./src/utils/logger.js"),s=n("./src/errors.js"),u=n("./src/utils/mediasource-helper.js"),l=u.getMediaSource(),c=function(e){function n(t){var n=e.call(this,t,i.default.MEDIA_ATTACHING,i.default.MEDIA_DETACHING,i.default.MANIFEST_PARSED,i.default.BUFFER_RESET,i.default.BUFFER_APPENDING,i.default.BUFFER_CODECS,i.default.BUFFER_EOS,i.default.BUFFER_FLUSHING,i.default.LEVEL_PTS_UPDATED,i.default.LEVEL_UPDATED)||this;return n._msDuration=null,n._levelDuration=null,n._levelTargetDuration=10,n._live=null,n._objectUrl=null,n.bufferCodecEventsExpected=0,n.onsbue=n.onSBUpdateEnd.bind(n),n.onsbe=n.onSBUpdateError.bind(n),n.pendingTracks={},n.tracks={},n}return r(n,e),n.prototype.destroy=function(){a.default.prototype.destroy.call(this)},n.prototype.onLevelPtsUpdated=function(t){var e=t.type,n=this.tracks.audio;if("audio"===e&&n&&"audio/mpeg"===n.container){var r=this.sourceBuffer.audio;if(Math.abs(r.timestampOffset-t.start)>.1){var i=r.updating;try{r.abort()}catch(a){o.logger.warn("can not abort audio buffer: "+a)}i?this.audioTimestampOffset=t.start:(o.logger.warn("change mpeg audio timestamp offset from "+r.timestampOffset+" to "+t.start),r.timestampOffset=t.start)}}},n.prototype.onManifestParsed=function(t){this.bufferCodecEventsExpected=t.altAudio?2:1,o.logger.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},n.prototype.onMediaAttaching=function(t){var e=this.media=t.media;if(e){var n=this.mediaSource=new l;this.onmso=this.onMediaSourceOpen.bind(this),this.onmse=this.onMediaSourceEnded.bind(this),this.onmsc=this.onMediaSourceClose.bind(this),n.addEventListener("sourceopen",this.onmso),n.addEventListener("sourceended",this.onmse),n.addEventListener("sourceclose",this.onmsc),e.src=window.URL.createObjectURL(n),this._objectUrl=e.src}},n.prototype.onMediaDetaching=function(){o.logger.log("media source detaching");var t=this.mediaSource;if(t){if("open"===t.readyState)try{t.endOfStream()}catch(e){o.logger.warn("onMediaDetaching:"+e.message+" while calling endOfStream")}t.removeEventListener("sourceopen",this.onmso),t.removeEventListener("sourceended",this.onmse),t.removeEventListener("sourceclose",this.onmsc),this.media&&(window.URL.revokeObjectURL(this._objectUrl),this.media.src===this._objectUrl?(this.media.removeAttribute("src"),this.media.load()):o.logger.warn("media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.pendingTracks={},this.tracks={},this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0}this.onmso=this.onmse=this.onmsc=null,this.hls.trigger(i.default.MEDIA_DETACHED)},n.prototype.onMediaSourceOpen=function(){o.logger.log("media source opened"),this.hls.trigger(i.default.MEDIA_ATTACHED,{media:this.media});var t=this.mediaSource;t&&t.removeEventListener("sourceopen",this.onmso),this.checkPendingTracks()},n.prototype.checkPendingTracks=function(){var t=this,e=t.bufferCodecEventsExpected,n=t.pendingTracks,r=Object.keys(n).length;(r&&!e||2===r)&&(this.createSourceBuffers(n),this.pendingTracks={},this.doAppending())},n.prototype.onMediaSourceClose=function(){o.logger.log("media source closed")},n.prototype.onMediaSourceEnded=function(){o.logger.log("media source ended")},n.prototype.onSBUpdateEnd=function(){if(this.audioTimestampOffset){var t=this.sourceBuffer.audio;o.logger.warn("change mpeg audio timestamp offset from "+t.timestampOffset+" to "+this.audioTimestampOffset),t.timestampOffset=this.audioTimestampOffset,delete this.audioTimestampOffset}this._needsFlush&&this.doFlush(),this._needsEos&&this.checkEos(),this.appending=!1;var e=this.parent,n=this.segments.reduce(function(t,n){return n.parent===e?t+1:t},0),r={},a=this.sourceBuffer;for(var s in a)r[s]=a[s].buffered;this.hls.trigger(i.default.BUFFER_APPENDED,{parent:e,pending:n,timeRanges:r}),this._needsFlush||this.doAppending(),this.updateMediaElementDuration(),0===n&&this.flushLiveBackBuffer()},n.prototype.onSBUpdateError=function(t){o.logger.error("sourceBuffer error:",t),this.hls.trigger(i.default.ERROR,{type:s.ErrorTypes.MEDIA_ERROR,details:s.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1})},n.prototype.onBufferReset=function(){var t=this.sourceBuffer;for(var e in t){var n=t[e];try{this.mediaSource.removeSourceBuffer(n),n.removeEventListener("updateend",this.onsbue),n.removeEventListener("error",this.onsbe)}catch(r){}}this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0},n.prototype.onBufferCodecs=function(t){var e=this;if(!Object.keys(this.sourceBuffer).length){Object.keys(t).forEach(function(n){e.pendingTracks[n]=t[n]});var n=this.mediaSource;this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),n&&"open"===n.readyState&&this.checkPendingTracks()}},n.prototype.createSourceBuffers=function(t){var e=this.sourceBuffer,n=this.mediaSource;for(var r in t)if(!e[r]){var a=t[r],u=a.levelCodec||a.codec,l=a.container+";codecs="+u;o.logger.log("creating sourceBuffer("+l+")");try{var c=e[r]=n.addSourceBuffer(l);c.addEventListener("updateend",this.onsbue),c.addEventListener("error",this.onsbe),this.tracks[r]={codec:u,container:a.container},a.buffer=c}catch(d){o.logger.error("error while trying to add sourceBuffer:"+d.message),this.hls.trigger(i.default.ERROR,{type:s.ErrorTypes.MEDIA_ERROR,details:s.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,err:d,mimeType:l})}}this.hls.trigger(i.default.BUFFER_CREATED,{tracks:t})},n.prototype.onBufferAppending=function(t){this._needsFlush||(this.segments?this.segments.push(t):this.segments=[t],this.doAppending())},n.prototype.onBufferAppendFail=function(t){o.logger.error("sourceBuffer error:",t.event),this.hls.trigger(i.default.ERROR,{type:s.ErrorTypes.MEDIA_ERROR,details:s.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1})},n.prototype.onBufferEos=function(t){var e=this.sourceBuffer,n=t.type;for(var r in e)n&&r!==n||e[r].ended||(e[r].ended=!0,o.logger.log(r+" sourceBuffer now EOS"));this.checkEos()},n.prototype.checkEos=function(){var t=this.sourceBuffer,e=this.mediaSource;if(!e||"open"!==e.readyState)return void(this._needsEos=!1);for(var n in t){var r=t[n];if(!r.ended)return;if(r.updating)return void(this._needsEos=!0)}o.logger.log("all media data are available, signal endOfStream() to MediaSource and stop loading fragment");try{e.endOfStream()}catch(i){o.logger.warn("exception while calling mediaSource.endOfStream()")}this._needsEos=!1},n.prototype.onBufferFlushing=function(t){this.flushRange.push({start:t.startOffset,end:t.endOffset,type:t.type}),this.flushBufferCounter=0,this.doFlush()},n.prototype.flushLiveBackBuffer=function(){if(this._live){var t=this.hls.config.liveBackBufferLength;if(isFinite(t)&&!(t<0))for(var e=this.media.currentTime,n=this.sourceBuffer,r=Object.keys(n),i=e-Math.max(t,this._levelTargetDuration),a=r.length-1;a>=0;a--){var o=r[a],s=n[o].buffered;s.length>0&&i>s.start(0)&&this.removeBufferRange(o,n[o],0,i)}}},n.prototype.onLevelUpdated=function(t){var e=t.details;e.fragments.length>0&&(this._levelDuration=e.totalduration+e.fragments[0].start,this._levelTargetDuration=e.averagetargetduration||e.targetduration||10,this._live=e.live,this.updateMediaElementDuration())},n.prototype.updateMediaElementDuration=function(){var e,n=this.hls.config;if(null!==this._levelDuration&&this.media&&this.mediaSource&&this.sourceBuffer&&0!==this.media.readyState&&"open"===this.mediaSource.readyState){for(var r in this.sourceBuffer)if(!0===this.sourceBuffer[r].updating)return;e=this.media.duration,null===this._msDuration&&(this._msDuration=this.mediaSource.duration),!0===this._live&&!0===n.liveDurationInfinity?(o.logger.log("Media Source duration is set to Infinity"),this._msDuration=this.mediaSource.duration=1/0):(this._levelDuration>this._msDuration&&this._levelDuration>e||!t.isFinite(e))&&(o.logger.log("Updating Media Source duration to "+this._levelDuration.toFixed(3)),this._msDuration=this.mediaSource.duration=this._levelDuration)}},n.prototype.doFlush=function(){for(;this.flushRange.length;){var t=this.flushRange[0];if(!this.flushBuffer(t.start,t.end,t.type))return void(this._needsFlush=!0);this.flushRange.shift(),this.flushBufferCounter=0}if(0===this.flushRange.length){this._needsFlush=!1;var e=0,n=this.sourceBuffer;try{for(var r in n)e+=n[r].buffered.length}catch(a){o.logger.error("error while accessing sourceBuffer.buffered")}this.appended=e,this.hls.trigger(i.default.BUFFER_FLUSHED)}},n.prototype.doAppending=function(){var t=this,e=t.hls,n=t.segments,r=t.sourceBuffer;if(Object.keys(r).length){if(this.media.error)return this.segments=[],void o.logger.error("trying to append although a media error occured, flush segment and abort");if(this.appending)return;if(n&&n.length){var a=n.shift();try{var u=a.type,l=r[u];l?l.updating?n.unshift(a):(l.ended=!1,this.parent=a.parent,l.appendBuffer(a.data),this.appendError=0,this.appended++,this.appending=!0):this.onSBUpdateEnd()}catch(d){o.logger.error("error while trying to append buffer:"+d.message),n.unshift(a);var c={type:s.ErrorTypes.MEDIA_ERROR,parent:a.parent};22!==d.code?(this.appendError?this.appendError++:this.appendError=1,c.details=s.ErrorDetails.BUFFER_APPEND_ERROR,this.appendError>e.config.appendErrorMaxRetry?(o.logger.log("fail "+e.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),this.segments=[],c.fatal=!0,e.trigger(i.default.ERROR,c)):(c.fatal=!1,e.trigger(i.default.ERROR,c))):(this.segments=[],c.details=s.ErrorDetails.BUFFER_FULL_ERROR,c.fatal=!1,e.trigger(i.default.ERROR,c))}}}},n.prototype.flushBuffer=function(t,e,n){var r,i=this.sourceBuffer;if(Object.keys(i).length){if(o.logger.log("flushBuffer,pos/start/end: "+this.media.currentTime.toFixed(3)+"/"+t+"/"+e),this.flushBufferCounter<this.appended){for(var a in i)if(!n||a===n){if(r=i[a],r.ended=!1,r.updating)return o.logger.warn("cannot flush, sb updating in progress"),!1;if(this.removeBufferRange(a,r,t,e))return this.flushBufferCounter++,!1}}else o.logger.warn("abort flushing too many retries");o.logger.log("buffer flushed")}return!0},n.prototype.removeBufferRange=function(t,e,n,r){try{for(var i=0;i<e.buffered.length;i++){var a=e.buffered.start(i),s=e.buffered.end(i),u=Math.max(a,n),l=Math.min(s,r);if(Math.min(l,s)-u>.5)return o.logger.log("sb remove "+t+" ["+u+","+l+"], of ["+a+","+s+"], pos:"+this.media.currentTime),e.remove(u,l),!0}}catch(c){o.logger.warn("removeBufferRange failed",c)}return!1},n}(a.default);e.default=c}).call(this,n("./src/polyfills/number.js")["Number"])},"./src/controller/cap-level-controller.js":function(t,e,n){"use strict";(function(t){var r=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var i=n("./src/events.js"),a=n("./src/event-handler.js"),o=function(e){function n(n){var r=e.call(this,n,i.default.FPS_DROP_LEVEL_CAPPING,i.default.MEDIA_ATTACHING,i.default.MANIFEST_PARSED,i.default.BUFFER_CODECS,i.default.MEDIA_DETACHING)||this;return r.autoLevelCapping=t.POSITIVE_INFINITY,r.firstLevel=null,r.levels=[],r.media=null,r.restrictedLevels=[],r.timer=null,r}return r(n,e),n.prototype.destroy=function(){this.hls.config.capLevelToPlayerSize&&(this.media=null,this._stopCapping())},n.prototype.onFpsDropLevelCapping=function(t){n.isLevelAllowed(t.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(t.droppedLevel)},n.prototype.onMediaAttaching=function(t){this.media=t.media instanceof window.HTMLVideoElement?t.media:null},n.prototype.onManifestParsed=function(t){var e=this.hls;this.restrictedLevels=[],this.levels=t.levels,this.firstLevel=t.firstLevel,e.config.capLevelToPlayerSize&&t.video&&this._startCapping()},n.prototype.onBufferCodecs=function(t){this.hls.config.capLevelToPlayerSize&&t.video&&this._startCapping()},n.prototype.onLevelsUpdated=function(t){this.levels=t.levels},n.prototype.onMediaDetaching=function(){this._stopCapping()},n.prototype.detectPlayerSize=function(){if(this.media){var t=this.levels?this.levels.length:0;if(t){var e=this.hls;e.autoLevelCapping=this.getMaxLevel(t-1),e.autoLevelCapping>this.autoLevelCapping&&e.streamController.nextLevelSwitch(),this.autoLevelCapping=e.autoLevelCapping}}},n.prototype.getMaxLevel=function(t){var e=this;if(!this.levels)return-1;var r=this.levels.filter(function(r,i){return n.isLevelAllowed(i,e.restrictedLevels)&&i<=t});return n.getMaxLevelByMediaSize(r,this.mediaWidth,this.mediaHeight)},n.prototype._startCapping=function(){this.timer||(this.autoLevelCapping=t.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),clearInterval(this.timer),this.timer=setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},n.prototype._stopCapping=function(){this.restrictedLevels=[],this.firstLevel=null,this.autoLevelCapping=t.POSITIVE_INFINITY,this.timer&&(this.timer=clearInterval(this.timer),this.timer=null)},Object.defineProperty(n.prototype,"mediaWidth",{get:function(){var t,e=this.media;return e&&(t=e.width||e.clientWidth||e.offsetWidth,t*=n.contentScaleFactor),t},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"mediaHeight",{get:function(){var t,e=this.media;return e&&(t=e.height||e.clientHeight||e.offsetHeight,t*=n.contentScaleFactor),t},enumerable:!0,configurable:!0}),Object.defineProperty(n,"contentScaleFactor",{get:function(){var t=1;try{t=window.devicePixelRatio}catch(e){}return t},enumerable:!0,configurable:!0}),n.isLevelAllowed=function(t,e){return void 0===e&&(e=[]),-1===e.indexOf(t)},n.getMaxLevelByMediaSize=function(t,e,n){if(!t||t&&!t.length)return-1;for(var r=t.length-1,i=0;i<t.length;i+=1){var a=t[i];if((a.width>=e||a.height>=n)&&function(t,e){return!e||(t.width!==e.width||t.height!==e.height)}(a,t[i+1])){r=i;break}}return r},n}(a.default);e.default=o}).call(this,n("./src/polyfills/number.js")["Number"])},"./src/controller/eme-controller.js":function(t,e,n){"use strict";var r=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var i=n("./src/event-handler.js"),a=n("./src/events.js"),o=n("./src/errors.js"),s=n("./src/utils/logger.js"),u=window.XMLHttpRequest,l={WIDEVINE:"com.widevine.alpha",PLAYREADY:"com.microsoft.playready"},c=function(t,e,n){var r={videoCapabilities:[]};return e.forEach(function(t){r.videoCapabilities.push({contentType:'video/mp4; codecs="'+t+'"'})}),[r]},d=function(t,e,n){switch(t){case l.WIDEVINE:return c(0,n);default:throw Error("Unknown key-system: "+t)}},h=function(t){function e(e){var n=t.call(this,e,a.default.MEDIA_ATTACHED,a.default.MANIFEST_PARSED)||this;return n._widevineLicenseUrl=e.config.widevineLicenseUrl,n._licenseXhrSetup=e.config.licenseXhrSetup,n._emeEnabled=e.config.emeEnabled,n._requestMediaKeySystemAccess=e.config.requestMediaKeySystemAccessFunc,n._mediaKeysList=[],n._media=null,n._hasSetMediaKeys=!1,n._isMediaEncrypted=!1,n._requestLicenseFailureCount=0,n}return r(e,t),e.prototype.getLicenseServerUrl=function(t){var e;switch(t){case l.WIDEVINE:e=this._widevineLicenseUrl;break;default:e=null}return e||(s.logger.error('No license server URL configured for key-system "'+t+'"'),this.hls.trigger(a.default.ERROR,{type:o.ErrorTypes.KEY_SYSTEM_ERROR,details:o.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})),e},e.prototype._attemptKeySystemAccess=function(t,e,n){var r=this,i=d(t,0,n);if(!i)return void s.logger.warn("Can not create config for key-system (maybe because platform is not supported):",t);s.logger.log("Requesting encrypted media key-system access"),this.requestMediaKeySystemAccess(t,i).then(function(e){r._onMediaKeySystemAccessObtained(t,e)}).catch(function(e){s.logger.error('Failed to obtain key-system "'+t+'" access:',e)})},Object.defineProperty(e.prototype,"requestMediaKeySystemAccess",{get:function(){if(!this._requestMediaKeySystemAccess)throw new Error("No requestMediaKeySystemAccess function configured");return this._requestMediaKeySystemAccess},enumerable:!0,configurable:!0}),e.prototype._onMediaKeySystemAccessObtained=function(t,e){var n=this;s.logger.log('Access for key-system "'+t+'" obtained');var r={mediaKeys:null,mediaKeysSession:null,mediaKeysSessionInitialized:!1,mediaKeySystemAccess:e,mediaKeySystemDomain:t};this._mediaKeysList.push(r),e.createMediaKeys().then(function(e){r.mediaKeys=e,s.logger.log('Media-keys created for key-system "'+t+'"'),n._onMediaKeysCreated()}).catch(function(t){s.logger.error("Failed to create media-keys:",t)})},e.prototype._onMediaKeysCreated=function(){var t=this;this._mediaKeysList.forEach(function(e){e.mediaKeysSession||(e.mediaKeysSession=e.mediaKeys.createSession(),t._onNewMediaKeySession(e.mediaKeysSession))})},e.prototype._onNewMediaKeySession=function(t){var e=this;s.logger.log("New key-system session "+t.sessionId),t.addEventListener("message",function(n){e._onKeySessionMessage(t,n.message)},!1)},e.prototype._onKeySessionMessage=function(t,e){s.logger.log("Got EME message event, creating license request"),this._requestLicense(e,function(e){s.logger.log("Received license data, updating key-session"),t.update(e)})},e.prototype._onMediaEncrypted=function(t,e){s.logger.log('Media is encrypted using "'+t+'" init data type'),this._isMediaEncrypted=!0,this._mediaEncryptionInitDataType=t,this._mediaEncryptionInitData=e,this._attemptSetMediaKeys(),this._generateRequestWithPreferredKeySession()},e.prototype._attemptSetMediaKeys=function(){if(!this._hasSetMediaKeys){var t=this._mediaKeysList[0];if(!t||!t.mediaKeys)return s.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been obtained yet"),void this.hls.trigger(a.default.ERROR,{type:o.ErrorTypes.KEY_SYSTEM_ERROR,details:o.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});s.logger.log("Setting keys for encrypted media"),this._media.setMediaKeys(t.mediaKeys),this._hasSetMediaKeys=!0}},e.prototype._generateRequestWithPreferredKeySession=function(){var t=this,e=this._mediaKeysList[0];if(!e)return s.logger.error("Fatal: Media is encrypted but not any key-system access has been obtained yet"),void this.hls.trigger(a.default.ERROR,{type:o.ErrorTypes.KEY_SYSTEM_ERROR,details:o.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});if(e.mediaKeysSessionInitialized)return void s.logger.warn("Key-Session already initialized but requested again");var n=e.mediaKeysSession;n||(s.logger.error("Fatal: Media is encrypted but no key-session existing"),this.hls.trigger(a.default.ERROR,{type:o.ErrorTypes.KEY_SYSTEM_ERROR,details:o.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!0}));var r=this._mediaEncryptionInitDataType,i=this._mediaEncryptionInitData;s.logger.log('Generating key-session request for "'+r+'" init data type'),e.mediaKeysSessionInitialized=!0,n.generateRequest(r,i).then(function(){s.logger.debug("Key-session generation succeeded")}).catch(function(e){s.logger.error("Error generating key-session request:",e),t.hls.trigger(a.default.ERROR,{type:o.ErrorTypes.KEY_SYSTEM_ERROR,details:o.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!1})})},e.prototype._createLicenseXhr=function(t,e,n){var r=new u,i=this._licenseXhrSetup;try{if(i)try{i(r,t)}catch(l){r.open("POST",t,!0),i(r,t)}r.readyState||r.open("POST",t,!0)}catch(l){return s.logger.error("Error setting up key-system license XHR",l),void this.hls.trigger(a.default.ERROR,{type:o.ErrorTypes.KEY_SYSTEM_ERROR,details:o.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}return r.responseType="arraybuffer",r.onreadystatechange=this._onLicenseRequestReadyStageChange.bind(this,r,t,e,n),r},e.prototype._onLicenseRequestReadyStageChange=function(t,e,n,r){switch(t.readyState){case 4:if(200===t.status)this._requestLicenseFailureCount=0,s.logger.log("License request succeeded"),r(t.response);else{if(s.logger.error("License Request XHR failed ("+e+"). Status: "+t.status+" ("+t.statusText+")"),++this._requestLicenseFailureCount<=3){var i=3-this._requestLicenseFailureCount+1;return s.logger.warn("Retrying license request, "+i+" attempts left"),void this._requestLicense(n,r)}this.hls.trigger(a.default.ERROR,{type:o.ErrorTypes.KEY_SYSTEM_ERROR,details:o.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}}},e.prototype._generateLicenseRequestChallenge=function(t,e){var n;return t.mediaKeySystemDomain===l.PLAYREADY?s.logger.error("PlayReady is not supported (yet)"):t.mediaKeySystemDomain===l.WIDEVINE?n=e:s.logger.error("Unsupported key-system:",t.mediaKeySystemDomain),n},e.prototype._requestLicense=function(t,e){s.logger.log("Requesting content license for key-system");var n=this._mediaKeysList[0];if(!n)return s.logger.error("Fatal error: Media is encrypted but no key-system access has been obtained yet"),void this.hls.trigger(a.default.ERROR,{type:o.ErrorTypes.KEY_SYSTEM_ERROR,details:o.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});var r=this.getLicenseServerUrl(n.mediaKeySystemDomain),i=this._createLicenseXhr(r,t,e);s.logger.log("Sending license request to URL: "+r),i.send(this._generateLicenseRequestChallenge(n,t))},e.prototype.onMediaAttached=function(t){var e=this;if(this._emeEnabled){var n=t.media;this._media=n,n.addEventListener("encrypted",function(t){e._onMediaEncrypted(t.initDataType,t.initData)})}},e.prototype.onManifestParsed=function(t){if(this._emeEnabled){var e=t.levels.map(function(t){return t.audioCodec}),n=t.levels.map(function(t){return t.videoCodec});this._attemptKeySystemAccess(l.WIDEVINE,e,n)}},e}(i.default);e.default=h},"./src/controller/fps-controller.js":function(t,e,n){"use strict";var r=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var i=n("./src/events.js"),a=n("./src/event-handler.js"),o=n("./src/utils/logger.js"),s=window.performance,u=function(t){function e(e){return t.call(this,e,i.default.MEDIA_ATTACHING)||this}return r(e,t),e.prototype.destroy=function(){this.timer&&clearInterval(this.timer),this.isVideoPlaybackQualityAvailable=!1},e.prototype.onMediaAttaching=function(t){var e=this.hls.config;if(e.capLevelOnFPSDrop){"function"==typeof(this.video=t.media instanceof window.HTMLVideoElement?t.media:null).getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),clearInterval(this.timer),this.timer=setInterval(this.checkFPSInterval.bind(this),e.fpsDroppedMonitoringPeriod)}},e.prototype.checkFPS=function(t,e,n){var r=s.now();if(e){if(this.lastTime){var a=r-this.lastTime,u=n-this.lastDroppedFrames,l=e-this.lastDecodedFrames,c=1e3*u/a,d=this.hls;if(d.trigger(i.default.FPS_DROP,{currentDropped:u,currentDecoded:l,totalDroppedFrames:n}),c>0&&u>d.config.fpsDroppedMonitoringThreshold*l){var h=d.currentLevel;o.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+h),h>0&&(-1===d.autoLevelCapping||d.autoLevelCapping>=h)&&(h-=1,d.trigger(i.default.FPS_DROP_LEVEL_CAPPING,{level:h,droppedLevel:d.currentLevel}),d.autoLevelCapping=h,d.streamController.nextLevelSwitch())}}this.lastTime=r,this.lastDroppedFrames=n,this.lastDecodedFrames=e}},e.prototype.checkFPSInterval=function(){var t=this.video;if(t)if(this.isVideoPlaybackQualityAvailable){var e=t.getVideoPlaybackQuality();this.checkFPS(t,e.totalVideoFrames,e.droppedVideoFrames)}else this.checkFPS(t,t.webkitDecodedFrameCount,t.webkitDroppedFrameCount)},e}(a.default);e.default=u},"./src/controller/fragment-finders.js":function(t,e,n){"use strict";(function(t){function r(e,n,r){if(!Array.isArray(e)||!e.length||!t.isFinite(n))return null;if(n<e[0].programDateTime)return null;if(n>=e[e.length-1].endProgramDateTime)return null;r=r||0;for(var i=0;i<e.length;++i){var a=e[i];if(o(n,r,a))return a}return null}function i(t,e,n,r){void 0===n&&(n=0),void 0===r&&(r=0);var i=t?e[t.sn-e[0].sn+1]:null;return i&&!a(n,r,i)?i:s.default.search(e,a.bind(null,n,r))}function a(t,e,n){void 0===t&&(t=0),void 0===e&&(e=0);var r=Math.min(e,n.duration+(n.deltaPTS?n.deltaPTS:0));return n.start+n.duration-r<=t?1:n.start-r>t&&n.start?-1:0}function o(t,e,n){var r=1e3*Math.min(e,n.duration+(n.deltaPTS?n.deltaPTS:0));return n.endProgramDateTime-r>t}Object.defineProperty(e,"__esModule",{value:!0});var s=n("./src/utils/binary-search.js");e.findFragmentByPDT=r,e.findFragmentByPTS=i,e.fragmentWithinToleranceTest=a,e.pdtWithinToleranceTest=o}).call(this,n("./src/polyfills/number.js")["Number"])},"./src/controller/fragment-tracker.js":function(t,e,n){"use strict";(function(t){var r=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var i=n("./src/event-handler.js"),a=n("./src/events.js");e.FragmentState={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"};var o=function(n){function o(t){var e=n.call(this,t,a.default.BUFFER_APPENDED,a.default.FRAG_BUFFERED,a.default.FRAG_LOADED)||this;return e.bufferPadding=.2,e.fragments=Object.create(null),e.timeRanges=Object.create(null),e.config=t.config,e}return r(o,n),o.prototype.destroy=function(){this.fragments=null,this.timeRanges=null,this.config=null,i.default.prototype.destroy.call(this),n.prototype.destroy.call(this)},o.prototype.getBufferedFrag=function(t,e){var n=this.fragments,r=Object.keys(n).filter(function(r){var i=n[r];if(i.body.type!==e)return!1;if(!i.buffered)return!1;var a=i.body;return a.startPTS<=t&&t<=a.endPTS});if(0===r.length)return null;var i=r.pop();return n[i].body},o.prototype.detectEvictedFragments=function(t,e){var n,r,i=this;Object.keys(this.fragments).forEach(function(a){var o=i.fragments[a];if(!0===o.buffered){var s=o.range[t];if(s){n=s.time;for(var u=0;u<n.length;u++)if(r=n[u],!1===i.isTimeBuffered(r.startPTS,r.endPTS,e)){i.removeFragment(o.body);break}}}})},o.prototype.detectPartialFragments=function(t){var e=this,n=this.getFragmentKey(t),r=this.fragments[n];r&&(r.buffered=!0,Object.keys(this.timeRanges).forEach(function(n){if(t.hasElementaryStream(n)){var i=e.timeRanges[n];r.range[n]=e.getBufferedTimes(t.startPTS,t.endPTS,i)}}))},o.prototype.getBufferedTimes=function(t,e,n){for(var r,i,a=[],o=!1,s=0;s<n.length;s++){if(r=n.start(s)-this.bufferPadding,i=n.end(s)+this.bufferPadding,t>=r&&e<=i){a.push({startPTS:Math.max(t,n.start(s)),endPTS:Math.min(e,n.end(s))});break}if(t<i&&e>r)a.push({startPTS:Math.max(t,n.start(s)),endPTS:Math.min(e,n.end(s))}),o=!0;else if(e<=r)break}return{time:a,partial:o}},o.prototype.getFragmentKey=function(t){return t.type+"_"+t.level+"_"+t.urlId+"_"+t.sn},o.prototype.getPartialFragment=function(t){var e,n,r,i=this,a=null,o=0;return Object.keys(this.fragments).forEach(function(s){var u=i.fragments[s];i.isPartial(u)&&(n=u.body.startPTS-i.bufferPadding,r=u.body.endPTS+i.bufferPadding,t>=n&&t<=r&&(e=Math.min(t-n,r-t),o<=e&&(a=u.body,o=e)))}),a},o.prototype.getState=function(t){var n=this.getFragmentKey(t),r=this.fragments[n],i=e.FragmentState.NOT_LOADED;return void 0!==r&&(i=r.buffered?!0===this.isPartial(r)?e.FragmentState.PARTIAL:e.FragmentState.OK:e.FragmentState.APPENDING),i},o.prototype.isPartial=function(t){return!0===t.buffered&&(void 0!==t.range.video&&!0===t.range.video.partial||void 0!==t.range.audio&&!0===t.range.audio.partial)},o.prototype.isTimeBuffered=function(t,e,n){for(var r,i,a=0;a<n.length;a++){if(r=n.start(a)-this.bufferPadding,i=n.end(a)+this.bufferPadding,t>=r&&e<=i)return!0;if(e<=r)return!1}return!1},o.prototype.onFragLoaded=function(e){var n=e.frag;t.isFinite(n.sn)&&!n.bitrateTest&&(this.fragments[this.getFragmentKey(n)]={body:n,range:Object.create(null),buffered:!1})},o.prototype.onBufferAppended=function(t){var e=this;this.timeRanges=t.timeRanges,Object.keys(this.timeRanges).forEach(function(t){var n=e.timeRanges[t];e.detectEvictedFragments(t,n)})},o.prototype.onFragBuffered=function(t){this.detectPartialFragments(t.frag)},o.prototype.hasFragment=function(t){var e=this.getFragmentKey(t);return void 0!==this.fragments[e]},o.prototype.removeFragment=function(t){var e=this.getFragmentKey(t);delete this.fragments[e]},o.prototype.removeAllFragments=function(){this.fragments=Object.create(null)},o}(i.default);e.FragmentTracker=o}).call(this,n("./src/polyfills/number.js")["Number"])},"./src/controller/gap-controller.js":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n("./src/utils/buffer-helper.js"),i=n("./src/errors.js"),a=n("./src/events.js"),o=n("./src/utils/logger.js"),s=function(){function t(t,e,n,r){this.config=t,this.media=e,this.fragmentTracker=n,this.hls=r,this.stallReported=!1}return t.prototype.poll=function(t,e){var n=this,i=n.config,a=n.media,s=a.currentTime,u=window.performance.now();if(s!==t)return this.stallReported&&(o.logger.warn("playback not stuck anymore @"+s+", after "+Math.round(u-this.stalled)+"ms"),this.stallReported=!1),this.stalled=null,void(this.nudgeRetry=0);if(!(a.ended||!a.buffered.length||a.readyState>2||a.seeking&&r.BufferHelper.isBuffered(a,s))){var l=u-this.stalled,c=r.BufferHelper.bufferInfo(a,s,i.maxBufferHole);if(!this.stalled)return void(this.stalled=u);l>=1e3&&this._reportStall(c.len),this._tryFixBufferStall(c,l)}},t.prototype._tryFixBufferStall=function(t,e){var n=this,r=n.config,i=n.fragmentTracker,a=n.media,o=a.currentTime,s=i.getPartialFragment(o);s&&this._trySkipBufferHole(s),t.len>.5&&e>1e3*r.highBufferWatchdogPeriod&&(this.stalled=null,this._tryNudgeBuffer())},t.prototype._reportStall=function(t){var e=this,n=e.hls,r=e.media;e.stallReported||(this.stallReported=!0,o.logger.warn("Playback stalling at @"+r.currentTime+" due to low buffer"),n.trigger(a.default.ERROR,{type:i.ErrorTypes.MEDIA_ERROR,details:i.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:t}))},t.prototype._trySkipBufferHole=function(t){for(var e=this,n=e.hls,r=e.media,s=r.currentTime,u=0,l=0;l<r.buffered.length;l++){var c=r.buffered.start(l);if(s>=u&&s<c)return r.currentTime=Math.max(c,r.currentTime+.1),o.logger.warn("skipping hole, adjusting currentTime from "+s+" to "+r.currentTime),this.stalled=null,void n.trigger(a.default.ERROR,{type:i.ErrorTypes.MEDIA_ERROR,details:i.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+s+" to "+r.currentTime,frag:t});u=r.buffered.end(l)}},t.prototype._tryNudgeBuffer=function(){var t=this,e=t.config,n=t.hls,r=t.media,s=r.currentTime,u=(this.nudgeRetry||0)+1;if(this.nudgeRetry=u,u<e.nudgeMaxRetry){var l=s+u*e.nudgeOffset;o.logger.log("adjust currentTime from "+s+" to "+l),r.currentTime=l,n.trigger(a.default.ERROR,{type:i.ErrorTypes.MEDIA_ERROR,details:i.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})}else o.logger.error("still stuck in high buffer @"+s+" after "+e.nudgeMaxRetry+", raise fatal error"),n.trigger(a.default.ERROR,{type:i.ErrorTypes.MEDIA_ERROR,details:i.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0})},t}();e.default=s},"./src/controller/id3-track-controller.js":function(t,e,n){"use strict";var r=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var i=n("./src/events.js"),a=n("./src/event-handler.js"),o=n("./src/demux/id3.js"),s=n("./src/utils/texttrack-utils.js"),u=function(t){function e(e){var n=t.call(this,e,i.default.MEDIA_ATTACHED,i.default.MEDIA_DETACHING,i.default.FRAG_PARSING_METADATA)||this;return n.id3Track=void 0,n.media=void 0,n}return r(e,t),e.prototype.destroy=function(){a.default.prototype.destroy.call(this)},e.prototype.onMediaAttached=function(t){this.media=t.media,this.media},e.prototype.onMediaDetaching=function(){s.clearCurrentCues(this.id3Track),this.id3Track=void 0,this.media=void 0},e.prototype.getID3Track=function(t){for(var e=0;e<t.length;e++){var n=t[e];if("metadata"===n.kind&&"id3"===n.label)return s.sendAddTrackEvent(n,this.media),n}return this.media.addTextTrack("metadata","id3")},e.prototype.onFragParsingMetadata=function(t){var e=t.frag,n=t.samples;this.id3Track||(this.id3Track=this.getID3Track(this.media.textTracks),this.id3Track.mode="hidden");for(var r=window.WebKitDataCue||window.VTTCue||window.TextTrackCue,i=0;i<n.length;i++){var a=o.default.getID3Frames(n[i].data);if(a){var s=n[i].pts,u=i<n.length-1?n[i+1].pts:e.endPTS;s===u&&(u+=1e-4);for(var l=0;l<a.length;l++){var c=a[l];if(!o.default.isTimeStampFrame(c)){var d=new r(s,u,"");d.value=c,this.id3Track.addCue(d)}}}}},e}(a.default);e.default=u},"./src/controller/level-controller.js":function(t,e,n){"use strict";var r=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var i,a=n("./src/events.js"),o=n("./src/event-handler.js"),s=n("./src/utils/logger.js"),u=n("./src/errors.js"),l=n("./src/utils/codecs.js"),c=n("./src/controller/level-helper.js"),d=window.performance,h=function(t){function e(e){var n=t.call(this,e,a.default.MANIFEST_LOADED,a.default.LEVEL_LOADED,a.default.AUDIO_TRACK_SWITCHED,a.default.FRAG_LOADED,a.default.ERROR)||this;return n.canload=!1,n.currentLevelIndex=null,n.manualLevelIndex=-1,n.timer=null,i=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),n}return r(e,t),e.prototype.onHandlerDestroying=function(){this.clearTimer(),this.manualLevelIndex=-1},e.prototype.clearTimer=function(){null!==this.timer&&(clearTimeout(this.timer),this.timer=null)},e.prototype.startLoad=function(){var t=this._levels;this.canload=!0,this.levelRetryCount=0,t&&t.forEach(function(t){t.loadError=0;var e=t.details;e&&e.live&&(t.details=void 0)}),null!==this.timer&&this.loadLevel()},e.prototype.stopLoad=function(){this.canload=!1},e.prototype.onManifestLoaded=function(t){var e,n=[],r=[],o={},d=null,h=!1,f=!1;if(t.levels.forEach(function(t){var e=t.attrs;t.loadError=0,t.fragmentError=!1,h=h||!!t.videoCodec,f=f||!!t.audioCodec,i&&t.audioCodec&&-1!==t.audioCodec.indexOf("mp4a.40.34")&&(t.audioCodec=void 0),d=o[t.bitrate],d?d.url.push(t.url):(t.url=[t.url],t.urlId=0,o[t.bitrate]=t,n.push(t)),e&&(e.AUDIO&&(f=!0,c.addGroupId(d||t,"audio",e.AUDIO)),e.SUBTITLES&&c.addGroupId(d||t,"text",e.SUBTITLES))}),h&&f&&(n=n.filter(function(t){return!!t.videoCodec})),n=n.filter(function(t){var e=t.audioCodec,n=t.videoCodec;return(!e||l.isCodecSupportedInMp4(e,"audio"))&&(!n||l.isCodecSupportedInMp4(n,"video"))}),t.audioTracks&&(r=t.audioTracks.filter(function(t){return!t.audioCodec||l.isCodecSupportedInMp4(t.audioCodec,"audio")}),r.forEach(function(t,e){t.id=e})),n.length>0){e=n[0].bitrate,n.sort(function(t,e){return t.bitrate-e.bitrate}),this._levels=n;for(var p=0;p<n.length;p++)if(n[p].bitrate===e){this._firstLevel=p,s.logger.log("manifest loaded,"+n.length+" level(s) found, first bitrate:"+e);break}this.hls.trigger(a.default.MANIFEST_PARSED,{levels:n,audioTracks:r,firstLevel:this._firstLevel,stats:t.stats,audio:f,video:h,altAudio:r.some(function(t){return!!t.url})})}else this.hls.trigger(a.default.ERROR,{type:u.ErrorTypes.MEDIA_ERROR,details:u.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:this.hls.url,reason:"no level with compatible codecs found in manifest"})},Object.defineProperty(e.prototype,"levels",{get:function(){return this._levels},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"level",{get:function(){return this.currentLevelIndex},set:function(t){var e=this._levels;e&&(t=Math.min(t,e.length-1),this.currentLevelIndex===t&&e[t].details||this.setLevelInternal(t))},enumerable:!0,configurable:!0}),e.prototype.setLevelInternal=function(t){var e=this._levels,n=this.hls;if(t>=0&&t<e.length){if(this.clearTimer(),this.currentLevelIndex!==t){s.logger.log("switching to level "+t),this.currentLevelIndex=t;var r=e[t];r.level=t,n.trigger(a.default.LEVEL_SWITCHING,r)}var i=e[t],o=i.details;if(!o||o.live){var l=i.urlId;n.trigger(a.default.LEVEL_LOADING,{url:i.url[l],level:t,id:l})}}else n.trigger(a.default.ERROR,{type:u.ErrorTypes.OTHER_ERROR,details:u.ErrorDetails.LEVEL_SWITCH_ERROR,level:t,fatal:!1,reason:"invalid level idx"})},Object.defineProperty(e.prototype,"manualLevel",{get:function(){return this.manualLevelIndex},set:function(t){this.manualLevelIndex=t,void 0===this._startLevel&&(this._startLevel=t),-1!==t&&(this.level=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"firstLevel",{get:function(){return this._firstLevel},set:function(t){this._firstLevel=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"startLevel",{get:function(){if(void 0===this._startLevel){var t=this.hls.config.startLevel;return void 0!==t?t:this._firstLevel}return this._startLevel},set:function(t){this._startLevel=t},enumerable:!0,configurable:!0}),e.prototype.onError=function(t){if(t.fatal)return void(t.type===u.ErrorTypes.NETWORK_ERROR&&this.clearTimer());var e,n=!1,r=!1;switch(t.details){case u.ErrorDetails.FRAG_LOAD_ERROR:case u.ErrorDetails.FRAG_LOAD_TIMEOUT:case u.ErrorDetails.KEY_LOAD_ERROR:case u.ErrorDetails.KEY_LOAD_TIMEOUT:e=t.frag.level,r=!0;break;case u.ErrorDetails.LEVEL_LOAD_ERROR:case u.ErrorDetails.LEVEL_LOAD_TIMEOUT:e=t.context.level,n=!0;break;case u.ErrorDetails.REMUX_ALLOC_ERROR:e=t.level,n=!0}(n||r)&&this.hls.changeMirrorServer(),void 0!==e&&this.recoverLevel(t,e,n,r)},e.prototype.recoverLevel=function(t,e,n,r){var i,a,o,u=this,l=this.hls.config,c=t.details,d=this._levels[e];if(d.loadError++,d.fragmentError=r,n){if(!(this.levelRetryCount+1<=l.levelLoadingMaxRetry))return s.logger.error("level controller, cannot recover from "+c+" error"),this.currentLevelIndex=null,this.clearTimer(),void(t.fatal=!0);a=Math.min(Math.pow(2,this.levelRetryCount)*l.levelLoadingRetryDelay,l.levelLoadingMaxRetryTimeout),this.timer=setTimeout(function(){return u.loadLevel()},a),t.levelRetry=!0,this.levelRetryCount++,s.logger.warn("level controller, "+c+", retry in "+a+" ms, current retry count is "+this.levelRetryCount)}(n||r)&&(i=d.url.length,i>1&&d.loadError<i?(d.urlId=(d.urlId+1)%i,d.details=void 0,s.logger.warn("level controller, "+c+" for level "+e+": switching to redundant URL-id "+d.urlId)):-1===this.manualLevelIndex?(o=0===e?this._levels.length-1:e-1,s.logger.warn("level controller, "+c+": switch to "+o),this.hls.nextAutoLevel=this.currentLevelIndex=o):r&&(s.logger.warn("level controller, "+c+": reload a fragment"),this.currentLevelIndex=null))},e.prototype.onFragLoaded=function(t){var e=t.frag;if(void 0!==e&&"main"===e.type){var n=this._levels[e.level];void 0!==n&&(n.fragmentError=!1,n.loadError=0,this.levelRetryCount=0)}},e.prototype.onLevelLoaded=function(t){var e=this,n=t.level;if(n===this.currentLevelIndex){var r=this._levels[n];r.fragmentError||(r.loadError=0,this.levelRetryCount=0);var i=t.details;if(i.live){var a=1e3*(i.averagetargetduration?i.averagetargetduration:i.targetduration),o=a,u=r.details;u&&i.endSN===u.endSN&&(o/=2,s.logger.log("same live playlist, reload twice faster")),o-=d.now()-t.stats.trequest,o=Math.max(a/2,Math.round(o)),s.logger.log("live playlist, reload in "+Math.round(o)+" ms"),this.timer=setTimeout(function(){return e.loadLevel()},o)}else this.clearTimer()}},e.prototype.onAudioTrackSwitched=function(t){var e=this.hls.audioTracks[t.id].groupId,n=this.hls.levels[this.currentLevelIndex];if(n&&n.audioGroupIds){var r=n.audioGroupIds.findIndex(function(t){return t===e});r!==n.urlId&&(n.urlId=r,this.startLoad())}},e.prototype.loadLevel=function(){if(s.logger.debug("call to loadLevel"),null!==this.currentLevelIndex&&this.canload){var t=this._levels[this.currentLevelIndex];if("object"==typeof t&&t.url.length>0){var e=this.currentLevelIndex,n=t.urlId,r=t.url[n],i=this.hls.mirrorServer;if(""!==i){var o="";o=r.indexOf("https://")>=0?r.substring(8,r.length):r.indexOf("http://")>=0?r.substring(7,r.length):r,o=o.substr(0,o.indexOf("/"));var u=o.lastIndexOf(":");u>0&&(o=o.substr(0,u)),r=r.replace(o,i)}s.logger.log("Attempt loading level index "+e+" with URL-id "+n),this.hls.trigger(a.default.LEVEL_LOADING,{url:r,level:e,id:n})}}},Object.defineProperty(e.prototype,"nextLoadLevel",{get:function(){return-1!==this.manualLevelIndex?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(t){this.level=t,-1===this.manualLevelIndex&&(this.hls.nextAutoLevel=t)},enumerable:!0,configurable:!0}),e}(o.default);e.default=h},"./src/controller/level-helper.js":function(t,e,n){"use strict";(function(t){function r(t,e,n){switch(e){case"audio":t.audioGroupIds||(t.audioGroupIds=[]),t.audioGroupIds.push(n);break;case"text":t.textGroupIds||(t.textGroupIds=[]),t.textGroupIds.push(n)}}function i(e,n,r){var i=e[n],a=e[r],o=a.startPTS;t.isFinite(o)?r>n?(i.duration=o-i.start,i.duration<0&&s.logger.warn("negative duration computed for frag "+i.sn+",level "+i.level+", there should be some duration drift between playlist and fragment!")):(a.duration=i.start-o,a.duration<0&&s.logger.warn("negative duration computed for frag "+a.sn+",level "+a.level+", there should be some duration drift between playlist and fragment!")):a.start=r>n?i.start+i.duration:Math.max(i.start-a.duration,0)}function a(e,n,r,a,o,s){var u=r;if(t.isFinite(n.startPTS)){var l=Math.abs(n.startPTS-r);t.isFinite(n.deltaPTS)?n.deltaPTS=Math.max(l,n.deltaPTS):n.deltaPTS=l,u=Math.max(r,n.startPTS),r=Math.min(r,n.startPTS),a=Math.max(a,n.endPTS),o=Math.min(o,n.startDTS),s=Math.max(s,n.endDTS)}var c=r-n.start;n.start=n.startPTS=r,n.maxStartPTS=u,n.endPTS=a,n.startDTS=o,n.endDTS=s,n.duration=a-r;var d=n.sn;if(!e||d<e.startSN||d>e.endSN)return 0;var h,f,p;for(h=d-e.startSN,f=e.fragments,f[h]=n,p=h;p>0;p--)i(f,p,p-1);for(p=h;p<f.length-1;p++)i(f,p,p+1);return e.PTSKnown=!0,c}function o(e,n){var r,i=Math.max(e.startSN,n.startSN)-n.startSN,o=Math.min(e.endSN,n.endSN)-n.startSN,u=n.startSN-e.startSN,l=e.fragments,c=n.fragments,d=0;if(n.initSegment&&e.initSegment&&(n.initSegment=e.initSegment),o<i)return void(n.PTSKnown=!1);for(var h=i;h<=o;h++){var f=l[u+h],p=c[h];p&&f&&(d=f.cc-p.cc,t.isFinite(f.startPTS)&&(p.start=p.startPTS=f.startPTS,p.endPTS=f.endPTS,p.duration=f.duration,p.backtracked=f.backtracked,p.dropped=f.dropped,r=p))}if(d)for(s.logger.log("discontinuity sliding from playlist, take drift into account"),h=0;h<c.length;h++)c[h].cc+=d;if(r)a(n,r,r.startPTS,r.endPTS,r.startDTS,r.endDTS);else if(u>=0&&u<l.length){var m=l[u].start;for(h=0;h<c.length;h++)c[h].start+=m}n.PTSKnown=e.PTSKnown}Object.defineProperty(e,"__esModule",{value:!0});var s=n("./src/utils/logger.js");e.addGroupId=r,e.updatePTS=i,e.updateFragPTSDTS=a,e.mergeDetails=o}).call(this,n("./src/polyfills/number.js")["Number"])},"./src/controller/stream-controller.js":function(t,e,n){"use strict";(function(t){var r=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var i=n("./src/utils/binary-search.js"),a=n("./src/utils/buffer-helper.js"),o=n("./src/demux/demuxer.js"),s=n("./src/events.js"),u=n("./src/controller/fragment-tracker.js"),l=n("./src/loader/fragment.js"),c=n("./src/loader/playlist-loader.js"),d=n("./src/controller/level-helper.js"),h=n("./src/utils/time-ranges.js"),f=n("./src/errors.js"),p=n("./src/utils/logger.js"),m=n("./src/utils/discontinuities.js"),g=n("./src/controller/fragment-finders.js"),v=n("./src/controller/gap-controller.js"),y=n("./src/controller/base-stream-controller.js"),_=function(e){function n(t,n){var r=e.call(this,t,s.default.MEDIA_ATTACHED,s.default.MEDIA_DETACHING,s.default.MANIFEST_LOADING,s.default.MANIFEST_PARSED,s.default.LEVEL_LOADED,s.default.KEY_LOADED,s.default.FRAG_LOADED,s.default.FRAG_LOAD_EMERGENCY_ABORTED,s.default.FRAG_PARSING_INIT_SEGMENT,s.default.FRAG_PARSING_DATA,s.default.FRAG_PARSED,s.default.ERROR,s.default.AUDIO_TRACK_SWITCHING,s.default.AUDIO_TRACK_SWITCHED,s.default.BUFFER_CREATED,s.default.BUFFER_APPENDED,s.default.BUFFER_FLUSHED)||this;return r.fragmentTracker=n,r.config=t.config,r.audioCodecSwap=!1,r._state=y.State.STOPPED,r.stallReported=!1,r.gapController=null,r}return r(n,e),n.prototype.onHandlerDestroying=function(){this.stopLoad(),e.prototype.onHandlerDestroying.call(this)},n.prototype.onHandlerDestroyed=function(){this.state=y.State.STOPPED,this.fragmentTracker=null,e.prototype.onHandlerDestroyed.call(this)},n.prototype.startLoad=function(t){if(this.levels){var e=this.lastCurrentTime,n=this.hls;if(this.stopLoad(),this.setInterval(100),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var r=n.startLevel;-1===r&&(r=0,this.bitrateTest=!0),this.level=n.nextLoadLevel=r,this.loadedmetadata=!1}e>0&&-1===t&&(p.logger.log("override startPosition with lastCurrentTime @"+e.toFixed(3)),t=e),this.state=y.State.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=t,this.tick()}else this.forceStartLoad=!0,this.state=y.State.STOPPED},n.prototype.stopLoad=function(){var t=this.fragCurrent;t&&(t.loader&&t.loader.abort(),this.fragmentTracker.removeFragment(t),this.fragCurrent=null),this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.clearInterval(),this.state=y.State.STOPPED,this.forceStartLoad=!1},n.prototype.doTick=function(){switch(this.state){case y.State.BUFFER_FLUSHING:this.fragLoadError=0;break;case y.State.IDLE:this._doTickIdle();break;case y.State.WAITING_LEVEL:var t=this.levels[this.level];t&&t.details&&(this.state=y.State.IDLE);break;case y.State.FRAG_LOADING_WAITING_RETRY:var e=window.performance.now(),n=this.retryDate;(!n||e>=n||this.media&&this.media.seeking)&&(p.logger.log("mediaController: retryDate reached, switch back to IDLE state"),this.state=y.State.IDLE);break;case y.State.ERROR:case y.State.STOPPED:case y.State.FRAG_LOADING:case y.State.PARSING:case y.State.PARSED:case y.State.ENDED:}this._checkBuffer(),this._checkFragmentChanged()},n.prototype._doTickIdle=function(){var t=this.hls,e=t.config,n=this.media;if(void 0!==this.levelLastLoaded&&(n||!this.startFragRequested&&e.startFragPrefetch)){var r;r=this.loadedmetadata?n.currentTime:this.nextLoadPosition;var i=t.nextLoadLevel,o=this.levels[i];if(o){var u,l=o.bitrate;u=l?Math.max(8*e.maxBufferSize/l,e.maxBufferLength):e.maxBufferLength,u=Math.min(u,e.maxMaxBufferLength);var c=a.BufferHelper.bufferInfo(this.mediaBuffer?this.mediaBuffer:n,r,e.maxBufferHole),d=c.len;if(!(d>=u)){p.logger.trace("buffer length of "+d.toFixed(3)+" is below max of "+u.toFixed(3)+". checking for more payload ..."),this.level=t.nextLoadLevel=i;var h=o.details;if(!h||h.live&&this.levelLastLoaded!==i)return void(this.state=y.State.WAITING_LEVEL);if(this._streamEnded(c,h)){var f={};return this.altAudio&&(f.type="video"),this.hls.trigger(s.default.BUFFER_EOS,f),void(this.state=y.State.ENDED)}this._fetchPayloadOrEos(r,c,h)}}}},n.prototype._fetchPayloadOrEos=function(t,e,n){var r=this.fragPrevious,i=this.level,a=n.fragments,o=a.length;if(0!==o){var s,u=a[0].start,l=a[o-1].start+a[o-1].duration,c=e.end;if(n.initSegment&&!n.initSegment.data)s=n.initSegment;else if(n.live){var d=this.config.initialLiveManifestSize;if(o<d)return void p.logger.warn("Can not start playback of a level, reason: not enough fragments "+o+" < "+d);if(null===(s=this._ensureFragmentAtLivePoint(n,c,u,l,r,a,o)))return}else c<u&&(s=a[0]);s||(s=this._findFragment(u,r,o,a,c,l,n)),s&&(s.encrypted?(p.logger.log("Loading key for "+s.sn+" of ["+n.startSN+" ,"+n.endSN+"],level "+i),this._loadKey(s)):(p.logger.log("Loading "+s.sn+" of ["+n.startSN+" ,"+n.endSN+"],level "+i+", currentTime:"+t.toFixed(3)+",bufferEnd:"+c.toFixed(3)),this._loadFragment(s)))}},n.prototype._ensureFragmentAtLivePoint=function(t,e,n,r,a,o,s){var u,l=this.hls.config,c=this.media,d=void 0!==l.liveMaxLatencyDuration?l.liveMaxLatencyDuration:l.liveMaxLatencyDurationCount*t.targetduration;if(e<Math.max(n-l.maxFragLookUpTolerance,r-d)){var h=this.liveSyncPosition=this.computeLivePosition(n,t);p.logger.log("buffer end: "+e.toFixed(3)+" is located too far from the end of live sliding playlist, reset currentTime to : "+h.toFixed(3)),e=h,c&&c.readyState&&c.duration>h&&(c.currentTime=h),this.nextLoadPosition=h}if(t.PTSKnown&&e>r&&c&&c.readyState)return null;if(this.startFragRequested&&!t.PTSKnown){if(a)if(t.hasProgramDateTime)p.logger.log("live playlist, switching playlist, load frag with same PDT: "+a.programDateTime),u=g.findFragmentByPDT(o,a.endProgramDateTime,l.maxFragLookUpTolerance);else{var f=a.sn+1;if(f>=t.startSN&&f<=t.endSN){var m=o[f-t.startSN];a.cc===m.cc&&(u=m,p.logger.log("live playlist, switching playlist, load frag with next SN: "+u.sn))}u||(u=i.default.search(o,function(t){return a.cc-t.cc}))&&p.logger.log("live playlist, switching playlist, load frag with same CC: "+u.sn)}u||(u=o[Math.min(s-1,Math.round(s/2))],p.logger.log("live playlist, switching playlist, unknown, load middle frag : "+u.sn))}return u},n.prototype._findFragment=function(t,e,n,r,i,a,o){var s,u=this.hls.config;if(i<a){var l=i>a-u.maxFragLookUpTolerance?0:u.maxFragLookUpTolerance;s=g.findFragmentByPTS(e,r,i,l)}else s=r[n-1];if(s){var c=s.sn-o.startSN,d=e&&s.level===e.level,h=r[c-1],f=r[c+1];if(e&&s.sn===e.sn)if(d&&!s.backtracked)if(s.sn<o.endSN){var m=e.deltaPTS;m&&m>u.maxBufferHole&&e.dropped&&c?(s=h,p.logger.warn("SN just loaded, with large PTS gap between audio and video, maybe frag is not starting with a keyframe ? load previous one to try to overcome this")):(s=f,p.logger.log("SN just loaded, load next one: "+s.sn,s))}else s=null;else s.backtracked&&(f&&f.backtracked?(p.logger.warn("Already backtracked from fragment "+f.sn+", will not backtrack to fragment "+s.sn+". Loading fragment "+f.sn),s=f):(p.logger.warn("Loaded fragment with dropped frames, backtracking 1 segment to find a keyframe"),s.dropped=0,h?(s=h,s.backtracked=!0):c&&(s=null)))}return s},n.prototype._loadKey=function(t){this.state=y.State.KEY_LOADING,this.hls.trigger(s.default.KEY_LOADING,{frag:t})},n.prototype._loadFragment=function(e){var n=this.fragmentTracker.getState(e);this.fragCurrent=e,this.startFragRequested=!0,t.isFinite(e.sn)&&!e.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),e.backtracked||n===u.FragmentState.NOT_LOADED||n===u.FragmentState.PARTIAL?(e.autoLevel=this.hls.autoLevelEnabled,e.bitrateTest=this.bitrateTest,this.hls.trigger(s.default.FRAG_LOADING,{frag:e}),this.demuxer||(this.demuxer=new o.default(this.hls,"main")),this.state=y.State.FRAG_LOADING):n===u.FragmentState.APPENDING&&this._reduceMaxBufferLength(e.duration)&&this.fragmentTracker.removeFragment(e)},Object.defineProperty(n.prototype,"state",{get:function(){return this._state},set:function(t){if(this.state!==t){var e=this.state;this._state=t,p.logger.log("main stream:"+e+"->"+t),this.hls.trigger(s.default.STREAM_STATE_TRANSITION,{previousState:e,nextState:t})}},enumerable:!0,configurable:!0}),n.prototype.getBufferedFrag=function(t){return this.fragmentTracker.getBufferedFrag(t,c.default.LevelType.MAIN)},Object.defineProperty(n.prototype,"currentLevel",{get:function(){var t=this.media;if(t){var e=this.getBufferedFrag(t.currentTime);if(e)return e.level}return-1},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"nextBufferedFrag",{get:function(){var t=this.media;return t?this.followingBufferedFrag(this.getBufferedFrag(t.currentTime)):null},enumerable:!0,configurable:!0}),n.prototype.followingBufferedFrag=function(t){return t?this.getBufferedFrag(t.endPTS+.5):null},Object.defineProperty(n.prototype,"nextLevel",{get:function(){var t=this.nextBufferedFrag;return t?t.level:-1},enumerable:!0,configurable:!0}),n.prototype._checkFragmentChanged=function(){var t,e,n=this.media;if(n&&n.readyState&&!1===n.seeking&&(e=n.currentTime,e>this.lastCurrentTime&&(this.lastCurrentTime=e),a.BufferHelper.isBuffered(n,e)?t=this.getBufferedFrag(e):a.BufferHelper.isBuffered(n,e+.1)&&(t=this.getBufferedFrag(e+.1)),t)){var r=t;if(r!==this.fragPlaying){this.hls.trigger(s.default.FRAG_CHANGED,{frag:r});var i=r.level;this.fragPlaying&&this.fragPlaying.level===i||this.hls.trigger(s.default.LEVEL_SWITCHED,{level:i}),this.fragPlaying=r}}},n.prototype.immediateLevelSwitch=function(){if(p.logger.log("immediateLevelSwitch"),!this.immediateSwitch){this.immediateSwitch=!0;var e=this.media,n=void 0;e?(n=e.paused,e.pause()):n=!0,this.previouslyPaused=n}var r=this.fragCurrent;r&&r.loader&&r.loader.abort(),this.fragCurrent=null,this.flushMainBuffer(0,t.POSITIVE_INFINITY)},n.prototype.immediateLevelSwitchEnd=function(){var t=this.media;t&&t.buffered.length&&(this.immediateSwitch=!1,a.BufferHelper.isBuffered(t,t.currentTime)&&(t.currentTime-=1e-4),this.previouslyPaused||t.play())},n.prototype.nextLevelSwitch=function(){var e=this.media;if(e&&e.readyState){var n=void 0,r=void 0,i=void 0;if(r=this.getBufferedFrag(e.currentTime),r&&r.startPTS>1&&this.flushMainBuffer(0,r.startPTS-1),e.paused)n=0;else{var a=this.hls.nextLoadLevel,o=this.levels[a],s=this.fragLastKbps;n=s&&this.fragCurrent?this.fragCurrent.duration*o.bitrate/(1e3*s)+1:0}if((i=this.getBufferedFrag(e.currentTime+n))&&(i=this.followingBufferedFrag(i))){var u=this.fragCurrent;u&&u.loader&&u.loader.abort(),this.fragCurrent=null,this.flushMainBuffer(i.maxStartPTS,t.POSITIVE_INFINITY)}}},n.prototype.flushMainBuffer=function(t,e){this.state=y.State.BUFFER_FLUSHING;var n={startOffset:t,endOffset:e};this.altAudio&&(n.type="video"),this.hls.trigger(s.default.BUFFER_FLUSHING,n)},n.prototype.onMediaAttached=function(t){var e=this.media=this.mediaBuffer=t.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),this.onvended=this.onMediaEnded.bind(this),e.addEventListener("seeking",this.onvseeking),e.addEventListener("seeked",this.onvseeked),e.addEventListener("ended",this.onvended);var n=this.config;this.levels&&n.autoStartLoad&&this.hls.startLoad(n.startPosition),this.gapController=new v.default(n,e,this.fragmentTracker,this.hls)},n.prototype.onMediaDetaching=function(){var t=this.media;t&&t.ended&&(p.logger.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0);var e=this.levels;e&&e.forEach(function(t){t.details&&t.details.fragments.forEach(function(t){t.backtracked=void 0})}),t&&(t.removeEventListener("seeking",this.onvseeking),t.removeEventListener("seeked",this.onvseeked),t.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.stopLoad()},n.prototype.onMediaSeeked=function(){var e=this.media,n=e?e.currentTime:void 0;t.isFinite(n)&&p.logger.log("media seeked to "+n.toFixed(3)),this.tick()},n.prototype.onManifestLoading=function(){p.logger.log("trigger BUFFER_RESET"),this.hls.trigger(s.default.BUFFER_RESET),this.fragmentTracker.removeAllFragments(),this.stalled=!1,this.startPosition=this.lastCurrentTime=0},n.prototype.onManifestParsed=function(t){var e,n=!1,r=!1;t.levels.forEach(function(t){(e=t.audioCodec)&&(-1!==e.indexOf("mp4a.40.2")&&(n=!0),-1!==e.indexOf("mp4a.40.5")&&(r=!0))}),this.audioCodecSwitch=n&&r,this.audioCodecSwitch&&p.logger.log("both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1;var i=this.config;(i.autoStartLoad||this.forceStartLoad)&&this.hls.startLoad(i.startPosition)},n.prototype.onLevelLoaded=function(e){var n=e.details,r=e.level,i=this.levels[this.levelLastLoaded],a=this.levels[r],o=n.totalduration,u=0;if(p.logger.log("level "+r+" loaded ["+n.startSN+","+n.endSN+"],duration:"+o),n.live){var l=a.details;l&&n.fragments.length>0?(d.mergeDetails(l,n),u=n.fragments[0].start,this.liveSyncPosition=this.computeLivePosition(u,l),n.PTSKnown&&t.isFinite(u)?p.logger.log("live playlist sliding:"+u.toFixed(3)):(p.logger.log("live playlist - outdated PTS, unknown sliding"),m.alignStream(this.fragPrevious,i,n))):(p.logger.log("live playlist - first load, unknown sliding"),n.PTSKnown=!1,m.alignStream(this.fragPrevious,i,n))}else n.PTSKnown=!1;if(a.details=n,this.levelLastLoaded=r,this.hls.trigger(s.default.LEVEL_UPDATED,{details:n,level:r}),!1===this.startFragRequested){if(-1===this.startPosition||-1===this.lastCurrentTime){var c=n.startTimeOffset;t.isFinite(c)?(c<0&&(p.logger.log("negative start time offset "+c+", count from end of last fragment"),c=u+o+c),p.logger.log("start time offset found in playlist, adjust startPosition to "+c),this.startPosition=c):n.live?(this.startPosition=this.computeLivePosition(u,n),p.logger.log("configure startPosition to "+this.startPosition)):this.startPosition=0,this.lastCurrentTime=this.startPosition}this.nextLoadPosition=this.startPosition}this.state===y.State.WAITING_LEVEL&&(this.state=y.State.IDLE),this.tick()},n.prototype.onKeyLoaded=function(){this.state===y.State.KEY_LOADING&&(this.state=y.State.IDLE,this.tick())},n.prototype.onFragLoaded=function(t){var e=this,n=e.fragCurrent,r=e.hls,i=e.levels,a=e.media,u=t.frag;if(this.state===y.State.FRAG_LOADING&&n&&"main"===u.type&&u.level===n.level&&u.sn===n.sn){var l=t.stats,c=i[n.level],d=c.details;if(this.bitrateTest=!1,this.stats=l,p.logger.log("Loaded "+n.sn+" of ["+d.startSN+" ,"+d.endSN+"],level "+n.level),u.bitrateTest&&r.nextLoadLevel)this.state=y.State.IDLE,this.startFragRequested=!1,l.tparsed=l.tbuffered=window.performance.now(),r.trigger(s.default.FRAG_BUFFERED,{stats:l,frag:n,id:"main"}),this.tick();else if("initSegment"===u.sn)this.state=y.State.IDLE,l.tparsed=l.tbuffered=window.performance.now(),d.initSegment.data=t.payload,r.trigger(s.default.FRAG_BUFFERED,{stats:l,frag:n,id:"main"}),this.tick();else{p.logger.log("Parsing "+n.sn+" of ["+d.startSN+" ,"+d.endSN+"],level "+n.level+", cc "+n.cc),this.state=y.State.PARSING,this.pendingBuffering=!0,this.appended=!1,u.bitrateTest&&(u.bitrateTest=!1,this.fragmentTracker.onFragLoaded({frag:u}));var h=!(a&&a.seeking)&&(d.PTSKnown||!d.live),f=d.initSegment?d.initSegment.data:[],m=this._getAudioCodec(c),g=this.demuxer=this.demuxer||new o.default(this.hls,"main");g.push(t.payload,f,m,c.videoCodec,n,d.totalduration,h)}}this.fragLoadError=0},n.prototype.onFragParsingInitSegment=function(t){var e=this.fragCurrent,n=t.frag;if(e&&"main"===t.id&&n.sn===e.sn&&n.level===e.level&&this.state===y.State.PARSING){var r=t.tracks,i=void 0,a=void 0;if(r.audio&&this.altAudio&&delete r.audio,a=r.audio){var o=this.levels[this.level].audioCodec,u=navigator.userAgent.toLowerCase();o&&this.audioCodecSwap&&(p.logger.log("swapping playlist audio codec"),o=-1!==o.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),this.audioCodecSwitch&&1!==a.metadata.channelCount&&-1===u.indexOf("firefox")&&(o="mp4a.40.5"),-1!==u.indexOf("android")&&"audio/mpeg"!==a.container&&(o="mp4a.40.2",p.logger.log("Android: force audio codec to "+o)),a.levelCodec=o,a.id=t.id}a=r.video,a&&(a.levelCodec=this.levels[this.level].videoCodec,a.id=t.id),this.hls.trigger(s.default.BUFFER_CODECS,r);for(i in r){a=r[i],p.logger.log("main track:"+i+",container:"+a.container+",codecs[level/parsed]=["+a.levelCodec+"/"+a.codec+"]");var l=a.initSegment;l&&(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(s.default.BUFFER_APPENDING,{type:i,data:l,parent:"main",content:"initSegment"}))}this.tick()}},n.prototype.onFragParsingData=function(e){var n=this,r=this.fragCurrent,i=e.frag;if(r&&"main"===e.id&&i.sn===r.sn&&i.level===r.level&&("audio"!==e.type||!this.altAudio)&&this.state===y.State.PARSING){var a=this.levels[this.level],o=r;if(t.isFinite(e.endPTS)||(e.endPTS=e.startPTS+r.duration,e.endDTS=e.startDTS+r.duration),!0===e.hasAudio&&o.addElementaryStream(l.default.ElementaryStreamTypes.AUDIO),!0===e.hasVideo&&o.addElementaryStream(l.default.ElementaryStreamTypes.VIDEO),p.logger.log("Parsed "+e.type+",PTS:["+e.startPTS.toFixed(3)+","+e.endPTS.toFixed(3)+"],DTS:["+e.startDTS.toFixed(3)+"/"+e.endDTS.toFixed(3)+"],nb:"+e.nb+",dropped:"+(e.dropped||0)),"video"===e.type)if(o.dropped=e.dropped,o.dropped)if(o.backtracked)p.logger.warn("Already backtracked on this fragment, appending with the gap",o.sn);else{var u=a.details;if(!u||o.sn!==u.startSN)return p.logger.warn("missing video frame(s), backtracking fragment",o.sn),this.fragmentTracker.removeFragment(o),o.backtracked=!0,this.nextLoadPosition=e.startPTS,this.state=y.State.IDLE,this.fragPrevious=o,void this.tick();p.logger.warn("missing video frame(s) on first frag, appending with gap",o.sn)}else o.backtracked=!1;var c=d.updateFragPTSDTS(a.details,o,e.startPTS,e.endPTS,e.startDTS,e.endDTS),h=this.hls;h.trigger(s.default.LEVEL_PTS_UPDATED,{details:a.details,level:this.level,drift:c,type:e.type,start:e.startPTS,end:e.endPTS}),[e.data1,e.data2].forEach(function(t){t&&t.length&&n.state===y.State.PARSING&&(n.appended=!0,n.pendingBuffering=!0,h.trigger(s.default.BUFFER_APPENDING,{type:e.type,data:t,parent:"main",content:"data"}))}),this.tick()}},n.prototype.onFragParsed=function(t){var e=this.fragCurrent,n=t.frag;e&&"main"===t.id&&n.sn===e.sn&&n.level===e.level&&this.state===y.State.PARSING&&(this.stats.tparsed=window.performance.now(),this.state=y.State.PARSED,this._checkAppendedParsed())},n.prototype.onAudioTrackSwitching=function(e){var n=!!e.url,r=e.id;if(!n){if(this.mediaBuffer!==this.media){p.logger.log("switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var i=this.fragCurrent;i.loader&&(p.logger.log("switching to main audio track, cancel main fragment load"),i.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=y.State.IDLE}var a=this.hls;a.trigger(s.default.BUFFER_FLUSHING,{startOffset:0,endOffset:t.POSITIVE_INFINITY,type:"audio"}),a.trigger(s.default.AUDIO_TRACK_SWITCHED,{id:r}),this.altAudio=!1}},n.prototype.onAudioTrackSwitched=function(t){var e=t.id,n=!!this.hls.audioTracks[e].url;if(n){var r=this.videoBuffer;r&&this.mediaBuffer!==r&&(p.logger.log("switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=r)}this.altAudio=n,this.tick()},n.prototype.onBufferCreated=function(t){var e,n,r=t.tracks,i=!1;for(var a in r){var o=r[a];"main"===o.id?(n=a,e=o,"video"===a&&(this.videoBuffer=r[a].buffer)):i=!0}i&&e?(p.logger.log("alternate track found, use "+n+".buffered to schedule main fragment loading"),this.mediaBuffer=e.buffer):this.mediaBuffer=this.media},n.prototype.onBufferAppended=function(t){if("main"===t.parent){var e=this.state;e!==y.State.PARSING&&e!==y.State.PARSED||(this.pendingBuffering=t.pending>0,this._checkAppendedParsed())}},n.prototype._checkAppendedParsed=function(){if(!(this.state!==y.State.PARSED||this.appended&&this.pendingBuffering)){var t=this.fragCurrent;if(t){var e=this.mediaBuffer?this.mediaBuffer:this.media;p.logger.log("main buffered : "+h.default.toString(e.buffered)),this.fragPrevious=t;var n=this.stats;n.tbuffered=window.performance.now(),this.fragLastKbps=Math.round(8*n.total/(n.tbuffered-n.tfirst)),this.hls.trigger(s.default.FRAG_BUFFERED,{stats:n,frag:t,id:"main"}),this.state=y.State.IDLE}this.tick()}},n.prototype.onError=function(e){var n=e.frag||this.fragCurrent;if(!n||"main"===n.type){var r=!!this.media&&a.BufferHelper.isBuffered(this.media,this.media.currentTime)&&a.BufferHelper.isBuffered(this.media,this.media.currentTime+.5);switch(e.details){case f.ErrorDetails.FRAG_LOAD_ERROR:case f.ErrorDetails.FRAG_LOAD_TIMEOUT:case f.ErrorDetails.KEY_LOAD_ERROR:case f.ErrorDetails.KEY_LOAD_TIMEOUT:if(!e.fatal)if(this.fragLoadError+1<=this.config.fragLoadingMaxRetry){var i=Math.min(Math.pow(2,this.fragLoadError)*this.config.fragLoadingRetryDelay,this.config.fragLoadingMaxRetryTimeout);p.logger.warn("mediaController: frag loading failed, retry in "+i+" ms"),this.retryDate=window.performance.now()+i,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.fragLoadError++,this.state=y.State.FRAG_LOADING_WAITING_RETRY}else p.logger.error("mediaController: "+e.details+" reaches max retry, redispatch as fatal ..."),e.fatal=!0,this.state=y.State.ERROR;break;case f.ErrorDetails.LEVEL_LOAD_ERROR:case f.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==y.State.ERROR&&(e.fatal?(this.state=y.State.ERROR,p.logger.warn("streamController: "+e.details+",switch to "+this.state+" state ...")):e.levelRetry||this.state!==y.State.WAITING_LEVEL||(this.state=y.State.IDLE));break;case f.ErrorDetails.BUFFER_FULL_ERROR:"main"!==e.parent||this.state!==y.State.PARSING&&this.state!==y.State.PARSED||(r?(this._reduceMaxBufferLength(this.config.maxBufferLength),this.state=y.State.IDLE):(p.logger.warn("buffer full error also media.currentTime is not buffered, flush everything"),this.fragCurrent=null,this.flushMainBuffer(0,t.POSITIVE_INFINITY)))}}},n.prototype._reduceMaxBufferLength=function(t){var e=this.config;return e.maxMaxBufferLength>=t&&(e.maxMaxBufferLength/=2,p.logger.warn("main:reduce max buffer length to "+e.maxMaxBufferLength+"s"),!0)},n.prototype._checkBuffer=function(){var t=this.media;if(t&&0!==t.readyState){var e=this.mediaBuffer?this.mediaBuffer:t,n=e.buffered;!this.loadedmetadata&&n.length?(this.loadedmetadata=!0,this._seekToStartPos()):this.immediateSwitch?this.immediateLevelSwitchEnd():this.gapController.poll(this.lastCurrentTime,n)}},n.prototype.onFragLoadEmergencyAborted=function(){this.state=y.State.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tick()},n.prototype.onBufferFlushed=function(){var t=this.mediaBuffer?this.mediaBuffer:this.media;t&&this.fragmentTracker.detectEvictedFragments(l.default.ElementaryStreamTypes.VIDEO,t.buffered),this.state=y.State.IDLE,this.fragPrevious=null},n.prototype.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},n.prototype.computeLivePosition=function(t,e){var n=void 0!==this.config.liveSyncDuration?this.config.liveSyncDuration:this.config.liveSyncDurationCount*e.targetduration;return t+Math.max(0,e.totalduration-n)},n.prototype._seekToStartPos=function(){var t=this.media,e=t.currentTime,n=t.seeking?e:this.startPosition;e!==n&&(p.logger.log("target start position not buffered, seek to buffered.start(0) "+n+" from current time "+e+" "),t.currentTime=n)},n.prototype._getAudioCodec=function(t){var e=this.config.defaultAudioCodec||t.audioCodec;return this.audioCodecSwap&&(p.logger.log("swapping playlist audio codec"),e&&(e=-1!==e.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5")),e},Object.defineProperty(n.prototype,"liveSyncPosition",{get:function(){return this._liveSyncPosition},set:function(t){this._liveSyncPosition=t},enumerable:!0,configurable:!0}),n}(y.default);e.default=_}).call(this,n("./src/polyfills/number.js")["Number"])},"./src/controller/subtitle-stream-controller.js":function(t,e,n){"use strict";var r=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var i=n("./src/events.js"),a=n("./src/utils/logger.js"),o=n("./src/crypt/decrypter.js"),s=n("./src/task-loop.js"),u=n("./src/utils/buffer-helper.js"),l=n("./src/controller/fragment-finders.js"),c=n("./src/controller/fragment-tracker.js"),d=window.performance;e.SubtitleStreamControllerState={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING"};var h=e.SubtitleStreamControllerState,f=function(t){function e(e,n){var r=t.call(this,e,i.default.MEDIA_ATTACHED,i.default.MEDIA_DETACHING,i.default.ERROR,i.default.KEY_LOADED,i.default.FRAG_LOADED,i.default.SUBTITLE_TRACKS_UPDATED,i.default.SUBTITLE_TRACK_SWITCH,i.default.SUBTITLE_TRACK_LOADED,i.default.SUBTITLE_FRAG_PROCESSED)||this;return r.fragmentTracker=n,r.config=e.config,r.state=h.STOPPED,r.tracks=[],r.tracksBuffered=[],r.currentTrackId=-1,r.decrypter=new o.default(e,e.config),r}return r(e,t),e.prototype.onHandlerDestroyed=function(){this.fragmentTracker=null,this.state=h.STOPPED,t.prototype.onHandlerDestroyed.call(this)},e.prototype.onSubtitleFragProcessed=function(t){if(this.state=h.IDLE,t.success){var e=this.tracksBuffered[this.currentTrackId],n=t.frag;if(this.fragPrevious=n,e){for(var r,i=0;i<e.length;i++)if(n.start>=e[i].start&&n.start<=e[i].end){r=e[i];break}r?r.end=n.start+n.duration:e.push({start:n.start,end:n.start+n.duration})}}},e.prototype.onMediaAttached=function(t){this.media=t.media,this.state=h.IDLE},e.prototype.onMediaDetaching=function(){this.media=null,this.state=h.STOPPED},e.prototype.onError=function(t){var e=t.frag;e&&"subtitle"===e.type&&(this.state=h.IDLE)},e.prototype.onSubtitleTracksUpdated=function(t){var e=this;a.logger.log("subtitle tracks updated"),this.tracksBuffered=[],this.tracks=t.subtitleTracks,this.tracks.forEach(function(t){e.tracksBuffered[t.id]=[]})},e.prototype.onSubtitleTrackSwitch=function(t){if(this.currentTrackId=t.id,!this.tracks||-1===this.currentTrackId)return void this.clearInterval();var e=this.tracks[this.currentTrackId];e&&e.details&&this.setInterval(500)},e.prototype.onSubtitleTrackLoaded=function(t){var e=t.id,n=t.details;if(!this.tracks)return void a.logger.warn("Can not update subtitle details, no tracks found");this.tracks[e]&&(a.logger.log("Updating subtitle track details"),this.tracks[e].details=n),this.setInterval(500)},e.prototype.onKeyLoaded=function(){this.state===h.KEY_LOADING&&(this.state=h.IDLE)},e.prototype.onFragLoaded=function(t){var e=this.fragCurrent,n=t.frag.decryptdata,r=t.frag,a=this.hls;if(this.state===h.FRAG_LOADING&&e&&"subtitle"===t.frag.type&&e.sn===t.frag.sn&&t.payload.byteLength>0&&n&&n.key&&"AES-128"===n.method){var o=d.now();this.decrypter.decrypt(t.payload,n.key.buffer,n.iv.buffer,function(t){var e=d.now();a.trigger(i.default.FRAG_DECRYPTED,{frag:r,payload:t,stats:{tstart:o,tdecrypt:e}})})}},e.prototype.doTick=function(){if(!this.media)return void(this.state=h.IDLE);switch(this.state){case h.IDLE:var t=this.tracks,e=this.currentTrackId;if(!t||!t[e]||!t[e].details)break;var n=t[e].details,r=this.config,o=r.maxBufferHole,s=Math.min(r.maxBufferLength,r.maxMaxBufferLength),d=r.maxFragLookUpTolerance,f=u.BufferHelper.bufferedInfo(this._getBuffered(),this.media.currentTime,o),p=f.end,m=f.len,g=n.fragments,v=g.length,y=g[v-1].start+g[v-1].duration,_=void 0;m<s&&p<y?_=l.findFragmentByPTS(this.fragPrevious,g,p,d):n.hasProgramDateTime&&this.fragPrevious&&(_=l.findFragmentByPDT(g,this.fragPrevious.endProgramDateTime,d)),_&&_.encrypted?(a.logger.log("Loading key for "+_.sn),this.state=h.KEY_LOADING,this.hls.trigger(i.default.KEY_LOADING,{frag:_})):_&&this.fragmentTracker.getState(_)===c.FragmentState.NOT_LOADED&&(_.trackId=e,this.fragCurrent=_,this.state=h.FRAG_LOADING,this.hls.trigger(i.default.FRAG_LOADING,{frag:_}))}},e.prototype._getBuffered=function(){return this.tracksBuffered[this.currentTrackId]||[]},e}(s.default);e.SubtitleStreamController=f},"./src/controller/subtitle-track-controller.js":function(t,e,n){"use strict";function r(t){for(var e=[],n=0;n<t.length;n++)"subtitles"===t[n].kind&&e.push(t[n]);return e}var i=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var a=n("./src/events.js"),o=n("./src/event-handler.js"),s=n("./src/utils/logger.js"),u=function(t){function e(e){var n=t.call(this,e,a.default.MEDIA_ATTACHED,a.default.MEDIA_DETACHING,a.default.MANIFEST_LOADING,a.default.MANIFEST_LOADED,a.default.SUBTITLE_TRACK_LOADED)||this;return n.tracks=[],n.trackId=-1,n.media=null,n.subtitleDisplay=!0,n}return i(e,t),e.prototype._onTextTracksChanged=function(){if(this.media){for(var t=-1,e=r(this.media.textTracks),n=0;n<e.length;n++)if("hidden"===e[n].mode)t=n;else if("showing"===e[n].mode){t=n;break}this.subtitleTrack=t}},e.prototype.destroy=function(){o.default.prototype.destroy.call(this)},e.prototype.onMediaAttached=function(t){var e=this;this.media=t.media,this.media&&(this.queuedDefaultTrack&&(this.subtitleTrack=this.queuedDefaultTrack,delete this.queuedDefaultTrack),this.trackChangeListener=this._onTextTracksChanged.bind(this),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.subtitlePollingInterval=setInterval(function(){e.trackChangeListener()},500):this.media.textTracks.addEventListener("change",this.trackChangeListener))},e.prototype.onMediaDetaching=function(){this.media&&(this.useTextTrackPolling?clearInterval(this.subtitlePollingInterval):this.media.textTracks.removeEventListener("change",this.trackChangeListener),this.media=null)},e.prototype.onManifestLoading=function(){this.tracks=[],this.trackId=-1},e.prototype.onManifestLoaded=function(t){var e=this,n=t.subtitles||[];this.tracks=n,this.trackId=-1,this.hls.trigger(a.default.SUBTITLE_TRACKS_UPDATED,{subtitleTracks:n}),n.forEach(function(t){t.default&&(e.media?e.subtitleTrack=t.id:e.queuedDefaultTrack=t.id)})},e.prototype.onTick=function(){var t=this.trackId,e=this.tracks[t];if(e){var n=e.details;n&&!n.live||(s.logger.log("(re)loading playlist for subtitle track "+t),this.hls.trigger(a.default.SUBTITLE_TRACK_LOADING,{url:e.url,id:t}))}},e.prototype.onSubtitleTrackLoaded=function(t){var e=this;t.id<this.tracks.length&&(s.logger.log("subtitle track "+t.id+" loaded"),this.tracks[t.id].details=t.details,t.details.live&&!this.timer&&(this.timer=setInterval(function(){e.onTick()},1e3*t.details.targetduration,this)),!t.details.live&&this.timer&&this._stopTimer())},Object.defineProperty(e.prototype,"subtitleTracks",{get:function(){return this.tracks},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"subtitleTrack",{get:function(){return this.trackId},set:function(t){this.trackId!==t&&(this._toggleTrackModes(t),this.setSubtitleTrackInternal(t))},enumerable:!0,configurable:!0}),e.prototype.setSubtitleTrackInternal=function(t){var e=this,n=e.hls,r=e.tracks;if(!("number"!=typeof t||t<-1||t>=r.length)&&(this._stopTimer(),this.trackId=t,s.logger.log("switching to subtitle track "+t),n.trigger(a.default.SUBTITLE_TRACK_SWITCH,{id:t}),-1!==t)){var i=r[t],o=i.details;o&&!o.live||(s.logger.log("(re)loading playlist for subtitle track "+t),n.trigger(a.default.SUBTITLE_TRACK_LOADING,{url:i.url,id:t}))}},e.prototype._stopTimer=function(){this.timer&&(clearInterval(this.timer),this.timer=null)},e.prototype._toggleTrackModes=function(t){var e=this,n=e.media,i=e.subtitleDisplay,a=e.trackId;if(n){var o=r(n.textTracks);if(-1===t)[].slice.call(o).forEach(function(t){t.mode="disabled"});else{var s=o[a];s&&(s.mode="disabled")}var u=o[t];u&&(u.mode=i?"showing":"hidden")}},e}(o.default);e.default=u},"./src/controller/timeline-controller.js":function(t,e,n){"use strict";(function(t){function r(t,e){return t&&t.label===e.name&&!(t.textTrack1||t.textTrack2)}function i(t,e,n,r){return Math.min(e,r)-Math.max(t,n)}var a=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var o=n("./src/events.js"),s=n("./src/event-handler.js"),u=n("./src/utils/cea-608-parser.js"),l=n("./src/utils/output-filter.js"),c=n("./src/utils/webvtt-parser.js"),d=n("./src/utils/logger.js"),h=n("./src/utils/texttrack-utils.js"),f=function(e){function n(t){var n=e.call(this,t,o.default.MEDIA_ATTACHING,o.default.MEDIA_DETACHING,o.default.FRAG_PARSING_USERDATA,o.default.FRAG_DECRYPTED,o.default.MANIFEST_LOADING,o.default.MANIFEST_LOADED,o.default.FRAG_LOADED,o.default.LEVEL_SWITCHING,o.default.INIT_PTS_FOUND)||this;if(n.hls=t,n.config=t.config,n.enabled=!0,n.Cues=t.config.cueHandler,n.textTracks=[],n.tracks=[],n.unparsedVttFrags=[],n.initPTS=[],n.cueRanges=[],n.captionsTracks={},n.captionsProperties={textTrack1:{label:n.config.captionsTextTrack1Label,languageCode:n.config.captionsTextTrack1LanguageCode},textTrack2:{label:n.config.captionsTextTrack2Label,languageCode:n.config.captionsTextTrack2LanguageCode}},n.config.enableCEA708Captions){var r=new l.default(n,"textTrack1"),i=new l.default(n,"textTrack2");n.cea608Parser=new u.default(0,r,i)}return n}return a(n,e),n.prototype.addCues=function(t,e,n,r){for(var a=this.cueRanges,o=!1,s=a.length;s--;){var u=a[s],l=i(u[0],u[1],e,n);if(l>=0&&(u[0]=Math.min(u[0],e),u[1]=Math.max(u[1],n),o=!0,l/(n-e)>.5))return}o||a.push([e,n]),this.Cues.newCue(this.captionsTracks[t],e,n,r)},n.prototype.onInitPtsFound=function(t){var e=this;if("main"===t.id&&(this.initPTS[t.frag.cc]=t.initPTS),this.unparsedVttFrags.length){var n=this.unparsedVttFrags;this.unparsedVttFrags=[],n.forEach(function(t){e.onFragLoaded(t)})}},n.prototype.getExistingTrack=function(t){var e=this.media;if(e)for(var n=0;n<e.textTracks.length;n++){var r=e.textTracks[n];if(r[t])return r}return null},n.prototype.createCaptionsTrack=function(t){var e=this.captionsProperties[t],n=e.label,r=e.languageCode,i=this.captionsTracks;if(!i[t]){var a=this.getExistingTrack(t);if(a)i[t]=a,h.clearCurrentCues(i[t]),h.sendAddTrackEvent(i[t],this.media);else{var o=this.createTextTrack("captions",n,r);o&&(o[t]=!0,i[t]=o)}}},n.prototype.createTextTrack=function(t,e,n){var r=this.media;if(r)return r.addTextTrack(t,e,n)},n.prototype.destroy=function(){s.default.prototype.destroy.call(this)},n.prototype.onMediaAttaching=function(t){this.media=t.media,this._cleanTracks()},n.prototype.onMediaDetaching=function(){var t=this.captionsTracks;Object.keys(t).forEach(function(e){h.clearCurrentCues(t[e]),delete t[e]})},n.prototype.onManifestLoading=function(){this.lastSn=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!1}},this._cleanTracks()},n.prototype._cleanTracks=function(){var t=this.media;if(t){var e=t.textTracks;if(e)for(var n=0;n<e.length;n++)h.clearCurrentCues(e[n])}},n.prototype.onManifestLoaded=function(t){var e=this;if(this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.cueRanges=[],this.config.enableWebVTT){this.tracks=t.subtitles||[];var n=this.media?this.media.textTracks:[];this.tracks.forEach(function(t,i){var a;if(i<n.length){var o=[].slice.call(n).find(function(e){return r(e,t)});o&&(a=o)}a||(a=e.createTextTrack("subtitles",t.name,t.lang)),t.default?a.mode=e.hls.subtitleDisplay?"showing":"hidden":a.mode="disabled",e.textTracks.push(a)})}},n.prototype.onLevelSwitching=function(){this.enabled="NONE"!==this.hls.currentLevel.closedCaptions},n.prototype.onFragLoaded=function(e){var n=e.frag,r=e.payload;if("main"===n.type){var i=n.sn;if(i!==this.lastSn+1){var a=this.cea608Parser;a&&a.reset()}this.lastSn=i}else if("subtitle"===n.type)if(r.byteLength){if(!t.isFinite(this.initPTS[n.cc]))return this.unparsedVttFrags.push(e),void(this.initPTS.length&&this.hls.trigger(o.default.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:n}));var s=n.decryptdata;null!=s&&null!=s.key&&"AES-128"===s.method||this._parseVTTs(n,r)}else this.hls.trigger(o.default.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:n})},n.prototype._parseVTTs=function(t,e){var n=this.vttCCs;n[t.cc]||(n[t.cc]={start:t.start,prevCC:this.prevCC,new:!0},this.prevCC=t.cc);var r=this.textTracks,i=this.hls;c.default.parse(e,this.initPTS[t.cc],n,t.cc,function(e){var n=r[t.trackId];if("disabled"===n.mode)return void i.trigger(o.default.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t});e.forEach(function(t){if(!n.cues.getCueById(t.id))try{n.addCue(t)}catch(r){var e=new window.TextTrackCue(t.startTime,t.endTime,t.text);e.id=t.id,n.addCue(e)}}),i.trigger(o.default.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:t})},function(e){d.logger.log("Failed to parse VTT cue: "+e),i.trigger(o.default.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t})})},n.prototype.onFragDecrypted=function(e){var n=e.payload,r=e.frag;if("subtitle"===r.type){if(!t.isFinite(this.initPTS[r.cc]))return void this.unparsedVttFrags.push(e);this._parseVTTs(r,n)}},n.prototype.onFragParsingUserdata=function(t){if(this.enabled&&this.config.enableCEA708Captions)for(var e=0;e<t.samples.length;e++){var n=this.extractCea608Data(t.samples[e].bytes);this.cea608Parser.addData(t.samples[e].pts,n)}},n.prototype.extractCea608Data=function(t){for(var e,n,r,i,a,o=31&t[0],s=2,u=[],l=0;l<o;l++)e=t[s++],n=127&t[s++],r=127&t[s++],i=0!=(4&e),a=3&e,0===n&&0===r||i&&0===a&&(u.push(n),u.push(r));return u},n}(s.default);e.default=f}).call(this,n("./src/polyfills/number.js")["Number"])},"./src/crypt/aes-crypto.js":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){this.subtle=t,this.aesIV=e}return t.prototype.decrypt=function(t,e){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},e,t)},t}();e.default=r},"./src/crypt/aes-decryptor.js":function(t,e,n){"use strict";function r(t){var e=t.byteLength,n=e&&new DataView(t).getUint8(e-1);return n?t.slice(0,e-n):t}Object.defineProperty(e,"__esModule",{value:!0}),e.removePadding=r;var i=function(){function t(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.initTable()}return t.prototype.uint8ArrayToUint32Array_=function(t){for(var e=new DataView(t),n=new Uint32Array(4),r=0;r<4;r++)n[r]=e.getUint32(4*r);return n},t.prototype.initTable=function(){var t=this.sBox,e=this.invSBox,n=this.subMix,r=n[0],i=n[1],a=n[2],o=n[3],s=this.invSubMix,u=s[0],l=s[1],c=s[2],d=s[3],h=new Uint32Array(256),f=0,p=0,m=0;for(m=0;m<256;m++)h[m]=m<128?m<<1:m<<1^283;for(m=0;m<256;m++){var g=p^p<<1^p<<2^p<<3^p<<4;g=g>>>8^255&g^99,t[f]=g,e[g]=f;var v=h[f],y=h[v],_=h[y],b=257*h[g]^16843008*g;r[f]=b<<24|b>>>8,i[f]=b<<16|b>>>16,a[f]=b<<8|b>>>24,o[f]=b,b=16843009*_^65537*y^257*v^16843008*f,u[g]=b<<24|b>>>8,l[g]=b<<16|b>>>16,c[g]=b<<8|b>>>24,d[g]=b,f?(f=v^h[h[h[_^v]]],p^=h[h[p]]):f=p=1}},t.prototype.expandKey=function(t){for(var e=this.uint8ArrayToUint32Array_(t),n=!0,r=0;r<e.length&&n;)n=e[r]===this.key[r],r++;if(!n){this.key=e;var i=this.keySize=e.length;if(4!==i&&6!==i&&8!==i)throw new Error("Invalid aes key size="+i);var a,o,s,u,l=this.ksRows=4*(i+6+1),c=this.keySchedule=new Uint32Array(l),d=this.invKeySchedule=new Uint32Array(l),h=this.sBox,f=this.rcon,p=this.invSubMix,m=p[0],g=p[1],v=p[2],y=p[3];for(a=0;a<l;a++)a<i?s=c[a]=e[a]:(u=s,a%i==0?(u=u<<8|u>>>24,u=h[u>>>24]<<24|h[u>>>16&255]<<16|h[u>>>8&255]<<8|h[255&u],u^=f[a/i|0]<<24):i>6&&a%i==4&&(u=h[u>>>24]<<24|h[u>>>16&255]<<16|h[u>>>8&255]<<8|h[255&u]),c[a]=s=(c[a-i]^u)>>>0);for(o=0;o<l;o++)a=l-o,u=3&o?c[a]:c[a-4],d[o]=o<4||a<=4?u:m[h[u>>>24]]^g[h[u>>>16&255]]^v[h[u>>>8&255]]^y[h[255&u]],d[o]=d[o]>>>0}},t.prototype.networkToHostOrderSwap=function(t){return t<<24|(65280&t)<<8|(16711680&t)>>8|t>>>24},t.prototype.decrypt=function(t,e,n,i){for(var a,o,s,u,l,c,d,h,f,p,m,g,v,y,_=this.keySize+6,b=this.invKeySchedule,E=this.invSBox,w=this.invSubMix,A=w[0],S=w[1],T=w[2],x=w[3],k=this.uint8ArrayToUint32Array_(n),C=k[0],M=k[1],R=k[2],L=k[3],I=new Int32Array(t),P=new Int32Array(I.length),O=this.networkToHostOrderSwap;e<I.length;){for(f=O(I[e]),p=O(I[e+1]),m=O(I[e+2]),g=O(I[e+3]),l=f^b[0],c=g^b[1],d=m^b[2],h=p^b[3],v=4,y=1;y<_;y++)a=A[l>>>24]^S[c>>16&255]^T[d>>8&255]^x[255&h]^b[v],o=A[c>>>24]^S[d>>16&255]^T[h>>8&255]^x[255&l]^b[v+1],s=A[d>>>24]^S[h>>16&255]^T[l>>8&255]^x[255&c]^b[v+2],u=A[h>>>24]^S[l>>16&255]^T[c>>8&255]^x[255&d]^b[v+3],l=a,c=o,d=s,h=u,v+=4;a=E[l>>>24]<<24^E[c>>16&255]<<16^E[d>>8&255]<<8^E[255&h]^b[v],o=E[c>>>24]<<24^E[d>>16&255]<<16^E[h>>8&255]<<8^E[255&l]^b[v+1],s=E[d>>>24]<<24^E[h>>16&255]<<16^E[l>>8&255]<<8^E[255&c]^b[v+2],u=E[h>>>24]<<24^E[l>>16&255]<<16^E[c>>8&255]<<8^E[255&d]^b[v+3],v+=3,P[e]=O(a^C),P[e+1]=O(u^M),P[e+2]=O(s^R),P[e+3]=O(o^L),C=f,M=p,R=m,L=g,e+=4}return i?r(P.buffer):P.buffer},t.prototype.destroy=function(){this.key=void 0,this.keySize=void 0,this.ksRows=void 0,this.sBox=void 0,this.invSBox=void 0,this.subMix=void 0,this.invSubMix=void 0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.rcon=void 0},t}();e.default=i},"./src/crypt/decrypter.js":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n("./src/crypt/aes-crypto.js"),i=n("./src/crypt/fast-aes-key.js"),a=n("./src/crypt/aes-decryptor.js"),o=n("./src/errors.js"),s=n("./src/utils/logger.js"),u=n("./src/events.js"),l=n("./src/utils/get-self-scope.js"),c=l.getSelfScope(),d=function(){function t(t,e,n){var r=(void 0===n?{}:n).removePKCS7Padding,i=void 0===r||r;if(this.logEnabled=!0,this.observer=t,this.config=e,this.removePKCS7Padding=i,i)try{var a=c.crypto;a&&(this.subtle=a.subtle||a.webkitSubtle)}catch(o){}this.disableWebCrypto=!this.subtle}return t.prototype.isSync=function(){return this.disableWebCrypto&&this.config.enableSoftwareAES},t.prototype.decrypt=function(t,e,n,o){var u=this;if(this.disableWebCrypto&&this.config.enableSoftwareAES){this.logEnabled&&(s.logger.log("JS AES decrypt"),this.logEnabled=!1);var l=this.decryptor;l||(this.decryptor=l=new a.default),l.expandKey(e),o(l.decrypt(t,0,n,this.removePKCS7Padding))}else{this.logEnabled&&(s.logger.log("WebCrypto AES decrypt"),this.logEnabled=!1);var c=this.subtle;this.key!==e&&(this.key=e,this.fastAesKey=new i.default(c,e)),this.fastAesKey.expandKey().then(function(i){new r.default(c,n).decrypt(t,i).catch(function(r){u.onWebCryptoError(r,t,e,n,o)}).then(function(t){o(t)})}).catch(function(r){u.onWebCryptoError(r,t,e,n,o)})}},t.prototype.onWebCryptoError=function(t,e,n,r,i){this.config.enableSoftwareAES?(s.logger.log("WebCrypto Error, disable WebCrypto API"),this.disableWebCrypto=!0,this.logEnabled=!0,this.decrypt(e,n,r,i)):(s.logger.error("decrypting error : "+t.message),this.observer.trigger(u.default.ERROR,{type:o.ErrorTypes.MEDIA_ERROR,details:o.ErrorDetails.FRAG_DECRYPT_ERROR,fatal:!0,reason:t.message}))},t.prototype.destroy=function(){var t=this.decryptor;t&&(t.destroy(),this.decryptor=void 0)},t}();e.default=d},"./src/crypt/fast-aes-key.js":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){this.subtle=t,this.key=e}return t.prototype.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},t}();e.default=r},"./src/demux/aacdemuxer.js":function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0});var r=n("./src/demux/adts.js"),i=n("./src/utils/logger.js"),a=n("./src/demux/id3.js"),o=function(){function e(t,e,n){this.observer=t,this.config=n,this.remuxer=e}return e.prototype.resetInitSegment=function(t,e,n,r){this._audioTrack={container:"audio/adts",type:"audio",id:0,sequenceNumber:0,isAAC:!0,samples:[],len:0,manifestCodec:e,duration:r,inputTimeScale:9e4}},e.prototype.resetTimeStamp=function(){},e.probe=function(t){if(!t)return!1;for(var e=a.default.getID3Data(t,0)||[],n=e.length,o=t.length;n<o;n++)if(r.probe(t,n))return i.logger.log("ADTS sync word found !"),!0;return!1},e.prototype.append=function(e,n,o,s){for(var u=this._audioTrack,l=a.default.getID3Data(e,0)||[],c=a.default.getTimeStamp(l),d=t.isFinite(c)?90*c:9e4*n,h=0,f=d,p=e.length,m=l.length,g=[{pts:f,dts:f,data:l}];m<p-1;)if(r.isHeader(e,m)&&m+5<p){r.initTrackConfig(u,this.observer,e,m,u.manifestCodec);var v=r.appendFrame(u,e,m,d,h);if(!v){i.logger.log("Unable to parse AAC frame");break}m+=v.length,f=v.sample.pts,h++}else a.default.isHeader(e,m)?(l=a.default.getID3Data(e,m),g.push({pts:f,dts:f,data:l}),m+=l.length):m++;this.remuxer.remux(u,{samples:[]},{samples:g,inputTimeScale:9e4},{samples:[]},n,o,s)},e.prototype.destroy=function(){},e}();e.default=o}).call(this,n("./src/polyfills/number.js")["Number"])},"./src/demux/adts.js":function(t,e,n){"use strict";function r(t,e,n,r){var i,a,o,s,u,l=navigator.userAgent.toLowerCase(),c=r,d=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];return i=1+((192&e[n+2])>>>6),(a=(60&e[n+2])>>>2)>d.length-1?void t.trigger(m.default.ERROR,{type:p.ErrorTypes.MEDIA_ERROR,details:p.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+a}):(s=(1&e[n+2])<<2,s|=(192&e[n+3])>>>6,f.logger.log("manifest codec:"+r+",ADTS data:type:"+i+",sampleingIndex:"+a+"["+d[a]+"Hz],channelConfig:"+s),/firefox/i.test(l)?a>=6?(i=5,u=new Array(4),o=a-3):(i=2,u=new Array(2),o=a):-1!==l.indexOf("android")?(i=2,u=new Array(2),o=a):(i=5,u=new Array(4),r&&(-1!==r.indexOf("mp4a.40.29")||-1!==r.indexOf("mp4a.40.5"))||!r&&a>=6?o=a-3:((r&&-1!==r.indexOf("mp4a.40.2")&&(a>=6&&1===s||/vivaldi/i.test(l))||!r&&1===s)&&(i=2,u=new Array(2)),o=a)),u[0]=i<<3,u[0]|=(14&a)>>1,u[1]|=(1&a)<<7,u[1]|=s<<3,5===i&&(u[1]|=(14&o)>>1,u[2]=(1&o)<<7,u[2]|=8,u[3]=0),{config:u,samplerate:d[a],channelCount:s,codec:"mp4a.40."+i,manifestCodec:c})}function i(t,e){return 255===t[e]&&240==(246&t[e+1])}function a(t,e){return 1&t[e+1]?7:9}function o(t,e){return(3&t[e+3])<<11|t[e+4]<<3|(224&t[e+5])>>>5}function s(t,e){return!!(e+1<t.length&&i(t,e))}function u(t,e){if(e+1<t.length&&i(t,e)){var n=a(t,e),r=n;e+5<t.length&&(r=o(t,e));var s=e+r;if(s===t.length||s+1<t.length&&i(t,s))return!0}return!1}function l(t,e,n,i,a){if(!t.samplerate){var o=r(e,n,i,a);t.config=o.config,t.samplerate=o.samplerate,t.channelCount=o.channelCount,t.codec=o.codec,t.manifestCodec=o.manifestCodec,f.logger.log("parsed codec:"+t.codec+",rate:"+o.samplerate+",nb channel:"+o.channelCount)}}function c(t){return 9216e4/t}function d(t,e,n,r,i){var s,u,l,c=t.length;if(s=a(t,e),u=o(t,e),(u-=s)>0&&e+s+u<=c)return l=n+r*i,{headerLength:s,frameLength:u,stamp:l}}function h(t,e,n,r,i){var a=c(t.samplerate),o=d(e,n,r,i,a);if(o){var s=o.stamp,u=o.headerLength,l=o.frameLength,h={unit:e.subarray(n+u,n+u+l),pts:s,dts:s};return t.samples.push(h),t.len+=l,{sample:h,length:l+u}}}Object.defineProperty(e,"__esModule",{value:!0});var f=n("./src/utils/logger.js"),p=n("./src/errors.js"),m=n("./src/events.js");e.getAudioConfig=r,e.isHeaderPattern=i,e.getHeaderLength=a,e.getFullFrameLength=o,e.isHeader=s,e.probe=u,e.initTrackConfig=l,e.getFrameDuration=c,e.parseFrameHeader=d,e.appendFrame=h},"./src/demux/demuxer-inline.js":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r,i=n("./src/events.js"),a=n("./src/errors.js"),o=n("./src/crypt/decrypter.js"),s=n("./src/demux/aacdemuxer.js"),u=n("./src/demux/mp4demuxer.js"),l=n("./src/demux/tsdemuxer.js"),c=n("./src/demux/mp3demuxer.js"),d=n("./src/remux/mp4-remuxer.js"),h=n("./src/remux/passthrough-remuxer.js"),f=n("./src/utils/get-self-scope.js"),p=n("./src/utils/logger.js"),m=f.getSelfScope();try{r=m.performance.now.bind(m.performance)}catch(v){p.logger.debug("Unable to use Performance API on this environment"),r=m.Date.now}var g=function(){function t(t,e,n,r){this.observer=t,this.typeSupported=e,this.config=n,this.vendor=r}return t.prototype.destroy=function(){var t=this.demuxer;t&&t.destroy()},t.prototype.push=function(t,e,n,a,s,u,l,c,d,h,f,p){var m=this;if(t.byteLength>0&&null!=e&&null!=e.key&&"AES-128"===e.method){var g=this.decrypter;null==g&&(g=this.decrypter=new o.default(this.observer,this.config));var v=r();g.decrypt(t,e.key.buffer,e.iv.buffer,function(t){var o=r();m.observer.trigger(i.default.FRAG_DECRYPTED,{stats:{tstart:v,tdecrypt:o}}),m.pushDecrypted(new Uint8Array(t),e,new Uint8Array(n),a,s,u,l,c,d,h,f,p)})}else this.pushDecrypted(new Uint8Array(t),e,new Uint8Array(n),a,s,u,l,c,d,h,f,p)},t.prototype.pushDecrypted=function(t,e,n,r,o,f,p,m,g,v,y,_){var b=this.demuxer;if(!b||(p||m)&&!this.probe(t)){for(var E=this.observer,w=this.typeSupported,A=this.config,S=[{demux:l.default,remux:d.default},{demux:u.default,remux:h.default},{demux:s.default,remux:d.default},{demux:c.default,remux:d.default}],T=0,x=S.length;T<x;T++){var k=S[T],C=k.demux.probe;if(C(t)){var M=this.remuxer=new k.remux(E,A,w,this.vendor);b=new k.demux(E,M,A,w),this.probe=C;break}}if(!b)return void E.trigger(i.default.ERROR,{type:a.ErrorTypes.MEDIA_ERROR,details:a.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"});this.demuxer=b}var R=this.remuxer;(p||m)&&(b.resetInitSegment(n,r,o,v),R.resetInitSegment()),p&&(b.resetTimeStamp(_),R.resetTimeStamp(_)),"function"==typeof b.setDecryptData&&b.setDecryptData(e),b.append(t,f,g,y)},t}();e.default=g},"./src/demux/demuxer-worker.js":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n("./src/demux/demuxer-inline.js"),i=n("./src/events.js"),a=n("./src/utils/logger.js"),o=n("./node_modules/events/events.js"),s=function(t){var e=new o.EventEmitter;e.trigger=function(t){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];e.emit.apply(e,[t,t].concat(n))},e.off=function(t){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];e.removeListener.apply(e,[t].concat(n))};var n=function(e,n){t.postMessage({event:e,data:n})};t.addEventListener("message",function(i){var o=i.data;switch(o.cmd){case"init":var s=JSON.parse(o.config);t.demuxer=new r.default(e,o.typeSupported,s,o.vendor),a.enableLogs(s.debug),n("init",null);break;case"demux":t.demuxer.push(o.data,o.decryptdata,o.initSegment,o.audioCodec,o.videoCodec,o.timeOffset,o.discontinuity,o.trackSwitch,o.contiguous,o.duration,o.accurateTimeOffset,o.defaultInitPTS)}}),e.on(i.default.FRAG_DECRYPTED,n),e.on(i.default.FRAG_PARSING_INIT_SEGMENT,n),e.on(i.default.FRAG_PARSED,n),e.on(i.default.ERROR,n),e.on(i.default.FRAG_PARSING_METADATA,n),e.on(i.default.FRAG_PARSING_USERDATA,n),e.on(i.default.INIT_PTS_FOUND,n),e.on(i.default.FRAG_PARSING_DATA,function(e,n){var r=[],i={event:e,data:n};n.data1&&(i.data1=n.data1.buffer,r.push(n.data1.buffer),delete n.data1),n.data2&&(i.data2=n.data2.buffer,r.push(n.data2.buffer),delete n.data2),t.postMessage(i,r)})};e.default=s},"./src/demux/demuxer.js":function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0});var r=n("./node_modules/webworkify-webpack/index.js"),i=n("./src/events.js"),a=n("./src/demux/demuxer-inline.js"),o=n("./src/utils/logger.js"),s=n("./src/errors.js"),u=n("./src/utils/mediasource-helper.js"),l=n("./src/utils/get-self-scope.js"),c=n("./src/observer.js"),d=l.getSelfScope(),h=u.getMediaSource(),f=function(){function e(t,e){var n=this;this.hls=t,this.id=e;var u=this.observer=new c.Observer,l=t.config,f=function(e,r){r=r||{},r.frag=n.frag,r.id=n.id,t.trigger(e,r)};u.on(i.default.FRAG_DECRYPTED,f),u.on(i.default.FRAG_PARSING_INIT_SEGMENT,f),u.on(i.default.FRAG_PARSING_DATA,f),u.on(i.default.FRAG_PARSED,f),u.on(i.default.ERROR,f),u.on(i.default.FRAG_PARSING_METADATA,f),u.on(i.default.FRAG_PARSING_USERDATA,f),u.on(i.default.INIT_PTS_FOUND,f);var p={mp4:h.isTypeSupported("video/mp4"),mpeg:h.isTypeSupported("audio/mpeg"),mp3:h.isTypeSupported('audio/mp4; codecs="mp3"')},m=navigator.vendor;if(l.enableWorker&&"undefined"!=typeof Worker){o.logger.log("demuxing in webworker");var g=void 0;try{g=this.w=r("./src/demux/demuxer-worker.js"),this.onwmsg=this.onWorkerMessage.bind(this),g.addEventListener("message",this.onwmsg),g.onerror=function(e){t.trigger(i.default.ERROR,{type:s.ErrorTypes.OTHER_ERROR,details:s.ErrorDetails.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",err:{message:e.message+" ("+e.filename+":"+e.lineno+")"}})},g.postMessage({cmd:"init",typeSupported:p,vendor:m,id:e,config:JSON.stringify(l)})}catch(v){o.logger.warn("Error in worker:",v),o.logger.error("Error while initializing DemuxerWorker, fallback on DemuxerInline"),g&&d.URL.revokeObjectURL(g.objectURL),this.demuxer=new a.default(u,p,l,m),this.w=void 0}}else this.demuxer=new a.default(u,p,l,m)}return e.prototype.destroy=function(){var t=this.w;if(t)t.removeEventListener("message",this.onwmsg),t.terminate(),this.w=null;else{var e=this.demuxer;e&&(e.destroy(),this.demuxer=null)}var n=this.observer;n&&(n.removeAllListeners(),this.observer=null)},e.prototype.push=function(e,n,r,i,a,s,u,l){var c=this.w,d=t.isFinite(a.startPTS)?a.startPTS:a.start,h=a.decryptdata,f=this.frag,p=!(f&&a.cc===f.cc),m=!(f&&a.level===f.level),g=f&&a.sn===f.sn+1,v=!m&&g;if(p&&o.logger.log(this.id+":discontinuity detected"),m&&o.logger.log(this.id+":switch detected"),this.frag=a,c)c.postMessage({cmd:"demux",data:e,decryptdata:h,initSegment:n,audioCodec:r,videoCodec:i,timeOffset:d,discontinuity:p,trackSwitch:m,contiguous:v,duration:s,accurateTimeOffset:u,defaultInitPTS:l},e instanceof ArrayBuffer?[e]:[]);else{var y=this.demuxer;y&&y.push(e,h,n,r,i,d,p,m,v,s,u,l)}},e.prototype.onWorkerMessage=function(t){var e=t.data,n=this.hls;switch(e.event){case"init":d.URL.revokeObjectURL(this.w.objectURL);break;case i.default.FRAG_PARSING_DATA:e.data.data1=new Uint8Array(e.data1),e.data2&&(e.data.data2=new Uint8Array(e.data2));default:e.data=e.data||{},e.data.frag=this.frag,e.data.id=this.id,n.trigger(e.event,e.data)}},e}();e.default=f}).call(this,n("./src/polyfills/number.js")["Number"])},"./src/demux/exp-golomb.js":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n("./src/utils/logger.js"),i=function(){function t(t){this.data=t,this.bytesAvailable=t.byteLength,this.word=0,this.bitsAvailable=0}return t.prototype.loadWord=function(){var t=this.data,e=this.bytesAvailable,n=t.byteLength-e,r=new Uint8Array(4),i=Math.min(4,e);if(0===i)throw new Error("no bytes available");r.set(t.subarray(n,n+i)),this.word=new DataView(r.buffer).getUint32(0),this.bitsAvailable=8*i,this.bytesAvailable-=i},t.prototype.skipBits=function(t){var e;this.bitsAvailable>t?(this.word<<=t,this.bitsAvailable-=t):(t-=this.bitsAvailable,e=t>>3,t-=e>>3,this.bytesAvailable-=e,this.loadWord(),this.word<<=t,this.bitsAvailable-=t)},t.prototype.readBits=function(t){var e=Math.min(this.bitsAvailable,t),n=this.word>>>32-e;return t>32&&r.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=e,this.bitsAvailable>0?this.word<<=e:this.bytesAvailable>0&&this.loadWord(),e=t-e,e>0&&this.bitsAvailable?n<<e|this.readBits(e):n},t.prototype.skipLZ=function(){var t;for(t=0;t<this.bitsAvailable;++t)if(0!=(this.word&2147483648>>>t))return this.word<<=t,this.bitsAvailable-=t,t;return this.loadWord(),t+this.skipLZ()},t.prototype.skipUEG=function(){this.skipBits(1+this.skipLZ())},t.prototype.skipEG=function(){this.skipBits(1+this.skipLZ())},t.prototype.readUEG=function(){var t=this.skipLZ();return this.readBits(t+1)-1},t.prototype.readEG=function(){var t=this.readUEG();return 1&t?1+t>>>1:-1*(t>>>1)},t.prototype.readBoolean=function(){return 1===this.readBits(1)},t.prototype.readUByte=function(){return this.readBits(8)},t.prototype.readUShort=function(){return this.readBits(16)},t.prototype.readUInt=function(){return this.readBits(32)},t.prototype.skipScalingList=function(t){var e,n,r=8,i=8;for(e=0;e<t;e++)0!==i&&(n=this.readEG(),i=(r+n+256)%256),r=0===i?r:i},t.prototype.readSPS=function(){var t,e,n,r,i,a,o,s=0,u=0,l=0,c=0,d=this.readUByte.bind(this),h=this.readBits.bind(this),f=this.readUEG.bind(this),p=this.readBoolean.bind(this),m=this.skipBits.bind(this),g=this.skipEG.bind(this),v=this.skipUEG.bind(this),y=this.skipScalingList.bind(this);if(d(),t=d(),h(5),m(3),d(),v(),100===t||110===t||122===t||244===t||44===t||83===t||86===t||118===t||128===t){var _=f();if(3===_&&m(1),v(),v(),m(1),p())for(a=3!==_?8:12,o=0;o<a;o++)p()&&y(o<6?16:64)}v();var b=f();if(0===b)f();else if(1===b)for(m(1),g(),g(),e=f(),o=0;o<e;o++)g();v(),m(1),n=f(),r=f(),i=h(1),0===i&&m(1),m(1),p()&&(s=f(),u=f(),l=f(),c=f());var E=[1,1];if(p()&&p()){switch(d()){case 1:E=[1,1];break;case 2:E=[12,11];break;case 3:E=[10,11];break;case 4:E=[16,11];break;case 5:E=[40,33];break;case 6:E=[24,11];break;case 7:E=[20,11];break;case 8:E=[32,11];break;case 9:E=[80,33];break;case 10:E=[18,11];break;case 11:E=[15,11];break;case 12:E=[64,33];break;case 13:E=[160,99];break;case 14:E=[4,3];break;case 15:E=[3,2];break;case 16:E=[2,1];break;case 255:E=[d()<<8|d(),d()<<8|d()]}}return{width:Math.ceil(16*(n+1)-2*s-2*u),height:(2-i)*(r+1)*16-(i?2:4)*(l+c),pixelRatio:E}},t.prototype.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},t}();e.default=i},"./src/demux/hevc-sps-parser.js":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t){this.data=t,this.bytesAvailable=this.data.byteLength,this.bitsAvailable=0,this.firstByte=255,this.cache=255,this.bitsInCache=0}return t.prototype.getByte=function(){var t=this.data.byteLength-this.bytesAvailable,e=Math.min(1,this.bytesAvailable),n=new Uint8Array(1);return n.set(this.data.subarray(t,t+e)),this.bitsAvailable=8*e,this.bytesAvailable-=e,new DataView(n.buffer).getUint8(0)},t.prototype.read=function(t){for(;this.bitsInCache<t;){var e=!0,n=this.getByte();e&&3===n&&0===this.firstByte&&0==(255&this.cache)&&(n=this.getByte(),e=!1),this.cache=this.cache<<8|this.firstByte,this.firstByte=n,this.bitsInCache+=8}},t.prototype.skipBits=function(t){this.read(t),this.bitsInCache=this.bitsInCache-t},t.prototype.readBits=function(t){this.read(t);var e=this.bitsInCache-t,n=this.firstByte>>e;return n|=this.cache<<8-e,n&=(1<<t)-1,this.bitsInCache=e,n},t.prototype.readUE=function(){var t,e=0,n=0;for(t=this.readBits(1);0===t;)n++,t=this.readBits(1);return e=this.readBits(n),(1<<n)-1+e},t.prototype.readProfileTierLevel=function(t){this.skipBits(2),this.skipBits(1),this.skipBits(5),this.skipBits(16),this.skipBits(16),this.skipBits(1),this.skipBits(1),this.skipBits(1),this.skipBits(1),this.skipBits(16),this.skipBits(16),this.skipBits(12),this.skipBits(8);for(var e=[],n=[],r=0;r<t;r++)e[r]=this.readBits(1),n[r]=this.readBits(1);0!==t&&this.skipBits(2*(8-t));for(var i=0;i<t;i++)0!==e[i]&&(this.skipBits(2),this.skipBits(1),this.skipBits(5),this.skipBits(16),this.skipBits(16),this.skipBits(4),this.skipBits(16),this.skipBits(16),this.skipBits(12)),0!==n[i]&&this.skipBits(8)},t.prototype.readSPSHEVC=function(){var t=0,e=0,n=0,r=0,i=0,a=0,o=0;return this.readBits(8),this.readBits(8),this.readBits(4),t=this.readBits(3),this.readBits(1),this.readProfileTierLevel(t),this.readUE(),e=this.readUE(),3===e&&this.skipBits(1),n=this.readUE(),r=this.readUE(),i=this.readBits(1),1===i&&(this.skipUE(),this.skipUE(),this.skipUE(),this.skipUE()),a=this.readUE(),o=this.readUE(),{width:n,height:r,chromaFormatIdc:e,bitDepthLumaMinus8:a,bitDepthChromaMinus8:o}},t}();e.default=r},"./src/demux/id3.js":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(){}return t.isHeader=function(t,e){return e+10<=t.length&&73===t[e]&&68===t[e+1]&&51===t[e+2]&&t[e+3]<255&&t[e+4]<255&&t[e+6]<128&&t[e+7]<128&&t[e+8]<128&&t[e+9]<128},t.isFooter=function(t,e){return e+10<=t.length&&51===t[e]&&68===t[e+1]&&73===t[e+2]&&t[e+3]<255&&t[e+4]<255&&t[e+6]<128&&t[e+7]<128&&t[e+8]<128&&t[e+9]<128},t.getID3Data=function(e,n){for(var r=n,i=0;t.isHeader(e,n);){i+=10;i+=t._readSize(e,n+6),t.isFooter(e,n+10)&&(i+=10),n+=i}if(i>0)return e.subarray(r,r+i)},t._readSize=function(t,e){var n=0;return n=(127&t[e])<<21,n|=(127&t[e+1])<<14,n|=(127&t[e+2])<<7,n|=127&t[e+3]},t.getTimeStamp=function(e){for(var n=t.getID3Frames(e),r=0;r<n.length;r++){var i=n[r];if(t.isTimeStampFrame(i))return t._readTimeStamp(i)}},t.isTimeStampFrame=function(t){return t&&"PRIV"===t.key&&"com.apple.streaming.transportStreamTimestamp"===t.info},t._getFrameData=function(e){var n=String.fromCharCode(e[0],e[1],e[2],e[3]),r=t._readSize(e,4);return{type:n,size:r,data:e.subarray(10,10+r)}},t.getID3Frames=function(e){for(var n=0,r=[];t.isHeader(e,n);){var i=t._readSize(e,n+6);n+=10;for(var a=n+i;n+8<a;){var o=t._getFrameData(e.subarray(n)),s=t._decodeFrame(o);s&&r.push(s),n+=o.size+10}t.isFooter(e,n)&&(n+=10)}return r},t._decodeFrame=function(e){return"PRIV"===e.type?t._decodePrivFrame(e):"T"===e.type[0]?t._decodeTextFrame(e):"W"===e.type[0]?t._decodeURLFrame(e):void 0},t._readTimeStamp=function(t){if(8===t.data.byteLength){var e=new Uint8Array(t.data),n=1&e[3],r=(e[4]<<23)+(e[5]<<15)+(e[6]<<7)+e[7];return r/=45,n&&(r+=47721858.84),Math.round(r)}},t._decodePrivFrame=function(e){if(!(e.size<2)){var n=t._utf8ArrayToStr(e.data,!0),r=new Uint8Array(e.data.subarray(n.length+1));return{key:e.type,info:n,data:r.buffer}}},t._decodeTextFrame=function(e){if(!(e.size<2)){if("TXXX"===e.type){var n=1,r=t._utf8ArrayToStr(e.data.subarray(n));n+=r.length+1;var i=t._utf8ArrayToStr(e.data.subarray(n));return{key:e.type,info:r,data:i}}var a=t._utf8ArrayToStr(e.data.subarray(1));return{key:e.type,data:a}}},t._decodeURLFrame=function(e){if("WXXX"===e.type){if(e.size<2)return;var n=1,r=t._utf8ArrayToStr(e.data.subarray(n));n+=r.length+1;var i=t._utf8ArrayToStr(e.data.subarray(n));return{key:e.type,info:r,data:i}}var a=t._utf8ArrayToStr(e.data);return{key:e.type,data:a}},t._utf8ArrayToStr=function(t,e){void 0===e&&(e=!1);for(var n,r,i,a=t.length,o="",s=0;s<a;){if(0===(n=t[s++])&&e)return o;if(0!==n&&3!==n)switch(n>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:o+=String.fromCharCode(n);break;case 12:case 13:r=t[s++],o+=String.fromCharCode((31&n)<<6|63&r);break;case 14:r=t[s++],i=t[s++],o+=String.fromCharCode((15&n)<<12|(63&r)<<6|(63&i)<<0)}}return o},t}(),i=r._utf8ArrayToStr;e.utf8ArrayToStr=i,e.default=r},"./src/demux/mp3demuxer.js":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n("./src/demux/id3.js"),i=n("./src/utils/logger.js"),a=n("./src/demux/mpegaudio.js"),o=function(){function t(t,e,n){this.observer=t,this.config=n,this.remuxer=e}return t.prototype.resetInitSegment=function(t,e,n,r){this._audioTrack={container:"audio/mpeg",type:"audio",id:-1,sequenceNumber:0,isAAC:!1,samples:[],len:0,manifestCodec:e,duration:r,inputTimeScale:9e4}},t.prototype.resetTimeStamp=function(){},t.probe=function(t){var e,n,o=r.default.getID3Data(t,0);if(o&&void 0!==r.default.getTimeStamp(o))for(e=o.length,n=Math.min(t.length-1,e+100);e<n;e++)if(a.default.probe(t,e))return i.logger.log("MPEG Audio sync word found !"),!0;return!1},t.prototype.append=function(t,e,n,i){for(var o=r.default.getID3Data(t,0),s=r.default.getTimeStamp(o),u=s?90*s:9e4*e,l=o.length,c=t.length,d=0,h=0,f=this._audioTrack,p=[{pts:u,dts:u,data:o}];l<c;)if(a.default.isHeader(t,l)){var m=a.default.appendFrame(f,t,l,u,d);if(!m)break;l+=m.length,h=m.sample.pts,d++}else r.default.isHeader(t,l)?(o=r.default.getID3Data(t,l),p.push({pts:h,dts:h,data:o}),l+=o.length):l++;this.remuxer.remux(f,{samples:[]},{samples:p,inputTimeScale:9e4},{samples:[]},e,n,i)},t.prototype.destroy=function(){},t}();e.default=o},"./src/demux/mp4demuxer.js":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n("./src/utils/logger.js"),i=n("./src/events.js"),a=Math.pow(2,32)-1,o=function(){function t(t,e){this.observer=t,this.remuxer=e}return t.prototype.resetTimeStamp=function(t){this.initPTS=t},t.prototype.resetInitSegment=function(e,n,r,a){if(e&&e.byteLength){var o=this.initData=t.parseInitSegment(e);null==n&&(n="mp4a.40.5"),null==r&&(r="avc1.42e01e");var s={};o.audio&&o.video?s.audiovideo={container:"video/mp4",codec:n+","+r,initSegment:a?e:null}:(o.audio&&(s.audio={container:"audio/mp4",codec:n,initSegment:a?e:null}),o.video&&(s.video={container:"video/mp4",codec:r,initSegment:a?e:null})),this.observer.trigger(i.default.FRAG_PARSING_INIT_SEGMENT,{tracks:s})}else n&&(this.audioCodec=n),r&&(this.videoCodec=r)},t.probe=function(e){return t.findBox({data:e,start:0,end:Math.min(e.length,16384)},["moof"]).length>0},t.bin2str=function(t){return String.fromCharCode.apply(null,t)},t.readUint16=function(t,e){t.data&&(e+=t.start,t=t.data);var n=t[e]<<8|t[e+1];return n<0?65536+n:n},t.readUint32=function(t,e){t.data&&(e+=t.start,t=t.data);var n=t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3];return n<0?4294967296+n:n},t.writeUint32=function(t,e,n){t.data&&(e+=t.start,t=t.data),t[e]=n>>24,t[e+1]=n>>16&255,t[e+2]=n>>8&255,t[e+3]=255&n},t.findBox=function(e,n){var r,i,a,o,s,u,l,c=[];if(e.data?(u=e.start,o=e.end,e=e.data):(u=0,o=e.byteLength),!n.length)return null;for(r=u;r<o;)i=t.readUint32(e,r),a=t.bin2str(e.subarray(r+4,r+8)),l=i>1?r+i:o,a===n[0]&&(1===n.length?c.push({data:e,start:r+8,end:l}):(s=t.findBox({data:e,start:r+8,end:l},n.slice(1)),s.length&&(c=c.concat(s)))),r=l;return c},t.parseSegmentIndex=function(e){var n,r=t.findBox(e,["moov"])[0],i=r?r.end:null,a=0,o=t.findBox(e,["sidx"]);if(!o||!o[0])return null;n=[],o=o[0];var s=o.data[0];a=0===s?8:16;var u=t.readUint32(o,a);a+=4;a+=0===s?8:16,a+=2;var l=o.end+0,c=t.readUint16(o,a);a+=2;for(var d=0;d<c;d++){var h=a,f=t.readUint32(o,h);h+=4;var p=2147483647&f;if(1===(2147483648&f)>>>31)return void console.warn("SIDX has hierarchical references (not supported)");var m=t.readUint32(o,h);h+=4,n.push({referenceSize:p,subsegmentDuration:m,info:{duration:m/u,start:l,end:l+p-1}}),l+=p,h+=4,a=h}return{earliestPresentationTime:0,timescale:u,version:s,referencesCount:c,references:n,moovEndOffset:i}},t.parseInitSegment=function(e){var n=[];return t.findBox(e,["moov","trak"]).forEach(function(e){var i=t.findBox(e,["tkhd"])[0];if(i){var a=i.data[i.start],o=0===a?12:20,s=t.readUint32(i,o),u=t.findBox(e,["mdia","mdhd"])[0];if(u){a=u.data[u.start],o=0===a?12:20;var l=t.readUint32(u,o),c=t.findBox(e,["mdia","hdlr"])[0];if(c){var d=t.bin2str(c.data.subarray(c.start+8,c.start+12)),h={soun:"audio",vide:"video"}[d];if(h){var f=t.findBox(e,["mdia","minf","stbl","stsd"]);if(f.length){f=f[0];var p=t.bin2str(f.data.subarray(f.start+12,f.start+16));r.logger.log("MP4Demuxer:"+h+":"+p+" found")}n[s]={timescale:l,type:h},n[h]={timescale:l,id:s}}}}}}),n},t.getStartDTS=function(e,n){var r,i,a;return r=t.findBox(n,["moof","traf"]),i=[].concat.apply([],r.map(function(n){return t.findBox(n,["tfhd"]).map(function(r){var i,a;return i=t.readUint32(r,4),a=e[i].timescale||9e4,t.findBox(n,["tfdt"]).map(function(e){var n,r;return n=e.data[e.start],r=t.readUint32(e,4),1===n&&(r*=Math.pow(2,32),r+=t.readUint32(e,8)),r})[0]/a})})),a=Math.min.apply(null,i),isFinite(a)?a:0},t.offsetStartDTS=function(e,n,r){t.findBox(n,["moof","traf"]).map(function(n){return t.findBox(n,["tfhd"]).map(function(i){var o=t.readUint32(i,4),s=e[o].timescale||9e4;t.findBox(n,["tfdt"]).map(function(e){var n=e.data[e.start],i=t.readUint32(e,4);if(0===n)t.writeUint32(e,4,i-r*s);else{i*=Math.pow(2,32),i+=t.readUint32(e,8),i-=r*s,i=Math.max(i,0);var o=Math.floor(i/(a+1)),u=Math.floor(i%(a+1));t.writeUint32(e,4,o),t.writeUint32(e,8,u)}})})})},t.prototype.append=function(e,n,r,a){var o=this.initData;o||(this.resetInitSegment(e,this.audioCodec,this.videoCodec,!1),o=this.initData);var s,u=this.initPTS;if(void 0===u){var l=t.getStartDTS(o,e);this.initPTS=u=l-n,this.observer.trigger(i.default.INIT_PTS_FOUND,{initPTS:u})}t.offsetStartDTS(o,e,u),s=t.getStartDTS(o,e),this.remuxer.remux(o.audio,o.video,null,null,s,r,a,e)},t.prototype.destroy=function(){},t}();e.default=o},"./src/demux/mpegaudio.js":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r={BitratesMap:[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],SamplingRateMap:[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],SamplesCoefficients:[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],BytesInSlot:[0,1,1,4],appendFrame:function(t,e,n,r,i){if(!(n+24>e.length)){var a=this.parseHeader(e,n);if(a&&n+a.frameLength<=e.length){var o=9e4*a.samplesPerFrame/a.sampleRate,s=r+i*o,u={unit:e.subarray(n,n+a.frameLength),pts:s,dts:s};return t.config=[],t.channelCount=a.channelCount,t.samplerate=a.sampleRate,t.samples.push(u),t.len+=a.frameLength,{sample:u,length:a.frameLength}}}},parseHeader:function(t,e){var n=t[e+1]>>3&3,i=t[e+1]>>1&3,a=t[e+2]>>4&15,o=t[e+2]>>2&3,s=t[e+2]>>1&1;if(1!==n&&0!==a&&15!==a&&3!==o){var u=3===n?3-i:3===i?3:4,l=1e3*r.BitratesMap[14*u+a-1],c=3===n?0:2===n?1:2,d=r.SamplingRateMap[3*c+o],h=t[e+3]>>6==3?1:2,f=r.SamplesCoefficients[n][i],p=r.BytesInSlot[i],m=8*f*p;return{sampleRate:d,channelCount:h,frameLength:parseInt(f*l/d+s,10)*p,samplesPerFrame:m}}},isHeaderPattern:function(t,e){return 255===t[e]&&224==(224&t[e+1])&&0!=(6&t[e+1])},isHeader:function(t,e){return!!(e+1<t.length&&this.isHeaderPattern(t,e))},probe:function(t,e){if(e+1<t.length&&this.isHeaderPattern(t,e)){var n=this.parseHeader(t,e),r=4;n&&n.frameLength&&(r=n.frameLength);var i=e+r;if(i===t.length||i+1<t.length&&this.isHeaderPattern(t,i))return!0}return!1}};e.default=r},"./src/demux/sample-aes.js":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n("./src/crypt/decrypter.js"),i=function(){function t(t,e,n,i){this.decryptdata=n,this.discardEPB=i,this.decrypter=new r.default(t,e,{removePKCS7Padding:!1})}return t.prototype.decryptBuffer=function(t,e){this.decrypter.decrypt(t,this.decryptdata.key.buffer,this.decryptdata.iv.buffer,e)},t.prototype.decryptAacSample=function(t,e,n,r){var i=t[e].unit,a=i.subarray(16,i.length-i.length%16),o=a.buffer.slice(a.byteOffset,a.byteOffset+a.length),s=this;this.decryptBuffer(o,function(a){a=new Uint8Array(a),i.set(a,16),r||s.decryptAacSamples(t,e+1,n)})},t.prototype.decryptAacSamples=function(t,e,n){for(;;e++){if(e>=t.length)return void n();if(!(t[e].unit.length<32)){var r=this.decrypter.isSync();if(this.decryptAacSample(t,e,n,r),!r)return}}},t.prototype.getAvcEncryptedData=function(t){for(var e=16*Math.floor((t.length-48)/160)+16,n=new Int8Array(e),r=0,i=32;i<=t.length-16;i+=160,r+=16)n.set(t.subarray(i,i+16),r);return n},t.prototype.getAvcDecryptedUnit=function(t,e){e=new Uint8Array(e);for(var n=0,r=32;r<=t.length-16;r+=160,n+=16)t.set(e.subarray(n,n+16),r);return t},t.prototype.decryptAvcSample=function(t,e,n,r,i,a){var o=this.discardEPB(i.data),s=this.getAvcEncryptedData(o),u=this;this.decryptBuffer(s.buffer,function(s){i.data=u.getAvcDecryptedUnit(o,s),a||u.decryptAvcSamples(t,e,n+1,r)})},t.prototype.decryptAvcSamples=function(t,e,n,r){for(;;e++,n=0){if(e>=t.length)return void r();for(var i=t[e].units;!(n>=i.length);n++){var a=i[n];if(!(a.length<=48||1!==a.type&&5!==a.type)){var o=this.decrypter.isSync();if(this.decryptAvcSample(t,e,n,r,a,o),!o)return}}}},t}();e.default=i},"./src/demux/tsdemuxer.js":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n("./src/demux/adts.js"),i=n("./src/demux/mpegaudio.js"),a=n("./src/events.js"),o=n("./src/demux/exp-golomb.js"),s=n("./src/demux/sample-aes.js"),u=n("./src/demux/hevc-sps-parser.js"),l=n("./src/utils/logger.js"),c=n("./src/errors.js"),d={video:1,audio:2,id3:3,text:4},h=function(){function t(t,e,n,r){this.observer=t,this.config=n,this.typeSupported=r,this.remuxer=e,this.sampleAes=null,this.HEVC=36,this.AVC=27}return t.prototype.setDecryptData=function(t){null!=t&&null!=t.key&&"SAMPLE-AES"===t.method?this.sampleAes=new s.default(this.observer,this.config,t,this.discardEPB):this.sampleAes=null},t.probe=function(e){var n=t._syncOffset(e);return!(n<0)&&(n&&l.logger.warn("MPEG2-TS detected but first sync word found @ offset "+n+", junk ahead ?"),!0)},t._syncOffset=function(t){for(var e=Math.min(1e3,t.length-564),n=0;n<e;){if(71===t[n]&&71===t[n+188]&&71===t[n+376])return n;n++}return-1},t.createTrack=function(t,e){return{container:"video"===t||"audio"===t?"video/mp2t":void 0,type:t,id:d[t],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],len:0,dropped:"video"===t?0:void 0,isAAC:"audio"===t||void 0,duration:"audio"===t?e:void 0}},t.prototype.resetInitSegment=function(e,n,r,i){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=t.createTrack("video",i),this._audioTrack=t.createTrack("audio",i),this._id3Track=t.createTrack("id3",i),this._txtTrack=t.createTrack("text",i),this.aacOverFlow=null,this.aacLastPTS=null,this.avcSample=null,this.audioCodec=n,this.videoCodec=r,this._duration=i},t.prototype.resetTimeStamp=function(){},t.prototype.append=function(e,n,r,i){var o,s,u,d,h,f=e.length,p=!1;this.contiguous=r;var m=this.pmtParsed,g=this._avcTrack,v=this._audioTrack,y=this._id3Track,_=g.pid,b=g.streamType,E=v.pid,w=y.pid,A=this._pmtId,S=g.pesData,T=v.pesData,x=y.pesData,k=this._parsePAT,C=this._parsePMT,M=this._parsePES,R=this._parseHEVCPES.bind(this),L=this._parseAVCPES.bind(this),I=this._parseAACPES.bind(this),P=this._parseMPEGPES.bind(this),O=this._parseID3PES.bind(this),D=t._syncOffset(e);for(f-=(f+D)%188,o=D;o<f;o+=188)if(71===e[o]){if(s=!!(64&e[o+1]),u=((31&e[o+1])<<8)+e[o+2],(48&e[o+3])>>4>1){if((d=o+5+e[o+4])===o+188)continue}else d=o+4;switch(u){case _:s&&(S&&(h=M(S))&&void 0!==h.pts&&(b===this.HEVC?R(h,!1):b===this.AVC&&L(h,!1)),S={data:[],size:0}),S&&(S.data.push(e.subarray(d,o+188)),S.size+=o+188-d);break;case E:s&&(T&&(h=M(T))&&void 0!==h.pts&&(v.isAAC?I(h):P(h)),T={data:[],size:0}),T&&(T.data.push(e.subarray(d,o+188)),T.size+=o+188-d);break;case w:s&&(x&&(h=M(x))&&void 0!==h.pts&&O(h),x={data:[],size:0}),x&&(x.data.push(e.subarray(d,o+188)),x.size+=o+188-d);break;case 0:s&&(d+=e[d]+1),A=this._pmtId=k(e,d);break;case A:s&&(d+=e[d]+1);var N=C(e,d,!0===this.typeSupported.mpeg||!0===this.typeSupported.mp3,null!=this.sampleAes);_=N.avc,_>0&&(g.pid=_,b=g.streamType=N.videoStreamType),E=N.audio,E>0&&(v.pid=E,v.isAAC=N.isAAC),w=N.id3,w>0&&(y.pid=w),p&&!m&&(l.logger.log("reparse from beginning"),p=!1,o=D-188),m=this.pmtParsed=!0;break;case 17:case 8191:break;default:p=!0}}else this.observer.trigger(a.default.ERROR,{type:c.ErrorTypes.MEDIA_ERROR,details:c.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"TS packet did not start with 0x47"});S&&(h=M(S))&&void 0!==h.pts?(b===this.HEVC?R(h,!0):b===this.AVC&&L(h,!0),g.pesData=null):g.pesData=S,T&&(h=M(T))&&void 0!==h.pts?(v.isAAC?I(h):P(h),v.pesData=null):(T&&T.size&&l.logger.log("last AAC PES packet truncated,might overlap between fragments"),v.pesData=T),x&&(h=M(x))&&void 0!==h.pts?(O(h),y.pesData=null):y.pesData=x,null==this.sampleAes?this.remuxer.remux(v,g,y,this._txtTrack,n,r,i):this.decryptAndRemux(v,g,y,this._txtTrack,n,r,i)},t.prototype.decryptAndRemux=function(t,e,n,r,i,a,o){if(t.samples&&t.isAAC){var s=this;this.sampleAes.decryptAacSamples(t.samples,0,function(){s.decryptAndRemuxAvc(t,e,n,r,i,a,o)})}else this.decryptAndRemuxAvc(t,e,n,r,i,a,o)},t.prototype.decryptAndRemuxAvc=function(t,e,n,r,i,a,o){if(e.samples){var s=this;this.sampleAes.decryptAvcSamples(e.samples,0,0,function(){s.remuxer.remux(t,e,n,r,i,a,o)})}else this.remuxer.remux(t,e,n,r,i,a,o)},t.prototype.destroy=function(){this._initPTS=this._initDTS=void 0,this._duration=0},t.prototype._parsePAT=function(t,e){return(31&t[e+10])<<8|t[e+11]},t.prototype._parsePMT=function(t,e,n,r){var i,a,o,s,u={audio:-1,avc:-1,id3:-1,isAAC:!0,videoStreamType:-1};for(i=(15&t[e+1])<<8|t[e+2],a=e+3+i-4,o=(15&t[e+10])<<8|t[e+11],e+=12+o;e<a;){s=(31&t[e+1])<<8|t[e+2];var c=t[e];switch(c){case 207:if(!r){l.logger.log("unkown stream type:"+t[e]);break}case 15:-1===u.audio&&(u.audio=s);break;case 21:-1===u.id3&&(u.id3=s);break;case 219:if(!r){l.logger.log("unkown stream type:"+t[e]);break}case 27:-1===u.avc&&(u.avc=s,u.videoStreamType=c);break;case 3:case 4:n?-1===u.audio&&(u.audio=s,u.isAAC=!1):l.logger.log("MPEG audio found, not supported in this browser for now");break;case 36:-1===u.avc&&(u.avc=s,u.videoStreamType=c);break;default:l.logger.log("unkown stream type:"+t[e])}e+=5+((15&t[e+3])<<8|t[e+4])}return u},t.prototype._parsePES=function(t){var e,n,r,i,a,o,s,u,c=0,d=t.data;if(!t||0===t.size)return null;for(;d[0].length<19&&d.length>1;){var h=new Uint8Array(d[0].length+d[1].length);h.set(d[0]),h.set(d[1],d[0].length),d[0]=h,d.splice(1,1)}if(e=d[0],1===(e[0]<<16)+(e[1]<<8)+e[2]){if((r=(e[4]<<8)+e[5])&&r>t.size-6)return null;n=e[7],192&n&&(o=536870912*(14&e[9])+4194304*(255&e[10])+16384*(254&e[11])+128*(255&e[12])+(254&e[13])/2,o>4294967295&&(o-=8589934592),64&n?(s=536870912*(14&e[14])+4194304*(255&e[15])+16384*(254&e[16])+128*(255&e[17])+(254&e[18])/2,s>4294967295&&(s-=8589934592),o-s>54e5&&(l.logger.warn(Math.round((o-s)/9e4)+"s delta between PTS and DTS, align them"),o=s)):s=o),i=e[8],u=i+9,t.size-=u,a=new Uint8Array(t.size);for(var f=0,p=d.length;f<p;f++){e=d[f];var m=e.byteLength;if(u){if(u>m){u-=m;continue}e=e.subarray(u),m-=u,u=0}a.set(e,c),c+=m}return r&&(r-=i+3),{data:a,pts:o,dts:s,len:r}}return null},t.prototype.pushAccesUnit=function(t,e){if(t.units.length&&t.frame){var n=e.samples,r=n.length;!this.config.forceKeyFrameOnDiscontinuity||!0===t.key||e.sps&&(r||this.contiguous)?(t.id=r,n.push(t)):e.dropped++}t.debug.length&&l.logger.log(t.pts+"/"+t.dts+":"+t.debug)},t.prototype._parseHEVCPES=function(t,e){var n,r=this,i=this._avcTrack,a=this._parseHEVCNALu(t.data),o=this.avcSample,s=this.pushAccesUnit.bind(this),c=function(t,e,n,r){return{key:t,pts:e,dts:n,units:[],debug:r}};t.data=null;var d="";o&&a.length&&!i.audFound&&(s(o,i),o=this.avcSample=c(!1,t.pts,t.dts,"")),a.forEach(function(e){switch(e.type){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:n=!0,o.frame=!0;break;case 16:case 17:case 18:case 19:case 20:case 21:n=!0,o.key=!0,o.frame=!0;break;case 32:n=!0,i.vps=[e.data];break;case 33:n=!0,i.sps=[e.data];var a=new u.default(e.data),l=a.readSPSHEVC();i.width=l.width,i.height=l.height,i.duration=r._duration,i.codec="hev1.1.6.L120.80",i.chromaFormatIdc=l.chromaFormatIdc,i.bitDepthLumaMinus8=l.bitDepthLumaMinus8,i.bitDepthChromaMinus8=l.bitDepthChromaMinus8;break;case 34:n=!0,i.pps||(i.pps=[e.data]);break;case 35:n=!1,i.audFound=!0,o&&s(o,i),o=r.avcSample=c(!1,t.pts,t.dts,"");break;case 36:case 37:case 38:case 39:case 40:n=!0;break;default:n=!1,d+="unknown NAL "+e.type+" "}if(o&&n){o.units.push(e)}}),d.length&&l.logger.log(d),e&&o&&(s(o,i),this.avcSample=null)},t.prototype._parseAVCPES=function(t,e){var n,r,i,a=this,s=this._avcTrack,u=this._parseAVCNALu(t.data),l=this.avcSample,c=!1,d=this.pushAccesUnit.bind(this),h=function(t,e,n,r){return{key:t,pts:e,dts:n,units:[],debug:r}};t.data=null,l&&u.length&&!s.audFound&&(d(l,s),l=this.avcSample=h(!1,t.pts,t.dts,"")),u.forEach(function(e){switch(e.type){case 1:r=!0,l||(l=a.avcSample=h(!0,t.pts,t.dts,"")),l.frame=!0;var u=e.data;if(c&&u.length>4){var f=new o.default(u).readSliceType();2!==f&&4!==f&&7!==f&&9!==f||(l.key=!0)}break;case 5:r=!0,l||(l=a.avcSample=h(!0,t.pts,t.dts,"")),l.key=!0,l.frame=!0;break;case 6:r=!0,n=new o.default(a.discardEPB(e.data)),n.readUByte();for(var p=0,m=0,g=!1,v=0;!g&&n.bytesAvailable>1;){p=0;do{v=n.readUByte(),p+=v}while(255===v);m=0;do{v=n.readUByte(),m+=v}while(255===v);if(4===p&&0!==n.bytesAvailable){g=!0;if(181===n.readUByte()){if(49===n.readUShort()){if(1195456820===n.readUInt()){if(3===n.readUByte()){var y=n.readUByte(),_=n.readUByte(),b=31&y,E=[y,_];for(i=0;i<b;i++)E.push(n.readUByte()),E.push(n.readUByte()),E.push(n.readUByte());a._insertSampleInOrder(a._txtTrack.samples,{type:3,pts:t.pts,bytes:E})}}}}}else if(m<n.bytesAvailable)for(i=0;i<m;i++)n.readUByte()}break;case 7:if(r=!0,c=!0,!s.sps){n=new o.default(e.data);var w=n.readSPS();s.width=w.width,s.height=w.height,s.pixelRatio=w.pixelRatio,s.sps=[e.data],s.duration=a._duration;var A=e.data.subarray(1,4),S="avc1.";for(i=0;i<3;i++){var T=A[i].toString(16);T.length<2&&(T="0"+T),S+=T}s.codec=S}break;case 8:r=!0,s.pps||(s.pps=[e.data]);break;case 9:r=!1,s.audFound=!0,l&&d(l,s),l=a.avcSample=h(!1,t.pts,t.dts,"");break;case 12:r=!1;break;default:r=!1,l&&(l.debug+="unknown NAL "+e.type+" ")}if(l&&r){l.units.push(e)}}),e&&l&&(d(l,s),this.avcSample=null)},t.prototype._insertSampleInOrder=function(t,e){var n=t.length;if(n>0){if(e.pts>=t[n-1].pts)t.push(e);else for(var r=n-1;r>=0;r--)if(e.pts<t[r].pts){t.splice(r,0,e);break}}else t.push(e)},t.prototype._getLastNalUnit=function(){var t,e=this.avcSample;if(!e||0===e.units.length){var n=this._avcTrack,r=n.samples;e=r[r.length-1]}if(e){var i=e.units;t=i[i.length-1]}return t},t.prototype._parseHEVCNALu=function(t){var e,n,r,i,a,o=0,s=t.byteLength,u=this._avcTrack,l=u.naluState||0,c=l,d=[],h=-1;for(-1===l&&(h=0,a=31&t[0],l=0,o=1);o<s;)if(e=t[o++],l)if(1!==l)if(e)if(1===e){if(h>=0)r={data:t.subarray(h,o-l-1),type:a},d.push(r);else{var f=this._getLastNalUnit();if(f&&(c&&o<=4-c&&f.state&&(f.data=f.data.subarray(0,f.data.byteLength-c)),(n=o-l-1)>0)){var p=new Uint8Array(f.data.byteLength+n);p.set(f.data,0),p.set(t.subarray(0,n),f.data.byteLength),f.data=p}}o<s?(i=t[o]>>>1&63,h=o,a=i,l=0):l=-1}else l=0;else l=3;else l=e?0:2;else l=e?0:1;if(h>=0&&l>=0&&(r={data:t.subarray(h,s),type:a,state:l},d.push(r)),0===d.length){var f=this._getLastNalUnit();if(f){var p=new Uint8Array(f.data.byteLength+t.byteLength);p.set(f.data,0),p.set(t,f.data.byteLength),f.data=p}}return u.naluState=l,d},t.prototype._parseAVCNALu=function(t){var e,n,r,i,a,o=0,s=t.byteLength,u=this._avcTrack,l=u.naluState||0,c=l,d=[],h=-1;for(-1===l&&(h=0,a=31&t[0],l=0,o=1);o<s;)if(e=t[o++],l)if(1!==l)if(e)if(1===e){if(h>=0)r={data:t.subarray(h,o-l-1),type:a},d.push(r);else{var f=this._getLastNalUnit();if(f&&(c&&o<=4-c&&f.state&&(f.data=f.data.subarray(0,f.data.byteLength-c)),(n=o-l-1)>0)){var p=new Uint8Array(f.data.byteLength+n);p.set(f.data,0),p.set(t.subarray(0,n),f.data.byteLength),f.data=p}}o<s?(i=31&t[o],h=o,a=i,l=0):l=-1}else l=0;else l=3;else l=e?0:2;else l=e?0:1;if(h>=0&&l>=0&&(r={data:t.subarray(h,s),type:a,state:l},d.push(r)),0===d.length){var f=this._getLastNalUnit();if(f){var p=new Uint8Array(f.data.byteLength+t.byteLength);p.set(f.data,0),p.set(t,f.data.byteLength),f.data=p}}return u.naluState=l,d},t.prototype.discardEPB=function(t){for(var e,n,r=t.byteLength,i=[],a=1;a<r-2;)0===t[a]&&0===t[a+1]&&3===t[a+2]?(i.push(a+2),a+=2):a++;if(0===i.length)return t;e=r-i.length,n=new Uint8Array(e);var o=0;for(a=0;a<e;o++,a++)o===i[0]&&(o++,i.shift()),n[a]=t[o];return n},t.prototype._parseAACPES=function(t){var e,n,i,o,s,u=this._audioTrack,d=t.data,h=t.pts,f=this.aacOverFlow,p=this.aacLastPTS;if(f){var m=new Uint8Array(f.byteLength+d.byteLength);m.set(f,0),m.set(d,f.byteLength),d=m}for(i=0,s=d.length;i<s-1&&!r.isHeader(d,i);i++);if(i){var g=void 0,v=void 0;if(i<s-1?(g="AAC PES did not start with ADTS header,offset:"+i,v=!1):(g="no ADTS header found in AAC PES",v=!0),l.logger.warn("parsing error:"+g),this.observer.trigger(a.default.ERROR,{type:c.ErrorTypes.MEDIA_ERROR,details:c.ErrorDetails.FRAG_PARSING_ERROR,fatal:v,reason:g}),v)return}if(r.initTrackConfig(u,this.observer,d,i,this.audioCodec),n=0,e=r.getFrameDuration(u.samplerate),f&&p){var y=p+e;Math.abs(y-h)>1&&(l.logger.log("AAC: align PTS for overlapping frames by "+Math.round((y-h)/90)),h=y)}for(;i<s;)if(r.isHeader(d,i)&&i+5<s){var _=r.appendFrame(u,d,i,h,n);if(!_)break;i+=_.length,o=_.sample.pts,n++}else i++;f=i<s?d.subarray(i,s):null,this.aacOverFlow=f,this.aacLastPTS=o},t.prototype._parseMPEGPES=function(t){for(var e=t.data,n=e.length,r=0,a=0,o=t.pts;a<n;)if(i.default.isHeader(e,a)){var s=i.default.appendFrame(this._audioTrack,e,a,o,r);if(!s)break;a+=s.length,r++}else a++},t.prototype._parseID3PES=function(t){this._id3Track.samples.push(t)},t}();e.default=h},"./src/errors.js":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ErrorTypes={NETWORK_ERROR:"networkError",MEDIA_ERROR:"mediaError",KEY_SYSTEM_ERROR:"keySystemError",MUX_ERROR:"muxError",OTHER_ERROR:"otherError"},e.ErrorDetails={KEY_SYSTEM_NO_KEYS:"keySystemNoKeys",KEY_SYSTEM_NO_ACCESS:"keySystemNoAccess",KEY_SYSTEM_NO_SESSION:"keySystemNoSession",KEY_SYSTEM_LICENSE_REQUEST_FAILED:"keySystemLicenseRequestFailed",MANIFEST_LOAD_ERROR:"manifestLoadError",MANIFEST_LOAD_TIMEOUT:"manifestLoadTimeOut",MANIFEST_PARSING_ERROR:"manifestParsingError",MANIFEST_INCOMPATIBLE_CODECS_ERROR:"manifestIncompatibleCodecsError",LEVEL_LOAD_ERROR:"levelLoadError",LEVEL_LOAD_TIMEOUT:"levelLoadTimeOut",LEVEL_SWITCH_ERROR:"levelSwitchError",AUDIO_TRACK_LOAD_ERROR:"audioTrackLoadError",AUDIO_TRACK_LOAD_TIMEOUT:"audioTrackLoadTimeOut",FRAG_LOAD_ERROR:"fragLoadError",FRAG_LOAD_TIMEOUT:"fragLoadTimeOut",FRAG_DECRYPT_ERROR:"fragDecryptError",FRAG_PARSING_ERROR:"fragParsingError",REMUX_ALLOC_ERROR:"remuxAllocError",KEY_LOAD_ERROR:"keyLoadError",KEY_LOAD_TIMEOUT:"keyLoadTimeOut",BUFFER_ADD_CODEC_ERROR:"bufferAddCodecError",BUFFER_APPEND_ERROR:"bufferAppendError",BUFFER_APPENDING_ERROR:"bufferAppendingError",BUFFER_STALLED_ERROR:"bufferStalledError",BUFFER_FULL_ERROR:"bufferFullError",BUFFER_SEEK_OVER_HOLE:"bufferSeekOverHole",BUFFER_NUDGE_ON_STALL:"bufferNudgeOnStall",INTERNAL_EXCEPTION:"internalException"}},"./src/event-handler.js":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n("./src/utils/logger.js"),i=n("./src/errors.js"),a=n("./src/events.js"),o={hlsEventGeneric:!0,hlsHandlerDestroying:!0,hlsHandlerDestroyed:!0},s=function(){function t(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];this.hls=t,this.onEvent=this.onEvent.bind(this),this.handledEvents=e,this.useGenericHandler=!0,this.registerListeners()}return t.prototype.destroy=function(){this.onHandlerDestroying(),this.unregisterListeners(),this.onHandlerDestroyed()},t.prototype.onHandlerDestroying=function(){},t.prototype.onHandlerDestroyed=function(){},t.prototype.isEventHandler=function(){return"object"==typeof this.handledEvents&&this.handledEvents.length&&"function"==typeof this.onEvent},t.prototype.registerListeners=function(){this.isEventHandler()&&this.handledEvents.forEach(function(t){if(o[t])throw new Error("Forbidden event-name: "+t);this.hls.on(t,this.onEvent)},this)},t.prototype.unregisterListeners=function(){this.isEventHandler()&&this.handledEvents.forEach(function(t){this.hls.off(t,this.onEvent)},this)},t.prototype.onEvent=function(t,e){this.onEventGeneric(t,e)},t.prototype.onEventGeneric=function(t,e){var n=function(t,e){var n="on"+t.replace("hls","");if("function"!=typeof this[n])throw new Error("Event "+t+" has no generic handler in this "+this.constructor.name+" class (tried "+n+")");return this[n].bind(this,e)};try{n.call(this,t,e).call()}catch(o){r.logger.error("An internal error happened while handling event "+t+'. Error message: "'+o.message+'". Here is a stacktrace:',o),this.hls.trigger(a.default.ERROR,{type:i.ErrorTypes.OTHER_ERROR,details:i.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:t,err:o})}},t}();e.default=s},"./src/events.js":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r={MEDIA_ATTACHING:"hlsMediaAttaching",MEDIA_ATTACHED:"hlsMediaAttached",MEDIA_DETACHING:"hlsMediaDetaching",MEDIA_DETACHED:"hlsMediaDetached",BUFFER_RESET:"hlsBufferReset",BUFFER_CODECS:"hlsBufferCodecs",BUFFER_CREATED:"hlsBufferCreated",BUFFER_APPENDING:"hlsBufferAppending",BUFFER_APPENDED:"hlsBufferAppended",BUFFER_EOS:"hlsBufferEos",BUFFER_FLUSHING:"hlsBufferFlushing",BUFFER_FLUSHED:"hlsBufferFlushed",MANIFEST_LOADING:"hlsManifestLoading",MANIFEST_LOADED:"hlsManifestLoaded",MANIFEST_PARSED:"hlsManifestParsed",LEVEL_SWITCHING:"hlsLevelSwitching",LEVEL_SWITCHED:"hlsLevelSwitched",LEVEL_LOADING:"hlsLevelLoading",LEVEL_LOADED:"hlsLevelLoaded",LEVEL_UPDATED:"hlsLevelUpdated",LEVEL_PTS_UPDATED:"hlsLevelPtsUpdated",AUDIO_TRACKS_UPDATED:"hlsAudioTracksUpdated",AUDIO_TRACK_SWITCHING:"hlsAudioTrackSwitching",AUDIO_TRACK_SWITCHED:"hlsAudioTrackSwitched",AUDIO_TRACK_LOADING:"hlsAudioTrackLoading",AUDIO_TRACK_LOADED:"hlsAudioTrackLoaded",SUBTITLE_TRACKS_UPDATED:"hlsSubtitleTracksUpdated",SUBTITLE_TRACK_SWITCH:"hlsSubtitleTrackSwitch",SUBTITLE_TRACK_LOADING:"hlsSubtitleTrackLoading",SUBTITLE_TRACK_LOADED:"hlsSubtitleTrackLoaded",SUBTITLE_FRAG_PROCESSED:"hlsSubtitleFragProcessed",INIT_PTS_FOUND:"hlsInitPtsFound",FRAG_LOADING:"hlsFragLoading",FRAG_LOAD_PROGRESS:"hlsFragLoadProgress",FRAG_LOAD_EMERGENCY_ABORTED:"hlsFragLoadEmergencyAborted",FRAG_LOADED:"hlsFragLoaded",FRAG_DECRYPTED:"hlsFragDecrypted",FRAG_PARSING_INIT_SEGMENT:"hlsFragParsingInitSegment",FRAG_PARSING_USERDATA:"hlsFragParsingUserdata",FRAG_PARSING_METADATA:"hlsFragParsingMetadata",FRAG_PARSING_DATA:"hlsFragParsingData",FRAG_PARSED:"hlsFragParsed",FRAG_BUFFERED:"hlsFragBuffered",FRAG_CHANGED:"hlsFragChanged",FPS_DROP:"hlsFpsDrop",FPS_DROP_LEVEL_CAPPING:"hlsFpsDropLevelCapping",ERROR:"hlsError",DESTROYING:"hlsDestroying",KEY_LOADING:"hlsKeyLoading",KEY_LOADED:"hlsKeyLoaded",STREAM_STATE_TRANSITION:"hlsStreamStateTransition"};e.default=r},"./src/hls.js":function(t,e,n){"use strict";var r=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var i=n("./node_modules/url-toolkit/src/url-toolkit.js"),a=n("./src/errors.js"),o=n("./src/loader/playlist-loader.js"),s=n("./src/loader/fragment-loader.js"),u=n("./src/loader/key-loader.js"),l=n("./src/controller/fragment-tracker.js"),c=n("./src/controller/stream-controller.js"),d=n("./src/controller/level-controller.js"),h=n("./src/controller/id3-track-controller.js"),f=n("./src/is-supported.js"),p=n("./src/utils/logger.js"),m=n("./src/config.js"),g=n("./src/events.js"),v=n("./src/observer.js"),y=function(t){function e(n){void 0===n&&(n={});var r=t.call(this)||this,i=e.DefaultConfig;if((n.liveSyncDurationCount||n.liveMaxLatencyDurationCount)&&(n.liveSyncDuration||n.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");for(var a in i)a in n||(n[a]=i[a]);if(void 0!==n.liveMaxLatencyDurationCount&&n.liveMaxLatencyDurationCount<=n.liveSyncDurationCount)throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be gt "liveSyncDurationCount"');if(void 0!==n.liveMaxLatencyDuration&&(n.liveMaxLatencyDuration<=n.liveSyncDuration||void 0===n.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be gt "liveSyncDuration"');p.enableLogs(n.debug),r.config=n,r._autoLevelCapping=-1,r._currentServerIndex=0;var f=r.abrController=new n.abrController(r),m=new n.bufferController(r),g=new n.capLevelController(r),v=new n.fpsController(r),y=new o.default(r),_=new s.default(r),b=new u.default(r),E=new h.default(r),w=r.levelController=new d.default(r),A=new l.FragmentTracker(r),S=r.streamController=new c.default(r,A),T=[w,S],x=n.audioStreamController;x&&T.push(new x(r,A)),r.networkControllers=T;var k=[y,_,b,f,m,g,v,E,A];if(x=n.audioTrackController){var C=new x(r);r.audioTrackController=C,k.push(C)}if(x=n.subtitleTrackController){var M=new x(r);r.subtitleTrackController=M,k.push(M)}if(x=n.emeController){var R=new x(r);r.emeController=R,k.push(R)}return x=n.subtitleStreamController,x&&k.push(new x(r,A)),x=n.timelineController,x&&k.push(new x(r)),r.coreComponents=k,r}return r(e,t),Object.defineProperty(e,"version",{get:function(){return"0.1.0-SNAPSHOT"},enumerable:!0,configurable:!0}),e.isSupported=function(){return f.isSupported()},Object.defineProperty(e,"Events",{get:function(){return g.default},enumerable:!0,configurable:!0}),Object.defineProperty(e,"ErrorTypes",{get:function(){return a.ErrorTypes},enumerable:!0,configurable:!0}),Object.defineProperty(e,"ErrorDetails",{get:function(){return a.ErrorDetails},enumerable:!0,configurable:!0}),Object.defineProperty(e,"DefaultConfig",{get:function(){return e.defaultConfig?e.defaultConfig:m.hlsDefaultConfig},set:function(t){e.defaultConfig=t},enumerable:!0,configurable:!0}),e.prototype.destroy=function(){p.logger.log("destroy"),this.trigger(g.default.DESTROYING),this.detachMedia(),this.coreComponents.concat(this.networkControllers).forEach(function(t){t.destroy()}),this.url=null,this.removeAllListeners(),this._autoLevelCapping=-1},e.prototype.attachMedia=function(t){p.logger.log("attachMedia"),this.media=t,this.trigger(g.default.MEDIA_ATTACHING,{media:t})},e.prototype.detachMedia=function(){p.logger.log("detachMedia"),this.trigger(g.default.MEDIA_DETACHING),this.media=null},e.prototype.loadSource=function(t){t=i.buildAbsoluteURL(window.location.href,t,{alwaysNormalize:!0}),p.logger.log("loadSource:"+t),this.url=t,this.trigger(g.default.MANIFEST_LOADING,{url:t})},e.prototype.startLoad=function(t){void 0===t&&(t=-1),p.logger.log("startLoad("+t+")"),this.networkControllers.forEach(function(e){e.startLoad(t)})},e.prototype.stopLoad=function(){p.logger.log("stopLoad"),this.networkControllers.forEach(function(t){t.stopLoad()})},e.prototype.swapAudioCodec=function(){p.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()},e.prototype.recoverMediaError=function(){p.logger.log("recoverMediaError");var t=this.media;this.detachMedia(),this.attachMedia(t)},Object.defineProperty(e.prototype,"levels",{get:function(){return this.levelController.levels},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentLevel",{get:function(){return this.streamController.currentLevel},set:function(t){p.logger.log("set currentLevel:"+t),this.loadLevel=t,this.streamController.immediateLevelSwitch()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nextLevel",{get:function(){return this.streamController.nextLevel},set:function(t){p.logger.log("set nextLevel:"+t),this.levelController.manualLevel=t,this.streamController.nextLevelSwitch()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"loadLevel",{get:function(){return this.levelController.level},set:function(t){p.logger.log("set loadLevel:"+t),this.levelController.manualLevel=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nextLoadLevel",{get:function(){return this.levelController.nextLoadLevel},set:function(t){this.levelController.nextLoadLevel=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"firstLevel",{get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(t){p.logger.log("set firstLevel:"+t),this.levelController.firstLevel=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"startLevel",{get:function(){return this.levelController.startLevel},set:function(t){p.logger.log("set startLevel:"+t);var e=this;-1!==t&&(t=Math.max(t,e.minAutoLevel)),e.levelController.startLevel=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"autoLevelCapping",{get:function(){return this._autoLevelCapping},set:function(t){p.logger.log("set autoLevelCapping:"+t),this._autoLevelCapping=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"autoLevelEnabled",{get:function(){return-1===this.levelController.manualLevel},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"manualLevel",{get:function(){return this.levelController.manualLevel},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"minAutoLevel",{get:function(){for(var t=this,e=t.levels,n=t.config.minAutoBitrate,r=e?e.length:0,i=0;i<r;i++){if((e[i].realBitrate?Math.max(e[i].realBitrate,e[i].bitrate):e[i].bitrate)>n)return i}return 0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxAutoLevel",{get:function(){var t=this,e=t.levels,n=t.autoLevelCapping;return-1===n&&e&&e.length?e.length-1:n},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nextAutoLevel",{get:function(){var t=this;return Math.min(Math.max(t.abrController.nextAutoLevel,t.minAutoLevel),t.maxAutoLevel)},set:function(t){var e=this;e.abrController.nextAutoLevel=Math.max(e.minAutoLevel,t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"audioTracks",{get:function(){var t=this.audioTrackController;return t?t.audioTracks:[]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"audioTrack",{get:function(){var t=this.audioTrackController;return t?t.audioTrack:-1},set:function(t){var e=this.audioTrackController;e&&(e.audioTrack=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"liveSyncPosition",{get:function(){return this.streamController.liveSyncPosition},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"subtitleTracks",{get:function(){var t=this.subtitleTrackController;return t?t.subtitleTracks:[]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"subtitleTrack",{get:function(){var t=this.subtitleTrackController;return t?t.subtitleTrack:-1},set:function(t){var e=this.subtitleTrackController;e&&(e.subtitleTrack=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"subtitleDisplay",{get:function(){var t=this.subtitleTrackController;return!!t&&t.subtitleDisplay},set:function(t){var e=this.subtitleTrackController;e&&(e.subtitleDisplay=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mirrorServer",{get:function(){var t=this;return void 0!==t.config.mirrorServers&&Array.isArray(t.config.mirrorServers)&&t.config.mirrorServers.length>0?t.config.mirrorServers[t._currentServerIndex]:""},enumerable:!0,configurable:!0}),e.prototype.changeMirrorServer=function(){var t=this;null!=t.config.mirrorServers&&t.config.mirrorServers.length>0&&++t._currentServerIndex>t.config.mirrorServers.length-1&&(t._currentServerIndex=0)},e}(v.Observer);e.default=y},"./src/is-supported.js":function(t,e,n){"use strict";function r(){var t=i.getMediaSource(),e=window.SourceBuffer||window.WebKitSourceBuffer,n=t&&"function"==typeof t.isTypeSupported&&t.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),r=!e||e.prototype&&"function"==typeof e.prototype.appendBuffer&&"function"==typeof e.prototype.remove;return!!n&&!!r}Object.defineProperty(e,"__esModule",{value:!0});var i=n("./src/utils/mediasource-helper.js");e.isSupported=r},"./src/loader/fragment-loader.js":function(t,e,n){"use strict";(function(t){var r=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var i=n("./src/events.js"),a=n("./src/event-handler.js"),o=n("./src/errors.js"),s=n("./src/utils/logger.js"),u=function(e){function n(t){var n=e.call(this,t,i.default.FRAG_LOADING)||this;return n.loaders={},n}return r(n,e),n.prototype.destroy=function(){var t=this.loaders;for(var n in t){var r=t[n];r&&r.destroy()}this.loaders={},e.prototype.destroy.call(this)},n.prototype.onFragLoading=function(e){var n=e.frag,r=n.type,i=this.loaders,a=this.hls.config,o=a.fLoader,u=a.loader;n.loaded=0;var l=i[r];l&&(s.logger.warn("abort previous fragment loader for type: "+r),l.abort()),l=i[r]=n.loader=a.fLoader?new o(a):new u(a);var c,d,h;c={url:n.url,frag:n,responseType:"arraybuffer",progressData:!1};var f=n.byteRangeStartOffset,p=n.byteRangeEndOffset;t.isFinite(f)&&t.isFinite(p)&&(c.rangeStart=f,c.rangeEnd=p),d={timeout:a.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:a.fragLoadingMaxRetryTimeout},h={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this),onProgress:this.loadprogress.bind(this)},l.load(c,d,h)},n.prototype.loadsuccess=function(t,e,n,r){void 0===r&&(r=null);var a=t.data,o=n.frag;o.loader=void 0,this.loaders[o.type]=void 0,this.hls.trigger(i.default.FRAG_LOADED,{payload:a,frag:o,stats:e,networkDetails:r})},n.prototype.loaderror=function(t,e,n){void 0===n&&(n=null);var r=e.frag,a=r.loader;a&&a.abort(),this.loaders[r.type]=void 0,this.hls.trigger(i.default.ERROR,{type:o.ErrorTypes.NETWORK_ERROR,details:o.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:e.frag,response:t,networkDetails:n})},n.prototype.loadtimeout=function(t,e,n){void 0===n&&(n=null);var r=e.frag,a=r.loader;a&&a.abort(),this.loaders[r.type]=void 0,this.hls.trigger(i.default.ERROR,{type:o.ErrorTypes.NETWORK_ERROR,details:o.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e.frag,networkDetails:n})},n.prototype.loadprogress=function(t,e,n,r){void 0===r&&(r=null);var a=e.frag;a.loaded=t.loaded,this.hls.trigger(i.default.FRAG_LOAD_PROGRESS,{frag:a,stats:t,networkDetails:r})},n}(a.default);e.default=u}).call(this,n("./src/polyfills/number.js")["Number"])},"./src/loader/fragment.js":function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0});var r=n("./node_modules/url-toolkit/src/url-toolkit.js"),i=n("./src/loader/level-key.js"),a=function(){function e(){var t;this._url=null,this._byteRange=null,this._decryptdata=null,this.tagList=[],this.programDateTime=null,this.rawProgramDateTime=null,this._elementaryStreams=(t={},t[e.ElementaryStreamTypes.AUDIO]=!1,t[e.ElementaryStreamTypes.VIDEO]=!1,t)}return Object.defineProperty(e,"ElementaryStreamTypes",{get:function(){return{AUDIO:"audio",VIDEO:"video"}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"url",{get:function(){return!this._url&&this.relurl&&(this._url=r.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url},set:function(t){this._url=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"byteRange",{get:function(){if(!this._byteRange&&!this.rawByteRange)return[];if(this._byteRange)return this._byteRange;var t=[];if(this.rawByteRange){var e=this.rawByteRange.split("@",2);if(1===e.length){var n=this.lastByteRangeEndOffset;t[0]=n||0}else t[0]=parseInt(e[1]);t[1]=parseInt(e[0])+t[0],this._byteRange=t}return t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"byteRangeStartOffset",{get:function(){return this.byteRange[0]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"byteRangeEndOffset",{get:function(){return this.byteRange[1]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"decryptdata",{get:function(){return this._decryptdata||(this._decryptdata=this.fragmentDecryptdataFromLevelkey(this.levelkey,this.sn)),this._decryptdata},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"endProgramDateTime",{get:function(){if(!t.isFinite(this.programDateTime))return null;var e=t.isFinite(this.duration)?this.duration:0;return this.programDateTime+1e3*e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"encrypted",{get:function(){return!(!this.decryptdata||null===this.decryptdata.uri||null!==this.decryptdata.key)},enumerable:!0,configurable:!0}),e.prototype.addElementaryStream=function(t){this._elementaryStreams[t]=!0},e.prototype.hasElementaryStream=function(t){return!0===this._elementaryStreams[t]},e.prototype.createInitializationVector=function(t){for(var e=new Uint8Array(16),n=12;n<16;n++)e[n]=t>>8*(15-n)&255;return e},e.prototype.fragmentDecryptdataFromLevelkey=function(t,e){var n=t;return t&&t.method&&t.uri&&!t.iv&&(n=new i.default,n.method=t.method,n.baseuri=t.baseuri,n.reluri=t.reluri,n.iv=this.createInitializationVector(e)),n},e}();e.default=a}).call(this,n("./src/polyfills/number.js")["Number"])},"./src/loader/key-loader.js":function(t,e,n){"use strict";var r=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var i=n("./src/events.js"),a=n("./src/event-handler.js"),o=n("./src/errors.js"),s=n("./src/utils/logger.js"),u=function(t){function e(e){var n=t.call(this,e,i.default.KEY_LOADING)||this;return n.loaders={},n.decryptkey=null,n.decrypturl=null,n}return r(e,t),e.prototype.destroy=function(){for(var t in this.loaders){var e=this.loaders[t];e&&e.destroy()}this.loaders={},a.default.prototype.destroy.call(this)},e.prototype.onKeyLoading=function(t){var e=t.frag,n=e.type,r=this.loaders[n],a=e.decryptdata,o=a.uri;if(o!==this.decrypturl||null===this.decryptkey){var u=this.hls.config;r&&(s.logger.warn("abort previous key loader for type:"+n),r.abort()),e.loader=this.loaders[n]=new u.loader(u),this.decrypturl=o,this.decryptkey=null;var l=void 0,c=void 0,d=void 0;l={url:o,frag:e,responseType:"arraybuffer"},c={timeout:u.fragLoadingTimeOut,maxRetry:0,retryDelay:u.fragLoadingRetryDelay,maxRetryDelay:u.fragLoadingMaxRetryTimeout},d={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)},e.loader.load(l,c,d)}else this.decryptkey&&(a.key=this.decryptkey,this.hls.trigger(i.default.KEY_LOADED,{frag:e}))},e.prototype.loadsuccess=function(t,e,n){var r=n.frag;this.decryptkey=r.decryptdata.key=new Uint8Array(t.data),r.loader=void 0,this.loaders[r.type]=void 0,this.hls.trigger(i.default.KEY_LOADED,{frag:r})},e.prototype.loaderror=function(t,e){var n=e.frag,r=n.loader;r&&r.abort(),this.loaders[e.type]=void 0,this.hls.trigger(i.default.ERROR,{type:o.ErrorTypes.NETWORK_ERROR,details:o.ErrorDetails.KEY_LOAD_ERROR,fatal:!1,frag:n,response:t})},e.prototype.loadtimeout=function(t,e){var n=e.frag,r=n.loader;r&&r.abort(),this.loaders[e.type]=void 0,this.hls.trigger(i.default.ERROR,{type:o.ErrorTypes.NETWORK_ERROR,details:o.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:!1,frag:n})},e}(a.default);e.default=u},"./src/loader/level-key.js":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n("./node_modules/url-toolkit/src/url-toolkit.js"),i=function(){function t(){this.method=null,this.key=null,this.iv=null,this._uri=null}return Object.defineProperty(t.prototype,"uri",{get:function(){return!this._uri&&this.reluri&&(this._uri=r.buildAbsoluteURL(this.baseuri,this.reluri,{alwaysNormalize:!0})),this._uri},enumerable:!0,configurable:!0}),t}();e.default=i},"./src/loader/level.js":function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function e(t){this.endCC=0,this.endSN=0,this.fragments=[],this.initSegment=null,this.live=!0,this.needSidxRanges=!1,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=t,this.version=null}return Object.defineProperty(e.prototype,"hasProgramDateTime",{get:function(){return!(!this.fragments[0]||!t.isFinite(this.fragments[0].programDateTime))},enumerable:!0,configurable:!0}),e}();e.default=n}).call(this,n("./src/polyfills/number.js")["Number"])},"./src/loader/m3u8-parser.js":function(t,e,n){"use strict";(function(t){function r(t,e){for(var n=t[e],r=e-1;r>=0;r--){var i=t[r];i.programDateTime=n.programDateTime-1e3*i.duration,n=i}}function i(e,n){e.rawProgramDateTime?e.programDateTime=Date.parse(e.rawProgramDateTime):n&&n.programDateTime&&(e.programDateTime=n.endProgramDateTime),t.isFinite(e.programDateTime)||(e.programDateTime=null,e.rawProgramDateTime=null)}Object.defineProperty(e,"__esModule",{value:!0});var a=n("./node_modules/url-toolkit/src/url-toolkit.js"),o=n("./src/loader/fragment.js"),s=n("./src/loader/level.js"),u=n("./src/loader/level-key.js"),l=n("./src/utils/attr-list.js"),c=n("./src/utils/logger.js"),d=n("./src/utils/codecs.js"),h=/#EXT-X-STREAM-INF:([^\n\r]*)[\r\n]+([^\r\n]+)/g,f=/#EXT-X-MEDIA:(.*)/g,p=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/|(?!#)([\S+ ?]+)/.source,/|#EXT-X-BYTERANGE:*(.+)/.source,/|#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/|#.*/.source].join(""),"g"),m=/(?:(?:#(EXTM3U))|(?:#EXT-X-(PLAYLIST-TYPE):(.+))|(?:#EXT-X-(MEDIA-SEQUENCE): *(\d+))|(?:#EXT-X-(TARGETDURATION): *(\d+))|(?:#EXT-X-(KEY):(.+))|(?:#EXT-X-(START):(.+))|(?:#EXT-X-(ENDLIST))|(?:#EXT-X-(DISCONTINUITY-SEQ)UENCE:(\d+))|(?:#EXT-X-(DIS)CONTINUITY))|(?:#EXT-X-(VERSION):(\d+))|(?:#EXT-X-(MAP):(.+))|(?:(#)([^:]*):(.*))|(?:(#)(.*))(?:.*)\r?\n?/,g=/\.(mp4|m4s|m4v|m4a)$/i,v=function(){function e(){}return e.findGroup=function(t,e){if(!t)return null;for(var n=null,r=0;r<t.length;r++){var i=t[r];i.id===e&&(n=i)}return n},e.convertAVC1ToAVCOTI=function(t){var e,n=t.split(".");return n.length>2?(e=n.shift()+".",e+=parseInt(n.shift()).toString(16),e+=("000"+parseInt(n.shift()).toString(16)).substr(-4)):e=t,e},e.resolve=function(t,e){return a.buildAbsoluteURL(e,t,{alwaysNormalize:!0})},e.parseMasterPlaylist=function(t,n,r){var i,a=[];for(h.lastIndex=0;null!=(i=h.exec(t));){var o={},s=o.attrs=new l.default(i[1]);if(o.url=e.resolve(i[2],n),""!==r){var u="";u=o.url.indexOf("https://")>=0?o.url.substring(8,o.url.length):o.url.indexOf("http://")>=0?o.url.substring(7,o.url.length):o.url,u=u.substr(0,u.indexOf("/"));var c=u.lastIndexOf(":");c>0&&(u=u.substr(0,c)),o.url=o.url.replace(u,r)}var f=s.decimalResolution("RESOLUTION");f&&(o.width=f.width,o.height=f.height),o.bitrate=s.decimalInteger("AVERAGE-BANDWIDTH")||s.decimalInteger("BANDWIDTH"),o.name=s.NAME,o.definition=s.DEFINITION,function(t,e){["video","audio"].forEach(function(n){var r=t.filter(function(t){return d.isCodecType(t,n)});if(r.length){var i=r.filter(function(t){return 0===t.lastIndexOf("avc1",0)||0===t.lastIndexOf("mp4a",0)});e[n+"Codec"]=i.length>0?i[0]:r[0],t=t.filter(function(t){return-1===r.indexOf(t)})}}),e.unknownCodecs=t}([].concat((s.CODECS||"").split(/[ ,]+/)),o),o.videoCodec&&-1!==o.videoCodec.indexOf("avc1")&&(o.videoCodec=e.convertAVC1ToAVCOTI(o.videoCodec)),a.push(o)}return a},e.parseMasterPlaylistMedia=function(t,n,r,i){void 0===i&&(i=[]);var a,o=[],s=0;for(f.lastIndex=0;null!==(a=f.exec(t));){var u={},c=new l.default(a[1]);if(c.TYPE===r){if(u.groupId=c["GROUP-ID"],u.name=c.NAME,u.type=r,u.default="YES"===c.DEFAULT,u.autoselect="YES"===c.AUTOSELECT,u.forced="YES"===c.FORCED,c.URI&&(u.url=e.resolve(c.URI,n)),u.lang=c.LANGUAGE,u.name||(u.name=u.lang),i.length){var d=e.findGroup(i,u.groupId);u.audioCodec=d?d.codec:i[0].codec}u.id=s++,o.push(u)}}return o},e.parseLevelPlaylist=function(e,n,a,d,h){var f,v,y=0,_=0,b=new s.default(n),E=new u.default,w=0,A=null,S=new o.default,T=null;for(p.lastIndex=0;null!==(f=p.exec(e));){var x=f[1];if(x){S.duration=parseFloat(x);var k=(" "+f[2]).slice(1);S.title=k||null,S.tagList.push(k?["INF",x,k]:["INF",x])}else if(f[3]){if(t.isFinite(S.duration)){var C=y++;S.type=d,S.start=_,S.levelkey=E,S.sn=C,S.level=a,S.cc=w,S.urlId=h,S.baseurl=n,S.relurl=(" "+f[3]).slice(1),i(S,A),b.fragments.push(S),A=S,_+=S.duration,S=new o.default}}else if(f[4]){if(S.rawByteRange=(" "+f[4]).slice(1),A){var M=A.byteRangeEndOffset;M&&(S.lastByteRangeEndOffset=M)}}else if(f[5])S.rawProgramDateTime=(" "+f[5]).slice(1),S.tagList.push(["PROGRAM-DATE-TIME",S.rawProgramDateTime]),null===T&&(T=b.fragments.length);else{for(f=f[0].match(m),v=1;v<f.length&&void 0===f[v];v++);var R=(" "+f[v+1]).slice(1),L=(" "+f[v+2]).slice(1);switch(f[v]){case"#":S.tagList.push(L?[R,L]:[R]);break;case"PLAYLIST-TYPE":b.type=R.toUpperCase();break;case"MEDIA-SEQUENCE":y=b.startSN=parseInt(R);break;case"TARGETDURATION":b.targetduration=parseFloat(R);break;case"VERSION":b.version=parseInt(R);break;case"EXTM3U":break;case"ENDLIST":b.live=!1;break;case"DIS":w++,S.tagList.push(["DIS"]);break;case"DISCONTINUITY-SEQ":w=parseInt(R);break;case"KEY":var I=R,P=new l.default(I),O=P.enumeratedString("METHOD"),D=P.URI,N=P.hexadecimalInteger("IV");O&&(E=new u.default,D&&["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"].indexOf(O)>=0&&(E.method=O,E.baseuri=n,E.reluri=D,E.key=null,E.iv=N));break;case"START":var U=R,F=new l.default(U),B=F.decimalFloatingPoint("TIME-OFFSET");t.isFinite(B)&&(b.startTimeOffset=B);break;case"MAP":var j=new l.default(R);S.relurl=j.URI,S.rawByteRange=j.BYTERANGE,S.baseurl=n,S.level=a,S.type=d,S.sn="initSegment",b.initSegment=S,S=new o.default,S.rawProgramDateTime=b.initSegment.rawProgramDateTime;break;default:c.logger.warn("line parsed but not handled: "+f)}}}return S=A,S&&!S.relurl&&(b.fragments.pop(),_-=S.duration),b.totalduration=_,b.averagetargetduration=_/b.fragments.length,b.endSN=y-1,b.startCC=b.fragments[0]?b.fragments[0].cc:0,b.endCC=w,!b.initSegment&&b.fragments.length&&b.fragments.every(function(t){return g.test(t.relurl)})&&(c.logger.warn("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX"),S=new o.default,S.relurl=b.fragments[0].relurl,S.baseurl=n,S.level=a,S.type=d,S.sn="initSegment",b.initSegment=S,b.needSidxRanges=!0),T&&r(b.fragments,T),b},e}();e.default=v}).call(this,n("./src/polyfills/number.js")["Number"])},"./src/loader/playlist-loader.js":function(t,e,n){"use strict";(function(t){var r=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var i=n("./src/events.js"),a=n("./src/event-handler.js"),o=n("./src/errors.js"),s=n("./src/utils/logger.js"),u=n("./src/demux/mp4demuxer.js"),l=n("./src/loader/m3u8-parser.js"),c=window.performance,d={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},h={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"},f=function(e){function n(t){var n=e.call(this,t,i.default.MANIFEST_LOADING,i.default.LEVEL_LOADING,i.default.AUDIO_TRACK_LOADING,i.default.SUBTITLE_TRACK_LOADING)||this;return n.loaders={},n}return r(n,e),Object.defineProperty(n,"ContextType",{get:function(){return d},enumerable:!0,configurable:!0}),Object.defineProperty(n,"LevelType",{get:function(){return h},enumerable:!0,configurable:!0}),n.canHaveQualityLevels=function(t){return t!==d.AUDIO_TRACK&&t!==d.SUBTITLE_TRACK},n.mapContextToLevelType=function(t){switch(t.type){case d.AUDIO_TRACK:return h.AUDIO;case d.SUBTITLE_TRACK:return h.SUBTITLE;default:return h.MAIN}},n.getResponseUrl=function(t,e){var n=t.url;return void 0!==n&&0!==n.indexOf("data:")||(n=e.url),n},n.prototype.createInternalLoader=function(t){var e=this.hls.config,n=e.pLoader,r=e.loader,i=n||r,a=new i(e);return t.loader=a,this.loaders[t.type]=a,a},n.prototype.getInternalLoader=function(t){return this.loaders[t.type]},n.prototype.resetInternalLoader=function(t){this.loaders[t]&&delete this.loaders[t]},n.prototype.destroyInternalLoaders=function(){for(var t in this.loaders){var e=this.loaders[t];e&&e.destroy(),this.resetInternalLoader(t)}},n.prototype.destroy=function(){this.destroyInternalLoaders(),e.prototype.destroy.call(this)},n.prototype.onManifestLoading=function(t){this.load(t.url,{type:d.MANIFEST,level:0,id:null})},n.prototype.onLevelLoading=function(t){this.load(t.url,{type:d.LEVEL,level:t.level,id:t.id})},n.prototype.onAudioTrackLoading=function(t){this.load(t.url,{type:d.AUDIO_TRACK,level:null,id:t.id})},n.prototype.onSubtitleTrackLoading=function(t){this.load(t.url,{type:d.SUBTITLE_TRACK,level:null,id:t.id})},n.prototype.load=function(t,e){var n=this.hls.config;s.logger.debug("Loading playlist of type "+e.type+", level: "+e.level+", id: "+e.id);var r=this.getInternalLoader(e);if(r){var i=r.context;if(i&&i.url===t)return s.logger.trace("playlist request ongoing"),!1;s.logger.warn("aborting previous loader for type: "+e.type),r.abort()}var a,o,u,l;switch(e.type){case d.MANIFEST:a=n.manifestLoadingMaxRetry,o=n.manifestLoadingTimeOut,u=n.manifestLoadingRetryDelay,l=n.manifestLoadingMaxRetryTimeout;break;case d.LEVEL:a=0,o=n.levelLoadingTimeOut;break;default:a=n.levelLoadingMaxRetry,o=n.levelLoadingTimeOut,u=n.levelLoadingRetryDelay,l=n.levelLoadingMaxRetryTimeout}r=this.createInternalLoader(e),e.url=t,e.responseType=e.responseType||"";var c={timeout:o,maxRetry:a,retryDelay:u,maxRetryDelay:l},h={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};return s.logger.debug("Calling internal loader delegate for URL: "+t),r.load(e,c,h),!0},n.prototype.loadsuccess=function(t,e,n,r){if(void 0===r&&(r=null),n.isSidxRequest)return this._handleSidxRequest(t,n),void this._handlePlaylistLoaded(t,e,n,r);this.resetInternalLoader(n.type);var i=t.data;if(e.tload=c.now(),0!==i.indexOf("#EXTM3U"))return void this._handleManifestParsingError(t,n,"no EXTM3U delimiter",r);i.indexOf("#EXTINF:")>0||i.indexOf("#EXT-X-TARGETDURATION:")>0?this._handleTrackOrLevelPlaylist(t,e,n,r):this._handleMasterPlaylist(t,e,n,r)},n.prototype.loaderror=function(t,e,n){void 0===n&&(n=null),this._handleNetworkError(e,n,!1,t)},n.prototype.loadtimeout=function(t,e,n){void 0===n&&(n=null),this._handleNetworkError(e,n,!0)},n.prototype._handleMasterPlaylist=function(t,e,r,a){var o=this.hls,u=t.data,c=n.getResponseUrl(t,r),d=l.default.parseMasterPlaylist(u,c,o.mirrorServer);if(!d.length)return void this._handleManifestParsingError(t,r,"no level found in manifest",a);var h=d.map(function(t){return{id:t.attrs.AUDIO,codec:t.audioCodec}}),f=l.default.parseMasterPlaylistMedia(u,c,"AUDIO",h),p=l.default.parseMasterPlaylistMedia(u,c,"SUBTITLES");if(f.length){var m=!1;f.forEach(function(t){t.url||(m=!0)}),!1===m&&d[0].audioCodec&&!d[0].attrs.AUDIO&&(s.logger.log("audio codec signaled in quality level, but no embedded audio track signaled, create one"),f.unshift({type:"main",name:"main"}))}o.trigger(i.default.MANIFEST_LOADED,{levels:d,audioTracks:f,subtitles:p,url:c,stats:e,networkDetails:a})},n.prototype._handleTrackOrLevelPlaylist=function(e,r,a,o){var s=this.hls,u=a.id,h=a.level,f=a.type,p=n.getResponseUrl(e,a),m=t.isFinite(u)?u:0,g=t.isFinite(h)?h:m,v=n.mapContextToLevelType(a),y=l.default.parseLevelPlaylist(e.data,p,g,v,m);if(y.tload=r.tload,f===d.MANIFEST){var _={url:p,details:y};s.trigger(i.default.MANIFEST_LOADED,{levels:[_],audioTracks:[],url:p,stats:r,networkDetails:o})}if(r.tparsed=c.now(),y.needSidxRanges){var b=y.initSegment.url;return void this.load(b,{isSidxRequest:!0,type:f,level:h,levelDetails:y,id:u,rangeStart:0,rangeEnd:2048,responseType:"arraybuffer"})}a.levelDetails=y,this._handlePlaylistLoaded(e,r,a,o)},n.prototype._handleSidxRequest=function(t,e){var n=u.default.parseSegmentIndex(new Uint8Array(t.data));if(n){var r=n.references,i=e.levelDetails;r.forEach(function(t,e){var n=t.info,r=i.fragments[e];0===r.byteRange.length&&(r.rawByteRange=String(1+n.end-n.start)+"@"+String(n.start))}),i.initSegment.rawByteRange=String(n.moovEndOffset)+"@0"}},n.prototype._handleManifestParsingError=function(t,e,n,r){this.hls.trigger(i.default.ERROR,{type:o.ErrorTypes.NETWORK_ERROR,details:o.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:!0,url:t.url,reason:n,networkDetails:r})},n.prototype._handleNetworkError=function(t,e,n,r){void 0===n&&(n=!1),void 0===r&&(r=null),s.logger.info("A network error occured while loading a "+t.type+"-type playlist");var a,u,l=this.getInternalLoader(t);switch(t.type){case d.MANIFEST:a=n?o.ErrorDetails.MANIFEST_LOAD_TIMEOUT:o.ErrorDetails.MANIFEST_LOAD_ERROR,u=!0;break;case d.LEVEL:a=n?o.ErrorDetails.LEVEL_LOAD_TIMEOUT:o.ErrorDetails.LEVEL_LOAD_ERROR,u=!1;break;case d.AUDIO_TRACK:a=n?o.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:o.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,u=!1;break;default:u=!1}l&&(l.abort(),this.resetInternalLoader(t.type));var c={type:o.ErrorTypes.NETWORK_ERROR,details:a,fatal:u,url:l.url,loader:l,context:t,networkDetails:e};r&&(c.response=r),this.hls.trigger(i.default.ERROR,c)},n.prototype._handlePlaylistLoaded=function(t,e,r,a){var o=r.type,s=r.level,u=r.id,l=r.levelDetails;if(!l.targetduration)return void this._handleManifestParsingError(t,r,"invalid target duration",a);if(n.canHaveQualityLevels(r.type))this.hls.trigger(i.default.LEVEL_LOADED,{details:l,level:s||0,id:u||0,stats:e,networkDetails:a});else switch(o){case d.AUDIO_TRACK:this.hls.trigger(i.default.AUDIO_TRACK_LOADED,{details:l,id:u,stats:e,networkDetails:a});break;case d.SUBTITLE_TRACK:this.hls.trigger(i.default.SUBTITLE_TRACK_LOADED,{details:l,id:u,stats:e,networkDetails:a})}},n}(a.default);e.default=f}).call(this,n("./src/polyfills/number.js")["Number"])},"./src/observer.js":function(t,e,n){"use strict";var r=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var i=n("./node_modules/eventemitter3/index.js"),a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype.trigger=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];this.emit.apply(this,[t,t].concat(e))},e}(i.EventEmitter);e.Observer=a},"./src/polyfills/number.js":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n("./src/utils/get-self-scope.js"),i=r.getSelfScope(),a=i.Number;e.Number=a,a.isFinite=a.isFinite||function(t){return"number"==typeof t&&isFinite(t)}},"./src/remux/aac-helper.js":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(){}return t.getSilentFrame=function(t,e){switch(t){case"mp4a.40.2":if(1===e)return new Uint8Array([0,200,0,128,35,128]);if(2===e)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(1===e)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===e)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===e)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null},t}();e.default=r},"./src/remux/mp4-generator.js":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=Math.pow(2,32)-1,i=function(){function t(){}return t.init=function(){t.types={avc1:[],avcC:[],hvcC:[],hev1:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};var e;for(e in t.types)t.types.hasOwnProperty(e)&&(t.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);var n=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),r=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);t.HDLR_TYPES={video:n,audio:r};var i=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),a=new Uint8Array([0,0,0,0,0,0,0,0]);t.STTS=t.STSC=t.STCO=a,t.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),t.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),t.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),t.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var o=new Uint8Array([105,115,111,109]),s=new Uint8Array([97,118,99,49]),u=new Uint8Array([104,101,118,49]),l=new Uint8Array([0,0,0,1]);t.FTYPAVC1=t.box(t.types.ftyp,o,l,o,s),t.FTYPHVC1=t.box(t.types.ftyp,o,l,o,u),t.DINF=t.box(t.types.dinf,t.box(t.types.dref,i))},t.box=function(t){for(var e,n=Array.prototype.slice.call(arguments,1),r=8,i=n.length,a=i;i--;)r+=n[i].byteLength;for(e=new Uint8Array(r),e[0]=r>>24&255,e[1]=r>>16&255,e[2]=r>>8&255,e[3]=255&r,e.set(t,4),i=0,r=8;i<a;i++)e.set(n[i],r),r+=n[i].byteLength;return e},t.hdlr=function(e){return t.box(t.types.hdlr,t.HDLR_TYPES[e])},t.mdat=function(e){return t.box(t.types.mdat,e)},t.mdhd=function(e,n){n*=e;var i=Math.floor(n/(r+1)),a=Math.floor(n%(r+1));return t.box(t.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,255&e,i>>24,i>>16&255,i>>8&255,255&i,a>>24,a>>16&255,a>>8&255,255&a,85,196,0,0]))},t.mdia=function(e){return t.box(t.types.mdia,t.mdhd(e.timescale,e.duration),t.hdlr(e.type),t.minf(e))},t.mfhd=function(e){return t.box(t.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,255&e]))},t.minf=function(e){return"audio"===e.type?t.box(t.types.minf,t.box(t.types.smhd,t.SMHD),t.DINF,t.stbl(e)):t.box(t.types.minf,t.box(t.types.vmhd,t.VMHD),t.DINF,t.stbl(e))},t.moof=function(e,n,r){return t.box(t.types.moof,t.mfhd(e),t.traf(r,n))},t.moov=function(e){for(var n=e.length,r=[];n--;)r[n]=t.trak(e[n]);return t.box.apply(null,[t.types.moov,t.mvhd(e[0].timescale,e[0].duration)].concat(r).concat(t.mvex(e)))},t.mvex=function(e){for(var n=e.length,r=[];n--;)r[n]=t.trex(e[n]);return t.box.apply(null,[t.types.mvex].concat(r))},t.mvhd=function(e,n){n*=e;var i=Math.floor(n/(r+1)),a=Math.floor(n%(r+1)),o=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,255&e,i>>24,i>>16&255,i>>8&255,255&i,a>>24,a>>16&255,a>>8&255,255&a,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return t.box(t.types.mvhd,o)},t.sdtp=function(e){var n,r,i=e.samples||[],a=new Uint8Array(4+i.length);for(r=0;r<i.length;r++)n=i[r].flags,a[r+4]=n.dependsOn<<4|n.isDependedOn<<2|n.hasRedundancy;return t.box(t.types.sdtp,a)},t.stbl=function(e){return t.box(t.types.stbl,t.stsd(e),t.box(t.types.stts,t.STTS),t.box(t.types.stsc,t.STSC),t.box(t.types.stsz,t.STSZ),t.box(t.types.stco,t.STCO))},t.hvc1=function(e){var n,r,i,a=[],o=[],s=[];for(a.push(32),a.push(0),a.push(e.vps.length),n=0;n<e.vps.length;n++)r=e.vps[n],i=r.byteLength,a.push(i>>>8&255),a.push(255&i),a=a.concat(Array.prototype.slice.call(r));for(o.push(33),o.push(0),o.push(e.sps.length),n=0;n<e.sps.length;n++)r=e.sps[n],i=r.byteLength,o.push(i>>>8&255),o.push(255&i),o=o.concat(Array.prototype.slice.call(r));for(s.push(34),s.push(0),s.push(e.pps.length),n=0;n<e.pps.length;n++)r=e.pps[n],i=r.byteLength,s.push(i>>>8&255),s.push(255&i),s=s.concat(Array.prototype.slice.call(r));var u=e.vps.length+e.sps.length+e.pps.length,l=t.box(t.types.hvcC,new Uint8Array([1,1,96,0,0,0,128,0,0,0,0,0,120,240,0,252,252|3&e.chromaFormatIdc,248|7&e.bitDepthLumaMinus8,248|7&e.bitDepthChromaMinus8,0,0,15,u].concat(a).concat(o).concat(s)));return t.box(t.types.hev1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,e.width>>8&255,255&e.width,e.height>>8&255,255&e.height,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),l,t.box(t.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),t.box(t.types.pasp,new Uint8Array([0,0,0,1,0,0,0,1])))},t.avc1=function(e){var n,r,i,a=[],o=[];for(n=0;n<e.sps.length;n++)r=e.sps[n],i=r.byteLength,a.push(i>>>8&255),a.push(255&i),a=a.concat(Array.prototype.slice.call(r));for(n=0;n<e.pps.length;n++)r=e.pps[n],i=r.byteLength,o.push(i>>>8&255),o.push(255&i),o=o.concat(Array.prototype.slice.call(r));var s=t.box(t.types.avcC,new Uint8Array([1,a[3],a[4],a[5],255,224|e.sps.length].concat(a).concat([e.pps.length]).concat(o))),u=e.width,l=e.height,c=e.pixelRatio[0],d=e.pixelRatio[1];return t.box(t.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,u>>8&255,255&u,l>>8&255,255&l,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),s,t.box(t.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),t.box(t.types.pasp,new Uint8Array([c>>24,c>>16&255,c>>8&255,255&c,d>>24,d>>16&255,d>>8&255,255&d])))},t.esds=function(t){var e=t.config.length;return new Uint8Array([0,0,0,0,3,23+e,0,1,0,4,15+e,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([e]).concat(t.config).concat([6,1,2]))},t.mp4a=function(e){var n=e.samplerate;return t.box(t.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount,0,16,0,0,0,0,n>>8&255,255&n,0,0]),t.box(t.types.esds,t.esds(e)))},t.mp3=function(e){var n=e.samplerate;return t.box(t.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount,0,16,0,0,0,0,n>>8&255,255&n,0,0]))},t.stsd=function(e){return"audio"===e.type?e.isAAC||"mp3"!==e.codec?t.box(t.types.stsd,t.STSD,t.mp4a(e)):t.box(t.types.stsd,t.STSD,t.mp3(e)):36===e.streamType?t.box(t.types.stsd,t.STSD,t.hvc1(e)):t.box(t.types.stsd,t.STSD,t.avc1(e))},t.tkhd=function(e){var n=e.id,i=e.duration*e.timescale,a=e.width,o=e.height,s=Math.floor(i/(r+1)),u=Math.floor(i%(r+1));return t.box(t.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,n>>24&255,n>>16&255,n>>8&255,255&n,0,0,0,0,s>>24,s>>16&255,s>>8&255,255&s,u>>24,u>>16&255,u>>8&255,255&u,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,a>>8&255,255&a,0,0,o>>8&255,255&o,0,0]))},t.traf=function(e,n){var i=t.sdtp(e),a=e.id,o=Math.floor(n/(r+1)),s=Math.floor(n%(r+1));return t.box(t.types.traf,t.box(t.types.tfhd,new Uint8Array([0,0,0,0,a>>24,a>>16&255,a>>8&255,255&a])),t.box(t.types.tfdt,new Uint8Array([1,0,0,0,o>>24,o>>16&255,o>>8&255,255&o,s>>24,s>>16&255,s>>8&255,255&s])),t.trun(e,i.length+16+20+8+16+8+8),i)},t.trak=function(e){return e.duration=e.duration||4294967295,t.box(t.types.trak,t.tkhd(e),t.mdia(e))},t.trex=function(e){var n=e.id;return t.box(t.types.trex,new Uint8Array([0,0,0,0,n>>24,n>>16&255,n>>8&255,255&n,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},t.trun=function(e,n){var r,i,a,o,s,u,l=e.samples||[],c=l.length,d=12+16*c,h=new Uint8Array(d);for(n+=8+d,h.set([0,0,15,1,c>>>24&255,c>>>16&255,c>>>8&255,255&c,n>>>24&255,n>>>16&255,n>>>8&255,255&n],0),r=0;r<c;r++)i=l[r],a=i.duration,o=i.size,s=i.flags,u=i.cts,h.set([a>>>24&255,a>>>16&255,a>>>8&255,255&a,o>>>24&255,o>>>16&255,o>>>8&255,255&o,s.isLeading<<2|s.dependsOn,s.isDependedOn<<6|s.hasRedundancy<<4|s.paddingValue<<1|s.isNonSync,61440&s.degradPrio,15&s.degradPrio,u>>>24&255,u>>>16&255,u>>>8&255,255&u],12+16*r);return t.box(t.types.trun,h)},t.initSegment=function(e){t.types||t.init();var n,r=t.moov(e);return"video"===e[0].type&&36===e[0].streamType?(n=new Uint8Array(t.FTYPHVC1.byteLength+r.byteLength),n.set(t.FTYPHVC1),n.set(r,t.FTYPHVC1.byteLength)):(n=new Uint8Array(t.FTYPAVC1.byteLength+r.byteLength),n.set(t.FTYPAVC1),n.set(r,t.FTYPAVC1.byteLength)),n},t}();e.default=i},"./src/remux/mp4-remuxer.js":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n("./src/remux/aac-helper.js"),i=n("./src/remux/mp4-generator.js"),a=n("./src/events.js"),o=n("./src/errors.js"),s=n("./src/utils/logger.js"),u=function(){function t(t,e,n,r){this.observer=t,this.config=e,this.typeSupported=n;var i=navigator.userAgent;this.isSafari=r&&r.indexOf("Apple")>-1&&i&&!i.match("CriOS"),this.ISGenerated=!1}return t.prototype.destroy=function(){},t.prototype.resetTimeStamp=function(t){this._initPTS=this._initDTS=t},t.prototype.resetInitSegment=function(){this.ISGenerated=!1},t.prototype.remux=function(t,e,n,r,i,o,u){if(this.ISGenerated||this.generateIS(t,e,i),this.ISGenerated){var l=t.samples.length,c=e.samples.length,d=i,h=i;if(l&&c){var f=(t.samples[0].pts-e.samples[0].pts)/e.inputTimeScale;d+=Math.max(0,f),h+=Math.max(0,-f)}if(l){t.timescale||(s.logger.warn("regenerate InitSegment as audio detected"),this.generateIS(t,e,i));var p=this.remuxAudio(t,d,o,u);if(c){var m=void 0;p&&(m=p.endPTS-p.startPTS),e.timescale||(s.logger.warn("regenerate InitSegment as video detected"),this.generateIS(t,e,i)),this.remuxVideo(e,h,o,m,u)}}else if(c){var g=this.remuxVideo(e,h,o,0,u);g&&t.codec&&this.remuxEmptyAudio(t,d,o,g)}}n.samples.length&&this.remuxID3(n,i),r.samples.length&&this.remuxText(r,i),this.observer.trigger(a.default.FRAG_PARSED)},t.prototype.generateIS=function(t,e,n){var r,u,l=this.observer,c=t.samples,d=e.samples,h=this.typeSupported,f="audio/mp4",p={},m={tracks:p},g=void 0===this._initPTS;if(g&&(r=u=1/0),t.config&&c.length&&(t.timescale=t.samplerate,s.logger.log("audio sampling rate : "+t.samplerate),t.isAAC||(h.mpeg?(f="audio/mpeg",t.codec=""):h.mp3&&(t.codec="mp3")),p.audio={container:f,codec:t.codec,initSegment:!t.isAAC&&h.mpeg?new Uint8Array:i.default.initSegment([t]),metadata:{channelCount:t.channelCount}},g&&(r=u=c[0].pts-t.inputTimeScale*n)),e.sps&&e.pps&&d.length){var v=e.inputTimeScale;e.timescale=v,p.video={container:"video/mp4",codec:e.codec,initSegment:i.default.initSegment([e]),metadata:{width:e.width,height:e.height}},g&&(r=Math.min(r,d[0].pts-v*n),u=Math.min(u,d[0].dts-v*n),this.observer.trigger(a.default.INIT_PTS_FOUND,{initPTS:r}))}Object.keys(p).length?(l.trigger(a.default.FRAG_PARSING_INIT_SEGMENT,m),this.ISGenerated=!0,g&&(this._initPTS=r,this._initDTS=u)):l.trigger(a.default.ERROR,{type:o.ErrorTypes.MEDIA_ERROR,details:o.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"no audio/video samples found"})},t.prototype.remuxVideo=function(t,e,n,r,u){var l,c,d,h,f,p,m,g=8,v=t.timescale,y=t.samples,_=[],b=y.length,E=this._PTSNormalize,w=this._initPTS,A=this.nextAvcDts,S=this.isSafari;if(0!==b){S&&(n|=y.length&&A&&(u&&Math.abs(e-A/v)<.1||Math.abs(y[0].pts-A-w)<v/5)),n||(A=e*v),y.forEach(function(t){t.pts=E(t.pts-w,A),t.dts=E(t.dts-w,A)}),y.sort(function(t,e){var n=t.dts-e.dts,r=t.pts-e.pts;return n||r||t.id-e.id});var T=y.reduce(function(t,e){return Math.max(Math.min(t,e.pts-e.dts),-18e3)},0);if(T<0){s.logger.warn("PTS < DTS detected in video samples, shifting DTS by "+Math.round(T/90)+" ms to overcome this issue");for(var x=0;x<y.length;x++)y[x].dts+=T}var k=y[0];f=Math.max(k.dts,0),h=Math.max(k.pts,0);var C=Math.round((f-A)/90);n&&C&&(C>1?s.logger.log("AVC:"+C+" ms hole between fragments detected,filling it"):C<-1&&s.logger.log("AVC:"+-C+" ms overlapping between fragments detected"),f=A,y[0].dts=f,h=Math.max(h-C,A),y[0].pts=h,s.logger.log("Video/PTS/DTS adjusted: "+Math.round(h/90)+"/"+Math.round(f/90)+",delta:"+C+" ms")),k=y[y.length-1],m=Math.max(k.dts,0),p=Math.max(k.pts,0,m),S&&(l=Math.round((m-f)/(y.length-1)));for(var M=0,R=0,x=0;x<b;x++){for(var L=y[x],I=L.units,P=I.length,O=0,D=0;D<P;D++)O+=I[D].data.length;R+=O,M+=P,L.length=O,L.dts=S?f+x*l:Math.max(L.dts,f),L.pts=Math.max(L.pts,L.dts)}var N=R+4*M+8;try{c=new Uint8Array(N)}catch(J){return void this.observer.trigger(a.default.ERROR,{type:o.ErrorTypes.MUX_ERROR,details:o.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:N,reason:"fail allocating video mdat "+N})}var U=new DataView(c.buffer);U.setUint32(0,N),c.set(i.default.types.mdat,4);for(var x=0;x<b;x++){for(var F=y[x],B=F.units,j=0,V=void 0,D=0,P=B.length;D<P;D++){var G=B[D],z=G.data,H=G.data.byteLength;U.setUint32(g,H),g+=4,c.set(z,g),g+=H,j+=4+H}if(S)V=Math.max(0,l*Math.round((F.pts-F.dts)/l));else{if(x<b-1)l=y[x+1].dts-F.dts;else{var K=this.config,Y=F.dts-y[x>0?x-1:x].dts;if(K.stretchShortVideoTrack){var W=K.maxBufferHole,q=Math.floor(W*v),X=(r?h+r*v:this.nextAudioPts)-F.pts;X>q?(l=X-Y,l<0&&(l=Y),s.logger.log("It is approximately "+X/90+" ms to the next segment; using duration "+l/90+" ms for the last video frame.")):l=Y}else l=Y}V=Math.round(F.pts-F.dts)}_.push({size:j,duration:l,cts:V,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:F.key?2:1,isNonSync:F.key?0:1}})}this.nextAvcDts=m+l;var $=t.dropped;if(t.len=0,t.nbNalu=0,t.dropped=0,_.length&&navigator.userAgent.toLowerCase().indexOf("chrome")>-1){var Z=_[0].flags;Z.dependsOn=2,Z.isNonSync=0}t.samples=_,d=i.default.moof(t.sequenceNumber++,f,t),t.samples=[];var Q={data1:d,data2:c,startPTS:h/v,endPTS:(p+l)/v,startDTS:f/v,endDTS:this.nextAvcDts/v,type:"video",hasAudio:!1,hasVideo:!0,nb:_.length,dropped:$};return this.observer.trigger(a.default.FRAG_PARSING_DATA,Q),Q}},t.prototype.remuxAudio=function(t,e,n,u){var l,c,d,h,f,p,m,g=t.inputTimeScale,v=t.timescale,y=g/v,_=t.isAAC?1024:1152,b=_*y,E=this._PTSNormalize,w=this._initPTS,A=!t.isAAC&&this.typeSupported.mpeg,S=t.samples,T=[],x=this.nextAudioPts;if(n|=S.length&&x&&(u&&Math.abs(e-x/g)<.1||Math.abs(S[0].pts-x-w)<20*b),S.forEach(function(t){t.pts=t.dts=E(t.pts-w,e*g)}),S=S.filter(function(t){return t.pts>=0}),0!==S.length){if(n||(x=u?e*g:S[0].pts),t.isAAC)for(var k=this.config.maxAudioFramesDrift,C=0,M=x;C<S.length;){var R,L=S[C],I=L.pts;R=I-M;var P=Math.abs(1e3*R/g);if(R<=-k*b)s.logger.warn("Dropping 1 audio frame @ "+(M/g).toFixed(3)+"s due to "+Math.round(P)+" ms overlap."),S.splice(C,1),t.len-=L.unit.length;else if(R>=k*b&&P<1e4&&M){var O=Math.round(R/b);s.logger.warn("Injecting "+O+" audio frame @ "+(M/g).toFixed(3)+"s due to "+Math.round(1e3*R/g)+" ms gap.");for(var D=0;D<O;D++){var N=Math.max(M,0);d=r.default.getSilentFrame(t.manifestCodec||t.codec,t.channelCount),d||(s.logger.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),d=L.unit.subarray()),S.splice(C,0,{unit:d,pts:N,dts:N}),t.len+=d.length,M+=b,C++}L.pts=L.dts=M,M+=b,C++}else Math.abs(R),L.pts=L.dts=M,M+=b,C++}for(var D=0,U=S.length;D<U;D++){var F=S[D],B=F.unit,I=F.pts;if(void 0!==m)c.duration=Math.round((I-m)/y);else{var j=Math.round(1e3*(I-x)/g),V=0;if(n&&t.isAAC&&j){if(j>0&&j<1e4)V=Math.round((I-x)/b),s.logger.log(j+" ms hole between AAC samples detected,filling it"),V>0&&(d=r.default.getSilentFrame(t.manifestCodec||t.codec,t.channelCount),d||(d=B.subarray()),t.len+=V*d.length);else if(j<-12){s.logger.log("drop overlapping AAC sample, expected/parsed/delta:"+(x/g).toFixed(3)+"s/"+(I/g).toFixed(3)+"s/"+-j+"ms"),t.len-=B.byteLength;continue}I=x}if(p=I,!(t.len>0))return;var G=A?t.len:t.len+8;l=A?0:8;try{h=new Uint8Array(G)}catch(X){return void this.observer.trigger(a.default.ERROR,{type:o.ErrorTypes.MUX_ERROR,details:o.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:G,reason:"fail allocating audio mdat "+G})}if(!A){new DataView(h.buffer).setUint32(0,G),h.set(i.default.types.mdat,4)}for(var C=0;C<V;C++)d=r.default.getSilentFrame(t.manifestCodec||t.codec,t.channelCount),d||(s.logger.log("Unable to get silent frame for given audio codec; duplicating this frame instead."),d=B.subarray()),h.set(d,l),l+=d.byteLength,c={size:d.byteLength,cts:0,duration:1024,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},T.push(c)}h.set(B,l);var z=B.byteLength;l+=z,c={size:z,cts:0,duration:0,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},T.push(c),m=I}var H=0,K=T.length;if(K>=2&&(H=T[K-2].duration,c.duration=H),K){this.nextAudioPts=x=m+y*H,t.len=0,t.samples=T,f=A?new Uint8Array:i.default.moof(t.sequenceNumber++,p/y,t),t.samples=[];var Y=p/g,W=x/g,q={data1:f,data2:h,startPTS:Y,endPTS:W,startDTS:Y,endDTS:W,type:"audio",hasAudio:!0,hasVideo:!1,nb:K};return this.observer.trigger(a.default.FRAG_PARSING_DATA,q),q}return null}},t.prototype.remuxEmptyAudio=function(t,e,n,i){var a=t.inputTimeScale,o=t.samplerate?t.samplerate:a,u=a/o,l=this.nextAudioPts,c=(void 0!==l?l:i.startDTS*a)+this._initDTS,d=i.endDTS*a+this._initDTS,h=1024*u,f=Math.ceil((d-c)/h),p=r.default.getSilentFrame(t.manifestCodec||t.codec,t.channelCount);if(s.logger.warn("remux empty Audio"),!p)return void s.logger.trace("Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec!");for(var m=[],g=0;g<f;g++){var v=c+g*h;m.push({unit:p,pts:v,dts:v}),t.len+=p.length}t.samples=m,this.remuxAudio(t,e,n)},t.prototype.remuxID3=function(t){var e,n=t.samples.length,r=t.inputTimeScale,i=this._initPTS,o=this._initDTS;if(n){for(var s=0;s<n;s++)e=t.samples[s],e.pts=(e.pts-i)/r,e.dts=(e.dts-o)/r;this.observer.trigger(a.default.FRAG_PARSING_METADATA,{samples:t.samples})}t.samples=[]},t.prototype.remuxText=function(t){t.samples.sort(function(t,e){return t.pts-e.pts});var e,n=t.samples.length,r=t.inputTimeScale,i=this._initPTS;if(n){for(var o=0;o<n;o++)e=t.samples[o],e.pts=(e.pts-i)/r;this.observer.trigger(a.default.FRAG_PARSING_USERDATA,{samples:t.samples})}t.samples=[]},t.prototype._PTSNormalize=function(t,e){var n;if(void 0===e)return t;for(n=e<t?-8589934592:8589934592;Math.abs(t-e)>4294967296;)t+=n;return t},t}();e.default=u},"./src/remux/passthrough-remuxer.js":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n("./src/events.js"),i=function(){function t(t){this.observer=t}return t.prototype.destroy=function(){},t.prototype.resetTimeStamp=function(){},t.prototype.resetInitSegment=function(){},t.prototype.remux=function(t,e,n,i,a,o,s,u){var l=this.observer,c="";t&&(c+="audio"),e&&(c+="video"),l.trigger(r.default.FRAG_PARSING_DATA,{data1:u,startPTS:a,startDTS:a,type:c,hasAudio:!!t,hasVideo:!!e,nb:1,dropped:0}),l.trigger(r.default.FRAG_PARSED)},t}();e.default=i},"./src/task-loop.js":function(t,e,n){"use strict";var r=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var i=n("./src/event-handler.js"),a=function(t){function e(e){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];var i=t.apply(this,[e].concat(n))||this;return i._tickInterval=null,i._tickTimer=null,i._tickCallCount=0,i._boundTick=i.tick.bind(i),i}return r(e,t),e.prototype.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},e.prototype.hasInterval=function(){return!!this._tickInterval},e.prototype.hasNextTick=function(){return!!this._tickTimer},e.prototype.setInterval=function(t){return!this._tickInterval&&(this._tickInterval=setInterval(this._boundTick,t),!0)},e.prototype.clearInterval=function(){return!!this._tickInterval&&(clearInterval(this._tickInterval),this._tickInterval=null,!0)},e.prototype.clearNextTick=function(){return!!this._tickTimer&&(clearTimeout(this._tickTimer),this._tickTimer=null,!0)},e.prototype.tick=function(){1===++this._tickCallCount&&(this.doTick(),this._tickCallCount>1&&(this.clearNextTick(),this._tickTimer=setTimeout(this._boundTick,0)),this._tickCallCount=0)},e.prototype.doTick=function(){},e}(i.default);e.default=a},"./src/utils/attr-list.js":function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0});var n=/^(\d+)x(\d+)$/,r=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,i=function(){function e(t){"string"==typeof t&&(t=e.parseAttrList(t));for(var n in t)t.hasOwnProperty(n)&&(this[n]=t[n])}return e.prototype.decimalInteger=function(e){var n=parseInt(this[e],10);return n>t.MAX_SAFE_INTEGER?1/0:n},e.prototype.hexadecimalInteger=function(t){if(this[t]){var e=(this[t]||"0x").slice(2);e=(1&e.length?"0":"")+e;for(var n=new Uint8Array(e.length/2),r=0;r<e.length/2;r++)n[r]=parseInt(e.slice(2*r,2*r+2),16);return n}return null},e.prototype.hexadecimalIntegerAsNumber=function(e){var n=parseInt(this[e],16);return n>t.MAX_SAFE_INTEGER?1/0:n},e.prototype.decimalFloatingPoint=function(t){return parseFloat(this[t])},e.prototype.enumeratedString=function(t){return this[t]},e.prototype.decimalResolution=function(t){var e=n.exec(this[t]);if(null!==e)return{width:parseInt(e[1],10),height:parseInt(e[2],10)}},e.parseAttrList=function(t){var e,n={};for(r.lastIndex=0;null!==(e=r.exec(t));){var i=e[2];0===i.indexOf('"')&&i.lastIndexOf('"')===i.length-1&&(i=i.slice(1,-1)),n[e[1]]=i}return n},e}();e.default=i}).call(this,n("./src/polyfills/number.js")["Number"])},"./src/utils/binary-search.js":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r={search:function(t,e){for(var n=0,r=t.length-1,i=null,a=null;n<=r;){i=(n+r)/2|0,a=t[i];var o=e(a);if(o>0)n=i+1;else{if(!(o<0))return a;r=i-1}}return null}};e.default=r},"./src/utils/buffer-helper.js":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(){}return t.isBuffered=function(t,e){try{if(t)for(var n=t.buffered,r=0;r<n.length;r++)if(e>=n.start(r)&&e<=n.end(r))return!0}catch(i){}return!1},t.bufferInfo=function(t,e,n){try{if(t){var r=t.buffered,i=[],a=void 0;for(a=0;a<r.length;a++)i.push({start:r.start(a),end:r.end(a)});return this.bufferedInfo(i,e,n)}}catch(o){}return{len:0,start:e,end:e,nextStart:void 0}},t.bufferedInfo=function(t,e,n){var r,i,a,o,s,u=[];for(t.sort(function(t,e){var n=t.start-e.start;return n||e.end-t.end}),s=0;s<t.length;s++){var l=u.length;if(l){var c=u[l-1].end;t[s].start-c<n?t[s].end>c&&(u[l-1].end=t[s].end):u.push(t[s])}else u.push(t[s])}for(s=0,r=0,i=a=e;s<u.length;s++){var d=u[s].start,h=u[s].end;if(e+n>=d&&e<h)i=d,a=h,r=a-e;else if(e+n<d){o=d;break}}return{len:r,start:i,end:a,nextStart:o}},t}();e.BufferHelper=r},"./src/utils/cea-608-parser.js":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},i=function(t){var e=t;return r.hasOwnProperty(t)&&(e=r[t]),String.fromCharCode(e)},a=15,o=100,s={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},u={17:2,18:4,21:6,22:8,23:10,19:13,20:15},l={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},c={25:2,26:4,29:6,30:8,31:10,27:13,28:15},d=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],h={verboseFilter:{DATA:3,DEBUG:3,INFO:2,WARNING:2,TEXT:1,ERROR:0},time:null,verboseLevel:0,setTime:function(t){this.time=t},log:function(t,e){this.verboseFilter[t];this.verboseLevel}},f=function(t){for(var e=[],n=0;n<t.length;n++)e.push(t[n].toString(16));return e},p=function(){function t(t,e,n,r,i){this.foreground=t||"white",this.underline=e||!1,this.italics=n||!1,this.background=r||"black",this.flash=i||!1}return t.prototype.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},t.prototype.setStyles=function(t){for(var e=["foreground","underline","italics","background","flash"],n=0;n<e.length;n++){var r=e[n];t.hasOwnProperty(r)&&(this[r]=t[r])}},t.prototype.isDefault=function(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash},t.prototype.equals=function(t){return this.foreground===t.foreground&&this.underline===t.underline&&this.italics===t.italics&&this.background===t.background&&this.flash===t.flash},t.prototype.copy=function(t){this.foreground=t.foreground,this.underline=t.underline,this.italics=t.italics,this.background=t.background,this.flash=t.flash},t.prototype.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},t}(),m=function(){function t(t,e,n,r,i,a){this.uchar=t||" ",this.penState=new p(e,n,r,i,a)}return t.prototype.reset=function(){this.uchar=" ",this.penState.reset()},t.prototype.setChar=function(t,e){this.uchar=t,this.penState.copy(e)},t.prototype.setPenState=function(t){this.penState.copy(t)},t.prototype.equals=function(t){return this.uchar===t.uchar&&this.penState.equals(t.penState)},t.prototype.copy=function(t){this.uchar=t.uchar,this.penState.copy(t.penState)},t.prototype.isEmpty=function(){return" "===this.uchar&&this.penState.isDefault()},t}(),g=function(){function t(){this.chars=[];for(var t=0;t<o;t++)this.chars.push(new m);this.pos=0,this.currPenState=new p}return t.prototype.equals=function(t){for(var e=!0,n=0;n<o;n++)if(!this.chars[n].equals(t.chars[n])){e=!1;break}return e},t.prototype.copy=function(t){for(var e=0;e<o;e++)this.chars[e].copy(t.chars[e])},t.prototype.isEmpty=function(){for(var t=!0,e=0;e<o;e++)if(!this.chars[e].isEmpty()){t=!1;break}return t},t.prototype.setCursor=function(t){this.pos!==t&&(this.pos=t),this.pos<0?(h.log("ERROR","Negative cursor position "+this.pos),this.pos=0):this.pos>o&&(h.log("ERROR","Too large cursor position "+this.pos),this.pos=o)},t.prototype.moveCursor=function(t){var e=this.pos+t;if(t>1)for(var n=this.pos+1;n<e+1;n++)this.chars[n].setPenState(this.currPenState);this.setCursor(e)},t.prototype.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},t.prototype.insertChar=function(t){t>=144&&this.backSpace();var e=i(t);if(this.pos>=o)return void h.log("ERROR","Cannot insert "+t.toString(16)+" ("+e+") at position "+this.pos+". Skipping it!");this.chars[this.pos].setChar(e,this.currPenState),this.moveCursor(1)},t.prototype.clearFromPos=function(t){var e;for(e=t;e<o;e++)this.chars[e].reset()},t.prototype.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},t.prototype.clearToEndOfRow=function(){this.clearFromPos(this.pos)},t.prototype.getTextString=function(){for(var t=[],e=!0,n=0;n<o;n++){var r=this.chars[n].uchar;" "!==r&&(e=!1),t.push(r)}return e?"":t.join("")},t.prototype.setPenStyles=function(t){this.currPenState.setStyles(t),this.chars[this.pos].setPenState(this.currPenState)},t}(),v=function(){function t(){this.rows=[];for(var t=0;t<a;t++)this.rows.push(new g);this.currRow=a-1,this.nrRollUpRows=null,this.reset()}return t.prototype.reset=function(){for(var t=0;t<a;t++)this.rows[t].clear();this.currRow=a-1},t.prototype.equals=function(t){for(var e=!0,n=0;n<a;n++)if(!this.rows[n].equals(t.rows[n])){e=!1;break}return e},t.prototype.copy=function(t){for(var e=0;e<a;e++)this.rows[e].copy(t.rows[e])},t.prototype.isEmpty=function(){for(var t=!0,e=0;e<a;e++)if(!this.rows[e].isEmpty()){t=!1;break}return t},t.prototype.backSpace=function(){this.rows[this.currRow].backSpace()},t.prototype.clearToEndOfRow=function(){this.rows[this.currRow].clearToEndOfRow()},t.prototype.insertChar=function(t){this.rows[this.currRow].insertChar(t)},t.prototype.setPen=function(t){this.rows[this.currRow].setPenStyles(t)},t.prototype.moveCursor=function(t){this.rows[this.currRow].moveCursor(t)},t.prototype.setCursor=function(t){h.log("INFO","setCursor: "+t),this.rows[this.currRow].setCursor(t)},t.prototype.setPAC=function(t){h.log("INFO","pacData = "+JSON.stringify(t));var e=t.row-1;if(this.nrRollUpRows&&e<this.nrRollUpRows-1&&(e=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==e){for(var n=0;n<a;n++)this.rows[n].clear();var r=this.currRow+1-this.nrRollUpRows,i=this.lastOutputScreen;if(i){var o=i.rows[r].cueStartTime;if(o&&o<h.time)for(var n=0;n<this.nrRollUpRows;n++)this.rows[e-this.nrRollUpRows+n+1].copy(i.rows[r+n])}}this.currRow=e;var s=this.rows[this.currRow];if(null!==t.indent){var u=t.indent,l=Math.max(u-1,0);s.setCursor(t.indent),t.color=s.chars[l].penState.foreground}var c={foreground:t.color,underline:t.underline,italics:t.italics,background:"black",flash:!1};this.setPen(c)},t.prototype.setBkgData=function(t){h.log("INFO","bkgData = "+JSON.stringify(t)),this.backSpace(),this.setPen(t),this.insertChar(32)},t.prototype.setRollUpRows=function(t){this.nrRollUpRows=t},t.prototype.rollUp=function(){if(null===this.nrRollUpRows)return void h.log("DEBUG","roll_up but nrRollUpRows not set yet");h.log("TEXT",this.getDisplayText());var t=this.currRow+1-this.nrRollUpRows,e=this.rows.splice(t,1)[0];e.clear(),this.rows.splice(this.currRow,0,e),h.log("INFO","Rolling up")},t.prototype.getDisplayText=function(t){t=t||!1;for(var e=[],n="",r=-1,i=0;i<a;i++){var o=this.rows[i].getTextString();o&&(r=i+1,t?e.push("Row "+r+": '"+o+"'"):e.push(o.trim()))}return e.length>0&&(n=t?"["+e.join(" | ")+"]":e.join("\n")),n},t.prototype.getTextAndFormat=function(){return this.rows},t}(),y=function(){function t(t,e){this.chNr=t,this.outputFilter=e,this.mode=null,this.verbose=0,this.displayedMemory=new v,this.nonDisplayedMemory=new v,this.lastOutputScreen=new v,this.currRollUpRow=this.displayedMemory.rows[a-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}return t.prototype.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.currRollUpRow=this.displayedMemory.rows[a-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.lastCueEndTime=null},t.prototype.getHandler=function(){return this.outputFilter},t.prototype.setHandler=function(t){this.outputFilter=t},t.prototype.setPAC=function(t){this.writeScreen.setPAC(t)},t.prototype.setBkgData=function(t){this.writeScreen.setBkgData(t)},t.prototype.setMode=function(t){t!==this.mode&&(this.mode=t,h.log("INFO","MODE="+t),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=t)},t.prototype.insertChars=function(t){for(var e=0;e<t.length;e++)this.writeScreen.insertChar(t[e]);var n=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";h.log("INFO",n+": "+this.writeScreen.getDisplayText(!0)),"MODE_PAINT-ON"!==this.mode&&"MODE_ROLL-UP"!==this.mode||(h.log("TEXT","DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},t.prototype.ccRCL=function(){h.log("INFO","RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},t.prototype.ccBS=function(){h.log("INFO","BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},t.prototype.ccAOF=function(){},t.prototype.ccAON=function(){},t.prototype.ccDER=function(){h.log("INFO","DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},t.prototype.ccRU=function(t){h.log("INFO","RU("+t+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(t)},t.prototype.ccFON=function(){h.log("INFO","FON - Flash On"),this.writeScreen.setPen({flash:!0})},t.prototype.ccRDC=function(){h.log("INFO","RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},t.prototype.ccTR=function(){h.log("INFO","TR"),this.setMode("MODE_TEXT")},t.prototype.ccRTD=function(){h.log("INFO","RTD"),this.setMode("MODE_TEXT")},t.prototype.ccEDM=function(){h.log("INFO","EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},t.prototype.ccCR=function(){h.log("CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},t.prototype.ccENM=function(){h.log("INFO","ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},t.prototype.ccEOC=function(){if(h.log("INFO","EOC - End Of Caption"),"MODE_POP-ON"===this.mode){var t=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=t,this.writeScreen=this.nonDisplayedMemory,h.log("TEXT","DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)},t.prototype.ccTO=function(t){h.log("INFO","TO("+t+") - Tab Offset"),this.writeScreen.moveCursor(t)},t.prototype.ccMIDROW=function(t){var e={flash:!1};if(e.underline=t%2==1,e.italics=t>=46,e.italics)e.foreground="white";else{var n=Math.floor(t/2)-16,r=["white","green","blue","cyan","red","yellow","magenta"];e.foreground=r[n]}h.log("INFO","MIDROW: "+JSON.stringify(e)),this.writeScreen.setPen(e)},t.prototype.outputDataUpdate=function(t){void 0===t&&(t=!1);var e=h.time;null!==e&&this.outputFilter&&(null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue&&(this.outputFilter.newCue(this.cueStartTime,e,this.lastOutputScreen),!0===t&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue()),this.cueStartTime=this.displayedMemory.isEmpty()?null:e):this.cueStartTime=e,this.lastOutputScreen.copy(this.displayedMemory))},t.prototype.cueSplitAtTime=function(t){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,t,this.displayedMemory),this.cueStartTime=t))},t}(),_=function(){function t(t,e,n){this.field=t||1,this.outputs=[e,n],this.channels=[new y(1,e),new y(2,n)],this.currChNr=-1,this.lastCmdA=null,this.lastCmdB=null,this.bufferedData=[],this.startTime=null,this.lastTime=null,this.dataCounters={padding:0,char:0,cmd:0,other:0}}return t.prototype.getHandler=function(t){return this.channels[t].getHandler()},t.prototype.setHandler=function(t,e){this.channels[t].setHandler(e)},t.prototype.addData=function(t,e){var n,r,i,a=!1;this.lastTime=t,h.setTime(t);for(var o=0;o<e.length;o+=2)if(r=127&e[o],i=127&e[o+1],0!==r||0!==i){if(h.log("DATA","["+f([e[o],e[o+1]])+"] -> ("+f([r,i])+")"),n=this.parseCmd(r,i),n||(n=this.parseMidrow(r,i)),n||(n=this.parsePAC(r,i)),n||(n=this.parseBackgroundAttributes(r,i)),!n&&(a=this.parseChars(r,i)))if(this.currChNr&&this.currChNr>=0){var s=this.channels[this.currChNr-1];s.insertChars(a)}else h.log("WARNING","No channel found yet. TEXT-MODE?");n?this.dataCounters.cmd+=2:a?this.dataCounters.char+=2:(this.dataCounters.other+=2,h.log("WARNING","Couldn't parse cleaned data "+f([r,i])+" orig: "+f([e[o],e[o+1]])))}else this.dataCounters.padding+=2},t.prototype.parseCmd=function(t,e){var n=null,r=(20===t||28===t)&&e>=32&&e<=47,i=(23===t||31===t)&&e>=33&&e<=35;if(!r&&!i)return!1;if(t===this.lastCmdA&&e===this.lastCmdB)return this.lastCmdA=null,this.lastCmdB=null,h.log("DEBUG","Repeated command ("+f([t,e])+") is dropped"),!0;n=20===t||23===t?1:2;var a=this.channels[n-1];return 20===t||28===t?32===e?a.ccRCL():33===e?a.ccBS():34===e?a.ccAOF():35===e?a.ccAON():36===e?a.ccDER():37===e?a.ccRU(2):38===e?a.ccRU(3):39===e?a.ccRU(4):40===e?a.ccFON():41===e?a.ccRDC():42===e?a.ccTR():43===e?a.ccRTD():44===e?a.ccEDM():45===e?a.ccCR():46===e?a.ccENM():47===e&&a.ccEOC():a.ccTO(e-32),this.lastCmdA=t,this.lastCmdB=e,this.currChNr=n,!0},t.prototype.parseMidrow=function(t,e){var n=null;if((17===t||25===t)&&e>=32&&e<=47){if((n=17===t?1:2)!==this.currChNr)return h.log("ERROR","Mismatch channel in midrow parsing"),!1;return this.channels[n-1].ccMIDROW(e),h.log("DEBUG","MIDROW ("+f([t,e])+")"),!0}return!1},t.prototype.parsePAC=function(t,e){var n=null,r=null,i=(t>=17&&t<=23||t>=25&&t<=31)&&e>=64&&e<=127,a=(16===t||24===t)&&e>=64&&e<=95;if(!i&&!a)return!1;if(t===this.lastCmdA&&e===this.lastCmdB)return this.lastCmdA=null,this.lastCmdB=null,!0;n=t<=23?1:2,r=e>=64&&e<=95?1===n?s[t]:l[t]:1===n?u[t]:c[t];var o=this.interpretPAC(r,e);return this.channels[n-1].setPAC(o),this.lastCmdA=t,this.lastCmdB=e,this.currChNr=n,!0},t.prototype.interpretPAC=function(t,e){var n=e,r={color:null,italics:!1,indent:null,underline:!1,row:t};return n=e>95?e-96:e-64,r.underline=1==(1&n),n<=13?r.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(n/2)]:n<=15?(r.italics=!0,r.color="white"):r.indent=4*Math.floor((n-16)/2),r},t.prototype.parseChars=function(t,e){var n=null,r=null,a=null;if(t>=25?(n=2,a=t-8):(n=1,a=t),a>=17&&a<=19){var o=e;o=17===a?e+80:18===a?e+112:e+144,h.log("INFO","Special char '"+i(o)+"' in channel "+n),r=[o]}else t>=32&&t<=127&&(r=0===e?[t]:[t,e]);if(r){var s=f(r);h.log("DEBUG","Char codes =  "+s.join(",")),this.lastCmdA=null,this.lastCmdB=null}return r},t.prototype.parseBackgroundAttributes=function(t,e){var n,r,i,a,o=(16===t||24===t)&&e>=32&&e<=47,s=(23===t||31===t)&&e>=45&&e<=47;return!(!o&&!s)&&(n={},16===t||24===t?(r=Math.floor((e-32)/2),n.background=d[r],e%2==1&&(n.background=n.background+"_semi")):45===e?n.background="transparent":(n.foreground="black",47===e&&(n.underline=!0)),i=t<24?1:2,a=this.channels[i-1],a.setBkgData(n),this.lastCmdA=null,this.lastCmdB=null,!0)},t.prototype.reset=function(){for(var t=0;t<this.channels.length;t++)this.channels[t]&&this.channels[t].reset();this.lastCmdA=null,this.lastCmdB=null},t.prototype.cueSplitAtTime=function(t){for(var e=0;e<this.channels.length;e++)this.channels[e]&&this.channels[e].cueSplitAtTime(t)},t}();e.default=_},"./src/utils/codecs.js":function(t,e,n){"use strict";function r(t,e){var n=a[e];return!!n&&!0===n[t.slice(0,4)]}function i(t,e){return window.MediaSource.isTypeSupported((e||"video")+'/mp4;codecs="'+t+'"')}Object.defineProperty(e,"__esModule",{value:!0});var a={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,drac:!0,dvav:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0}};e.isCodecType=r,e.isCodecSupportedInMp4=i},"./src/utils/cues.js":function(t,e,n){"use strict";function r(t,e,n,r){for(var a,o,s,u,l,c=window.VTTCue||window.TextTrackCue,d=0;d<r.rows.length;d++)if(a=r.rows[d],s=!0,u=0,l="",!a.isEmpty()){for(var h=0;h<a.chars.length;h++)a.chars[h].uchar.match(/\s/)&&s?u++:(l+=a.chars[h].uchar,s=!1);a.cueStartTime=e,e===n&&(n+=1e-4),o=new c(e,n,i.fixLineBreaks(l.trim())),u>=16?u--:u++,navigator.userAgent.match(/Firefox\//)?o.line=d+1:o.line=d>7?d-2:d+1,o.align="left",o.position=Math.max(0,Math.min(100,u/32*100+(navigator.userAgent.match(/Firefox\//)?50:0))),t.addCue(o)}}Object.defineProperty(e,"__esModule",{value:!0});var i=n("./src/utils/vttparser.js");e.newCue=r},"./src/utils/discontinuities.js":function(t,e,n){"use strict";(function(t){function r(t,e){for(var n=null,r=0;r<t.length;r+=1){var i=t[r];if(i&&i.cc===e){n=i;break}}return n}function i(t,e){return d.default.search(t,function(t){return t.cc<e?1:t.cc>e?-1:0})}function a(t,e,n){var r=!1;return e&&e.details&&n&&(n.endCC>n.startCC||t&&t.cc<n.startCC)&&(r=!0),r}function o(t,e){var n=t.fragments,i=e.fragments;if(!i.length||!n.length)return void h.logger.log("No fragments to align");var a=r(n,i[0].cc);return!a||a&&!a.startPTS?void h.logger.log("No frag in previous level to align on"):a}function s(t,e){e.fragments.forEach(function(e){if(e){var n=e.start+t;e.start=e.startPTS=n,e.endPTS=n+e.duration}}),e.PTSKnown=!0}function u(t,e,n){l(t,n,e),!n.PTSKnown&&e&&c(n,e.details)}function l(t,e,n){if(a(t,n,e)){var r=o(n.details,e);r&&(h.logger.log("Adjusting PTS using last level due to CC increase within current level"),s(r.start,e))}}function c(e,n){if(n&&n.fragments.length){if(!e.hasProgramDateTime||!n.hasProgramDateTime)return;var r=n.fragments[0].programDateTime,i=e.fragments[0].programDateTime,a=(i-r)/1e3+n.fragments[0].start;t.isFinite(a)&&(h.logger.log("adjusting PTS using programDateTime delta, sliding:"+a.toFixed(3)),s(a,e))}}Object.defineProperty(e,"__esModule",{value:!0});var d=n("./src/utils/binary-search.js"),h=n("./src/utils/logger.js");e.findFirstFragWithCC=r,e.findFragWithCC=i,e.shouldAlignOnDiscontinuities=a,e.findDiscontinuousReferenceFrag=o,e.adjustPts=s,e.alignStream=u,e.alignDiscontinuities=l,e.alignPDT=c}).call(this,n("./src/polyfills/number.js")["Number"])},"./src/utils/ewma-bandwidth-estimator.js":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n("./src/utils/ewma.js"),i=function(){function t(t,e,n,i){this.hls=t,this.defaultEstimate_=i,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new r.default(e),this.fast_=new r.default(n)}return t.prototype.sample=function(t,e){t=Math.max(t,this.minDelayMs_);var n=8e3*e/t,r=t/1e3;this.fast_.sample(r,n),this.slow_.sample(r,n)},t.prototype.canEstimate=function(){var t=this.fast_;return t&&t.getTotalWeight()>=this.minWeight_},t.prototype.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},t.prototype.destroy=function(){},t}();e.default=i},"./src/utils/ewma.js":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t){this.alpha_=t?Math.exp(Math.log(.5)/t):0,this.estimate_=0,this.totalWeight_=0}return t.prototype.sample=function(t,e){var n=Math.pow(this.alpha_,t);this.estimate_=e*(1-n)+n*this.estimate_,this.totalWeight_+=t},t.prototype.getTotalWeight=function(){return this.totalWeight_},t.prototype.getEstimate=function(){if(this.alpha_){var t=1-Math.pow(this.alpha_,this.totalWeight_);return this.estimate_/t}return this.estimate_},t}();e.default=r},"./src/utils/get-self-scope.js":function(t,e,n){"use strict";function r(){return"undefined"==typeof window?self:window}Object.defineProperty(e,"__esModule",{value:!0}),e.getSelfScope=r},"./src/utils/logger.js":function(t,e,n){"use strict";function r(){}function i(t,e){return e="["+t+"] > "+e}function a(t){var e=c.console[t];return e?function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];n[0]&&(n[0]=i(t,n[0])),e.apply(c.console,n)}:r}function o(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];e.forEach(function(e){l[e]=t[e]?t[e].bind(t):a(e)})}Object.defineProperty(e,"__esModule",{value:!0});var s=n("./src/utils/get-self-scope.js"),u={trace:r,debug:r,log:r,warn:r,info:r,error:r},l=u,c=s.getSelfScope();e.enableLogs=function(t){if(!0===t||"object"==typeof t){o(t,"debug","log","info","warn","error");try{l.log()}catch(e){l=u}}else l=u},e.logger=l},"./src/utils/mediakeys-helper.js":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){return"undefined"!=typeof window&&window.navigator&&window.navigator.requestMediaKeySystemAccess?window.navigator.requestMediaKeySystemAccess.bind(window.navigator):null}();e.requestMediaKeySystemAccess=r},"./src/utils/mediasource-helper.js":function(t,e,n){"use strict";function r(){if("undefined"!=typeof window)return window.MediaSource||window.WebKitMediaSource}Object.defineProperty(e,"__esModule",{value:!0}),e.getMediaSource=r},"./src/utils/output-filter.js":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){this.timelineController=t,this.trackName=e,this.startTime=null,this.endTime=null,this.screen=null}return t.prototype.dispatchCue=function(){null!==this.startTime&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen),this.startTime=null)},t.prototype.newCue=function(t,e,n){(null===this.startTime||this.startTime>t)&&(this.startTime=t),this.endTime=e,this.screen=n,this.timelineController.createCaptionsTrack(this.trackName)},t}();e.default=r},"./src/utils/texttrack-utils.js":function(t,e,n){"use strict";function r(t,e){var n=null;try{n=new window.Event("addtrack")}catch(r){n=document.createEvent("Event"),n.initEvent("addtrack",!1,!1)}n.track=t,e.dispatchEvent(n)}function i(t){if(t&&t.cues)for(;t.cues.length>0;)t.removeCue(t.cues[0])}Object.defineProperty(e,"__esModule",{value:!0}),e.sendAddTrackEvent=r,e.clearCurrentCues=i},"./src/utils/time-ranges.js":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r={toString:function(t){for(var e="",n=t.length,r=0;r<n;r++)e+="["+t.start(r).toFixed(3)+","+t.end(r).toFixed(3)+"]";return e}};e.default=r},"./src/utils/vttcue.js":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(){function t(t){return"string"==typeof t&&(!!a[t.toLowerCase()]&&t.toLowerCase())}function e(t){return"string"==typeof t&&(!!o[t.toLowerCase()]&&t.toLowerCase())}function n(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)t[r]=n[r]}return t}function r(r,a,o){var s=this,u=function(){if("undefined"!=typeof navigator)return/MSIE\s8\.0/.test(navigator.userAgent)}(),l={};u?s=document.createElement("custom"):l.enumerable=!0,s.hasBeenReset=!1;var c="",d=!1,h=r,f=a,p=o,m=null,g="",v=!0,y="auto",_="start",b=50,E="middle",w=50,A="middle";if(Object.defineProperty(s,"id",n({},l,{get:function(){return c},set:function(t){c=""+t}})),Object.defineProperty(s,"pauseOnExit",n({},l,{get:function(){return d},set:function(t){d=!!t}})),Object.defineProperty(s,"startTime",n({},l,{get:function(){return h},set:function(t){if("number"!=typeof t)throw new TypeError("Start time must be set to a number.");h=t,this.hasBeenReset=!0}})),Object.defineProperty(s,"endTime",n({},l,{get:function(){return f},set:function(t){if("number"!=typeof t)throw new TypeError("End time must be set to a number.");f=t,this.hasBeenReset=!0}})),Object.defineProperty(s,"text",n({},l,{get:function(){return p},set:function(t){p=""+t,this.hasBeenReset=!0}})),Object.defineProperty(s,"region",n({},l,{get:function(){return m},set:function(t){m=t,this.hasBeenReset=!0}})),Object.defineProperty(s,"vertical",n({},l,{get:function(){return g},set:function(e){var n=t(e);if(!1===n)throw new SyntaxError("An invalid or illegal string was specified.");g=n,this.hasBeenReset=!0}})),Object.defineProperty(s,"snapToLines",n({},l,{get:function(){return v},set:function(t){v=!!t,this.hasBeenReset=!0}})),Object.defineProperty(s,"line",n({},l,{get:function(){return y},set:function(t){if("number"!=typeof t&&t!==i)throw new SyntaxError("An invalid number or illegal string was specified.");y=t,this.hasBeenReset=!0}})),Object.defineProperty(s,"lineAlign",n({},l,{get:function(){return _},set:function(t){var n=e(t);if(!n)throw new SyntaxError("An invalid or illegal string was specified.");_=n,this.hasBeenReset=!0}})),Object.defineProperty(s,"position",n({},l,{get:function(){return b},set:function(t){if(t<0||t>100)throw new Error("Position must be between 0 and 100.");b=t,this.hasBeenReset=!0}})),Object.defineProperty(s,"positionAlign",n({},l,{get:function(){return E},set:function(t){var n=e(t);if(!n)throw new SyntaxError("An invalid or illegal string was specified.");E=n,this.hasBeenReset=!0}})),Object.defineProperty(s,"size",n({},l,{get:function(){return w},set:function(t){if(t<0||t>100)throw new Error("Size must be between 0 and 100.");w=t,this.hasBeenReset=!0}})),Object.defineProperty(s,"align",n({},l,{get:function(){return A},set:function(t){var n=e(t);if(!n)throw new SyntaxError("An invalid or illegal string was specified.");A=n,this.hasBeenReset=!0}})),s.displayState=void 0,u)return s}if("undefined"!=typeof window&&window.VTTCue)return window.VTTCue;var i="auto",a={"":!0,lr:!0,rl:!0},o={start:!0,middle:!0,end:!0,left:!0,right:!0};return r.prototype.getCueAsHTML=function(){return window.WebVTT.convertCueToDOMTree(window,this.text)},r}()},"./src/utils/vttparser.js":function(t,e,n){"use strict";function r(){this.window=window,this.state="INITIAL",this.buffer="",this.decoder=new c,this.regionList=[]}function i(t){function e(t,e,n,r){return 3600*(0|t)+60*(0|e)+(0|n)+(0|r)/1e3}var n=t.match(/^(\d+):(\d{2})(:\d{2})?\.(\d{3})/);return n?n[3]?e(n[1],n[2],n[3].replace(":",""),n[4]):n[1]>59?e(n[1],n[2],0,n[4]):e(0,n[1],n[2],n[4]):null}function a(){this.values=Object.create(null)}function o(t,e,n,r){var i=r?t.split(r):[t];for(var a in i)if("string"==typeof i[a]){var o=i[a].split(n);if(2===o.length){var s=o[0],u=o[1];e(s,u)}}}function s(t,e,n){function r(){var e=i(t);if(null===e)throw new Error("Malformed timestamp: "+u);return t=t.replace(/^[^\sa-zA-Z-]+/,""),e}function s(){t=t.replace(/^\s+/,"")}var u=t;if(s(),e.startTime=r(),s(),"--\x3e"!==t.substr(0,3))throw new Error("Malformed time stamp (time stamps must be separated by '--\x3e'): "+u);t=t.substr(3),s(),e.endTime=r(),s(),function(t,e){var r=new a;o(t,function(t,e){switch(t){case"region":for(var i=n.length-1;i>=0;i--)if(n[i].id===e){r.set(t,n[i].region);break}break;case"vertical":r.alt(t,e,["rl","lr"]);break;case"line":var a=e.split(","),o=a[0];r.integer(t,o),r.percent(t,o)&&r.set("snapToLines",!1),r.alt(t,o,["auto"]),2===a.length&&r.alt("lineAlign",a[1],["start",h,"end"]);break;case"position":a=e.split(","),r.percent(t,a[0]),2===a.length&&r.alt("positionAlign",a[1],["start",h,"end","line-left","line-right","auto"]);break;case"size":r.percent(t,e);break;case"align":r.alt(t,e,["start",h,"end","left","right"])}},/:/,/\s/),e.region=r.get("region",null),e.vertical=r.get("vertical","");var i=r.get("line","auto");"auto"===i&&-1===d.line&&(i=-1),e.line=i,e.lineAlign=r.get("lineAlign","start"),e.snapToLines=r.get("snapToLines",!0),e.size=r.get("size",100),e.align=r.get("align",h);var s=r.get("position","auto");"auto"===s&&50===d.position&&(s="start"===e.align||"left"===e.align?0:"end"===e.align||"right"===e.align?100:50),e.position=s}(t,e)}function u(t){return t.replace(/<br(?: \/)?>/gi,"\n")}Object.defineProperty(e,"__esModule",{value:!0});var l=n("./src/utils/vttcue.js"),c=function(){return{decode:function(t){if(!t)return"";if("string"!=typeof t)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(t))}}};a.prototype={set:function(t,e){this.get(t)||""===e||(this.values[t]=e)},get:function(t,e,n){return n?this.has(t)?this.values[t]:e[n]:this.has(t)?this.values[t]:e},has:function(t){return t in this.values},alt:function(t,e,n){for(var r=0;r<n.length;++r)if(e===n[r]){this.set(t,e);break}},integer:function(t,e){/^-?\d+$/.test(e)&&this.set(t,parseInt(e,10))},percent:function(t,e){return!!(e.match(/^([\d]{1,3})(\.[\d]*)?%$/)&&(e=parseFloat(e))>=0&&e<=100)&&(this.set(t,e),!0)}};var d=new l.default(0,0,0),h="middle"===d.align?"middle":"center";e.fixLineBreaks=u,r.prototype={parse:function(t){function e(){var t=n.buffer,e=0;for(t=u(t);e<t.length&&"\r"!==t[e]&&"\n"!==t[e];)++e;var r=t.substr(0,e);return"\r"===t[e]&&++e,"\n"===t[e]&&++e,n.buffer=t.substr(e),r}var n=this;t&&(n.buffer+=n.decoder.decode(t,{stream:!0}));try{var r=void 0;if("INITIAL"===n.state){if(!/\r\n|\n/.test(n.buffer))return this;r=e();var i=r.match(/^()?WEBVTT([ \t].*)?$/);if(!i||!i[0])throw new Error("Malformed WebVTT signature.");n.state="HEADER"}for(var a=!1;n.buffer;){if(!/\r\n|\n/.test(n.buffer))return this;switch(a?a=!1:r=e(),n.state){case"HEADER":/:/.test(r)?function(t){o(t,function(t,e){},/:/)}(r):r||(n.state="ID");continue;case"NOTE":r||(n.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(r)){n.state="NOTE";break}if(!r)continue;if(n.cue=new l.default(0,0,""),n.state="CUE",-1===r.indexOf("--\x3e")){n.cue.id=r;continue}case"CUE":try{s(r,n.cue,n.regionList)}catch(d){n.cue=null,n.state="BADCUE";continue}n.state="CUETEXT";continue;case"CUETEXT":var c=-1!==r.indexOf("--\x3e");if(!r||c&&(a=!0)){n.oncue&&n.oncue(n.cue),n.cue=null,n.state="ID";continue}n.cue.text&&(n.cue.text+="\n"),n.cue.text+=r;continue;case"BADCUE":r||(n.state="ID");continue}}}catch(d){"CUETEXT"===n.state&&n.cue&&n.oncue&&n.oncue(n.cue),n.cue=null,n.state="INITIAL"===n.state?"BADWEBVTT":"BADCUE"}return this},flush:function(){var t=this;try{if(t.buffer+=t.decoder.decode(),(t.cue||"HEADER"===t.state)&&(t.buffer+="\n\n",t.parse()),"INITIAL"===t.state)throw new Error("Malformed WebVTT signature.")}catch(e){throw e}return t.onflush&&t.onflush(),this}},e.default=r},"./src/utils/webvtt-parser.js":function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0});var r=n("./src/utils/vttparser.js"),i=n("./src/demux/id3.js"),a=function(t,e,n){return t.substr(n||0,e.length)===e},o=function(e){var n=parseInt(e.substr(-3)),r=parseInt(e.substr(-6,2)),i=parseInt(e.substr(-9,2)),a=e.length>9?parseInt(e.substr(0,e.indexOf(":"))):0;return t.isFinite(n)&&t.isFinite(r)&&t.isFinite(i)&&t.isFinite(a)?(n+=1e3*r,n+=6e4*i,n+=36e5*a):-1},s=function(t){for(var e=5381,n=t.length;n;)e=33*e^t.charCodeAt(--n);return(e>>>0).toString()},u=function(t,e,n){var r=t[e],i=t[r.prevCC];if(!i||!i.new&&r.new)return t.ccOffset=t.presentationOffset=r.start,void(r.new=!1);for(;i&&i.new;)t.ccOffset+=r.start-i.start,r.new=!1,r=i,i=t[r.prevCC];t.presentationOffset=n},l={parse:function(t,e,n,l,c,d){var h,f=/\r\n|\n\r|\n|\r/g,p=i.utf8ArrayToStr(new Uint8Array(t)).trim().replace(f,"\n").split("\n"),m="00:00.000",g=0,v=0,y=0,_=[],b=!0,E=new r.default;E.oncue=function(t){var e=n[l],r=n.ccOffset;e&&e.new&&(void 0!==v?r=n.ccOffset=e.start:u(n,l,y)),y&&(r=y-n.presentationOffset),t.startTime+=r-v,t.endTime+=r-v,t.id=s(t.startTime.toString())+s(t.endTime.toString())+s(t.text),t.text=decodeURIComponent(encodeURIComponent(t.text)),t.endTime>0&&_.push(t)},E.onparsingerror=function(t){h=t},E.onflush=function(){if(h&&d)return void d(h);c(_)},p.forEach(function(t){if(b){if(a(t,"X-TIMESTAMP-MAP=")){b=!1,t.substr(16).split(",").forEach(function(t){a(t,"LOCAL:")?m=t.substr(6):a(t,"MPEGTS:")&&(g=parseInt(t.substr(7)))});try{e+(9e4*n[l].start||0)<0&&(e+=8589934592),g-=e,v=o(m)/1e3,y=g/9e4,-1===v&&(h=new Error("Malformed X-TIMESTAMP-MAP: "+t))}catch(r){h=new Error("Malformed X-TIMESTAMP-MAP: "+t)}return}""===t&&(b=!1)}E.parse(t+"\n")}),E.flush()}};e.default=l}).call(this,n("./src/polyfills/number.js")["Number"])},"./src/utils/xhr-loader.js":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n("./src/utils/logger.js"),i=window.performance,a=window.XMLHttpRequest,o=function(){function t(t){t&&t.xhrSetup&&(this.xhrSetup=t.xhrSetup)}return t.prototype.destroy=function(){this.abort(),this.loader=null},t.prototype.abort=function(){var t=this.loader;t&&4!==t.readyState&&(this.stats.aborted=!0,t.abort()),window.clearTimeout(this.requestTimeout),this.requestTimeout=null,window.clearTimeout(this.retryTimeout),this.retryTimeout=null},t.prototype.load=function(t,e,n){this.context=t,this.config=e,this.callbacks=n,this.stats={trequest:i.now(),retry:0},this.retryDelay=e.retryDelay,this.loadInternal()},t.prototype.loadInternal=function(){var t,e=this.context;t=this.loader=new a;var n=this.stats;n.tfirst=0,n.loaded=0;var r=this.xhrSetup;try{if(r)try{r(t,e.url)}catch(i){t.open("GET",e.url,!0),r(t,e.url)}t.readyState||t.open("GET",e.url,!0)}catch(i){return void this.callbacks.onError({code:t.status,text:i.message},e,t)}e.rangeEnd&&t.setRequestHeader("Range","bytes="+e.rangeStart+"-"+(e.rangeEnd-1)),t.onreadystatechange=this.readystatechange.bind(this),t.onprogress=this.loadprogress.bind(this),t.responseType=e.responseType,this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),this.config.timeout),t.send()},t.prototype.readystatechange=function(t){var e=t.currentTarget,n=e.readyState,a=this.stats,o=this.context,s=this.config;if(!a.aborted&&n>=2)if(window.clearTimeout(this.requestTimeout),0===a.tfirst&&(a.tfirst=Math.max(i.now(),a.trequest)),4===n){var u=e.status;if(u>=200&&u<300){a.tload=Math.max(a.tfirst,i.now());var l=void 0,c=void 0;"arraybuffer"===o.responseType?(l=e.response,c=l.byteLength):(l=e.responseText,c=l.length),a.loaded=a.total=c;var d={url:e.responseURL,data:l};this.callbacks.onSuccess(d,a,o,e)}else a.retry>=s.maxRetry||u>=400&&u<499?(r.logger.error(u+" while loading "+o.url),this.callbacks.onError({code:u,text:e.statusText},o,e)):(r.logger.warn(u+" while loading "+o.url+", retrying in "+this.retryDelay+"..."),this.destroy(),this.retryTimeout=window.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,s.maxRetryDelay),a.retry++)}else this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),s.timeout)},t.prototype.loadtimeout=function(){r.logger.warn("timeout while loading "+this.context.url),this.callbacks.onTimeout(this.stats,this.context,null)},t.prototype.loadprogress=function(t){var e=t.currentTarget,n=this.stats;n.loaded=t.loaded,t.lengthComputable&&(n.total=t.total);var r=this.callbacks.onProgress;r&&r(n,this.context,null,e)},t}();e.default=o}})["default"]})},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(200),i=function(t){return t&&t.__esModule?t:{default:t}}(r);e.default=i.default,t.exports=e["default"]},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(202),i=function(t){return t&&t.__esModule?t:{default:t}}(r);e.default=i.default,t.exports=e["default"]},function(t,e,n){t.exports={default:n(208),__esModule:!0}},function(t,e,n){t.exports={default:n(210),__esModule:!0}},function(t,e,n){var r=n(18),i=n(41),a=n(11)("species");t.exports=function(t,e){var n,o=r(t).constructor;return void 0===o||void 0==(n=r(o)[a])?e:i(n)}},function(t,e,n){var r,i,a,o=n(20),s=n(212),u=n(92),l=n(70),c=n(14),d=c.process,h=c.setImmediate,f=c.clearImmediate,p=c.MessageChannel,m=c.Dispatch,g=0,v={},y=function(){var t=+this;if(v.hasOwnProperty(t)){var e=v[t];delete v[t],e()}},_=function(t){y.call(t.data)};h&&f||(h=function(t){for(var e=[],n=1;arguments.length>n;)e.push(arguments[n++]);return v[++g]=function(){s("function"==typeof t?t:Function(t),e)},r(g),g},f=function(t){delete v[t]},"process"==n(40)(d)?r=function(t){d.nextTick(o(y,t,1))}:m&&m.now?r=function(t){m.now(o(y,t,1))}:p?(i=new p,a=i.port2,i.port1.onmessage=_,r=o(a.postMessage,a,1)):c.addEventListener&&"function"==typeof postMessage&&!c.importScripts?(r=function(t){c.postMessage(t+"","*")},c.addEventListener("message",_,!1)):r="onreadystatechange"in l("script")?function(t){u.appendChild(l("script"))["onreadystatechange"]=function(){u.removeChild(this),y.call(t)}}:function(t){setTimeout(o(y,t,1),0)}),t.exports={set:h,clear:f}},function(t,e){t.exports=function(t){try{return{e:!1,v:t()}}catch(e){return{e:!0,v:e}}}},function(t,e,n){var r=n(87);t.exports=function(t,e){var n=r.f(t);return(0,n.resolve)(e),n.promise}},function(t,e,n){"use strict";var r=n(14),i=n(5),a=n(16),o=n(19),s=n(11)("species");t.exports=function(t){var e="function"==typeof i[t]?i[t]:r[t];o&&e&&!e[s]&&a.f(e,s,{configurable:!0,get:function(){return this}})}},function(t,e,n){t.exports={default:n(218),__esModule:!0}},function(t,e,n){"use strict";var r=n(14),i=n(12),a=n(45),o=n(25),s=n(24),u=n(60),l=n(39),c=n(59),d=n(17),h=n(43),f=n(16).f,p=n(88)(0),m=n(19);t.exports=function(t,e,n,g,v,y){var _=r[t],b=_,E=v?"set":"add",w=b&&b.prototype,A={};return m&&"function"==typeof b&&(y||w.forEach&&!o(function(){(new b).entries().next()}))?(b=e(function(e,n){c(e,b,t,"_c"),e._c=new _,void 0!=n&&l(n,v,e[E],e)}),p("add,clear,delete,forEach,get,has,set,keys,values,entries,toJSON".split(","),function(t){var e="add"==t||"set"==t;t in w&&(!y||"clear"!=t)&&s(b.prototype,t,function(n,r){if(c(this,b,t),!e&&y&&!d(n))return"get"==t&&void 0;var i=this._c[t](0===n?0:n,r);return e?this:i})}),y||f(b.prototype,"size",{get:function(){return this._c.size}})):(b=g.getConstructor(e,t,v,E),u(b.prototype,n),a.NEED=!0),h(b,t),A[t]=b,i(i.G+i.W+i.F,A),y||g.setStrong(b,t,v),b}},function(t,e,n){"use strict";var r=n(12);t.exports=function(t){r(r.S,t,{of:function(){for(var t=arguments.length,e=Array(t);t--;)e[t]=arguments[t];return new this(e)}})}},function(t,e,n){"use strict";var r=n(12),i=n(41),a=n(20),o=n(39);t.exports=function(t){r(r.S,t,{from:function(t){var e,n,r,s,u=arguments[1];return i(this),e=void 0!==u,e&&i(u),void 0==t?new this:(n=[],e?(r=0,s=a(u,arguments[2],2),o(t,!1,function(t){n.push(s(t,r++))})):o(t,!1,n.push,n),new this(n))}})}},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),u=n(3),l=r(u),c=n(2),d=r(c),h=n(4),f=r(h),p=n(21),m=r(p),g=n(27),v=r(g),y=function(t){function e(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments[1];(0,a.default)(this,e);var i=(0,s.default)(this,t.call(this,n));return i.core=r,i}return(0,d.default)(e,t),(0,l.default)(e,[{key:"name",get:function(){return"error"}}],[{key:"Levels",get:function(){return{FATAL:"FATAL",WARN:"WARN",INFO:"INFO"}}}]),e.prototype.createError=function(t){if(!this.core)return void v.default.warn(this.name,"Core is not set. Error: ",t);this.core.trigger(f.default.ERROR,t)},e}(m.default);e.default=y,t.exports=e["default"]},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(261),i=function(t){return t&&t.__esModule?t:{default:t}}(r);e.default=i.default,t.exports=e["default"]},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(266),i=function(t){return t&&t.__esModule?t:{default:t}}(r);e.default=i.default,t.exports=e["default"]},function(t,e,n){(function(e){function n(t,e){return null==t?void 0:t[e]}function r(t){var e=!1;if(null!=t&&"function"!=typeof t.toString)try{e=!!(t+"")}catch(n){}return e}function i(t){var e=-1,n=t?t.length:0;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function a(){this.__data__=gt?gt(null):{}}function o(t){return this.has(t)&&delete this.__data__[t]}function s(t){var e=this.__data__;if(gt){var n=e[t];return n===z?void 0:n}return ct.call(e,t)?e[t]:void 0}function u(t){var e=this.__data__;return gt?void 0!==e[t]:ct.call(e,t)}function l(t,e){return this.__data__[t]=gt&&void 0===e?z:e,this}function c(t){var e=-1,n=t?t.length:0;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function d(){this.__data__=[]}function h(t){var e=this.__data__,n=w(e,t);return!(n<0)&&(n==e.length-1?e.pop():pt.call(e,n,1),!0)}function f(t){var e=this.__data__,n=w(e,t);return n<0?void 0:e[n][1]}function p(t){return w(this.__data__,t)>-1}function m(t,e){var n=this.__data__,r=w(n,t);return r<0?n.push([t,e]):n[r][1]=e,this}function g(t){var e=-1,n=t?t.length:0;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function v(){this.__data__={hash:new i,map:new(mt||c),string:new i}}function y(t){return k(this,t)["delete"](t)}function _(t){return k(this,t).get(t)}function b(t){return k(this,t).has(t)}function E(t,e){return k(this,t).set(t,e),this}function w(t,e){for(var n=t.length;n--;)if(D(t[n][0],e))return n;return-1}function A(t,e){e=M(e,t)?[e]:x(e);for(var n=0,r=e.length;null!=t&&n<r;)t=t[I(e[n++])];return n&&n==r?t:void 0}function S(t){return!(!U(t)||L(t))&&(N(t)||r(t)?ht:tt).test(P(t))}function T(t){if("string"==typeof t)return t;if(B(t))return yt?yt.call(t):"";var e=t+"";return"0"==e&&1/t==-H?"-0":e}function x(t){return bt(t)?t:_t(t)}function k(t,e){var n=t.__data__;return R(e)?n["string"==typeof e?"string":"hash"]:n.map}function C(t,e){var r=n(t,e);return S(r)?r:void 0}function M(t,e){if(bt(t))return!1;var n=typeof t;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=t&&!B(t))||(X.test(t)||!q.test(t)||null!=e&&t in Object(e))}function R(t){var e=typeof t;return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t}function L(t){return!!ut&&ut in t}function I(t){if("string"==typeof t||B(t))return t;var e=t+"";return"0"==e&&1/t==-H?"-0":e}function P(t){if(null!=t){try{return lt.call(t)}catch(e){}try{return t+""}catch(e){}}return""}function O(t,e){if("function"!=typeof t||e&&"function"!=typeof e)throw new TypeError(G);var n=function(){var r=arguments,i=e?e.apply(this,r):r[0],a=n.cache;if(a.has(i))return a.get(i);var o=t.apply(this,r);return n.cache=a.set(i,o),o};return n.cache=new(O.Cache||g),n}function D(t,e){return t===e||t!==t&&e!==e}function N(t){var e=U(t)?dt.call(t):"";return e==K||e==Y}function U(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function F(t){return!!t&&"object"==typeof t}function B(t){return"symbol"==typeof t||F(t)&&dt.call(t)==W}function j(t){return null==t?"":T(t)}function V(t,e,n){var r=null==t?void 0:A(t,e);return void 0===r?n:r}var G="Expected a function",z="__lodash_hash_undefined__",H=1/0,K="[object Function]",Y="[object GeneratorFunction]",W="[object Symbol]",q=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,X=/^\w*$/,$=/^\./,Z=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Q=/[\\^$.*+?()[\]{}|]/g,J=/\\(\\)?/g,tt=/^\[object .+?Constructor\]$/,et="object"==typeof e&&e&&e.Object===Object&&e,nt="object"==typeof self&&self&&self.Object===Object&&self,rt=et||nt||Function("return this")(),it=Array.prototype,at=Function.prototype,ot=Object.prototype,st=rt["__core-js_shared__"],ut=function(){var t=/[^.]+$/.exec(st&&st.keys&&st.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}(),lt=at.toString,ct=ot.hasOwnProperty,dt=ot.toString,ht=RegExp("^"+lt.call(ct).replace(Q,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),ft=rt.Symbol,pt=it.splice,mt=C(rt,"Map"),gt=C(Object,"create"),vt=ft?ft.prototype:void 0,yt=vt?vt.toString:void 0;i.prototype.clear=a,i.prototype["delete"]=o,i.prototype.get=s,i.prototype.has=u,i.prototype.set=l,c.prototype.clear=d,c.prototype["delete"]=h,c.prototype.get=f,c.prototype.has=p,c.prototype.set=m,g.prototype.clear=v,g.prototype["delete"]=y,g.prototype.get=_,g.prototype.has=b,g.prototype.set=E;var _t=O(function(t){t=j(t);var e=[];return $.test(t)&&e.push(""),t.replace(Z,function(t,n,r,i){e.push(r?i.replace(J,"$1"):n||t)}),e});O.Cache=g;var bt=Array.isArray;t.exports=V}).call(e,n(46))},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(29),s=r(o),u=function(){function t(e,n,r,i,o,u){if((0,a.default)(this,t),this.webUrl=e,this.adServer=n,this.reportUrl="/service/flashPlayerService-adreport.action",void 0!==n&&""!=n)if(n.indexOf("|")>0){var l=new Array;if(l=n.split("|"),l.length>1){var c=0,d=l.length-1,h=Math.round(Math.random()*(d-c))+c;this.adServer=l[h]}}else if(n.indexOf(",")>0){var l=new Array;if(l=n.split(","),l.length>1){var c=0,d=l.length-1,h=Math.round(Math.random()*(d-c))+c;this.adServer=l[h]}}this.reportAddress=this.webUrl+this.reportUrl,void 0!==this.adServer&&""!=this.adServer&&(this.reportAddress="http://"+this.adServer+"/reportService"+this.reportUrl),void 0!==u&&""!=u||(u="anonymous"),this.dataPack={siteId:r,contentId:i,fileId:o,playTech:"html5",devType:s.default.isMobile?s.default.isiOS?"ios":s.default.isAndroid?"android":"mobi":"pc",userName:encodeURIComponent(u)}}return t.prototype.parseJsonToParams=function(t){var e=[];for(var n in t){var r=n+"="+t[n];e.push(r)}return e.join("&")},t.prototype.send=function(t,e){if(void 0!==this.webUrl&&""!=this.webUrl){var n=this.parseJsonToParams(this.dataPack);e&&(n+="&"+this.parseJsonToParams(e));var r=document.getElementsByTagName("head")[0]||document.documentElement,i=document.createElement("script");i.src=this.reportAddress+"?"+n,r.insertBefore(i,r.firstChild),i.onload=i.onreadystatechange=function(){this.readyState&&!/loaded|complete/.test(i.readyState)||(i.onload=i.onreadystatechange=null,r&&i.parentNode&&(r.removeChild(i),console.log("remove adreport ")))}}},t}();e.default=u,t.exports=e["default"]},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),u=n(3),l=r(u),c=n(2),d=r(c),h=n(15),f=r(h),p=n(6),m=r(p),g=n(10),v=r(g),y=n(4),_=r(y),b=n(9),E=r(b),w=n(296),A=r(w),S=n(297),T=r(S),x=function(t){function e(n){(0,a.default)(this,e);var r=(0,s.default)(this,t.call(this,n));return r._init(),r}return(0,d.default)(e,t),e.buildSpriteConfig=function(t,e,n,r,i,a,o){o=o||0;for(var s=[],u=0;u<e;u++)s.push({url:t,time:o+u*a,w:n,h:r,x:u%i*n,y:Math.floor(u/i)*r});return s},(0,l.default)(e,[{key:"name",get:function(){return"scrub-thumbnails"}},{key:"attributes",get:function(){return{class:this.name}}},{key:"template",get:function(){return(0,v.default)(A.default)}}]),e.prototype.bindEvents=function(){this.listenTo(this.core.mediaControl,_.default.MEDIACONTROL_MOUSEMOVE_SEEKBAR,this._onMouseMove),this.listenTo(this.core.mediaControl,_.default.MEDIACONTROL_MOUSELEAVE_SEEKBAR,this._onMouseLeave),this.listenTo(this.core.mediaControl,_.default.MEDIACONTROL_RENDERED,this._onMediaControlRendered)},e.prototype._init=function(){this._loaded=!1,this._show=!1,this._hoverPosition=0,this._thumbs=[],this._$backdropCarouselImgs=[];try{this._getOptions()}catch(t){return}this._loadThumbs()},e.prototype._loadThumbs=function(){var t=this;this._loadThumbnails(function(){t._loadBackdrop(),t._loaded=!0,t._renderPlugin()})},e.prototype._getOptions=function(){if(!("thumbnails"in this.core.options))throw"'thumbnails' property missing from options object.";return this.core.options.thumbnails},e.prototype._appendElToMediaControl=function(){this.core.mediaControl.$el.find(".media-control-background").first().after(this.el)},e.prototype._onMediaControlRendered=function(){this._createElements(),this._init()},e.prototype._onMouseMove=function(t){this._calculateHoverPosition(t),this._show=!0,this._renderPlugin()},e.prototype._onMouseLeave=function(){this._show=!1,this._renderPlugin()},e.prototype._calculateHoverPosition=function(t){var e=t.pageX-this.core.mediaControl.$seekBarContainer.offset().left;this._hoverPosition=Math.min(1,Math.max(e/this.core.mediaControl.$seekBarContainer.width(),0))},e.prototype._loadThumbnails=function(t){var e=this,n=this._getOptions().thumbs,r=n.length;if(0===r)return void t();for(var i=0;i<n.length;i++)!function(i){var a=n[i];e._thumbs.push(null);var o=i<n.length-1?n[i+1]:null,s=o?o.time-a.time:null,u=new Image,l=function(){var n=u.width,o=u.height;e._thumbs[i]={imageW:n,imageH:o,x:a.x||0,y:a.y||0,w:a.w||n,h:a.h||o,url:a.url,time:a.time,duration:s},0==--r&&t()};u.onload=l,u.src=a.url}(i)},e.prototype._buildImg=function(t,e){var n=e/t.h,r=(0,E.default)("<img />").addClass("thumbnail-img").attr("src",t.url),i=(0,E.default)("<div />").addClass("thumbnail-container");return i.css("width",t.w*n),i.css("height",e),r.css({height:t.imageH*n,left:-1*t.x*n,top:-1*t.y*n}),i.append(r),i},e.prototype._loadBackdrop=function(){if(this._getOptions().backdropHeight)for(var t=this._$carousel,e=0;e<this._thumbs.length;e++){var n=this._buildImg(this._thumbs[e],this._getOptions().backdropHeight);this._$backdropCarouselImgs.push(n),t.append(n)}},e.prototype._updateCarousel=function(){if(this._getOptions().backdropHeight){var t=this._hoverPosition,e=this.core.mediaControl.container.getDuration(),n=e*t,r=this._$backdrop.width(),i=this._$carousel,a=i.width(),o=this._thumbs,s=a/o.length,u=this._getThumbIndexForTime(n),l=o[u],c=l.duration;null===c&&(c=Math.max(e-l.time,0));var d=n-l.time,h=d/c,f=s*h,p=u*s+f,m=p-t*r;i.css("left",-m);for(var g=0;g<o.length;g++){var v=s*g,y=v-p;y<0&&(y=Math.min(0,y+s));var _=Math.max(.6-Math.abs(y)/(2*s),.08);this._$backdropCarouselImgs[g].css("opacity",_)}}},e.prototype._updateSpotlightThumb=function(){if(this._getOptions().spotlightHeight){var t=this._hoverPosition,e=this.core.mediaControl.container.getDuration(),n=e*t,r=this._getThumbIndexForTime(n),i=this._thumbs[r],a=this._$spotlight;a.empty(),a.append(this._buildImg(i,this._getOptions().spotlightHeight));var o=this.$el.width(),s=a.width(),u=o*t-s/2;u=Math.max(Math.min(u,o-s),0),a.css("left",u)}},e.prototype._getThumbIndexForTime=function(t){for(var e=this._thumbs,n=e.length-1;n>=0;n--){if(e[n].time<=t)return n}return 0},e.prototype._renderPlugin=function(){this._loaded&&(this._show&&this._getOptions().thumbs.length>0?(this.$el.removeClass("hidden"),this._updateCarousel(),this._updateSpotlightThumb()):this.$el.addClass("hidden"))},e.prototype._createElements=function(){this.$el.html(this.template({backdropHeight:this._getOptions().backdropHeight,spotlightHeight:this._getOptions().spotlightHeight})),this.$el.append(m.default.getStyleFor(T.default)),this._$spotlight=this.$el.find(".spotlight"),this._$backdrop=this.$el.find(".backdrop"),this._$carousel=this._$backdrop.find(".carousel"),this.$el.addClass("hidden"),this._appendElToMediaControl()},e}(f.default);e.default=x,t.exports=e["default"]},function(t,e){function n(t,e){for(var n=0;n<t.length;n++){var r=t[n],i=h[r.id];if(i){i.refs++;for(var a=0;a<i.parts.length;a++)i.parts[a](r.parts[a]);for(;a<r.parts.length;a++)i.parts.push(u(r.parts[a],e))}else{for(var o=[],a=0;a<r.parts.length;a++)o.push(u(r.parts[a],e));h[r.id]={id:r.id,refs:1,parts:o}}}}function r(t){for(var e=[],n={},r=0;r<t.length;r++){var i=t[r],a=i[0],o=i[1],s=i[2],u=i[3],l={css:o,media:s,sourceMap:u};n[a]?n[a].parts.push(l):e.push(n[a]={id:a,parts:[l]})}return e}function i(t,e){var n=m(),r=y[y.length-1];if("top"===t.insertAt)r?r.nextSibling?n.insertBefore(e,r.nextSibling):n.appendChild(e):n.insertBefore(e,n.firstChild),y.push(e);else{if("bottom"!==t.insertAt)throw new Error("Invalid value for parameter 'insertAt'. Must be 'top' or 'bottom'.");n.appendChild(e)}}function a(t){t.parentNode.removeChild(t);var e=y.indexOf(t);e>=0&&y.splice(e,1)}function o(t){var e=document.createElement("style");return e.type="text/css",i(t,e),e}function s(t){var e=document.createElement("link");return e.rel="stylesheet",i(t,e),e}function u(t,e){var n,r,i;if(e.singleton){var u=v++;n=g||(g=o(e)),r=l.bind(null,n,u,!1),i=l.bind(null,n,u,!0)}else t.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(n=s(e),r=d.bind(null,n),i=function(){a(n),n.href&&URL.revokeObjectURL(n.href)}):(n=o(e),r=c.bind(null,n),i=function(){a(n)});return r(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap)return;r(t=e)}else i()}}function l(t,e,n,r){var i=n?"":r.css;if(t.styleSheet)t.styleSheet.cssText=_(e,i);else{var a=document.createTextNode(i),o=t.childNodes;o[e]&&t.removeChild(o[e]),o.length?t.insertBefore(a,o[e]):t.appendChild(a)}}function c(t,e){var n=e.css,r=e.media;if(r&&t.setAttribute("media",r),t.styleSheet)t.styleSheet.cssText=n;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(n))}}function d(t,e){var n=e.css,r=e.sourceMap;r&&(n+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(r))))+" */");var i=new Blob([n],{type:"text/css"}),a=t.href;t.href=URL.createObjectURL(i),a&&URL.revokeObjectURL(a)}var h={},f=function(t){var e;return function(){return void 0===e&&(e=t.apply(this,arguments)),e}},p=f(function(){return/msie [6-9]\b/.test(self.navigator.userAgent.toLowerCase())}),m=f(function(){return document.head||document.getElementsByTagName("head")[0]}),g=null,v=0,y=[];t.exports=function(t,e){if("undefined"!=typeof DEBUG&&DEBUG&&"object"!=typeof document)throw new Error("The style-loader cannot be used in a non-browser environment");e=e||{},void 0===e.singleton&&(e.singleton=p()),void 0===e.insertAt&&(e.insertAt="bottom");var i=r(t);return n(i,e),function(t){for(var a=[],o=0;o<i.length;o++){var s=i[o],u=h[s.id];u.refs--,a.push(u)}if(t){n(r(t),e)}for(var o=0;o<a.length;o++){var u=a[o];if(0===u.refs){for(var l=0;l<u.parts.length;l++)u.parts[l]();delete h[u.id]}}}};var _=function(){var t=[];return function(e,n){return t[e]=n,t.filter(Boolean).join("\n")}}()},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),u=n(3),l=r(u),c=n(2),d=r(c),h=n(9),f=r(h),p=n(15),m=r(p),g=n(4),v=r(g);n(299);var y=n(133),_=r(y),b=n(317),E=r(b),w=n(318),A=r(w),S=function(t){function e(n){(0,a.default)(this,e);var r=(0,s.default)(this,t.call(this,n));r._markers=[],r._duration=null;try{r._getOptions()}catch(i){return(0,s.default)(r)}return r._createInitialMarkers(),r}return(0,d.default)(e,t),(0,l.default)(e,[{key:"name",get:function(){return"markers-plugin"}},{key:"attributes",get:function(){return{class:this.name}}}],[{key:"Marker",get:function(){return _.default}},{key:"StandardMarker",get:function(){return E.default}},{key:"ImageMarker",get:function(){return A.default}},{key:"default",get:function(){return e}}]),e.prototype.bindEvents=function(){this.listenTo(this.core.mediaControl,v.default.MEDIACONTROL_RENDERED,this._onMediaControlRendered),this.listenTo(this.core.mediaControl,v.default.MEDIACONTROL_CONTAINERCHANGED,this._onMediaControlContainerChanged)},e.prototype.addMarker=function(t){var e=this._buildInternalMarker(t);this._markers.push(e),this._createMarkerEl(e),this._renderMarkers()},e.prototype.removeMarker=function(t){var e=null,n=0;return this._markers.some(function(r){return r.source===t?(e=r,!0):(n++,!1)}),!!e&&(this._removeInternalMarker(n),!0)},e.prototype._removeInternalMarker=function(t){var e=this._markers[t];e.$marker.remove(),e.emitter.off("timeChanged",e.timeChangedHandler),e.$tooltipContainer&&e.$tooltipContainer.remove(),e.tooltipChangedHandler&&e.emitter.off("tooltipChanged",e.tooltipChangedHandler),e.onDestroy(),this._markers.splice(t,1)},e.prototype.clearMarkers=function(){if(this._markers)for(var t=this._markers.length-1;t>=0;t--)this._removeInternalMarker(t)},e.prototype.getAll=function(){return this._markers.map(function(t){return t.source})},e.prototype.getByIndex=function(t){return t>=this._markers.length||t<0?null:this._markers[t].source},e.prototype._bindContainerEvents=function(){this._oldContainer&&(this.stopListening(this._oldContainer,v.default.CONTAINER_TIMEUPDATE,this._onTimeUpdate),this.stopListening(this._oldContainer,v.default.CONTAINER_MEDIACONTROL_SHOW,this._onMediaControlShow)),this._oldContainer=this.core.mediaControl.container,this.listenTo(this.core.mediaControl.container,v.default.CONTAINER_TIMEUPDATE,this._onTimeUpdate),this.listenTo(this.core.mediaControl.container,v.default.CONTAINER_MEDIACONTROL_SHOW,this._onMediaControlShow)},e.prototype._getOptions=function(){if(!("markers"in this.core.options))throw"'markers' property missing from options object.";return this.core.options.markers},e.prototype._buildInternalMarker=function(t){var e=t.getTooltipEl();return e&&(e=(0,f.default)(e)),{source:t,emitter:t.getEmitter(),$marker:(0,f.default)(t.getMarkerEl()),markerLeft:null,$tooltip:e,$tooltipContainer:null,tooltipContainerLeft:null,tooltipContainerBottom:null,tooltipChangedHandler:null,time:t.getTime(),timeChangedHandler:null,onDestroy:t.onDestroy}},e.prototype._createInitialMarkers=function(){var t=this,e=this._getOptions().markers;e&&(this._markers=[],e.forEach(function(e){t._markers.push(t._buildInternalMarker(e))}),this._markers.forEach(function(e){t._createMarkerEl(e)}),this._renderMarkers())},e.prototype._createMarkerEl=function(t){var e=this,n=t.$marker;t.timeChangedHandler=function(){e._updateMarkerTime(t)},t.emitter.on("timeChanged",t.timeChangedHandler),n.click(function(n){e.core.mediaControl.container.seek(t.time),n.preventDefault(),n.stopImmediatePropagation()}),this._$markers.append(n);var r=t.$tooltip;if(r){var i=(0,f.default)("<div />").addClass("tooltip-container");t.$tooltipContainer=i,i.append(r),this._$tooltips.append(i),t.tooltipChangedHandler=function(){e._updateTooltipPosition(t)},t.emitter.on("tooltipChanged",t.tooltipChangedHandler),this._updateTooltipPosition(t)}},e.prototype._updateMarkerTime=function(t){t.time=t.source.getTime(),this._renderMarkers()},e.prototype._updateTooltipPosition=function(t){if(this._mediaControlContainerLoaded&&this._duration){var e=t.$tooltipContainer;if(e){var n=this._getOptions().tooltipBottomMargin||17,r=e.width(),i=this._$tooltips.width(),a=i*(t.time/this._duration)-r/2;a=Math.max(0,Math.min(a,i-r)),n===t.tooltipContainerBottom&&a===t.tooltipContainerLeft||(e.css({bottom:n+"px",left:a+"px"}),t.tooltipContainerBottom=n,t.tooltipContainerLeft=a)}}},e.prototype._onMediaControlRendered=function(){this._appendElToMediaControl()},e.prototype._updateDuration=function(){this._duration=this.core.mediaControl.container.getDuration()||null},e.prototype._onMediaControlContainerChanged=function(){this._bindContainerEvents(),this._mediaControlContainerLoaded=!0,this._updateDuration(),this._renderMarkers()},e.prototype._onTimeUpdate=function(){this._updateDuration(),this._renderMarkers()},e.prototype._onMediaControlShow=function(){this._renderMarkers()},e.prototype._renderMarkers=function(){var t=this;this._mediaControlContainerLoaded&&this._duration&&this._markers.forEach(function(e){var n=e.$marker,r=Math.min(Math.max(e.time/t._duration*100,0),100);e.markerLeft!==r&&(n.css("left",r+"%"),e.markerLeft=r),t._updateTooltipPosition(e)})},e.prototype._appendElToMediaControl=function(){this.core.mediaControl.$el.find(".bar-container").first().append(this.el)},e.prototype.render=function(){this._$markers=(0,f.default)("<div />").addClass("markers-plugin-markers"),this._$tooltips=(0,f.default)("<div />").addClass("markers-plugin-tooltips");var t=(0,f.default)(this.el);return t.append(this._$markers),t.append(this._$tooltips),this._appendElToMediaControl(),this},e.prototype.destroy=function(){this._markers.forEach(function(t){t.tooltipChangedHandler&&(t.emitter.off("timeChanged",t.timeChangedHandler),t.emitter.off("tooltipChanged",t.tooltipChangedHandler)),t.onDestroy()})},e}(m.default);e.default=S,t.exports=e["default"]},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(301),s=r(o),u=function(){function t(){(0,a.default)(this,t),this._emitter=new s.default({})}return t.prototype.getEmitter=function(){return this._emitter},t.prototype.notifyTimeChanged=function(){this._emitter.emit("timeChanged")},t.prototype.notifyTooltipChanged=function(){this._emitter.emit("tooltipChanged")},t.prototype.getTime=function(){throw"Not implemented!"},t.prototype.getMarkerEl=function(){throw"Not implemented!"},t.prototype.getTooltipEl=function(){throw"Not implemented!"},t.prototype.onDestroy=function(){},t}();e.default=u,t.exports=e["default"]},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),u=n(2),l=r(u),c=n(9),d=r(c),h=n(133),f=r(h),p=function(t){function e(n){(0,a.default)(this,e);var r=(0,s.default)(this,t.call(this));return r._time=n,r._$marker=r._buildMarkerEl(),r._$tooltip=null,r}return(0,l.default)(e,t),e.prototype.getTime=function(){return this._time},e.prototype.setTime=function(t){this._time=t,this.notifyTimeChanged()},e.prototype.getMarkerEl=function(){return this._$marker},e.prototype.getTooltipEl=function(){return this._$tooltip},e.prototype._buildMarkerEl=function(){var t=(0,d.default)("<div />").addClass("standard-marker");return t.append((0,d.default)("<div />").addClass("standard-marker-inner")),t},e.prototype._setTooltipEl=function(t){if(this._$tooltip)throw new Error("Tooltip can only be set once.");this._$tooltip=t,this._addListenersForTooltip()},e.prototype._addListenersForTooltip=function(){var t=this;if(this._$tooltip){var e=this._$marker,n=!1;e.bind("mouseover",function(){n||(n=!0,t._$tooltip.attr("data-show","1"),t.notifyTooltipChanged())}),e.bind("mouseout",function(){n&&(n=!1,t._$tooltip.attr("data-show","0"))})}},e}(f.default);e.default=p,t.exports=e["default"]},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=n(319),t.exports=e["default"]},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(326),i=function(t){return t&&t.__esModule?t:{default:t}}(r);e.default=i.default,t.exports=e["default"]},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(331),i=function(t){return t&&t.__esModule?t:{default:t}}(r);e.default=i.default,t.exports=e["default"]},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0}),e.SubtitlePlugin=e.LevelSelector=e.Markers=e.Thumbnails=e.$=e.template=e.version=e.Vendor=e.Styler=e.Log=e.Poster=e.NoOp=e.HTMLImg=e.HTML5Video=e.HTML5Audio=e.HLS=e.Utils=e.UIObject=e.BaseObject=e.Loader=e.Core=e.Container=e.Playback=e.UICorePlugin=e.CorePlugin=e.UIContainerPlugin=e.ContainerPlugin=e.MediaControl=e.PlayerInfo=e.Browser=e.Events=e.Mediator=e.Player=void 0;var i=n(139),a=r(i),o=n(8),s=r(o),u=n(4),l=r(u),c=n(13),d=r(c),h=n(47),f=r(h),p=n(62),m=r(p),g=n(15),v=r(g),y=n(31),_=r(y),b=n(21),E=r(b),w=n(30),A=r(w),S=n(29),T=r(S),x=n(98),k=r(x),C=n(97),M=r(C),R=n(103),L=r(R),I=n(37),P=r(I),O=n(99),D=r(O),N=n(57),U=r(N),F=n(109),B=r(F),j=n(108),V=r(j),G=n(38),z=r(G),H=n(112),K=r(H),Y=n(113),W=r(Y),q=n(126),X=r(q),$=n(27),Z=r($),Q=n(6),J=r(Q),tt=n(83),et=r(tt),nt=n(10),rt=r(nt),it=n(130),at=r(it),ot=n(132),st=r(ot),ut=n(135),lt=r(ut),ct=n(136),dt=r(ct),ht=n(9),ft=r(ht);e.Player=a.default,e.Mediator=P.default,e.Events=l.default,e.Browser=T.default,e.PlayerInfo=U.default,e.MediaControl=D.default,e.ContainerPlugin=f.default,e.UIContainerPlugin=_.default,e.CorePlugin=m.default,e.UICorePlugin=v.default,e.Playback=d.default,e.Container=k.default,e.Core=M.default,e.Loader=L.default,e.BaseObject=E.default,e.UIObject=A.default,e.Utils=s.default,e.HLS=B.default,e.HTML5Audio=V.default,e.HTML5Video=z.default,e.HTMLImg=K.default,e.NoOp=W.default,e.Poster=X.default,e.Log=Z.default,e.Styler=J.default,e.Vendor=et.default,e.version="6.0.17b",e.template=rt.default,e.$=ft.default,e.Thumbnails=at.default,e.Markers=st.default,e.LevelSelector=lt.default,e.SubtitlePlugin=dt.default},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=n(28),a=r(i),o=n(0),s=r(o),u=n(1),l=r(u),c=n(3),d=r(c),h=n(2),f=r(h),p=n(8),m=n(21),g=r(m),v=n(4),y=r(v),_=n(29),b=r(_),E=n(172),w=r(E),A=n(103),S=r(A),T=n(57),x=r(T),k=n(9),C=r(k),M=(0,p.currentScriptUrl)().replace(/\/[^\/]+$/,""),R=function(t){function e(n){(0,s.default)(this,e);var r=(0,l.default)(this,t.call(this,n)),i={playerId:(0,p.uniqueId)(""),persistConfig:!0,width:640,height:360,baseUrl:M,allowUserInteraction:b.default.isMobile};return r._options=C.default.extend(i,n),r.options.sources=r._normalizeSources(n),r.options.chromeless||(r.options.allowUserInteraction=!0),r.options.allowUserInteraction||(r.options.disableKeyboardShortcuts=!0),r._registerOptionEventListeners(),r._coreFactory=new w.default(r),r.playerInfo=x.default.getInstance(r.options.playerId),r.playerInfo.currentSize={width:n.width,height:n.height},r.playerInfo.options=r.options,r.options.parentId?r.setParentId(r.options.parentId):r.options.parent&&r.attachTo(r.options.parent),r}return(0,f.default)(e,t),(0,d.default)(e,[{key:"loader",set:function(t){this._loader=t},get:function(){return this._loader||(this._loader=new S.default(this.options.plugins||{},this.options.playerId)),this._loader}},{key:"ended",get:function(){return this.core.mediaControl.container.ended}},{key:"buffering",get:function(){return this.core.mediaControl.container.buffering}},{key:"isReady",get:function(){return!!this._ready}},{key:"eventsMapping",get:function(){return{onReady:y.default.PLAYER_READY,onResize:y.default.PLAYER_RESIZE,onPlay:y.default.PLAYER_PLAY,onPause:y.default.PLAYER_PAUSE,onStop:y.default.PLAYER_STOP,onEnded:y.default.PLAYER_ENDED,onSeek:y.default.PLAYER_SEEK,onError:y.default.PLAYER_ERROR,onTimeUpdate:y.default.PLAYER_TIMEUPDATE,onVolumeUpdate:y.default.PLAYER_VOLUMEUPDATE,onSubtitleAvailable:y.default.PLAYER_SUBTITLE_AVAILABLE,onFullScreen:y.default.PLAYER_FULLSCREEN}}}]),e.prototype.setParentId=function(t){var e=document.querySelector(t);return e&&this.attachTo(e),this},e.prototype.attachTo=function(t){return this.options.parentElement=t,this.core=this._coreFactory.create(),this._addEventListeners(),this},e.prototype._addEventListeners=function(){return this.core.isReady?this._onReady():this.listenToOnce(this.core,y.default.CORE_READY,this._onReady),this.listenTo(this.core.mediaControl,y.default.MEDIACONTROL_CONTAINERCHANGED,this._containerChanged),this.listenTo(this.core,y.default.CORE_FULLSCREEN,this._onFullscreenChange),this},e.prototype._addContainerEventListeners=function(){var t=this.core.mediaControl.container;return t&&(this.listenTo(t,y.default.CONTAINER_PLAY,this._onPlay),this.listenTo(t,y.default.CONTAINER_PAUSE,this._onPause),this.listenTo(t,y.default.CONTAINER_STOP,this._onStop),this.listenTo(t,y.default.CONTAINER_ENDED,this._onEnded),this.listenTo(t,y.default.CONTAINER_SEEK,this._onSeek),this.listenTo(t,y.default.CONTAINER_ERROR,this._onError),this.listenTo(t,y.default.CONTAINER_TIMEUPDATE,this._onTimeUpdate),this.listenTo(t,y.default.CONTAINER_VOLUME,this._onVolumeUpdate),this.listenTo(t,y.default.CONTAINER_SUBTITLE_AVAILABLE,this._onSubtitleAvailable)),this},e.prototype._registerOptionEventListeners=function(){var t=this,e=this.options.events||{};return(0,a.default)(e).forEach(function(n){var r=t.eventsMapping[n];if(r){var i=e[n];i="function"==typeof i&&i,i&&t.on(r,i)}}),this},e.prototype._containerChanged=function(){this.stopListening(),this._addEventListeners()},e.prototype._onReady=function(){this._ready=!0,this._addContainerEventListeners(),this.trigger(y.default.PLAYER_READY)},e.prototype._onFullscreenChange=function(t){this.trigger(y.default.PLAYER_FULLSCREEN,t)},e.prototype._onVolumeUpdate=function(t){this.trigger(y.default.PLAYER_VOLUMEUPDATE,t)},e.prototype._onSubtitleAvailable=function(){this.trigger(y.default.PLAYER_SUBTITLE_AVAILABLE)},e.prototype._onPlay=function(){this.trigger(y.default.PLAYER_PLAY)},e.prototype._onPause=function(){this.trigger(y.default.PLAYER_PAUSE)},e.prototype._onStop=function(){this.trigger(y.default.PLAYER_STOP,this.getCurrentTime())},e.prototype._onEnded=function(){this.trigger(y.default.PLAYER_ENDED)},e.prototype._onSeek=function(t){this.trigger(y.default.PLAYER_SEEK,t)},e.prototype._onTimeUpdate=function(t){this.trigger(y.default.PLAYER_TIMEUPDATE,t)},e.prototype._onError=function(t){this.trigger(y.default.PLAYER_ERROR,t)},e.prototype._normalizeSources=function(t){var e=t.sources||(void 0!==t.source?[t.source]:[]);return 0===e.length?[{source:"",mimeType:""}]:e},e.prototype.resize=function(t){return this.core.resize(t),this},e.prototype.load=function(t,e,n){return void 0!==n&&this.configure({autoPlay:!!n}),this.core.load(t,e),this},e.prototype.destroy=function(){return this.core.destroy(),this},e.prototype.consent=function(){return this.core.getCurrentPlayback().consent(),this},e.prototype.play=function(){return this.core.mediaControl.container.play(),this},e.prototype.pause=function(){return this.core.mediaControl.container.pause(),this},e.prototype.stop=function(){return this.core.mediaControl.container.stop(),this},e.prototype.seek=function(t){return this.core.mediaControl.container.seek(t),this},e.prototype.seekPercentage=function(t){return this.core.mediaControl.container.seekPercentage(t),this},e.prototype.setVolume=function(t){return this.core&&this.core.mediaControl&&this.core.mediaControl.setVolume(t),this},e.prototype.getVolume=function(){return this.core&&this.core.mediaControl?this.core.mediaControl.volume:0},e.prototype.mute=function(){return this._mutedVolume=this.getVolume(),this.setVolume(0),this},e.prototype.unmute=function(){return this.setVolume("number"==typeof this._mutedVolume?this._mutedVolume:100),this._mutedVolume=null,this},e.prototype.isPlaying=function(){return this.core.mediaControl.container.isPlaying()},e.prototype.isDvrEnabled=function(){return this.core.mediaControl.container.isDvrEnabled()},e.prototype.isDvrInUse=function(){return this.core.mediaControl.container.isDvrInUse()},e.prototype.configure=function(t){return this.core.configure(t),this},e.prototype.getPlugin=function(t){return this.core.plugins.concat(this.core.mediaControl.container.plugins).filter(function(e){return e.name===t})[0]},e.prototype.getCurrentTime=function(){return this.core.mediaControl.container.getCurrentTime()},e.prototype.getStartTimeOffset=function(){return this.core.mediaControl.container.getStartTimeOffset()},e.prototype.getDuration=function(){return this.core.mediaControl.container.getDuration()},e.prototype.openLive=function(){return this.core.mediaControl.container.openLive()},e.prototype.closeLive=function(){return this.core.mediaControl.container.closeLive()},e}(g.default);e.default=R,t.exports=e["default"]},function(t,e,n){n(141),t.exports=n(5).Object.keys},function(t,e,n){var r=n(32),i=n(33);n(69)("keys",function(){return function(t){return i(r(t))}})},function(t,e,n){var r=n(23),i=n(48),a=n(143);t.exports=function(t){return function(e,n,o){var s,u=r(e),l=i(u.length),c=a(o,l);if(t&&n!=n){for(;l>c;)if((s=u[c++])!=s)return!0}else for(;l>c;c++)if((t||c in u)&&u[c]===n)return t||c||0;return!t&&-1}}},function(t,e,n){var r=n(65),i=Math.max,a=Math.min;t.exports=function(t,e){return t=r(t),t<0?i(t+e,0):a(t,e)}},function(t,e,n){n(34),n(36),t.exports=n(44).f("iterator")},function(t,e,n){var r=n(65),i=n(63);t.exports=function(t){return function(e,n){var a,o,s=String(i(e)),u=r(n),l=s.length;return u<0||u>=l?t?"":void 0:(a=s.charCodeAt(u),a<55296||a>56319||u+1===l||(o=s.charCodeAt(u+1))<56320||o>57343?t?s.charAt(u):a:t?s.slice(u,u+2):o-56320+(a-55296<<10)+65536)}}},function(t,e,n){"use strict";var r=n(51),i=n(42),a=n(43),o={};n(24)(o,n(11)("iterator"),function(){return this}),t.exports=function(t,e,n){t.prototype=r(o,{next:i(1,n)}),a(t,e+" Iterator")}},function(t,e,n){var r=n(16),i=n(18),a=n(33);t.exports=n(19)?Object.defineProperties:function(t,e){i(t);for(var n,o=a(e),s=o.length,u=0;s>u;)r.f(t,n=o[u++],e[n]);return t}},function(t,e,n){"use strict";var r=n(149),i=n(93),a=n(35),o=n(23);t.exports=n(73)(Array,"Array",function(t,e){this._t=o(t),this._i=0,this._k=e},function(){var t=this._t,e=this._k,n=this._i++;return!t||n>=t.length?(this._t=void 0,i(1)):"keys"==e?i(0,n):"values"==e?i(0,t[n]):i(0,[n,t[n]])},"values"),a.Arguments=a.Array,r("keys"),r("values"),r("entries")},function(t,e){t.exports=function(){}},function(t,e,n){n(151),n(53),n(155),n(156),t.exports=n(5).Symbol},function(t,e,n){"use strict";var r=n(14),i=n(22),a=n(19),o=n(12),s=n(74),u=n(45).KEY,l=n(25),c=n(67),d=n(43),h=n(49),f=n(11),p=n(44),m=n(77),g=n(152),v=n(153),y=n(94),_=n(18),b=n(23),E=n(71),w=n(42),A=n(51),S=n(154),T=n(79),x=n(16),k=n(33),C=T.f,M=x.f,R=S.f,L=r.Symbol,I=r.JSON,P=I&&I.stringify,O=f("_hidden"),D=f("toPrimitive"),N={}.propertyIsEnumerable,U=c("symbol-registry"),F=c("symbols"),B=c("op-symbols"),j=Object["prototype"],V="function"==typeof L,G=r.QObject,z=!G||!G["prototype"]||!G["prototype"].findChild,H=a&&l(function(){return 7!=A(M({},"a",{get:function(){return M(this,"a",{value:7}).a}})).a})?function(t,e,n){var r=C(j,e);r&&delete j[e],M(t,e,n),r&&t!==j&&M(j,e,r)}:M,K=function(t){var e=F[t]=A(L["prototype"]);return e._k=t,e},Y=V&&"symbol"==typeof L.iterator?function(t){return"symbol"==typeof t}:function(t){return t instanceof L},W=function(t,e,n){return t===j&&W(B,e,n),_(t),e=E(e,!0),_(n),i(F,e)?(n.enumerable?(i(t,O)&&t[O][e]&&(t[O][e]=!1),n=A(n,{enumerable:w(0,!1)})):(i(t,O)||M(t,O,w(1,{})),t[O][e]=!0),H(t,e,n)):M(t,e,n)},q=function(t,e){_(t);for(var n,r=v(e=b(e)),i=0,a=r.length;a>i;)W(t,n=r[i++],e[n]);return t},X=function(t,e){return void 0===e?A(t):q(A(t),e)},$=function(t){var e=N.call(this,t=E(t,!0));return!(this===j&&i(F,t)&&!i(B,t))&&(!(e||!i(this,t)||!i(F,t)||i(this,O)&&this[O][t])||e)},Z=function(t,e){if(t=b(t),e=E(e,!0),t!==j||!i(F,e)||i(B,e)){var n=C(t,e);return!n||!i(F,e)||i(t,O)&&t[O][e]||(n.enumerable=!0),n}},Q=function(t){for(var e,n=R(b(t)),r=[],a=0;n.length>a;)i(F,e=n[a++])||e==O||e==u||r.push(e);return r},J=function(t){for(var e,n=t===j,r=R(n?B:b(t)),a=[],o=0;r.length>o;)!i(F,e=r[o++])||n&&!i(j,e)||a.push(F[e]);return a};V||(L=function(){if(this instanceof L)throw TypeError("Symbol is not a constructor!");var t=h(arguments.length>0?arguments[0]:void 0),e=function(n){this===j&&e.call(B,n),i(this,O)&&i(this[O],t)&&(this[O][t]=!1),H(this,t,w(1,n))};return a&&z&&H(j,t,{configurable:!0,set:e}),K(t)},s(L["prototype"],"toString",function(){return this._k}),T.f=Z,x.f=W,n(95).f=S.f=Q,n(52).f=$,n(78).f=J,a&&!n(50)&&s(j,"propertyIsEnumerable",$,!0),p.f=function(t){return K(f(t))}),o(o.G+o.W+o.F*!V,{Symbol:L});for(var tt="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),et=0;tt.length>et;)f(tt[et++]);for(var nt=k(f.store),rt=0;nt.length>rt;)m(nt[rt++]);o(o.S+o.F*!V,"Symbol",{for:function(t){return i(U,t+="")?U[t]:U[t]=L(t)},keyFor:function(t){if(Y(t))return g(U,t);throw TypeError(t+" is not a symbol!")},useSetter:function(){z=!0},useSimple:function(){z=!1}}),o(o.S+o.F*!V,"Object",{create:X,defineProperty:W,defineProperties:q,getOwnPropertyDescriptor:Z,getOwnPropertyNames:Q,getOwnPropertySymbols:J}),I&&o(o.S+o.F*(!V||l(function(){var t=L();return"[null]"!=P([t])||"{}"!=P({a:t})||"{}"!=P(Object(t))})),"JSON",{stringify:function(t){if(void 0!==t&&!Y(t)){for(var e,n,r=[t],i=1;arguments.length>i;)r.push(arguments[i++]);return e=r[1],"function"==typeof e&&(n=e),!n&&y(e)||(e=function(t,e){if(n&&(e=n.call(this,t,e)),!Y(e))return e}),r[1]=e,P.apply(I,r)}}}),L["prototype"][D]||n(24)(L["prototype"],D,L["prototype"].valueOf),d(L,"Symbol"),d(Math,"Math",!0),d(r.JSON,"JSON",!0)},function(t,e,n){var r=n(33),i=n(23);t.exports=function(t,e){for(var n,a=i(t),o=r(a),s=o.length,u=0;s>u;)if(a[n=o[u++]]===e)return n}},function(t,e,n){var r=n(33),i=n(78),a=n(52);t.exports=function(t){var e=r(t),n=i.f;if(n)for(var o,s=n(t),u=a.f,l=0;s.length>l;)u.call(t,o=s[l++])&&e.push(o);return e}},function(t,e,n){var r=n(23),i=n(95).f,a={}.toString,o="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],s=function(t){try{return i(t)}catch(e){return o.slice()}};t.exports.f=function(t){return o&&"[object Window]"==a.call(t)?s(t):i(r(t))}},function(t,e,n){n(77)("asyncIterator")},function(t,e,n){n(77)("observable")},function(t,e,n){n(158);var r=n(5).Object;t.exports=function(t,e,n){return r.defineProperty(t,e,n)}},function(t,e,n){var r=n(12);r(r.S+r.F*!n(19),"Object",{defineProperty:n(16).f})},function(t,e,n){n(160),t.exports=n(5).Object.setPrototypeOf},function(t,e,n){var r=n(12);r(r.S,"Object",{setPrototypeOf:n(161).set})},function(t,e,n){var r=n(17),i=n(18),a=function(t,e){if(i(t),!r(e)&&null!==e)throw TypeError(e+": can't set as prototype!")};t.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(t,e,r){try{r=n(20)(Function.call,n(79).f(Object.prototype,"__proto__").set,2),r(t,[]),e=!(t instanceof Array)}catch(i){e=!0}return function(t,n){return a(t,n),e?t.__proto__=n:r(t,n),t}}({},!1):void 0),check:a}},function(t,e,n){n(163);var r=n(5).Object;t.exports=function(t,e){return r.create(t,e)}},function(t,e,n){var r=n(12);r(r.S,"Object",{create:n(51)})},function(t,e,n){n(165),t.exports=n(5).Object.assign},function(t,e,n){var r=n(12);r(r.S+r.F,"Object",{assign:n(96)})},function(t,e,n){n(167);var r=n(5).Object;t.exports=function(t,e){return r.getOwnPropertyDescriptor(t,e)}},function(t,e,n){var r=n(23),i=n(79).f;n(69)("getOwnPropertyDescriptor",function(){return function(t,e){return i(r(t),e)}})},function(t,e,n){"use strict";Array.prototype.find||Object.defineProperty(Array.prototype,"find",{value:function(t){if(null==this)throw new TypeError('"this" is null or not defined');var e=Object(this),n=e.length>>>0;if("function"!=typeof t)throw new TypeError("predicate must be a function");for(var r=arguments[1],i=0;i<n;){var a=e[i];if(t.call(r,a,i,e))return a;i++}}})},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=e.mp4="data:video/mp4;base64,AAAAHGZ0eXBpc29tAAACAGlzb21pc28ybXA0MQAAAAhmcmVlAAAC721kYXQhEAUgpBv/wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA3pwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcCEQBSCkG//AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADengAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcAAAAsJtb292AAAAbG12aGQAAAAAAAAAAAAAAAAAAAPoAAAALwABAAABAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAB7HRyYWsAAABcdGtoZAAAAAMAAAAAAAAAAAAAAAIAAAAAAAAALwAAAAAAAAAAAAAAAQEAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAACRlZHRzAAAAHGVsc3QAAAAAAAAAAQAAAC8AAAAAAAEAAAAAAWRtZGlhAAAAIG1kaGQAAAAAAAAAAAAAAAAAAKxEAAAIAFXEAAAAAAAtaGRscgAAAAAAAAAAc291bgAAAAAAAAAAAAAAAFNvdW5kSGFuZGxlcgAAAAEPbWluZgAAABBzbWhkAAAAAAAAAAAAAAAkZGluZgAAABxkcmVmAAAAAAAAAAEAAAAMdXJsIAAAAAEAAADTc3RibAAAAGdzdHNkAAAAAAAAAAEAAABXbXA0YQAAAAAAAAABAAAAAAAAAAAAAgAQAAAAAKxEAAAAAAAzZXNkcwAAAAADgICAIgACAASAgIAUQBUAAAAAAfQAAAHz+QWAgIACEhAGgICAAQIAAAAYc3R0cwAAAAAAAAABAAAAAgAABAAAAAAcc3RzYwAAAAAAAAABAAAAAQAAAAIAAAABAAAAHHN0c3oAAAAAAAAAAAAAAAIAAAFzAAABdAAAABRzdGNvAAAAAAAAAAEAAAAsAAAAYnVkdGEAAABabWV0YQAAAAAAAAAhaGRscgAAAAAAAAAAbWRpcmFwcGwAAAAAAAAAAAAAAAAtaWxzdAAAACWpdG9vAAAAHWRhdGEAAAABAAAAAExhdmY1Ni40MC4xMDE=";e.default={mp4:r}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(0),i=function(t){return t&&t.__esModule?t:{default:t}}(r),a=n(83),o="font-weight: bold; font-size: 13px;",s="color: #ff8000;"+o,u="color: #ff0000;"+o,l=1,c=3,d=["color: #0000ff;font-weight: bold; font-size: 13px;","color: #006600;font-weight: bold; font-size: 13px;",s,u,u],h=["debug","info","warn","error","disabled"],f=function(){function t(){var e=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:l,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:c;(0,i.default)(this,t),this.kibo=new a.Kibo,this.kibo.down(["ctrl shift d"],function(){return e.onOff()}),this.BLACKLIST=["timeupdate","playback:timeupdate","playback:progress","container:hover","container:timeupdate","container:progress"],this.level=n,this.offLevel=r}return t.prototype.debug=function(t){this.log(t,0,Array.prototype.slice.call(arguments,1))},t.prototype.info=function(t){this.log(t,l,Array.prototype.slice.call(arguments,1))},t.prototype.warn=function(t){this.log(t,2,Array.prototype.slice.call(arguments,1))},t.prototype.error=function(t){this.log(t,3,Array.prototype.slice.call(arguments,1))},t.prototype.onOff=function(){this.level===this.offLevel?this.level=this.previousLevel:(this.previousLevel=this.level,this.level=this.offLevel),window.console&&window.console.log&&window.console.log("%c[Clappr.Log] set log level to "+h[this.level],s)},t.prototype.level=function(t){this.level=t},t.prototype.log=function(t,e,n){if(!(this.BLACKLIST.indexOf(n[0])>=0||e<this.level)){n||(n=t,t=null);var r=d[e],i="";t&&(i="["+t+"]"),window.console&&window.console.log&&window.console.log.apply(console,["%c["+h[e]+"]"+i,r].concat(n))}},t}();e.default=f,f.LEVEL_DEBUG=0,f.LEVEL_INFO=l,f.LEVEL_WARN=2,f.LEVEL_ERROR=3,f.getInstance=function(){return void 0===this._instance&&(this._instance=new this,this._instance.previousLevel=this._instance.level,this._instance.level=this._instance.offLevel),this._instance},f.setLevel=function(t){this.getInstance().level=t},f.debug=function(){this.getInstance().debug.apply(this.getInstance(),arguments)},f.info=function(){this.getInstance().info.apply(this.getInstance(),arguments)},f.warn=function(){this.getInstance().warn.apply(this.getInstance(),arguments)},f.error=function(){this.getInstance().error.apply(this.getInstance(),arguments)},t.exports=e["default"]},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(t){this.element=t||window.document,this.initialize()};r.KEY_NAMES_BY_CODE={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"caps_lock",27:"esc",32:"space",37:"left",38:"up",39:"right",40:"down",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12"},r.KEY_CODES_BY_NAME={},function(){for(var t in r.KEY_NAMES_BY_CODE)Object.prototype.hasOwnProperty.call(r.KEY_NAMES_BY_CODE,t)&&(r.KEY_CODES_BY_NAME[r.KEY_NAMES_BY_CODE[t]]=+t)}(),r.MODIFIERS=["shift","ctrl","alt"],r.registerEvent=function(){return document.addEventListener?function(t,e,n){t.addEventListener(e,n,!1)}:document.attachEvent?function(t,e,n){t.attachEvent("on"+e,n)}:void 0}(),r.unregisterEvent=function(){return document.removeEventListener?function(t,e,n){t.removeEventListener(e,n,!1)}:document.detachEvent?function(t,e,n){t.detachEvent("on"+e,n)}:void 0}(),r.stringContains=function(t,e){return-1!==t.indexOf(e)},r.neatString=function(t){return t.replace(/^\s+|\s+$/g,"").replace(/\s+/g," ")},r.capitalize=function(t){return t.toLowerCase().replace(/^./,function(t){return t.toUpperCase()})},r.isString=function(t){return r.stringContains(Object.prototype.toString.call(t),"String")},r.arrayIncludes=function(){return Array.prototype.indexOf?function(t,e){return-1!==t.indexOf(e)}:function(t,e){for(var n=0;n<t.length;n++)if(t[n]===e)return!0;return!1}}(),r.extractModifiers=function(t){var e,n;for(e=[],n=0;n<r.MODIFIERS.length;n++)r.stringContains(t,r.MODIFIERS[n])&&e.push(r.MODIFIERS[n]);return e},r.extractKey=function(t){var e,n;for(e=r.neatString(t).split(" "),n=0;n<e.length;n++)if(!r.arrayIncludes(r.MODIFIERS,e[n]))return e[n]},r.modifiersAndKey=function(t){var e,n;return r.stringContains(t,"any")?r.neatString(t).split(" ").slice(0,2).join(" "):(e=r.extractModifiers(t),n=r.extractKey(t),n&&!r.arrayIncludes(r.MODIFIERS,n)&&e.push(n),e.join(" "))},r.keyName=function(t){return r.KEY_NAMES_BY_CODE[t+""]},r.keyCode=function(t){return+r.KEY_CODES_BY_NAME[t]},r.prototype.initialize=function(){var t,e=this;for(this.lastKeyCode=-1,this.lastModifiers={},t=0;t<r.MODIFIERS.length;t++)this.lastModifiers[r.MODIFIERS[t]]=!1;this.keysDown={any:[]},this.keysUp={any:[]},this.downHandler=this.handler("down"),this.upHandler=this.handler("up"),r.registerEvent(this.element,"keydown",this.downHandler),r.registerEvent(this.element,"keyup",this.upHandler),r.registerEvent(window,"unload",function n(){r.unregisterEvent(e.element,"keydown",e.downHandler),r.unregisterEvent(e.element,"keyup",e.upHandler),r.unregisterEvent(window,"unload",n)})},r.prototype.handler=function(t){var e=this;return function(n){var i,a,o;for(n=n||window.event,e.lastKeyCode=n.keyCode,i=0;i<r.MODIFIERS.length;i++)e.lastModifiers[r.MODIFIERS[i]]=n[r.MODIFIERS[i]+"Key"];for(r.arrayIncludes(r.MODIFIERS,r.keyName(e.lastKeyCode))&&(e.lastModifiers[r.keyName(e.lastKeyCode)]=!0),a=e["keys"+r.capitalize(t)],i=0;i<a.any.length;i++)!1===a.any[i](n)&&n.preventDefault&&n.preventDefault();if(o=e.lastModifiersAndKey(),a[o])for(i=0;i<a[o].length;i++)!1===a[o][i](n)&&n.preventDefault&&n.preventDefault()}},r.prototype.registerKeys=function(t,e,n){var i,a,o=this["keys"+r.capitalize(t)];for(r.isString(e)&&(e=[e]),i=0;i<e.length;i++)a=e[i],a=r.modifiersAndKey(a+""),o[a]?o[a].push(n):o[a]=[n];return this},r.prototype.unregisterKeys=function(t,e,n){var i,a,o,s=this["keys"+r.capitalize(t)];for(r.isString(e)&&(e=[e]),i=0;i<e.length;i++)if(o=e[i],o=r.modifiersAndKey(o+""),null===n)delete s[o];else if(s[o])for(a=0;a<s[o].length;a++)if(String(s[o][a])===String(n)){s[o].splice(a,1);break}return this},r.prototype.off=function(t){return this.unregisterKeys("down",t,null)},r.prototype.delegate=function(t,e,n){return null!==n||void 0!==n?this.registerKeys(t,e,n):this.unregisterKeys(t,e,n)},r.prototype.down=function(t,e){return this.delegate("down",t,e)},r.prototype.up=function(t,e){return this.delegate("up",t,e)},r.prototype.lastKey=function(t){return t?this.lastModifiers[t]:r.keyName(this.lastKeyCode)},r.prototype.lastModifiersAndKey=function(){var t,e;for(t=[],e=0;e<r.MODIFIERS.length;e++)this.lastKey(r.MODIFIERS[e])&&t.push(r.MODIFIERS[e]);return r.arrayIncludes(t,this.lastKey())||t.push(this.lastKey()),t.join(" ")},e.default=r,t.exports=e["default"]},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(173),i=function(t){return t&&t.__esModule?t:{default:t}}(r);e.default=i.default,t.exports=e["default"]},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),u=n(3),l=r(u),c=n(2),d=r(c),h=n(21),f=r(h),p=n(97),m=r(p),g=function(t){function e(n){(0,a.default)(this,e);var r=(0,s.default)(this,t.call(this));return r.player=n,r._options=n.options,r}return(0,d.default)(e,t),(0,l.default)(e,[{key:"loader",get:function(){return this.player.loader}}]),e.prototype.create=function(){return this.options.loader=this.loader,this.core=new m.default(this.options),this.addCorePlugins(),this.core.createContainers(this.options),this.core},e.prototype.addCorePlugins=function(){var t=this;return this.loader.corePlugins.forEach(function(e){var n=new e(t.core);t.core.addPlugin(n),t.setupExternalInterface(n)}),this.core},e.prototype.setupExternalInterface=function(t){var e=t.getExternalInterface();for(var n in e)this.player[n]=e[n].bind(t)},e}(f.default);e.default=g,t.exports=e["default"]},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),u=n(3),l=r(u),c=n(2),d=r(c),h=n(8),f=n(4),p=r(f),m=n(6),g=r(m),v=n(30),y=r(v),_=n(29),b=r(_),E=n(175),w=r(E),A=n(99),S=r(A),T=n(37),x=r(T),k=n(57),C=r(k),M=n(9),R=r(M),L=n(190),I=r(L),P=function(t){function e(n){(0,a.default)(this,e);var r=(0,s.default)(this,t.call(this,n));return r.configureDomRecycler(),r.playerInfo=C.default.getInstance(n.playerId),r.firstResize=!0,r.plugins=[],r.containers=[],r.setupMediaControl(null),r._boundFullscreenHandler=function(){return r.handleFullscreenChange()},(0,R.default)(document).bind("fullscreenchange",r._boundFullscreenHandler),(0,R.default)(document).bind("MSFullscreenChange",r._boundFullscreenHandler),(0,R.default)(document).bind("mozfullscreenchange",r._boundFullscreenHandler),b.default.isMobile&&(0,R.default)(window).bind("resize",function(t){r.handleWindowResize(t)}),r}return(0,d.default)(e,t),(0,l.default)(e,[{key:"events",get:function(){return{webkitfullscreenchange:"handleFullscreenChange",mousemove:"showMediaControl",mouseleave:"hideMediaControl"}}},{key:"attributes",get:function(){return{"data-player":"",tabindex:9999}}},{key:"isReady",get:function(){return!!this.ready}},{key:"i18n",get:function(){return this.getPlugin("strings")||{t:function(t){return t}}}}]),e.prototype.configureDomRecycler=function(){var t=!!(this.options&&this.options.playback&&this.options.playback.recycleVideo);h.DomRecycler.configure({recycleVideo:t})},e.prototype.createContainers=function(t){var e=this;this.defer=R.default.Deferred(),this.defer.promise(this),this.containerFactory=new w.default(t,t.loader,this.i18n),this.containerFactory.createContainers().then(function(t){return e.setupContainers(t)}).then(function(t){return e.resolveOnContainersReady(t)})},e.prototype.updateSize=function(){h.Fullscreen.isFullscreen()?this.setFullscreen():this.setPlayerSize()},e.prototype.setFullscreen=function(){b.default.isiOS||(this.$el.addClass("fullscreen"),this.$el.removeAttr("style"),this.playerInfo.previousSize={width:this.options.width,height:this.options.height},this.playerInfo.currentSize={width:(0,R.default)(window).width(),height:(0,R.default)(window).height()})},e.prototype.setPlayerSize=function(){this.$el.removeClass("fullscreen"),this.playerInfo.currentSize=this.playerInfo.previousSize,this.playerInfo.previousSize={width:(0,R.default)(window).width(),height:(0,R.default)(window).height()},this.resize(this.playerInfo.currentSize)},e.prototype.resize=function(t){(0,h.isNumber)(t.height)||(0,h.isNumber)(t.width)?(this.el.style.height=t.height+"px",this.el.style.width=t.width+"px"):(this.el.style.height=""+t.height,this.el.style.width=""+t.width),this.playerInfo.previousSize={width:this.options.width,height:this.options.height},this.options.width=t.width,this.options.height=t.height,this.playerInfo.currentSize=t,this.triggerResize(this.playerInfo.currentSize)},e.prototype.enableResizeObserver=function(){var t=this,e=function(){t.playerInfo.computedSize.width==t.el.clientWidth&&t.playerInfo.computedSize.height==t.el.clientHeight||(t.playerInfo.computedSize={width:t.el.clientWidth,height:t.el.clientHeight},t.triggerResize(t.playerInfo.computedSize))};this.resizeObserverInterval=setInterval(e,500)},e.prototype.triggerResize=function(t){(this.firstResize||this.oldHeight!==t.height||this.oldWidth!==t.width)&&(x.default.trigger(this.options.playerId+":"+p.default.PLAYER_RESIZE,t),this.oldHeight=t.height,this.oldWidth=t.width,this.firstResize=!1)},e.prototype.disableResizeObserver=function(){this.resizeObserverInterval&&clearInterval(this.resizeObserverInterval)},e.prototype.resolveOnContainersReady=function(t){var e=this;R.default.when.apply(R.default,t).done(function(){e.defer.resolve(e),e.ready=!0,e.trigger(p.default.CORE_READY)})},e.prototype.addPlugin=function(t){this.plugins.push(t)},e.prototype.hasPlugin=function(t){return!!this.getPlugin(t)},e.prototype.getPlugin=function(t){return this.plugins.filter(function(e){return e.name===t})[0]},e.prototype.load=function(t,e){var n=this;this.options.mimeType=e,t=t&&t.constructor===Array?t:[t],this.containers.forEach(function(t){return t.destroy()}),this.mediaControl.container=null,this.containerFactory.options=R.default.extend(this.options,{sources:t}),this.containerFactory.createContainers().then(function(t){n.setupContainers(t)})},e.prototype.destroy=function(){this.disableResizeObserver(),this.containers.forEach(function(t){return t.destroy()}),this.plugins.forEach(function(t){return t.destroy()}),this.$el.remove(),this.mediaControl.destroy(),(0,R.default)(document).unbind("fullscreenchange",this._boundFullscreenHandler),(0,R.default)(document).unbind("MSFullscreenChange",this._boundFullscreenHandler),(0,R.default)(document).unbind("mozfullscreenchange",this._boundFullscreenHandler)},e.prototype.handleFullscreenChange=function(){this.trigger(p.default.CORE_FULLSCREEN,h.Fullscreen.isFullscreen()),this.updateSize(),this.mediaControl.show()},e.prototype.handleWindowResize=function(t){var e=(0,R.default)(window).width()>(0,R.default)(window).height()?"landscape":"portrait";this._screenOrientation!==e&&(this._screenOrientation=e,this.trigger(p.default.CORE_SCREEN_ORIENTATION_CHANGED,{event:t,orientation:this._screenOrientation}))},e.prototype.setMediaControlContainer=function(t){this.mediaControl.setContainer(t),this.mediaControl.render()},e.prototype.disableMediaControl=function(){this.mediaControl.disable(),this.$el.removeClass("nocursor")},e.prototype.enableMediaControl=function(){this.mediaControl.enable()},e.prototype.removeContainer=function(t){this.stopListening(t),this.containers=this.containers.filter(function(e){return e!==t})},e.prototype.appendContainer=function(t){this.listenTo(t,p.default.CONTAINER_DESTROYED,this.removeContainer),this.containers.push(t)},e.prototype.setupContainers=function(t){return t.map(this.appendContainer.bind(this)),this.trigger(p.default.CORE_CONTAINERS_CREATED),this.renderContainers(),this.setupMediaControl(this.getCurrentContainer()),this.render(),this.$el.appendTo(this.options.parentElement),this.containers},e.prototype.renderContainers=function(){var t=this;this.containers.map(function(e){return t.el.appendChild(e.render().el)})},e.prototype.createContainer=function(t,e){var n=this.containerFactory.createContainer(t,e);return this.appendContainer(n),this.el.appendChild(n.render().el),n},e.prototype.setupMediaControl=function(t){this.mediaControl?this.mediaControl.setContainer(t):(this.mediaControl=this.createMediaControl(R.default.extend({container:t,focusElement:this.el},this.options)),this.listenTo(this.mediaControl,p.default.MEDIACONTROL_FULLSCREEN,this.toggleFullscreen),this.listenTo(this.mediaControl,p.default.MEDIACONTROL_SHOW,this.onMediaControlShow.bind(this,!0)),this.listenTo(this.mediaControl,p.default.MEDIACONTROL_HIDE,this.onMediaControlShow.bind(this,!1)))},e.prototype.createMediaControl=function(t){return t.mediacontrol&&t.mediacontrol.external?new t.mediacontrol.external(t).render():new S.default(t).render()},e.prototype.getCurrentContainer=function(){return this.mediaControl&&this.mediaControl.container?this.mediaControl.container:this.containers[0]},e.prototype.getCurrentPlayback=function(){var t=this.getCurrentContainer();return t&&t.playback},e.prototype.getPlaybackType=function(){var t=this.getCurrentContainer();return t&&t.getPlaybackType()},e.prototype.toggleFullscreen=function(){h.Fullscreen.isFullscreen()?(h.Fullscreen.cancelFullscreen(),b.default.isiOS||this.$el.removeClass("fullscreen nocursor")):(h.Fullscreen.requestFullscreen(this.el),b.default.isiOS||this.$el.addClass("fullscreen")),this.mediaControl.show()},e.prototype.showMediaControl=function(t){this.mediaControl.show(t)},e.prototype.hideMediaControl=function(){this.mediaControl.hide(this.options.hideMediaControlDelay)},e.prototype.onMediaControlShow=function(t){this.getCurrentContainer().trigger(t?p.default.CONTAINER_MEDIACONTROL_SHOW:p.default.CONTAINER_MEDIACONTROL_HIDE),t?this.$el.removeClass("nocursor"):h.Fullscreen.isFullscreen()&&this.$el.addClass("nocursor")},e.prototype.configure=function(t){var e=this;this._options=R.default.extend(this._options,t),this.configureDomRecycler();var n=t.source||t.sources;n?this.load(n,t.mimeType||this.options.mimeType):(this.trigger(p.default.CORE_OPTIONS_CHANGE),this.containers.forEach(function(t){t.configure(e.options)}))},e.prototype.render=function(){this.$style&&this.$style.remove(),this.$style=g.default.getStyleFor(I.default,{baseUrl:this.options.baseUrl}),this.$el.append(this.$style),this.$el.append(this.mediaControl.render().el),this.options.width=this.options.width||this.$el.width(),this.options.height=this.options.height||this.$el.height();var t={width:this.options.width,height:this.options.height};return this.playerInfo.previousSize=this.playerInfo.currentSize=this.playerInfo.computedSize=t,this.updateSize(),this.previousSize={width:this.$el.width(),height:this.$el.height()},this.enableResizeObserver(),this},e}(y.default);e.default=P,t.exports=e["default"]},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(176),i=function(t){return t&&t.__esModule?t:{default:t}}(r);e.default=i.default,t.exports=e["default"]},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=n(26),a=r(i),o=n(0),s=r(o),u=n(1),l=r(u),c=n(3),d=r(c),h=n(2),f=r(h),p=n(21),m=r(p),g=n(4),v=r(g),y=n(98),_=r(y),b=n(9),E=r(b),w=function(t){function e(n,r,i){(0,s.default)(this,e);var a=(0,l.default)(this,t.call(this,n));return a._i18n=i,a.loader=r,a}return(0,f.default)(e,t),(0,d.default)(e,[{key:"options",get:function(){return this._options},set:function(t){this._options=t}}]),e.prototype.createContainers=function(){var t=this;return E.default.Deferred(function(e){e.resolve(t.options.sources.map(function(e){return t.createContainer(e)}))})},e.prototype.findPlaybackPlugin=function(t,e){var n=this;return this.loader.playbackPlugins.filter(function(r){return r.canPlay(t,e,n._options)})[0]},e.prototype.createContainer=function(t){var e=null,n=this.options.mimeType;"object"===(void 0===t?"undefined":(0,a.default)(t))?(e=t.source.toString(),t.mimeType&&(n=t.mimeType)):e=t.toString(),e.match(/^\/\//)&&(e=window.location.protocol+e);var r=E.default.extend({},this.options,{src:e,mimeType:n}),i=this.findPlaybackPlugin(e,n),o=new i(r,this._i18n);r=E.default.extend({},r,{playback:o});var s=new _.default(r,this._i18n),u=E.default.Deferred();return u.promise(s),this.addContainerPlugins(s),this.listenToOnce(s,v.default.CONTAINER_READY,function(){return u.resolve(s)}),s},e.prototype.addContainerPlugins=function(t){this.loader.containerPlugins.forEach(function(e){t.addPlugin(new e(t))})},e}(m.default);e.default=w,t.exports=e["default"]},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),u=n(3),l=r(u),c=n(2),d=r(c),h=n(4),f=r(h),p=n(30),m=r(p),g=n(6),v=r(g),y=n(178),_=r(y),b=n(9),E=r(b),w=function(t){function e(n,r){(0,a.default)(this,e);var i=(0,s.default)(this,t.call(this,n));return i._i18n=r,i.currentTime=0,i.volume=100,i.playback=n.playback,i.settings=E.default.extend({},i.playback.settings),i.isReady=!1,i.mediaControlDisabled=!1,i.plugins=[i.playback],i.bindEvents(),i}return(0,d.default)(e,t),(0,l.default)(e,[{key:"name",get:function(){return"Container"}},{key:"attributes",get:function(){return{class:"container","data-container":""}}},{key:"events",get:function(){return{click:"clicked",dblclick:"dblClicked",doubleTap:"dblClicked",contextmenu:"onContextMenu",mouseenter:"mouseEnter",mouseleave:"mouseLeave"}}},{key:"ended",get:function(){return this.playback.ended}},{key:"buffering",get:function(){return this.playback.buffering}},{key:"i18n",get:function(){return this._i18n}},{key:"hasClosedCaptionsTracks",get:function(){return this.playback.hasClosedCaptionsTracks}},{key:"closedCaptionsTracks",get:function(){return this.playback.closedCaptionsTracks}},{key:"closedCaptionsTrackId",get:function(){return this.playback.closedCaptionsTrackId},set:function(t){this.playback.closedCaptionsTrackId=t}}]),e.prototype.bindEvents=function(){this.listenTo(this.playback,f.default.PLAYBACK_PROGRESS,this.progress),this.listenTo(this.playback,f.default.PLAYBACK_TIMEUPDATE,this.timeUpdated),this.listenTo(this.playback,f.default.PLAYBACK_READY,this.ready),this.listenTo(this.playback,f.default.PLAYBACK_BUFFERING,this.onBuffering),this.listenTo(this.playback,f.default.PLAYBACK_BUFFERFULL,this.bufferfull),this.listenTo(this.playback,f.default.PLAYBACK_SETTINGSUPDATE,this.settingsUpdate),this.listenTo(this.playback,f.default.PLAYBACK_LOADEDMETADATA,this.loadedMetadata),this.listenTo(this.playback,f.default.PLAYBACK_HIGHDEFINITIONUPDATE,this.highDefinitionUpdate),this.listenTo(this.playback,f.default.PLAYBACK_BITRATE,this.updateBitrate),this.listenTo(this.playback,f.default.PLAYBACK_PLAYBACKSTATE,this.playbackStateChanged),this.listenTo(this.playback,f.default.PLAYBACK_DVR,this.playbackDvrStateChanged),this.listenTo(this.playback,f.default.PLAYBACK_MEDIACONTROL_DISABLE,this.disableMediaControl),this.listenTo(this.playback,f.default.PLAYBACK_MEDIACONTROL_ENABLE,this.enableMediaControl),this.listenTo(this.playback,f.default.PLAYBACK_ENDED,this.onEnded),this.listenTo(this.playback,f.default.PLAYBACK_PLAY,this.playing),this.listenTo(this.playback,f.default.PLAYBACK_PAUSE,this.paused),this.listenTo(this.playback,f.default.PLAYBACK_STOP,this.stopped),this.listenTo(this.playback,f.default.PLAYBACK_ERROR,this.error),this.listenTo(this.playback,f.default.PLAYBACK_ERRORPLAY,this.errorplay),this.listenTo(this.playback,f.default.PLAYBACK_SUBTITLE_AVAILABLE,this.subtitleAvailable),this.listenTo(this.playback,f.default.PLAYBACK_SUBTITLE_CHANGED,this.subtitleChanged),this.listenTo(this.playback,f.default.PLAYBACK_AUTOPLAY_MUTED,this.autoplayMuted)},e.prototype.subtitleAvailable=function(){this.trigger(f.default.CONTAINER_SUBTITLE_AVAILABLE)},e.prototype.subtitleChanged=function(t){this.trigger(f.default.CONTAINER_SUBTITLE_CHANGED,t)},e.prototype.autoplayMuted=function(){this.volume=0,this.trigger(f.default.CONTAINER_VOLUME,0)},e.prototype.playbackStateChanged=function(t){this.trigger(f.default.CONTAINER_PLAYBACKSTATE,t)},e.prototype.playbackDvrStateChanged=function(t){this.settings=this.playback.settings,this.dvrInUse=t,this.trigger(f.default.CONTAINER_PLAYBACKDVRSTATECHANGED,t)},e.prototype.updateBitrate=function(t){this.trigger(f.default.CONTAINER_BITRATE,t)},e.prototype.statsReport=function(t){this.trigger(f.default.CONTAINER_STATS_REPORT,t)},e.prototype.getPlaybackType=function(){return this.playback.getPlaybackType()},e.prototype.isDvrEnabled=function(){return!!this.playback.dvrEnabled},e.prototype.isDvrInUse=function(){return!!this.dvrInUse},e.prototype.destroy=function(){this.trigger(f.default.CONTAINER_DESTROYED,this,this.name),this.stopListening(),this.plugins.forEach(function(t){return t.destroy()}),this.$el.remove()},e.prototype.setStyle=function(t){this.$el.css(t)},e.prototype.animate=function(t,e){return this.$el.animate(t,e).promise()},e.prototype.ready=function(){this.isReady=!0,this.trigger(f.default.CONTAINER_READY,this.name)},e.prototype.isPlaying=function(){return this.playback.isPlaying()},e.prototype.getStartTimeOffset=function(){return this.playback.getStartTimeOffset()},e.prototype.getCurrentTime=function(){return this.currentTime},e.prototype.getDuration=function(){return this.playback.getDuration()},e.prototype.error=function(t){this.isReady||this.ready(),this.trigger(f.default.CONTAINER_ERROR,{error:t,container:this},this.name)},e.prototype.errorplay=function(){this.isReady||this.ready(),this.trigger(f.default.CONTAINER_ERRORPLAY,this.name)},e.prototype.loadedMetadata=function(t){this.trigger(f.default.CONTAINER_LOADEDMETADATA,t)},e.prototype.timeUpdated=function(t){this.currentTime=t.current,this.trigger(f.default.CONTAINER_TIMEUPDATE,t,this.name)},e.prototype.progress=function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];this.trigger.apply(this,[f.default.CONTAINER_PROGRESS].concat(e,[this.name]))},e.prototype.playing=function(){this.trigger(f.default.CONTAINER_PLAY,this.name)},e.prototype.paused=function(){this.trigger(f.default.CONTAINER_PAUSE,this.name)},e.prototype.play=function(){this.playback.play()},e.prototype.stop=function(){this.playback.stop(),this.currentTime=0},e.prototype.pause=function(){this.playback.pause()},e.prototype.onEnded=function(){this.trigger(f.default.CONTAINER_ENDED,this,this.name),this.currentTime=0},e.prototype.stopped=function(){this.trigger(f.default.CONTAINER_STOP)},e.prototype.clicked=function(){this.options.chromeless&&!this.options.allowUserInteraction||this.trigger(f.default.CONTAINER_CLICK,this,this.name)},e.prototype.dblClicked=function(){this.options.chromeless&&!this.options.allowUserInteraction||this.trigger(f.default.CONTAINER_DBLCLICK,this,this.name)},e.prototype.onContextMenu=function(t){this.options.chromeless&&!this.options.allowUserInteraction||this.trigger(f.default.CONTAINER_CONTEXTMENU,t,this.name)},e.prototype.seek=function(t){this.trigger(f.default.CONTAINER_SEEK,t,this.name),this.playback.seek(t)},e.prototype.seekPercentage=function(t){var e=this.getDuration();if(t>=0&&t<=100){var n=e*(t/100);this.seek(n)}},e.prototype.setVolume=function(t){this.volume=parseInt(t,10),this.trigger(f.default.CONTAINER_VOLUME,t,this.name),this.playback.volume(t)},e.prototype.fullscreen=function(){this.trigger(f.default.CONTAINER_FULLSCREEN,this.name)},e.prototype.onBuffering=function(){this.trigger(f.default.CONTAINER_STATE_BUFFERING,this.name)},e.prototype.bufferfull=function(){this.trigger(f.default.CONTAINER_STATE_BUFFERFULL,this.name)},e.prototype.addPlugin=function(t){this.plugins.push(t)},e.prototype.hasPlugin=function(t){return!!this.getPlugin(t)},e.prototype.getPlugin=function(t){return this.plugins.filter(function(e){return e.name===t})[0]},e.prototype.mouseEnter=function(){this.options.chromeless&&!this.options.allowUserInteraction||this.trigger(f.default.CONTAINER_MOUSE_ENTER)},e.prototype.mouseLeave=function(){this.options.chromeless&&!this.options.allowUserInteraction||this.trigger(f.default.CONTAINER_MOUSE_LEAVE)},e.prototype.settingsUpdate=function(){this.settings=this.playback.settings,this.trigger(f.default.CONTAINER_SETTINGSUPDATE)},e.prototype.highDefinitionUpdate=function(t){this.trigger(f.default.CONTAINER_HIGHDEFINITIONUPDATE,t)},e.prototype.isHighDefinitionInUse=function(){return this.playback.isHighDefinitionInUse()},e.prototype.disableMediaControl=function(){this.mediaControlDisabled||(this.mediaControlDisabled=!0,this.trigger(f.default.CONTAINER_MEDIACONTROL_DISABLE))},e.prototype.enableMediaControl=function(){this.mediaControlDisabled&&(this.mediaControlDisabled=!1,this.trigger(f.default.CONTAINER_MEDIACONTROL_ENABLE))},e.prototype.updateStyle=function(){!this.options.chromeless||this.options.allowUserInteraction?this.$el.removeClass("chromeless"):this.$el.addClass("chromeless")},e.prototype.configure=function(t){this._options=E.default.extend(this._options,t),this.updateStyle(),this.trigger(f.default.CONTAINER_OPTIONS_CHANGE)},e.prototype.render=function(){var t=v.default.getStyleFor(_.default);return this.$el.append(t),this.$el.append(this.playback.render().el),this.updateStyle(),this},e.prototype.openLive=function(){this.trigger(f.default.CONTAINER_OPEN_LIVE)},e.prototype.closeLive=function(){this.trigger(f.default.CONTAINER_CLOSE_LIVE)},e}(m.default);e.default=w,t.exports=e["default"]},function(t,e,n){e=t.exports=n(7)(!1),e.push([t.i,".container[data-container]{position:absolute;background-color:#000;height:100%;width:100%}.container[data-container] .chromeless{cursor:default}[data-player]:not(.nocursor) .container[data-container]:not(.chromeless).pointer-enabled{cursor:pointer}",""])},function(t,e,n){"use strict";(function(r){function i(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var a=n(56),o=i(a),s=n(0),u=i(s),l=n(1),c=i(l),d=n(3),h=i(d),f=n(2),p=i(f),m=n(8),g=n(83),v=n(4),y=i(v),_=n(6),b=i(_),E=n(30),w=i(E),A=n(29),S=i(A),T=n(37),x=i(T),k=n(10),C=i(k),M=n(13),R=i(M),L=n(9),I=i(L),P=n(181),O=i(P),D=n(182),N=i(D),U=n(183),F=i(U),B=n(184),j=i(B),V=n(185),G=i(V),z=n(102),H=i(z),K=n(186),Y=i(K),W=n(187),q=i(W),X=n(188),$=i(X),Z=n(189),Q=i(Z),J=function(t){function e(n){(0,u.default)(this,e);var r=(0,c.default)(this,t.call(this,n));r.persistConfig=r.options.persistConfig,r.container=n.container,r.currentPositionValue=null,r.currentDurationValue=null;r.persistConfig&&m.Config.restore("volume");return r.setInitialVolume(),r.keepVisible=!1,r.fullScreenOnVideoTagSupported=null,r.addEventListeners(),r.settings={left:["play","stop","pause"],right:["volume"],default:["position","seekbar","duration"]},r.container?I.default.isEmptyObject(r.container.settings)||(r.settings=I.default.extend({},r.container.settings)):r.settings={},r.userDisabled=!1,(r.container&&r.container.mediaControlDisabled||r.options.chromeless)&&r.disable(),r.stopDragHandler=function(t){return r.stopDrag(t)},r.updateDragHandler=function(t){return r.updateDrag(t)},(0,I.default)(document).bind("mouseup",r.stopDragHandler),(0,I.default)(document).bind("mousemove",r.updateDragHandler),r}return(0,p.default)(e,t),(0,h.default)(e,[{key:"name",get:function(){return"MediaControl"}},{key:"disabled",get:function(){return this.userDisabled||this.container&&this.container.getPlaybackType()===R.default.NO_OP}},{key:"attributes",get:function(){return{class:"media-control","data-media-control":""}}},{key:"events",get:function(){return{"click [data-play]":"play","click [data-pause]":"pause","click [data-playpause]":"togglePlayPause","click [data-stop]":"stop","click [data-playstop]":"togglePlayStop","click [data-fullscreen]":"toggleFullscreen","click .bar-container[data-seekbar]":"seek","click .bar-container[data-volume]":"onVolumeClick","click .drawer-icon[data-volume]":"toggleMute","mouseenter .drawer-container[data-volume]":"showVolumeBar","mouseleave .drawer-container[data-volume]":"hideVolumeBar","mousedown .bar-container[data-volume]":"startVolumeDrag","mousemove .bar-container[data-volume]":"mousemoveOnVolumeBar","mousedown .bar-scrubber[data-seekbar]":"startSeekDrag","mousemove .bar-container[data-seekbar]":"mousemoveOnSeekBar","mouseleave .bar-container[data-seekbar]":"mouseleaveOnSeekBar","mouseenter .media-control-layer[data-controls]":"setUserKeepVisible","mouseleave .media-control-layer[data-controls]":"resetUserKeepVisible"}}},{key:"template",get:function(){return(0,C.default)(N.default)}},{key:"stylesheet",get:function(){return b.default.getStyleFor(O.default,{baseUrl:this.options.baseUrl})}},{key:"volume",get:function(){return this.container&&this.container.isReady?this.container.volume:this.intendedVolume}},{key:"muted",get:function(){return 0===this.volume}}]),e.prototype.addEventListeners=function(){this.container&&(x.default.on(this.options.playerId+":"+y.default.PLAYER_RESIZE,this.playerResize,this),this.listenTo(this.container,y.default.CONTAINER_PLAY,this.changeTogglePlay),this.listenTo(this.container,y.default.CONTAINER_PAUSE,this.changeTogglePlay),this.listenTo(this.container,y.default.CONTAINER_STOP,this.changeTogglePlay),this.listenTo(this.container,y.default.CONTAINER_DBLCLICK,this.toggleFullscreen),this.listenTo(this.container,y.default.CONTAINER_TIMEUPDATE,this.onTimeUpdate),this.listenTo(this.container,y.default.CONTAINER_PROGRESS,this.updateProgressBar),this.listenTo(this.container,y.default.CONTAINER_SETTINGSUPDATE,this.settingsUpdate),this.listenTo(this.container,y.default.CONTAINER_PLAYBACKDVRSTATECHANGED,this.settingsUpdate),this.listenTo(this.container,y.default.CONTAINER_HIGHDEFINITIONUPDATE,this.highDefinitionUpdate),this.listenTo(this.container,y.default.CONTAINER_MEDIACONTROL_DISABLE,this.disable),this.listenTo(this.container,y.default.CONTAINER_MEDIACONTROL_ENABLE,this.enable),this.listenTo(this.container,y.default.CONTAINER_ENDED,this.ended),this.listenTo(this.container,y.default.CONTAINER_VOLUME,this.onVolumeChanged),this.listenTo(this.container,y.default.CONTAINER_OPTIONS_CHANGE,this.setInitialVolume),"video"===this.container.playback.el.nodeName.toLowerCase()&&this.listenToOnce(this.container,y.default.CONTAINER_LOADEDMETADATA,this.onLoadedMetadataOnVideoTag))},e.prototype.disable=function(){this.userDisabled=!0,this.hide(),this.$el.hide()},e.prototype.enable=function(){this.options.chromeless||(this.userDisabled=!1,this.show())},e.prototype.play=function(){this.container.play()},e.prototype.pause=function(){this.container.pause()},e.prototype.stop=function(){this.container.stop()},e.prototype.setInitialVolume=function(){var t=this.persistConfig?m.Config.restore("volume"):100,e=this.container&&this.container.options||this.options;this.setVolume(e.mute?0:t,!0),this._mutedVolume=t},e.prototype.onVolumeChanged=function(){this.updateVolumeUI()},e.prototype.onLoadedMetadataOnVideoTag=function(){var t=this.container.playback.el;!m.Fullscreen.fullscreenEnabled()&&t.webkitSupportsFullscreen&&(this.fullScreenOnVideoTagSupported=!0,this.settingsUpdate())},e.prototype.updateVolumeUI=function(){if(this.rendered){this.$volumeBarContainer.find(".bar-fill-2").css({});var t=this.$volumeBarContainer.width(),e=this.$volumeBarBackground.width(),n=(t-e)/2,r=e*this.volume/100+n;this.$volumeBarFill.css({width:this.volume+"%"}),this.$volumeBarScrubber.css({left:r}),this.$volumeBarContainer.find(".segmented-bar-element").removeClass("fill");var i=Math.ceil(this.volume/10);this.$volumeBarContainer.find(".segmented-bar-element").slice(0,i).addClass("fill"),this.$volumeIcon.html(""),this.$volumeIcon.removeClass("muted"),this.muted?(this.$volumeIcon.append(Y.default),this.$volumeIcon.addClass("muted")):this.$volumeIcon.append(H.default),this.applyButtonStyle(this.$volumeIcon)}},e.prototype.changeTogglePlay=function(){this.$playPauseToggle.html(""),this.$playStopToggle.html(""),this.container&&this.container.isPlaying()?(this.$playPauseToggle.append(j.default),this.$playStopToggle.append(G.default),this.trigger(y.default.MEDIACONTROL_PLAYING)):(this.$playPauseToggle.append(F.default),this.$playStopToggle.append(F.default),this.trigger(y.default.MEDIACONTROL_NOTPLAYING),S.default.isMobile&&this.show()),this.applyButtonStyle(this.$playPauseToggle),this.applyButtonStyle(this.$playStopToggle)},e.prototype.mousemoveOnSeekBar=function(t){if(this.settings.seekEnabled){var e=t.pageX-this.$seekBarContainer.offset().left-this.$seekBarHover.width()/2;this.$seekBarHover.css({left:e})}this.trigger(y.default.MEDIACONTROL_MOUSEMOVE_SEEKBAR,t)},e.prototype.mouseleaveOnSeekBar=function(t){this.trigger(y.default.MEDIACONTROL_MOUSELEAVE_SEEKBAR,t)},e.prototype.onVolumeClick=function(t){this.setVolume(this.getVolumeFromUIEvent(t))},e.prototype.mousemoveOnVolumeBar=function(t){this.draggingVolumeBar&&this.setVolume(this.getVolumeFromUIEvent(t))},e.prototype.playerResize=function(t){this.$fullscreenToggle.html(""),m.Fullscreen.isFullscreen()?this.$fullscreenToggle.append($.default):this.$fullscreenToggle.append(q.default),this.applyButtonStyle(this.$fullscreenToggle),this.$el.removeClass("w320"),(t.width<=320||this.options.hideVolumeBar)&&this.$el.addClass("w320")},e.prototype.togglePlayPause=function(){return this.container.isPlaying()?this.container.pause():this.container.play(),!1},e.prototype.togglePlayStop=function(){this.container.isPlaying()?this.container.stop():this.container.play()},e.prototype.startSeekDrag=function(t){this.settings.seekEnabled&&(this.draggingSeekBar=!0,this.$el.addClass("dragging"),this.$seekBarLoaded.addClass("media-control-notransition"),this.$seekBarPosition.addClass("media-control-notransition"),this.$seekBarScrubber.addClass("media-control-notransition"),t&&t.preventDefault())},e.prototype.startVolumeDrag=function(t){this.draggingVolumeBar=!0,this.$el.addClass("dragging"),t&&t.preventDefault()},e.prototype.stopDrag=function(t){this.draggingSeekBar&&this.seek(t),this.$el.removeClass("dragging"),this.$seekBarLoaded.removeClass("media-control-notransition"),this.$seekBarPosition.removeClass("media-control-notransition"),this.$seekBarScrubber.removeClass("media-control-notransition dragging"),this.draggingSeekBar=!1,this.draggingVolumeBar=!1},e.prototype.updateDrag=function(t){if(this.draggingSeekBar){t.preventDefault();var e=t.pageX-this.$seekBarContainer.offset().left,n=e/this.$seekBarContainer.width()*100;n=Math.min(100,Math.max(n,0)),this.setSeekPercentage(n)}else this.draggingVolumeBar&&(t.preventDefault(),this.setVolume(this.getVolumeFromUIEvent(t)))},e.prototype.getVolumeFromUIEvent=function(t){return(t.pageX-this.$volumeBarContainer.offset().left)/this.$volumeBarContainer.width()*100},e.prototype.toggleMute=function(){if(this.muted)return this.setVolume(this._mutedVolume||100),void(this._mutedVolume=null);this._mutedVolume=this.volume,this.setVolume(0)},e.prototype.setVolume=function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];t=Math.min(100,Math.max(t,0)),this.intendedVolume=t,this.persistConfig&&!n&&m.Config.persist("volume",t);var r=function(){e.container.isReady?e.container.setVolume(t):e.listenToOnce(e.container,y.default.CONTAINER_READY,function(){e.container.setVolume(t)})};this.container?r():this.listenToOnce(this,y.default.MEDIACONTROL_CONTAINERCHANGED,function(){r()})},e.prototype.toggleFullscreen=function(){this.trigger(y.default.MEDIACONTROL_FULLSCREEN,this.name),this.container.fullscreen(),this.resetUserKeepVisible()},e.prototype.setContainer=function(t){this.container&&(this.stopListening(this.container),this.fullScreenOnVideoTagSupported=null),x.default.off(this.options.playerId+":"+y.default.PLAYER_RESIZE,this.playerResize,this),this.container=t,this.setVolume(this.intendedVolume),this.changeTogglePlay(),this.addEventListeners(),this.settingsUpdate(),this.container.trigger(y.default.CONTAINER_PLAYBACKDVRSTATECHANGED,this.container.isDvrInUse()),this.container.mediaControlDisabled&&this.disable(),this.trigger(y.default.MEDIACONTROL_CONTAINERCHANGED)},e.prototype.showVolumeBar=function(){this.hideVolumeId&&clearTimeout(this.hideVolumeId),this.$volumeBarContainer.removeClass("volume-bar-hide")},e.prototype.hideVolumeBar=function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:400;this.$volumeBarContainer&&(this.draggingVolumeBar?this.hideVolumeId=setTimeout(function(){return t.hideVolumeBar()},e):(this.hideVolumeId&&clearTimeout(this.hideVolumeId),this.hideVolumeId=setTimeout(function(){return t.$volumeBarContainer.addClass("volume-bar-hide")},e)))},e.prototype.ended=function(){this.changeTogglePlay()},e.prototype.updateProgressBar=function(t){var e=t.start/t.total*100,n=t.current/t.total*100;this.$seekBarLoaded.css({left:e+"%",width:n-e+"%"})},e.prototype.onTimeUpdate=function(t){if(!this.draggingSeekBar){var e=t.current<0?t.total:t.current;this.currentPositionValue=e,this.currentDurationValue=t.total,this.renderSeekBar()}},e.prototype.renderSeekBar=function(){if(null!==this.currentPositionValue&&null!==this.currentDurationValue){this.currentSeekBarPercentage=100,(this.container.getPlaybackType()!==R.default.LIVE||this.container.isDvrInUse())&&(this.currentSeekBarPercentage=this.currentPositionValue/this.currentDurationValue*100),this.setSeekPercentage(this.currentSeekBarPercentage);var t=(0,m.formatTime)(this.currentPositionValue),e=(0,m.formatTime)(this.currentDurationValue);t!==this.displayedPosition&&(this.$position.text(t),this.displayedPosition=t),e!==this.displayedDuration&&(this.$duration.text(e),this.displayedDuration=e)}},e.prototype.seek=function(t){if(this.settings.seekEnabled){var e=t.pageX-this.$seekBarContainer.offset().left,n=e/this.$seekBarContainer.width()*100;return n=Math.min(100,Math.max(n,0)),this.container.seekPercentage(n),this.setSeekPercentage(n),!1}},e.prototype.setKeepVisible=function(){this.keepVisible=!0},e.prototype.resetKeepVisible=function(){this.keepVisible=!1},e.prototype.setUserKeepVisible=function(){this.userKeepVisible=!0},e.prototype.resetUserKeepVisible=function(){this.userKeepVisible=!1},e.prototype.isVisible=function(){return!this.$el.hasClass("media-control-hide")},e.prototype.show=function(t){var e=this;if(!this.disabled){(!t||t.clientX!==this.lastMouseX&&t.clientY!==this.lastMouseY||navigator.userAgent.match(/firefox/i))&&(clearTimeout(this.hideId),this.$el.show(),this.trigger(y.default.MEDIACONTROL_SHOW,this.name),this.$el.removeClass("media-control-hide"),this.hideId=setTimeout(function(){return e.hide()},2e3),t&&(this.lastMouseX=t.clientX,this.lastMouseY=t.clientY))}},e.prototype.hide=function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(this.isVisible()&&(!S.default.isMobile||this.container.isPlaying())){var n=e||2e3;clearTimeout(this.hideId),(this.disabled||!1!==this.options.hideMediaControl)&&(!this.disabled&&(e||this.userKeepVisible||this.keepVisible||this.draggingSeekBar||this.draggingVolumeBar)?this.hideId=setTimeout(function(){return t.hide()},n):(this.trigger(y.default.MEDIACONTROL_HIDE,this.name),this.$el.addClass("media-control-hide"),this.hideVolumeBar(0)))}},e.prototype.settingsUpdate=function(){var t=this.getSettings();!t||this.fullScreenOnVideoTagSupported||m.Fullscreen.fullscreenEnabled()||(t.default&&(0,m.removeArrayItem)(t.default,"fullscreen"),t.left&&(0,m.removeArrayItem)(t.left,"fullscreen"),t.right&&(0,m.removeArrayItem)(t.right,"fullscreen")),(0,o.default)(this.settings)!==(0,o.default)(t)&&(this.settings=t,this.render())},e.prototype.getSettings=function(){return I.default.extend(!0,{},this.container.settings)},e.prototype.highDefinitionUpdate=function(t){},e.prototype.createCachedElements=function(){var t=this.$el.find(".media-control-layer");this.$duration=t.find(".media-control-indicator[data-duration]"),this.$fullscreenToggle=t.find("button.media-control-button[data-fullscreen]"),this.$playPauseToggle=t.find("button.media-control-button[data-playpause]"),this.$playStopToggle=t.find("button.media-control-button[data-playstop]"),this.$position=t.find(".media-control-indicator[data-position]"),this.$seekBarContainer=t.find(".bar-container[data-seekbar]"),this.$seekBarHover=t.find(".bar-hover[data-seekbar]"),this.$seekBarLoaded=t.find(".bar-fill-1[data-seekbar]"),this.$seekBarPosition=t.find(".bar-fill-2[data-seekbar]"),this.$seekBarScrubber=t.find(".bar-scrubber[data-seekbar]"),this.$volumeBarContainer=t.find(".bar-container[data-volume]"),this.$volumeContainer=t.find(".drawer-container[data-volume]"),this.$volumeIcon=t.find(".drawer-icon[data-volume]"),this.$volumeBarBackground=this.$el.find(".bar-background[data-volume]"),this.$volumeBarFill=this.$el.find(".bar-fill-1[data-volume]"),this.$volumeBarScrubber=this.$el.find(".bar-scrubber[data-volume]"),this.$hdIndicator=this.$el.find("button.media-control-button[data-hd-indicator]"),this.resetIndicators(),this.initializeIcons()},e.prototype.resetIndicators=function(){this.displayedPosition=this.$position.text(),this.displayedDuration=this.$duration.text()},e.prototype.initializeIcons=function(){var t=this.$el.find(".media-control-layer");t.find("button.media-control-button[data-play]").append(F.default),t.find("button.media-control-button[data-pause]").append(j.default),t.find("button.media-control-button[data-stop]").append(G.default),this.$playPauseToggle.append(F.default),this.$playStopToggle.append(F.default),this.$volumeIcon.append(H.default),this.$fullscreenToggle.append(q.default),this.$hdIndicator.append(Q.default)},e.prototype.setSeekPercentage=function(t){t=Math.max(Math.min(t,100),0),this.displayedSeekBarPercentage!==t&&(this.displayedSeekBarPercentage=t,this.$seekBarPosition.removeClass("media-control-notransition"),this.$seekBarScrubber.removeClass("media-control-notransition"),this.$seekBarPosition.css({width:t+"%"}),this.$seekBarScrubber.css({left:t+"%"}))},e.prototype.seekRelative=function(t){if(this.settings.seekEnabled){var e=this.container.getCurrentTime(),n=this.container.getDuration(),r=Math.min(Math.max(e+t,0),n);r=Math.min(100*r/n,100),this.container.seekPercentage(r)}},e.prototype.bindKeyAndShow=function(t,e){var n=this;this.kibo.down(t,function(){return n.show(),e()})},e.prototype.bindKeyEvents=function(){var t=this;this.unbindKeyEvents(),this.kibo=new g.Kibo(this.options.focusElement),this.bindKeyAndShow("space",function(){return t.togglePlayPause()}),this.bindKeyAndShow("left",function(){return t.seekRelative(-5)}),this.bindKeyAndShow("right",function(){return t.seekRelative(5)}),this.bindKeyAndShow("shift left",function(){return t.seekRelative(-10)}),this.bindKeyAndShow("shift right",function(){return t.seekRelative(10)}),this.bindKeyAndShow("shift ctrl left",function(){return t.seekRelative(-15)}),this.bindKeyAndShow("shift ctrl right",function(){return t.seekRelative(15)}),["1","2","3","4","5","6","7","8","9","0"].forEach(function(e){t.bindKeyAndShow(e,function(){return t.settings.seekEnabled&&t.container.seekPercentage(10*e)})})},e.prototype.unbindKeyEvents=function(){this.kibo&&(this.kibo.off("space"),this.kibo.off("left"),this.kibo.off("right"),this.kibo.off("shift left"),this.kibo.off("shift right"),this.kibo.off("shift ctrl left"),this.kibo.off("shift ctrl right"),this.kibo.off(["1","2","3","4","5","6","7","8","9","0"]))},e.prototype.parseColors=function(){if(this.options.mediacontrol){this.buttonsColor=this.options.mediacontrol.buttons;var t=this.options.mediacontrol.seekbar;this.$el.find(".bar-fill-2[data-seekbar]").css("background-color",t),this.$el.find(".media-control-icon svg path").css("fill",this.buttonsColor),this.$el.find(".segmented-bar-element[data-volume]").css("boxShadow","inset 2px 0 0 "+this.buttonsColor)}},e.prototype.applyButtonStyle=function(t){this.buttonsColor&&t&&(0,I.default)(t).find("svg path").css("fill",this.buttonsColor)},e.prototype.destroy=function(){this.remove(),(0,I.default)(document).unbind("mouseup",this.stopDragHandler),(0,I.default)(document).unbind("mousemove",this.updateDragHandler),this.unbindKeyEvents()},e.prototype.render=function(){var t=this;this.$el.html(this.template({settings:this.settings})),this.$el.append(this.stylesheet),this.createCachedElements(),this.$playPauseToggle.addClass("paused"),this.$playStopToggle.addClass("stopped"),this.changeTogglePlay(),this.hideId=setTimeout(function(){return t.hide()},1e3),this.disabled&&this.hide(),S.default.isSafari&&S.default.isMobile&&(S.default.version<10?this.$volumeContainer.css("display","none"):this.$volumeBarContainer.css("display","none")),this.$seekBarPosition.addClass("media-control-notransition"),this.$seekBarScrubber.addClass("media-control-notransition");var e=0;return this.displayedSeekBarPercentage&&(e=this.displayedSeekBarPercentage),this.displayedSeekBarPercentage=null,this.setSeekPercentage(e),r.nextTick(function(){t.settings.seekEnabled||t.$seekBarContainer.addClass("seek-disabled"),S.default.isMobile||t.options.disableKeyboardShortcuts||t.bindKeyEvents(),t.playerResize({width:t.options.width,height:t.options.height}),t.hideVolumeBar(0)}),this.parseColors(),this.highDefinitionUpdate(),this.rendered=!0,this.updateVolumeUI(),this.trigger(y.default.MEDIACONTROL_RENDERED),this},e}(w.default);e.default=J,J.extend=function(t){return(0,m.extend)(J,t)},t.exports=e["default"]}).call(e,n(84))},function(t,e,n){var r=n(5),i=r.JSON||(r.JSON={stringify:JSON.stringify});t.exports=function(t){return i.stringify.apply(i,arguments)}},function(t,e,n){var r=n(100);e=t.exports=n(7)(!1),e.push([t.i,".media-control-notransition{-webkit-transition:none!important;-moz-transition:none!important;transition:none!important}.media-control[data-media-control]{position:absolute;width:100%;height:100%;z-index:9999;pointer-events:none}.media-control[data-media-control].dragging{pointer-events:auto;cursor:-webkit-grabbing!important;cursor:grabbing!important;cursor:url("+r(n(101))+"),move}.media-control[data-media-control].dragging *{cursor:-webkit-grabbing!important;cursor:grabbing!important;cursor:url("+r(n(101))+'),move}.media-control[data-media-control] .media-control-background[data-background]{position:absolute;height:40%;width:100%;bottom:0;background:-webkit-linear-gradient(transparent,rgba(32,32,32,.9));background:linear-gradient(transparent,rgba(32,32,32,.9));-webkit-transition:opacity .6s ease-out;-moz-transition:opacity .6s ease-out;transition:opacity .6s ease-out}.media-control[data-media-control] .media-control-icon{line-height:0;letter-spacing:0;speak:none;color:#fff;opacity:.5;vertical-align:middle;text-align:left;-webkit-transition:all .1s ease;-moz-transition:all .1s ease;transition:all .1s ease}.media-control[data-media-control] .media-control-icon:hover{color:#fff;opacity:.75;text-shadow:hsla(0,0%,100%,.8) 0 0 5px}.media-control[data-media-control].media-control-hide .media-control-background[data-background]{opacity:0}.media-control[data-media-control].media-control-hide .media-control-layer[data-controls]{bottom:-50px}.media-control[data-media-control].media-control-hide .media-control-layer[data-controls] .bar-container[data-seekbar] .bar-scrubber[data-seekbar]{opacity:0}.media-control[data-media-control] .media-control-layer[data-controls]{position:absolute;bottom:7px;width:100%;height:32px;font-size:0;vertical-align:middle;pointer-events:auto;-webkit-transition:bottom .4s ease-out;-moz-transition:bottom .4s ease-out;transition:bottom .4s ease-out}.media-control[data-media-control] .media-control-layer[data-controls] .media-control-left-panel[data-media-control]{position:absolute;top:0;left:4px;height:100%}.media-control[data-media-control] .media-control-layer[data-controls] .media-control-center-panel[data-media-control]{height:100%;text-align:center;line-height:32px}.media-control[data-media-control] .media-control-layer[data-controls] .media-control-right-panel[data-media-control]{position:absolute;top:0;right:4px;height:100%}.media-control[data-media-control] .media-control-layer[data-controls] button.media-control-button{background-color:transparent;border:0;margin:0 6px;padding:0;cursor:pointer;display:inline-block;width:32px;height:100%}.media-control[data-media-control] .media-control-layer[data-controls] button.media-control-button svg{width:100%;height:22px}.media-control[data-media-control] .media-control-layer[data-controls] button.media-control-button svg path{fill:#fff}.media-control[data-media-control] .media-control-layer[data-controls] button.media-control-button:focus{outline:none}.media-control[data-media-control] .media-control-layer[data-controls] button.media-control-button[data-pause],.media-control[data-media-control] .media-control-layer[data-controls] button.media-control-button[data-play],.media-control[data-media-control] .media-control-layer[data-controls] button.media-control-button[data-stop]{float:left;height:100%}.media-control[data-media-control] .media-control-layer[data-controls] button.media-control-button[data-fullscreen]{float:right;background-color:transparent;border:0;height:100%}.media-control[data-media-control] .media-control-layer[data-controls] button.media-control-button[data-hd-indicator]{background-color:transparent;border:0;cursor:default;display:none;float:right;height:100%}.media-control[data-media-control] .media-control-layer[data-controls] button.media-control-button[data-hd-indicator].enabled{display:block;opacity:1}.media-control[data-media-control] .media-control-layer[data-controls] button.media-control-button[data-hd-indicator].enabled:hover{opacity:1;text-shadow:none}.media-control[data-media-control] .media-control-layer[data-controls] button.media-control-button[data-playpause],.media-control[data-media-control] .media-control-layer[data-controls] button.media-control-button[data-playstop]{float:left}.media-control[data-media-control] .media-control-layer[data-controls] .media-control-indicator[data-duration],.media-control[data-media-control] .media-control-layer[data-controls] .media-control-indicator[data-position]{display:inline-block;font-size:9px;color:#fff;cursor:default;line-height:32px;position:relative}.media-control[data-media-control] .media-control-layer[data-controls] .media-control-indicator[data-position]{margin:0 2px}.media-control[data-media-control] .media-control-layer[data-controls] .media-control-indicator[data-duration]{color:hsla(0,0%,100%,.5);margin-right:2px}.media-control[data-media-control] .media-control-layer[data-controls] .media-control-indicator[data-duration]:before{content:"/";margin-right:2px}.media-control[data-media-control] .media-control-layer[data-controls] .bar-container[data-seekbar]{position:absolute;top:-20px;left:0;display:inline-block;vertical-align:middle;width:100%;height:25px;cursor:pointer}.media-control[data-media-control] .media-control-layer[data-controls] .bar-container[data-seekbar] .bar-background[data-seekbar]{width:100%;height:3px;position:relative;top:11px;background-color:#666}.media-control[data-media-control] .media-control-layer[data-controls] .bar-container[data-seekbar] .bar-background[data-seekbar] .bar-fill-1[data-seekbar]{position:absolute;top:0;left:0;width:0;height:100%;background-color:#c2c2c2;-webkit-transition:all .1s ease-out;-moz-transition:all .1s ease-out;transition:all .1s ease-out}.media-control[data-media-control] .media-control-layer[data-controls] .bar-container[data-seekbar] .bar-background[data-seekbar] .bar-fill-2[data-seekbar]{position:absolute;top:0;left:0;width:0;height:100%;background-color:#cd2626;-webkit-transition:all .1s ease-out;-moz-transition:all .1s ease-out;transition:all .1s ease-out}.media-control[data-media-control] .media-control-layer[data-controls] .bar-container[data-seekbar] .bar-background[data-seekbar] .bar-hover[data-seekbar]{opacity:0;position:absolute;top:-3px;width:5px;height:7px;background-color:hsla(0,0%,100%,.5);-webkit-transition:opacity .1s ease;-moz-transition:opacity .1s ease;transition:opacity .1s ease}.media-control[data-media-control] .media-control-layer[data-controls] .bar-container[data-seekbar]:hover .bar-background[data-seekbar] .bar-hover[data-seekbar]{opacity:1}.media-control[data-media-control] .media-control-layer[data-controls] .bar-container[data-seekbar].seek-disabled{cursor:default}.media-control[data-media-control] .media-control-layer[data-controls] .bar-container[data-seekbar].seek-disabled:hover .bar-background[data-seekbar] .bar-hover[data-seekbar]{opacity:0}.media-control[data-media-control] .media-control-layer[data-controls] .bar-container[data-seekbar] .bar-scrubber[data-seekbar]{position:absolute;-webkit-transform:translateX(-50%);-moz-transform:translateX(-50%);-ms-transform:translateX(-50%);-o-transform:translateX(-50%);transform:translateX(-50%);top:2px;left:0;width:20px;height:20px;opacity:1;-webkit-transition:all .1s ease-out;-moz-transition:all .1s ease-out;transition:all .1s ease-out}.media-control[data-media-control] .media-control-layer[data-controls] .bar-container[data-seekbar] .bar-scrubber[data-seekbar] .bar-scrubber-icon[data-seekbar]{position:absolute;left:6px;top:6px;width:8px;height:8px;border-radius:10px;box-shadow:0 0 0 3px hsla(0,0%,100%,.2);background-color:#fff}.media-control[data-media-control] .media-control-layer[data-controls] .drawer-container[data-volume]{float:right;display:inline-block;height:32px;cursor:pointer;margin:0 6px;box-sizing:border-box}.media-control[data-media-control] .media-control-layer[data-controls] .drawer-container[data-volume] .drawer-icon-container[data-volume]{float:left;bottom:0}.media-control[data-media-control] .media-control-layer[data-controls] .drawer-container[data-volume] .drawer-icon-container[data-volume] .drawer-icon[data-volume]{background-color:transparent;border:0;box-sizing:content-box;width:24px;height:24px;opacity:.5}.media-control[data-media-control] .media-control-layer[data-controls] .drawer-container[data-volume] .drawer-icon-container[data-volume] .drawer-icon[data-volume]:hover{opacity:.75}.media-control[data-media-control] .media-control-layer[data-controls] .drawer-container[data-volume] .drawer-icon-container[data-volume] .drawer-icon[data-volume] svg{height:24px;position:relative;top:4px}.media-control[data-media-control] .media-control-layer[data-controls] .drawer-container[data-volume] .drawer-icon-container[data-volume] .drawer-icon[data-volume] svg path{fill:#fff}.media-control[data-media-control] .media-control-layer[data-controls] .drawer-container[data-volume] .drawer-icon-container[data-volume] .drawer-icon[data-volume].muted svg{margin-left:2px}.media-control[data-media-control] .media-control-layer[data-controls] .drawer-container[data-volume] .bar-container[data-volume]{float:left;position:relative;overflow:hidden;top:6px;width:60px;height:18px;padding:3px 0;-webkit-transition:width .2s ease-out;-moz-transition:width .2s ease-out;transition:width .2s ease-out}.media-control[data-media-control] .media-control-layer[data-controls] .drawer-container[data-volume] .bar-container[data-volume] .bar-background[data-volume]{height:3px;position:relative;top:6px;margin:0 3px;background-color:#666}.media-control[data-media-control] .media-control-layer[data-controls] .drawer-container[data-volume] .bar-container[data-volume] .bar-background[data-volume] .bar-fill-1[data-volume]{position:absolute;top:0;left:0;width:0;height:100%;background-color:#c2c2c2;-webkit-transition:all .1s ease-out;-moz-transition:all .1s ease-out;transition:all .1s ease-out}.media-control[data-media-control] .media-control-layer[data-controls] .drawer-container[data-volume] .bar-container[data-volume] .bar-background[data-volume] .bar-fill-2[data-volume]{position:absolute;top:0;left:0;width:0;height:100%;background-color:#005aff;-webkit-transition:all .1s ease-out;-moz-transition:all .1s ease-out;transition:all .1s ease-out}.media-control[data-media-control] .media-control-layer[data-controls] .drawer-container[data-volume] .bar-container[data-volume] .bar-background[data-volume] .bar-hover[data-volume]{opacity:0;position:absolute;top:-3px;width:5px;height:7px;background-color:hsla(0,0%,100%,.5);-webkit-transition:opacity .1s ease;-moz-transition:opacity .1s ease;transition:opacity .1s ease}.media-control[data-media-control] .media-control-layer[data-controls] .drawer-container[data-volume] .bar-container[data-volume] .bar-scrubber[data-volume]{position:absolute;-webkit-transform:translateX(-50%);-moz-transform:translateX(-50%);-ms-transform:translateX(-50%);-o-transform:translateX(-50%);transform:translateX(-50%);top:2px;left:0;width:12px;height:12px;opacity:1;-webkit-transition:all .1s ease-out;-moz-transition:all .1s ease-out;transition:all .1s ease-out}.media-control[data-media-control] .media-control-layer[data-controls] .drawer-container[data-volume] .bar-container[data-volume] .bar-scrubber[data-volume] .bar-scrubber-icon[data-volume]{position:absolute;left:6px;top:6px;width:6px;height:6px;border-radius:6px;box-shadow:0 0 0 3px hsla(0,0%,100%,.2);background-color:#fff}.media-control[data-media-control] .media-control-layer[data-controls] .drawer-container[data-volume] .bar-container[data-volume] .segmented-bar-element[data-volume]{float:left;width:4px;padding-left:2px;height:12px;opacity:.5;box-shadow:inset 2px 0 0 #fff;-webkit-transition:-webkit-transform .2s ease-out;-moz-transition:-moz-transform .2s ease-out;transition:transform .2s ease-out}.media-control[data-media-control] .media-control-layer[data-controls] .drawer-container[data-volume] .bar-container[data-volume] .segmented-bar-element[data-volume].fill{box-shadow:inset 2px 0 0 #fff;opacity:1}.media-control[data-media-control] .media-control-layer[data-controls] .drawer-container[data-volume] .bar-container[data-volume] .segmented-bar-element[data-volume]:first-of-type{padding-left:0}.media-control[data-media-control] .media-control-layer[data-controls] .drawer-container[data-volume] .bar-container[data-volume] .segmented-bar-element[data-volume]:hover{-webkit-transform:scaleY(1.5);-moz-transform:scaleY(1.5);-ms-transform:scaleY(1.5);-o-transform:scaleY(1.5);transform:scaleY(1.5)}.media-control[data-media-control].w320 .media-control-layer[data-controls] .drawer-container[data-volume] .bar-container[data-volume].volume-bar-hide{width:0;height:12px;top:9px;padding:0}',""])},function(t,e){t.exports='<div class="media-control-background" data-background></div>\r\n<div class="media-control-layer" data-controls>\r\n  <%  var renderBar = function(name) { %>\r\n      <div class="bar-container" data-<%= name %>>\r\n        <div class="bar-background" data-<%= name %>>\r\n          <div class="bar-fill-1" data-<%= name %>></div>\r\n          <div class="bar-fill-2" data-<%= name %>></div>\r\n          <div class="bar-hover" data-<%= name %>></div>\r\n        </div>\r\n        <div class="bar-scrubber" data-<%= name %>>\r\n          <div class="bar-scrubber-icon" data-<%= name %>></div>\r\n        </div>\r\n      </div>\r\n  <%  }; %>\r\n  <%  var renderSegmentedBar = function(name, segments) {\r\n      segments = segments || 10; %>\r\n    <div class="bar-container" data-<%= name %>>\r\n    <% for (var i = 0; i < segments; i++) { %>\r\n      <div class="segmented-bar-element" data-<%= name %>></div>\r\n    <% } %>\r\n    </div>\r\n  <% }; %>\r\n  <% var renderDrawer = function(name, renderContent) { %>\r\n      <div class="drawer-container" data-<%= name %>>\r\n        <div class="drawer-icon-container" data-<%= name %>>\r\n          <div class="drawer-icon media-control-icon" data-<%= name %>></div>\r\n          <span class="drawer-text" data-<%= name %>></span>\r\n        </div>\r\n        <% renderContent(name); %>\r\n      </div>\r\n  <% }; %>\r\n  <% var renderIndicator = function(name) { %>\r\n      <div class="media-control-indicator" data-<%= name %>></div>\r\n  <% }; %>\r\n  <% var renderButton = function(name) { %>\r\n    <button type="button" class="media-control-button media-control-icon" data-<%= name %> aria-label="<%= name %>"></button>\r\n  <% }; %>\r\n  <%  var templates = {\r\n        bar: renderBar,\r\n        segmentedBar: renderSegmentedBar,\r\n      };\r\n      var render = function(settingsList) {\r\n        settingsList.forEach(function(setting) {\r\n          if(setting === "seekbar") {\r\n            renderBar(setting);\r\n          } else if (setting === "volume") {\r\n            renderDrawer(setting, function(name) { return renderBar(name); });\r\n          } else if (setting === "duration" || setting === "position") {\r\n            renderIndicator(setting);\r\n          } else {\r\n            renderButton(setting);\r\n          }\r\n        });\r\n      }; %>\r\n  <% if (settings.default && settings.default.length) { %>\r\n  <div class="media-control-center-panel" data-media-control>\r\n    <% render(settings.default); %>\r\n  </div>\r\n  <% } %>\r\n  <% if (settings.left && settings.left.length) { %>\r\n  <div class="media-control-left-panel" data-media-control>\r\n    <% render(settings.left); %>\r\n  </div>\r\n  <% } %>\r\n  <% if (settings.right && settings.right.length) { %>\r\n  <div class="media-control-right-panel" data-media-control>\r\n    <% render(settings.right); %>\r\n  </div>\r\n  <% } %>\r\n</div>\r\n'},function(t,e){t.exports='<svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve"><path fill-rule="evenodd" clip-rule="evenodd" fill="#333333" d="M25.999,16c0,0.383-0.199,0.719-0.497,0.906 c0,0.001,0,0.002,0,0.002L7.588,27.848l0,0C7.431,27.944,7.247,28,7.05,28c-0.579,0-1.049-0.479-1.049-1.068 c0-0.004,0-0.008,0-0.012v-0.001V5.113l0.002-0.001C6.002,5.098,6.001,5.083,6.001,5.067C6.001,4.478,6.471,4,7.05,4 c0.199,0,0.385,0.057,0.543,0.155l0.001-0.001c0,0,13.371,8.166,17.909,10.938v0.001C25.801,15.281,25.999,15.616,25.999,16z"></path></svg>'},function(t,e){t.exports='<svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve"><g><g><path fill-rule="evenodd" clip-rule="evenodd" fill="#333333" d="M12,7H8C7.448,7,7,7.448,7,8v16c0,0.553,0.447,1,1,1h4 c0.553,0,1-0.447,1-1V8C13,7.448,12.553,7,12,7z M24,7h-4c-0.552,0-1,0.448-1,1v16c0,0.553,0.448,1,1,1h4c0.553,0,1-0.447,1-1V8 C25,7.448,24.553,7,24,7z"></path></g></g></svg>'},function(t,e){t.exports='<svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve"><path fill="#333333" d="M24,7H8C7.448,7,7,7.448,7,8v16c0,0.553,0.447,1,1,1h16c0.553,0,1-0.447,1-1V8C25,7.448,24.553,7,24,7z"></path></svg>'},function(t,e){t.exports='<svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve"><g><g><path fill-rule="evenodd" clip-rule="evenodd" fill="#333333" d="M23.365,22.949L8.051,7.636c-0.391-0.391-1.023-0.391-1.414,0 c-0.391,0.39-0.391,1.023,0,1.414L21.95,24.364c0.391,0.391,1.023,0.391,1.414,0S23.755,23.341,23.365,22.949z M15.99,8.667 C15.99,8.298,15.691,8,15.323,8c-0.23,0-0.433,0.117-0.553,0.294V8.292l-1.557,1.508l2.776,2.776V8.667z M6.667,12.979 C6.299,12.979,6,13.278,6,13.646v4.677c0,0.368,0.298,0.666,0.667,0.666h3.264l4.839,4.719v-0.002 C14.89,23.884,15.093,24,15.323,24c0.368,0,0.667-0.299,0.667-0.667v-1.93l-8.424-8.424H6.667z"></path></g></g></svg>'},function(t,e){t.exports='<svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve"><path fill-rule="evenodd" clip-rule="evenodd" fill="#333333" d="M22.637,24h-4.381c-0.556,0-1.005-0.362-1.005-0.92 s0.449-1.01,1.005-1.01h2.438l-4.099-4.099c-0.376-0.376-0.376-0.985,0-1.36c0.376-0.376,0.984-0.376,1.36,0l4.099,4.099v-2.433 c0-0.559,0.423-1.011,0.979-1.011c0.559,0,0.951,0.452,0.951,1.011v4.376C23.985,23.397,23.381,24,22.637,24z M14.044,15.389 L9.946,11.29v2.433c0,0.558-0.422,1.01-0.98,1.01c-0.558,0-0.949-0.452-0.949-1.01V9.347C8.016,8.603,8.618,8,9.362,8h4.381 c0.556,0,1.006,0.362,1.006,0.92s-0.45,1.01-1.006,1.01h-2.437l4.099,4.099c0.376,0.375,0.376,0.984,0,1.36 C15.029,15.765,14.419,15.765,14.044,15.389z"></path></svg>'},function(t,e){t.exports='<svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve"><path d="M17.7,16.3H22c0.6,0,1,0.4,1,0.9s-0.4,1-1,1h-2.4l4.1,4.1c0.4,0.4,0.4,1,0,1.4c-0.4,0.4-1,0.4-1.4,0l-4.1-4.1v2.4 c0,0.6-0.4,1-1,1c-0.6,0-1-0.5-1-1v-4.4C16.3,16.9,16.9,16.3,17.7,16.3z M9.7,8.3l4.1,4.1V9.9c0-0.6,0.4-1,1-1c0.6,0,0.9,0.5,0.9,1 v4.4c0,0.7-0.6,1.3-1.3,1.3H10c-0.6,0-1-0.4-1-0.9s0.5-1,1-1h2.4L8.3,9.6c-0.4-0.4-0.4-1,0-1.4C8.7,7.9,9.3,7.9,9.7,8.3z"></path></svg>'},function(t,e){t.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path fill="#010101" d="M5.375 7.062H2.637V4.26H.502v7.488h2.135V8.9h2.738v2.848h2.133V4.26H5.375v2.802zm5.97-2.81h-2.84v7.496h2.798c2.65 0 4.195-1.607 4.195-3.77v-.022c0-2.162-1.523-3.704-4.154-3.704zm2.06 3.758c0 1.21-.81 1.896-2.03 1.896h-.83V6.093h.83c1.22 0 2.03.696 2.03 1.896v.02z"></path></svg>'},function(t,e,n){var r=n(100);e=t.exports=n(7)(!1),e.push([t.i,'@font-face{font-family:Roboto;font-style:normal;font-weight:400;src:local("Roboto"),local("Roboto-Regular"),url('+r(n(191))+') format("truetype")}[data-player]{-webkit-touch-callout:none;-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:none;-ms-user-select:none;-o-user-select:none;user-select:none;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;-webkit-transform:translateZ(0);-moz-transform:translateZ(0);-ms-transform:translateZ(0);-o-transform:translateZ(0);transform:translateZ(0);position:relative;margin:0;padding:0;border:0;font-style:normal;font-weight:400;text-align:center;overflow:hidden;font-size:100%;font-family:Roboto,Open Sans,Arial,sans-serif;text-shadow:0 0 0;box-sizing:border-box}[data-player] a,[data-player] abbr,[data-player] acronym,[data-player] address,[data-player] applet,[data-player] article,[data-player] aside,[data-player] audio,[data-player] b,[data-player] big,[data-player] blockquote,[data-player] canvas,[data-player] caption,[data-player] center,[data-player] cite,[data-player] code,[data-player] dd,[data-player] del,[data-player] details,[data-player] dfn,[data-player] div,[data-player] dl,[data-player] dt,[data-player] em,[data-player] embed,[data-player] fieldset,[data-player] figcaption,[data-player] figure,[data-player] footer,[data-player] form,[data-player] h1,[data-player] h2,[data-player] h3,[data-player] h4,[data-player] h5,[data-player] h6,[data-player] header,[data-player] hgroup,[data-player] i,[data-player] iframe,[data-player] img,[data-player] ins,[data-player] kbd,[data-player] label,[data-player] legend,[data-player] li,[data-player] mark,[data-player] menu,[data-player] nav,[data-player] object,[data-player] ol,[data-player] output,[data-player] p,[data-player] pre,[data-player] q,[data-player] ruby,[data-player] s,[data-player] samp,[data-player] section,[data-player] small,[data-player] span,[data-player] strike,[data-player] strong,[data-player] sub,[data-player] summary,[data-player] sup,[data-player] table,[data-player] tbody,[data-player] td,[data-player] tfoot,[data-player] th,[data-player] thead,[data-player] time,[data-player] tr,[data-player] tt,[data-player] u,[data-player] ul,[data-player] var,[data-player] video{margin:0;padding:0;border:0;font:inherit;font-size:100%;vertical-align:baseline}[data-player] table{border-collapse:collapse;border-spacing:0}[data-player] caption,[data-player] td,[data-player] th{text-align:left;font-weight:400;vertical-align:middle}[data-player] blockquote,[data-player] q{quotes:none}[data-player] blockquote:after,[data-player] blockquote:before,[data-player] q:after,[data-player] q:before{content:"";content:none}[data-player] a img{border:none}[data-player]:focus{outline:0}[data-player] *{max-width:none;box-sizing:inherit;float:none}[data-player] div{display:block}[data-player].fullscreen{width:100%!important;height:100%!important;top:0;left:0}[data-player].nocursor{cursor:none}.pwplayer-style{display:none!important}',""])},function(t,e,n){t.exports=n.p+"38861cba61c66739c1452c3a71e39852.ttf"},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=n(55),a=r(i),o=n(0),s=r(o),u=n(1),l=r(u),c=n(2),d=r(c),h=n(21),f=r(h),p=n(57),m=r(p),g=n(38),v=r(g),y=n(108),_=r(y),b=n(109),E=r(b),w=n(112),A=r(w),S=n(113),T=r(S),x=n(205),k=r(x),C=n(216),M=r(C),R=n(247),L=r(R),I=n(251),P=r(I),O=n(255),D=r(O),N=n(257),U=r(N),F=n(126),B=r(F),j=n(264),V=r(j),G=n(127),z=r(G),H=n(268),K=r(H),Y=n(273),W=r(Y),q=n(277),X=r(q),$=n(280),Z=r($),Q=n(284),J=r(Q),tt=n(289),et=r(tt),nt=n(293),rt=r(nt),it=n(294),at=r(it),ot=n(295),st=r(ot),ut=n(130),lt=r(ut),ct=n(132),dt=r(ct),ht=n(135),ft=r(ht),pt=n(323),mt=r(pt),gt=n(136),vt=r(gt),yt=n(327),_t=r(yt),bt=n(137),Et=r(bt),wt=n(340),At=r(wt),St=n(344),Tt=r(St),xt=function(t){function e(n,r){(0,s.default)(this,e);var i=(0,l.default)(this,t.call(this));return i.playerId=r,i.playbackPlugins=[M.default,E.default,L.default,v.default,_.default,A.default,k.default,T.default],i.containerPlugins=[P.default,U.default,D.default,B.default,V.default,z.default,K.default,W.default,X.default],i.corePlugins=[Z.default,J.default,et.default,rt.default,at.default,st.default,lt.default,dt.default,ft.default,mt.default,vt.default,_t.default,Et.default,At.default,Tt.default],n&&(Array.isArray(n)||i.validateExternalPluginsType(n),i.addExternalPlugins(n)),i}return(0,d.default)(e,t),e.prototype.groupPluginsByType=function(t){return Array.isArray(t)&&(t=t.reduce(function(t,e){return t[e.type]||(t[e.type]=[]),t[e.type].push(e),t},{})),t},e.prototype.removeDups=function(t){var e=function(t,e){return t[e.prototype.name]&&delete t[e.prototype.name],t[e.prototype.name]=e,t},n=t.reduceRight(e,(0,a.default)(null)),r=[];for(var i in n)r.unshift(n[i]);return r},e.prototype.addExternalPlugins=function(t){t=this.groupPluginsByType(t),t.playback&&(this.playbackPlugins=this.removeDups(t.playback.concat(this.playbackPlugins))),t.container&&(this.containerPlugins=this.removeDups(t.container.concat(this.containerPlugins))),t.core&&(this.corePlugins=this.removeDups(t.core.concat(this.corePlugins))),m.default.getInstance(this.playerId).playbackPlugins=this.playbackPlugins},e.prototype.validateExternalPluginsType=function(t){["playback","container","core"].forEach(function(e){(t[e]||[]).forEach(function(t){var n="external "+t.type+" plugin on "+e+" array";if(t.type!==e)throw new ReferenceError(n)})})},e}(f.default);e.default=xt,t.exports=e["default"]},function(t,e,n){"use strict";(function(r){function i(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var a=n(85),o=i(a),s=n(0),u=i(s),l=n(1),c=i(l),d=n(3),h=i(d),f=n(2),p=i(f),m=n(107),g=i(m),v=n(28),y=i(v),_=n(8),b=n(13),E=i(b),w=n(6),A=i(w),S=n(29),T=i(S),x=n(4),k=i(x),C=n(27),M=i(C),R=n(197),L=i(R),I=n(9),P=i(I),O=n(10),D=i(O),N=n(198),U=i(N),F={mp4:["avc1.42E01E","avc1.58A01E","avc1.4D401E","avc1.64001E","mp4v.20.8","mp4v.20.240","mp4a.40.2"].map(function(t){return'video/mp4; codecs="'+t+', mp4a.40.2"'}),ogg:['video/ogg; codecs="theora, vorbis"','video/ogg; codecs="dirac"','video/ogg; codecs="theora, speex"'],"3gpp":['video/3gpp; codecs="mp4v.20.8, samr"'],webm:['video/webm; codecs="vp8, vorbis"'],mkv:['video/x-matroska; codecs="theora, vorbis"'],m3u8:["application/x-mpegurl"]};F["ogv"]=F["ogg"],F["3gp"]=F["3gpp"];var B={wav:["audio/wav"],mp3:["audio/mp3",'audio/mpeg;codecs="mp3"'],aac:['audio/mp4;codecs="mp4a.40.5"'],oga:["audio/ogg"]},j=(0,y.default)(B).reduce(function(t,e){return[].concat((0,g.default)(t),(0,g.default)(B[e]))},[]),V=function(t){function e(){(0,u.default)(this,e);for(var n=arguments.length,r=Array(n),i=0;i<n;i++)r[i]=arguments[i];var a=(0,c.default)(this,t.call.apply(t,[this].concat(r)));a._destroyed=!1,a._loadStarted=!1,a._playheadMoving=!1,a._playheadMovingTimer=null,a._stopped=!1,a._ccTrackId=-1,a._setupSrc(a.options.src),a.options.playback||(a.options.playback=a.options||{}),a.options.playback.disableContextMenu=a.options.playback.disableContextMenu||a.options.disableVideoTagContextMenu;var o=a.options.playback,s=o.preload||(T.default.isSafari?"auto":a.options.preload),l=void 0;return a.options.poster&&("string"==typeof a.options.poster?l=a.options.poster:"string"==typeof a.options.poster.url&&(l=a.options.poster.url)),a.autoPlayTimeout=null,P.default.extend(a.el,{muted:a.options.mute,defaultMuted:a.options.mute,loop:a.options.loop,poster:l,preload:s||"metadata",controls:(o.controls||a.options.useVideoTagDefaultControls)&&"controls",crossOrigin:o.crossOrigin,"x-webkit-playsinline":o.playInline,"x5-video-player-type":"h5-page","x5-video-player-fullscreen":!0,"webkit-playsinline":o.playInline}),o.playInline&&a.$el.attr({playsinline:"playsinline"}),o.playInline&&a.$el.attr({"x-webkit-playsinline":o.playInline}),o.playInline&&a.$el.attr({"x5-video-player-type":"h5-page"}),o.playInline&&a.$el.attr({"x5-video-player-fullscreen":!0}),o.crossOrigin&&a.$el.attr({crossorigin:o.crossOrigin}),a.settings={default:["seekbar"]},a.settings.left=["playpause","position","duration"],a.settings.right=["fullscreen","volume","hd-indicator"],o.externalTracks&&a._setupExternalTracks(o.externalTracks),a.options.autoPlay&&a.attemptAutoPlay(),a}return(0,p.default)(e,t),(0,h.default)(e,[{key:"name",get:function(){return"html5_video"}},{key:"tagName",get:function(){return this.isAudioOnly?"audio":"video"}},{key:"isAudioOnly",get:function(){var t=this.options.src,n=e._mimeTypesForUrl(t,B,this.options.mimeType);return this.options.playback&&this.options.playback.audioOnly||this.options.audioOnly||j.indexOf(n[0])>=0}},{key:"attributes",get:function(){return{"data-html5-video":""}}},{key:"events",get:function(){return{canplay:"_onCanPlay",canplaythrough:"_handleBufferingEvents",durationchange:"_onDurationChange",ended:"_onEnded",error:"_onError",loadeddata:"_onLoadedData",loadedmetadata:"_onLoadedMetadata",pause:"_onPause",playing:"_onPlaying",progress:"_onProgress",seeked:"_handleBufferingEvents",seeking:"_handleBufferingEvents",stalled:"_handleBufferingEvents",timeupdate:"_onTimeUpdate",waiting:"_onWaiting"}}},{key:"ended",get:function(){return this.el.ended}},{key:"buffering",get:function(){return!!this._bufferingState}}]),e.prototype.configure=function(e){t.prototype.configure.call(this,e),this.el.loop=!!e.loop},e.prototype.attemptAutoPlay=function(){var t=this;this.canAutoPlay(function(e,n){n&&M.default.warn(t.name,"autoplay error.",{result:e,error:n}),e?(console.log(""),r.nextTick(function(){return!t._destroyed&&t.play()})):(console.log(""),t.el.muted=!0,t.$el.attr({muted:"true"}),t.trigger(k.default.PLAYBACK_AUTOPLAY_MUTED,{}),r.nextTick(function(){return!t._destroyed&&t.play()}))})},e.prototype.canAutoPlay=function(t){this.options.disableCanAutoPlay&&t(!0,null);var e={timeout:this.options.autoPlayTimeout||500,inline:this.options.playback.playInline||!1,muted:this.options.mute||!1};T.default.isMobile&&_.DomRecycler.options.recycleVideo&&(e.element=this.el),(0,_.canAutoPlayMedia)(t,e)},e.prototype._setupExternalTracks=function(t){this._externalTracks=t.map(function(t){return{kind:t.kind||"subtitles",label:t.label,lang:t.lang,src:t.src}})},e.prototype._setupSrc=function(t){this.el.src!==t&&(this._ccIsSetup=!1,this.el.src=t,this._src=this.el.src)},e.prototype._onLoadedMetadata=function(t){if(this._handleBufferingEvents(),this.trigger(k.default.PLAYBACK_LOADEDMETADATA,{duration:t.target.duration,data:t}),this._updateSettings(),this.getPlaybackType()!==E.default.LIVE&&"undefined"!=this._options.lastplayposition&&this._options.lastplayposition>10)return this.trigger(k.default.PLAYBACK_SEEK_LASTPOSTION,this._options.lastplayposition),void this.seek(this._options.lastplayposition);var e=void 0===this._options.autoSeekFromUrl||this._options.autoSeekFromUrl;this.getPlaybackType()!==E.default.LIVE&&e&&this._checkInitialSeek()},e.prototype._onDurationChange=function(){this._updateSettings(),this._onTimeUpdate(),this._onProgress()},e.prototype._updateSettings=function(){this.getPlaybackType()===E.default.VOD||this.getPlaybackType()===E.default.AOD?this.settings.left=["playpause","position","duration"]:this.settings.left=["playstop"],this.settings.seekEnabled=this.isSeekEnabled(),this.trigger(k.default.PLAYBACK_SETTINGSUPDATE)},e.prototype.isSeekEnabled=function(){return isFinite(this.getDuration())},e.prototype.getPlaybackType=function(){var t="audio"===this.tagName?E.default.AOD:E.default.VOD;return[0,void 0,1/0].indexOf(this.el.duration)>=0?E.default.LIVE:t},e.prototype.isHighDefinitionInUse=function(){return!1},e.prototype.consent=function(){this.isPlaying()||(t.prototype.consent.call(this),this.el.load())},e.prototype.play=function(){this.trigger(k.default.PLAYBACK_PLAY_INTENT),this._stopped=!1,this._setupSrc(this._src),this._handleBufferingEvents();var t=this.el.play();t&&t.catch&&t.catch(function(){console.log("")})},e.prototype.pause=function(){this.el.pause(),this.autoPlayTimeout&&(clearTimeout(this.autoPlayTimeout),this.autoPlayTimeout=null)},e.prototype.stop=function(){this.pause(),this._stopped=!0,this.el.removeAttribute("src"),this._stopPlayheadMovingChecks(),this._handleBufferingEvents(),this.trigger(k.default.PLAYBACK_STOP)},e.prototype.volume=function(t){0===t?(this.$el.attr({muted:"true"}),this.el.muted=!0):(this.$el.attr({muted:null}),this.el.muted=!1),this.el.volume=t/100},e.prototype.mute=function(){this.el.volume=0},e.prototype.unmute=function(){this.el.volume=1},e.prototype.isMuted=function(){return!!this.el.volume},e.prototype.isPlaying=function(){return!this.el.paused&&!this.el.ended},e.prototype._startPlayheadMovingChecks=function(){null===this._playheadMovingTimer&&(this._playheadMovingTimeOnCheck=null,this._determineIfPlayheadMoving(),this._playheadMovingTimer=setInterval(this._determineIfPlayheadMoving.bind(this),500))},e.prototype._stopPlayheadMovingChecks=function(){null!==this._playheadMovingTimer&&(clearInterval(this._playheadMovingTimer),this._playheadMovingTimer=null,this._playheadMoving=!1)},e.prototype._determineIfPlayheadMoving=function(){var t=this._playheadMovingTimeOnCheck,e=this.el.currentTime;this._playheadMoving=t!==e,this._playheadMovingTimeOnCheck=e,this._handleBufferingEvents()},e.prototype._onWaiting=function(){this._loadStarted=!0,this._handleBufferingEvents()},e.prototype._onLoadedData=function(){this._loadStarted=!0,this._handleBufferingEvents()},e.prototype._onCanPlay=function(){this._handleBufferingEvents()},e.prototype._onPlaying=function(){var t=this;this._checkForClosedCaptions(),this._startPlayheadMovingChecks(),this._handleBufferingEvents(),this.trigger(k.default.PLAYBACK_PLAY),console.log("setTimeout for waitloadstart"),this.autoPlayTimeout&&clearTimeout(this.autoPlayTimeout),this.autoPlayTimeout=setTimeout(function(){return t.showPlayButton()},1500)},e.prototype.showPlayButton=function(){this.getCurrentTime()<=.1&&this.trigger(k.default.PLAYBACK_ERRORPLAY)},e.prototype._onPause=function(){this._stopPlayheadMovingChecks(),this._handleBufferingEvents(),this.trigger(k.default.PLAYBACK_PAUSE)},e.prototype._onEnded=function(){this.autoPlayTimeout&&clearTimeout(this.autoPlayTimeout),this._handleBufferingEvents(),this.trigger(k.default.PLAYBACK_ENDED,this.name)},e.prototype._handleBufferingEvents=function(){var t=!this.el.ended&&!this.el.paused,e=this._loadStarted&&!this.el.ended&&!this._stopped&&(t&&!this._playheadMoving||this.el.readyState<this.el.HAVE_FUTURE_DATA);this._bufferingState!==e&&(this._bufferingState=e,e?this.trigger(k.default.PLAYBACK_BUFFERING,this.name):this.trigger(k.default.PLAYBACK_BUFFERFULL,this.name))},e.prototype._onError=function(){this.trigger(k.default.PLAYBACK_ERROR,this.el.error,this.name)},e.prototype.destroy=function(){this._destroyed=!0,this.handleTextTrackChange&&this.el.textTracks.removeEventListener("change",this.handleTextTrackChange),this.$el.remove(),this.el.src="",this._src=null,_.DomRecycler.garbage(this.$el)},e.prototype.seek=function(t){isFinite(t)&&(this.el.currentTime=t)},e.prototype.seekPercentage=function(t){var e=this.el.duration*(t/100);this.seek(e)},e.prototype._checkInitialSeek=function(){var t=(0,_.seekStringToSeconds)();0!==t&&(this.trigger(k.default.PLAYBACK_SEEK_LASTPOSTION,t),this.seek(t))},e.prototype.getCurrentTime=function(){return this.el.currentTime},e.prototype.getDuration=function(){return this.el.duration},e.prototype._onTimeUpdate=function(){this._handleBufferingEvents(),this.getPlaybackType()===E.default.LIVE?this.trigger(k.default.PLAYBACK_TIMEUPDATE,{current:1,total:1},this.name):this.trigger(k.default.PLAYBACK_TIMEUPDATE,{current:this.el.currentTime,total:this.el.duration},this.name)},e.prototype._onProgress=function(){if(this.el.buffered.length){for(var t=[],e=0,n=0;n<this.el.buffered.length;n++)t=[].concat((0,g.default)(t),[{start:this.el.buffered.start(n),end:this.el.buffered.end(n)}]),this.el.currentTime>=t[n].start&&this.el.currentTime<=t[n].end&&(e=n);var r={start:t[e].start,current:t[e].end,total:this.el.duration};this.trigger(k.default.PLAYBACK_PROGRESS,r,t)}},e.prototype._typeFor=function(t){var n=e._mimeTypesForUrl(t,F,this.options.mimeType);return 0==n.length&&(n=e._mimeTypesForUrl(t,B,this.options.mimeType)),(n[0]||"").split(";")[0]},e.prototype._ready=function(){this._isReadyState||(this._isReadyState=!0,this.trigger(k.default.PLAYBACK_READY,this.name))},e.prototype._checkForClosedCaptions=function(){if(this.isHTML5Video&&!this._ccIsSetup){if(this.hasClosedCaptionsTracks){this.trigger(k.default.PLAYBACK_SUBTITLE_AVAILABLE);var t=this.closedCaptionsTrackId;this.closedCaptionsTrackId=t,this.handleTextTrackChange=this._handleTextTrackChange.bind(this),this.el.textTracks.addEventListener("change",this.handleTextTrackChange)}this._ccIsSetup=!0}},e.prototype._handleTextTrackChange=function(){var t=this.closedCaptionsTracks,e=t.find(function(t){return"showing"===t.track.mode})||{id:-1};this._ccTrackId!==e.id&&(this._ccTrackId=e.id,this.trigger(k.default.PLAYBACK_SUBTITLE_CHANGED,{id:e.id}))},e.prototype.render=function(){var t=A.default.getStyleFor(L.default);return this.options.playback.disableContextMenu&&this.$el.on("contextmenu",function(){return!1}),this._externalTracks&&this._externalTracks.length>0&&this.$el.html(this.template({tracks:this._externalTracks})),this.$el.append(t),this._ready(),this},(0,h.default)(e,[{key:"isReady",get:function(){return this._isReadyState}},{key:"isHTML5Video",get:function(){return this.name===e.prototype.name}},{key:"closedCaptionsTracks",get:function(){var t=0,e=function(){return t++};return(this.el.textTracks?(0,o.default)(this.el.textTracks):[]).filter(function(t){return"subtitles"===t.kind||"captions"===t.kind}).map(function(t){return{id:e(),name:t.label,track:t}})}},{key:"closedCaptionsTrackId",get:function(){return this._ccTrackId},set:function(t){if((0,_.isNumber)(t)){var e=this.closedCaptionsTracks,n=void 0;if(-1!==t){if(!(n=e.find(function(e){return e.id===t})))return;if("showing"===n.track.mode)return}e.filter(function(t){return"hidden"!==t.track.mode}).forEach(function(t){return t.track.mode="hidden"}),n&&(n.track.mode="showing"),this._ccTrackId=t,this.trigger(k.default.PLAYBACK_SUBTITLE_CHANGED,{id:t})}}},{key:"template",get:function(){return(0,D.default)(U.default)}}]),e}(E.default);e.default=V,V._mimeTypesForUrl=function(t,e,n){var r=(t.split("?")[0].match(/.*\.(.*)$/)||[])[1],i=n||r&&e[r.toLowerCase()]||[];return i.constructor===Array?i:[i]},V._canPlay=function(t,e,n,r){var i=V._mimeTypesForUrl(n,e,r),a=document.createElement(t);return!!i.filter(function(t){return!!a.canPlayType(t).replace(/no/,"")})[0]},V.canPlay=function(t,e){return V._canPlay("audio",B,t,e)||V._canPlay("video",F,t,e)},t.exports=e["default"]}).call(e,n(84))},function(t,e,n){n(34),n(195),t.exports=n(5).Array.from},function(t,e,n){"use strict";var r=n(20),i=n(12),a=n(32),o=n(104),s=n(105),u=n(48),l=n(196),c=n(86);i(i.S+i.F*!n(106)(function(t){Array.from(t)}),"Array",{from:function(t){var e,n,i,d,h=a(t),f="function"==typeof this?this:Array,p=arguments.length,m=p>1?arguments[1]:void 0,g=void 0!==m,v=0,y=c(h);if(g&&(m=r(m,p>2?arguments[2]:void 0,2)),void 0==y||f==Array&&s(y))for(e=u(h.length),n=new f(e);e>v;v++)l(n,v,g?m(h[v],v):h[v]);else for(d=y.call(h),n=new f;!(i=d.next()).done;v++)l(n,v,g?o(d,m,[i.value,v],!0):i.value);return n.length=v,n}})},function(t,e,n){"use strict";var r=n(16),i=n(42);t.exports=function(t,e,n){e in t?r.f(t,e,i(0,n)):t[e]=n}},function(t,e,n){e=t.exports=n(7)(!1),e.push([t.i,"[data-html5-video]{position:absolute;height:100%;width:100%;display:block}",""])},function(t,e){t.exports='<% for (var i = 0; i < tracks.length; i++) { %>\r\n  <track data-html5-video-track="<%= i %>" kind="<%= tracks[i].kind %>" label="<%= tracks[i].label %>" srclang="<%= tracks[i].lang %>" src="<%= tracks[i].src %>" />\r\n<% }; %>\r\n'},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(3),s=r(o),u=n(1),l=r(u),c=n(2),d=r(c),h=n(4),f=r(h),p=n(13),m=r(p),g=n(38),v=r(g),y=function(t){function e(){return(0,a.default)(this,e),(0,l.default)(this,t.apply(this,arguments))}return(0,d.default)(e,t),e.prototype.updateSettings=function(){this.settings.left=["playpause","position","duration"],this.settings.seekEnabled=this.isSeekEnabled(),this.trigger(f.default.PLAYBACK_SETTINGSUPDATE)},e.prototype.getPlaybackType=function(){return m.default.AOD},(0,s.default)(e,[{key:"name",get:function(){return"html5_audio"}},{key:"tagName",get:function(){return"audio"}},{key:"isAudioOnly",get:function(){return!0}}]),e}(v.default);e.default=y,y.canPlay=function(t,e){var n={wav:["audio/wav"],mp3:["audio/mp3",'audio/mpeg;codecs="mp3"'],aac:['audio/mp4;codecs="mp4a.40.5"'],oga:["audio/ogg"]};return v.default._canPlay("audio",n,t,e)},t.exports=e["default"]},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),u=n(3),l=r(u),c=n(2),d=r(c),h=n(13),f=r(h),p=n(6),m=r(p),g=n(201),v=r(g),y=n(4),_=r(y),b=function(t){function e(n){(0,a.default)(this,e);var r=(0,s.default)(this,t.call(this,n));return r.el.src=n.src,r}return(0,d.default)(e,t),e.prototype.getPlaybackType=function(){return f.default.NO_OP},(0,l.default)(e,[{key:"name",get:function(){return"html_img"}},{key:"tagName",get:function(){return"img"}},{key:"attributes",get:function(){return{"data-html-img":""}}},{key:"events",get:function(){return{load:"_onLoad",abort:"_onError",error:"_onError"}}}]),e.prototype.render=function(){var t=m.default.getStyleFor(v.default);return this.$el.append(t),this.trigger(_.default.PLAYBACK_READY,this.name),this},e.prototype._onLoad=function(){this.trigger(_.default.PLAYBACK_ENDED,this.name)},e.prototype._onError=function(t){var e="error"===t.type?"load error":"loading aborted";this.trigger(_.default.PLAYBACK_ERROR,{message:e},this.name)},e}(f.default);e.default=b,b.canPlay=function(t){return/\.(png|jpg|jpeg|gif|bmp|tiff|pgm|pnm|webp)(|\?.*)$/i.test(t)},t.exports=e["default"]},function(t,e,n){e=t.exports=n(7)(!1),e.push([t.i,"[data-html-img]{max-width:100%;max-height:100%}",""])},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),u=n(3),l=r(u),c=n(2),d=r(c),h=n(8),f=n(13),p=r(f),m=n(10),g=r(m),v=n(6),y=r(v),_=n(4),b=r(_),E=n(203),w=r(E),A=n(204),S=r(A),T=function(t){function e(){(0,a.default)(this,e);for(var n=arguments.length,r=Array(n),i=0;i<n;i++)r[i]=arguments[i];var o=(0,s.default)(this,t.call.apply(t,[this].concat(r)));return o._noiseFrameNum=-1,o._started=!1,o}return(0,d.default)(e,t),(0,l.default)(e,[{key:"name",get:function(){return"no_op"}},{key:"template",get:function(){return(0,g.default)(S.default)}},{key:"attributes",get:function(){return{"data-no-op":""}}}]),e.prototype.render=function(){var t=y.default.getStyleFor(w.default),e=this.options.playbackNotSupportedMessage||this.i18n.t("playback_not_supported");this.$el.html(this.template({message:e})),this.$el.append(t),this.trigger(b.default.PLAYBACK_READY,this.name);var n=!(!this.options.poster||!this.options.poster.showForNoOp);return!this.options.autoPlay&&n||this.play(),this},e.prototype.play=function(){this._started||(this._started=!0,this.trigger(b.default.PLAYBACK_PLAY),this._animate())},e.prototype._noise=function(){if(this._noiseFrameNum=(this._noiseFrameNum+1)%5,!this._noiseFrameNum){var t=this.context.createImageData(this.context.canvas.width,this.context.canvas.height),e=void 0;try{e=new Uint32Array(t.data.buffer)}catch(l){e=new Uint32Array(this.context.canvas.width*this.context.canvas.height*4);for(var n=t.data,r=0;r<n.length;r++)e[r]=n[r]}for(var i=e.length,a=6*Math.random()+4,o=0,s=0,u=0;u<i;){if(o<0){o=a*Math.random();s=255*Math.pow(Math.random(),.4)<<24}o-=1,e[u++]=s}this.context.putImageData(t,0,0)}},e.prototype._loop=function(){var t=this;this._stop||(this._noise(),this._animationHandle=(0,h.requestAnimationFrame)(function(){return t._loop()}))},e.prototype.destroy=function(){this._animationHandle&&((0,h.cancelAnimationFrame)(this._animationHandle),this._stop=!0)},e.prototype._animate=function(){this.canvas=this.$el.find("canvas[data-no-op-canvas]")[0],this.context=this.canvas.getContext("2d"),this._loop()},e}(p.default);e.default=T,T.canPlay=function(t){return!0},t.exports=e["default"]},function(t,e,n){e=t.exports=n(7)(!1),e.push([t.i,"[data-no-op]{position:absolute;height:100%;width:100%;text-align:center}[data-no-op] p[data-no-op-msg]{position:absolute;text-align:center;font-size:25px;left:0;right:0;color:#fff;padding:10px;top:50%;-webkit-transform:translateY(-50%);-moz-transform:translateY(-50%);-ms-transform:translateY(-50%);-o-transform:translateY(-50%);transform:translateY(-50%);max-height:100%;overflow:auto}[data-no-op] canvas[data-no-op-canvas]{background-color:#777;height:100%;width:100%}",""])},function(t,e){t.exports="<canvas data-no-op-canvas></canvas>\r\n<p data-no-op-msg><%=message%><p>\r\n"},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(206),i=function(t){return t&&t.__esModule?t:{default:t}}(r);e.default=i.default,t.exports=e["default"]},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),u=n(3),l=r(u),c=n(2),d=r(c),h=n(38),f=r(h),p=n(4),m=r(p),g=n(13),v=r(g),y=n(27),_=r(y),b=n(207),E=r(b),w=["video/flv","video/x-flv"],A=function(t){function e(){(0,a.default)(this,e);for(var n=arguments.length,r=Array(n),i=0;i<n;i++)r[i]=arguments[i];var o=(0,s.default)(this,t.call.apply(t,[this].concat(r)));return o._currentServerIndex=0,o.options.autoPlay&&o.play(),o}return(0,d.default)(e,t),(0,l.default)(e,[{key:"name",get:function(){return"flv"}},{key:"isHTML5Video",get:function(){return!0}},{key:"mirrorServer",get:function(){return void 0!==this.options.mirrorServers&&Array.isArray(this.options.mirrorServers)&&this.options.mirrorServers.length>0?this.options.mirrorServers[this._currentServerIndex]:""}}],[{key:"flvjs",get:function(){return E.default}}]),e.prototype._setupSrc=function(t){},e.prototype._setup=function(){var t={type:"flv",url:this.options.src},e=this.options.playback.flvjsConfig||{};this._isLive=e.isLive||!1,this._player=E.default.createPlayer(t,e),this._player.on(E.default.Events.ERROR,this._onError.bind(this)),this._player.on(E.default.Events.METADATA_ARRIVED,this._onMeta.bind(this)),this._player.attachMediaElement(this.el),this._player.load()},e.prototype._onError=function(t,e,n){var r=this;if(_.default.error("flvjs: "+t+": "+e,n),this.trigger(m.default.PLAYBACK_ERROR,{type:t,details:e,data:n},this.name),this._isLive&&t===E.default.ErrorTypes.NETWORK_ERROR&&(e===E.default.ErrorDetails.NETWORK_EXCEPTION||e===E.default.ErrorDetails.NETWORK_STATUS_CODE_INVALID||e===E.default.ErrorDetails.NETWORK_TIMEOUT||e===E.default.ErrorDetails.NETWORK_UNRECOVERABLE_EARLY_EOF)){this.changeMirrorServer();var i=this.mirrorServer;if(""!==i){var a="",o=this.options.src;a=o.indexOf("https://")>=0?o.substring(8,o.length):o.indexOf("http://")>=0?o.substring(7,o.length):o,a=a.substr(0,a.indexOf("/"));var s=a.lastIndexOf(":");s>0&&(a=a.substr(0,s)),o=o.replace(a,i),this.options.src=o,this._destroy(),this.trigger(m.default.PLAYBACK_BUFFERING,this.name),this.timer=setTimeout(function(){r.play()},100)}}},e.prototype._onMeta=function(t,e,n){_.default.error("flvjs: "+t+": "+e,n),0!=this._player.duration&&void 0!==this._player.duration||(this._isLive=!0)},e.prototype._destroy=function(){this._player&&(this._player.destroy(),delete this._player)},e.prototype.getPlaybackType=function(){return void 0===this._player?v.default.LIVE:(void 0!==this._player.duration&&this._player.duration!==1/0||(this._isLive=!0),this.options.playbacktype&&"LIVE"===this.options.playbacktype&&(this._isLive=!0),this.isReady&&this._isLive?v.default.LIVE:v.default.VOD)},e.prototype.play=function(){!this._player&&this._setup(),t.prototype.play.call(this)},e.prototype.stop=function(){t.prototype.stop.call(this),this._destroy()},e.prototype.destroy=function(){this._destroy(),t.prototype.destroy.call(this)},e.prototype.changeMirrorServer=function(){null!=this.options.mirrorServers&&this.options.mirrorServers.length>0&&++this._currentServerIndex>this.options.mirrorServers.length-1&&(this._currentServerIndex=0)},e}(f.default);e.default=A,A.canPlay=function(t,e){var n=t.split("?")[0].match(/.*\.(.*)$/)||[],r=n.length>1&&"flv"===n[1].toLowerCase()||-1!==w.indexOf(e);return!(!E.default.isSupported()||!r)},t.exports=e["default"]},function(t,e,n){"use strict";(function(r){function i(t){return t&&t.__esModule?t:{default:t}}var a,o,s,u,u,l=n(55),c=i(l),d=n(114),h=i(d),f=n(82),p=i(f),m=n(72),g=i(m),v=n(76),y=i(v),_=n(80),b=i(_),E=n(115),w=i(E),A=n(54),S=i(A),T=n(81),x=i(T),k=n(28),C=i(k),M=n(56),R=i(M),L=n(26),I=i(L);!function(n){if("object"===(0,I.default)(e)&&void 0!==t)t.exports=n();else{o=[],a=n,void 0!==(s="function"==typeof a?a.apply(e,o):a)&&(t.exports=s)}}(function(){var t;return function e(t,n,r){function i(o,s){if(!n[o]){if(!t[o]){var l="function"==typeof u&&u;if(!s&&l)return u(o,!0);if(a)return a(o,!0);var c=new Error("Cannot find module '"+o+"'");throw c.code="MODULE_NOT_FOUND",c}var d=n[o]={exports:{}};t[o][0].call(d.exports,function(e){var n=t[o][1][e];return i(n||e)},d,d.exports,e,t,n,r)}return n[o].exports}for(var a="function"==typeof u&&u,o=0;o<r.length;o++)i(r[o]);return i}({1:[function(e,n,i){(function(r,a){!function(e,r){"object"===(void 0===i?"undefined":(0,I.default)(i))&&void 0!==n?n.exports=r():"function"==typeof t&&t.amd?t(r):e.ES6Promise=r()}(this,function(){function t(t){return"function"==typeof t||"object"===(void 0===t?"undefined":(0,I.default)(t))&&null!==t}function n(t){return"function"==typeof t}function i(t){Y=t}function o(t){W=t}function s(){return void 0!==K?function(){K(l)}:u()}function u(){var t=setTimeout;return function(){return t(l,1)}}function l(){for(var t=0;t<H;t+=2){(0,J[t])(J[t+1]),J[t]=void 0,J[t+1]=void 0}H=0}function c(t,e){var n=arguments,r=this,i=new this.constructor(h);void 0===i[et]&&L(i);var a=r._state;return a?function(){var t=n[a-1];W(function(){return C(a,i,t,r._result)})}():S(r,i,t,e),i}function d(t){var e=this;if(t&&"object"===(void 0===t?"undefined":(0,I.default)(t))&&t.constructor===e)return t;var n=new e(h);return b(n,t),n}function h(){}function f(){return new TypeError("You cannot resolve a promise with itself")}function p(){return new TypeError("A promises callback cannot return that same promise.")}function m(t){try{return t.then}catch(e){return at.error=e,at}}function g(t,e,n,r){try{t.call(e,n,r)}catch(i){return i}}function v(t,e,n){W(function(t){var r=!1,i=g(n,e,function(n){r||(r=!0,e!==n?b(t,n):w(t,n))},function(e){r||(r=!0,A(t,e))},"Settle: "+(t._label||" unknown promise"));!r&&i&&(r=!0,A(t,i))},t)}function y(t,e){e._state===rt?w(t,e._result):e._state===it?A(t,e._result):S(e,void 0,function(e){return b(t,e)},function(e){return A(t,e)})}function _(t,e,r){e.constructor===t.constructor&&r===c&&e.constructor.resolve===d?y(t,e):r===at?(A(t,at.error),at.error=null):void 0===r?w(t,e):n(r)?v(t,e,r):w(t,e)}function b(e,n){e===n?A(e,f()):t(n)?_(e,n,m(n)):w(e,n)}function E(t){t._onerror&&t._onerror(t._result),T(t)}function w(t,e){t._state===nt&&(t._result=e,t._state=rt,0!==t._subscribers.length&&W(T,t))}function A(t,e){t._state===nt&&(t._state=it,t._result=e,W(E,t))}function S(t,e,n,r){var i=t._subscribers,a=i.length;t._onerror=null,i[a]=e,i[a+rt]=n,i[a+it]=r,0===a&&t._state&&W(T,t)}function T(t){var e=t._subscribers,n=t._state;if(0!==e.length){for(var r=void 0,i=void 0,a=t._result,o=0;o<e.length;o+=3)r=e[o],i=e[o+n],r?C(n,r,i,a):i(a);t._subscribers.length=0}}function x(){this.error=null}function k(t,e){try{return t(e)}catch(n){return ot.error=n,ot}}function C(t,e,r,i){var a=n(r),o=void 0,s=void 0,u=void 0,l=void 0;if(a){if(o=k(r,i),o===ot?(l=!0,s=o.error,o.error=null):u=!0,e===o)return void A(e,p())}else o=i,u=!0;e._state!==nt||(a&&u?b(e,o):l?A(e,s):t===rt?w(e,o):t===it&&A(e,o))}function M(t,e){try{e(function(e){b(t,e)},function(e){A(t,e)})}catch(n){A(t,n)}}function R(){return st++}function L(t){t[et]=st++,t._state=void 0,t._result=void 0,t._subscribers=[]}function P(t,e){this._instanceConstructor=t,this.promise=new t(h),this.promise[et]||L(this.promise),z(e)?(this._input=e,this.length=e.length,this._remaining=e.length,this._result=new Array(this.length),0===this.length?w(this.promise,this._result):(this.length=this.length||0,this._enumerate(),0===this._remaining&&w(this.promise,this._result))):A(this.promise,O())}function O(){return new Error("Array Methods must be provided an Array")}function D(t){return new P(this,t).promise}function N(t){var e=this;return new e(z(t)?function(n,r){for(var i=t.length,a=0;a<i;a++)e.resolve(t[a]).then(n,r)}:function(t,e){return e(new TypeError("You must pass an array to race."))})}function U(t){var e=this,n=new e(h);return A(n,t),n}function F(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function B(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function j(t){this[et]=R(),this._result=this._state=void 0,this._subscribers=[],h!==t&&("function"!=typeof t&&F(),this instanceof j?M(this,t):B())}function V(){var t=void 0;if(void 0!==a)t=a;else if("undefined"!=typeof self)t=self;else try{t=Function("return this")()}catch(r){throw new Error("polyfill failed because global object is unavailable in this environment")}var e=t.Promise;if(e){var n=null;try{n=Object.prototype.toString.call(e.resolve())}catch(r){}if("[object Promise]"===n&&!e.cast)return}t.Promise=j}var G=void 0;G=Array.isArray?Array.isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)};var z=G,H=0,K=void 0,Y=void 0,W=function(t,e){J[H]=t,J[H+1]=e,2===(H+=2)&&(Y?Y(l):tt())},q="undefined"!=typeof window?window:void 0,X=q||{},$=X.MutationObserver||X.WebKitMutationObserver,Z="undefined"==typeof self&&void 0!==r&&"[object process]"==={}.toString.call(r),Q="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,J=new Array(1e3),tt=void 0;tt=Z?function(){return function(){return r.nextTick(l)}}():$?function(){var t=0,e=new $(l),n=document.createTextNode("");return e.observe(n,{characterData:!0}),function(){n.data=t=++t%2}}():Q?function(){var t=new MessageChannel;return t.port1.onmessage=l,function(){return t.port2.postMessage(0)}}():void 0===q&&"function"==typeof e?function(){try{var t=e,n=t("vertx");return K=n.runOnLoop||n.runOnContext,s()}catch(r){return u()}}():u();var et=Math.random().toString(36).substring(16),nt=void 0,rt=1,it=2,at=new x,ot=new x,st=0;return P.prototype._enumerate=function(){for(var t=this.length,e=this._input,n=0;this._state===nt&&n<t;n++)this._eachEntry(e[n],n)},P.prototype._eachEntry=function(t,e){var n=this._instanceConstructor,r=n.resolve;if(r===d){var i=m(t);if(i===c&&t._state!==nt)this._settledAt(t._state,e,t._result);else if("function"!=typeof i)this._remaining--,this._result[e]=t;else if(n===j){var a=new n(h);_(a,t,i),this._willSettleAt(a,e)}else this._willSettleAt(new n(function(e){return e(t)}),e)}else this._willSettleAt(r(t),e)},P.prototype._settledAt=function(t,e,n){var r=this.promise;r._state===nt&&(this._remaining--,t===it?A(r,n):this._result[e]=n),0===this._remaining&&w(r,this._result)},P.prototype._willSettleAt=function(t,e){var n=this;S(t,void 0,function(t){return n._settledAt(rt,e,t)},function(t){return n._settledAt(it,e,t)})},j.all=D,j.race=N,j.resolve=d,j.reject=U,j._setScheduler=i,j._setAsap=o,j._asap=W,j.prototype={constructor:j,then:c,catch:function(t){return this.then(null,t)}},j.polyfill=V,j.Promise=j,j})}).call(this,e("_process"),void 0!==r?r:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{_process:3}],2:[function(t,e,n){function r(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function i(t){return"function"==typeof t}function a(t){return"number"==typeof t}function o(t){return"object"===(void 0===t?"undefined":(0,I.default)(t))&&null!==t}function s(t){return void 0===t}e.exports=r,r.EventEmitter=r,r.prototype._events=void 0,r.prototype._maxListeners=void 0,r.defaultMaxListeners=10,r.prototype.setMaxListeners=function(t){if(!a(t)||t<0||isNaN(t))throw TypeError("n must be a positive number");return this._maxListeners=t,this},r.prototype.emit=function(t){var e,n,r,a,u,l;if(this._events||(this._events={}),"error"===t&&(!this._events.error||o(this._events.error)&&!this._events.error.length)){if((e=arguments[1])instanceof Error)throw e;var c=new Error('Uncaught, unspecified "error" event. ('+e+")");throw c.context=e,c}if(n=this._events[t],s(n))return!1;if(i(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:a=Array.prototype.slice.call(arguments,1),n.apply(this,a)}else if(o(n))for(a=Array.prototype.slice.call(arguments,1),l=n.slice(),r=l.length,u=0;u<r;u++)l[u].apply(this,a);return!0},r.prototype.addListener=function(t,e){var n;if(!i(e))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",t,i(e.listener)?e.listener:e),this._events[t]?o(this._events[t])?this._events[t].push(e):this._events[t]=[this._events[t],e]:this._events[t]=e,o(this._events[t])&&!this._events[t].warned&&(n=s(this._maxListeners)?r.defaultMaxListeners:this._maxListeners)&&n>0&&this._events[t].length>n&&(this._events[t].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[t].length),"function"==typeof console.trace&&console.trace()),this},r.prototype.on=r.prototype.addListener,r.prototype.once=function(t,e){function n(){this.removeListener(t,n),r||(r=!0,e.apply(this,arguments))}if(!i(e))throw TypeError("listener must be a function");var r=!1;return n.listener=e,this.on(t,n),this},r.prototype.removeListener=function(t,e){var n,r,a,s;if(!i(e))throw TypeError("listener must be a function");if(!this._events||!this._events[t])return this;if(n=this._events[t],a=n.length,r=-1,n===e||i(n.listener)&&n.listener===e)delete this._events[t],this._events.removeListener&&this.emit("removeListener",t,e);else if(o(n)){for(s=a;s-- >0;)if(n[s]===e||n[s].listener&&n[s].listener===e){r=s;break}if(r<0)return this;1===n.length?(n.length=0,delete this._events[t]):n.splice(r,1),this._events.removeListener&&this.emit("removeListener",t,e)}return this},r.prototype.removeAllListeners=function(t){var e,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[t]&&delete this._events[t],this;if(0===arguments.length){for(e in this._events)"removeListener"!==e&&this.removeAllListeners(e);return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[t],i(n))this.removeListener(t,n);else if(n)for(;n.length;)this.removeListener(t,n[n.length-1]);return delete this._events[t],this},r.prototype.listeners=function(t){return this._events&&this._events[t]?i(this._events[t])?[this._events[t]]:this._events[t].slice():[]},r.prototype.listenerCount=function(t){if(this._events){var e=this._events[t];if(i(e))return 1;if(e)return e.length}return 0},r.listenerCount=function(t,e){return t.listenerCount(e)}},{}],3:[function(t,e,n){function r(){throw new Error("setTimeout has not been defined")}function i(){throw new Error("clearTimeout has not been defined")}function a(t){if(d===setTimeout)return setTimeout(t,0);if((d===r||!d)&&setTimeout)return d=setTimeout,setTimeout(t,0);try{return d(t,0)}catch(e){try{return d.call(null,t,0)}catch(e){return d.call(this,t,0)}}}function o(t){if(h===clearTimeout)return clearTimeout(t);if((h===i||!h)&&clearTimeout)return h=clearTimeout,clearTimeout(t);try{return h(t)}catch(e){try{return h.call(null,t)}catch(e){return h.call(this,t)}}}function s(){g&&p&&(g=!1,p.length?m=p.concat(m):v=-1,m.length&&u())}function u(){if(!g){var t=a(s);g=!0;for(var e=m.length;e;){for(p=m,m=[];++v<e;)p&&p[v].run();v=-1,e=m.length}p=null,g=!1,o(t)}}function l(t,e){this.fun=t,this.array=e}function c(){}var d,h,f=e.exports={};!function(){try{d="function"==typeof setTimeout?setTimeout:r}catch(t){d=r}try{h="function"==typeof clearTimeout?clearTimeout:i}catch(t){h=i}}();var p,m=[],g=!1,v=-1;f.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];m.push(new l(t,e)),1!==m.length||g||a(u)},l.prototype.run=function(){this.fun.apply(null,this.array)},f.title="browser",f.browser=!0,f.env={},f.argv=[],f.version="",f.versions={},f.on=c,f.addListener=c,f.once=c,f.off=c,f.removeListener=c,f.removeAllListeners=c,f.emit=c,f.prependListener=c,f.prependOnceListener=c,f.listeners=function(t){return[]},f.binding=function(t){throw new Error("process.binding is not supported")},f.cwd=function(){return"/"},f.chdir=function(t){throw new Error("process.chdir is not supported")},f.umask=function(){return 0}},{}],4:[function(t,e,n){var r=arguments[3],i=arguments[4],a=arguments[5],o=R.default;e.exports=function(t,e){function n(t){g[t]=!0;for(var e in i[t][1]){var r=i[t][1][e];g[r]||n(r)}}for(var s,u=(0,C.default)(a),l=0,c=u.length;l<c;l++){var d=u[l],h=a[d].exports;if(h===t||h&&h.default===t){s=d;break}}if(!s){s=Math.floor(Math.pow(16,8)*Math.random()).toString(16);for(var f={},l=0,c=u.length;l<c;l++){var d=u[l];f[d]=d}i[s]=[Function(["require","module","exports"],"("+t+")(self)"),f]}var p=Math.floor(Math.pow(16,8)*Math.random()).toString(16),m={};m[s]=s,i[p]=[Function(["require"],"var f = require("+o(s)+");(f.default ? f.default : f)(self);"),m];var g={};n(p);var v="("+r+")({"+(0,C.default)(g).map(function(t){return o(t)+":["+i[t][0]+","+o(i[t][1])+"]"}).join(",")+"},{},["+o(p)+"])",y=window.URL||window.webkitURL||window.mozURL||window.msURL,_=new Blob([v],{type:"text/javascript"});if(e&&e.bare)return _;var b=y.createObjectURL(_),E=new Worker(b);return E.objectURL=b,E}},{}],5:[function(t,e,n){function r(){return(0,x.default)({},i)}Object.defineProperty(n,"__esModule",{value:!0}),n.createDefaultConfig=r;var i=n.defaultConfig={enableWorker:!1,enableStashBuffer:!0,stashInitialSize:void 0,isLive:!1,lazyLoad:!0,lazyLoadMaxDuration:180,lazyLoadRecoverDuration:30,deferLoadAfterSourceOpen:!0,autoCleanupMaxBackwardDuration:180,autoCleanupMinBackwardDuration:120,statisticsInfoReportInterval:600,fixAudioTimestampGap:!0,accurateSeek:!1,seekType:"range",seekParamStart:"bstart",seekParamEnd:"bend",rangeLoadZeroStart:!1,customSeekHandler:void 0,reuseRedirectedURL:!1}},{}],6:[function(t,e,n){function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),(0,S.default)(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),a=t("../io/io-controller.js"),o=function(t){return t&&t.__esModule?t:{default:t}}(a),s=t("../config.js"),u=function(){function t(){r(this,t)}return i(t,null,[{key:"supportMSEH264Playback",value:function(){return window.MediaSource&&window.MediaSource.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"')}},{key:"supportNetworkStreamIO",value:function(){var t=new o.default({},(0,s.createDefaultConfig)()),e=t.loaderType;return t.destroy(),"fetch-stream-loader"==e||"xhr-moz-chunked-loader"==e}},{key:"getNetworkLoaderTypeName",value:function(){var t=new o.default({},(0,s.createDefaultConfig)()),e=t.loaderType;return t.destroy(),e}},{key:"supportNativeMediaPlayback",value:function(e){void 0==t.videoElement&&(t.videoElement=window.document.createElement("video"));var n=t.videoElement.canPlayType(e);return"probably"===n||"maybe"==n}},{key:"getFeatureList",value:function(){var e={mseFlvPlayback:!1,mseLiveFlvPlayback:!1,networkStreamIO:!1,networkLoaderName:"",nativeMP4H264Playback:!1,nativeWebmVP8Playback:!1,nativeWebmVP9Playback:!1};return e.mseFlvPlayback=t.supportMSEH264Playback(),e.networkStreamIO=t.supportNetworkStreamIO(),e.networkLoaderName=t.getNetworkLoaderTypeName(),e.mseLiveFlvPlayback=e.mseFlvPlayback&&e.networkStreamIO,e.nativeMP4H264Playback=t.supportNativeMediaPlayback('video/mp4; codecs="avc1.42001E, mp4a.40.2"'),e.nativeWebmVP8Playback=t.supportNativeMediaPlayback('video/webm; codecs="vp8.0, vorbis"'),e.nativeWebmVP9Playback=t.supportNativeMediaPlayback('video/webm; codecs="vp9"'),e}}]),t}();n.default=u},{"../config.js":5,"../io/io-controller.js":23}],7:[function(t,e,n){function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),(0,S.default)(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),a=function(){function t(){r(this,t),this.mimeType=null,this.duration=null,this.hasAudio=null,this.hasVideo=null,this.audioCodec=null,this.videoCodec=null,this.audioDataRate=null,this.videoDataRate=null,this.audioSampleRate=null,this.audioChannelCount=null,this.width=null,this.height=null,this.fps=null,this.profile=null,this.level=null,this.refFrames=null,this.chromaFormat=null,this.sarNum=null,this.sarDen=null,this.metadata=null,this.segments=null,this.segmentCount=null,this.hasKeyframesIndex=null,this.keyframesIndex=null}return i(t,[{key:"isComplete",value:function(){var t=!1===this.hasAudio||!0===this.hasAudio&&null!=this.audioCodec&&null!=this.audioSampleRate&&null!=this.audioChannelCount,e=!1===this.hasVideo||!0===this.hasVideo&&null!=this.videoCodec&&null!=this.width&&null!=this.height&&null!=this.fps&&null!=this.profile&&null!=this.level&&null!=this.refFrames&&null!=this.chromaFormat&&null!=this.sarNum&&null!=this.sarDen;return null!=this.mimeType&&null!=this.duration&&null!=this.metadata&&null!=this.hasKeyframesIndex&&t&&e}},{key:"isSeekable",value:function(){return!0===this.hasKeyframesIndex}},{key:"getNearestKeyframe",value:function(t){if(null==this.keyframesIndex)return null;var e=this.keyframesIndex,n=this._search(e.times,t);return{index:n,milliseconds:e.times[n],fileposition:e.filepositions[n]}}},{key:"_search",value:function(t,e){var n=0,r=t.length-1,i=0,a=0,o=r;for(e<t[0]&&(n=0,a=o+1);a<=o;){if((i=a+Math.floor((o-a)/2))===r||e>=t[i]&&e<t[i+1]){n=i;break}t[i]<e?a=i+1:o=i-1}return n}}]),t}();n.default=a},{}],8:[function(t,e,n){function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),(0,S.default)(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();n.SampleInfo=function a(t,e,n,i,o){r(this,a),this.dts=t,this.pts=e,this.duration=n,this.originalDts=i,this.isSyncPoint=o,this.fileposition=null},n.MediaSegmentInfo=function(){function t(){r(this,t),this.beginDts=0,this.endDts=0,this.beginPts=0,this.endPts=0,this.originalBeginDts=0,this.originalEndDts=0,this.syncPoints=[],this.firstSample=null,this.lastSample=null}return i(t,[{key:"appendSyncPoint",value:function(t){t.isSyncPoint=!0,this.syncPoints.push(t)}}]),t}(),n.IDRSampleList=function(){function t(){r(this,t),this._list=[]}return i(t,[{key:"clear",value:function(){this._list=[]}},{key:"appendArray",value:function(t){var e=this._list;0!==t.length&&(e.length>0&&t[0].originalDts<e[e.length-1].originalDts&&this.clear(),Array.prototype.push.apply(e,t))}},{key:"getLastSyncPointBeforeDts",value:function(t){if(0==this._list.length)return null;var e=this._list,n=0,r=e.length-1,i=0,a=0,o=r;for(t<e[0].dts&&(n=0,a=o+1);a<=o;){if((i=a+Math.floor((o-a)/2))===r||t>=e[i].dts&&t<e[i+1].dts){n=i;break}e[i].dts<t?a=i+1:o=i-1}return this._list[n]}}]),t}(),n.MediaSegmentInfoList=function(){function t(e){r(this,t),this._type=e,this._list=[],this._lastAppendLocation=-1}return i(t,[{key:"isEmpty",value:function(){return 0===this._list.length}},{key:"clear",value:function(){this._list=[],this._lastAppendLocation=-1}},{key:"_searchNearestSegmentBefore",value:function(t){var e=this._list;if(0===e.length)return-2;var n=e.length-1,r=0,i=0,a=n,o=0;if(t<e[0].originalBeginDts)return o=-1;for(;i<=a;){if((r=i+Math.floor((a-i)/2))===n||t>e[r].lastSample.originalDts&&t<e[r+1].originalBeginDts){o=r;break}e[r].originalBeginDts<t?i=r+1:a=r-1}return o}},{key:"_searchNearestSegmentAfter",value:function(t){return this._searchNearestSegmentBefore(t)+1}},{key:"append",value:function(t){var e=this._list,n=t,r=this._lastAppendLocation,i=0;-1!==r&&r<e.length&&n.originalBeginDts>=e[r].lastSample.originalDts&&(r===e.length-1||r<e.length-1&&n.originalBeginDts<e[r+1].originalBeginDts)?i=r+1:e.length>0&&(i=this._searchNearestSegmentBefore(n.originalBeginDts)+1),this._lastAppendLocation=i,this._list.splice(i,0,n)}},{key:"getLastSegmentBefore",value:function(t){var e=this._searchNearestSegmentBefore(t);return e>=0?this._list[e]:null}},{key:"getLastSampleBefore",value:function(t){var e=this.getLastSegmentBefore(t);return null!=e?e.lastSample:null}},{key:"getLastSyncPointBefore",value:function(t){for(var e=this._searchNearestSegmentBefore(t),n=this._list[e].syncPoints;0===n.length&&e>0;)e--,n=this._list[e].syncPoints;return n.length>0?n[n.length-1]:null}},{key:"type",get:function(){return this._type}},{key:"length",get:function(){return this._list.length}}]),t}()},{}],9:[function(t,e,n){function r(t){return t&&t.__esModule?t:{default:t}}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),(0,S.default)(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=t("events"),s=r(o),u=t("../utils/logger.js"),l=r(u),c=t("../utils/browser.js"),d=r(c),h=t("./mse-events.js"),f=r(h),p=t("./media-segment-info.js"),m=t("../utils/exception.js"),g=function(){function t(e){i(this,t),this.TAG="MSEController",this._config=e,this._emitter=new s.default,this._config.isLive&&void 0==this._config.autoCleanupSourceBuffer&&(this._config.autoCleanupSourceBuffer=!0),this.e={onSourceOpen:this._onSourceOpen.bind(this),onSourceEnded:this._onSourceEnded.bind(this),onSourceClose:this._onSourceClose.bind(this),onSourceBufferError:this._onSourceBufferError.bind(this),onSourceBufferUpdateEnd:this._onSourceBufferUpdateEnd.bind(this)},this._mediaSource=null,this._mediaSourceObjectURL=null,this._mediaElement=null,this._isBufferFull=!1,this._hasPendingEos=!1,this._requireSetMediaDuration=!1,this._pendingMediaDuration=0,this._pendingSourceBufferInit=[],this._mimeTypes={video:null,audio:null},this._sourceBuffers={video:null,audio:null},this._lastInitSegments={video:null,audio:null},this._pendingSegments={video:[],audio:[]},this._pendingRemoveRanges={video:[],audio:[]},this._idrList=new p.IDRSampleList}return a(t,[{key:"destroy",value:function(){(this._mediaElement||this._mediaSource)&&this.detachMediaElement(),this.e=null,this._emitter.removeAllListeners(),this._emitter=null}},{key:"on",value:function(t,e){this._emitter.addListener(t,e)}},{key:"off",value:function(t,e){this._emitter.removeListener(t,e)}},{key:"attachMediaElement",value:function(t){if(this._mediaSource)throw new m.IllegalStateException("MediaSource has been attached to an HTMLMediaElement!");var e=this._mediaSource=new window.MediaSource;e.addEventListener("sourceopen",this.e.onSourceOpen),e.addEventListener("sourceended",this.e.onSourceEnded),e.addEventListener("sourceclose",this.e.onSourceClose),this._mediaElement=t,this._mediaSourceObjectURL=window.URL.createObjectURL(this._mediaSource),t.src=this._mediaSourceObjectURL}},{key:"detachMediaElement",value:function(){if(this._mediaSource){var t=this._mediaSource;for(var e in this._sourceBuffers){var n=this._pendingSegments[e];n.splice(0,n.length),this._pendingSegments[e]=null,this._pendingRemoveRanges[e]=null,this._lastInitSegments[e]=null;var r=this._sourceBuffers[e];r&&("closed"!==t.readyState&&(t.removeSourceBuffer(r),r.removeEventListener("error",this.e.onSourceBufferError),r.removeEventListener("updateend",this.e.onSourceBufferUpdateEnd)),this._mimeTypes[e]=null,this._sourceBuffers[e]=null)}if("open"===t.readyState)try{t.endOfStream()}catch(i){l.default.e(this.TAG,i.message)}t.removeEventListener("sourceopen",this.e.onSourceOpen),t.removeEventListener("sourceended",this.e.onSourceEnded),t.removeEventListener("sourceclose",this.e.onSourceClose),this._pendingSourceBufferInit=[],this._isBufferFull=!1,this._idrList.clear(),this._mediaSource=null}this._mediaElement&&(this._mediaElement.src="",this._mediaElement.removeAttribute("src"),this._mediaElement=null),this._mediaSourceObjectURL&&(window.URL.revokeObjectURL(this._mediaSourceObjectURL),this._mediaSourceObjectURL=null)}},{key:"appendInitSegment",value:function(t,e){if(!this._mediaSource||"open"!==this._mediaSource.readyState)return this._pendingSourceBufferInit.push(t),void this._pendingSegments[t.type].push(t);var n=t,r=""+n.container;n.codec&&n.codec.length>0&&(r+=";codecs="+n.codec);var i=!1;if(l.default.v(this.TAG,"Received Initialization Segment, mimeType: "+r),this._lastInitSegments[n.type]=n,r!==this._mimeTypes[n.type]){if(this._mimeTypes[n.type])l.default.v(this.TAG,"Notice: "+n.type+" mimeType changed, origin: "+this._mimeTypes[n.type]+", target: "+r);else{i=!0;try{var a=this._sourceBuffers[n.type]=this._mediaSource.addSourceBuffer(r);a.addEventListener("error",this.e.onSourceBufferError),a.addEventListener("updateend",this.e.onSourceBufferUpdateEnd)}catch(o){return l.default.e(this.TAG,o.message),void this._emitter.emit(f.default.ERROR,{code:o.code,msg:o.message})}}this._mimeTypes[n.type]=r}e||this._pendingSegments[n.type].push(n),i||this._sourceBuffers[n.type]&&!this._sourceBuffers[n.type].updating&&this._doAppendSegments(),d.default.safari&&"audio/mpeg"===n.container&&n.mediaDuration>0&&(this._requireSetMediaDuration=!0,this._pendingMediaDuration=n.mediaDuration/1e3,this._updateMediaSourceDuration())}},{key:"appendMediaSegment",value:function(t){var e=t;this._pendingSegments[e.type].push(e),this._config.autoCleanupSourceBuffer&&this._needCleanupSourceBuffer()&&this._doCleanupSourceBuffer();var n=this._sourceBuffers[e.type];!n||n.updating||this._hasPendingRemoveRanges()||this._doAppendSegments()}},{key:"seek",value:function(t){for(var e in this._sourceBuffers)if(this._sourceBuffers[e]){var n=this._sourceBuffers[e];if("open"===this._mediaSource.readyState)try{n.abort()}catch(u){l.default.e(this.TAG,u.message)}this._idrList.clear();var r=this._pendingSegments[e];if(r.splice(0,r.length),"closed"!==this._mediaSource.readyState){for(var i=0;i<n.buffered.length;i++){var a=n.buffered.start(i),o=n.buffered.end(i);this._pendingRemoveRanges[e].push({start:a,end:o})}if(n.updating||this._doRemoveRanges(),d.default.safari){var s=this._lastInitSegments[e];s&&(this._pendingSegments[e].push(s),n.updating||this._doAppendSegments())}}}}},{key:"endOfStream",value:function(){var t=this._mediaSource,e=this._sourceBuffers;if(!t||"open"!==t.readyState)return void(t&&"closed"===t.readyState&&this._hasPendingSegments()&&(this._hasPendingEos=!0));e.video&&e.video.updating||e.audio&&e.audio.updating?this._hasPendingEos=!0:(this._hasPendingEos=!1,t.endOfStream())}},{key:"getNearestKeyframe",value:function(t){return this._idrList.getLastSyncPointBeforeDts(t)}},{key:"_needCleanupSourceBuffer",value:function(){if(!this._config.autoCleanupSourceBuffer)return!1;var t=this._mediaElement.currentTime;for(var e in this._sourceBuffers){var n=this._sourceBuffers[e];if(n){var r=n.buffered;if(r.length>=1&&t-r.start(0)>=this._config.autoCleanupMaxBackwardDuration)return!0}}return!1}},{key:"_doCleanupSourceBuffer",value:function(){var t=this._mediaElement.currentTime;for(var e in this._sourceBuffers){var n=this._sourceBuffers[e];if(n){for(var r=n.buffered,i=!1,a=0;a<r.length;a++){var o=r.start(a),s=r.end(a);if(o<=t&&t<s+3){if(t-o>=this._config.autoCleanupMaxBackwardDuration){i=!0;var u=t-this._config.autoCleanupMinBackwardDuration;this._pendingRemoveRanges[e].push({start:o,end:u})}}else s<t&&(i=!0,this._pendingRemoveRanges[e].push({start:o,end:s}))}i&&!n.updating&&this._doRemoveRanges()}}}},{key:"_updateMediaSourceDuration",value:function(){var t=this._sourceBuffers;if(0!==this._mediaElement.readyState&&"open"===this._mediaSource.readyState&&!(t.video&&t.video.updating||t.audio&&t.audio.updating)){var e=this._mediaSource.duration,n=this._pendingMediaDuration;n>0&&(isNaN(e)||n>e)&&(l.default.v(this.TAG,"Update MediaSource duration from "+e+" to "+n),this._mediaSource.duration=n),this._requireSetMediaDuration=!1,this._pendingMediaDuration=0}}},{key:"_doRemoveRanges",value:function(){for(var t in this._pendingRemoveRanges)if(this._sourceBuffers[t]&&!this._sourceBuffers[t].updating)for(var e=this._sourceBuffers[t],n=this._pendingRemoveRanges[t];n.length&&!e.updating;){var r=n.shift();e.remove(r.start,r.end)}}},{key:"_doAppendSegments",value:function(){var t=this._pendingSegments;for(var e in t)if(this._sourceBuffers[e]&&!this._sourceBuffers[e].updating&&t[e].length>0){var n=t[e].shift();if(n.timestampOffset){var r=this._sourceBuffers[e].timestampOffset,i=n.timestampOffset/1e3,a=Math.abs(r-i);a>.1&&(l.default.v(this.TAG,"Update MPEG audio timestampOffset from "+r+" to "+i),this._sourceBuffers[e].timestampOffset=i),delete n.timestampOffset}if(!n.data||0===n.data.byteLength)continue;try{this._sourceBuffers[e].appendBuffer(n.data),this._isBufferFull=!1,"video"===e&&n.hasOwnProperty("info")&&this._idrList.appendArray(n.info.syncPoints)}catch(o){this._pendingSegments[e].unshift(n),22===o.code?(this._isBufferFull||this._emitter.emit(f.default.BUFFER_FULL),this._isBufferFull=!0):(l.default.e(this.TAG,o.message),this._emitter.emit(f.default.ERROR,{code:o.code,msg:o.message}))}}}},{key:"_onSourceOpen",value:function(){if(l.default.v(this.TAG,"MediaSource onSourceOpen"),this._mediaSource.removeEventListener("sourceopen",this.e.onSourceOpen),this._pendingSourceBufferInit.length>0)for(var t=this._pendingSourceBufferInit;t.length;){var e=t.shift();this.appendInitSegment(e,!0)}this._hasPendingSegments()&&this._doAppendSegments(),this._emitter.emit(f.default.SOURCE_OPEN)}},{key:"_onSourceEnded",value:function(){l.default.v(this.TAG,"MediaSource onSourceEnded")}},{key:"_onSourceClose",value:function(){l.default.v(this.TAG,"MediaSource onSourceClose"),this._mediaSource&&null!=this.e&&(this._mediaSource.removeEventListener("sourceopen",this.e.onSourceOpen),this._mediaSource.removeEventListener("sourceended",this.e.onSourceEnded),this._mediaSource.removeEventListener("sourceclose",this.e.onSourceClose))}},{key:"_hasPendingSegments",value:function(){var t=this._pendingSegments;return t.video.length>0||t.audio.length>0}},{key:"_hasPendingRemoveRanges",value:function(){var t=this._pendingRemoveRanges;return t.video.length>0||t.audio.length>0}},{key:"_onSourceBufferUpdateEnd",value:function(){this._requireSetMediaDuration?this._updateMediaSourceDuration():this._hasPendingRemoveRanges()?this._doRemoveRanges():this._hasPendingSegments()?this._doAppendSegments():this._hasPendingEos&&this.endOfStream(),this._emitter.emit(f.default.UPDATE_END)}},{key:"_onSourceBufferError",value:function(t){l.default.e(this.TAG,"SourceBuffer Error: "+t)}}]),t}();n.default=g},{"../utils/browser.js":39,"../utils/exception.js":40,"../utils/logger.js":41,"./media-segment-info.js":8,"./mse-events.js":10,events:2}],10:[function(t,e,n){Object.defineProperty(n,"__esModule",{value:!0});var r={ERROR:"error",SOURCE_OPEN:"source_open",UPDATE_END:"update_end",BUFFER_FULL:"buffer_full"};n.default=r},{}],11:[function(t,e,n){function r(t){return t&&t.__esModule?t:{default:t}}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),(0,S.default)(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=t("events"),s=r(o),u=t("../utils/logger.js"),l=r(u),c=t("../utils/logging-control.js"),d=r(c),h=t("./transmuxing-controller.js"),f=r(h),p=t("./transmuxing-events.js"),m=r(p),g=t("./transmuxing-worker.js"),v=r(g),y=t("./media-info.js"),_=r(y),E=function(){function e(n,r){if(i(this,e),this.TAG="Transmuxer",this._emitter=new s.default,r.enableWorker&&"undefined"!=typeof Worker)try{var a=t("webworkify");this._worker=a(v.default),this._workerDestroying=!1,this._worker.addEventListener("message",this._onWorkerMessage.bind(this)),this._worker.postMessage({cmd:"init",param:[n,r]}),this.e={onLoggingConfigChanged:this._onLoggingConfigChanged.bind(this)},d.default.registerListener(this.e.onLoggingConfigChanged),this._worker.postMessage({cmd:"logging_config",param:d.default.getConfig()})}catch(u){l.default.e(this.TAG,"Error while initialize transmuxing worker, fallback to inline transmuxing"),this._worker=null,this._controller=new f.default(n,r)}else this._controller=new f.default(n,r);if(this._controller){var o=this._controller;o.on(m.default.IO_ERROR,this._onIOError.bind(this)),o.on(m.default.DEMUX_ERROR,this._onDemuxError.bind(this)),o.on(m.default.INIT_SEGMENT,this._onInitSegment.bind(this)),o.on(m.default.MEDIA_SEGMENT,this._onMediaSegment.bind(this)),o.on(m.default.LOADING_COMPLETE,this._onLoadingComplete.bind(this)),o.on(m.default.RECOVERED_EARLY_EOF,this._onRecoveredEarlyEof.bind(this)),o.on(m.default.MEDIA_INFO,this._onMediaInfo.bind(this)),o.on(m.default.STATISTICS_INFO,this._onStatisticsInfo.bind(this)),o.on(m.default.RECOMMEND_SEEKPOINT,this._onRecommendSeekpoint.bind(this))}}return a(e,[{key:"destroy",value:function(){this._worker?this._workerDestroying||(this._workerDestroying=!0,this._worker.postMessage({cmd:"destroy"}),d.default.removeListener(this.e.onLoggingConfigChanged),this.e=null):(this._controller.destroy(),this._controller=null),this._emitter.removeAllListeners(),this._emitter=null}},{key:"on",value:function(t,e){this._emitter.addListener(t,e)}},{key:"off",value:function(t,e){this._emitter.removeListener(t,e)}},{key:"hasWorker",value:function(){return null!=this._worker}},{key:"open",value:function(){this._worker?this._worker.postMessage({cmd:"start"}):this._controller.start()}},{key:"close",value:function(){this._worker?this._worker.postMessage({cmd:"stop"}):this._controller.stop()}},{key:"seek",value:function(t){this._worker?this._worker.postMessage({cmd:"seek",param:t}):this._controller.seek(t)}},{key:"pause",value:function(){this._worker?this._worker.postMessage({cmd:"pause"}):this._controller.pause()}},{key:"resume",value:function(){this._worker?this._worker.postMessage({cmd:"resume"}):this._controller.resume()}},{key:"_onInitSegment",value:function(t,e){var n=this;w.default.resolve().then(function(){n._emitter.emit(m.default.INIT_SEGMENT,t,e)})}},{key:"_onMediaSegment",value:function(t,e){var n=this;w.default.resolve().then(function(){n._emitter.emit(m.default.MEDIA_SEGMENT,t,e)})}},{key:"_onLoadingComplete",value:function(){var t=this;w.default.resolve().then(function(){t._emitter.emit(m.default.LOADING_COMPLETE)})}},{key:"_onRecoveredEarlyEof",value:function(){var t=this;w.default.resolve().then(function(){t._emitter.emit(m.default.RECOVERED_EARLY_EOF)})}},{key:"_onMediaInfo",value:function(t){var e=this;w.default.resolve().then(function(){e._emitter.emit(m.default.MEDIA_INFO,t)})}},{key:"_onStatisticsInfo",value:function(t){var e=this;w.default.resolve().then(function(){e._emitter.emit(m.default.STATISTICS_INFO,t)})}},{key:"_onIOError",value:function(t,e){var n=this;w.default.resolve().then(function(){n._emitter.emit(m.default.IO_ERROR,t,e)})}},{key:"_onDemuxError",value:function(t,e){var n=this;w.default.resolve().then(function(){n._emitter.emit(m.default.DEMUX_ERROR,t,e)})}},{key:"_onRecommendSeekpoint",value:function(t){var e=this;w.default.resolve().then(function(){e._emitter.emit(m.default.RECOMMEND_SEEKPOINT,t)})}},{key:"_onLoggingConfigChanged",value:function(t){this._worker&&this._worker.postMessage({cmd:"logging_config",param:t})}},{key:"_onWorkerMessage",value:function(t){var e=t.data,n=e.data;if("destroyed"===e.msg||this._workerDestroying)return this._workerDestroying=!1,this._worker.terminate(),void(this._worker=null);switch(e.msg){case m.default.INIT_SEGMENT:case m.default.MEDIA_SEGMENT:this._emitter.emit(e.msg,n.type,n.data);break;case m.default.LOADING_COMPLETE:case m.default.RECOVERED_EARLY_EOF:this._emitter.emit(e.msg);break;case m.default.MEDIA_INFO:(0,b.default)(n,_.default.prototype),this._emitter.emit(e.msg,n);break;case m.default.STATISTICS_INFO:this._emitter.emit(e.msg,n);break;case m.default.IO_ERROR:case m.default.DEMUX_ERROR:this._emitter.emit(e.msg,n.type,n.info);break;case m.default.RECOMMEND_SEEKPOINT:this._emitter.emit(e.msg,n);break;case"logcat_callback":l.default.emitter.emit("log",n.type,n.logcat)}}}]),e}();n.default=E},{"../utils/logger.js":41,"../utils/logging-control.js":42,"./media-info.js":7,"./transmuxing-controller.js":12,"./transmuxing-events.js":13,"./transmuxing-worker.js":14,events:2,webworkify:4}],12:[function(t,e,n){function r(t){return t&&t.__esModule?t:{default:t}}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),(0,S.default)(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=t("events"),s=r(o),u=t("../utils/logger.js"),l=r(u),c=t("../utils/browser.js"),d=r(c),h=t("./media-info.js"),f=r(h),p=t("../demux/flv-demuxer.js"),m=r(p),g=t("../remux/mp4-remuxer.js"),v=r(g),y=t("../demux/demux-errors.js"),_=r(y),E=t("../io/io-controller.js"),A=r(E),T=t("./transmuxing-events.js"),k=r(T),C=(t("../io/loader.js"),function(){function t(e,n){i(this,t),this.TAG="TransmuxingController",this._emitter=new s.default,this._config=n,e.segments||(e.segments=[{duration:e.duration,filesize:e.filesize,url:e.url}]),"boolean"!=typeof e.cors&&(e.cors=!0),"boolean"!=typeof e.withCredentials&&(e.withCredentials=!1),this._mediaDataSource=e,this._currentSegmentIndex=0;var r=0;this._mediaDataSource.segments.forEach(function(t){t.timestampBase=r,r+=t.duration,t.cors=e.cors,t.withCredentials=e.withCredentials,n.referrerPolicy&&(t.referrerPolicy=n.referrerPolicy)}),isNaN(r)||this._mediaDataSource.duration===r||(this._mediaDataSource.duration=r),this._mediaInfo=null,this._demuxer=null,this._remuxer=null,this._ioctl=null,this._pendingSeekTime=null,this._pendingResolveSeekPoint=null,this._statisticsReporter=null}return a(t,[{key:"destroy",value:function(){this._mediaInfo=null,this._mediaDataSource=null,this._statisticsReporter&&this._disableStatisticsReporter(),this._ioctl&&(this._ioctl.destroy(),this._ioctl=null),this._demuxer&&(this._demuxer.destroy(),this._demuxer=null),this._remuxer&&(this._remuxer.destroy(),this._remuxer=null),this._emitter.removeAllListeners(),this._emitter=null}},{key:"on",value:function(t,e){this._emitter.addListener(t,e)}},{key:"off",value:function(t,e){this._emitter.removeListener(t,e)}},{key:"start",value:function(){this._loadSegment(0),this._enableStatisticsReporter()}},{key:"_loadSegment",value:function(t,e){this._currentSegmentIndex=t;var n=this._mediaDataSource.segments[t],r=this._ioctl=new A.default(n,this._config,t);r.onError=this._onIOException.bind(this),r.onSeeked=this._onIOSeeked.bind(this),r.onComplete=this._onIOComplete.bind(this),r.onRedirect=this._onIORedirect.bind(this),r.onRecoveredEarlyEof=this._onIORecoveredEarlyEof.bind(this),e?this._demuxer.bindDataSource(this._ioctl):r.onDataArrival=this._onInitChunkArrival.bind(this),r.open(e)}},{key:"stop",value:function(){this._internalAbort(),this._disableStatisticsReporter()}},{key:"_internalAbort",value:function(){this._ioctl&&(this._ioctl.destroy(),this._ioctl=null)}},{key:"pause",value:function(){this._ioctl&&this._ioctl.isWorking()&&(this._ioctl.pause(),this._disableStatisticsReporter())}},{key:"resume",value:function(){this._ioctl&&this._ioctl.isPaused()&&(this._ioctl.resume(),this._enableStatisticsReporter())}},{key:"seek",value:function(t){if(null!=this._mediaInfo&&this._mediaInfo.isSeekable()){var e=this._searchSegmentIndexContains(t);if(e===this._currentSegmentIndex){var n=this._mediaInfo.segments[e];if(void 0==n)this._pendingSeekTime=t;else{var r=n.getNearestKeyframe(t);this._remuxer.seek(r.milliseconds),this._ioctl.seek(r.fileposition),this._pendingResolveSeekPoint=r.milliseconds}}else{var i=this._mediaInfo.segments[e];if(void 0==i)this._pendingSeekTime=t,this._internalAbort(),this._remuxer.seek(),this._remuxer.insertDiscontinuity(),this._loadSegment(e);else{var a=i.getNearestKeyframe(t);this._internalAbort(),this._remuxer.seek(t),this._remuxer.insertDiscontinuity(),this._demuxer.resetMediaInfo(),this._demuxer.timestampBase=this._mediaDataSource.segments[e].timestampBase,this._loadSegment(e,a.fileposition),this._pendingResolveSeekPoint=a.milliseconds,this._reportSegmentMediaInfo(e)}}this._enableStatisticsReporter()}}},{key:"_searchSegmentIndexContains",value:function(t){for(var e=this._mediaDataSource.segments,n=e.length-1,r=0;r<e.length;r++)if(t<e[r].timestampBase){n=r-1;break}return n}},{key:"_onInitChunkArrival",value:function(t,e){var n=this,r=null,i=0;if(e>0)this._demuxer.bindDataSource(this._ioctl),this._demuxer.timestampBase=this._mediaDataSource.segments[this._currentSegmentIndex].timestampBase,i=this._demuxer.parseChunks(t,e);else if((r=m.default.probe(t)).match){this._demuxer=new m.default(r,this._config),this._remuxer||(this._remuxer=new v.default(this._config));var a=this._mediaDataSource;void 0==a.duration||isNaN(a.duration)||(this._demuxer.overridedDuration=a.duration),"boolean"==typeof a.hasAudio&&(this._demuxer.overridedHasAudio=a.hasAudio),"boolean"==typeof a.hasVideo&&(this._demuxer.overridedHasVideo=a.hasVideo),this._demuxer.timestampBase=a.segments[this._currentSegmentIndex].timestampBase,this._demuxer.onError=this._onDemuxException.bind(this),this._demuxer.onMediaInfo=this._onMediaInfo.bind(this),this._remuxer.bindDataSource(this._demuxer.bindDataSource(this._ioctl)),this._remuxer.onInitSegment=this._onRemuxerInitSegmentArrival.bind(this),this._remuxer.onMediaSegment=this._onRemuxerMediaSegmentArrival.bind(this),i=this._demuxer.parseChunks(t,e)}else r=null,l.default.e(this.TAG,"Non-FLV, Unsupported media type!"),w.default.resolve().then(function(){n._internalAbort()}),this._emitter.emit(k.default.DEMUX_ERROR,_.default.FORMAT_UNSUPPORTED,"Non-FLV, Unsupported media type"),i=0;return i}},{key:"_onMediaInfo",value:function(t){var e=this;null==this._mediaInfo&&(this._mediaInfo=(0,x.default)({},t),this._mediaInfo.keyframesIndex=null,this._mediaInfo.segments=[],this._mediaInfo.segmentCount=this._mediaDataSource.segments.length,(0,b.default)(this._mediaInfo,f.default.prototype));var n=(0,x.default)({},t);(0,b.default)(n,f.default.prototype),this._mediaInfo.segments[this._currentSegmentIndex]=n,this._reportSegmentMediaInfo(this._currentSegmentIndex),null!=this._pendingSeekTime&&w.default.resolve().then(function(){var t=e._pendingSeekTime;e._pendingSeekTime=null,e.seek(t)})}},{key:"_onIOSeeked",value:function(){this._remuxer.insertDiscontinuity()}},{key:"_onIOComplete",value:function(t){var e=t,n=e+1;n<this._mediaDataSource.segments.length?(this._internalAbort(),this._remuxer.flushStashedSamples(),this._loadSegment(n)):(this._remuxer.flushStashedSamples(),this._emitter.emit(k.default.LOADING_COMPLETE),this._disableStatisticsReporter())}},{key:"_onIORedirect",value:function(t){var e=this._ioctl.extraData;this._mediaDataSource.segments[e].redirectedURL=t}},{key:"_onIORecoveredEarlyEof",value:function(){this._emitter.emit(k.default.RECOVERED_EARLY_EOF)}},{key:"_onIOException",value:function(t,e){l.default.e(this.TAG,"IOException: type = "+t+", code = "+e.code+", msg = "+e.msg),this._emitter.emit(k.default.IO_ERROR,t,e),this._disableStatisticsReporter()}},{key:"_onDemuxException",value:function(t,e){l.default.e(this.TAG,"DemuxException: type = "+t+", info = "+e),this._emitter.emit(k.default.DEMUX_ERROR,t,e)}},{key:"_onRemuxerInitSegmentArrival",value:function(t,e){this._emitter.emit(k.default.INIT_SEGMENT,t,e)}},{key:"_onRemuxerMediaSegmentArrival",value:function(t,e){if(null==this._pendingSeekTime&&(this._emitter.emit(k.default.MEDIA_SEGMENT,t,e),null!=this._pendingResolveSeekPoint&&"video"===t)){var n=e.info.syncPoints,r=this._pendingResolveSeekPoint;this._pendingResolveSeekPoint=null,d.default.safari&&n.length>0&&n[0].originalDts===r&&(r=n[0].pts),this._emitter.emit(k.default.RECOMMEND_SEEKPOINT,r)}}},{key:"_enableStatisticsReporter",value:function(){null==this._statisticsReporter&&(this._statisticsReporter=self.setInterval(this._reportStatisticsInfo.bind(this),this._config.statisticsInfoReportInterval))}},{key:"_disableStatisticsReporter",value:function(){this._statisticsReporter&&(self.clearInterval(this._statisticsReporter),this._statisticsReporter=null)}},{key:"_reportSegmentMediaInfo",value:function(t){var e=this._mediaInfo.segments[t],n=(0,x.default)({},e);n.duration=this._mediaInfo.duration,n.segmentCount=this._mediaInfo.segmentCount,delete n.segments,delete n.keyframesIndex,this._emitter.emit(k.default.MEDIA_INFO,n)}},{key:"_reportStatisticsInfo",value:function(){var t={};t.url=this._ioctl.currentURL,t.hasRedirect=this._ioctl.hasRedirect,t.hasRedirect&&(t.redirectedURL=this._ioctl.currentRedirectedURL),t.speed=this._ioctl.currentSpeed,t.loaderType=this._ioctl.loaderType,t.currentSegmentIndex=this._currentSegmentIndex,t.totalSegmentCount=this._mediaDataSource.segments.length,this._emitter.emit(k.default.STATISTICS_INFO,t)}}]),t}());n.default=C},{"../demux/demux-errors.js":16,"../demux/flv-demuxer.js":18,"../io/io-controller.js":23,"../io/loader.js":24,"../remux/mp4-remuxer.js":38,"../utils/browser.js":39,"../utils/logger.js":41,"./media-info.js":7,"./transmuxing-events.js":13,events:2}],13:[function(t,e,n){Object.defineProperty(n,"__esModule",{value:!0});var r={IO_ERROR:"io_error",DEMUX_ERROR:"demux_error",INIT_SEGMENT:"init_segment",MEDIA_SEGMENT:"media_segment",LOADING_COMPLETE:"loading_complete",RECOVERED_EARLY_EOF:"recovered_early_eof",MEDIA_INFO:"media_info",STATISTICS_INFO:"statistics_info",RECOMMEND_SEEKPOINT:"recommend_seekpoint"};n.default=r},{}],14:[function(t,e,n){function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(n,"__esModule",{value:!0});var i=t("../utils/logger.js"),a=(r(i),t("../utils/logging-control.js")),o=r(a),s=t("../utils/polyfill.js"),u=r(s),l=t("./transmuxing-controller.js"),c=r(l),d=t("./transmuxing-events.js"),h=r(d),f=function(t){function e(e,n){var r={msg:h.default.INIT_SEGMENT,data:{type:e,data:n}};t.postMessage(r,[n.data])}function n(e,n){var r={msg:h.default.MEDIA_SEGMENT,data:{type:e,data:n}};t.postMessage(r,[n.data])}function r(){var e={msg:h.default.LOADING_COMPLETE};t.postMessage(e)}function i(){var e={msg:h.default.RECOVERED_EARLY_EOF};t.postMessage(e)}function a(e){var n={msg:h.default.MEDIA_INFO,data:e};t.postMessage(n)}function s(e){var n={msg:h.default.STATISTICS_INFO,data:e};t.postMessage(n)}function l(e,n){t.postMessage({msg:h.default.IO_ERROR,data:{type:e,info:n}})}function d(e,n){t.postMessage({msg:h.default.DEMUX_ERROR,data:{type:e,info:n}})}function f(e){t.postMessage({msg:h.default.RECOMMEND_SEEKPOINT,data:e})}function p(e,n){t.postMessage({msg:"logcat_callback",data:{type:e,logcat:n}})}var m=null,g=p.bind(this);u.default.install(),t.addEventListener("message",function(u){switch(u.data.cmd){case"init":m=new c.default(u.data.param[0],u.data.param[1]),m.on(h.default.IO_ERROR,l.bind(this)),m.on(h.default.DEMUX_ERROR,d.bind(this)),m.on(h.default.INIT_SEGMENT,e.bind(this)),m.on(h.default.MEDIA_SEGMENT,n.bind(this)),m.on(h.default.LOADING_COMPLETE,r.bind(this)),m.on(h.default.RECOVERED_EARLY_EOF,i.bind(this)),m.on(h.default.MEDIA_INFO,a.bind(this)),m.on(h.default.STATISTICS_INFO,s.bind(this)),m.on(h.default.RECOMMEND_SEEKPOINT,f.bind(this));break;case"destroy":m&&(m.destroy(),m=null),t.postMessage({msg:"destroyed"});break;case"start":m.start();break;case"stop":m.stop();break;case"seek":m.seek(u.data.param);break;case"pause":m.pause();break;case"resume":m.resume();break;case"logging_config":var p=u.data.param;o.default.applyConfig(p),!0===p.enableCallback?o.default.addLogListener(g):o.default.removeLogListener(g)}})};n.default=f},{"../utils/logger.js":41,"../utils/logging-control.js":42,"../utils/polyfill.js":43,"./transmuxing-controller.js":12,"./transmuxing-events.js":13}],15:[function(t,e,n){function r(t){return t&&t.__esModule?t:{default:t}}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),(0,S.default)(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=t("../utils/logger.js"),s=r(o),u=t("../utils/utf8-conv.js"),l=r(u),c=t("../utils/exception.js"),d=function(){var t=new ArrayBuffer(2);return new DataView(t).setInt16(0,256,!0),256===new Int16Array(t)[0]}(),h=function(){function t(){i(this,t)}return a(t,null,[{key:"parseScriptData",value:function(e,n,r){var i={};try{var a=t.parseValue(e,n,r),o=t.parseValue(e,n+a.size,r-a.size);i[a.data]=o.data}catch(u){s.default.e("AMF",u.toString())}return i}},{key:"parseObject",value:function(e,n,r){if(r<3)throw new c.IllegalStateException("Data not enough when parse ScriptDataObject");var i=t.parseString(e,n,r),a=t.parseValue(e,n+i.size,r-i.size),o=a.objectEnd;return{data:{name:i.data,value:a.data},size:i.size+a.size,objectEnd:o}}},{key:"parseVariable",value:function(e,n,r){return t.parseObject(e,n,r)}},{key:"parseString",value:function(t,e,n){if(n<2)throw new c.IllegalStateException("Data not enough when parse String");var r=new DataView(t,e,n),i=r.getUint16(0,!d),a=void 0;return a=i>0?(0,l.default)(new Uint8Array(t,e+2,i)):"",{data:a,size:2+i}}},{key:"parseLongString",value:function(t,e,n){if(n<4)throw new c.IllegalStateException("Data not enough when parse LongString");var r=new DataView(t,e,n),i=r.getUint32(0,!d),a=void 0;return a=i>0?(0,l.default)(new Uint8Array(t,e+4,i)):"",{data:a,size:4+i}}},{key:"parseDate",value:function(t,e,n){if(n<10)throw new c.IllegalStateException("Data size invalid when parse Date");var r=new DataView(t,e,n),i=r.getFloat64(0,!d);return i+=60*r.getInt16(8,!d)*1e3,{data:new Date(i),size:10}}},{key:"parseValue",value:function(e,n,r){if(r<1)throw new c.IllegalStateException("Data not enough when parse Value");var i=new DataView(e,n,r),a=1,o=i.getUint8(0),u=void 0,l=!1;try{switch(o){case 0:u=i.getFloat64(1,!d),a+=8;break;case 1:u=!!i.getUint8(1),a+=1;break;case 2:var h=t.parseString(e,n+1,r-1);u=h.data,a+=h.size;break;case 3:u={};var f=0;for(9==(16777215&i.getUint32(r-4,!d))&&(f=3);a<r-4;){var p=t.parseObject(e,n+a,r-a-f);if(p.objectEnd)break;u[p.data.name]=p.data.value,a+=p.size}if(a<=r-3){9===(16777215&i.getUint32(a-1,!d))&&(a+=3)}break;case 8:u={},a+=4;var m=0;for(9==(16777215&i.getUint32(r-4,!d))&&(m=3);a<r-8;){var g=t.parseVariable(e,n+a,r-a-m);if(g.objectEnd)break;u[g.data.name]=g.data.value,a+=g.size}if(a<=r-3){9===(16777215&i.getUint32(a-1,!d))&&(a+=3)}break;case 9:u=void 0,a=1,l=!0;break;case 10:u=[];var v=i.getUint32(1,!d);a+=4;for(var y=0;y<v;y++){var _=t.parseValue(e,n+a,r-a);u.push(_.data),a+=_.size}break;case 11:var b=t.parseDate(e,n+1,r-1);u=b.data,a+=b.size;break;case 12:var E=t.parseString(e,n+1,r-1);u=E.data,a+=E.size;break;default:a=r,s.default.w("AMF","Unsupported AMF value type "+o)}}catch(w){s.default.e("AMF",w.toString())}return{data:u,size:a,objectEnd:l}}}]),t}();n.default=h},{"../utils/exception.js":40,"../utils/logger.js":41,"../utils/utf8-conv.js":44}],16:[function(t,e,n){Object.defineProperty(n,"__esModule",{value:!0});var r={OK:"OK",FORMAT_ERROR:"FormatError",FORMAT_UNSUPPORTED:"FormatUnsupported",CODEC_UNSUPPORTED:"CodecUnsupported"};n.default=r},{}],17:[function(t,e,n){function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),(0,S.default)(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),a=t("../utils/exception.js"),o=function(){function t(e){r(this,t),this.TAG="ExpGolomb",this._buffer=e,this._buffer_index=0,this._total_bytes=e.byteLength,this._total_bits=8*e.byteLength,this._current_word=0,this._current_word_bits_left=0}return i(t,[{key:"destroy",value:function(){this._buffer=null}},{key:"_fillCurrentWord",value:function(){var t=this._total_bytes-this._buffer_index;if(t<=0)throw new a.IllegalStateException("ExpGolomb: _fillCurrentWord() but no bytes available");var e=Math.min(4,t),n=new Uint8Array(4);n.set(this._buffer.subarray(this._buffer_index,this._buffer_index+e)),this._current_word=new DataView(n.buffer).getUint32(0,!1),this._buffer_index+=e,this._current_word_bits_left=8*e}},{key:"readBits",value:function(t){if(t>32)throw new a.InvalidArgumentException("ExpGolomb: readBits() bits exceeded max 32bits!");if(t<=this._current_word_bits_left){var e=this._current_word>>>32-t;return this._current_word<<=t,this._current_word_bits_left-=t,e}var n=this._current_word_bits_left?this._current_word:0;n>>>=32-this._current_word_bits_left;var r=t-this._current_word_bits_left;this._fillCurrentWord();var i=Math.min(r,this._current_word_bits_left),o=this._current_word>>>32-i;return this._current_word<<=i,this._current_word_bits_left-=i,n=n<<i|o}},{key:"readBool",value:function(){return 1===this.readBits(1)}},{key:"readByte",value:function(){return this.readBits(8)}},{key:"_skipLeadingZero",value:function(){var t=void 0;for(t=0;t<this._current_word_bits_left;t++)if(0!=(this._current_word&2147483648>>>t))return this._current_word<<=t,this._current_word_bits_left-=t,t;return this._fillCurrentWord(),t+this._skipLeadingZero()}},{key:"readUEG",value:function(){var t=this._skipLeadingZero();return this.readBits(t+1)-1}},{key:"readSEG",value:function(){var t=this.readUEG();return 1&t?t+1>>>1:-1*(t>>>1)}}]),t}();n.default=o},{"../utils/exception.js":40}],18:[function(t,e,n){function r(t){return t&&t.__esModule?t:{default:t}}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){return t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3]}Object.defineProperty(n,"__esModule",{value:!0});var o="function"==typeof y.default&&"symbol"===(0,I.default)(g.default)?function(t){return void 0===t?"undefined":(0,I.default)(t)}:function(t){return t&&"function"==typeof y.default&&t.constructor===y.default&&t!==y.default.prototype?"symbol":void 0===t?"undefined":(0,I.default)(t)},s=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),(0,S.default)(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),u=t("../utils/logger.js"),l=r(u),c=t("./amf-parser.js"),d=r(c),h=t("./sps-parser.js"),f=r(h),p=t("./demux-errors.js"),m=r(p),v=t("../core/media-info.js"),_=r(v),b=t("../utils/exception.js"),E=function(){function t(e,n){i(this,t),this.TAG="FLVDemuxer",this._config=n,this._onError=null,this._onMediaInfo=null,this._onTrackMetadata=null,this._onDataAvailable=null,this._dataOffset=e.dataOffset,this._firstParse=!0,this._dispatch=!1,this._hasAudio=e.hasAudioTrack,this._hasVideo=e.hasVideoTrack,this._hasAudioFlagOverrided=!1,this._hasVideoFlagOverrided=!1,this._audioInitialMetadataDispatched=!1,this._videoInitialMetadataDispatched=!1,this._mediaInfo=new _.default,this._mediaInfo.hasAudio=this._hasAudio,this._mediaInfo.hasVideo=this._hasVideo,this._metadata=null,this._audioMetadata=null,this._videoMetadata=null,this._naluLengthSize=4,this._timestampBase=0,this._timescale=1e3,this._duration=0,this._durationOverrided=!1,this._referenceFrameRate={fixed:!0,fps:23.976,fps_num:23976,fps_den:1e3},this._flvSoundRateTable=[5500,11025,22050,44100,48e3],this._mpegSamplingRates=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],this._mpegAudioV10SampleRateTable=[44100,48e3,32e3,0],this._mpegAudioV20SampleRateTable=[22050,24e3,16e3,0],this._mpegAudioV25SampleRateTable=[11025,12e3,8e3,0],this._mpegAudioL1BitRateTable=[0,32,64,96,128,160,192,224,256,288,320,352,384,416,448,-1],this._mpegAudioL2BitRateTable=[0,32,48,56,64,80,96,112,128,160,192,224,256,320,384,-1],this._mpegAudioL3BitRateTable=[0,32,40,48,56,64,80,96,112,128,160,192,224,256,320,-1],this._videoTrack={type:"video",id:1,sequenceNumber:0,samples:[],length:0},this._audioTrack={type:"audio",id:2,sequenceNumber:0,samples:[],length:0},this._littleEndian=function(){var t=new ArrayBuffer(2);return new DataView(t).setInt16(0,256,!0),256===new Int16Array(t)[0]}()}return s(t,[{key:"destroy",value:function(){this._mediaInfo=null,this._metadata=null,this._audioMetadata=null,this._videoMetadata=null,this._videoTrack=null,this._audioTrack=null,this._onError=null,this._onMediaInfo=null,this._onTrackMetadata=null,this._onDataAvailable=null}},{key:"bindDataSource",value:function(t){return t.onDataArrival=this.parseChunks.bind(this),this}},{key:"resetMediaInfo",value:function(){this._mediaInfo=new _.default}},{key:"_isInitialMetadataDispatched",value:function(){return this._hasAudio&&this._hasVideo?this._audioInitialMetadataDispatched&&this._videoInitialMetadataDispatched:this._hasAudio&&!this._hasVideo?this._audioInitialMetadataDispatched:!(this._hasAudio||!this._hasVideo)&&this._videoInitialMetadataDispatched}},{key:"parseChunks",value:function(e,n){if(!(this._onError&&this._onMediaInfo&&this._onTrackMetadata&&this._onDataAvailable))throw new b.IllegalStateException("Flv: onError & onMediaInfo & onTrackMetadata & onDataAvailable callback must be specified");var r=0,i=this._littleEndian;if(0===n){if(!(e.byteLength>13))return 0;r=t.probe(e).dataOffset}if(this._firstParse){this._firstParse=!1,n+r!==this._dataOffset&&l.default.w(this.TAG,"First time parsing but chunk byteStart invalid!");0!==new DataView(e,r).getUint32(0,!i)&&l.default.w(this.TAG,"PrevTagSize0 !== 0 !!!"),r+=4}for(;r<e.byteLength;){this._dispatch=!0;var a=new DataView(e,r);if(r+11+4>e.byteLength)break;var o=a.getUint8(0),s=16777215&a.getUint32(0,!i);if(r+11+s+4>e.byteLength)break;if(8===o||9===o||18===o){var u=a.getUint8(4),c=a.getUint8(5),d=a.getUint8(6),h=a.getUint8(7),f=d|c<<8|u<<16|h<<24;0!==(16777215&a.getUint32(7,!i))&&l.default.w(this.TAG,"Meet tag which has StreamID != 0!");var p=r+11;switch(o){case 8:this._parseAudioData(e,p,s,f);break;case 9:this._parseVideoData(e,p,s,f,n+r);break;case 18:this._parseScriptData(e,p,s)}var m=a.getUint32(11+s,!i);m!==11+s&&l.default.w(this.TAG,"Invalid PrevTagSize "+m),r+=11+s+4}else l.default.w(this.TAG,"Unsupported tag type "+o+", skipped"),r+=11+s+4}return this._isInitialMetadataDispatched()&&this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack),r}},{key:"_parseScriptData",value:function(t,e,n){var r=d.default.parseScriptData(t,e,n);if(r.hasOwnProperty("onMetaData")){if(null==r.onMetaData||"object"!==o(r.onMetaData))return void l.default.w(this.TAG,"Invalid onMetaData structure!");this._metadata&&l.default.w(this.TAG,"Found another onMetaData tag!"),this._metadata=r;var i=this._metadata.onMetaData;if("boolean"==typeof i.hasAudio&&!1===this._hasAudioFlagOverrided&&(this._hasAudio=i.hasAudio,this._mediaInfo.hasAudio=this._hasAudio),"boolean"==typeof i.hasVideo&&!1===this._hasVideoFlagOverrided&&(this._hasVideo=i.hasVideo,this._mediaInfo.hasVideo=this._hasVideo),"number"==typeof i.audiodatarate&&(this._mediaInfo.audioDataRate=i.audiodatarate),"number"==typeof i.videodatarate&&(this._mediaInfo.videoDataRate=i.videodatarate),"number"==typeof i.width&&(this._mediaInfo.width=i.width),"number"==typeof i.height&&(this._mediaInfo.height=i.height),"number"==typeof i.duration){if(!this._durationOverrided){var a=Math.floor(i.duration*this._timescale);this._duration=a,this._mediaInfo.duration=a}}else this._mediaInfo.duration=0;if("number"==typeof i.framerate){var s=Math.floor(1e3*i.framerate);if(s>0){var u=s/1e3;this._referenceFrameRate.fixed=!0,this._referenceFrameRate.fps=u,this._referenceFrameRate.fps_num=s,this._referenceFrameRate.fps_den=1e3,this._mediaInfo.fps=u}}if("object"===o(i.keyframes)){this._mediaInfo.hasKeyframesIndex=!0;var c=i.keyframes;this._mediaInfo.keyframesIndex=this._parseKeyframesIndex(c),i.keyframes=null}else this._mediaInfo.hasKeyframesIndex=!1;this._dispatch=!1,this._mediaInfo.metadata=i,l.default.v(this.TAG,"Parsed onMetaData"),this._mediaInfo.isComplete()&&this._onMediaInfo(this._mediaInfo)}}},{key:"_parseKeyframesIndex",value:function(t){for(var e=[],n=[],r=1;r<t.times.length;r++){var i=this._timestampBase+Math.floor(1e3*t.times[r]);e.push(i),n.push(t.filepositions[r])}return{times:e,filepositions:n}}},{key:"_parseAudioData",value:function(t,e,n,r){if(n<=1)return void l.default.w(this.TAG,"Flv: Invalid audio packet, missing SoundData payload!");if(!0!==this._hasAudioFlagOverrided||!1!==this._hasAudio){var i=(this._littleEndian,new DataView(t,e,n)),a=i.getUint8(0),o=a>>>4;if(2!==o&&10!==o)return void this._onError(m.default.CODEC_UNSUPPORTED,"Flv: Unsupported audio codec idx: "+o);var s=0,u=(12&a)>>>2;if(!(u>=0&&u<=4))return void this._onError(m.default.FORMAT_ERROR,"Flv: Invalid audio sample rate idx: "+u);s=this._flvSoundRateTable[u];var c=1&a,d=this._audioMetadata,h=this._audioTrack;if(d||(!1===this._hasAudio&&!1===this._hasAudioFlagOverrided&&(this._hasAudio=!0,this._mediaInfo.hasAudio=!0),d=this._audioMetadata={},d.type="audio",d.id=h.id,d.timescale=this._timescale,d.duration=this._duration,d.audioSampleRate=s,d.channelCount=0===c?1:2),10===o){var f=this._parseAACAudioData(t,e+1,n-1);if(void 0==f)return;if(0===f.packetType){d.config&&l.default.w(this.TAG,"Found another AudioSpecificConfig!");var p=f.data;d.audioSampleRate=p.samplingRate,d.channelCount=p.channelCount,d.codec=p.codec,d.originalCodec=p.originalCodec,d.config=p.config,d.refSampleDuration=1024/d.audioSampleRate*d.timescale,l.default.v(this.TAG,"Parsed AudioSpecificConfig"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._audioInitialMetadataDispatched=!0,this._dispatch=!1,this._onTrackMetadata("audio",d);var g=this._mediaInfo;g.audioCodec=d.originalCodec,g.audioSampleRate=d.audioSampleRate,g.audioChannelCount=d.channelCount,g.hasVideo?null!=g.videoCodec&&(g.mimeType='video/x-flv; codecs="'+g.videoCodec+","+g.audioCodec+'"'):g.mimeType='video/x-flv; codecs="'+g.audioCodec+'"',g.isComplete()&&this._onMediaInfo(g)}else if(1===f.packetType){var v=this._timestampBase+r,y={unit:f.data,length:f.data.byteLength,dts:v,pts:v};h.samples.push(y),h.length+=f.data.length}else l.default.e(this.TAG,"Flv: Unsupported AAC data type "+f.packetType)}else if(2===o){if(!d.codec){var _=this._parseMP3AudioData(t,e+1,n-1,!0);if(void 0==_)return;d.audioSampleRate=_.samplingRate,d.channelCount=_.channelCount,d.codec=_.codec,d.originalCodec=_.originalCodec,d.refSampleDuration=1152/d.audioSampleRate*d.timescale,l.default.v(this.TAG,"Parsed MPEG Audio Frame Header"),this._audioInitialMetadataDispatched=!0,this._onTrackMetadata("audio",d);var b=this._mediaInfo;b.audioCodec=d.codec,b.audioSampleRate=d.audioSampleRate,b.audioChannelCount=d.channelCount,b.audioDataRate=_.bitRate,b.hasVideo?null!=b.videoCodec&&(b.mimeType='video/x-flv; codecs="'+b.videoCodec+","+b.audioCodec+'"'):b.mimeType='video/x-flv; codecs="'+b.audioCodec+'"',b.isComplete()&&this._onMediaInfo(b)}var E=this._parseMP3AudioData(t,e+1,n-1,!1);if(void 0==E)return;var w=this._timestampBase+r,A={unit:E,length:E.byteLength,dts:w,pts:w};h.samples.push(A),h.length+=E.length}}}},{key:"_parseAACAudioData",value:function(t,e,n){if(n<=1)return void l.default.w(this.TAG,"Flv: Invalid AAC packet, missing AACPacketType or/and Data!");var r={},i=new Uint8Array(t,e,n);return r.packetType=i[0],0===i[0]?r.data=this._parseAACAudioSpecificConfig(t,e+1,n-1):r.data=i.subarray(1),r}},{key:"_parseAACAudioSpecificConfig",value:function(t,e,n){var r=new Uint8Array(t,e,n),i=null,a=0,o=0,s=0,u=null;if(a=o=r[0]>>>3,(s=(7&r[0])<<1|r[1]>>>7)<0||s>=this._mpegSamplingRates.length)return void this._onError(m.default.FORMAT_ERROR,"Flv: AAC invalid sampling frequency index!");var l=this._mpegSamplingRates[s],c=(120&r[1])>>>3;if(c<0||c>=8)return void this._onError(m.default.FORMAT_ERROR,"Flv: AAC invalid channel configuration");5===a&&(u=(7&r[1])<<1|r[2]>>>7,r[2]);var d=self.navigator.userAgent.toLowerCase();return-1!==d.indexOf("firefox")?s>=6?(a=5,i=new Array(4),u=s-3):(a=2,i=new Array(2),u=s):-1!==d.indexOf("android")?(a=2,i=new Array(2),u=s):(a=5,u=s,i=new Array(4),s>=6?u=s-3:1===c&&(a=2,i=new Array(2),u=s)),i[0]=a<<3,i[0]|=(15&s)>>>1,i[1]=(15&s)<<7,i[1]|=(15&c)<<3,5===a&&(i[1]|=(15&u)>>>1,i[2]=(1&u)<<7,i[2]|=8,i[3]=0),{config:i,samplingRate:l,channelCount:c,codec:"mp4a.40."+a,originalCodec:"mp4a.40."+o}}},{key:"_parseMP3AudioData",value:function(t,e,n,r){if(n<4)return void l.default.w(this.TAG,"Flv: Invalid MP3 packet, header missing!");var i=(this._littleEndian,new Uint8Array(t,e,n)),a=null;if(r){if(255!==i[0])return;var o=i[1]>>>3&3,s=(6&i[1])>>1,u=(240&i[2])>>>4,c=(12&i[2])>>>2,d=i[3]>>>6&3,h=3!==d?2:1,f=0,p=0;switch(o){case 0:f=this._mpegAudioV25SampleRateTable[c];break;case 2:f=this._mpegAudioV20SampleRateTable[c];break;case 3:f=this._mpegAudioV10SampleRateTable[c]}switch(s){case 1:34,u<this._mpegAudioL3BitRateTable.length&&(p=this._mpegAudioL3BitRateTable[u]);break;case 2:33,u<this._mpegAudioL2BitRateTable.length&&(p=this._mpegAudioL2BitRateTable[u]);break;case 3:32,u<this._mpegAudioL1BitRateTable.length&&(p=this._mpegAudioL1BitRateTable[u])}a={bitRate:p,samplingRate:f,channelCount:h,codec:"mp3",originalCodec:"mp3"}}else a=i;return a}},{key:"_parseVideoData",value:function(t,e,n,r,i){if(n<=1)return void l.default.w(this.TAG,"Flv: Invalid video packet, missing VideoData payload!");if(!0!==this._hasVideoFlagOverrided||!1!==this._hasVideo){var a=new Uint8Array(t,e,n)[0],o=(240&a)>>>4,s=15&a;if(7!==s)return void this._onError(m.default.CODEC_UNSUPPORTED,"Flv: Unsupported codec in video frame: "+s);this._parseAVCVideoPacket(t,e+1,n-1,r,i,o)}}},{key:"_parseAVCVideoPacket",value:function(t,e,n,r,i,a){if(n<4)return void l.default.w(this.TAG,"Flv: Invalid AVC packet, missing AVCPacketType or/and CompositionTime");var o=this._littleEndian,s=new DataView(t,e,n),u=s.getUint8(0),c=16777215&s.getUint32(0,!o),d=c<<8>>8;if(0===u)this._parseAVCDecoderConfigurationRecord(t,e+4,n-4);else if(1===u)this._parseAVCVideoData(t,e+4,n-4,r,i,a,d);else if(2!==u)return void this._onError(m.default.FORMAT_ERROR,"Flv: Invalid video packet type "+u)}},{key:"_parseAVCDecoderConfigurationRecord",value:function(t,e,n){if(n<7)return void l.default.w(this.TAG,"Flv: Invalid AVCDecoderConfigurationRecord, lack of data!");var r=this._videoMetadata,i=this._videoTrack,a=this._littleEndian,o=new DataView(t,e,n);r?void 0!==r.avcc&&l.default.w(this.TAG,"Found another AVCDecoderConfigurationRecord!"):(!1===this._hasVideo&&!1===this._hasVideoFlagOverrided&&(this._hasVideo=!0,this._mediaInfo.hasVideo=!0),r=this._videoMetadata={},r.type="video",r.id=i.id,r.timescale=this._timescale,r.duration=this._duration);var s=o.getUint8(0),u=o.getUint8(1);o.getUint8(2),o.getUint8(3);if(1!==s||0===u)return void this._onError(m.default.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord");if(this._naluLengthSize=1+(3&o.getUint8(4)),3!==this._naluLengthSize&&4!==this._naluLengthSize)return void this._onError(m.default.FORMAT_ERROR,"Flv: Strange NaluLengthSizeMinusOne: "+(this._naluLengthSize-1));var c=31&o.getUint8(5);if(0===c)return void this._onError(m.default.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord: No SPS");c>1&&l.default.w(this.TAG,"Flv: Strange AVCDecoderConfigurationRecord: SPS Count = "+c);for(var d=6,h=0;h<c;h++){var p=o.getUint16(d,!a);if(d+=2,0!==p){var g=new Uint8Array(t,e+d,p);d+=p;var v=f.default.parseSPS(g);if(0===h){r.codecWidth=v.codec_size.width,r.codecHeight=v.codec_size.height,r.presentWidth=v.present_size.width,r.presentHeight=v.present_size.height,r.profile=v.profile_string,r.level=v.level_string,r.bitDepth=v.bit_depth,r.chromaFormat=v.chroma_format,r.sarRatio=v.sar_ratio,r.frameRate=v.frame_rate,!1!==v.frame_rate.fixed&&0!==v.frame_rate.fps_num&&0!==v.frame_rate.fps_den||(r.frameRate=this._referenceFrameRate);var y=r.frameRate.fps_den,_=r.frameRate.fps_num;r.refSampleDuration=r.timescale*(y/_);for(var b=g.subarray(1,4),E="avc1.",w=0;w<3;w++){var A=b[w].toString(16);A.length<2&&(A="0"+A),E+=A}r.codec=E;var S=this._mediaInfo;S.width=r.codecWidth,S.height=r.codecHeight,S.fps=r.frameRate.fps,S.profile=r.profile,S.level=r.level,S.refFrames=v.ref_frames,S.chromaFormat=v.chroma_format_string,S.sarNum=r.sarRatio.width,S.sarDen=r.sarRatio.height,S.videoCodec=E,S.hasAudio?null!=S.audioCodec&&(S.mimeType='video/x-flv; codecs="'+S.videoCodec+","+S.audioCodec+'"'):S.mimeType='video/x-flv; codecs="'+S.videoCodec+'"',S.isComplete()&&this._onMediaInfo(S)}}}var T=o.getUint8(d);if(0===T)return void this._onError(m.default.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord: No PPS");T>1&&l.default.w(this.TAG,"Flv: Strange AVCDecoderConfigurationRecord: PPS Count = "+T),d++;for(var x=0;x<T;x++){var k=o.getUint16(d,!a);d+=2,0!==k&&(d+=k)}r.avcc=new Uint8Array(n),r.avcc.set(new Uint8Array(t,e,n),0),l.default.v(this.TAG,"Parsed AVCDecoderConfigurationRecord"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._videoInitialMetadataDispatched=!0,this._dispatch=!1,this._onTrackMetadata("video",r)}},{key:"_parseAVCVideoData",value:function(t,e,n,r,i,a,o){for(var s=this._littleEndian,u=new DataView(t,e,n),c=[],d=0,h=0,f=this._naluLengthSize,p=this._timestampBase+r,m=1===a;h<n;){if(h+4>=n){l.default.w(this.TAG,"Malformed Nalu near timestamp "+p+", offset = "+h+", dataSize = "+n);break}var g=u.getUint32(h,!s);if(3===f&&(g>>>=8),g>n-f)return void l.default.w(this.TAG,"Malformed Nalus near timestamp "+p+", NaluSize > DataSize!");var v=31&u.getUint8(h+f);5===v&&(m=!0);var y=new Uint8Array(t,e+h,f+g),_={type:v,data:y};c.push(_),d+=y.byteLength,h+=f+g}if(c.length){var b=this._videoTrack,E={units:c,length:d,isKeyframe:m,dts:p,cts:o,pts:p+o};m&&(E.fileposition=i),b.samples.push(E),b.length+=d}}},{key:"onTrackMetadata",get:function(){return this._onTrackMetadata},set:function(t){this._onTrackMetadata=t}},{key:"onMediaInfo",get:function(){return this._onMediaInfo},set:function(t){this._onMediaInfo=t}},{key:"onError",get:function(){return this._onError},set:function(t){this._onError=t}},{key:"onDataAvailable",get:function(){return this._onDataAvailable},set:function(t){this._onDataAvailable=t}},{key:"timestampBase",get:function(){return this._timestampBase},set:function(t){this._timestampBase=t}},{key:"overridedDuration",get:function(){return this._duration},set:function(t){this._durationOverrided=!0,this._duration=t,this._mediaInfo.duration=t}},{key:"overridedHasAudio",set:function(t){this._hasAudioFlagOverrided=!0,this._hasAudio=t,this._mediaInfo.hasAudio=t}},{key:"overridedHasVideo",set:function(t){this._hasVideoFlagOverrided=!0,this._hasVideo=t,this._mediaInfo.hasVideo=t}}],[{key:"probe",value:function(t){var e=new Uint8Array(t),n={match:!1};if(70!==e[0]||76!==e[1]||86!==e[2]||1!==e[3])return n;var r=(4&e[4])>>>2!=0,i=0!=(1&e[4]),o=a(e,5);return o<9?n:{match:!0,consumed:o,dataOffset:o,hasAudioTrack:r,hasVideoTrack:i}}}]),t}();n.default=E},{"../core/media-info.js":7,"../utils/exception.js":40,"../utils/logger.js":41,"./amf-parser.js":15,"./demux-errors.js":16,"./sps-parser.js":19}],19:[function(t,e,n){function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),(0,S.default)(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),a=t("./exp-golomb.js"),o=function(t){return t&&t.__esModule?t:{default:t}}(a),s=function(){function t(){r(this,t)}return i(t,null,[{key:"_ebsp2rbsp",value:function(t){for(var e=t,n=e.byteLength,r=new Uint8Array(n),i=0,a=0;a<n;a++)a>=2&&3===e[a]&&0===e[a-1]&&0===e[a-2]||(r[i]=e[a],i++);return new Uint8Array(r.buffer,0,i)}},{key:"parseSPS",value:function(e){var n=t._ebsp2rbsp(e),r=new o.default(n);r.readByte();var i=r.readByte();r.readByte();var a=r.readByte();r.readUEG();var s=t.getProfileString(i),u=t.getLevelString(a),l=1,c=420,d=[0,420,422,444],h=8;if((100===i||110===i||122===i||244===i||44===i||83===i||86===i||118===i||128===i||138===i||144===i)&&(l=r.readUEG(),3===l&&r.readBits(1),l<=3&&(c=d[l]),h=r.readUEG()+8,r.readUEG(),r.readBits(1),r.readBool()))for(var f=3!==l?8:12,p=0;p<f;p++)r.readBool()&&(p<6?t._skipScalingList(r,16):t._skipScalingList(r,64));r.readUEG();var m=r.readUEG();if(0===m)r.readUEG();else if(1===m){r.readBits(1),r.readSEG(),r.readSEG();for(var g=r.readUEG(),v=0;v<g;v++)r.readSEG()}var y=r.readUEG();r.readBits(1);var _=r.readUEG(),b=r.readUEG(),E=r.readBits(1);0===E&&r.readBits(1),r.readBits(1);var w=0,A=0,S=0,T=0;r.readBool()&&(w=r.readUEG(),A=r.readUEG(),S=r.readUEG(),T=r.readUEG());var x=1,k=1,C=0,M=!0,R=0,L=0;if(r.readBool()){if(r.readBool()){var I=r.readByte(),P=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2],O=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1];I>0&&I<16?(x=P[I-1],k=O[I-1]):255===I&&(x=r.readByte()<<8|r.readByte(),k=r.readByte()<<8|r.readByte())}if(r.readBool()&&r.readBool(),r.readBool()&&(r.readBits(4),r.readBool()&&r.readBits(24)),r.readBool()&&(r.readUEG(),r.readUEG()),r.readBool()){var D=r.readBits(32),N=r.readBits(32);M=r.readBool(),R=N,L=2*D,C=R/L}}var U=1;1===x&&1===k||(U=x/k);var F=0,B=0;if(0===l)F=1,B=2-E;else{var j=3===l?1:2,V=1===l?2:1;F=j,B=V*(2-E)}var G=16*(_+1),z=16*(b+1)*(2-E);G-=(w+A)*F,z-=(S+T)*B;var H=Math.ceil(G*U);return r.destroy(),r=null,{profile_string:s,level_string:u,bit_depth:h,ref_frames:y,chroma_format:c,chroma_format_string:t.getChromaFormatString(c),frame_rate:{fixed:M,fps:C,fps_den:L,fps_num:R},sar_ratio:{width:x,height:k},codec_size:{width:G,height:z},present_size:{width:H,height:z}}}},{key:"_skipScalingList",value:function(t,e){for(var n=8,r=8,i=0,a=0;a<e;a++)0!==r&&(i=t.readSEG(),r=(n+i+256)%256),n=0===r?n:r}},{key:"getProfileString",value:function(t){switch(t){case 66:return"Baseline";case 77:return"Main";case 88:return"Extended";case 100:return"High";case 110:return"High10";case 122:return"High422";case 244:return"High444";default:return"Unknown"}}},{key:"getLevelString",value:function(t){return(t/10).toFixed(1)}},{key:"getChromaFormatString",value:function(t){switch(t){case 420:return"4:2:0";case 422:return"4:2:2";case 444:return"4:4:4";default:return"Unknown"}}}]),t}();n.default=s},{"./exp-golomb.js":17}],20:[function(t,e,n){function r(t){return t&&t.__esModule?t:{default:t}}function i(t,e){var n=t;if(null==n||"object"!==(void 0===n?"undefined":s(n)))throw new A.InvalidArgumentException("MediaDataSource must be an javascript object!");if(!n.hasOwnProperty("type"))throw new A.InvalidArgumentException("MediaDataSource must has type field to indicate video file type!");switch(n.type){case"flv":return new f.default(n,e);default:return new m.default(n,e)}}function a(){return d.default.supportMSEH264Playback()}function o(){return d.default.getFeatureList()}Object.defineProperty(n,"__esModule",{value:!0});var s="function"==typeof y.default&&"symbol"===(0,I.default)(g.default)?function(t){return void 0===t?"undefined":(0,I.default)(t)}:function(t){return t&&"function"==typeof y.default&&t.constructor===y.default&&t!==y.default.prototype?"symbol":void 0===t?"undefined":(0,I.default)(t)},u=t("./utils/polyfill.js"),l=r(u),c=t("./core/features.js"),d=r(c),h=t("./player/flv-player.js"),f=r(h),p=t("./player/native-player.js"),m=r(p),v=t("./player/player-events.js"),_=r(v),b=t("./player/player-errors.js"),E=t("./utils/logging-control.js"),w=r(E),A=t("./utils/exception.js");l.default.install();var S={};S.createPlayer=i,S.isSupported=a,S.getFeatureList=o,S.Events=_.default,S.ErrorTypes=b.ErrorTypes,S.ErrorDetails=b.ErrorDetails,S.FlvPlayer=f.default,S.NativePlayer=m.default,S.LoggingControl=w.default,Object.defineProperty(S,"version",{enumerable:!0,get:function(){return"1.4.2"}}),n.default=S},{"./core/features.js":6,"./player/flv-player.js":32,"./player/native-player.js":33,"./player/player-errors.js":34,"./player/player-events.js":35,"./utils/exception.js":40,"./utils/logging-control.js":42,"./utils/polyfill.js":43}],21:[function(t,e,n){e.exports=t("./flv.js").default},{"./flv.js":20}],22:[function(t,e,n){function r(t){return t&&t.__esModule?t:{default:t}}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==(void 0===e?"undefined":(0,I.default)(e))&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+(void 0===e?"undefined":(0,I.default)(e)));t.prototype=(0,c.default)(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(b.default?(0,b.default)(t,e):t.__proto__=e)}Object.defineProperty(n,"__esModule",{value:!0});var s="function"==typeof y.default&&"symbol"===(0,I.default)(g.default)?function(t){return void 0===t?"undefined":(0,I.default)(t)}:function(t){return t&&"function"==typeof y.default&&t.constructor===y.default&&t!==y.default.prototype?"symbol":void 0===t?"undefined":(0,I.default)(t)},u=function w(t,e,n){null===t&&(t=Function.prototype);var r=(0,p.default)(t,e);if(void 0===r){var i=(0,h.default)(t);return null===i?void 0:w(i,e,n)}if("value"in r)return r.value;var a=r.get;if(void 0!==a)return a.call(n)},l=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),(0,S.default)(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),d=t("../utils/logger.js"),f=(r(d),t("../utils/browser.js")),m=r(f),v=t("./loader.js"),_=t("../utils/exception.js"),E=function(t){function e(t,n){i(this,e);var r=a(this,(e.__proto__||(0,h.default)(e)).call(this,"fetch-stream-loader"));return r.TAG="FetchStreamLoader",r._seekHandler=t,r._config=n,r._needStash=!0,r._requestAbort=!1,r._contentLength=null,r._receivedLength=0,r}return o(e,t),l(e,null,[{key:"isSupported",value:function(){try{var t=m.default.msedge&&m.default.version.minor>=15048,e=!m.default.msedge||t;return self.fetch&&self.ReadableStream&&e}catch(n){return!1}}}]),l(e,[{key:"destroy",value:function(){this.isWorking()&&this.abort(),u(e.prototype.__proto__||(0,h.default)(e.prototype),"destroy",this).call(this)}},{key:"open",value:function(t,e){var n=this;this._dataSource=t,this._range=e;var r=t.url;this._config.reuseRedirectedURL&&void 0!=t.redirectedURL&&(r=t.redirectedURL);var i=this._seekHandler.getConfig(r,e),a=new self.Headers;if("object"===s(i.headers)){var o=i.headers;for(var u in o)o.hasOwnProperty(u)&&a.append(u,o[u])}var l={method:"GET",headers:a,mode:"cors",cache:"default",referrerPolicy:"no-referrer-when-downgrade"};!1===t.cors&&(l.mode="same-origin"),t.withCredentials&&(l.credentials="include"),t.referrerPolicy&&(l.referrerPolicy=t.referrerPolicy),this._status=v.LoaderStatus.kConnecting,self.fetch(i.url,l).then(function(t){if(n._requestAbort)return n._requestAbort=!1,void(n._status=v.LoaderStatus.kIdle);if(t.ok&&t.status>=200&&t.status<=299){if(t.url!==i.url&&n._onURLRedirect){var e=n._seekHandler.removeURLParameters(t.url);n._onURLRedirect(e)}var r=t.headers.get("Content-Length");return null!=r&&(n._contentLength=parseInt(r),0!==n._contentLength&&n._onContentLengthKnown&&n._onContentLengthKnown(n._contentLength)),n._pump.call(n,t.body.getReader())}if(n._status=v.LoaderStatus.kError,!n._onError)throw new _.RuntimeException("FetchStreamLoader: Http code invalid, "+t.status+" "+t.statusText);n._onError(v.LoaderErrors.HTTP_STATUS_CODE_INVALID,{code:t.status,msg:t.statusText})}).catch(function(t){if(n._status=v.LoaderStatus.kError,!n._onError)throw t;n._onError(v.LoaderErrors.EXCEPTION,{code:-1,msg:t.message})})}},{key:"abort",value:function(){this._requestAbort=!0}},{key:"_pump",value:function(t){var e=this;return t.read().then(function(n){if(n.done)if(null!==e._contentLength&&e._receivedLength<e._contentLength){e._status=v.LoaderStatus.kError;var r=v.LoaderErrors.EARLY_EOF,i={code:-1,msg:"Fetch stream meet Early-EOF"};if(!e._onError)throw new _.RuntimeException(i.msg);e._onError(r,i)}else e._status=v.LoaderStatus.kComplete,e._onComplete&&e._onComplete(e._range.from,e._range.from+e._receivedLength-1);else{if(!0===e._requestAbort)return e._requestAbort=!1,e._status=v.LoaderStatus.kComplete,t.cancel();e._status=v.LoaderStatus.kBuffering;var a=n.value.buffer,o=e._range.from+e._receivedLength;e._receivedLength+=a.byteLength,e._onDataArrival&&e._onDataArrival(a,o,e._receivedLength),e._pump(t)}}).catch(function(t){if(11!==t.code||!m.default.msedge){e._status=v.LoaderStatus.kError;var n=0,r=null;if(19!==t.code&&"network error"!==t.message||!(null===e._contentLength||null!==e._contentLength&&e._receivedLength<e._contentLength)?(n=v.LoaderErrors.EXCEPTION,r={code:t.code,msg:t.message}):(n=v.LoaderErrors.EARLY_EOF,r={code:t.code,msg:"Fetch stream meet Early-EOF"}),!e._onError)throw new _.RuntimeException(r.msg);e._onError(n,r)}})}}]),e}(v.BaseLoader);n.default=E},{"../utils/browser.js":39,"../utils/exception.js":40,"../utils/logger.js":41,"./loader.js":24}],23:[function(t,e,n){function r(t){return t&&t.__esModule?t:{default:t}}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),(0,S.default)(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=t("../utils/logger.js"),s=r(o),u=t("./speed-sampler.js"),l=r(u),c=t("./loader.js"),d=t("./fetch-stream-loader.js"),h=r(d),f=t("./xhr-moz-chunked-loader.js"),p=r(f),m=t("./xhr-msstream-loader.js"),g=(r(m),t("./xhr-range-loader.js")),v=r(g),y=t("./websocket-loader.js"),_=r(y),b=t("./range-seek-handler.js"),E=r(b),w=t("./param-seek-handler.js"),A=r(w),T=t("../utils/exception.js"),k=function(){function t(e,n,r){i(this,t),this.TAG="IOController",this._config=n,this._extraData=r,this._stashInitialSize=393216,void 0!=n.stashInitialSize&&n.stashInitialSize>0&&(this._stashInitialSize=n.stashInitialSize),this._stashUsed=0,this._stashSize=this._stashInitialSize,this._bufferSize=3145728,this._stashBuffer=new ArrayBuffer(this._bufferSize),this._stashByteStart=0,this._enableStash=!0,!1===n.enableStashBuffer&&(this._enableStash=!1),this._loader=null,this._loaderClass=null,this._seekHandler=null,this._dataSource=e,this._isWebSocketURL=/wss?:\/\/(.+?)/.test(e.url),this._refTotalLength=e.filesize?e.filesize:null,this._totalLength=this._refTotalLength,this._fullRequestFlag=!1,this._currentRange=null,this._redirectedURL=null,this._speedNormalized=0,this._speedSampler=new l.default,this._speedNormalizeList=[64,128,256,384,512,768,1024,1536,2048,3072,4096],this._isEarlyEofReconnecting=!1,this._paused=!1,this._resumeFrom=0,this._onDataArrival=null,this._onSeeked=null,this._onError=null,this._onComplete=null,this._onRedirect=null,this._onRecoveredEarlyEof=null,this._selectSeekHandler(),this._selectLoader(),this._createLoader()}return a(t,[{key:"destroy",value:function(){this._loader.isWorking()&&this._loader.abort(),this._loader.destroy(),this._loader=null,this._loaderClass=null,this._dataSource=null,this._stashBuffer=null,this._stashUsed=this._stashSize=this._bufferSize=this._stashByteStart=0,this._currentRange=null,this._speedSampler=null,this._isEarlyEofReconnecting=!1,this._onDataArrival=null,this._onSeeked=null,this._onError=null,this._onComplete=null,this._onRedirect=null,this._onRecoveredEarlyEof=null,this._extraData=null}},{key:"isWorking",value:function(){return this._loader&&this._loader.isWorking()&&!this._paused}},{key:"isPaused",value:function(){return this._paused}},{key:"_selectSeekHandler",value:function(){var t=this._config;if("range"===t.seekType)this._seekHandler=new E.default(this._config.rangeLoadZeroStart);else if("param"===t.seekType){var e=t.seekParamStart||"bstart",n=t.seekParamEnd||"bend";this._seekHandler=new A.default(e,n)}else{if("custom"!==t.seekType)throw new T.InvalidArgumentException("Invalid seekType in config: "+t.seekType);if("function"!=typeof t.customSeekHandler)throw new T.InvalidArgumentException("Custom seekType specified in config but invalid customSeekHandler!");this._seekHandler=new t.customSeekHandler}}},{key:"_selectLoader",value:function(){if(this._isWebSocketURL)this._loaderClass=_.default;else if(h.default.isSupported())this._loaderClass=h.default;else if(p.default.isSupported())this._loaderClass=p.default;else{if(!v.default.isSupported())throw new T.RuntimeException("Your browser doesn't support xhr with arraybuffer responseType!");this._loaderClass=v.default}}},{key:"_createLoader",value:function(){this._loader=new this._loaderClass(this._seekHandler,this._config),!1===this._loader.needStashBuffer&&(this._enableStash=!1),this._loader.onContentLengthKnown=this._onContentLengthKnown.bind(this),this._loader.onURLRedirect=this._onURLRedirect.bind(this),this._loader.onDataArrival=this._onLoaderChunkArrival.bind(this),this._loader.onComplete=this._onLoaderComplete.bind(this),this._loader.onError=this._onLoaderError.bind(this)}},{key:"open",value:function(t){this._currentRange={from:0,to:-1},t&&(this._currentRange.from=t),this._speedSampler.reset(),t||(this._fullRequestFlag=!0),this._loader.open(this._dataSource,(0,x.default)({},this._currentRange))}},{key:"abort",value:function(){this._loader.abort(),this._paused&&(this._paused=!1,this._resumeFrom=0)}},{key:"pause",value:function(){this.isWorking()&&(this._loader.abort(),0!==this._stashUsed?(this._resumeFrom=this._stashByteStart,this._currentRange.to=this._stashByteStart-1):this._resumeFrom=this._currentRange.to+1,this._stashUsed=0,this._stashByteStart=0,this._paused=!0)}},{key:"resume",value:function(){if(this._paused){this._paused=!1;var t=this._resumeFrom;this._resumeFrom=0,this._internalSeek(t,!0)}}},{key:"seek",value:function(t){this._paused=!1,this._stashUsed=0,this._stashByteStart=0,this._internalSeek(t,!0)}},{key:"_internalSeek",value:function(t,e){this._loader.isWorking()&&this._loader.abort(),this._flushStashBuffer(e),this._loader.destroy(),this._loader=null;var n={from:t,to:-1};this._currentRange={from:n.from,to:-1},this._speedSampler.reset(),this._stashSize=this._stashInitialSize,this._createLoader(),this._loader.open(this._dataSource,n),this._onSeeked&&this._onSeeked()}},{key:"updateUrl",value:function(t){if(!t||"string"!=typeof t||0===t.length)throw new T.InvalidArgumentException("Url must be a non-empty string!");this._dataSource.url=t}},{key:"_expandBuffer",value:function(t){for(var e=this._stashSize;e+1048576<t;)e*=2;if((e+=1048576)!==this._bufferSize){var n=new ArrayBuffer(e);if(this._stashUsed>0){var r=new Uint8Array(this._stashBuffer,0,this._stashUsed);new Uint8Array(n,0,e).set(r,0)}this._stashBuffer=n,this._bufferSize=e}}},{key:"_normalizeSpeed",value:function(t){var e=this._speedNormalizeList,n=e.length-1,r=0,i=0,a=n;if(t<e[0])return e[0];for(;i<=a;){if((r=i+Math.floor((a-i)/2))===n||t>=e[r]&&t<e[r+1])return e[r];e[r]<t?i=r+1:a=r-1}}},{key:"_adjustStashSize",value:function(t){var e=0;(e=this._config.isLive?t:t<512?t:t>=512&&t<=1024?Math.floor(1.5*t):2*t)>8192&&(e=8192);var n=1024*e+1048576;this._bufferSize<n&&this._expandBuffer(n),this._stashSize=1024*e}},{key:"_dispatchChunks",value:function(t,e){return this._currentRange.to=e+t.byteLength-1,this._onDataArrival(t,e)}},{key:"_onURLRedirect",value:function(t){this._redirectedURL=t,this._onRedirect&&this._onRedirect(t)}},{key:"_onContentLengthKnown",value:function(t){t&&this._fullRequestFlag&&(this._totalLength=t,this._fullRequestFlag=!1)}},{key:"_onLoaderChunkArrival",value:function(t,e,n){if(!this._onDataArrival)throw new T.IllegalStateException("IOController: No existing consumer (onDataArrival) callback!");if(!this._paused){this._isEarlyEofReconnecting&&(this._isEarlyEofReconnecting=!1,this._onRecoveredEarlyEof&&this._onRecoveredEarlyEof()),this._speedSampler.addBytes(t.byteLength);var r=this._speedSampler.lastSecondKBps;if(0!==r){var i=this._normalizeSpeed(r);this._speedNormalized!==i&&(this._speedNormalized=i,this._adjustStashSize(i))}if(this._enableStash)if(0===this._stashUsed&&0===this._stashByteStart&&(this._stashByteStart=e),this._stashUsed+t.byteLength<=this._stashSize){var a=new Uint8Array(this._stashBuffer,0,this._stashSize);a.set(new Uint8Array(t),this._stashUsed),this._stashUsed+=t.byteLength}else{var o=new Uint8Array(this._stashBuffer,0,this._bufferSize);if(this._stashUsed>0){var s=this._stashBuffer.slice(0,this._stashUsed),u=this._dispatchChunks(s,this._stashByteStart);if(u<s.byteLength){if(u>0){var l=new Uint8Array(s,u);o.set(l,0),this._stashUsed=l.byteLength,this._stashByteStart+=u}}else this._stashUsed=0,this._stashByteStart+=u;this._stashUsed+t.byteLength>this._bufferSize&&(this._expandBuffer(this._stashUsed+t.byteLength),o=new Uint8Array(this._stashBuffer,0,this._bufferSize)),o.set(new Uint8Array(t),this._stashUsed),this._stashUsed+=t.byteLength}else{var c=this._dispatchChunks(t,e);if(c<t.byteLength){var d=t.byteLength-c;d>this._bufferSize&&(this._expandBuffer(d),o=new Uint8Array(this._stashBuffer,0,this._bufferSize)),o.set(new Uint8Array(t,c),0),this._stashUsed+=d,this._stashByteStart=e+c}}}else if(0===this._stashUsed){var h=this._dispatchChunks(t,e);if(h<t.byteLength){var f=t.byteLength-h;f>this._bufferSize&&this._expandBuffer(f);var p=new Uint8Array(this._stashBuffer,0,this._bufferSize);p.set(new Uint8Array(t,h),0),this._stashUsed+=f,this._stashByteStart=e+h}}else{this._stashUsed+t.byteLength>this._bufferSize&&this._expandBuffer(this._stashUsed+t.byteLength);var m=new Uint8Array(this._stashBuffer,0,this._bufferSize);m.set(new Uint8Array(t),this._stashUsed),this._stashUsed+=t.byteLength;var g=this._dispatchChunks(this._stashBuffer.slice(0,this._stashUsed),this._stashByteStart);if(g<this._stashUsed&&g>0){var v=new Uint8Array(this._stashBuffer,g);m.set(v,0)}this._stashUsed-=g,this._stashByteStart+=g}}}},{key:"_flushStashBuffer",value:function(t){if(this._stashUsed>0){var e=this._stashBuffer.slice(0,this._stashUsed),n=this._dispatchChunks(e,this._stashByteStart),r=e.byteLength-n;if(n<e.byteLength){if(!t){if(n>0){var i=new Uint8Array(this._stashBuffer,0,this._bufferSize),a=new Uint8Array(e,n);i.set(a,0),this._stashUsed=a.byteLength,this._stashByteStart+=n}return 0}s.default.w(this.TAG,r+" bytes unconsumed data remain when flush buffer, dropped")}return this._stashUsed=0,this._stashByteStart=0,r}return 0}},{key:"_onLoaderComplete",value:function(t,e){this._flushStashBuffer(!0),this._onComplete&&this._onComplete(this._extraData)}},{key:"_onLoaderError",value:function(t,e){switch(s.default.e(this.TAG,"Loader error, code = "+e.code+", msg = "+e.msg),this._flushStashBuffer(!1),this._isEarlyEofReconnecting&&(this._isEarlyEofReconnecting=!1,t=c.LoaderErrors.UNRECOVERABLE_EARLY_EOF),t){case c.LoaderErrors.EARLY_EOF:if(!this._config.isLive&&this._totalLength){var n=this._currentRange.to+1;return void(n<this._totalLength&&(s.default.w(this.TAG,"Connection lost, trying reconnect..."),this._isEarlyEofReconnecting=!0,this._internalSeek(n,!1)))}t=c.LoaderErrors.UNRECOVERABLE_EARLY_EOF;break;case c.LoaderErrors.UNRECOVERABLE_EARLY_EOF:case c.LoaderErrors.CONNECTING_TIMEOUT:case c.LoaderErrors.HTTP_STATUS_CODE_INVALID:case c.LoaderErrors.EXCEPTION:}if(!this._onError)throw new T.RuntimeException("IOException: "+e.msg);this._onError(t,e)}},{key:"status",get:function(){return this._loader.status}},{key:"extraData",get:function(){return this._extraData},set:function(t){this._extraData=t}},{key:"onDataArrival",get:function(){return this._onDataArrival},set:function(t){this._onDataArrival=t}},{key:"onSeeked",get:function(){return this._onSeeked},set:function(t){this._onSeeked=t}},{key:"onError",get:function(){return this._onError},set:function(t){this._onError=t}},{key:"onComplete",get:function(){return this._onComplete},set:function(t){this._onComplete=t}},{key:"onRedirect",get:function(){return this._onRedirect},set:function(t){this._onRedirect=t}},{key:"onRecoveredEarlyEof",get:function(){return this._onRecoveredEarlyEof},set:function(t){this._onRecoveredEarlyEof=t}},{key:"currentURL",get:function(){return this._dataSource.url}},{key:"hasRedirect",get:function(){return null!=this._redirectedURL||void 0!=this._dataSource.redirectedURL}},{key:"currentRedirectedURL",get:function(){return this._redirectedURL||this._dataSource.redirectedURL}},{key:"currentSpeed",get:function(){return this._loaderClass===v.default?this._loader.currentSpeed:this._speedSampler.lastSecondKBps}},{key:"loaderType",get:function(){return this._loader.type}}]),t}();n.default=k},{"../utils/exception.js":40,"../utils/logger.js":41,"./fetch-stream-loader.js":22,"./loader.js":24,"./param-seek-handler.js":25,"./range-seek-handler.js":26,"./speed-sampler.js":27,"./websocket-loader.js":28,"./xhr-moz-chunked-loader.js":29,"./xhr-msstream-loader.js":30,"./xhr-range-loader.js":31}],24:[function(t,e,n){function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0}),n.BaseLoader=n.LoaderErrors=n.LoaderStatus=void 0;var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),(0,S.default)(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),a=t("../utils/exception.js"),o=n.LoaderStatus={kIdle:0,kConnecting:1,kBuffering:2,kError:3,kComplete:4};n.LoaderErrors={OK:"OK",EXCEPTION:"Exception",HTTP_STATUS_CODE_INVALID:"HttpStatusCodeInvalid",CONNECTING_TIMEOUT:"ConnectingTimeout",EARLY_EOF:"EarlyEof",UNRECOVERABLE_EARLY_EOF:"UnrecoverableEarlyEof"},n.BaseLoader=function(){function t(e){r(this,t),this._type=e||"undefined",this._status=o.kIdle,this._needStash=!1,this._onContentLengthKnown=null,this._onURLRedirect=null,this._onDataArrival=null,this._onError=null,this._onComplete=null}return i(t,[{key:"destroy",value:function(){this._status=o.kIdle,this._onContentLengthKnown=null,this._onURLRedirect=null,this._onDataArrival=null,this._onError=null,this._onComplete=null}},{key:"isWorking",value:function(){return this._status===o.kConnecting||this._status===o.kBuffering}},{key:"open",value:function(t,e){throw new a.NotImplementedException("Unimplemented abstract function!")}},{key:"abort",value:function(){throw new a.NotImplementedException("Unimplemented abstract function!")}},{key:"type",get:function(){return this._type}},{key:"status",get:function(){return this._status}},{key:"needStashBuffer",get:function(){return this._needStash}},{key:"onContentLengthKnown",get:function(){return this._onContentLengthKnown},set:function(t){this._onContentLengthKnown=t}},{key:"onURLRedirect",get:function(){return this._onURLRedirect},set:function(t){this._onURLRedirect=t}},{key:"onDataArrival",get:function(){return this._onDataArrival},set:function(t){this._onDataArrival=t}},{key:"onError",get:function(){return this._onError},set:function(t){this._onError=t}},{key:"onComplete",get:function(){return this._onComplete},set:function(t){this._onComplete=t}}]),t}()},{"../utils/exception.js":40}],25:[function(t,e,n){function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),(0,S.default)(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),a=function(){function t(e,n){r(this,t),this._startName=e,this._endName=n}return i(t,[{key:"getConfig",value:function(t,e){var n=t;if(0!==e.from||-1!==e.to){var r=!0;-1===n.indexOf("?")&&(n+="?",r=!1),r&&(n+="&"),n+=this._startName+"="+e.from.toString(),-1!==e.to&&(n+="&"+this._endName+"="+e.to.toString())}return{url:n,headers:{}}}},{key:"removeURLParameters",value:function(t){var e=t.split("?")[0],n=void 0,r=t.indexOf("?");-1!==r&&(n=t.substring(r+1));var i="";if(void 0!=n&&n.length>0)for(var a=n.split("&"),o=0;o<a.length;o++){var s=a[o].split("="),u=o>0;s[0]!==this._startName&&s[0]!==this._endName&&(u&&(i+="&"),i+=a[o])}return 0===i.length?e:e+"?"+i}}]),t}();n.default=a},{}],26:[function(t,e,n){function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),(0,S.default)(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),a=function(){function t(e){r(this,t),this._zeroStart=e||!1}return i(t,[{key:"getConfig",value:function(t,e){var n={};if(0!==e.from||-1!==e.to){var r=void 0;r=-1!==e.to?"bytes="+e.from.toString()+"-"+e.to.toString():"bytes="+e.from.toString()+"-",n["Range"]=r}else this._zeroStart&&(n["Range"]="bytes=0-");return{url:t,headers:n}}},{key:"removeURLParameters",value:function(t){return t}}]),t}();n.default=a},{}],27:[function(t,e,n){function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),(0,S.default)(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),a=function(){function t(){r(this,t),this._firstCheckpoint=0,this._lastCheckpoint=0,this._intervalBytes=0,this._totalBytes=0,this._lastSecondBytes=0,self.performance&&self.performance.now?this._now=self.performance.now.bind(self.performance):this._now=Date.now}return i(t,[{key:"reset",value:function(){this._firstCheckpoint=this._lastCheckpoint=0,this._totalBytes=this._intervalBytes=0,this._lastSecondBytes=0}},{key:"addBytes",value:function(t){0===this._firstCheckpoint?(this._firstCheckpoint=this._now(),this._lastCheckpoint=this._firstCheckpoint,this._intervalBytes+=t,this._totalBytes+=t):this._now()-this._lastCheckpoint<1e3?(this._intervalBytes+=t,this._totalBytes+=t):(this._lastSecondBytes=this._intervalBytes,this._intervalBytes=t,this._totalBytes+=t,this._lastCheckpoint=this._now())}},{key:"currentKBps",get:function(){this.addBytes(0);var t=(this._now()-this._lastCheckpoint)/1e3;return 0==t&&(t=1),this._intervalBytes/t/1024}},{key:"lastSecondKBps",get:function(){return this.addBytes(0),0!==this._lastSecondBytes?this._lastSecondBytes/1024:this._now()-this._lastCheckpoint>=500?this.currentKBps:0}},{key:"averageKBps",get:function(){var t=(this._now()-this._firstCheckpoint)/1e3;return this._totalBytes/t/1024}}]),t}();n.default=a},{}],28:[function(t,e,n){function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==(void 0===e?"undefined":(0,I.default)(e))&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+(void 0===e?"undefined":(0,I.default)(e)));t.prototype=(0,c.default)(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(b.default?(0,b.default)(t,e):t.__proto__=e)}Object.defineProperty(n,"__esModule",{value:!0});var o=function m(t,e,n){null===t&&(t=Function.prototype);var r=(0,p.default)(t,e);if(void 0===r){var i=(0,h.default)(t);return null===i?void 0:m(i,e,n)}if("value"in r)return r.value;var a=r.get;if(void 0!==a)return a.call(n)},s=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),(0,S.default)(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),u=t("../utils/logger.js"),l=(function(t){t&&t.__esModule}(u),t("./loader.js")),d=t("../utils/exception.js"),f=function(t){function e(){r(this,e);var t=i(this,(e.__proto__||(0,h.default)(e)).call(this,"websocket-loader"));return t.TAG="WebSocketLoader",t._needStash=!0,t._ws=null,t._requestAbort=!1,t._receivedLength=0,t}return a(e,t),s(e,null,[{key:"isSupported",value:function(){try{return void 0!==self.WebSocket}catch(t){return!1}}}]),s(e,[{key:"destroy",value:function(){this._ws&&this.abort(),o(e.prototype.__proto__||(0,h.default)(e.prototype),"destroy",this).call(this)}},{key:"open",value:function(t){try{var e=this._ws=new self.WebSocket(t.url);e.binaryType="arraybuffer",e.onopen=this._onWebSocketOpen.bind(this),e.onclose=this._onWebSocketClose.bind(this),e.onmessage=this._onWebSocketMessage.bind(this),e.onerror=this._onWebSocketError.bind(this),this._status=l.LoaderStatus.kConnecting}catch(r){this._status=l.LoaderStatus.kError;var n={code:r.code,msg:r.message};if(!this._onError)throw new d.RuntimeException(n.msg);this._onError(l.LoaderErrors.EXCEPTION,n)}}},{key:"abort",value:function(){var t=this._ws;!t||0!==t.readyState&&1!==t.readyState||(this._requestAbort=!0,t.close()),this._ws=null,this._status=l.LoaderStatus.kComplete}},{key:"_onWebSocketOpen",value:function(t){this._status=l.LoaderStatus.kBuffering}},{key:"_onWebSocketClose",value:function(t){if(!0===this._requestAbort)return void(this._requestAbort=!1);this._status=l.LoaderStatus.kComplete,this._onComplete&&this._onComplete(0,this._receivedLength-1)}},{key:"_onWebSocketMessage",value:function(t){var e=this;if(t.data instanceof ArrayBuffer)this._dispatchArrayBuffer(t.data);else if(t.data instanceof Blob){var n=new FileReader;n.onload=function(){e._dispatchArrayBuffer(n.result)},n.readAsArrayBuffer(t.data)}else{this._status=l.LoaderStatus.kError;var r={code:-1,msg:"Unsupported WebSocket message type: "+t.data.constructor.name};if(!this._onError)throw new d.RuntimeException(r.msg);this._onError(l.LoaderErrors.EXCEPTION,r)}}},{key:"_dispatchArrayBuffer",value:function(t){var e=t,n=this._receivedLength;this._receivedLength+=e.byteLength,this._onDataArrival&&this._onDataArrival(e,n,this._receivedLength)}},{key:"_onWebSocketError",value:function(t){this._status=l.LoaderStatus.kError;var e={code:t.code,msg:t.message};if(!this._onError)throw new d.RuntimeException(e.msg);this._onError(l.LoaderErrors.EXCEPTION,e)}}]),e}(l.BaseLoader);n.default=f},{"../utils/exception.js":40,"../utils/logger.js":41,"./loader.js":24}],29:[function(t,e,n){function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==(void 0===e?"undefined":(0,I.default)(e))&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+(void 0===e?"undefined":(0,I.default)(e)));t.prototype=(0,c.default)(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(b.default?(0,b.default)(t,e):t.__proto__=e)}Object.defineProperty(n,"__esModule",{value:!0});var o="function"==typeof y.default&&"symbol"===(0,I.default)(g.default)?function(t){return void 0===t?"undefined":(0,I.default)(t)}:function(t){return t&&"function"==typeof y.default&&t.constructor===y.default&&t!==y.default.prototype?"symbol":void 0===t?"undefined":(0,I.default)(t)},s=function _(t,e,n){null===t&&(t=Function.prototype);var r=(0,p.default)(t,e);if(void 0===r){var i=(0,h.default)(t);return null===i?void 0:_(i,e,n)}if("value"in r)return r.value;var a=r.get;if(void 0!==a)return a.call(n)},u=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),(0,S.default)(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),l=t("../utils/logger.js"),d=function(t){return t&&t.__esModule?t:{default:t}}(l),f=t("./loader.js"),m=t("../utils/exception.js"),v=function(t){function e(t,n){r(this,e);var a=i(this,(e.__proto__||(0,h.default)(e)).call(this,"xhr-moz-chunked-loader"));return a.TAG="MozChunkedLoader",a._seekHandler=t,a._config=n,a._needStash=!0,a._xhr=null,a._requestAbort=!1,a._contentLength=null,a._receivedLength=0,a}return a(e,t),u(e,null,[{key:"isSupported",value:function(){try{var t=new XMLHttpRequest;return t.open("GET","https://example.com",!0),t.responseType="moz-chunked-arraybuffer","moz-chunked-arraybuffer"===t.responseType}catch(e){return d.default.w("MozChunkedLoader",e.message),!1}}}]),u(e,[{key:"destroy",value:function(){this.isWorking()&&this.abort(),this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onloadend=null,this._xhr.onerror=null,this._xhr=null),s(e.prototype.__proto__||(0,h.default)(e.prototype),"destroy",this).call(this)}},{key:"open",value:function(t,e){this._dataSource=t,this._range=e;var n=t.url;this._config.reuseRedirectedURL&&void 0!=t.redirectedURL&&(n=t.redirectedURL);var r=this._seekHandler.getConfig(n,e);this._requestURL=r.url;var i=this._xhr=new XMLHttpRequest;if(i.open("GET",r.url,!0),i.responseType="moz-chunked-arraybuffer",i.onreadystatechange=this._onReadyStateChange.bind(this),i.onprogress=this._onProgress.bind(this),i.onloadend=this._onLoadEnd.bind(this),i.onerror=this._onXhrError.bind(this),t.withCredentials&&(i.withCredentials=!0),"object"===o(r.headers)){var a=r.headers;for(var s in a)a.hasOwnProperty(s)&&i.setRequestHeader(s,a[s])}this._status=f.LoaderStatus.kConnecting,i.send()}},{key:"abort",value:function(){this._requestAbort=!0,this._xhr&&this._xhr.abort(),this._status=f.LoaderStatus.kComplete}},{key:"_onReadyStateChange",value:function(t){var e=t.target;if(2===e.readyState){if(void 0!=e.responseURL&&e.responseURL!==this._requestURL&&this._onURLRedirect){var n=this._seekHandler.removeURLParameters(e.responseURL);this._onURLRedirect(n)}if(0!==e.status&&(e.status<200||e.status>299)){if(this._status=f.LoaderStatus.kError,!this._onError)throw new m.RuntimeException("MozChunkedLoader: Http code invalid, "+e.status+" "+e.statusText);this._onError(f.LoaderErrors.HTTP_STATUS_CODE_INVALID,{code:e.status,msg:e.statusText})}else this._status=f.LoaderStatus.kBuffering}}},{key:"_onProgress",value:function(t){if(this._status!==f.LoaderStatus.kError){null===this._contentLength&&null!==t.total&&0!==t.total&&(this._contentLength=t.total,this._onContentLengthKnown&&this._onContentLengthKnown(this._contentLength));var e=t.target.response,n=this._range.from+this._receivedLength;this._receivedLength+=e.byteLength,this._onDataArrival&&this._onDataArrival(e,n,this._receivedLength)}}},{key:"_onLoadEnd",value:function(t){if(!0===this._requestAbort)return void(this._requestAbort=!1);this._status!==f.LoaderStatus.kError&&(this._status=f.LoaderStatus.kComplete,this._onComplete&&this._onComplete(this._range.from,this._range.from+this._receivedLength-1))}},{key:"_onXhrError",value:function(t){this._status=f.LoaderStatus.kError;var e=0,n=null;if(this._contentLength&&t.loaded<this._contentLength?(e=f.LoaderErrors.EARLY_EOF,n={code:-1,msg:"Moz-Chunked stream meet Early-Eof"}):(e=f.LoaderErrors.EXCEPTION,n={code:-1,msg:t.constructor.name+" "+t.type}),!this._onError)throw new m.RuntimeException(n.msg);this._onError(e,n)}}]),e}(f.BaseLoader);n.default=v},{"../utils/exception.js":40,"../utils/logger.js":41,"./loader.js":24}],30:[function(t,e,n){function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==(void 0===e?"undefined":(0,I.default)(e))&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+(void 0===e?"undefined":(0,I.default)(e)));t.prototype=(0,c.default)(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(b.default?(0,b.default)(t,e):t.__proto__=e)}Object.defineProperty(n,"__esModule",{value:!0});var o="function"==typeof y.default&&"symbol"===(0,I.default)(g.default)?function(t){return void 0===t?"undefined":(0,I.default)(t)}:function(t){return t&&"function"==typeof y.default&&t.constructor===y.default&&t!==y.default.prototype?"symbol":void 0===t?"undefined":(0,I.default)(t)},s=function _(t,e,n){null===t&&(t=Function.prototype);var r=(0,p.default)(t,e);if(void 0===r){var i=(0,h.default)(t);return null===i?void 0:_(i,e,n)}if("value"in r)return r.value;var a=r.get;if(void 0!==a)return a.call(n)},u=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),(0,S.default)(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),l=t("../utils/logger.js"),d=function(t){return t&&t.__esModule?t:{default:t}}(l),f=t("./loader.js"),m=t("../utils/exception.js"),v=function(t){function e(t,n){r(this,e);var a=i(this,(e.__proto__||(0,h.default)(e)).call(this,"xhr-msstream-loader"));return a.TAG="MSStreamLoader",a._seekHandler=t,a._config=n,a._needStash=!0,a._xhr=null,a._reader=null,a._totalRange=null,a._currentRange=null,a._currentRequestURL=null,a._currentRedirectedURL=null,a._contentLength=null,a._receivedLength=0,a._bufferLimit=16777216,a._lastTimeBufferSize=0,a._isReconnecting=!1,a}return a(e,t),u(e,null,[{key:"isSupported",value:function(){try{if(void 0===self.MSStream||void 0===self.MSStreamReader)return!1;var t=new XMLHttpRequest;return t.open("GET","https://example.com",!0),t.responseType="ms-stream","ms-stream"===t.responseType}catch(e){return d.default.w("MSStreamLoader",e.message),!1}}}]),u(e,[{key:"destroy",value:function(){this.isWorking()&&this.abort(),this._reader&&(this._reader.onprogress=null,this._reader.onload=null,this._reader.onerror=null,this._reader=null),this._xhr&&(this._xhr.onreadystatechange=null,this._xhr=null),s(e.prototype.__proto__||(0,h.default)(e.prototype),"destroy",this).call(this)}},{key:"open",value:function(t,e){this._internalOpen(t,e,!1)}},{key:"_internalOpen",value:function(t,e,n){this._dataSource=t,n?this._currentRange=e:this._totalRange=e;var r=t.url;this._config.reuseRedirectedURL&&(void 0!=this._currentRedirectedURL?r=this._currentRedirectedURL:void 0!=t.redirectedURL&&(r=t.redirectedURL));var i=this._seekHandler.getConfig(r,e);this._currentRequestURL=i.url;var a=this._reader=new self.MSStreamReader;a.onprogress=this._msrOnProgress.bind(this),a.onload=this._msrOnLoad.bind(this),a.onerror=this._msrOnError.bind(this);var s=this._xhr=new XMLHttpRequest;if(s.open("GET",i.url,!0),s.responseType="ms-stream",s.onreadystatechange=this._xhrOnReadyStateChange.bind(this),s.onerror=this._xhrOnError.bind(this),t.withCredentials&&(s.withCredentials=!0),"object"===o(i.headers)){var u=i.headers;for(var l in u)u.hasOwnProperty(l)&&s.setRequestHeader(l,u[l])}this._isReconnecting?this._isReconnecting=!1:this._status=f.LoaderStatus.kConnecting,s.send()}},{key:"abort",value:function(){this._internalAbort(),this._status=f.LoaderStatus.kComplete}},{key:"_internalAbort",value:function(){this._reader&&(1===this._reader.readyState&&this._reader.abort(),this._reader.onprogress=null,this._reader.onload=null,this._reader.onerror=null,this._reader=null),this._xhr&&(this._xhr.abort(),this._xhr.onreadystatechange=null,this._xhr=null)}},{key:"_xhrOnReadyStateChange",value:function(t){var e=t.target;if(2===e.readyState)if(e.status>=200&&e.status<=299){if(this._status=f.LoaderStatus.kBuffering,void 0!=e.responseURL){var n=this._seekHandler.removeURLParameters(e.responseURL);e.responseURL!==this._currentRequestURL&&n!==this._currentRedirectedURL&&(this._currentRedirectedURL=n,this._onURLRedirect&&this._onURLRedirect(n))}var r=e.getResponseHeader("Content-Length");if(null!=r&&null==this._contentLength){var i=parseInt(r);i>0&&(this._contentLength=i,this._onContentLengthKnown&&this._onContentLengthKnown(this._contentLength))}}else{if(this._status=f.LoaderStatus.kError,!this._onError)throw new m.RuntimeException("MSStreamLoader: Http code invalid, "+e.status+" "+e.statusText);this._onError(f.LoaderErrors.HTTP_STATUS_CODE_INVALID,{code:e.status,msg:e.statusText})}else if(3===e.readyState&&e.status>=200&&e.status<=299){this._status=f.LoaderStatus.kBuffering;var a=e.response;this._reader.readAsArrayBuffer(a)}}},{key:"_xhrOnError",value:function(t){this._status=f.LoaderStatus.kError;var e=f.LoaderErrors.EXCEPTION,n={code:-1,msg:t.constructor.name+" "+t.type};if(!this._onError)throw new m.RuntimeException(n.msg);this._onError(e,n)}},{key:"_msrOnProgress",value:function(t){var e=t.target,n=e.result;if(null==n)return void this._doReconnectIfNeeded();var r=n.slice(this._lastTimeBufferSize);this._lastTimeBufferSize=n.byteLength;var i=this._totalRange.from+this._receivedLength;this._receivedLength+=r.byteLength,this._onDataArrival&&this._onDataArrival(r,i,this._receivedLength),n.byteLength>=this._bufferLimit&&(d.default.v(this.TAG,"MSStream buffer exceeded max size near "+(i+r.byteLength)+", reconnecting..."),this._doReconnectIfNeeded())}},{key:"_doReconnectIfNeeded",value:function(){if(null==this._contentLength||this._receivedLength<this._contentLength){this._isReconnecting=!0,this._lastTimeBufferSize=0,this._internalAbort();var t={from:this._totalRange.from+this._receivedLength,to:-1};this._internalOpen(this._dataSource,t,!0)}}},{key:"_msrOnLoad",value:function(t){this._status=f.LoaderStatus.kComplete,this._onComplete&&this._onComplete(this._totalRange.from,this._totalRange.from+this._receivedLength-1)}},{key:"_msrOnError",value:function(t){this._status=f.LoaderStatus.kError;var e=0,n=null;if(this._contentLength&&this._receivedLength<this._contentLength?(e=f.LoaderErrors.EARLY_EOF,n={code:-1,msg:"MSStream meet Early-Eof"}):(e=f.LoaderErrors.EARLY_EOF,n={code:-1,msg:t.constructor.name+" "+t.type}),!this._onError)throw new m.RuntimeException(n.msg);this._onError(e,n)}}]),e}(f.BaseLoader);n.default=v},{"../utils/exception.js":40,"../utils/logger.js":41,"./loader.js":24}],31:[function(t,e,n){function r(t){return t&&t.__esModule?t:{default:t}}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==(void 0===e?"undefined":(0,I.default)(e))&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+(void 0===e?"undefined":(0,I.default)(e)));t.prototype=(0,c.default)(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(b.default?(0,b.default)(t,e):t.__proto__=e)}Object.defineProperty(n,"__esModule",{value:!0});var s="function"==typeof y.default&&"symbol"===(0,I.default)(g.default)?function(t){return void 0===t?"undefined":(0,I.default)(t)}:function(t){return t&&"function"==typeof y.default&&t.constructor===y.default&&t!==y.default.prototype?"symbol":void 0===t?"undefined":(0,I.default)(t)},u=function A(t,e,n){null===t&&(t=Function.prototype);var r=(0,p.default)(t,e);if(void 0===r){var i=(0,h.default)(t);return null===i?void 0:A(i,e,n)}if("value"in r)return r.value;var a=r.get;if(void 0!==a)return a.call(n)},l=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),(0,S.default)(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),d=t("../utils/logger.js"),f=r(d),m=t("./speed-sampler.js"),v=r(m),_=t("./loader.js"),E=t("../utils/exception.js"),w=function(t){function e(t,n){i(this,e);var r=a(this,(e.__proto__||(0,h.default)(e)).call(this,"xhr-range-loader"));return r.TAG="RangeLoader",r._seekHandler=t,r._config=n,r._needStash=!1,r._chunkSizeKBList=[128,256,384,512,768,1024,1536,2048,3072,4096,5120,6144,7168,8192],r._currentChunkSizeKB=384,r._currentSpeedNormalized=0,r._zeroSpeedChunkCount=0,r._xhr=null,r._speedSampler=new v.default,r._requestAbort=!1,r._waitForTotalLength=!1,r._totalLengthReceived=!1,r._currentRequestURL=null,r._currentRedirectedURL=null,r._currentRequestRange=null,r._totalLength=null,r._contentLength=null,r._receivedLength=0,r._lastTimeLoaded=0,r}return o(e,t),l(e,null,[{key:"isSupported",value:function(){try{var t=new XMLHttpRequest;return t.open("GET","https://example.com",!0),t.responseType="arraybuffer","arraybuffer"===t.responseType}catch(e){return f.default.w("RangeLoader",e.message),!1}}}]),l(e,[{key:"destroy",value:function(){this.isWorking()&&this.abort(),this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onload=null,this._xhr.onerror=null,this._xhr=null),u(e.prototype.__proto__||(0,h.default)(e.prototype),"destroy",this).call(this)}},{key:"open",value:function(t,e){this._dataSource=t,this._range=e,this._status=_.LoaderStatus.kConnecting;var n=!1;void 0!=this._dataSource.filesize&&0!==this._dataSource.filesize&&(n=!0,this._totalLength=this._dataSource.filesize),this._totalLengthReceived||n?this._openSubRange():(this._waitForTotalLength=!0,this._internalOpen(this._dataSource,{from:0,to:-1}))}},{key:"_openSubRange",value:function(){var t=1024*this._currentChunkSizeKB,e=this._range.from+this._receivedLength,n=e+t;null!=this._contentLength&&n-this._range.from>=this._contentLength&&(n=this._range.from+this._contentLength-1),this._currentRequestRange={from:e,to:n},this._internalOpen(this._dataSource,this._currentRequestRange)}},{key:"_internalOpen",value:function(t,e){this._lastTimeLoaded=0;var n=t.url;this._config.reuseRedirectedURL&&(void 0!=this._currentRedirectedURL?n=this._currentRedirectedURL:void 0!=t.redirectedURL&&(n=t.redirectedURL));var r=this._seekHandler.getConfig(n,e);this._currentRequestURL=r.url;var i=this._xhr=new XMLHttpRequest;if(i.open("GET",r.url,!0),i.responseType="arraybuffer",i.onreadystatechange=this._onReadyStateChange.bind(this),i.onprogress=this._onProgress.bind(this),i.onload=this._onLoad.bind(this),i.onerror=this._onXhrError.bind(this),t.withCredentials&&(i.withCredentials=!0),"object"===s(r.headers)){var a=r.headers;for(var o in a)a.hasOwnProperty(o)&&i.setRequestHeader(o,a[o])}i.send()}},{key:"abort",value:function(){this._requestAbort=!0,this._internalAbort(),this._status=_.LoaderStatus.kComplete}},{key:"_internalAbort",value:function(){this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onload=null,this._xhr.onerror=null,this._xhr.abort(),this._xhr=null)}},{key:"_onReadyStateChange",value:function(t){var e=t.target;if(2===e.readyState){if(void 0!=e.responseURL){var n=this._seekHandler.removeURLParameters(e.responseURL);e.responseURL!==this._currentRequestURL&&n!==this._currentRedirectedURL&&(this._currentRedirectedURL=n,this._onURLRedirect&&this._onURLRedirect(n))}if(e.status>=200&&e.status<=299){if(this._waitForTotalLength)return;this._status=_.LoaderStatus.kBuffering}else{if(this._status=_.LoaderStatus.kError,!this._onError)throw new E.RuntimeException("RangeLoader: Http code invalid, "+e.status+" "+e.statusText);this._onError(_.LoaderErrors.HTTP_STATUS_CODE_INVALID,{code:e.status,msg:e.statusText})}}}},{key:"_onProgress",value:function(t){if(this._status!==_.LoaderStatus.kError){if(null===this._contentLength){var e=!1;if(this._waitForTotalLength){this._waitForTotalLength=!1,this._totalLengthReceived=!0,e=!0;var n=t.total;this._internalAbort(),null!=n&0!==n&&(this._totalLength=n)}if(-1===this._range.to?this._contentLength=this._totalLength-this._range.from:this._contentLength=this._range.to-this._range.from+1,e)return void this._openSubRange();this._onContentLengthKnown&&this._onContentLengthKnown(this._contentLength)}var r=t.loaded-this._lastTimeLoaded;this._lastTimeLoaded=t.loaded,this._speedSampler.addBytes(r)}}},{key:"_normalizeSpeed",value:function(t){var e=this._chunkSizeKBList,n=e.length-1,r=0,i=0,a=n;if(t<e[0])return e[0];for(;i<=a;){if((r=i+Math.floor((a-i)/2))===n||t>=e[r]&&t<e[r+1])return e[r];e[r]<t?i=r+1:a=r-1}}},{key:"_onLoad",value:function(t){if(this._status!==_.LoaderStatus.kError){if(this._waitForTotalLength)return void(this._waitForTotalLength=!1);this._lastTimeLoaded=0;var e=this._speedSampler.lastSecondKBps;if(0===e&&++this._zeroSpeedChunkCount>=3&&(e=this._speedSampler.currentKBps),0!==e){var n=this._normalizeSpeed(e);this._currentSpeedNormalized!==n&&(this._currentSpeedNormalized=n,this._currentChunkSizeKB=n)}var r=t.target.response,i=this._range.from+this._receivedLength;this._receivedLength+=r.byteLength;var a=!1;null!=this._contentLength&&this._receivedLength<this._contentLength?this._openSubRange():a=!0,this._onDataArrival&&this._onDataArrival(r,i,this._receivedLength),a&&(this._status=_.LoaderStatus.kComplete,this._onComplete&&this._onComplete(this._range.from,this._range.from+this._receivedLength-1))}}},{key:"_onXhrError",value:function(t){this._status=_.LoaderStatus.kError;var e=0,n=null;if(this._contentLength&&this._receivedLength>0&&this._receivedLength<this._contentLength?(e=_.LoaderErrors.EARLY_EOF,n={code:-1,msg:"RangeLoader meet Early-Eof"}):(e=_.LoaderErrors.EXCEPTION,n={code:-1,msg:t.constructor.name+" "+t.type}),!this._onError)throw new E.RuntimeException(n.msg);this._onError(e,n)}},{key:"currentSpeed",get:function(){return this._speedSampler.lastSecondKBps}}]),e}(_.BaseLoader);n.default=w},{"../utils/exception.js":40,"../utils/logger.js":41,"./loader.js":24,"./speed-sampler.js":27}],32:[function(t,e,n){function r(t){return t&&t.__esModule?t:{default:t}}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var a="function"==typeof y.default&&"symbol"===(0,I.default)(g.default)?function(t){return void 0===t?"undefined":(0,I.default)(t)}:function(t){return t&&"function"==typeof y.default&&t.constructor===y.default&&t!==y.default.prototype?"symbol":void 0===t?"undefined":(0,I.default)(t)},o=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),(0,S.default)(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),s=t("events"),u=r(s),l=t("../utils/logger.js"),c=r(l),d=t("../utils/browser.js"),h=r(d),f=t("./player-events.js"),p=r(f),m=t("../core/transmuxer.js"),v=r(m),_=t("../core/transmuxing-events.js"),b=r(_),E=t("../core/mse-controller.js"),A=r(E),T=t("../core/mse-events.js"),k=r(T),C=t("./player-errors.js"),M=t("../config.js"),R=t("../utils/exception.js"),L=function(){function t(e,n){if(i(this,t),this.TAG="FlvPlayer",this._type="FlvPlayer",this._emitter=new u.default,this._config=(0,M.createDefaultConfig)(),"object"===(void 0===n?"undefined":a(n))&&(0,x.default)(this._config,n),"flv"!==e.type.toLowerCase())throw new R.InvalidArgumentException("FlvPlayer requires an flv MediaDataSource input!");!0===e.isLive&&(this._config.isLive=!0),this.e={onvLoadedMetadata:this._onvLoadedMetadata.bind(this),onvSeeking:this._onvSeeking.bind(this),onvCanPlay:this._onvCanPlay.bind(this),onvStalled:this._onvStalled.bind(this),onvProgress:this._onvProgress.bind(this)},self.performance&&self.performance.now?this._now=self.performance.now.bind(self.performance):this._now=Date.now,this._pendingSeekTime=null,this._requestSetTime=!1,this._seekpointRecord=null,this._progressChecker=null,this._mediaDataSource=e,this._mediaElement=null,this._msectl=null,this._transmuxer=null,this._mseSourceOpened=!1,this._hasPendingLoad=!1,this._receivedCanPlay=!1,this._mediaInfo=null,this._statisticsInfo=null;var r=h.default.chrome&&(h.default.version.major<50||50===h.default.version.major&&h.default.version.build<2661);this._alwaysSeekKeyframe=!!(r||h.default.msedge||h.default.msie),this._alwaysSeekKeyframe&&(this._config.accurateSeek=!1)}return o(t,[{key:"destroy",value:function(){null!=this._progressChecker&&(window.clearInterval(this._progressChecker),this._progressChecker=null),this._transmuxer&&this.unload(),this._mediaElement&&this.detachMediaElement(),this.e=null,this._mediaDataSource=null,this._emitter.removeAllListeners(),this._emitter=null}},{key:"on",value:function(t,e){var n=this;t===p.default.MEDIA_INFO?null!=this._mediaInfo&&w.default.resolve().then(function(){n._emitter.emit(p.default.MEDIA_INFO,n.mediaInfo)}):t===p.default.STATISTICS_INFO&&null!=this._statisticsInfo&&w.default.resolve().then(function(){n._emitter.emit(p.default.STATISTICS_INFO,n.statisticsInfo)}),this._emitter.addListener(t,e)}},{key:"off",value:function(t,e){this._emitter.removeListener(t,e)}},{key:"attachMediaElement",value:function(t){var e=this;if(this._mediaElement=t,t.addEventListener("loadedmetadata",this.e.onvLoadedMetadata),t.addEventListener("seeking",this.e.onvSeeking),t.addEventListener("canplay",this.e.onvCanPlay),t.addEventListener("stalled",this.e.onvStalled),t.addEventListener("progress",this.e.onvProgress),this._msectl=new A.default(this._config),this._msectl.on(k.default.UPDATE_END,this._onmseUpdateEnd.bind(this)),this._msectl.on(k.default.BUFFER_FULL,this._onmseBufferFull.bind(this)),this._msectl.on(k.default.SOURCE_OPEN,function(){e._mseSourceOpened=!0,e._hasPendingLoad&&(e._hasPendingLoad=!1,e.load())}),this._msectl.on(k.default.ERROR,function(t){e._emitter.emit(p.default.ERROR,C.ErrorTypes.MEDIA_ERROR,C.ErrorDetails.MEDIA_MSE_ERROR,t)}),this._msectl.attachMediaElement(t),null!=this._pendingSeekTime)try{t.currentTime=this._pendingSeekTime,this._pendingSeekTime=null}catch(n){}}},{key:"detachMediaElement",value:function(){this._mediaElement&&(this._msectl.detachMediaElement(),this._mediaElement.removeEventListener("loadedmetadata",this.e.onvLoadedMetadata),this._mediaElement.removeEventListener("seeking",this.e.onvSeeking),this._mediaElement.removeEventListener("canplay",this.e.onvCanPlay),this._mediaElement.removeEventListener("stalled",this.e.onvStalled),this._mediaElement.removeEventListener("progress",this.e.onvProgress),this._mediaElement=null),this._msectl&&(this._msectl.destroy(),this._msectl=null)}},{key:"load",value:function(){var t=this;if(!this._mediaElement)throw new R.IllegalStateException("HTMLMediaElement must be attached before load()!");if(this._transmuxer)throw new R.IllegalStateException("FlvPlayer.load() has been called, please call unload() first!");if(!this._hasPendingLoad){if(this._config.deferLoadAfterSourceOpen&&!1===this._mseSourceOpened)return void(this._hasPendingLoad=!0);this._mediaElement.readyState>0&&(this._requestSetTime=!0,this._mediaElement.currentTime=0),this._transmuxer=new v.default(this._mediaDataSource,this._config),this._transmuxer.on(b.default.INIT_SEGMENT,function(e,n){t._msectl.appendInitSegment(n)}),this._transmuxer.on(b.default.MEDIA_SEGMENT,function(e,n){if(t._msectl.appendMediaSegment(n),t._config.lazyLoad&&!t._config.isLive){var r=t._mediaElement.currentTime;n.info.endDts>=1e3*(r+t._config.lazyLoadMaxDuration)&&null==t._progressChecker&&(c.default.v(t.TAG,"Maximum buffering duration exceeded, suspend transmuxing task"),t._suspendTransmuxer())}}),this._transmuxer.on(b.default.LOADING_COMPLETE,function(){t._msectl.endOfStream(),t._emitter.emit(p.default.LOADING_COMPLETE)}),this._transmuxer.on(b.default.RECOVERED_EARLY_EOF,function(){t._emitter.emit(p.default.RECOVERED_EARLY_EOF)}),this._transmuxer.on(b.default.IO_ERROR,function(e,n){t._emitter.emit(p.default.ERROR,C.ErrorTypes.NETWORK_ERROR,e,n)}),this._transmuxer.on(b.default.DEMUX_ERROR,function(e,n){t._emitter.emit(p.default.ERROR,C.ErrorTypes.MEDIA_ERROR,e,{code:-1,msg:n})}),this._transmuxer.on(b.default.MEDIA_INFO,function(e){t._mediaInfo=e,t._emitter.emit(p.default.MEDIA_INFO,(0,x.default)({},e))}),this._transmuxer.on(b.default.STATISTICS_INFO,function(e){t._statisticsInfo=t._fillStatisticsInfo(e),t._emitter.emit(p.default.STATISTICS_INFO,(0,x.default)({},t._statisticsInfo))}),this._transmuxer.on(b.default.RECOMMEND_SEEKPOINT,function(e){t._mediaElement&&!t._config.accurateSeek&&(t._requestSetTime=!0,t._mediaElement.currentTime=e/1e3)}),this._transmuxer.open()}}},{key:"unload",value:function(){this._mediaElement&&this._mediaElement.pause(),this._msectl&&this._msectl.seek(0),this._transmuxer&&(this._transmuxer.close(),this._transmuxer.destroy(),this._transmuxer=null)}},{key:"play",value:function(){return this._mediaElement.play()}},{key:"pause",value:function(){this._mediaElement.pause()}},{key:"_fillStatisticsInfo",value:function(t){if(t.playerType=this._type,!(this._mediaElement instanceof HTMLVideoElement))return t;var e=!0,n=0,r=0;if(this._mediaElement.getVideoPlaybackQuality){var i=this._mediaElement.getVideoPlaybackQuality();n=i.totalVideoFrames,r=i.droppedVideoFrames}else void 0!=this._mediaElement.webkitDecodedFrameCount?(n=this._mediaElement.webkitDecodedFrameCount,r=this._mediaElement.webkitDroppedFrameCount):e=!1;return e&&(t.decodedFrames=n,t.droppedFrames=r),t}},{key:"_onmseUpdateEnd",value:function(){if(this._config.lazyLoad&&!this._config.isLive){for(var t=this._mediaElement.buffered,e=this._mediaElement.currentTime,n=0,r=0;r<t.length;r++){var i=t.start(r),a=t.end(r);if(i<=e&&e<a){i,n=a;break}}n>=e+this._config.lazyLoadMaxDuration&&null==this._progressChecker&&(c.default.v(this.TAG,"Maximum buffering duration exceeded, suspend transmuxing task"),this._suspendTransmuxer())}}},{key:"_onmseBufferFull",value:function(){c.default.v(this.TAG,"MSE SourceBuffer is full, suspend transmuxing task"),null==this._progressChecker&&this._suspendTransmuxer()}},{key:"_suspendTransmuxer",value:function(){this._transmuxer&&(this._transmuxer.pause(),null==this._progressChecker&&(this._progressChecker=window.setInterval(this._checkProgressAndResume.bind(this),1e3)))}},{key:"_checkProgressAndResume",value:function(){for(var t=this._mediaElement.currentTime,e=this._mediaElement.buffered,n=!1,r=0;r<e.length;r++){var i=e.start(r),a=e.end(r);if(t>=i&&t<a){t>=a-this._config.lazyLoadRecoverDuration&&(n=!0);break}}n&&(window.clearInterval(this._progressChecker),this._progressChecker=null,n&&(c.default.v(this.TAG,"Continue loading from paused position"),this._transmuxer.resume()))}},{key:"_isTimepointBuffered",value:function(t){for(var e=this._mediaElement.buffered,n=0;n<e.length;n++){var r=e.start(n),i=e.end(n);if(t>=r&&t<i)return!0}return!1}},{key:"_internalSeek",value:function(t){var e=this._isTimepointBuffered(t),n=!1,r=0;if(t<1&&this._mediaElement.buffered.length>0){var i=this._mediaElement.buffered.start(0);(i<1&&t<i||h.default.safari)&&(n=!0,r=h.default.safari?.1:i)}if(n)this._requestSetTime=!0,this._mediaElement.currentTime=r;else if(e){if(this._alwaysSeekKeyframe){var a=this._msectl.getNearestKeyframe(Math.floor(1e3*t));this._requestSetTime=!0,this._mediaElement.currentTime=null!=a?a.dts/1e3:t}else this._requestSetTime=!0,this._mediaElement.currentTime=t;null!=this._progressChecker&&this._checkProgressAndResume()}else null!=this._progressChecker&&(window.clearInterval(this._progressChecker),this._progressChecker=null),this._msectl.seek(t),this._transmuxer.seek(Math.floor(1e3*t)),this._config.accurateSeek&&(this._requestSetTime=!0,this._mediaElement.currentTime=t)}},{key:"_checkAndApplyUnbufferedSeekpoint",value:function(){if(this._seekpointRecord)if(this._seekpointRecord.recordTime<=this._now()-100){var t=this._mediaElement.currentTime;this._seekpointRecord=null,this._isTimepointBuffered(t)||(null!=this._progressChecker&&(window.clearTimeout(this._progressChecker),this._progressChecker=null),this._msectl.seek(t),this._transmuxer.seek(Math.floor(1e3*t)),this._config.accurateSeek&&(this._requestSetTime=!0,this._mediaElement.currentTime=t))}else window.setTimeout(this._checkAndApplyUnbufferedSeekpoint.bind(this),50)}},{key:"_checkAndResumeStuckPlayback",value:function(t){var e=this._mediaElement;if(t||!this._receivedCanPlay||e.readyState<2){var n=e.buffered;n.length>0&&e.currentTime<n.start(0)&&(c.default.w(this.TAG,"Playback seems stuck at "+e.currentTime+", seek to "+n.start(0)),this._requestSetTime=!0,this._mediaElement.currentTime=n.start(0),this._mediaElement.removeEventListener("progress",this.e.onvProgress))}else this._mediaElement.removeEventListener("progress",this.e.onvProgress)}},{key:"_onvLoadedMetadata",value:function(t){null!=this._pendingSeekTime&&(this._mediaElement.currentTime=this._pendingSeekTime,this._pendingSeekTime=null)}},{key:"_onvSeeking",value:function(t){var e=this._mediaElement.currentTime,n=this._mediaElement.buffered;if(this._requestSetTime)return void(this._requestSetTime=!1);if(e<1&&n.length>0){var r=n.start(0);if(r<1&&e<r||h.default.safari)return this._requestSetTime=!0,void(this._mediaElement.currentTime=h.default.safari?.1:r)}if(this._isTimepointBuffered(e)){if(this._alwaysSeekKeyframe){var i=this._msectl.getNearestKeyframe(Math.floor(1e3*e));null!=i&&(this._requestSetTime=!0,this._mediaElement.currentTime=i.dts/1e3)}return void(null!=this._progressChecker&&this._checkProgressAndResume())}this._seekpointRecord={seekPoint:e,recordTime:this._now()},window.setTimeout(this._checkAndApplyUnbufferedSeekpoint.bind(this),50)}},{key:"_onvCanPlay",value:function(t){this._receivedCanPlay=!0,this._mediaElement.removeEventListener("canplay",this.e.onvCanPlay)}},{key:"_onvStalled",value:function(t){this._checkAndResumeStuckPlayback(!0)}},{key:"_onvProgress",value:function(t){this._checkAndResumeStuckPlayback()}},{key:"type",get:function(){return this._type}},{key:"buffered",get:function(){return this._mediaElement.buffered}},{key:"duration",get:function(){return this._mediaElement.duration}},{key:"volume",get:function(){return this._mediaElement.volume},set:function(t){this._mediaElement.volume=t}},{key:"muted",get:function(){return this._mediaElement.muted},set:function(t){this._mediaElement.muted=t}},{key:"currentTime",get:function(){return this._mediaElement?this._mediaElement.currentTime:0},set:function(t){this._mediaElement?this._internalSeek(t):this._pendingSeekTime=t}},{key:"mediaInfo",get:function(){return(0,x.default)({},this._mediaInfo)}},{key:"statisticsInfo",get:function(){return null==this._statisticsInfo&&(this._statisticsInfo={}),this._statisticsInfo=this._fillStatisticsInfo(this._statisticsInfo),(0,x.default)({},this._statisticsInfo)}}]),t}();n.default=L},{"../config.js":5,"../core/mse-controller.js":9,"../core/mse-events.js":10,"../core/transmuxer.js":11,"../core/transmuxing-events.js":13,"../utils/browser.js":39,"../utils/exception.js":40,"../utils/logger.js":41,"./player-errors.js":34,"./player-events.js":35,events:2}],33:[function(t,e,n){function r(t){return t&&t.__esModule?t:{default:t}}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var a="function"==typeof y.default&&"symbol"===(0,I.default)(g.default)?function(t){return void 0===t?"undefined":(0,I.default)(t)}:function(t){return t&&"function"==typeof y.default&&t.constructor===y.default&&t!==y.default.prototype?"symbol":void 0===t?"undefined":(0,I.default)(t)},o=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),(0,S.default)(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),s=t("events"),u=r(s),l=t("./player-events.js"),c=r(l),d=t("../config.js"),h=t("../utils/exception.js"),f=function(){function t(e,n){if(i(this,t),this.TAG="NativePlayer",this._type="NativePlayer",this._emitter=new u.default,this._config=(0,d.createDefaultConfig)(),"object"===(void 0===n?"undefined":a(n))&&(0,x.default)(this._config,n),"flv"===e.type.toLowerCase())throw new h.InvalidArgumentException("NativePlayer does't support flv MediaDataSource input!");if(e.hasOwnProperty("segments"))throw new h.InvalidArgumentException("NativePlayer("+e.type+") doesn't support multipart playback!");this.e={onvLoadedMetadata:this._onvLoadedMetadata.bind(this)},this._pendingSeekTime=null,this._statisticsReporter=null,this._mediaDataSource=e,this._mediaElement=null}return o(t,[{key:"destroy",value:function(){this._mediaElement&&(this.unload(),this.detachMediaElement()),this.e=null,this._mediaDataSource=null,this._emitter.removeAllListeners(),this._emitter=null}},{key:"on",value:function(t,e){var n=this;t===c.default.MEDIA_INFO?null!=this._mediaElement&&0!==this._mediaElement.readyState&&w.default.resolve().then(function(){n._emitter.emit(c.default.MEDIA_INFO,n.mediaInfo)}):t===c.default.STATISTICS_INFO&&null!=this._mediaElement&&0!==this._mediaElement.readyState&&w.default.resolve().then(function(){n._emitter.emit(c.default.STATISTICS_INFO,n.statisticsInfo)}),this._emitter.addListener(t,e)}},{key:"off",value:function(t,e){this._emitter.removeListener(t,e)}},{key:"attachMediaElement",value:function(t){if(this._mediaElement=t,t.addEventListener("loadedmetadata",this.e.onvLoadedMetadata),null!=this._pendingSeekTime)try{t.currentTime=this._pendingSeekTime,this._pendingSeekTime=null}catch(e){}}},{key:"detachMediaElement",value:function(){this._mediaElement&&(this._mediaElement.src="",this._mediaElement.removeAttribute("src"),this._mediaElement.removeEventListener("loadedmetadata",this.e.onvLoadedMetadata),this._mediaElement=null),null!=this._statisticsReporter&&(window.clearInterval(this._statisticsReporter),this._statisticsReporter=null)}},{key:"load",value:function(){if(!this._mediaElement)throw new h.IllegalStateException("HTMLMediaElement must be attached before load()!");this._mediaElement.src=this._mediaDataSource.url,this._mediaElement.readyState>0&&(this._mediaElement.currentTime=0),this._mediaElement.preload="auto",this._mediaElement.load(),this._statisticsReporter=window.setInterval(this._reportStatisticsInfo.bind(this),this._config.statisticsInfoReportInterval)}},{key:"unload",value:function(){this._mediaElement&&(this._mediaElement.src="",this._mediaElement.removeAttribute("src")),null!=this._statisticsReporter&&(window.clearInterval(this._statisticsReporter),this._statisticsReporter=null)}},{key:"play",value:function(){return this._mediaElement.play()}},{key:"pause",value:function(){this._mediaElement.pause()}},{key:"_onvLoadedMetadata",value:function(t){null!=this._pendingSeekTime&&(this._mediaElement.currentTime=this._pendingSeekTime,this._pendingSeekTime=null),this._emitter.emit(c.default.MEDIA_INFO,this.mediaInfo)}},{key:"_reportStatisticsInfo",value:function(){this._emitter.emit(c.default.STATISTICS_INFO,this.statisticsInfo)}},{key:"type",get:function(){return this._type}},{key:"buffered",get:function(){return this._mediaElement.buffered}},{key:"duration",get:function(){return this._mediaElement.duration}},{key:"volume",get:function(){return this._mediaElement.volume},set:function(t){this._mediaElement.volume=t}},{key:"muted",get:function(){return this._mediaElement.muted},set:function(t){this._mediaElement.muted=t}},{key:"currentTime",get:function(){return this._mediaElement?this._mediaElement.currentTime:0},set:function(t){this._mediaElement?this._mediaElement.currentTime=t:this._pendingSeekTime=t}},{key:"mediaInfo",get:function(){var t=this._mediaElement instanceof HTMLAudioElement?"audio/":"video/",e={mimeType:t+this._mediaDataSource.type};return this._mediaElement&&(e.duration=Math.floor(1e3*this._mediaElement.duration),this._mediaElement instanceof HTMLVideoElement&&(e.width=this._mediaElement.videoWidth,e.height=this._mediaElement.videoHeight)),e}},{key:"statisticsInfo",get:function(){var t={playerType:this._type,url:this._mediaDataSource.url};if(!(this._mediaElement instanceof HTMLVideoElement))return t;var e=!0,n=0,r=0;if(this._mediaElement.getVideoPlaybackQuality){var i=this._mediaElement.getVideoPlaybackQuality();n=i.totalVideoFrames,r=i.droppedVideoFrames}else void 0!=this._mediaElement.webkitDecodedFrameCount?(n=this._mediaElement.webkitDecodedFrameCount,r=this._mediaElement.webkitDroppedFrameCount):e=!1;return e&&(t.decodedFrames=n,t.droppedFrames=r),t}}]),t}();n.default=f},{"../config.js":5,"../utils/exception.js":40,"./player-events.js":35,events:2}],34:[function(t,e,n){Object.defineProperty(n,"__esModule",{value:!0}),n.ErrorDetails=n.ErrorTypes=void 0;var r=t("../io/loader.js"),i=t("../demux/demux-errors.js"),a=function(t){return t&&t.__esModule?t:{default:t}}(i);n.ErrorTypes={NETWORK_ERROR:"NetworkError",MEDIA_ERROR:"MediaError",OTHER_ERROR:"OtherError"},n.ErrorDetails={NETWORK_EXCEPTION:r.LoaderErrors.EXCEPTION,NETWORK_STATUS_CODE_INVALID:r.LoaderErrors.HTTP_STATUS_CODE_INVALID,NETWORK_TIMEOUT:r.LoaderErrors.CONNECTING_TIMEOUT,NETWORK_UNRECOVERABLE_EARLY_EOF:r.LoaderErrors.UNRECOVERABLE_EARLY_EOF,MEDIA_MSE_ERROR:"MediaMSEError",MEDIA_FORMAT_ERROR:a.default.FORMAT_ERROR,MEDIA_FORMAT_UNSUPPORTED:a.default.FORMAT_UNSUPPORTED,MEDIA_CODEC_UNSUPPORTED:a.default.CODEC_UNSUPPORTED}},{"../demux/demux-errors.js":16,"../io/loader.js":24}],35:[function(t,e,n){Object.defineProperty(n,"__esModule",{value:!0});var r={ERROR:"error",LOADING_COMPLETE:"loading_complete",RECOVERED_EARLY_EOF:"recovered_early_eof",MEDIA_INFO:"media_info",STATISTICS_INFO:"statistics_info"};n.default=r},{}],36:[function(t,e,n){function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),(0,S.default)(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),a=function(){function t(){r(this,t)}return i(t,null,[{key:"getSilentFrame",value:function(t,e){if("mp4a.40.2"===t){if(1===e)return new Uint8Array([0,200,0,128,35,128]);if(2===e)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(1===e)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===e)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===e)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null}}]),t}();n.default=a},{}],37:[function(t,e,n){function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),(0,S.default)(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),a=function(){function t(){r(this,t)}return i(t,null,[{key:"init",value:function(){t.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[],".mp3":[]};for(var e in t.types)t.types.hasOwnProperty(e)&&(t.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);var n=t.constants={};n.FTYP=new Uint8Array([105,115,111,109,0,0,0,1,105,115,111,109,97,118,99,49]),n.STSD_PREFIX=new Uint8Array([0,0,0,0,0,0,0,1]),n.STTS=new Uint8Array([0,0,0,0,0,0,0,0]),n.STSC=n.STCO=n.STTS,n.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),n.HDLR_VIDEO=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),n.HDLR_AUDIO=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]),n.DREF=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),n.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),n.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0])}},{key:"box",value:function(t){for(var e=8,n=null,r=Array.prototype.slice.call(arguments,1),i=r.length,a=0;a<i;a++)e+=r[a].byteLength;n=new Uint8Array(e),n[0]=e>>>24&255,n[1]=e>>>16&255,n[2]=e>>>8&255,n[3]=255&e,n.set(t,4);for(var o=8,s=0;s<i;s++)n.set(r[s],o),o+=r[s].byteLength;return n}},{key:"generateInitSegment",value:function(e){var n=t.box(t.types.ftyp,t.constants.FTYP),r=t.moov(e),i=new Uint8Array(n.byteLength+r.byteLength);return i.set(n,0),i.set(r,n.byteLength),i}},{key:"moov",value:function(e){var n=t.mvhd(e.timescale,e.duration),r=t.trak(e),i=t.mvex(e);return t.box(t.types.moov,n,r,i)}},{key:"mvhd",value:function(e,n){return t.box(t.types.mvhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,e>>>24&255,e>>>16&255,e>>>8&255,255&e,n>>>24&255,n>>>16&255,n>>>8&255,255&n,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]))}},{key:"trak",value:function(e){return t.box(t.types.trak,t.tkhd(e),t.mdia(e))}},{key:"tkhd",value:function(e){var n=e.id,r=e.duration,i=e.presentWidth,a=e.presentHeight;return t.box(t.types.tkhd,new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,n>>>24&255,n>>>16&255,n>>>8&255,255&n,0,0,0,0,r>>>24&255,r>>>16&255,r>>>8&255,255&r,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,i>>>8&255,255&i,0,0,a>>>8&255,255&a,0,0]))}},{key:"mdia",value:function(e){return t.box(t.types.mdia,t.mdhd(e),t.hdlr(e),t.minf(e))}},{key:"mdhd",value:function(e){var n=e.timescale,r=e.duration;return t.box(t.types.mdhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,n>>>24&255,n>>>16&255,n>>>8&255,255&n,r>>>24&255,r>>>16&255,r>>>8&255,255&r,85,196,0,0]))}},{key:"hdlr",value:function(e){var n=null;return n="audio"===e.type?t.constants.HDLR_AUDIO:t.constants.HDLR_VIDEO,t.box(t.types.hdlr,n)}},{key:"minf",value:function(e){var n=null;return n="audio"===e.type?t.box(t.types.smhd,t.constants.SMHD):t.box(t.types.vmhd,t.constants.VMHD),t.box(t.types.minf,n,t.dinf(),t.stbl(e))}},{key:"dinf",value:function(){return t.box(t.types.dinf,t.box(t.types.dref,t.constants.DREF))}},{key:"stbl",value:function(e){return t.box(t.types.stbl,t.stsd(e),t.box(t.types.stts,t.constants.STTS),t.box(t.types.stsc,t.constants.STSC),t.box(t.types.stsz,t.constants.STSZ),t.box(t.types.stco,t.constants.STCO))}},{key:"stsd",value:function(e){return"audio"===e.type?"mp3"===e.codec?t.box(t.types.stsd,t.constants.STSD_PREFIX,t.mp3(e)):t.box(t.types.stsd,t.constants.STSD_PREFIX,t.mp4a(e)):t.box(t.types.stsd,t.constants.STSD_PREFIX,t.avc1(e))}},{key:"mp3",value:function(e){var n=e.channelCount,r=e.audioSampleRate,i=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,n,0,16,0,0,0,0,r>>>8&255,255&r,0,0]);return t.box(t.types[".mp3"],i)}},{key:"mp4a",value:function(e){var n=e.channelCount,r=e.audioSampleRate,i=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,n,0,16,0,0,0,0,r>>>8&255,255&r,0,0]);return t.box(t.types.mp4a,i,t.esds(e))}},{key:"esds",value:function(e){var n=e.config||[],r=n.length,i=new Uint8Array([0,0,0,0,3,23+r,0,1,0,4,15+r,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([r]).concat(n).concat([6,1,2]));return t.box(t.types.esds,i)}},{key:"avc1",value:function(e){var n=e.avcc,r=e.codecWidth,i=e.codecHeight,a=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,r>>>8&255,255&r,i>>>8&255,255&i,0,72,0,0,0,72,0,0,0,0,0,0,0,1,10,120,113,113,47,102,108,118,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,255,255]);return t.box(t.types.avc1,a,t.box(t.types.avcC,n))}},{key:"mvex",value:function(e){return t.box(t.types.mvex,t.trex(e))}},{key:"trex",value:function(e){var n=e.id,r=new Uint8Array([0,0,0,0,n>>>24&255,n>>>16&255,n>>>8&255,255&n,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);return t.box(t.types.trex,r)}},{key:"moof",value:function(e,n){return t.box(t.types.moof,t.mfhd(e.sequenceNumber),t.traf(e,n))}},{key:"mfhd",value:function(e){var n=new Uint8Array([0,0,0,0,e>>>24&255,e>>>16&255,e>>>8&255,255&e]);return t.box(t.types.mfhd,n)}},{key:"traf",value:function(e,n){var r=e.id,i=t.box(t.types.tfhd,new Uint8Array([0,0,0,0,r>>>24&255,r>>>16&255,r>>>8&255,255&r])),a=t.box(t.types.tfdt,new Uint8Array([0,0,0,0,n>>>24&255,n>>>16&255,n>>>8&255,255&n])),o=t.sdtp(e),s=t.trun(e,o.byteLength+16+16+8+16+8+8);return t.box(t.types.traf,i,a,s,o)}},{key:"sdtp",value:function(e){for(var n=e.samples||[],r=n.length,i=new Uint8Array(4+r),a=0;a<r;a++){var o=n[a].flags;i[a+4]=o.isLeading<<6|o.dependsOn<<4|o.isDependedOn<<2|o.hasRedundancy}return t.box(t.types.sdtp,i)}},{key:"trun",value:function(e,n){var r=e.samples||[],i=r.length,a=12+16*i,o=new Uint8Array(a);n+=8+a,o.set([0,0,15,1,i>>>24&255,i>>>16&255,i>>>8&255,255&i,n>>>24&255,n>>>16&255,n>>>8&255,255&n],0);for(var s=0;s<i;s++){var u=r[s].duration,l=r[s].size,c=r[s].flags,d=r[s].cts;o.set([u>>>24&255,u>>>16&255,u>>>8&255,255&u,l>>>24&255,l>>>16&255,l>>>8&255,255&l,c.isLeading<<2|c.dependsOn,c.isDependedOn<<6|c.hasRedundancy<<4|c.isNonSync,0,0,d>>>24&255,d>>>16&255,d>>>8&255,255&d],12+16*s)}return t.box(t.types.trun,o)}},{key:"mdat",value:function(e){return t.box(t.types.mdat,e)}}]),t}();a.init(),n.default=a},{}],38:[function(t,e,n){function r(t){return t&&t.__esModule?t:{default:t}}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),(0,S.default)(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=t("../utils/logger.js"),s=r(o),u=t("./mp4-generator.js"),l=r(u),c=t("./aac-silent.js"),d=r(c),h=t("../utils/browser.js"),f=r(h),p=t("../core/media-segment-info.js"),m=t("../utils/exception.js"),g=function(){function t(e){i(this,t),this.TAG="MP4Remuxer",this._config=e,this._isLive=!0===e.isLive,this._dtsBase=-1,this._dtsBaseInited=!1,this._audioDtsBase=1/0,this._videoDtsBase=1/0,this._audioNextDts=void 0,this._videoNextDts=void 0,this._audioStashedLastSample=null,this._videoStashedLastSample=null,this._audioMeta=null,this._videoMeta=null,this._audioSegmentInfoList=new p.MediaSegmentInfoList("audio"),this._videoSegmentInfoList=new p.MediaSegmentInfoList("video"),this._onInitSegment=null,this._onMediaSegment=null,this._forceFirstIDR=!(!f.default.chrome||!(f.default.version.major<50||50===f.default.version.major&&f.default.version.build<2661)),this._fillSilentAfterSeek=f.default.msedge||f.default.msie,this._mp3UseMpegAudio=!f.default.firefox,this._fillAudioTimestampGap=this._config.fixAudioTimestampGap}return a(t,[{key:"destroy",value:function(){this._dtsBase=-1,this._dtsBaseInited=!1,this._audioMeta=null,this._videoMeta=null,this._audioSegmentInfoList.clear(),this._audioSegmentInfoList=null,this._videoSegmentInfoList.clear(),this._videoSegmentInfoList=null,this._onInitSegment=null,this._onMediaSegment=null}},{key:"bindDataSource",value:function(t){return t.onDataAvailable=this.remux.bind(this),t.onTrackMetadata=this._onTrackMetadataReceived.bind(this),this}},{key:"insertDiscontinuity",value:function(){this._audioNextDts=this._videoNextDts=void 0}},{key:"seek",value:function(t){this._audioStashedLastSample=null,this._videoStashedLastSample=null,this._videoSegmentInfoList.clear(),this._audioSegmentInfoList.clear()}},{key:"remux",value:function(t,e){if(!this._onMediaSegment)throw new m.IllegalStateException("MP4Remuxer: onMediaSegment callback must be specificed!");this._dtsBaseInited||this._calculateDtsBase(t,e),this._remuxVideo(e),this._remuxAudio(t)}},{key:"_onTrackMetadataReceived",value:function(t,e){var n=null,r="mp4",i=e.codec;if("audio"===t)this._audioMeta=e,"mp3"===e.codec&&this._mp3UseMpegAudio?(r="mpeg",i="",n=new Uint8Array):n=l.default.generateInitSegment(e);else{if("video"!==t)return;this._videoMeta=e,n=l.default.generateInitSegment(e)}if(!this._onInitSegment)throw new m.IllegalStateException("MP4Remuxer: onInitSegment callback must be specified!");this._onInitSegment(t,{type:t,data:n.buffer,codec:i,container:t+"/"+r,mediaDuration:e.duration})}},{key:"_calculateDtsBase",value:function(t,e){this._dtsBaseInited||(t.samples&&t.samples.length&&(this._audioDtsBase=t.samples[0].dts),e.samples&&e.samples.length&&(this._videoDtsBase=e.samples[0].dts),this._dtsBase=Math.min(this._audioDtsBase,this._videoDtsBase),this._dtsBaseInited=!0)}},{key:"flushStashedSamples",value:function(){var t=this._videoStashedLastSample,e=this._audioStashedLastSample,n={type:"video",id:1,sequenceNumber:0,samples:[],length:0};null!=t&&(n.samples.push(t),n.length=t.length);var r={type:"audio",id:2,sequenceNumber:0,samples:[],length:0};null!=e&&(r.samples.push(e),r.length=e.length),this._videoStashedLastSample=null,this._audioStashedLastSample=null,this._remuxVideo(n,!0),this._remuxAudio(r,!0)}},{key:"_remuxAudio",value:function(t,e){if(null!=this._audioMeta){var n=t,r=n.samples,i=void 0,a=-1,o=-1,u=this._audioMeta.refSampleDuration,c="mp3"===this._audioMeta.codec&&this._mp3UseMpegAudio,h=this._dtsBaseInited&&void 0===this._audioNextDts,m=!1;if(r&&0!==r.length&&(1!==r.length||e)){var g=0,v=null,y=0;c?(g=0,y=n.length):(g=8,y=8+n.length);var _=null;if(r.length>1&&(_=r.pop(),y-=_.length),null!=this._audioStashedLastSample){var b=this._audioStashedLastSample;this._audioStashedLastSample=null,r.unshift(b),y+=b.length}null!=_&&(this._audioStashedLastSample=_);var E=r[0].dts-this._dtsBase;if(this._audioNextDts)i=E-this._audioNextDts;else if(this._audioSegmentInfoList.isEmpty())i=0,this._fillSilentAfterSeek&&!this._videoSegmentInfoList.isEmpty()&&"mp3"!==this._audioMeta.originalCodec&&(m=!0);else{var w=this._audioSegmentInfoList.getLastSampleBefore(E);if(null!=w){var A=E-(w.originalDts+w.duration);A<=3&&(A=0);var S=w.dts+w.duration+A;i=E-S}else i=0}if(m){var T=E-i,x=this._videoSegmentInfoList.getLastSegmentBefore(E);if(null!=x&&x.beginDts<T){var k=d.default.getSilentFrame(this._audioMeta.originalCodec,this._audioMeta.channelCount);if(k){var C=x.beginDts,M=T-x.beginDts;s.default.v(this.TAG,"InsertPrefixSilentAudio: dts: "+C+", duration: "+M),r.unshift({unit:k,dts:C,pts:C}),y+=k.byteLength}}else m=!1}for(var R=[],L=0;L<r.length;L++){var I=r[L],P=I.unit,O=I.dts-this._dtsBase,D=O-i;-1===a&&(a=D);var N=0;if(L!==r.length-1){N=r[L+1].dts-this._dtsBase-i-D}else if(null!=_){var U=_.dts-this._dtsBase-i;N=U-D}else N=R.length>=1?R[R.length-1].duration:Math.floor(u);var F=!1,B=null;if(N>1.5*u&&"mp3"!==this._audioMeta.codec&&this._fillAudioTimestampGap&&!f.default.safari){F=!0;var j=Math.abs(N-u),V=Math.ceil(j/u),G=D+u;s.default.w(this.TAG,"Large audio timestamp gap detected, may cause AV sync to drift. Silent frames will be generated to avoid unsync.\ndts: "+(D+N)+" ms, expected: "+(D+Math.round(u))+" ms, delta: "+Math.round(j)+" ms, generate: "+V+" frames");var z=d.default.getSilentFrame(this._audioMeta.originalCodec,this._audioMeta.channelCount);null==z&&(s.default.w(this.TAG,"Unable to generate silent frame for "+this._audioMeta.originalCodec+" with "+this._audioMeta.channelCount+" channels, repeat last frame"),z=P),B=[];for(var H=0;H<V;H++){var K=Math.round(G);if(B.length>0){var Y=B[B.length-1];Y.duration=K-Y.dts}var W={dts:K,pts:K,cts:0,unit:z,size:z.byteLength,duration:0,originalDts:O,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0}};B.push(W),y+=P.byteLength,G+=u}var q=B[B.length-1];q.duration=D+N-q.dts,N=Math.round(u)}R.push({dts:D,pts:D,cts:0,unit:I.unit,size:I.unit.byteLength,duration:N,originalDts:O,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0}}),F&&R.push.apply(R,B)}c?v=new Uint8Array(y):(v=new Uint8Array(y),v[0]=y>>>24&255,v[1]=y>>>16&255,v[2]=y>>>8&255,v[3]=255&y,v.set(l.default.types.mdat,4));for(var X=0;X<R.length;X++){var $=R[X].unit;v.set($,g),g+=$.byteLength}var Z=R[R.length-1];o=Z.dts+Z.duration,this._audioNextDts=o;var Q=new p.MediaSegmentInfo;Q.beginDts=a,Q.endDts=o,Q.beginPts=a,Q.endPts=o,Q.originalBeginDts=R[0].originalDts,Q.originalEndDts=Z.originalDts+Z.duration,Q.firstSample=new p.SampleInfo(R[0].dts,R[0].pts,R[0].duration,R[0].originalDts,!1),Q.lastSample=new p.SampleInfo(Z.dts,Z.pts,Z.duration,Z.originalDts,!1),this._isLive||this._audioSegmentInfoList.append(Q),n.samples=R,n.sequenceNumber++;var J=null;J=c?new Uint8Array:l.default.moof(n,a),n.samples=[],n.length=0;var tt={type:"audio",data:this._mergeBoxes(J,v).buffer,sampleCount:R.length,info:Q};c&&h&&(tt.timestampOffset=a),this._onMediaSegment("audio",tt)}}}},{key:"_remuxVideo",value:function(t,e){if(null!=this._videoMeta){var n=t,r=n.samples,i=void 0,a=-1,o=-1,s=-1,u=-1;if(r&&0!==r.length&&(1!==r.length||e)){var c=8,d=null,h=8+t.length,f=null;if(r.length>1&&(f=r.pop(),h-=f.length),null!=this._videoStashedLastSample){var m=this._videoStashedLastSample;this._videoStashedLastSample=null,r.unshift(m),h+=m.length}null!=f&&(this._videoStashedLastSample=f);var g=r[0].dts-this._dtsBase;if(this._videoNextDts)i=g-this._videoNextDts;else if(this._videoSegmentInfoList.isEmpty())i=0;else{var v=this._videoSegmentInfoList.getLastSampleBefore(g);if(null!=v){var y=g-(v.originalDts+v.duration);y<=3&&(y=0);var _=v.dts+v.duration+y;i=g-_}else i=0}for(var b=new p.MediaSegmentInfo,E=[],w=0;w<r.length;w++){var A=r[w],S=A.dts-this._dtsBase,T=A.isKeyframe,x=S-i,k=A.cts,C=x+k;-1===a&&(a=x,s=C);var M=0;if(w!==r.length-1){M=r[w+1].dts-this._dtsBase-i-x}else if(null!=f){var R=f.dts-this._dtsBase-i;M=R-x}else M=E.length>=1?E[E.length-1].duration:Math.floor(this._videoMeta.refSampleDuration);if(T){var L=new p.SampleInfo(x,C,M,A.dts,!0);L.fileposition=A.fileposition,b.appendSyncPoint(L)}E.push({dts:x,pts:C,cts:k,units:A.units,size:A.length,isKeyframe:T,duration:M,originalDts:S,flags:{isLeading:0,dependsOn:T?2:1,isDependedOn:T?1:0,hasRedundancy:0,isNonSync:T?0:1}})}d=new Uint8Array(h),d[0]=h>>>24&255,d[1]=h>>>16&255,d[2]=h>>>8&255,d[3]=255&h,d.set(l.default.types.mdat,4);for(var I=0;I<E.length;I++)for(var P=E[I].units;P.length;){var O=P.shift(),D=O.data;d.set(D,c),c+=D.byteLength}var N=E[E.length-1];if(o=N.dts+N.duration,u=N.pts+N.duration,this._videoNextDts=o,b.beginDts=a,b.endDts=o,b.beginPts=s,b.endPts=u,b.originalBeginDts=E[0].originalDts,b.originalEndDts=N.originalDts+N.duration,b.firstSample=new p.SampleInfo(E[0].dts,E[0].pts,E[0].duration,E[0].originalDts,E[0].isKeyframe),b.lastSample=new p.SampleInfo(N.dts,N.pts,N.duration,N.originalDts,N.isKeyframe),this._isLive||this._videoSegmentInfoList.append(b),n.samples=E,n.sequenceNumber++,this._forceFirstIDR){var U=E[0].flags;U.dependsOn=2,U.isNonSync=0}var F=l.default.moof(n,a);n.samples=[],n.length=0,this._onMediaSegment("video",{type:"video",data:this._mergeBoxes(F,d).buffer,sampleCount:E.length,info:b})}}}},{key:"_mergeBoxes",value:function(t,e){var n=new Uint8Array(t.byteLength+e.byteLength);return n.set(t,0),n.set(e,t.byteLength),n}},{key:"onInitSegment",get:function(){return this._onInitSegment},set:function(t){this._onInitSegment=t}},{key:"onMediaSegment",get:function(){return this._onMediaSegment},set:function(t){this._onMediaSegment=t}}]),t}();n.default=g},{"../core/media-segment-info.js":8,"../utils/browser.js":39,"../utils/exception.js":40,"../utils/logger.js":41,"./aac-silent.js":36,"./mp4-generator.js":37}],39:[function(t,e,n){Object.defineProperty(n,"__esModule",{value:!0});var r={};!function(){var t=self.navigator.userAgent.toLowerCase(),e=/(edge)\/([\w.]+)/.exec(t)||/(opr)[\/]([\w.]+)/.exec(t)||/(chrome)[ \/]([\w.]+)/.exec(t)||/(iemobile)[\/]([\w.]+)/.exec(t)||/(version)(applewebkit)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(t)||/(webkit)[ \/]([\w.]+).*(version)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(t)||/(webkit)[ \/]([\w.]+)/.exec(t)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(t)||/(msie) ([\w.]+)/.exec(t)||t.indexOf("trident")>=0&&/(rv)(?::| )([\w.]+)/.exec(t)||t.indexOf("compatible")<0&&/(firefox)[ \/]([\w.]+)/.exec(t)||[],n=/(ipad)/.exec(t)||/(ipod)/.exec(t)||/(windows phone)/.exec(t)||/(iphone)/.exec(t)||/(kindle)/.exec(t)||/(android)/.exec(t)||/(windows)/.exec(t)||/(mac)/.exec(t)||/(linux)/.exec(t)||/(cros)/.exec(t)||[],i={browser:e[5]||e[3]||e[1]||"",version:e[2]||e[4]||"0",majorVersion:e[4]||e[2]||"0",platform:n[0]||""},a={};if(i.browser){a[i.browser]=!0;var o=i.majorVersion.split(".");a.version={major:parseInt(i.majorVersion,10),string:i.version},o.length>1&&(a.version.minor=parseInt(o[1],10)),o.length>2&&(a.version.build=parseInt(o[2],10))}i.platform&&(a[i.platform]=!0),(a.chrome||a.opr||a.safari)&&(a.webkit=!0),(a.rv||a.iemobile)&&(a.rv&&delete a.rv,i.browser="msie",a["msie"]=!0),a.edge&&(delete a.edge,i.browser="msedge",a["msedge"]=!0),a.opr&&(i.browser="opera",a["opera"]=!0),a.safari&&a.android&&(i.browser="android",a["android"]=!0),a.name=i.browser,a.platform=i.platform;for(var s in r)r.hasOwnProperty(s)&&delete r[s];(0,x.default)(r,a)}(),n.default=r},{}],40:[function(t,e,n){function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==(void 0===e?"undefined":(0,I.default)(e))&&"function"!=typeof e?t:e}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+(void 0===e?"undefined":(0,I.default)(e)));t.prototype=(0,c.default)(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(b.default?(0,b.default)(t,e):t.__proto__=e)}function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),(0,S.default)(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),s=n.RuntimeException=function(){function t(e){a(this,t),this._message=e}return o(t,[{key:"toString",value:function(){return this.name+": "+this.message}},{key:"name",get:function(){return"RuntimeException"}},{key:"message",get:function(){return this._message}}]),t}();n.IllegalStateException=function(t){function e(t){return a(this,e),r(this,(e.__proto__||(0,h.default)(e)).call(this,t))}return i(e,t),o(e,[{key:"name",get:function(){return"IllegalStateException"}}]),e}(s),n.InvalidArgumentException=function(t){function e(t){return a(this,e),r(this,(e.__proto__||(0,h.default)(e)).call(this,t))}return i(e,t),o(e,[{key:"name",get:function(){return"InvalidArgumentException"}}]),e}(s),n.NotImplementedException=function(t){function e(t){return a(this,e),r(this,(e.__proto__||(0,h.default)(e)).call(this,t))}return i(e,t),o(e,[{key:"name",get:function(){return"NotImplementedException"}}]),e}(s)},{}],41:[function(t,e,n){function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),(0,S.default)(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),a=t("events"),o=function(t){return t&&t.__esModule?t:{default:t}}(a),s=function(){function t(){r(this,t)}return i(t,null,[{key:"e",value:function(e,n){e&&!t.FORCE_GLOBAL_TAG||(e=t.GLOBAL_TAG);var r="["+e+"] > "+n;t.ENABLE_CALLBACK&&t.emitter.emit("log","error",r),t.ENABLE_ERROR&&(console.error?console.error(r):console.warn?console.warn(r):console.log(r))}},{key:"i",value:function(e,n){e&&!t.FORCE_GLOBAL_TAG||(e=t.GLOBAL_TAG);var r="["+e+"] > "+n;t.ENABLE_CALLBACK&&t.emitter.emit("log","info",r),t.ENABLE_INFO&&(console.info?console.info(r):console.log(r))}},{key:"w",value:function(e,n){e&&!t.FORCE_GLOBAL_TAG||(e=t.GLOBAL_TAG);var r="["+e+"] > "+n;t.ENABLE_CALLBACK&&t.emitter.emit("log","warn",r),t.ENABLE_WARN&&(console.warn?console.warn(r):console.log(r))}},{key:"d",value:function(e,n){e&&!t.FORCE_GLOBAL_TAG||(e=t.GLOBAL_TAG);var r="["+e+"] > "+n;t.ENABLE_CALLBACK&&t.emitter.emit("log","debug",r),t.ENABLE_DEBUG&&(console.debug?console.debug(r):console.log(r))}},{key:"v",value:function(e,n){e&&!t.FORCE_GLOBAL_TAG||(e=t.GLOBAL_TAG);var r="["+e+"] > "+n;t.ENABLE_CALLBACK&&t.emitter.emit("log","verbose",r),t.ENABLE_VERBOSE&&console.log(r)}}]),t}();s.GLOBAL_TAG="flv.js",s.FORCE_GLOBAL_TAG=!1,s.ENABLE_ERROR=!0,s.ENABLE_INFO=!0,s.ENABLE_WARN=!0,s.ENABLE_DEBUG=!0,s.ENABLE_VERBOSE=!0,s.ENABLE_CALLBACK=!1,s.emitter=new o.default,n.default=s},{events:2}],42:[function(t,e,n){function r(t){return t&&t.__esModule?t:{default:t}}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),(0,S.default)(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=t("events"),s=r(o),u=t("./logger.js"),l=r(u),c=function(){function t(){i(this,t)}return a(t,null,[{key:"getConfig",value:function(){return{globalTag:l.default.GLOBAL_TAG,forceGlobalTag:l.default.FORCE_GLOBAL_TAG,enableVerbose:l.default.ENABLE_VERBOSE,enableDebug:l.default.ENABLE_DEBUG,enableInfo:l.default.ENABLE_INFO,enableWarn:l.default.ENABLE_WARN,enableError:l.default.ENABLE_ERROR,enableCallback:l.default.ENABLE_CALLBACK}}},{key:"applyConfig",value:function(t){l.default.GLOBAL_TAG=t.globalTag,l.default.FORCE_GLOBAL_TAG=t.forceGlobalTag,l.default.ENABLE_VERBOSE=t.enableVerbose,l.default.ENABLE_DEBUG=t.enableDebug,l.default.ENABLE_INFO=t.enableInfo,l.default.ENABLE_WARN=t.enableWarn,l.default.ENABLE_ERROR=t.enableError,l.default.ENABLE_CALLBACK=t.enableCallback}},{key:"_notifyChange",value:function(){var e=t.emitter;if(e.listenerCount("change")>0){var n=t.getConfig();e.emit("change",n)}}},{key:"registerListener",value:function(e){t.emitter.addListener("change",e)}},{key:"removeListener",value:function(e){t.emitter.removeListener("change",e)}},{key:"addLogListener",value:function(e){l.default.emitter.addListener("log",e),l.default.emitter.listenerCount("log")>0&&(l.default.ENABLE_CALLBACK=!0,t._notifyChange())}},{key:"removeLogListener",value:function(e){l.default.emitter.removeListener("log",e),0===l.default.emitter.listenerCount("log")&&(l.default.ENABLE_CALLBACK=!1,t._notifyChange())}},{key:"forceGlobalTag",get:function(){return l.default.FORCE_GLOBAL_TAG},set:function(e){l.default.FORCE_GLOBAL_TAG=e,t._notifyChange()}},{key:"globalTag",get:function(){return l.default.GLOBAL_TAG},set:function(e){l.default.GLOBAL_TAG=e,t._notifyChange()}},{key:"enableAll",get:function(){return l.default.ENABLE_VERBOSE&&l.default.ENABLE_DEBUG&&l.default.ENABLE_INFO&&l.default.ENABLE_WARN&&l.default.ENABLE_ERROR},set:function(e){l.default.ENABLE_VERBOSE=e,l.default.ENABLE_DEBUG=e,l.default.ENABLE_INFO=e,l.default.ENABLE_WARN=e,l.default.ENABLE_ERROR=e,t._notifyChange()}},{key:"enableDebug",get:function(){return l.default.ENABLE_DEBUG},set:function(e){l.default.ENABLE_DEBUG=e,t._notifyChange()}},{key:"enableVerbose",get:function(){return l.default.ENABLE_VERBOSE},set:function(e){l.default.ENABLE_VERBOSE=e,t._notifyChange()}},{key:"enableInfo",get:function(){return l.default.ENABLE_INFO},set:function(e){l.default.ENABLE_INFO=e,t._notifyChange()}},{key:"enableWarn",get:function(){return l.default.ENABLE_WARN},set:function(e){l.default.ENABLE_WARN=e,t._notifyChange()}},{key:"enableError",get:function(){return l.default.ENABLE_ERROR},set:function(e){l.default.ENABLE_ERROR=e,t._notifyChange()}}]),t}();c.emitter=new s.default,n.default=c},{"./logger.js":41,events:2}],43:[function(t,e,n){function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),(0,S.default)(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),a=function(){function e(){r(this,e)}return i(e,null,[{key:"install",value:function(){Object.setPrototypeOf=b.default||function(t,e){return t.__proto__=e,t},Object.assign=x.default||function(t){if(void 0===t||null===t)throw new TypeError("Cannot convert undefined or null to object");for(var e=Object(t),n=1;n<arguments.length;n++){var r=arguments[n];if(void 0!==r&&null!==r)for(var i in r)r.hasOwnProperty(i)&&(e[i]=r[i])}return e},"function"!=typeof self.Promise&&t("es6-promise").polyfill()}}]),e}();a.install(),n.default=a},{"es6-promise":1}],44:[function(t,e,n){function r(t,e,n){var r=t;if(e+n<r.length){for(;n--;)if(128!=(192&r[++e]))return!1;return!0}return!1}function i(t){for(var e=[],n=t,i=0,a=t.length;i<a;)if(n[i]<128)e.push(String.fromCharCode(n[i])),++i;else{if(n[i]<192);else if(n[i]<224){if(r(n,i,1)){var o=(31&n[i])<<6|63&n[i+1];if(o>=128){e.push(String.fromCharCode(65535&o)),i+=2;continue}}}else if(n[i]<240){if(r(n,i,2)){var s=(15&n[i])<<12|(63&n[i+1])<<6|63&n[i+2];if(s>=2048&&55296!=(63488&s)){e.push(String.fromCharCode(65535&s)),i+=3;continue}}}else if(n[i]<248&&r(n,i,3)){var u=(7&n[i])<<18|(63&n[i+1])<<12|(63&n[i+2])<<6|63&n[i+3];if(u>65536&&u<1114112){u-=65536,e.push(String.fromCharCode(u>>>10|55296)),e.push(String.fromCharCode(1023&u|56320)),i+=4;continue}}e.push(String.fromCharCode(65533)),++i}return e.join("")}Object.defineProperty(n,"__esModule",{value:!0}),n.default=i},{}]},{},[21])(21)})}).call(e,n(46))},function(t,e,n){n(209),t.exports=n(5).Object.getPrototypeOf},function(t,e,n){var r=n(32),i=n(75);n(69)("getPrototypeOf",function(){return function(t){return i(r(t))}})},function(t,e,n){n(53),n(34),n(36),n(211),n(214),n(215),t.exports=n(5).Promise},function(t,e,n){"use strict";var r,i,a,o,s=n(50),u=n(14),l=n(20),c=n(58),d=n(12),h=n(17),f=n(41),p=n(59),m=n(39),g=n(116),v=n(117).set,y=n(213)(),_=n(87),b=n(118),E=n(119),w=u.TypeError,A=u.process,S=u["Promise"],T="process"==c(A),x=function(){},k=i=_.f,C=!!function(){try{var t=S.resolve(1),e=(t.constructor={})[n(11)("species")]=function(t){t(x,x)};return(T||"function"==typeof PromiseRejectionEvent)&&t.then(x)instanceof e}catch(r){}}(),M=s?function(t,e){return t===e||t===S&&e===o}:function(t,e){return t===e},R=function(t){var e;return!(!h(t)||"function"!=typeof(e=t.then))&&e},L=function(t,e){if(!t._n){t._n=!0;var n=t._c;y(function(){for(var r=t._v,i=1==t._s,a=0;n.length>a;)!function(e){var n,a,o=i?e.ok:e.fail,s=e.resolve,u=e.reject,l=e.domain;try{o?(i||(2==t._h&&O(t),t._h=1),!0===o?n=r:(l&&l.enter(),n=o(r),l&&l.exit()),n===e.promise?u(w("Promise-chain cycle")):(a=R(n))?a.call(n,s,u):s(n)):u(r)}catch(c){u(c)}}(n[a++]);t._c=[],t._n=!1,e&&!t._h&&I(t)})}},I=function(t){v.call(u,function(){var e,n,r,i=t._v,a=P(t);if(a&&(e=b(function(){T?A.emit("unhandledRejection",i,t):(n=u.onunhandledrejection)?n({promise:t,reason:i}):(r=u.console)&&r.error&&r.error("Unhandled promise rejection",i)}),t._h=T||P(t)?2:1),t._a=void 0,a&&e.e)throw e.v})},P=function(t){if(1==t._h)return!1;for(var e,n=t._a||t._c,r=0;n.length>r;)if(e=n[r++],e.fail||!P(e.promise))return!1;return!0},O=function(t){v.call(u,function(){var e;T?A.emit("rejectionHandled",t):(e=u.onrejectionhandled)&&e({promise:t,reason:t._v})})},D=function(t){var e=this;e._d||(e._d=!0,e=e._w||e,e._v=t,e._s=2,e._a||(e._a=e._c.slice()),L(e,!0))},N=function(t){var e,n=this;if(!n._d){n._d=!0,n=n._w||n;try{if(n===t)throw w("Promise can't be resolved itself");(e=R(t))?y(function(){var r={_w:n,_d:!1};try{e.call(t,l(N,r,1),l(D,r,1))}catch(i){D.call(r,i)}}):(n._v=t,n._s=1,L(n,!1))}catch(r){D.call({_w:n,_d:!1},r)}}};C||(S=function(t){p(this,S,"Promise","_h"),f(t),r.call(this);try{t(l(N,this,1),l(D,this,1))}catch(e){D.call(this,e)}},r=function(t){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1},r.prototype=n(60)(S.prototype,{then:function(t,e){var n=k(g(this,S));return n.ok="function"!=typeof t||t,n.fail="function"==typeof e&&e,n.domain=T?A.domain:void 0,this._c.push(n),this._a&&this._a.push(n),this._s&&L(this,!1),n.promise},catch:function(t){return this.then(void 0,t)}}),a=function(){var t=new r;this.promise=t,this.resolve=l(N,t,1),this.reject=l(D,t,1)},_.f=k=function(t){return M(S,t)?new a(t):i(t)}),d(d.G+d.W+d.F*!C,{Promise:S}),n(43)(S,"Promise"),n(120)("Promise"),o=n(5)["Promise"],d(d.S+d.F*!C,"Promise",{reject:function(t){var e=k(this);return(0,e.reject)(t),e.promise}}),d(d.S+d.F*(s||!C),"Promise",{resolve:function(t){return t instanceof S&&M(t.constructor,this)?t:E(this,t)}}),d(d.S+d.F*!(C&&n(106)(function(t){S.all(t)["catch"](x)})),"Promise",{all:function(t){var e=this,n=k(e),r=n.resolve,i=n.reject,a=b(function(){var n=[],a=0,o=1;m(t,!1,function(t){var s=a++,u=!1;n.push(void 0),o++,e.resolve(t).then(function(t){u||(u=!0,n[s]=t,--o||r(n))},i)}),--o||r(n)});return a.e&&i(a.v),n.promise},race:function(t){var e=this,n=k(e),r=n.reject,i=b(function(){m(t,!1,function(t){e.resolve(t).then(n.resolve,r)})});return i.e&&r(i.v),n.promise}})},function(t,e){t.exports=function(t,e,n){var r=void 0===n;switch(e.length){case 0:return r?t():t.call(n);case 1:return r?t(e[0]):t.call(n,e[0]);case 2:return r?t(e[0],e[1]):t.call(n,e[0],e[1]);case 3:return r?t(e[0],e[1],e[2]):t.call(n,e[0],e[1],e[2]);case 4:return r?t(e[0],e[1],e[2],e[3]):t.call(n,e[0],e[1],e[2],e[3])}return t.apply(n,e)}},function(t,e,n){var r=n(14),i=n(117).set,a=r.MutationObserver||r.WebKitMutationObserver,o=r.process,s=r.Promise,u="process"==n(40)(o);t.exports=function(){var t,e,n,l=function(){var r,i;for(u&&(r=o.domain)&&r.exit();t;){i=t.fn,t=t.next;try{i()}catch(a){throw t?n():e=void 0,a}}e=void 0,r&&r.enter()};if(u)n=function(){o.nextTick(l)};else if(a){var c=!0,d=document.createTextNode("");new a(l).observe(d,{characterData:!0}),n=function(){d.data=c=!c}}else if(s&&s.resolve){var h=s.resolve();n=function(){h.then(l)}}else n=function(){i.call(r,l)};return function(r){var i={fn:r,next:void 0};e&&(e.next=i),t||(t=i,n()),e=i}}},function(t,e,n){"use strict";var r=n(12),i=n(5),a=n(14),o=n(116),s=n(119);r(r.P+r.R,"Promise",{finally:function(t){var e=o(this,i.Promise||a.Promise),n="function"==typeof t;return this.then(n?function(n){return s(e,t()).then(function(){return n})}:t,n?function(n){return s(e,t()).then(function(){throw n})}:t)}})},function(t,e,n){"use strict";var r=n(12),i=n(87),a=n(118);r(r.S,"Promise",{try:function(t){var e=i.f(this),n=a(t);return(n.e?e.reject:e.resolve)(n.v),e.promise}})},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(217),i=function(t){return t&&t.__esModule?t:{default:t}}(r);e.default=i.default,t.exports=e["default"]},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=n(121),a=r(i),o=n(0),s=r(o),u=n(1),l=r(u),c=n(3),d=r(c),h=n(2),f=r(h),p=n(111),m=r(p),g=n(110),v=r(g),y=n(4),_=r(y),b=n(13),E=r(b),w=n(228),A=r(w),S=n(229),T=r(S),x=function(t){function e(){(0,s.default)(this,e);for(var n=arguments.length,r=Array(n),i=0;i<n;i++)r[i]=arguments[i];var o=(0,l.default)(this,t.call.apply(t,[this].concat(r))),u={};return o.options.wstrackers&&(u.trackerAnnounce=[],u.trackerAnnounce=o.options.wstrackers),o.options.iceservers&&(u.rtcConfig={},u.rtcConfig.iceServers=[],u.rtcConfig.iceServers=o.options.iceservers),o.options.playbacktype&&(u.playbacktype=o.options.playbacktype),o.downloadStats=[],o.downloadTotals={http:0,p2p:0},o.uploadStats=[],o.uploadTotal=0,o.loadSpeedTimespan=10,o.p2pclients=new a.default,o.engine=T.default.createEngine(u),o.options.playback.hlsjsConfig.loader=o.engine.createLoaderClass(),o.engine.on(T.default.Events.PeerConnect,o.onPeerConnect.bind(o)),o.engine.on(T.default.Events.PeerClose,o.onPeerClose.bind(o)),o.engine.on(T.default.Events.PieceBytesDownloaded,o.onBytesDownloaded.bind(o)),o.engine.on(T.default.Events.PieceBytesUploaded,o.onBytesUploaded.bind(o)),setInterval(o.updateChartData.bind(o),1e3),o}return(0,f.default)(e,t),(0,d.default)(e,[{key:"name",get:function(){return"p2phls"}}]),e.prototype.play=function(){var e=this;this._hls||(this._setupHls(),this._hls.on(m.default.Events.FRAG_CHANGED,function(t,n){return e._onFragmentChanged(t,n)}),this._hls.on(m.default.Events.DESTROYING,function(){return e._onDestroy()}),this._hls.on(m.default.Events.ERROR,function(t,n){return e._onError(t,n)})),t.prototype.play.call(this)},e.prototype._onFragmentChanged=function(t,e){var n=e.frag,r=2!==n.byteRange.length?void 0:{offset:n.byteRange[0],length:n.byteRange[1]-n.byteRange[0]};this.engine.setPlayingSegment(n.url,r,n.start,n.duration)},e.prototype._onDestroy=function(t,e){this.engine.destroy()},e.prototype._onError=function(t,e){if("bufferStalledError"===e.details){var n=void 0===this._hls.media?this._hls.el_:this._hls.media;if(void 0===n)return;if(console.log("bufferStalledError, setcurrenttime: "+n.currentTime),this._levelSwitching)return;this.getPlaybackType()===E.default.VOD&&this.engine.setPlayingSegmentByCurrentTime(n.currentTime)}},e.prototype.onPeerConnect=function(t){console.log("peer connected: "+t.remoteAddress),this.p2pclients.set(t.id,t.remoteAddress)},e.prototype.onPeerClose=function(t){console.log("peer disconnected: "+t),this.p2pclients.delete(peer.id)},e.prototype.onBytesDownloaded=function(t,e){this.downloadStats.push({method:t,size:e,timestamp:performance.now()}),this.downloadTotals[t]+=e},e.prototype.onBytesUploaded=function(t,e){this.uploadStats.push({size:e,timestamp:performance.now()}),this.uploadTotal+=e},e.prototype.getDownloadSpeed=function(){for(var t=performance.now()-1e3*this.loadSpeedTimespan,e=0,n=0,r=this.downloadStats.length;r--;){var i=this.downloadStats[r];if(i.timestamp<t)break;"p2p"===i.method?n+=i.size:"http"===i.method&&(e+=i.size)}return this.downloadStats.splice(0,r+1),{p2p:n/this.loadSpeedTimespan,http:e/this.loadSpeedTimespan}},e.prototype.getUploadSpeed=function(){for(var t=performance.now()-1e3*this.loadSpeedTimespan,e=0,n=this.uploadStats.length;n--;){var r=this.uploadStats[n];if(r.timestamp<t)break;e+=r.size}return this.uploadStats.splice(0,n+1),e/this.loadSpeedTimespan},e.prototype.updateChartData=function(){var t=this.getDownloadSpeed(),e=Number((8*t.http/1e6).toFixed(2)),n=Number((8*t.p2p/1e6).toFixed(2)),r=Number((e+n).toFixed(2)),i=Number(8*this.getUploadSpeed()/1e6).toFixed(2),a=this.downloadTotals.http/1048576,o=this.downloadTotals.p2p/1048576,s=a+o,u=this.uploadTotal/1048576;this.trigger(_.default.PLAYBACK_P2P_STATUS,{totalMb:Number(s).toFixed(1),p2pMb:Number(o).toFixed(1),uploadMb:Number(u).toFixed(1),totalbps:r,p2pbps:n,uploadbps:i,p2pcount:this.p2pclients.size})},e.prototype.updateLegendTotals=function(){var t=this.downloadTotals.http/1048576,e=this.downloadTotals.p2p/1048576,n=t+e,r=this.uploadTotal/1048576;0!=n&&console.log("network flow upload :"+Number(r).toFixed(1)+", totalMb :"+Number(n).toFixed(1)+", httpMb : "+Number(t).toFixed(1)+", p2pMb : "+Number(e).toFixed(1))},e}(v.default);e.default=x,x.canPlay=function(t,e,n){if(void 0===n.wstrackers||""===n.wstrackers||void 0===n.iceservers||""===n.iceservers)return!1;var r=(0,A.default)();return r&&void 0!==r.RTCPeerConnection.prototype.createDataChannel&&v.default.canPlay(t,e)},t.exports=e["default"]},function(t,e,n){n(53),n(34),n(36),n(219),n(223),n(226),n(227),t.exports=n(5).Map},function(t,e,n){"use strict";var r=n(220),i=n(61);t.exports=n(122)("Map",function(t){return function(){return t(this,arguments.length>0?arguments[0]:void 0)}},{get:function(t){var e=r.getEntry(i(this,"Map"),t);return e&&e.v},set:function(t,e){return r.def(i(this,"Map"),0===t?0:t,e)}},r,!0)},function(t,e,n){"use strict";var r=n(16).f,i=n(51),a=n(60),o=n(20),s=n(59),u=n(39),l=n(73),c=n(93),d=n(120),h=n(19),f=n(45).fastKey,p=n(61),m=h?"_s":"size",g=function(t,e){var n,r=f(e);if("F"!==r)return t._i[r];for(n=t._f;n;n=n.n)if(n.k==e)return n};t.exports={getConstructor:function(t,e,n,l){var c=t(function(t,r){s(t,c,e,"_i"),t._t=e,t._i=i(null),t._f=void 0,t._l=void 0,t[m]=0,void 0!=r&&u(r,n,t[l],t)});return a(c.prototype,{clear:function(){for(var t=p(this,e),n=t._i,r=t._f;r;r=r.n)r.r=!0,r.p&&(r.p=r.p.n=void 0),delete n[r.i];t._f=t._l=void 0,t[m]=0},delete:function(t){var n=p(this,e),r=g(n,t);if(r){var i=r.n,a=r.p;delete n._i[r.i],r.r=!0,a&&(a.n=i),i&&(i.p=a),n._f==r&&(n._f=i),n._l==r&&(n._l=a),n[m]--}return!!r},forEach:function(t){p(this,e);for(var n,r=o(t,arguments.length>1?arguments[1]:void 0,3);n=n?n.n:this._f;)for(r(n.v,n.k,this);n&&n.r;)n=n.p},has:function(t){return!!g(p(this,e),t)}}),h&&r(c.prototype,"size",{get:function(){return p(this,e)[m]}}),c},def:function(t,e,n){var r,i,a=g(t,e);return a?a.v=n:(t._l=a={i:i=f(e,!0),k:e,v:n,p:r=t._l,n:void 0,r:!1},t._f||(t._f=a),r&&(r.n=a),t[m]++,"F"!==i&&(t._i[i]=a)),t},getEntry:g,setStrong:function(t,e,n){l(t,e,function(t,n){this._t=p(t,e),this._k=n,this._l=void 0},function(){for(var t=this,e=t._k,n=t._l;n&&n.r;)n=n.p;return t._t&&(t._l=n=n?n.n:t._t._f)?"keys"==e?c(0,n.k):"values"==e?c(0,n.v):c(0,[n.k,n.v]):(t._t=void 0,c(1))},n?"entries":"values",!n,!0),d(e)}}},function(t,e,n){var r=n(222);t.exports=function(t,e){return new(r(t))(e)}},function(t,e,n){var r=n(17),i=n(94),a=n(11)("species");t.exports=function(t){var e;return i(t)&&(e=t.constructor,"function"!=typeof e||e!==Array&&!i(e.prototype)||(e=void 0),r(e)&&null===(e=e[a])&&(e=void 0)),void 0===e?Array:e}},function(t,e,n){var r=n(12);r(r.P+r.R,"Map",{toJSON:n(224)("Map")})},function(t,e,n){var r=n(58),i=n(225);t.exports=function(t){return function(){if(r(this)!=t)throw TypeError(t+"#toJSON isn't generic");return i(this)}}},function(t,e,n){var r=n(39);t.exports=function(t,e){var n=[];return r(t,!1,n.push,n,e),n}},function(t,e,n){n(123)("Map")},function(t,e,n){n(124)("Map")},function(t,e){t.exports=function(){if("undefined"==typeof window)return null;var t={RTCPeerConnection:window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection,RTCSessionDescription:window.RTCSessionDescription||window.mozRTCSessionDescription||window.webkitRTCSessionDescription,RTCIceCandidate:window.RTCIceCandidate||window.mozRTCIceCandidate||window.webkitRTCIceCandidate};return t.RTCPeerConnection?t:null}},function(t,e,n){"use strict";(function(r){function i(t){return t&&t.__esModule?t:{default:t}}var a,o,s,u,u,l=n(82),c=i(l),d=n(115),h=i(d),f=n(121),p=i(f),m=n(230),g=i(m),v=n(233),y=i(v),_=n(236),b=i(_),E=n(242),w=i(E),A=n(114),S=i(A),T=n(80),x=i(T),k=n(55),C=i(k),M=n(54),R=i(M),L=n(245),I=i(L),P=n(72),O=i(P),D=n(76),N=i(D),U=n(81),F=i(U),B=n(56),j=i(B),V=n(28),G=i(V),z=n(26),H=i(z);!function(n){if("object"===(0,H.default)(e)&&void 0!==t)t.exports=n();else{o=[],a=n,void 0!==(s="function"==typeof a?a.apply(e,o):a)&&(t.exports=s)}}(function(){var t;return function(){function t(e,n,r){function i(o,s){if(!n[o]){if(!e[o]){var l="function"==typeof u&&u;if(!s&&l)return u(o,!0);if(a)return a(o,!0);var c=new Error("Cannot find module '"+o+"'");throw c.code="MODULE_NOT_FOUND",c}var d=n[o]={exports:{}};e[o][0].call(d.exports,function(t){return i(e[o][1][t]||t)},d,d.exports,t,e,n,r)}return n[o].exports}for(var a="function"==typeof u&&u,o=0;o<r.length;o++)i(r[o]);return i}return t}()({1:[function(t,e,n){function r(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=t.indexOf("=");return-1===n&&(n=e),[n,n===e?0:4-n%4]}function i(t){var e=r(t),n=e[0],i=e[1];return 3*(n+i)/4-i}function a(t,e,n){return 3*(e+n)/4-n}function o(t){for(var e,n=r(t),i=n[0],o=n[1],s=new h(a(t,i,o)),u=0,l=o>0?i-4:i,c=0;c<l;c+=4)e=d[t.charCodeAt(c)]<<18|d[t.charCodeAt(c+1)]<<12|d[t.charCodeAt(c+2)]<<6|d[t.charCodeAt(c+3)],s[u++]=e>>16&255,s[u++]=e>>8&255,s[u++]=255&e;return 2===o&&(e=d[t.charCodeAt(c)]<<2|d[t.charCodeAt(c+1)]>>4,s[u++]=255&e),1===o&&(e=d[t.charCodeAt(c)]<<10|d[t.charCodeAt(c+1)]<<4|d[t.charCodeAt(c+2)]>>2,s[u++]=e>>8&255,s[u++]=255&e),s}function s(t){return c[t>>18&63]+c[t>>12&63]+c[t>>6&63]+c[63&t]}function u(t,e,n){for(var r,i=[],a=e;a<n;a+=3)r=(t[a]<<16&16711680)+(t[a+1]<<8&65280)+(255&t[a+2]),i.push(s(r));return i.join("")}function l(t){for(var e,n=t.length,r=n%3,i=[],a=0,o=n-r;a<o;a+=16383)i.push(u(t,a,a+16383>o?o:a+16383));return 1===r?(e=t[n-1],i.push(c[e>>2]+c[e<<4&63]+"==")):2===r&&(e=(t[n-2]<<8)+t[n-1],i.push(c[e>>10]+c[e>>4&63]+c[e<<2&63]+"=")),i.join("")}n.byteLength=i,n.toByteArray=o,n.fromByteArray=l;for(var c=[],d=[],h="undefined"!=typeof Uint8Array?Uint8Array:Array,f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",p=0,m=f.length;p<m;++p)c[p]=f[p],d[f.charCodeAt(p)]=p;d["-".charCodeAt(0)]=62,d["_".charCodeAt(0)]=63},{}],2:[function(t,e,n){(function(n){function r(t){function e(t){n.nextTick(function(){s.emit("warning",t)})}var s=this;if(!(s instanceof r))return new r(t);if(o.call(s),t||(t={}),!t.peerId)throw new Error("Option `peerId` is required");if(!t.infoHash)throw new Error("Option `infoHash` is required");if(!t.announce)throw new Error("Option `announce` is required");if(!n.browser&&!t.port)throw new Error("Option `port` is required");s.peerId="string"==typeof t.peerId?t.peerId:t.peerId.toString("hex"),s._peerIdBuffer=i.from(s.peerId,"hex"),s._peerIdBinary=s._peerIdBuffer.toString("binary"),s.infoHash="string"==typeof t.infoHash?t.infoHash.toLowerCase():t.infoHash.toString("hex"),s._infoHashBuffer=i.from(s.infoHash,"hex"),s._infoHashBinary=s._infoHashBuffer.toString("binary"),a("new client %s",s.infoHash),s.destroyed=!1,s._port=t.port,s._getAnnounceOpts=t.getAnnounceOpts,s._rtcConfig=t.rtcConfig,s._userAgent=t.userAgent,s._wrtc="function"==typeof t.wrtc?t.wrtc():t.wrtc;var u="string"==typeof t.announce?[t.announce]:null==t.announce?[]:t.announce;u=u.map(function(t){return t=t.toString(),"/"===t[t.length-1]&&(t=t.substring(0,t.length-1)),t}),u=h(u);var l=!1!==s._wrtc&&(!!s._wrtc||d.WEBRTC_SUPPORT);s._trackers=u.map(function(t){var n=f.parse(t).protocol;return"http:"!==n&&"https:"!==n||"function"!=typeof m?"udp:"===n&&"function"==typeof g?new g(s,t):"ws:"!==n&&"wss:"!==n||!l?(e(new Error("Unsupported tracker protocol: "+t)),null):"ws:"===n&&"undefined"!=typeof window&&"https:"===window.location.protocol?(e(new Error("Unsupported tracker protocol: "+t)),null):new v(s,t):new m(s,t)}).filter(Boolean)}e.exports=r;var i=t("safe-buffer").Buffer,a=t("debug")("bittorrent-tracker:client"),o=t("events").EventEmitter,s=t("xtend"),u=t("inherits"),l=t("once"),c=t("run-parallel"),d=t("simple-peer"),h=t("uniq"),f=t("url"),p=t("./lib/common"),m=t("./lib/client/http-tracker"),g=t("./lib/client/udp-tracker"),v=t("./lib/client/websocket-tracker");u(r,o),r.scrape=function(t,e){if(e=l(e),!t.infoHash)throw new Error("Option `infoHash` is required");if(!t.announce)throw new Error("Option `announce` is required");var n=s(t,{infoHash:Array.isArray(t.infoHash)?t.infoHash[0]:t.infoHash,peerId:i.from("01234567890123456789"),port:6881}),a=new r(n);a.once("error",e),a.once("warning",e);var o=Array.isArray(t.infoHash)?t.infoHash.length:1,u={};return a.on("scrape",function(t){if(o-=1,u[t.infoHash]=t,0===o){a.destroy();var n=(0,G.default)(u);1===n.length?e(null,u[n[0]]):e(null,u)}}),t.infoHash=Array.isArray(t.infoHash)?t.infoHash.map(function(t){return i.from(t,"hex")}):i.from(t.infoHash,"hex"),a.scrape({infoHash:t.infoHash}),a},r.prototype.start=function(t){var e=this;a("send `start`"),t=e._defaultAnnounceOpts(t),t.event="started",e._announce(t),e._trackers.forEach(function(t){t.setInterval()})},r.prototype.stop=function(t){var e=this;a("send `stop`"),t=e._defaultAnnounceOpts(t),t.event="stopped",e._announce(t)},r.prototype.complete=function(t){var e=this;a("send `complete`"),t||(t={}),t=e._defaultAnnounceOpts(t),t.event="completed",e._announce(t)},r.prototype.update=function(t){var e=this;a("send `update`"),t=e._defaultAnnounceOpts(t),t.event&&delete t.event,e._announce(t)},r.prototype._announce=function(t){this._trackers.forEach(function(e){e.announce(t)})},r.prototype.scrape=function(t){var e=this;a("send `scrape`"),t||(t={}),e._trackers.forEach(function(e){e.scrape(t)})},r.prototype.setInterval=function(t){var e=this;a("setInterval %d",t),e._trackers.forEach(function(e){e.setInterval(t)})},r.prototype.destroy=function(t){var e=this;if(!e.destroyed){e.destroyed=!0,a("destroy");var n=e._trackers.map(function(t){return function(e){t.destroy(e)}});c(n,t),e._trackers=[],e._getAnnounceOpts=null}},r.prototype._defaultAnnounceOpts=function(t){var e=this;return t||(t={}),null==t.numwant&&(t.numwant=p.DEFAULT_ANNOUNCE_PEERS),null==t.uploaded&&(t.uploaded=0),null==t.downloaded&&(t.downloaded=0),e._getAnnounceOpts&&(t=s(t,e._getAnnounceOpts())),t}}).call(this,t("_process"))},{"./lib/client/http-tracker":9,"./lib/client/udp-tracker":9,"./lib/client/websocket-tracker":5,"./lib/common":6,_process:23,debug:7,events:10,inherits:16,once:21,"run-parallel":38,"safe-buffer":39,"simple-peer":42,uniq:50,url:51,xtend:55}],3:[function(t,e,n){var r=t("./client"),i=t("./server");e.exports=r,e.exports.Client=r,e.exports.Server=i},{"./client":2,"./server":9}],4:[function(t,e,n){function r(t,e){var n=this;i.call(n),n.client=t,n.announceUrl=e,n.interval=null,n.destroyed=!1}e.exports=r;var i=t("events").EventEmitter;t("inherits")(r,i),r.prototype.setInterval=function(t){var e=this;null==t&&(t=e.DEFAULT_ANNOUNCE_INTERVAL),clearInterval(e.interval),t&&(e.interval=setInterval(function(){e.announce(e.client._defaultAnnounceOpts())},t),e.interval.unref&&e.interval.unref())}},{events:10,inherits:16}],5:[function(t,e,n){function r(t,e,n){var r=this;h.call(r,t,e),a("new websocket tracker %s",e),r.peers={},r.socket=null,r.reconnecting=!1,r.retries=0,r.reconnectTimer=null,r.expectingResponse=!1,r._openSocket()}function i(){}e.exports=r;var a=t("debug")("bittorrent-tracker:websocket-tracker"),o=t("xtend"),s=t("inherits"),u=t("simple-peer"),l=t("randombytes"),c=t("simple-websocket"),d=t("../common"),h=t("./tracker"),f={};r._socketPool=f;var p=5e4;s(r,h),r.prototype.DEFAULT_ANNOUNCE_INTERVAL=3e4,r.prototype.announce=function(t){var e=this;if(!e.destroyed&&!e.reconnecting){if(!e.socket.connected)return void e.socket.once("connect",function(){e.announce(t)});var n=o(t,{action:"announce",info_hash:e.client._infoHashBinary,peer_id:e.client._peerIdBinary});if(e._trackerId&&(n.trackerid=e._trackerId),"stopped"===t.event||"completed"===t.event)e._send(n);else{var r=Math.min(t.numwant,10);e._generateOffers(r,function(t){n.numwant=r,n.offers=t,e._send(n)})}}},r.prototype.scrape=function(t){var e=this;if(!e.destroyed&&!e.reconnecting){if(!e.socket.connected)return void e.socket.once("connect",function(){e.scrape(t)});var n=Array.isArray(t.infoHash)&&t.infoHash.length>0?t.infoHash.map(function(t){return t.toString("binary")}):t.infoHash&&t.infoHash.toString("binary")||e.client._infoHashBinary,r={action:"scrape",info_hash:n};e._send(r)}},r.prototype.destroy=function(t){function e(){s&&(clearTimeout(s),s=null),o.removeListener("data",e),o.destroy(),o=null}var n=this;if(t||(t=i),n.destroyed)return t(null);n.destroyed=!0,clearInterval(n.interval),clearTimeout(n.reconnectTimer);for(var r in n.peers){var a=n.peers[r];clearTimeout(a.trackerTimeout),a.destroy()}if(n.peers=null,n.socket&&(n.socket.removeListener("connect",n._onSocketConnectBound),n.socket.removeListener("data",n._onSocketDataBound),n.socket.removeListener("close",n._onSocketCloseBound),n.socket.removeListener("error",n._onSocketErrorBound),n.socket=null),n._onSocketConnectBound=null,n._onSocketErrorBound=null,n._onSocketDataBound=null,n._onSocketCloseBound=null,f[n.announceUrl]&&(f[n.announceUrl].consumers-=1),f[n.announceUrl].consumers>0)return t();var o=f[n.announceUrl];if(delete f[n.announceUrl],o.on("error",i),o.once("close",t),!n.expectingResponse)return e();var s=setTimeout(e,d.DESTROY_TIMEOUT);o.once("data",e)},r.prototype._openSocket=function(){var t=this;t.destroyed=!1,t.peers||(t.peers={}),t._onSocketConnectBound=function(){t._onSocketConnect()},t._onSocketErrorBound=function(e){t._onSocketError(e)},t._onSocketDataBound=function(e){t._onSocketData(e)},t._onSocketCloseBound=function(){t._onSocketClose()},t.socket=f[t.announceUrl],t.socket?f[t.announceUrl].consumers+=1:(t.socket=f[t.announceUrl]=new c(t.announceUrl),t.socket.consumers=1,t.socket.once("connect",t._onSocketConnectBound)),t.socket.on("data",t._onSocketDataBound),t.socket.once("close",t._onSocketCloseBound),t.socket.once("error",t._onSocketErrorBound)},r.prototype._onSocketConnect=function(){var t=this;t.destroyed||t.reconnecting&&(t.reconnecting=!1,t.retries=0,t.announce(t.client._defaultAnnounceOpts()))},r.prototype._onSocketData=function(t){var e=this;if(!e.destroyed){e.expectingResponse=!1;try{t=JSON.parse(t)}catch(n){return void e.client.emit("warning",new Error("Invalid tracker response"))}"announce"===t.action?e._onAnnounceResponse(t):"scrape"===t.action?e._onScrapeResponse(t):e._onSocketError(new Error("invalid action in WS response: "+t.action))}},r.prototype._onAnnounceResponse=function(t){var e=this;if(t.info_hash!==e.client._infoHashBinary)return void a("ignoring websocket data from %s for %s (looking for %s: reused socket)",e.announceUrl,d.binaryToHex(t.info_hash),e.client.infoHash);if(!t.peer_id||t.peer_id!==e.client._peerIdBinary){a("received %s from %s for %s",(0,j.default)(t),e.announceUrl,e.client.infoHash);var n=t["failure reason"];if(n)return e.client.emit("warning",new Error(n));var r=t["warning message"];r&&e.client.emit("warning",new Error(r));var i=t.interval||t["min interval"];i&&e.setInterval(1e3*i);var o=t["tracker id"];if(o&&(e._trackerId=o),null!=t.complete){var s=(0,F.default)({},t,{announce:e.announceUrl,infoHash:d.binaryToHex(t.info_hash)});e.client.emit("update",s)}var u;if(t.offer&&t.peer_id&&(a("creating peer (from remote offer)"),u=e._createPeer(),u.id=d.binaryToHex(t.peer_id),u.once("signal",function(n){var r={action:"announce",info_hash:e.client._infoHashBinary,peer_id:e.client._peerIdBinary,to_peer_id:t.peer_id,answer:n,offer_id:t.offer_id};e._trackerId&&(r.trackerid=e._trackerId),e._send(r)}),u.signal(t.offer),e.client.emit("peer",u)),t.answer&&t.peer_id){var l=d.binaryToHex(t.offer_id);u=e.peers[l],u?(u.id=d.binaryToHex(t.peer_id),u.signal(t.answer),e.client.emit("peer",u),clearTimeout(u.trackerTimeout),u.trackerTimeout=null,delete e.peers[l]):a("got unexpected answer: "+(0,j.default)(t.answer))}}},r.prototype._onScrapeResponse=function(t){var e=this;t=t.files||{};var n=(0,G.default)(t);if(0===n.length)return void e.client.emit("warning",new Error("invalid scrape response"));n.forEach(function(n){var r=(0,F.default)(t[n],{announce:e.announceUrl,infoHash:d.binaryToHex(n)});e.client.emit("scrape",r)})},r.prototype._onSocketClose=function(){var t=this;t.destroyed||(t.destroy(),t._startReconnectTimer())},r.prototype._onSocketError=function(t){var e=this;e.destroyed||(e.destroy(),e.client.emit("warning",t),e._startReconnectTimer())},r.prototype._startReconnectTimer=function(){var t=this,e=Math.floor(3e4*Math.random())+Math.min(15e3*Math.pow(2,t.retries),18e5);t.reconnecting=!0,clearTimeout(t.reconnectTimer),t.reconnectTimer=setTimeout(function(){t.retries++,t._openSocket()},e),t.reconnectTimer.unref&&t.reconnectTimer.unref(),a("reconnecting socket in %s ms",e)},r.prototype._send=function(t){var e=this;if(!e.destroyed){e.expectingResponse=!0;var n=(0,j.default)(t);a("send %s",n),e.socket.send(n)}},r.prototype._generateOffers=function(t,e){function n(){i.length===t&&(a("generated %s offers",t),e(i))}var r=this,i=[];a("generating %s offers",t);for(var o=0;o<t;++o)!function(){var t=l(20).toString("hex");a("creating peer (from _generateOffers)");var e=r.peers[t]=r._createPeer({initiator:!0});e.once("signal",function(e){i.push({offer:e,offer_id:d.hexToBinary(t)}),n()}),e.trackerTimeout=setTimeout(function(){a("tracker timeout: destroying peer"),e.trackerTimeout=null,delete r.peers[t],e.destroy()},p),e.trackerTimeout.unref&&e.trackerTimeout.unref()}();n()},r.prototype._createPeer=function(t){function e(t){r.client.emit("warning",new Error("Connection error: "+t.message)),i.destroy()}function n(){i.removeListener("error",e),i.removeListener("connect",n)}var r=this;t=(0,F.default)({trickle:!1,config:r.client._rtcConfig,wrtc:r.client._wrtc},t);var i=new u(t);return i.once("error",e),i.once("connect",n),i}},{"../common":6,"./tracker":4,debug:7,inherits:16,randombytes:28,"simple-peer":42,"simple-websocket":45,xtend:55}],6:[function(t,e,n){var r=t("safe-buffer").Buffer,i=t("xtend/mutable");n.DEFAULT_ANNOUNCE_PEERS=50,n.MAX_ANNOUNCE_PEERS=82,n.binaryToHex=function(t){return"string"!=typeof t&&(t=String(t)),r.from(t,"binary").toString("hex")},n.hexToBinary=function(t){return"string"!=typeof t&&(t=String(t)),r.from(t,"hex").toString("binary")},i(n,t("./common-node"))},{"./common-node":9,"safe-buffer":39,"xtend/mutable":56}],7:[function(t,e,n){(function(r){function i(t){return(i="function"==typeof N.default&&"symbol"===(0,H.default)(O.default)?function(t){return void 0===t?"undefined":(0,H.default)(t)}:function(t){return t&&"function"==typeof N.default&&t.constructor===N.default&&t!==N.default.prototype?"symbol":void 0===t?"undefined":(0,H.default)(t)})(t)}function a(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type&&!window.process.__nwjs)||("undefined"==typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))}function o(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),this.useColors){var n="color: "+this.color;t.splice(1,0,n,"color: inherit");var r=0,i=0;t[0].replace(/%[a-zA-Z%]/g,function(t){"%%"!==t&&(r++,"%c"===t&&(i=r))}),t.splice(i,0,n)}}function s(){var t;return"object"===("undefined"==typeof console?"undefined":i(console))&&console.log&&(t=console).log.apply(t,arguments)}function u(t){try{t?n.storage.setItem("debug",t):n.storage.removeItem("debug")}catch(e){}}function l(){var t;try{t=n.storage.getItem("debug")}catch(e){}return!t&&void 0!==r&&"env"in r&&(t=r.env.DEBUG),t}n.log=s,n.formatArgs=o,n.save=u,n.load=l,n.useColors=a,n.storage=function(){try{return localStorage}catch(t){}}(),n.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],e.exports=t("./common")(n),e.exports.formatters.j=function(t){try{return(0,j.default)(t)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}}).call(this,t("_process"))},{"./common":8,_process:23}],8:[function(t,e,n){function r(e){function n(t){for(var e=0,n=0;n<t.length;n++)e=(e<<5)-e+t.charCodeAt(n),e|=0;return r.colors[Math.abs(e)%r.colors.length]}function r(t){function e(){if(e.enabled){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];var a=e,s=Number(new Date),u=s-(o||s);a.diff=u,a.prev=o,a.curr=s,o=s,n[0]=r.coerce(n[0]),"string"!=typeof n[0]&&n.unshift("%O");var l=0;n[0]=n[0].replace(/%([a-zA-Z%])/g,function(t,e){if("%%"===t)return t;l++;var i=r.formatters[e];if("function"==typeof i){var o=n[l];t=i.call(a,o),n.splice(l,1),l--}return t}),r.formatArgs.call(a,n);(a.log||r.log).apply(a,n)}}var o;return e.namespace=t,e.enabled=r.enabled(t),e.useColors=r.useColors(),e.color=n(t),e.destroy=i,e.extend=a,"function"==typeof r.init&&r.init(e),r.instances.push(e),e}function i(){var t=r.instances.indexOf(this);return-1!==t&&(r.instances.splice(t,1),!0)}function a(t,e){return r(this.namespace+(void 0===e?":":e)+t)}function o(t){r.save(t),r.names=[],r.skips=[];var e,n=("string"==typeof t?t:"").split(/[\s,]+/),i=n.length;for(e=0;e<i;e++)n[e]&&(t=n[e].replace(/\*/g,".*?"),"-"===t[0]?r.skips.push(new RegExp("^"+t.substr(1)+"$")):r.names.push(new RegExp("^"+t+"$")));for(e=0;e<r.instances.length;e++){var a=r.instances[e];a.enabled=r.enabled(a.namespace)}}function s(){r.enable("")}function u(t){if("*"===t[t.length-1])return!0;var e,n;for(e=0,n=r.skips.length;e<n;e++)if(r.skips[e].test(t))return!1;for(e=0,n=r.names.length;e<n;e++)if(r.names[e].test(t))return!0;return!1}function l(t){return t instanceof Error?t.stack||t.message:t}return r.debug=r,r.default=r,r.coerce=l,r.disable=s,r.enable=o,r.enabled=u,r.humanize=t("ms"),(0,G.default)(e).forEach(function(t){r[t]=e[t]}),r.instances=[],r.names=[],r.skips=[],r.formatters={},r.selectColor=n,r.enable(r.load()),r}e.exports=r},{ms:20}],9:[function(t,e,n){},{}],10:[function(t,e,n){function r(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function i(t){return"function"==typeof t}function a(t){return"number"==typeof t}function o(t){return"object"===(void 0===t?"undefined":(0,H.default)(t))&&null!==t}function s(t){return void 0===t}e.exports=r,r.EventEmitter=r,r.prototype._events=void 0,r.prototype._maxListeners=void 0,r.defaultMaxListeners=10,r.prototype.setMaxListeners=function(t){if(!a(t)||t<0||isNaN(t))throw TypeError("n must be a positive number");return this._maxListeners=t,this},r.prototype.emit=function(t){var e,n,r,a,u,l;if(this._events||(this._events={}),"error"===t&&(!this._events.error||o(this._events.error)&&!this._events.error.length)){if((e=arguments[1])instanceof Error)throw e;var c=new Error('Uncaught, unspecified "error" event. ('+e+")");throw c.context=e,c}if(n=this._events[t],s(n))return!1;if(i(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:a=Array.prototype.slice.call(arguments,1),n.apply(this,a)}else if(o(n))for(a=Array.prototype.slice.call(arguments,1),l=n.slice(),r=l.length,u=0;u<r;u++)l[u].apply(this,a);return!0},r.prototype.addListener=function(t,e){var n;if(!i(e))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",t,i(e.listener)?e.listener:e),this._events[t]?o(this._events[t])?this._events[t].push(e):this._events[t]=[this._events[t],e]:this._events[t]=e,o(this._events[t])&&!this._events[t].warned&&(n=s(this._maxListeners)?r.defaultMaxListeners:this._maxListeners)&&n>0&&this._events[t].length>n&&(this._events[t].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[t].length),"function"==typeof console.trace&&console.trace()),this},r.prototype.on=r.prototype.addListener,r.prototype.once=function(t,e){function n(){this.removeListener(t,n),r||(r=!0,e.apply(this,arguments))}if(!i(e))throw TypeError("listener must be a function");var r=!1;return n.listener=e,this.on(t,n),this},r.prototype.removeListener=function(t,e){var n,r,a,s;if(!i(e))throw TypeError("listener must be a function");if(!this._events||!this._events[t])return this;if(n=this._events[t],a=n.length,r=-1,n===e||i(n.listener)&&n.listener===e)delete this._events[t],this._events.removeListener&&this.emit("removeListener",t,e);else if(o(n)){for(s=a;s-- >0;)if(n[s]===e||n[s].listener&&n[s].listener===e){r=s;break}if(r<0)return this;1===n.length?(n.length=0,delete this._events[t]):n.splice(r,1),this._events.removeListener&&this.emit("removeListener",t,e)}return this},r.prototype.removeAllListeners=function(t){var e,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[t]&&delete this._events[t],this;if(0===arguments.length){for(e in this._events)"removeListener"!==e&&this.removeAllListeners(e);return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[t],i(n))this.removeListener(t,n);else if(n)for(;n.length;)this.removeListener(t,n[n.length-1]);return delete this._events[t],this},r.prototype.listeners=function(t){return this._events&&this._events[t]?i(this._events[t])?[this._events[t]]:this._events[t].slice():[]},r.prototype.listenerCount=function(t){if(this._events){var e=this._events[t];if(i(e))return 1;if(e)return e.length}return 0},r.listenerCount=function(t,e){return t.listenerCount(e)}},{}],11:[function(t,e,n){(function(e){function r(){return a.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function i(t,e){if(r()<e)throw new RangeError("Invalid typed array length");return a.TYPED_ARRAY_SUPPORT?(t=new Uint8Array(e),t.__proto__=a.prototype):(null===t&&(t=new a(e)),t.length=e),t}function a(t,e,n){if(!(a.TYPED_ARRAY_SUPPORT||this instanceof a))return new a(t,e,n);if("number"==typeof t){if("string"==typeof e)throw new Error("If encoding is specified then the first argument must be a string");return l(this,t)}return o(this,t,e,n)}function o(t,e,n,r){if("number"==typeof e)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer?h(t,e,n,r):"string"==typeof e?c(t,e,n):f(t,e)}function s(t){if("number"!=typeof t)throw new TypeError('"size" argument must be a number');if(t<0)throw new RangeError('"size" argument must not be negative')}function u(t,e,n,r){return s(e),e<=0?i(t,e):void 0!==n?"string"==typeof r?i(t,e).fill(n,r):i(t,e).fill(n):i(t,e)}function l(t,e){if(s(e),t=i(t,e<0?0:0|p(e)),!a.TYPED_ARRAY_SUPPORT)for(var n=0;n<e;++n)t[n]=0;return t}function c(t,e,n){if("string"==typeof n&&""!==n||(n="utf8"),!a.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var r=0|g(e,n);t=i(t,r);var o=t.write(e,n);return o!==r&&(t=t.slice(0,o)),t}function d(t,e){var n=e.length<0?0:0|p(e.length);t=i(t,n);for(var r=0;r<n;r+=1)t[r]=255&e[r];return t}function h(t,e,n,r){if(e.byteLength,n<0||e.byteLength<n)throw new RangeError("'offset' is out of bounds");if(e.byteLength<n+(r||0))throw new RangeError("'length' is out of bounds");return e=void 0===n&&void 0===r?new Uint8Array(e):void 0===r?new Uint8Array(e,n):new Uint8Array(e,n,r),a.TYPED_ARRAY_SUPPORT?(t=e,t.__proto__=a.prototype):t=d(t,e),t}function f(t,e){if(a.isBuffer(e)){var n=0|p(e.length);return t=i(t,n),0===t.length?t:(e.copy(t,0,0,n),t)}if(e){if("undefined"!=typeof ArrayBuffer&&e.buffer instanceof ArrayBuffer||"length"in e)return"number"!=typeof e.length||Q(e.length)?i(t,0):d(t,e);if("Buffer"===e.type&&et(e.data))return d(t,e.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}function p(t){if(t>=r())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+r().toString(16)+" bytes");return 0|t}function m(t){return+t!=t&&(t=0),a.alloc(+t)}function g(t,e){if(a.isBuffer(t))return t.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(t)||t instanceof ArrayBuffer))return t.byteLength;"string"!=typeof t&&(t=""+t);var n=t.length;if(0===n)return 0;for(var r=!1;;)switch(e){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return W(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return $(t).length;default:if(r)return W(t).length;e=(""+e).toLowerCase(),r=!0}}function v(t,e,n){var r=!1;if((void 0===e||e<0)&&(e=0),e>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if(n>>>=0,e>>>=0,n<=e)return"";for(t||(t="utf8");;)switch(t){case"hex":return O(this,e,n);case"utf8":case"utf-8":return C(this,e,n);case"ascii":return L(this,e,n);case"latin1":case"binary":return P(this,e,n);case"base64":return k(this,e,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return D(this,e,n);default:if(r)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),r=!0}}function y(t,e,n){var r=t[e];t[e]=t[n],t[n]=r}function _(t,e,n,r,i){if(0===t.length)return-1;if("string"==typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=i?0:t.length-1),n<0&&(n=t.length+n),n>=t.length){if(i)return-1;n=t.length-1}else if(n<0){if(!i)return-1;n=0}if("string"==typeof e&&(e=a.from(e,r)),a.isBuffer(e))return 0===e.length?-1:b(t,e,n,r,i);if("number"==typeof e)return e&=255,a.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(t,e,n):Uint8Array.prototype.lastIndexOf.call(t,e,n):b(t,[e],n,r,i);throw new TypeError("val must be string, number or Buffer")}function b(t,e,n,r,i){function a(t,e){return 1===o?t[e]:t.readUInt16BE(e*o)}var o=1,s=t.length,u=e.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(t.length<2||e.length<2)return-1;o=2,s/=2,u/=2,n/=2}var l;if(i){var c=-1;for(l=n;l<s;l++)if(a(t,l)===a(e,-1===c?0:l-c)){if(-1===c&&(c=l),l-c+1===u)return c*o}else-1!==c&&(l-=l-c),c=-1}else for(n+u>s&&(n=s-u),l=n;l>=0;l--){for(var d=!0,h=0;h<u;h++)if(a(t,l+h)!==a(e,h)){d=!1;break}if(d)return l}return-1}function E(t,e,n,r){n=Number(n)||0;var i=t.length-n;r?(r=Number(r))>i&&(r=i):r=i;var a=e.length;if(a%2!=0)throw new TypeError("Invalid hex string");r>a/2&&(r=a/2);for(var o=0;o<r;++o){var s=parseInt(e.substr(2*o,2),16);if(isNaN(s))return o;t[n+o]=s}return o}function w(t,e,n,r){return Z(W(e,t.length-n),t,n,r)}function A(t,e,n,r){return Z(q(e),t,n,r)}function S(t,e,n,r){return A(t,e,n,r)}function T(t,e,n,r){return Z($(e),t,n,r)}function x(t,e,n,r){return Z(X(e,t.length-n),t,n,r)}function k(t,e,n){return 0===e&&n===t.length?J.fromByteArray(t):J.fromByteArray(t.slice(e,n))}function C(t,e,n){n=Math.min(t.length,n);for(var r=[],i=e;i<n;){var a=t[i],o=null,s=a>239?4:a>223?3:a>191?2:1;if(i+s<=n){var u,l,c,d;switch(s){case 1:a<128&&(o=a);break;case 2:u=t[i+1],128==(192&u)&&(d=(31&a)<<6|63&u)>127&&(o=d);break;case 3:u=t[i+1],l=t[i+2],128==(192&u)&&128==(192&l)&&(d=(15&a)<<12|(63&u)<<6|63&l)>2047&&(d<55296||d>57343)&&(o=d);break;case 4:u=t[i+1],l=t[i+2],c=t[i+3],128==(192&u)&&128==(192&l)&&128==(192&c)&&(d=(15&a)<<18|(63&u)<<12|(63&l)<<6|63&c)>65535&&d<1114112&&(o=d)}}null===o?(o=65533,s=1):o>65535&&(o-=65536,r.push(o>>>10&1023|55296),o=56320|1023&o),r.push(o),i+=s}return M(r)}function M(t){var e=t.length;if(e<=nt)return String.fromCharCode.apply(String,t);for(var n="",r=0;r<e;)n+=String.fromCharCode.apply(String,t.slice(r,r+=nt));return n}function L(t,e,n){var r="";n=Math.min(t.length,n);for(var i=e;i<n;++i)r+=String.fromCharCode(127&t[i]);return r}function P(t,e,n){var r="";n=Math.min(t.length,n);for(var i=e;i<n;++i)r+=String.fromCharCode(t[i]);return r}function O(t,e,n){var r=t.length;(!e||e<0)&&(e=0),(!n||n<0||n>r)&&(n=r);for(var i="",a=e;a<n;++a)i+=Y(t[a]);return i}function D(t,e,n){for(var r=t.slice(e,n),i="",a=0;a<r.length;a+=2)i+=String.fromCharCode(r[a]+256*r[a+1]);return i}function U(t,e,n){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(t+e>n)throw new RangeError("Trying to access beyond buffer length")}function F(t,e,n,r,i,o){if(!a.isBuffer(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>i||e<o)throw new RangeError('"value" argument is out of bounds');if(n+r>t.length)throw new RangeError("Index out of range")}function B(t,e,n,r){e<0&&(e=65535+e+1);for(var i=0,a=Math.min(t.length-n,2);i<a;++i)t[n+i]=(e&255<<8*(r?i:1-i))>>>8*(r?i:1-i)}function j(t,e,n,r){e<0&&(e=4294967295+e+1);for(var i=0,a=Math.min(t.length-n,4);i<a;++i)t[n+i]=e>>>8*(r?i:3-i)&255}function V(t,e,n,r,i,a){if(n+r>t.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function G(t,e,n,r,i){return i||V(t,e,n,4,3.4028234663852886e38,-3.4028234663852886e38),tt.write(t,e,n,r,23,4),n+4}function z(t,e,n,r,i){return i||V(t,e,n,8,1.7976931348623157e308,-1.7976931348623157e308),tt.write(t,e,n,r,52,8),n+8}function H(t){if(t=K(t).replace(rt,""),t.length<2)return"";for(;t.length%4!=0;)t+="=";return t}function K(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}function Y(t){return t<16?"0"+t.toString(16):t.toString(16)}function W(t,e){e=e||1/0;for(var n,r=t.length,i=null,a=[],o=0;o<r;++o){if((n=t.charCodeAt(o))>55295&&n<57344){if(!i){if(n>56319){(e-=3)>-1&&a.push(239,191,189);continue}if(o+1===r){(e-=3)>-1&&a.push(239,191,189);continue}i=n;continue}if(n<56320){(e-=3)>-1&&a.push(239,191,189),i=n;continue}n=65536+(i-55296<<10|n-56320)}else i&&(e-=3)>-1&&a.push(239,191,189);if(i=null,n<128){if((e-=1)<0)break;a.push(n)}else if(n<2048){if((e-=2)<0)break;a.push(n>>6|192,63&n|128)}else if(n<65536){if((e-=3)<0)break;a.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;a.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return a}function q(t){for(var e=[],n=0;n<t.length;++n)e.push(255&t.charCodeAt(n));return e}function X(t,e){for(var n,r,i,a=[],o=0;o<t.length&&!((e-=2)<0);++o)n=t.charCodeAt(o),r=n>>8,i=n%256,a.push(i),a.push(r);return a}function $(t){return J.toByteArray(H(t))}function Z(t,e,n,r){for(var i=0;i<r&&!(i+n>=e.length||i>=t.length);++i)e[i+n]=t[i];return i}function Q(t){return t!==t}var J=t("base64-js"),tt=t("ieee754"),et=t("isarray");n.Buffer=a,n.SlowBuffer=m,n.INSPECT_MAX_BYTES=50,a.TYPED_ARRAY_SUPPORT=void 0!==e.TYPED_ARRAY_SUPPORT?e.TYPED_ARRAY_SUPPORT:function(){try{var t=new Uint8Array(1);return t.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===t.foo()&&"function"==typeof t.subarray&&0===t.subarray(1,1).byteLength}catch(e){return!1}}(),n.kMaxLength=r(),a.poolSize=8192,a._augment=function(t){return t.__proto__=a.prototype,t},a.from=function(t,e,n){return o(null,t,e,n)},a.TYPED_ARRAY_SUPPORT&&(a.prototype.__proto__=Uint8Array.prototype,a.__proto__=Uint8Array,void 0!==N.default&&I.default&&a[I.default]===a&&(0,R.default)(a,I.default,{value:null,configurable:!0})),a.alloc=function(t,e,n){return u(null,t,e,n)},a.allocUnsafe=function(t){return l(null,t)},a.allocUnsafeSlow=function(t){return l(null,t)},a.isBuffer=function(t){return!(null==t||!t._isBuffer)},a.compare=function(t,e){if(!a.isBuffer(t)||!a.isBuffer(e))throw new TypeError("Arguments must be Buffers");if(t===e)return 0;for(var n=t.length,r=e.length,i=0,o=Math.min(n,r);i<o;++i)if(t[i]!==e[i]){n=t[i],r=e[i];break}return n<r?-1:r<n?1:0},a.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},a.concat=function(t,e){if(!et(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return a.alloc(0);var n;if(void 0===e)for(e=0,n=0;n<t.length;++n)e+=t[n].length;var r=a.allocUnsafe(e),i=0;for(n=0;n<t.length;++n){var o=t[n];if(!a.isBuffer(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(r,i),i+=o.length}return r},a.byteLength=g,a.prototype._isBuffer=!0,a.prototype.swap16=function(){var t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var e=0;e<t;e+=2)y(this,e,e+1);return this},a.prototype.swap32=function(){var t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var e=0;e<t;e+=4)y(this,e,e+3),y(this,e+1,e+2);return this},a.prototype.swap64=function(){var t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var e=0;e<t;e+=8)y(this,e,e+7),y(this,e+1,e+6),y(this,e+2,e+5),y(this,e+3,e+4);return this},a.prototype.toString=function(){var t=0|this.length;return 0===t?"":0===arguments.length?C(this,0,t):v.apply(this,arguments)},a.prototype.equals=function(t){if(!a.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t||0===a.compare(this,t)},a.prototype.inspect=function(){var t="",e=n.INSPECT_MAX_BYTES;return this.length>0&&(t=this.toString("hex",0,e).match(/.{2}/g).join(" "),this.length>e&&(t+=" ... ")),"<Buffer "+t+">"},a.prototype.compare=function(t,e,n,r,i){if(!a.isBuffer(t))throw new TypeError("Argument must be a Buffer");if(void 0===e&&(e=0),void 0===n&&(n=t?t.length:0),void 0===r&&(r=0),void 0===i&&(i=this.length),e<0||n>t.length||r<0||i>this.length)throw new RangeError("out of range index");if(r>=i&&e>=n)return 0;if(r>=i)return-1;if(e>=n)return 1;if(e>>>=0,n>>>=0,r>>>=0,i>>>=0,this===t)return 0;for(var o=i-r,s=n-e,u=Math.min(o,s),l=this.slice(r,i),c=t.slice(e,n),d=0;d<u;++d)if(l[d]!==c[d]){o=l[d],s=c[d];break}return o<s?-1:s<o?1:0},a.prototype.includes=function(t,e,n){return-1!==this.indexOf(t,e,n)},a.prototype.indexOf=function(t,e,n){return _(this,t,e,n,!0)},a.prototype.lastIndexOf=function(t,e,n){return _(this,t,e,n,!1)},a.prototype.write=function(t,e,n,r){if(void 0===e)r="utf8",n=this.length,e=0;else if(void 0===n&&"string"==typeof e)r=e,n=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e|=0,isFinite(n)?(n|=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var i=this.length-e;if((void 0===n||n>i)&&(n=i),t.length>0&&(n<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var a=!1;;)switch(r){case"hex":return E(this,t,e,n);case"utf8":case"utf-8":return w(this,t,e,n);case"ascii":return A(this,t,e,n);case"latin1":case"binary":return S(this,t,e,n);case"base64":return T(this,t,e,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return x(this,t,e,n);default:if(a)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),a=!0}},a.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var nt=4096;a.prototype.slice=function(t,e){var n=this.length;t=~~t,e=void 0===e?n:~~e,t<0?(t+=n)<0&&(t=0):t>n&&(t=n),e<0?(e+=n)<0&&(e=0):e>n&&(e=n),e<t&&(e=t);var r;if(a.TYPED_ARRAY_SUPPORT)r=this.subarray(t,e),r.__proto__=a.prototype;else{var i=e-t;r=new a(i,void 0);for(var o=0;o<i;++o)r[o]=this[o+t]}return r},a.prototype.readUIntLE=function(t,e,n){t|=0,e|=0,n||U(t,e,this.length);for(var r=this[t],i=1,a=0;++a<e&&(i*=256);)r+=this[t+a]*i;return r},a.prototype.readUIntBE=function(t,e,n){t|=0,e|=0,n||U(t,e,this.length);for(var r=this[t+--e],i=1;e>0&&(i*=256);)r+=this[t+--e]*i;return r},a.prototype.readUInt8=function(t,e){return e||U(t,1,this.length),this[t]},a.prototype.readUInt16LE=function(t,e){return e||U(t,2,this.length),this[t]|this[t+1]<<8},a.prototype.readUInt16BE=function(t,e){return e||U(t,2,this.length),this[t]<<8|this[t+1]},a.prototype.readUInt32LE=function(t,e){return e||U(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},a.prototype.readUInt32BE=function(t,e){return e||U(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},a.prototype.readIntLE=function(t,e,n){t|=0,e|=0,n||U(t,e,this.length);for(var r=this[t],i=1,a=0;++a<e&&(i*=256);)r+=this[t+a]*i;return i*=128,r>=i&&(r-=Math.pow(2,8*e)),r},a.prototype.readIntBE=function(t,e,n){t|=0,e|=0,n||U(t,e,this.length);for(var r=e,i=1,a=this[t+--r];r>0&&(i*=256);)a+=this[t+--r]*i;return i*=128,a>=i&&(a-=Math.pow(2,8*e)),a},a.prototype.readInt8=function(t,e){return e||U(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},a.prototype.readInt16LE=function(t,e){e||U(t,2,this.length);var n=this[t]|this[t+1]<<8;return 32768&n?4294901760|n:n},a.prototype.readInt16BE=function(t,e){e||U(t,2,this.length);var n=this[t+1]|this[t]<<8;return 32768&n?4294901760|n:n},a.prototype.readInt32LE=function(t,e){return e||U(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},a.prototype.readInt32BE=function(t,e){return e||U(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},a.prototype.readFloatLE=function(t,e){return e||U(t,4,this.length),tt.read(this,t,!0,23,4)},a.prototype.readFloatBE=function(t,e){return e||U(t,4,this.length),tt.read(this,t,!1,23,4)},a.prototype.readDoubleLE=function(t,e){return e||U(t,8,this.length),tt.read(this,t,!0,52,8)},a.prototype.readDoubleBE=function(t,e){return e||U(t,8,this.length),tt.read(this,t,!1,52,8)},a.prototype.writeUIntLE=function(t,e,n,r){if(t=+t,e|=0,n|=0,!r){F(this,t,e,n,Math.pow(2,8*n)-1,0)}var i=1,a=0;for(this[e]=255&t;++a<n&&(i*=256);)this[e+a]=t/i&255;return e+n},a.prototype.writeUIntBE=function(t,e,n,r){if(t=+t,e|=0,n|=0,!r){F(this,t,e,n,Math.pow(2,8*n)-1,0)}var i=n-1,a=1;for(this[e+i]=255&t;--i>=0&&(a*=256);)this[e+i]=t/a&255;return e+n},a.prototype.writeUInt8=function(t,e,n){return t=+t,e|=0,n||F(this,t,e,1,255,0),a.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),this[e]=255&t,e+1},a.prototype.writeUInt16LE=function(t,e,n){return t=+t,e|=0,n||F(this,t,e,2,65535,0),a.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):B(this,t,e,!0),e+2},a.prototype.writeUInt16BE=function(t,e,n){return t=+t,e|=0,n||F(this,t,e,2,65535,0),a.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):B(this,t,e,!1),e+2},a.prototype.writeUInt32LE=function(t,e,n){return t=+t,e|=0,n||F(this,t,e,4,4294967295,0),a.TYPED_ARRAY_SUPPORT?(this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t):j(this,t,e,!0),e+4},a.prototype.writeUInt32BE=function(t,e,n){return t=+t,e|=0,n||F(this,t,e,4,4294967295,0),a.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):j(this,t,e,!1),e+4},a.prototype.writeIntLE=function(t,e,n,r){if(t=+t,e|=0,!r){var i=Math.pow(2,8*n-1);F(this,t,e,n,i-1,-i)}var a=0,o=1,s=0;for(this[e]=255&t;++a<n&&(o*=256);)t<0&&0===s&&0!==this[e+a-1]&&(s=1),this[e+a]=(t/o>>0)-s&255;return e+n},a.prototype.writeIntBE=function(t,e,n,r){if(t=+t,e|=0,!r){var i=Math.pow(2,8*n-1);F(this,t,e,n,i-1,-i)}var a=n-1,o=1,s=0;for(this[e+a]=255&t;--a>=0&&(o*=256);)t<0&&0===s&&0!==this[e+a+1]&&(s=1),this[e+a]=(t/o>>0)-s&255;return e+n},a.prototype.writeInt8=function(t,e,n){return t=+t,e|=0,n||F(this,t,e,1,127,-128),a.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),t<0&&(t=255+t+1),this[e]=255&t,e+1},a.prototype.writeInt16LE=function(t,e,n){return t=+t,e|=0,n||F(this,t,e,2,32767,-32768),a.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):B(this,t,e,!0),e+2},a.prototype.writeInt16BE=function(t,e,n){return t=+t,e|=0,n||F(this,t,e,2,32767,-32768),a.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):B(this,t,e,!1),e+2},a.prototype.writeInt32LE=function(t,e,n){return t=+t,e|=0,n||F(this,t,e,4,2147483647,-2147483648),a.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24):j(this,t,e,!0),e+4},a.prototype.writeInt32BE=function(t,e,n){return t=+t,e|=0,n||F(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),a.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):j(this,t,e,!1),e+4},a.prototype.writeFloatLE=function(t,e,n){return G(this,t,e,!0,n)},a.prototype.writeFloatBE=function(t,e,n){return G(this,t,e,!1,n)},a.prototype.writeDoubleLE=function(t,e,n){return z(this,t,e,!0,n)},a.prototype.writeDoubleBE=function(t,e,n){return z(this,t,e,!1,n)},a.prototype.copy=function(t,e,n,r){if(n||(n=0),r||0===r||(r=this.length),e>=t.length&&(e=t.length),e||(e=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===t.length||0===this.length)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),t.length-e<r-n&&(r=t.length-e+n);var i,o=r-n;if(this===t&&n<e&&e<r)for(i=o-1;i>=0;--i)t[i+e]=this[i+n];else if(o<1e3||!a.TYPED_ARRAY_SUPPORT)for(i=0;i<o;++i)t[i+e]=this[i+n];else Uint8Array.prototype.set.call(t,this.subarray(n,n+o),e);return o},a.prototype.fill=function(t,e,n,r){if("string"==typeof t){if("string"==typeof e?(r=e,e=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),1===t.length){var i=t.charCodeAt(0);i<256&&(t=i)}if(void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!a.isEncoding(r))throw new TypeError("Unknown encoding: "+r)}else"number"==typeof t&&(t&=255);if(e<0||this.length<e||this.length<n)throw new RangeError("Out of range index");if(n<=e)return this;e>>>=0,n=void 0===n?this.length:n>>>0,t||(t=0);var o;if("number"==typeof t)for(o=e;o<n;++o)this[o]=t;else{var s=a.isBuffer(t)?t:W(new a(t,r).toString()),u=s.length;for(o=0;o<n-e;++o)this[o+e]=s[o%u]}return this};var rt=/[^+\/0-9A-Za-z-_]/g}).call(this,void 0!==r?r:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"base64-js":1,ieee754:15,isarray:18}],12:[function(t,e,n){(function(t){function e(t){return Array.isArray?Array.isArray(t):"[object Array]"===g(t)}function r(t){return"boolean"==typeof t}function i(t){return null===t}function a(t){return null==t}function o(t){return"number"==typeof t}function s(t){return"string"==typeof t}function u(t){return"symbol"===(void 0===t?"undefined":(0,H.default)(t))}function l(t){return void 0===t}function c(t){return"[object RegExp]"===g(t)}function d(t){return"object"===(void 0===t?"undefined":(0,H.default)(t))&&null!==t}function h(t){return"[object Date]"===g(t)}function f(t){return"[object Error]"===g(t)||t instanceof Error}function p(t){return"function"==typeof t}function m(t){return null===t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||"symbol"===(void 0===t?"undefined":(0,H.default)(t))||void 0===t}function g(t){return Object.prototype.toString.call(t)}n.isArray=e,n.isBoolean=r,n.isNull=i,n.isNullOrUndefined=a,n.isNumber=o,n.isString=s,n.isSymbol=u,n.isUndefined=l,n.isRegExp=c,n.isObject=d,n.isDate=h,n.isError=f,n.isFunction=p,n.isPrimitive=m,n.isBuffer=t.isBuffer}).call(this,{isBuffer:t("../../is-buffer/index.js")})},{"../../is-buffer/index.js":17}],13:[function(e,n,i){(function(r,a){!function(e,r){"object"===(void 0===i?"undefined":(0,H.default)(i))&&void 0!==n?n.exports=r():"function"==typeof t&&t.amd?t(r):e.ES6Promise=r()}(this,function(){function t(t){var e=void 0===t?"undefined":(0,H.default)(t);return null!==t&&("object"===e||"function"===e)}function n(t){return"function"==typeof t}function i(t){G=t}function o(t){z=t}function s(){return void 0!==V?function(){V(l)}:u()}function u(){var t=setTimeout;return function(){return t(l,1)}}function l(){for(var t=0;t<j;t+=2){(0,$[t])($[t+1]),$[t]=void 0,$[t+1]=void 0}j=0}function c(t,e){var n=this,r=new this.constructor(h);void 0===r[Q]&&R(r);var i=n._state;if(i){var a=arguments[i-1];z(function(){return k(i,r,a,n._result)})}else S(n,r,t,e);return r}function d(t){var e=this;if(t&&"object"===(void 0===t?"undefined":(0,H.default)(t))&&t.constructor===e)return t;var n=new e(h);return b(n,t),n}function h(){}function f(){return new TypeError("You cannot resolve a promise with itself")}function p(){return new TypeError("A promises callback cannot return that same promise.")}function m(t){try{return t.then}catch(e){return nt.error=e,nt}}function g(t,e,n,r){try{t.call(e,n,r)}catch(i){return i}}function v(t,e,n){z(function(t){var r=!1,i=g(n,e,function(n){r||(r=!0,e!==n?b(t,n):w(t,n))},function(e){r||(r=!0,A(t,e))},"Settle: "+(t._label||" unknown promise"));!r&&i&&(r=!0,A(t,i))},t)}function y(t,e){e._state===tt?w(t,e._result):e._state===et?A(t,e._result):S(e,void 0,function(e){return b(t,e)},function(e){return A(t,e)})}function _(t,e,r){e.constructor===t.constructor&&r===c&&e.constructor.resolve===d?y(t,e):r===nt?(A(t,nt.error),nt.error=null):void 0===r?w(t,e):n(r)?v(t,e,r):w(t,e)}function b(e,n){e===n?A(e,f()):t(n)?_(e,n,m(n)):w(e,n)}function E(t){t._onerror&&t._onerror(t._result),T(t)}function w(t,e){t._state===J&&(t._result=e,t._state=tt,0!==t._subscribers.length&&z(T,t))}function A(t,e){t._state===J&&(t._state=et,t._result=e,z(E,t))}function S(t,e,n,r){var i=t._subscribers,a=i.length;t._onerror=null,i[a]=e,i[a+tt]=n,i[a+et]=r,0===a&&t._state&&z(T,t)}function T(t){var e=t._subscribers,n=t._state;if(0!==e.length){for(var r=void 0,i=void 0,a=t._result,o=0;o<e.length;o+=3)r=e[o],i=e[o+n],r?k(n,r,i,a):i(a);t._subscribers.length=0}}function x(t,e){try{return t(e)}catch(n){return nt.error=n,nt}}function k(t,e,r,i){var a=n(r),o=void 0,s=void 0,u=void 0,l=void 0;if(a){if(o=x(r,i),o===nt?(l=!0,s=o.error,o.error=null):u=!0,e===o)return void A(e,p())}else o=i,u=!0;e._state!==J||(a&&u?b(e,o):l?A(e,s):t===tt?w(e,o):t===et&&A(e,o))}function C(t,e){try{e(function(e){b(t,e)},function(e){A(t,e)})}catch(n){A(t,n)}}function M(){return rt++}function R(t){t[Q]=rt++,t._state=void 0,t._result=void 0,t._subscribers=[]}function L(){return new Error("Array Methods must be provided an Array")}function I(t){return new it(this,t).promise}function P(t){var e=this;return new e(B(t)?function(n,r){for(var i=t.length,a=0;a<i;a++)e.resolve(t[a]).then(n,r)}:function(t,e){return e(new TypeError("You must pass an array to race."))})}function O(t){var e=this,n=new e(h);return A(n,t),n}function D(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function N(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function U(){var t=void 0;if(void 0!==a)t=a;else if("undefined"!=typeof self)t=self;else try{t=Function("return this")()}catch(r){throw new Error("polyfill failed because global object is unavailable in this environment")}var e=t.Promise;if(e){var n=null;try{n=Object.prototype.toString.call(e.resolve())}catch(r){}if("[object Promise]"===n&&!e.cast)return}t.Promise=at}var F=void 0;F=Array.isArray?Array.isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)};var B=F,j=0,V=void 0,G=void 0,z=function(t,e){$[j]=t,$[j+1]=e,2===(j+=2)&&(G?G(l):Z())},K="undefined"!=typeof window?window:void 0,Y=K||{},W=Y.MutationObserver||Y.WebKitMutationObserver,q="undefined"==typeof self&&void 0!==r&&"[object process]"==={}.toString.call(r),X="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,$=new Array(1e3),Z=void 0;Z=q?function(){return function(){return r.nextTick(l)}}():W?function(){var t=0,e=new W(l),n=document.createTextNode("");return e.observe(n,{characterData:!0}),function(){n.data=t=++t%2}}():X?function(){var t=new MessageChannel;return t.port1.onmessage=l,function(){return t.port2.postMessage(0)}}():void 0===K&&"function"==typeof e?function(){try{var t=Function("return this")().require("vertx");return V=t.runOnLoop||t.runOnContext,s()}catch(e){return u()}}():u();var Q=Math.random().toString(36).substring(2),J=void 0,tt=1,et=2,nt={error:null},rt=0,it=function(){function t(t,e){this._instanceConstructor=t,this.promise=new t(h),this.promise[Q]||R(this.promise),B(e)?(this.length=e.length,this._remaining=e.length,this._result=new Array(this.length),0===this.length?w(this.promise,this._result):(this.length=this.length||0,this._enumerate(e),0===this._remaining&&w(this.promise,this._result))):A(this.promise,L())}return t.prototype._enumerate=function(t){for(var e=0;this._state===J&&e<t.length;e++)this._eachEntry(t[e],e)},t.prototype._eachEntry=function(t,e){var n=this._instanceConstructor,r=n.resolve;if(r===d){var i=m(t);if(i===c&&t._state!==J)this._settledAt(t._state,e,t._result);else if("function"!=typeof i)this._remaining--,this._result[e]=t;else if(n===at){var a=new n(h);_(a,t,i),this._willSettleAt(a,e)}else this._willSettleAt(new n(function(e){return e(t)}),e)}else this._willSettleAt(r(t),e)},t.prototype._settledAt=function(t,e,n){var r=this.promise;r._state===J&&(this._remaining--,t===et?A(r,n):this._result[e]=n),0===this._remaining&&w(r,this._result)},t.prototype._willSettleAt=function(t,e){var n=this;S(t,void 0,function(t){return n._settledAt(tt,e,t)},function(t){return n._settledAt(et,e,t)})},t}(),at=function(){function t(e){this[Q]=M(),this._result=this._state=void 0,this._subscribers=[],h!==e&&("function"!=typeof e&&D(),this instanceof t?C(this,e):N())}return t.prototype.catch=function(t){return this.then(null,t)},t.prototype.finally=function(t){var e=this,r=e.constructor;return n(t)?e.then(function(e){return r.resolve(t()).then(function(){return e})},function(e){return r.resolve(t()).then(function(){throw e})}):e.then(t,t)},t}();return at.prototype.then=c,at.all=I,at.race=P,at.resolve=d,at.reject=O,at._setScheduler=i,at._setAsap=o,at._asap=z,at.polyfill=U,at.Promise=at,at})}).call(this,e("_process"),void 0!==r?r:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{_process:23}],14:[function(t,e,n){e.exports=function(){if("undefined"==typeof window)return null;var t={RTCPeerConnection:window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection,RTCSessionDescription:window.RTCSessionDescription||window.mozRTCSessionDescription||window.webkitRTCSessionDescription,RTCIceCandidate:window.RTCIceCandidate||window.mozRTCIceCandidate||window.webkitRTCIceCandidate};return t.RTCPeerConnection?t:null}},{}],15:[function(t,e,n){n.read=function(t,e,n,r,i){var a,o,s=8*i-r-1,u=(1<<s)-1,l=u>>1,c=-7,d=n?i-1:0,h=n?-1:1,f=t[e+d];for(d+=h,a=f&(1<<-c)-1,f>>=-c,c+=s;c>0;a=256*a+t[e+d],d+=h,c-=8);for(o=a&(1<<-c)-1,a>>=-c,c+=r;c>0;o=256*o+t[e+d],d+=h,c-=8);if(0===a)a=1-l;else{if(a===u)return o?NaN:1/0*(f?-1:1);o+=Math.pow(2,r),a-=l}return(f?-1:1)*o*Math.pow(2,a-r)},n.write=function(t,e,n,r,i,a){var o,s,u,l=8*a-i-1,c=(1<<l)-1,d=c>>1,h=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,f=r?0:a-1,p=r?1:-1,m=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(s=isNaN(e)?1:0,o=c):(o=Math.floor(Math.log(e)/Math.LN2),e*(u=Math.pow(2,-o))<1&&(o--,u*=2),e+=o+d>=1?h/u:h*Math.pow(2,1-d),e*u>=2&&(o++,u/=2),o+d>=c?(s=0,o=c):o+d>=1?(s=(e*u-1)*Math.pow(2,i),o+=d):(s=e*Math.pow(2,d-1)*Math.pow(2,i),o=0));i>=8;t[n+f]=255&s,f+=p,s/=256,i-=8);for(o=o<<i|s,l+=i;l>0;t[n+f]=255&o,f+=p,o/=256,l-=8);t[n+f-p]|=128*m}},{}],16:[function(t,e,n){"function"==typeof C.default?e.exports=function(t,e){t.super_=e,t.prototype=(0,C.default)(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:e.exports=function(t,e){t.super_=e;var n=function(){};n.prototype=e.prototype,t.prototype=new n,t.prototype.constructor=t}},{}],17:[function(t,e,n){function r(t){return!!t.constructor&&"function"==typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)}function i(t){return"function"==typeof t.readFloatLE&&"function"==typeof t.slice&&r(t.slice(0,0))}e.exports=function(t){return null!=t&&(r(t)||i(t)||!!t._isBuffer)}},{}],18:[function(t,e,n){var r={}.toString;e.exports=Array.isArray||function(t){return"[object Array]"==r.call(t)}},{}],19:[function(t,e,n){var r=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},i=F.default||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},a=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+(void 0===e?"undefined":(0,H.default)(e)));t.prototype=(0,C.default)(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(x.default?(0,x.default)(t,e):t.__proto__=e)},o=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==(void 0===e?"undefined":(0,H.default)(e))&&"function"!=typeof e?t:e},s=function(){function t(){r(this,t),this.listeners={}}return t.prototype.on=function(t,e){this.listeners[t]||(this.listeners[t]=[]),this.listeners[t].push(e)},t.prototype.off=function(t,e){if(!this.listeners[t])return!1;var n=this.listeners[t].indexOf(e);return this.listeners[t].splice(n,1),n>-1},t.prototype.trigger=function(t){var e=this.listeners[t],n=void 0,r=void 0,i=void 0;if(e)if(2===arguments.length)for(r=e.length,n=0;n<r;++n)e[n].call(this,arguments[1]);else for(i=Array.prototype.slice.call(arguments,1),r=e.length,n=0;n<r;++n)e[n].apply(this,i)},t.prototype.dispose=function(){this.listeners={}},t.prototype.pipe=function(t){this.on("data",function(e){t.push(e)})},t}(),u=function(t){function e(){r(this,e);var n=o(this,t.call(this));return n.buffer="",n}return a(e,t),e.prototype.push=function(t){var e=void 0;for(this.buffer+=t,e=this.buffer.indexOf("\n");e>-1;e=this.buffer.indexOf("\n"))this.trigger("data",this.buffer.substring(0,e)),this.buffer=this.buffer.substring(e+1)},e}(s),l=function(){return new RegExp('(?:^|,)((?:[^=]*)=(?:"[^"]*"|[^,]*))')},c=function(t){for(var e=t.split(l()),n={},r=e.length,i=void 0;r--;)""!==e[r]&&(i=/([^=]*)=(.*)/.exec(e[r]).slice(1),i[0]=i[0].replace(/^\s+|\s+$/g,""),i[1]=i[1].replace(/^\s+|\s+$/g,""),i[1]=i[1].replace(/^['"](.*)['"]$/g,"$1"),n[i[0]]=i[1]);return n},d=function(t){function e(){r(this,e);var n=o(this,t.call(this));return n.customParsers=[],n}return a(e,t),e.prototype.push=function(t){var e=void 0,n=void 0;if(t=t.replace(/^[\u0000\s]+|[\u0000\s]+$/g,""),0!==t.length){if("#"!==t[0])return void this.trigger("data",{type:"uri",uri:t});for(var r=0;r<this.customParsers.length;r++)if(this.customParsers[r].call(this,t))return;if(0!==t.indexOf("#EXT"))return void this.trigger("data",{type:"comment",text:t.slice(1)});if(t=t.replace("\r",""),e=/^#EXTM3U/.exec(t))return void this.trigger("data",{type:"tag",tagType:"m3u"});if(e=/^#EXTINF:?([0-9\.]*)?,?(.*)?$/.exec(t))return n={type:"tag",tagType:"inf"},e[1]&&(n.duration=parseFloat(e[1])),e[2]&&(n.title=e[2]),void this.trigger("data",n);if(e=/^#EXT-X-TARGETDURATION:?([0-9.]*)?/.exec(t))return n={type:"tag",tagType:"targetduration"},e[1]&&(n.duration=parseInt(e[1],10)),void this.trigger("data",n);if(e=/^#ZEN-TOTAL-DURATION:?([0-9.]*)?/.exec(t))return n={type:"tag",tagType:"totalduration"},e[1]&&(n.duration=parseInt(e[1],10)),void this.trigger("data",n);if(e=/^#EXT-X-VERSION:?([0-9.]*)?/.exec(t))return n={type:"tag",tagType:"version"},e[1]&&(n.version=parseInt(e[1],10)),void this.trigger("data",n);if(e=/^#EXT-X-MEDIA-SEQUENCE:?(\-?[0-9.]*)?/.exec(t))return n={type:"tag",tagType:"media-sequence"},e[1]&&(n.number=parseInt(e[1],10)),void this.trigger("data",n);if(e=/^#EXT-X-DISCONTINUITY-SEQUENCE:?(\-?[0-9.]*)?/.exec(t))return n={type:"tag",tagType:"discontinuity-sequence"},e[1]&&(n.number=parseInt(e[1],10)),void this.trigger("data",n);if(e=/^#EXT-X-PLAYLIST-TYPE:?(.*)?$/.exec(t))return n={type:"tag",tagType:"playlist-type"},e[1]&&(n.playlistType=e[1]),void this.trigger("data",n);if(e=/^#EXT-X-BYTERANGE:?([0-9.]*)?@?([0-9.]*)?/.exec(t))return n={type:"tag",tagType:"byterange"},e[1]&&(n.length=parseInt(e[1],10)),e[2]&&(n.offset=parseInt(e[2],10)),void this.trigger("data",n);if(e=/^#EXT-X-ALLOW-CACHE:?(YES|NO)?/.exec(t))return n={type:"tag",tagType:"allow-cache"},e[1]&&(n.allowed=!/NO/.test(e[1])),void this.trigger("data",n);if(e=/^#EXT-X-MAP:?(.*)$/.exec(t)){if(n={type:"tag",tagType:"map"},e[1]){var i=c(e[1]);if(i.URI&&(n.uri=i.URI),i.BYTERANGE){var a=i.BYTERANGE.split("@"),o=a[0],s=a[1];n.byterange={},o&&(n.byterange.length=parseInt(o,10)),s&&(n.byterange.offset=parseInt(s,10))}}return void this.trigger("data",n)}if(e=/^#EXT-X-STREAM-INF:?(.*)$/.exec(t)){if(n={type:"tag",tagType:"stream-inf"},e[1]){if(n.attributes=c(e[1]),n.attributes.RESOLUTION){var u=n.attributes.RESOLUTION.split("x"),l={};u[0]&&(l.width=parseInt(u[0],10)),u[1]&&(l.height=parseInt(u[1],10)),n.attributes.RESOLUTION=l}n.attributes.BANDWIDTH&&(n.attributes.BANDWIDTH=parseInt(n.attributes.BANDWIDTH,10)),n.attributes["PROGRAM-ID"]&&(n.attributes["PROGRAM-ID"]=parseInt(n.attributes["PROGRAM-ID"],10))}return void this.trigger("data",n)}if(e=/^#EXT-X-MEDIA:?(.*)$/.exec(t))return n={type:"tag",tagType:"media"},e[1]&&(n.attributes=c(e[1])),void this.trigger("data",n);if(e=/^#EXT-X-ENDLIST/.exec(t))return void this.trigger("data",{type:"tag",tagType:"endlist"});if(e=/^#EXT-X-DISCONTINUITY/.exec(t))return void this.trigger("data",{type:"tag",tagType:"discontinuity"});if(e=/^#EXT-X-PROGRAM-DATE-TIME:?(.*)$/.exec(t))return n={type:"tag",tagType:"program-date-time"},e[1]&&(n.dateTimeString=e[1],n.dateTimeObject=new Date(e[1])),void this.trigger("data",n);if(e=/^#EXT-X-KEY:?(.*)$/.exec(t))return n={type:"tag",tagType:"key"},e[1]&&(n.attributes=c(e[1]),n.attributes.IV&&("0x"===n.attributes.IV.substring(0,2).toLowerCase()&&(n.attributes.IV=n.attributes.IV.substring(2)),n.attributes.IV=n.attributes.IV.match(/.{8}/g),n.attributes.IV[0]=parseInt(n.attributes.IV[0],16),n.attributes.IV[1]=parseInt(n.attributes.IV[1],16),n.attributes.IV[2]=parseInt(n.attributes.IV[2],16),n.attributes.IV[3]=parseInt(n.attributes.IV[3],16),n.attributes.IV=new Uint32Array(n.attributes.IV))),void this.trigger("data",n);if(e=/^#EXT-X-START:?(.*)$/.exec(t))return n={type:"tag",tagType:"start"},e[1]&&(n.attributes=c(e[1]),n.attributes["TIME-OFFSET"]=parseFloat(n.attributes["TIME-OFFSET"]),n.attributes.PRECISE=/YES/.test(n.attributes.PRECISE)),void this.trigger("data",n);if(e=/^#EXT-X-CUE-OUT-CONT:?(.*)?$/.exec(t))return n={type:"tag",tagType:"cue-out-cont"},e[1]?n.data=e[1]:n.data="",void this.trigger("data",n);if(e=/^#EXT-X-CUE-OUT:?(.*)?$/.exec(t))return n={type:"tag",tagType:"cue-out"},e[1]?n.data=e[1]:n.data="",void this.trigger("data",n);if(e=/^#EXT-X-CUE-IN:?(.*)?$/.exec(t))return n={type:"tag",tagType:"cue-in"},e[1]?n.data=e[1]:n.data="",void this.trigger("data",n);this.trigger("data",{type:"tag",data:t.slice(4)})}},e.prototype.addParser=function(t){var e=this,n=t.expression,r=t.customType,i=t.dataParser,a=t.segment;"function"!=typeof i&&(i=function(t){return t}),this.customParsers.push(function(t){if(n.exec(t))return e.trigger("data",{type:"custom",data:i(t),customType:r,segment:a}),!0})},e}(s),h=function(t){function e(){r(this,e);var n=o(this,t.call(this));n.lineStream=new u,n.parseStream=new d,n.lineStream.pipe(n.parseStream);var a=n,s=[],l={},c=void 0,h=void 0,f=function(){},p={AUDIO:{},VIDEO:{},"CLOSED-CAPTIONS":{},SUBTITLES:{}},m=0;return n.manifest={allowCache:!0,discontinuityStarts:[],segments:[]},n.parseStream.on("data",function(t){var e=void 0,n=void 0;({tag:function(){(({"allow-cache":function(){this.manifest.allowCache=t.allowed,"allowed"in t||(this.trigger("info",{message:"defaulting allowCache to YES"}),this.manifest.allowCache=!0)},byterange:function(){var e={};"length"in t&&(l.byterange=e,e.length=t.length,"offset"in t||(this.trigger("info",{message:"defaulting offset to zero"}),t.offset=0)),"offset"in t&&(l.byterange=e,e.offset=t.offset)},endlist:function(){this.manifest.endList=!0},inf:function(){"mediaSequence"in this.manifest||(this.manifest.mediaSequence=0,this.trigger("info",{message:"defaulting media sequence to zero"})),"discontinuitySequence"in this.manifest||(this.manifest.discontinuitySequence=0,this.trigger("info",{message:"defaulting discontinuity sequence to zero"})),t.duration>0&&(l.duration=t.duration),0===t.duration&&(l.duration=.01,this.trigger("info",{message:"updating zero segment duration to a small value"})),this.manifest.segments=s},key:function(){return t.attributes?"NONE"===t.attributes.METHOD?void(h=null):t.attributes.URI?(t.attributes.METHOD||this.trigger("warn",{message:"defaulting key method to AES-128"}),h={method:t.attributes.METHOD||"AES-128",uri:t.attributes.URI},void(void 0!==t.attributes.IV&&(h.iv=t.attributes.IV))):void this.trigger("warn",{message:"ignoring key declaration without URI"}):void this.trigger("warn",{message:"ignoring key declaration without attribute list"})},"media-sequence":function(){if(!isFinite(t.number))return void this.trigger("warn",{message:"ignoring invalid media sequence: "+t.number});this.manifest.mediaSequence=t.number},"discontinuity-sequence":function(){if(!isFinite(t.number))return void this.trigger("warn",{message:"ignoring invalid discontinuity sequence: "+t.number});this.manifest.discontinuitySequence=t.number,m=t.number},"playlist-type":function(){if(!/VOD|EVENT/.test(t.playlistType))return void this.trigger("warn",{message:"ignoring unknown playlist type: "+t.playlist});this.manifest.playlistType=t.playlistType},map:function(){c={},t.uri&&(c.uri=t.uri),t.byterange&&(c.byterange=t.byterange)},"stream-inf":function(){if(this.manifest.playlists=s,this.manifest.mediaGroups=this.manifest.mediaGroups||p,!t.attributes)return void this.trigger("warn",{message:"ignoring empty stream-inf attributes"});l.attributes||(l.attributes={}),i(l.attributes,t.attributes)},media:function(){if(this.manifest.mediaGroups=this.manifest.mediaGroups||p,!(t.attributes&&t.attributes.TYPE&&t.attributes["GROUP-ID"]&&t.attributes.NAME))return void this.trigger("warn",{message:"ignoring incomplete or missing media group"});var r=this.manifest.mediaGroups[t.attributes.TYPE];r[t.attributes["GROUP-ID"]]=r[t.attributes["GROUP-ID"]]||{},e=r[t.attributes["GROUP-ID"]],n={default:/yes/i.test(t.attributes.DEFAULT)},n["default"]?n.autoselect=!0:n.autoselect=/yes/i.test(t.attributes.AUTOSELECT),t.attributes.LANGUAGE&&(n.language=t.attributes.LANGUAGE),t.attributes.URI&&(n.uri=t.attributes.URI),t.attributes["INSTREAM-ID"]&&(n.instreamId=t.attributes["INSTREAM-ID"]),t.attributes.CHARACTERISTICS&&(n.characteristics=t.attributes.CHARACTERISTICS),t.attributes.FORCED&&(n.forced=/yes/i.test(t.attributes.FORCED)),e[t.attributes.NAME]=n},discontinuity:function(){m+=1,l.discontinuity=!0,this.manifest.discontinuityStarts.push(s.length)},"program-date-time":function(){void 0===this.manifest.dateTimeString&&(this.manifest.dateTimeString=t.dateTimeString,this.manifest.dateTimeObject=t.dateTimeObject),l.dateTimeString=t.dateTimeString,l.dateTimeObject=t.dateTimeObject},targetduration:function(){if(!isFinite(t.duration)||t.duration<0)return void this.trigger("warn",{message:"ignoring invalid target duration: "+t.duration});this.manifest.targetDuration=t.duration},totalduration:function(){if(!isFinite(t.duration)||t.duration<0)return void this.trigger("warn",{message:"ignoring invalid total duration: "+t.duration});this.manifest.totalDuration=t.duration},start:function(){if(!t.attributes||isNaN(t.attributes["TIME-OFFSET"]))return void this.trigger("warn",{message:"ignoring start declaration without appropriate attribute list"});this.manifest.start={timeOffset:t.attributes["TIME-OFFSET"],precise:t.attributes.PRECISE}},"cue-out":function(){l.cueOut=t.data},"cue-out-cont":function(){l.cueOutCont=t.data},"cue-in":function(){l.cueIn=t.data}})[t.tagType]||f).call(a)},uri:function(){l.uri=t.uri,s.push(l),!this.manifest.targetDuration||"duration"in l||(this.trigger("warn",{message:"defaulting segment duration to the target duration"}),l.duration=this.manifest.targetDuration),h&&(l.key=h),l.timeline=m,c&&(l.map=c),l={}},comment:function(){},custom:function(){t.segment?(l.custom=l.custom||{},l.custom[t.customType]=t.data):(this.manifest.custom=this.manifest.custom||{},this.manifest.custom[t.customType]=t.data)}})[t.type].call(a)}),n}return a(e,t),e.prototype.push=function(t){this.lineStream.push(t)},e.prototype.end=function(){this.lineStream.push("\n")},e.prototype.addParser=function(t){this.parseStream.addParser(t)},e}(s);n.LineStream=u,n.ParseStream=d,n.Parser=h},{}],20:[function(t,e,n){function r(t){if(t=String(t),!(t.length>100)){var e=/^((?:\d+)?\-?\d?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(t);if(e){var n=parseFloat(e[1]);switch((e[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return n*h;case"weeks":case"week":case"w":return n*d;case"days":case"day":case"d":return n*c;case"hours":case"hour":case"hrs":case"hr":case"h":return n*l;case"minutes":case"minute":case"mins":case"min":case"m":return n*u;case"seconds":case"second":case"secs":case"sec":case"s":return n*s;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n;default:return}}}}function i(t){var e=Math.abs(t);return e>=c?Math.round(t/c)+"d":e>=l?Math.round(t/l)+"h":e>=u?Math.round(t/u)+"m":e>=s?Math.round(t/s)+"s":t+"ms"}function a(t){var e=Math.abs(t);return e>=c?o(t,e,c,"day"):e>=l?o(t,e,l,"hour"):e>=u?o(t,e,u,"minute"):e>=s?o(t,e,s,"second"):t+" ms"}function o(t,e,n,r){var i=e>=1.5*n;return Math.round(t/n)+" "+r+(i?"s":"")}var s=1e3,u=60*s,l=60*u,c=24*l,d=7*c,h=365.25*c;e.exports=function(t,e){e=e||{};var n=void 0===t?"undefined":(0,H.default)(t);if("string"===n&&t.length>0)return r(t);if("number"===n&&!1===isNaN(t))return e.long?a(t):i(t);throw new Error("val is not a non-empty string or a valid number. val="+(0,j.default)(t))}},{}],21:[function(t,e,n){function r(t){var e=function n(){return n.called?n.value:(n.called=!0,n.value=t.apply(this,arguments))};return e.called=!1,e}function i(t){var e=function n(){if(n.called)throw new Error(n.onceError);return n.called=!0,n.value=t.apply(this,arguments)};return e.onceError=(t.name||"Function wrapped with `once`")+" shouldn't be called more than once",e.called=!1,e}var a=t("wrappy");e.exports=a(r),e.exports.strict=a(i),r.proto=r(function(){Object.defineProperty(Function.prototype,"once",{value:function(){return r(this)},configurable:!0}),Object.defineProperty(Function.prototype,"onceStrict",{value:function(){return i(this)},configurable:!0})})},{wrappy:54}],22:[function(t,e,n){(function(t){function n(e,n,r,i){if("function"!=typeof e)throw new TypeError('"callback" argument must be a function');var a,o,s=arguments.length;switch(s){case 0:case 1:return t.nextTick(e);case 2:return t.nextTick(function(){e.call(null,n)});case 3:return t.nextTick(function(){e.call(null,n,r)});case 4:return t.nextTick(function(){e.call(null,n,r,i)});default:for(a=new Array(s-1),o=0;o<a.length;)a[o++]=arguments[o];return t.nextTick(function(){e.apply(null,a)})}}!t.version||0===t.version.indexOf("v0.")||0===t.version.indexOf("v1.")&&0!==t.version.indexOf("v1.8.")?e.exports={nextTick:n}:e.exports=t}).call(this,t("_process"))},{_process:23}],23:[function(t,e,n){function r(){throw new Error("setTimeout has not been defined")}function i(){throw new Error("clearTimeout has not been defined")}function a(t){if(d===setTimeout)return setTimeout(t,0);if((d===r||!d)&&setTimeout)return d=setTimeout,setTimeout(t,0);try{return d(t,0)}catch(e){try{return d.call(null,t,0)}catch(e){return d.call(this,t,0)}}}function o(t){if(h===clearTimeout)return clearTimeout(t);if((h===i||!h)&&clearTimeout)return h=clearTimeout,clearTimeout(t);try{return h(t)}catch(e){try{return h.call(null,t)}catch(e){return h.call(this,t)}}}function s(){g&&p&&(g=!1,p.length?m=p.concat(m):v=-1,m.length&&u())}function u(){if(!g){var t=a(s);g=!0;for(var e=m.length;e;){for(p=m,m=[];++v<e;)p&&p[v].run();v=-1,e=m.length}p=null,g=!1,o(t)}}function l(t,e){this.fun=t,this.array=e}function c(){}var d,h,f=e.exports={};!function(){try{d="function"==typeof setTimeout?setTimeout:r}catch(t){d=r}try{h="function"==typeof clearTimeout?clearTimeout:i}catch(t){h=i}}();var p,m=[],g=!1,v=-1;f.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];m.push(new l(t,e)),1!==m.length||g||a(u)},l.prototype.run=function(){this.fun.apply(null,this.array)},f.title="browser",f.browser=!0,f.env={},f.argv=[],f.version="",f.versions={},f.on=c,f.addListener=c,f.once=c,f.off=c,f.removeListener=c,f.removeAllListeners=c,f.emit=c,f.prependListener=c,f.prependOnceListener=c,f.listeners=function(t){return[]},f.binding=function(t){throw new Error("process.binding is not supported")},f.cwd=function(){return"/"},f.chdir=function(t){throw new Error("process.chdir is not supported")},f.umask=function(){return 0}},{}],24:[function(e,n,i){(function(e){!function(r){function a(t){throw new RangeError(O[t])}function o(t,e){for(var n=t.length,r=[];n--;)r[n]=e(t[n]);return r}function s(t,e){var n=t.split("@"),r="";return n.length>1&&(r=n[0]+"@",t=n[1]),t=t.replace(P,"."),r+o(t.split("."),e).join(".")}function u(t){for(var e,n,r=[],i=0,a=t.length;i<a;)e=t.charCodeAt(i++),e>=55296&&e<=56319&&i<a?(n=t.charCodeAt(i++),56320==(64512&n)?r.push(((1023&e)<<10)+(1023&n)+65536):(r.push(e),i--)):r.push(e);return r}function l(t){return o(t,function(t){var e="";return t>65535&&(t-=65536,e+=U(t>>>10&1023|55296),t=56320|1023&t),e+=U(t)}).join("")}function c(t){return t-48<10?t-22:t-65<26?t-65:t-97<26?t-97:A}function d(t,e){return t+22+75*(t<26)-((0!=e)<<5)}function h(t,e,n){var r=0;for(t=n?N(t/k):t>>1,t+=N(t/e);t>D*T>>1;r+=A)t=N(t/D);return N(r+(D+1)*t/(t+x))}function f(t){var e,n,r,i,o,s,u,d,f,p,m=[],g=t.length,v=0,y=M,_=C;for(n=t.lastIndexOf(R),n<0&&(n=0),r=0;r<n;++r)t.charCodeAt(r)>=128&&a("not-basic"),m.push(t.charCodeAt(r));for(i=n>0?n+1:0;i<g;){for(o=v,s=1,u=A;i>=g&&a("invalid-input"),d=c(t.charCodeAt(i++)),(d>=A||d>N((w-v)/s))&&a("overflow"),v+=d*s,f=u<=_?S:u>=_+T?T:u-_,!(d<f);u+=A)p=A-f,s>N(w/p)&&a("overflow"),s*=p;e=m.length+1,_=h(v-o,e,0==o),N(v/e)>w-y&&a("overflow"),y+=N(v/e),v%=e,m.splice(v++,0,y)}return l(m)}function p(t){var e,n,r,i,o,s,l,c,f,p,m,g,v,y,_,b=[];for(t=u(t),g=t.length,e=M,n=0,o=C,s=0;s<g;++s)(m=t[s])<128&&b.push(U(m));for(r=i=b.length,i&&b.push(R);r<g;){for(l=w,s=0;s<g;++s)(m=t[s])>=e&&m<l&&(l=m);for(v=r+1,l-e>N((w-n)/v)&&a("overflow"),n+=(l-e)*v,e=l,s=0;s<g;++s)if(m=t[s],m<e&&++n>w&&a("overflow"),m==e){for(c=n,f=A;p=f<=o?S:f>=o+T?T:f-o,!(c<p);f+=A)_=c-p,y=A-p,b.push(U(d(p+_%y,0))),c=N(_/y);b.push(U(d(c,0))),o=h(n,v,r==i),n=0,++r}++n,++e}return b.join("")}function m(t){return s(t,function(t){return L.test(t)?f(t.slice(4).toLowerCase()):t})}function g(t){return s(t,function(t){return I.test(t)?"xn--"+p(t):t})}var v="object"==(void 0===i?"undefined":(0,H.default)(i))&&i&&!i.nodeType&&i,y="object"==(void 0===n?"undefined":(0,H.default)(n))&&n&&!n.nodeType&&n,_="object"==(void 0===e?"undefined":(0,H.default)(e))&&e;_.global!==_&&_.window!==_&&_.self!==_||(r=_);var b,E,w=2147483647,A=36,S=1,T=26,x=38,k=700,C=72,M=128,R="-",L=/^xn--/,I=/[^\x20-\x7E]/,P=/[\x2E\u3002\uFF0E\uFF61]/g,O={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},D=A-S,N=Math.floor,U=String.fromCharCode;if(b={version:"1.4.1",ucs2:{decode:u,encode:l},decode:f,encode:p,toASCII:g,toUnicode:m},"function"==typeof t&&"object"==(0,H.default)(t.amd)&&t.amd)t("punycode",function(){return b});else if(v&&y)if(n.exports==v)y.exports=b;else for(E in b)b.hasOwnProperty(E)&&(v[E]=b[E]);else r.punycode=b}(this)}).call(this,void 0!==r?r:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],25:[function(t,e,n){function r(t,e){return Object.prototype.hasOwnProperty.call(t,e)}e.exports=function(t,e,n,a){e=e||"&",n=n||"=";var o={};if("string"!=typeof t||0===t.length)return o;var s=/\+/g;t=t.split(e);var u=1e3;a&&"number"==typeof a.maxKeys&&(u=a.maxKeys);var l=t.length;u>0&&l>u&&(l=u);for(var c=0;c<l;++c){var d,h,f,p,m=t[c].replace(s,"%20"),g=m.indexOf(n);g>=0?(d=m.substr(0,g),h=m.substr(g+1)):(d=m,h=""),f=decodeURIComponent(d),p=decodeURIComponent(h),r(o,f)?i(o[f])?o[f].push(p):o[f]=[o[f],p]:o[f]=p}return o};var i=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)}},{}],26:[function(t,e,n){function r(t,e){if(t.map)return t.map(e);for(var n=[],r=0;r<t.length;r++)n.push(e(t[r],r));return n}var i=function(t){switch(void 0===t?"undefined":(0,H.default)(t)){case"string":return t;case"boolean":return t?"true":"false";case"number":return isFinite(t)?t:"";default:return""}};e.exports=function(t,e,n,s){return e=e||"&",n=n||"=",null===t&&(t=void 0),"object"===(void 0===t?"undefined":(0,H.default)(t))?r(o(t),function(o){var s=encodeURIComponent(i(o))+n;return a(t[o])?r(t[o],function(t){return s+encodeURIComponent(i(t))}).join(e):s+encodeURIComponent(i(t[o]))}).join(e):s?encodeURIComponent(i(s))+n+encodeURIComponent(i(t)):""};var a=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)},o=G.default||function(t){var e=[];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.push(n);return e}},{}],27:[function(t,e,n){n.decode=n.parse=t("./decode"),n.encode=n.stringify=t("./encode")},{"./decode":25,"./encode":26}],28:[function(t,e,n){(function(n,r){function i(){throw new Error("Secure random number generation is not supported by this browser.\nUse Chrome, Firefox or Internet Explorer 11")}function a(t,e){if(t>65536)throw new Error("requested too many random bytes");var i=new r.Uint8Array(t);t>0&&s.getRandomValues(i);var a=o.from(i.buffer);return"function"==typeof e?n.nextTick(function(){e(null,a)}):a}var o=t("safe-buffer").Buffer,s=r.crypto||r.msCrypto;s&&s.getRandomValues?e.exports=a:e.exports=i}).call(this,t("_process"),void 0!==r?r:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{_process:23,"safe-buffer":39}],29:[function(t,e,n){function r(t){if(!(this instanceof r))return new r(t);l.call(this,t),c.call(this,t),t&&!1===t.readable&&(this.readable=!1),t&&!1===t.writable&&(this.writable=!1),this.allowHalfOpen=!0,t&&!1===t.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",i)}function i(){this.allowHalfOpen||this._writableState.ended||o.nextTick(a,this)}function a(t){t.end()}var o=t("process-nextick-args"),s=G.default||function(t){var e=[];for(var n in t)e.push(n);return e};e.exports=r;var u=t("core-util-is");u.inherits=t("inherits");var l=t("./_stream_readable"),c=t("./_stream_writable");u.inherits(r,l);for(var d=s(c.prototype),h=0;h<d.length;h++){var f=d[h];r.prototype[f]||(r.prototype[f]=c.prototype[f])}Object.defineProperty(r.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(r.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed&&this._writableState.destroyed)},set:function(t){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=t,this._writableState.destroyed=t)}}),r.prototype._destroy=function(t,e){this.push(null),this.end(),o.nextTick(e,t)}},{"./_stream_readable":31,"./_stream_writable":33,"core-util-is":12,inherits:16,"process-nextick-args":22}],30:[function(t,e,n){function r(t){if(!(this instanceof r))return new r(t);i.call(this,t)}e.exports=r;var i=t("./_stream_transform"),a=t("core-util-is");a.inherits=t("inherits"),a.inherits(r,i),r.prototype._transform=function(t,e,n){n(null,t)}},{"./_stream_transform":32,"core-util-is":12,inherits:16}],31:[function(t,e,n){(function(n,r){function i(t){return F.from(t)}function a(t){return F.isBuffer(t)||t instanceof B}function o(t,e,n){if("function"==typeof t.prependListener)return t.prependListener(e,n);t._events&&t._events[e]?D(t._events[e])?t._events[e].unshift(n):t._events[e]=[n,t._events[e]]:t.on(e,n)}function s(e,n){O=O||t("./_stream_duplex"),e=e||{};var r=n instanceof O;this.objectMode=!!e.objectMode,r&&(this.objectMode=this.objectMode||!!e.readableObjectMode);var i=e.highWaterMark,a=e.readableHighWaterMark,o=this.objectMode?16:16384;this.highWaterMark=i||0===i?i:r&&(a||0===a)?a:o,this.highWaterMark=Math.floor(this.highWaterMark),this.buffer=new H,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.destroyed=!1,this.defaultEncoding=e.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(z||(z=t("string_decoder/").StringDecoder),this.decoder=new z(e.encoding),this.encoding=e.encoding)}function u(e){if(O=O||t("./_stream_duplex"),!(this instanceof u))return new u(e);this._readableState=new s(e,this),this.readable=!0,e&&("function"==typeof e.read&&(this._read=e.read),"function"==typeof e.destroy&&(this._destroy=e.destroy)),U.call(this)}function l(t,e,n,r,a){var o=t._readableState;if(null===e)o.reading=!1,m(t,o);else{var s;a||(s=d(o,e)),s?t.emit("error",s):o.objectMode||e&&e.length>0?("string"==typeof e||o.objectMode||(0,S.default)(e)===F.prototype||(e=i(e)),r?o.endEmitted?t.emit("error",new Error("stream.unshift() after end event")):c(t,o,e,!0):o.ended?t.emit("error",new Error("stream.push() after EOF")):(o.reading=!1,o.decoder&&!n?(e=o.decoder.write(e),o.objectMode||0!==e.length?c(t,o,e,!1):y(t,o)):c(t,o,e,!1))):r||(o.reading=!1)}return h(o)}function c(t,e,n,r){e.flowing&&0===e.length&&!e.sync?(t.emit("data",n),t.read(0)):(e.length+=e.objectMode?1:n.length,r?e.buffer.unshift(n):e.buffer.push(n),e.needReadable&&g(t)),y(t,e)}function d(t,e){var n;return a(e)||"string"==typeof e||void 0===e||t.objectMode||(n=new TypeError("Invalid non-string/buffer chunk")),n}function h(t){return!t.ended&&(t.needReadable||t.length<t.highWaterMark||0===t.length)}function f(t){return t>=W?t=W:(t--,t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,t|=t>>>16,t++),t}function p(t,e){return t<=0||0===e.length&&e.ended?0:e.objectMode?1:t!==t?e.flowing&&e.length?e.buffer.head.data.length:e.length:(t>e.highWaterMark&&(e.highWaterMark=f(t)),t<=e.length?t:e.ended?e.length:(e.needReadable=!0,0))}function m(t,e){if(!e.ended){if(e.decoder){var n=e.decoder.end();n&&n.length&&(e.buffer.push(n),e.length+=e.objectMode?1:n.length)}e.ended=!0,g(t)}}function g(t){var e=t._readableState;e.needReadable=!1,e.emittedReadable||(G("emitReadable",e.flowing),e.emittedReadable=!0,e.sync?P.nextTick(v,t):v(t))}function v(t){G("emit readable"),t.emit("readable"),T(t)}function y(t,e){e.readingMore||(e.readingMore=!0,P.nextTick(_,t,e))}function _(t,e){for(var n=e.length;!e.reading&&!e.flowing&&!e.ended&&e.length<e.highWaterMark&&(G("maybeReadMore read 0"),t.read(0),n!==e.length);)n=e.length;e.readingMore=!1}function b(t){return function(){var e=t._readableState;G("pipeOnDrain",e.awaitDrain),e.awaitDrain&&e.awaitDrain--,0===e.awaitDrain&&N(t,"data")&&(e.flowing=!0,T(t))}}function E(t){G("readable nexttick read 0"),t.read(0)}function w(t,e){e.resumeScheduled||(e.resumeScheduled=!0,P.nextTick(A,t,e))}function A(t,e){e.reading||(G("resume read 0"),t.read(0)),e.resumeScheduled=!1,e.awaitDrain=0,t.emit("resume"),T(t),e.flowing&&!e.reading&&t.read(0)}function T(t){var e=t._readableState;for(G("flow",e.flowing);e.flowing&&null!==t.read(););}function x(t,e){if(0===e.length)return null;var n;return e.objectMode?n=e.buffer.shift():!t||t>=e.length?(n=e.decoder?e.buffer.join(""):1===e.buffer.length?e.buffer.head.data:e.buffer.concat(e.length),e.buffer.clear()):n=k(t,e.buffer,e.decoder),n}function k(t,e,n){var r;return t<e.head.data.length?(r=e.head.data.slice(0,t),e.head.data=e.head.data.slice(t)):r=t===e.head.data.length?e.shift():n?C(t,e):M(t,e),r}function C(t,e){var n=e.head,r=1,i=n.data;for(t-=i.length;n=n.next;){var a=n.data,o=t>a.length?a.length:t;if(o===a.length?i+=a:i+=a.slice(0,t),0===(t-=o)){o===a.length?(++r,n.next?e.head=n.next:e.head=e.tail=null):(e.head=n,n.data=a.slice(o));break}++r}return e.length-=r,i}function M(t,e){var n=F.allocUnsafe(t),r=e.head,i=1;for(r.data.copy(n),t-=r.data.length;r=r.next;){var a=r.data,o=t>a.length?a.length:t;if(a.copy(n,n.length-t,0,o),0===(t-=o)){o===a.length?(++i,r.next?e.head=r.next:e.head=e.tail=null):(e.head=r,r.data=a.slice(o));break}++i}return e.length-=i,n}function R(t){var e=t._readableState;if(e.length>0)throw new Error('"endReadable()" called on non-empty stream');e.endEmitted||(e.ended=!0,P.nextTick(L,e,t))}function L(t,e){t.endEmitted||0!==t.length||(t.endEmitted=!0,e.readable=!1,e.emit("end"))}function I(t,e){for(var n=0,r=t.length;n<r;n++)if(t[n]===e)return n;return-1}var P=t("process-nextick-args");e.exports=u;var O,D=t("isarray");u.ReadableState=s;var N=(t("events").EventEmitter,function(t,e){return t.listeners(e).length}),U=t("./internal/streams/stream"),F=t("safe-buffer").Buffer,B=r.Uint8Array||function(){},j=t("core-util-is");j.inherits=t("inherits");var V=t("util"),G=void 0;G=V&&V.debuglog?V.debuglog("stream"):function(){};var z,H=t("./internal/streams/BufferList"),K=t("./internal/streams/destroy");j.inherits(u,U);var Y=["error","close","destroy","pause","resume"];Object.defineProperty(u.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(t){this._readableState&&(this._readableState.destroyed=t)}}),u.prototype.destroy=K.destroy,u.prototype._undestroy=K.undestroy,u.prototype._destroy=function(t,e){this.push(null),e(t)},u.prototype.push=function(t,e){var n,r=this._readableState;return r.objectMode?n=!0:"string"==typeof t&&(e=e||r.defaultEncoding,e!==r.encoding&&(t=F.from(t,e),e=""),n=!0),l(this,t,e,!1,n)},u.prototype.unshift=function(t){return l(this,t,null,!0,!1)},u.prototype.isPaused=function(){return!1===this._readableState.flowing},u.prototype.setEncoding=function(e){return z||(z=t("string_decoder/").StringDecoder),this._readableState.decoder=new z(e),this._readableState.encoding=e,this};var W=8388608;u.prototype.read=function(t){G("read",t),t=parseInt(t,10);var e=this._readableState,n=t;if(0!==t&&(e.emittedReadable=!1),0===t&&e.needReadable&&(e.length>=e.highWaterMark||e.ended))return G("read: emitReadable",e.length,e.ended),0===e.length&&e.ended?R(this):g(this),null;if(0===(t=p(t,e))&&e.ended)return 0===e.length&&R(this),null;var r=e.needReadable;G("need readable",r),(0===e.length||e.length-t<e.highWaterMark)&&(r=!0,G("length less than watermark",r)),e.ended||e.reading?(r=!1,G("reading or ended",r)):r&&(G("do read"),e.reading=!0,e.sync=!0,0===e.length&&(e.needReadable=!0),this._read(e.highWaterMark),e.sync=!1,e.reading||(t=p(n,e)));var i;return i=t>0?x(t,e):null,null===i?(e.needReadable=!0,t=0):e.length-=t,0===e.length&&(e.ended||(e.needReadable=!0),n!==t&&e.ended&&R(this)),null!==i&&this.emit("data",i),i},u.prototype._read=function(t){this.emit("error",new Error("_read() is not implemented"))},u.prototype.pipe=function(t,e){function r(t,e){G("onunpipe"),t===h&&e&&!1===e.hasUnpiped&&(e.hasUnpiped=!0,a())}function i(){G("onend"),t.end()}function a(){G("cleanup"),t.removeListener("close",l),t.removeListener("finish",c),t.removeListener("drain",g),t.removeListener("error",u),t.removeListener("unpipe",r),h.removeListener("end",i),h.removeListener("end",d),h.removeListener("data",s),v=!0,!f.awaitDrain||t._writableState&&!t._writableState.needDrain||g()}function s(e){G("ondata"),y=!1,!1!==t.write(e)||y||((1===f.pipesCount&&f.pipes===t||f.pipesCount>1&&-1!==I(f.pipes,t))&&!v&&(G("false write response, pause",h._readableState.awaitDrain),h._readableState.awaitDrain++,y=!0),h.pause())}function u(e){G("onerror",e),d(),t.removeListener("error",u),0===N(t,"error")&&t.emit("error",e)}function l(){t.removeListener("finish",c),d()}function c(){G("onfinish"),t.removeListener("close",l),d()}function d(){G("unpipe"),h.unpipe(t)}var h=this,f=this._readableState;switch(f.pipesCount){case 0:f.pipes=t;break;case 1:f.pipes=[f.pipes,t];break;default:f.pipes.push(t)}f.pipesCount+=1,G("pipe count=%d opts=%j",f.pipesCount,e);var p=(!e||!1!==e.end)&&t!==n.stdout&&t!==n.stderr,m=p?i:d;f.endEmitted?P.nextTick(m):h.once("end",m),t.on("unpipe",r);var g=b(h);t.on("drain",g);var v=!1,y=!1;return h.on("data",s),o(t,"error",u),t.once("close",l),t.once("finish",c),t.emit("pipe",h),f.flowing||(G("pipe resume"),h.resume()),t},u.prototype.unpipe=function(t){var e=this._readableState,n={hasUnpiped:!1};if(0===e.pipesCount)return this;if(1===e.pipesCount)return t&&t!==e.pipes?this:(t||(t=e.pipes),e.pipes=null,e.pipesCount=0,e.flowing=!1,t&&t.emit("unpipe",this,n),this);if(!t){var r=e.pipes,i=e.pipesCount;e.pipes=null,e.pipesCount=0,e.flowing=!1;for(var a=0;a<i;a++)r[a].emit("unpipe",this,n);return this}var o=I(e.pipes,t);return-1===o?this:(e.pipes.splice(o,1),e.pipesCount-=1,1===e.pipesCount&&(e.pipes=e.pipes[0]),t.emit("unpipe",this,n),this)},u.prototype.on=function(t,e){var n=U.prototype.on.call(this,t,e);if("data"===t)!1!==this._readableState.flowing&&this.resume();else if("readable"===t){var r=this._readableState;r.endEmitted||r.readableListening||(r.readableListening=r.needReadable=!0,r.emittedReadable=!1,r.reading?r.length&&g(this):P.nextTick(E,this))}return n},u.prototype.addListener=u.prototype.on,u.prototype.resume=function(){var t=this._readableState;return t.flowing||(G("resume"),t.flowing=!0,w(this,t)),this},u.prototype.pause=function(){return G("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(G("pause"),this._readableState.flowing=!1,this.emit("pause")),this},u.prototype.wrap=function(t){var e=this,n=this._readableState,r=!1;t.on("end",function(){if(G("wrapped end"),n.decoder&&!n.ended){var t=n.decoder.end();t&&t.length&&e.push(t)}e.push(null)}),t.on("data",function(i){if(G("wrapped data"),n.decoder&&(i=n.decoder.write(i)),(!n.objectMode||null!==i&&void 0!==i)&&(n.objectMode||i&&i.length)){e.push(i)||(r=!0,t.pause())}});for(var i in t)void 0===this[i]&&"function"==typeof t[i]&&(this[i]=function(e){return function(){return t[e].apply(t,arguments)}}(i));for(var a=0;a<Y.length;a++)t.on(Y[a],this.emit.bind(this,Y[a]));return this._read=function(e){G("wrapped _read",e),r&&(r=!1,t.resume())},this},Object.defineProperty(u.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),u._fromList=x}).call(this,t("_process"),void 0!==r?r:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./_stream_duplex":29,"./internal/streams/BufferList":34,"./internal/streams/destroy":35,"./internal/streams/stream":36,_process:23,"core-util-is":12,events:10,inherits:16,isarray:18,"process-nextick-args":22,"safe-buffer":39,"string_decoder/":48,util:9}],32:[function(t,e,n){function r(t,e){var n=this._transformState;n.transforming=!1;var r=n.writecb;if(!r)return this.emit("error",new Error("write callback called multiple times"));n.writechunk=null,n.writecb=null,null!=e&&this.push(e),r(t);var i=this._readableState;i.reading=!1,(i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}function i(t){if(!(this instanceof i))return new i(t);s.call(this,t),this._transformState={afterTransform:r.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,t&&("function"==typeof t.transform&&(this._transform=t.transform),"function"==typeof t.flush&&(this._flush=t.flush)),this.on("prefinish",a)}function a(){var t=this;"function"==typeof this._flush?this._flush(function(e,n){o(t,e,n)}):o(this,null,null)}function o(t,e,n){if(e)return t.emit("error",e);if(null!=n&&t.push(n),t._writableState.length)throw new Error("Calling transform done when ws.length != 0");if(t._transformState.transforming)throw new Error("Calling transform done when still transforming");return t.push(null)}e.exports=i;var s=t("./_stream_duplex"),u=t("core-util-is");u.inherits=t("inherits"),u.inherits(i,s),i.prototype.push=function(t,e){return this._transformState.needTransform=!1,s.prototype.push.call(this,t,e)},i.prototype._transform=function(t,e,n){throw new Error("_transform() is not implemented")},i.prototype._write=function(t,e,n){var r=this._transformState;if(r.writecb=n,r.writechunk=t,r.writeencoding=e,!r.transforming){var i=this._readableState;(r.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}},i.prototype._read=function(t){var e=this._transformState;null!==e.writechunk&&e.writecb&&!e.transforming?(e.transforming=!0,this._transform(e.writechunk,e.writeencoding,e.afterTransform)):e.needTransform=!0},i.prototype._destroy=function(t,e){var n=this;s.prototype._destroy.call(this,t,function(t){e(t),n.emit("close")})}},{"./_stream_duplex":29,"core-util-is":12,inherits:16}],33:[function(t,e,n){(function(n,r,i){function a(t){var e=this;this.next=null,this.entry=null,this.finish=function(){C(e,t)}}function o(t){return U.from(t)}function s(t){return U.isBuffer(t)||t instanceof F}function u(){}function l(e,n){L=L||t("./_stream_duplex"),e=e||{};var r=n instanceof L;this.objectMode=!!e.objectMode,r&&(this.objectMode=this.objectMode||!!e.writableObjectMode);var i=e.highWaterMark,o=e.writableHighWaterMark,s=this.objectMode?16:16384;this.highWaterMark=i||0===i?i:r&&(o||0===o)?o:s,this.highWaterMark=Math.floor(this.highWaterMark),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var u=!1===e.decodeStrings;this.decodeStrings=!u,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(t){y(n,t)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new a(this)}function c(e){if(L=L||t("./_stream_duplex"),!(j.call(c,this)||this instanceof L))return new c(e);this._writableState=new l(e,this),this.writable=!0,e&&("function"==typeof e.write&&(this._write=e.write),"function"==typeof e.writev&&(this._writev=e.writev),"function"==typeof e.destroy&&(this._destroy=e.destroy),"function"==typeof e.final&&(this._final=e.final)),D.call(this)}function d(t,e){var n=new Error("write after end");t.emit("error",n),M.nextTick(e,n)}function h(t,e,n,r){var i=!0,a=!1;return null===n?a=new TypeError("May not write null values to stream"):"string"==typeof n||void 0===n||e.objectMode||(a=new TypeError("Invalid non-string/buffer chunk")),a&&(t.emit("error",a),M.nextTick(r,a),i=!1),i}function f(t,e,n){return t.objectMode||!1===t.decodeStrings||"string"!=typeof e||(e=U.from(e,n)),e}function p(t,e,n,r,i,a){if(!n){var o=f(e,r,i);r!==o&&(n=!0,i="buffer",r=o)}var s=e.objectMode?1:r.length;e.length+=s;var u=e.length<e.highWaterMark;if(u||(e.needDrain=!0),e.writing||e.corked){var l=e.lastBufferedRequest;e.lastBufferedRequest={chunk:r,encoding:i,isBuf:n,callback:a,next:null},l?l.next=e.lastBufferedRequest:e.bufferedRequest=e.lastBufferedRequest,e.bufferedRequestCount+=1}else m(t,e,!1,s,r,i,a);return u}function m(t,e,n,r,i,a,o){e.writelen=r,e.writecb=o,e.writing=!0,e.sync=!0,n?t._writev(i,e.onwrite):t._write(i,a,e.onwrite),e.sync=!1}function g(t,e,n,r,i){--e.pendingcb,n?(M.nextTick(i,r),M.nextTick(x,t,e),t._writableState.errorEmitted=!0,t.emit("error",r)):(i(r),t._writableState.errorEmitted=!0,t.emit("error",r),x(t,e))}function v(t){t.writing=!1,t.writecb=null,t.length-=t.writelen,t.writelen=0}function y(t,e){var n=t._writableState,r=n.sync,i=n.writecb;if(v(n),e)g(t,n,r,e,i);else{var a=A(n);a||n.corked||n.bufferProcessing||!n.bufferedRequest||E(t,n),r?I(_,t,n,a,i):_(t,n,a,i)}}function _(t,e,n,r){n||b(t,e),e.pendingcb--,r(),x(t,e)}function b(t,e){0===e.length&&e.needDrain&&(e.needDrain=!1,t.emit("drain"))}function E(t,e){e.bufferProcessing=!0;var n=e.bufferedRequest;if(t._writev&&n&&n.next){var r=e.bufferedRequestCount,i=new Array(r),o=e.corkedRequestsFree;o.entry=n;for(var s=0,u=!0;n;)i[s]=n,n.isBuf||(u=!1),n=n.next,s+=1;i.allBuffers=u,m(t,e,!0,e.length,i,"",o.finish),e.pendingcb++,e.lastBufferedRequest=null,o.next?(e.corkedRequestsFree=o.next,o.next=null):e.corkedRequestsFree=new a(e),e.bufferedRequestCount=0}else{for(;n;){var l=n.chunk,c=n.encoding,d=n.callback;if(m(t,e,!1,e.objectMode?1:l.length,l,c,d),n=n.next,e.bufferedRequestCount--,e.writing)break}null===n&&(e.lastBufferedRequest=null)}e.bufferedRequest=n,e.bufferProcessing=!1}function A(t){return t.ending&&0===t.length&&null===t.bufferedRequest&&!t.finished&&!t.writing}function S(t,e){t._final(function(n){e.pendingcb--,n&&t.emit("error",n),e.prefinished=!0,t.emit("prefinish"),x(t,e)})}function T(t,e){e.prefinished||e.finalCalled||("function"==typeof t._final?(e.pendingcb++,e.finalCalled=!0,M.nextTick(S,t,e)):(e.prefinished=!0,t.emit("prefinish")))}function x(t,e){var n=A(e);return n&&(T(t,e),0===e.pendingcb&&(e.finished=!0,t.emit("finish"))),n}function k(t,e,n){e.ending=!0,x(t,e),n&&(e.finished?M.nextTick(n):t.once("finish",n)),e.ended=!0,t.writable=!1}function C(t,e,n){var r=t.entry;for(t.entry=null;r;){var i=r.callback;e.pendingcb--,i(n),r=r.next}e.corkedRequestsFree?e.corkedRequestsFree.next=t:e.corkedRequestsFree=t}var M=t("process-nextick-args");e.exports=c;var L,I=!n.browser&&["v0.10","v0.9."].indexOf(n.version.slice(0,5))>-1?i:M.nextTick;c.WritableState=l;var P=t("core-util-is");P.inherits=t("inherits");var O={deprecate:t("util-deprecate")},D=t("./internal/streams/stream"),U=t("safe-buffer").Buffer,F=r.Uint8Array||function(){},B=t("./internal/streams/destroy");P.inherits(c,D),l.prototype.getBuffer=function(){for(var t=this.bufferedRequest,e=[];t;)e.push(t),t=t.next;return e},function(){try{Object.defineProperty(l.prototype,"buffer",{get:O.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(t){}}();var j;"function"==typeof N.default&&w.default&&"function"==typeof Function.prototype[w.default]?(j=Function.prototype[w.default],(0,R.default)(c,w.default,{value:function(t){return!!j.call(this,t)||this===c&&(t&&t._writableState instanceof l)}})):j=function(t){return t instanceof this},c.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},c.prototype.write=function(t,e,n){var r=this._writableState,i=!1,a=!r.objectMode&&s(t);return a&&!U.isBuffer(t)&&(t=o(t)),"function"==typeof e&&(n=e,e=null),a?e="buffer":e||(e=r.defaultEncoding),"function"!=typeof n&&(n=u),r.ended?d(this,n):(a||h(this,r,t,n))&&(r.pendingcb++,i=p(this,r,a,t,e,n)),i},c.prototype.cork=function(){this._writableState.corked++},c.prototype.uncork=function(){var t=this._writableState;t.corked&&(t.corked--,t.writing||t.corked||t.finished||t.bufferProcessing||!t.bufferedRequest||E(this,t))},c.prototype.setDefaultEncoding=function(t){if("string"==typeof t&&(t=t.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((t+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+t);return this._writableState.defaultEncoding=t,this},Object.defineProperty(c.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),c.prototype._write=function(t,e,n){n(new Error("_write() is not implemented"))},c.prototype._writev=null,c.prototype.end=function(t,e,n){var r=this._writableState;"function"==typeof t?(n=t,t=null,e=null):"function"==typeof e&&(n=e,e=null),null!==t&&void 0!==t&&this.write(t,e),r.corked&&(r.corked=1,this.uncork()),r.ending||r.finished||k(this,r,n)},Object.defineProperty(c.prototype,"destroyed",{get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(t){this._writableState&&(this._writableState.destroyed=t)}}),c.prototype.destroy=B.destroy,c.prototype._undestroy=B.undestroy,c.prototype._destroy=function(t,e){this.end(),e(t)}}).call(this,t("_process"),void 0!==r?r:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("timers").setImmediate)},{"./_stream_duplex":29,"./internal/streams/destroy":35,"./internal/streams/stream":36,_process:23,"core-util-is":12,inherits:16,"process-nextick-args":22,"safe-buffer":39,timers:49,"util-deprecate":53}],34:[function(t,e,n){function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e,n){t.copy(e,n)}var a=t("safe-buffer").Buffer,o=t("util");e.exports=function(){function t(){r(this,t),this.head=null,this.tail=null,this.length=0}return t.prototype.push=function(t){var e={data:t,next:null};this.length>0?this.tail.next=e:this.head=e,this.tail=e,++this.length},t.prototype.unshift=function(t){var e={data:t,next:this.head};0===this.length&&(this.tail=e),this.head=e,++this.length},t.prototype.shift=function(){if(0!==this.length){var t=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,t}},t.prototype.clear=function(){this.head=this.tail=null,this.length=0},t.prototype.join=function(t){if(0===this.length)return"";for(var e=this.head,n=""+e.data;e=e.next;)n+=t+e.data;return n},t.prototype.concat=function(t){if(0===this.length)return a.alloc(0);if(1===this.length)return this.head.data;for(var e=a.allocUnsafe(t>>>0),n=this.head,r=0;n;)i(n.data,e,r),r+=n.data.length,n=n.next;return e},t}(),o&&o.inspect&&o.inspect.custom&&(e.exports.prototype[o.inspect.custom]=function(){var t=o.inspect({length:this.length});return this.constructor.name+" "+t})},{"safe-buffer":39,util:9}],35:[function(t,e,n){function r(t,e){var n=this,r=this._readableState&&this._readableState.destroyed,i=this._writableState&&this._writableState.destroyed;return r||i?(e?e(t):!t||this._writableState&&this._writableState.errorEmitted||o.nextTick(a,this,t),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(t||null,function(t){!e&&t?(o.nextTick(a,n,t),n._writableState&&(n._writableState.errorEmitted=!0)):e&&e(t)}),this)}function i(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}function a(t,e){t.emit("error",e)}var o=t("process-nextick-args");e.exports={destroy:r,undestroy:i}},{"process-nextick-args":22}],36:[function(t,e,n){e.exports=t("events").EventEmitter},{events:10}],37:[function(t,e,n){n=e.exports=t("./lib/_stream_readable.js"),n.Stream=n,n.Readable=n,n.Writable=t("./lib/_stream_writable.js"),n.Duplex=t("./lib/_stream_duplex.js"),n.Transform=t("./lib/_stream_transform.js"),n.PassThrough=t("./lib/_stream_passthrough.js")},{"./lib/_stream_duplex.js":29,"./lib/_stream_passthrough.js":30,"./lib/_stream_readable.js":31,"./lib/_stream_transform.js":32,"./lib/_stream_writable.js":33}],38:[function(t,e,n){(function(t){function n(e,n){function r(e){function r(){n&&n(e,a),n=null}u?t.nextTick(r):r()}function i(t,e,n){a[t]=n,(0==--o||e)&&r(e)}var a,o,s,u=!0;Array.isArray(e)?(a=[],o=e.length):(s=(0,G.default)(e),a={},o=s.length),o?s?s.forEach(function(t){e[t](function(e,n){i(t,e,n)})}):e.forEach(function(t,e){t(function(t,n){i(e,t,n)})}):r(null),u=!1}e.exports=n}).call(this,t("_process"))},{_process:23}],39:[function(t,e,n){function r(t,e){for(var n in t)e[n]=t[n]}function i(t,e,n){return o(t,e,n)}var a=t("buffer"),o=a.Buffer;o.from&&o.alloc&&o.allocUnsafe&&o.allocUnsafeSlow?e.exports=a:(r(a,n),n.Buffer=i),r(o,i),i.from=function(t,e,n){if("number"==typeof t)throw new TypeError("Argument must not be a number");return o(t,e,n)},i.alloc=function(t,e,n){if("number"!=typeof t)throw new TypeError("Argument must be a number");var r=o(t);return void 0!==e?"string"==typeof n?r.fill(e,n):r.fill(e):r.fill(0),r},i.allocUnsafe=function(t){if("number"!=typeof t)throw new TypeError("Argument must be a number");return o(t)},i.allocUnsafeSlow=function(t){if("number"!=typeof t)throw new TypeError("Argument must be a number");return a.SlowBuffer(t)}},{buffer:11}],40:[function(t,e,n){function r(t,e){this._block=i.alloc(t),this._finalSize=e,this._blockSize=t,this._len=0}var i=t("safe-buffer").Buffer;r.prototype.update=function(t,e){"string"==typeof t&&(e=e||"utf8",t=i.from(t,e));for(var n=this._block,r=this._blockSize,a=t.length,o=this._len,s=0;s<a;){for(var u=o%r,l=Math.min(a-s,r-u),c=0;c<l;c++)n[u+c]=t[s+c];o+=l,s+=l,o%r==0&&this._update(n)}return this._len+=a,this},r.prototype.digest=function(t){var e=this._len%this._blockSize;this._block[e]=128,this._block.fill(0,e+1),e>=this._finalSize&&(this._update(this._block),this._block.fill(0));var n=8*this._len;if(n<=4294967295)this._block.writeUInt32BE(n,this._blockSize-4);else{var r=(4294967295&n)>>>0,i=(n-r)/4294967296;this._block.writeUInt32BE(i,this._blockSize-8),this._block.writeUInt32BE(r,this._blockSize-4)}this._update(this._block);var a=this._hash();return t?a.toString(t):a},r.prototype._update=function(){throw new Error("_update must be implemented by subclass")},e.exports=r},{"safe-buffer":39}],41:[function(t,e,n){function r(){this.init(),this._w=h,l.call(this,64,56)}function i(t){return t<<1|t>>>31}function a(t){return t<<5|t>>>27}function o(t){return t<<30|t>>>2}function s(t,e,n,r){return 0===t?e&n|~e&r:2===t?e&n|e&r|n&r:e^n^r}var u=t("inherits"),l=t("./hash"),c=t("safe-buffer").Buffer,d=[1518500249,1859775393,-1894007588,-899497514],h=new Array(80);u(r,l),r.prototype.init=function(){return this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878,this._e=3285377520,this},r.prototype._update=function(t){for(var e=this._w,n=0|this._a,r=0|this._b,u=0|this._c,l=0|this._d,c=0|this._e,h=0;h<16;++h)e[h]=t.readInt32BE(4*h);for(;h<80;++h)e[h]=i(e[h-3]^e[h-8]^e[h-14]^e[h-16]);for(var f=0;f<80;++f){var p=~~(f/20),m=a(n)+s(p,r,u,l)+c+e[f]+d[p]|0;c=l,l=u,u=o(r),r=n,n=m}this._a=n+this._a|0,this._b=r+this._b|0,this._c=u+this._c|0,this._d=l+this._d|0,this._e=c+this._e|0},r.prototype._hash=function(){var t=c.allocUnsafe(20);return t.writeInt32BE(0|this._a,0),t.writeInt32BE(0|this._b,4),t.writeInt32BE(0|this._c,8),t.writeInt32BE(0|this._d,12),t.writeInt32BE(0|this._e,16),t},e.exports=r},{"./hash":40,inherits:16,"safe-buffer":39}],42:[function(t,e,n){(function(n){function r(t){var e=this;if(!(e instanceof r))return new r(t);if(e._id=l(4).toString("hex").slice(0,7),e._debug("new peer %o",t),t=(0,F.default)({allowHalfOpen:!1},t),c.Duplex.call(e,t),e.channelName=t.initiator?t.channelName||l(20).toString("hex"):null,e._isChromium="undefined"!=typeof window&&!!window.webkitRTCPeerConnection,e.initiator=t.initiator||!1,e.channelConfig=t.channelConfig||r.channelConfig,e.config=t.config||r.config,e.constraints=e._transformConstraints(t.constraints||r.constraints),e.offerConstraints=e._transformConstraints(t.offerConstraints||{}),e.answerConstraints=e._transformConstraints(t.answerConstraints||{}),e.sdpTransform=t.sdpTransform||function(t){return t},e.streams=t.streams||(t.stream?[t.stream]:[]),e.trickle=void 0===t.trickle||t.trickle,e.destroyed=!1,e.connected=!1,e.remoteAddress=void 0,e.remoteFamily=void 0,e.remotePort=void 0,e.localAddress=void 0,e.localPort=void 0,e._wrtc=t.wrtc&&"object"===(0,H.default)(t.wrtc)?t.wrtc:s(),!e._wrtc)throw"undefined"==typeof window?i("No WebRTC support: Specify `opts.wrtc` option in this environment","ERR_WEBRTC_SUPPORT"):i("No WebRTC support: Not a supported browser","ERR_WEBRTC_SUPPORT");e._pcReady=!1,e._channelReady=!1,e._iceComplete=!1,e._channel=null,e._pendingCandidates=[],e._isNegotiating=!1,e._batchedNegotiation=!1,e._queuedNegotiation=!1,e._sendersAwaitingStable=[],e._senderMap=new b.default,e._remoteTracks=[],e._remoteStreams=[],e._chunk=null,e._cb=null,e._interval=null,e._pc=new e._wrtc.RTCPeerConnection(e.config,e.constraints),e._isReactNativeWebrtc="number"==typeof e._pc._peerConnectionId,e._pc.oniceconnectionstatechange=function(){e._onIceStateChange()},e._pc.onicegatheringstatechange=function(){e._onIceStateChange()},e._pc.onsignalingstatechange=function(){e._onSignalingStateChange()},e._pc.onicecandidate=function(t){e._onIceCandidate(t)},e.initiator?e._setupData({channel:e._pc.createDataChannel(e.channelName,e.channelConfig)}):e._pc.ondatachannel=function(t){e._setupData(t)},"addTrack"in e._pc&&(e.streams&&e.streams.forEach(function(t){e.addStream(t)}),e._pc.ontrack=function(t){e._onTrack(t)}),e.initiator&&e._needsNegotiation(),e._onFinishBound=function(){e._onFinish()},e.once("finish",e._onFinishBound)}function i(t,e){var n=new Error(t);return n.code=e,n}function a(){}e.exports=r;var o=t("debug")("simple-peer"),s=t("get-browser-rtc"),u=t("inherits"),l=t("randombytes"),c=t("readable-stream");u(r,c.Duplex),r.WEBRTC_SUPPORT=!!s(),r.config={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:global.stun.twilio.com:3478?transport=udp"}]},r.constraints={},r.channelConfig={},Object.defineProperty(r.prototype,"bufferSize",{get:function(){var t=this;return t._channel&&t._channel.bufferedAmount||0}}),r.prototype.address=function(){var t=this;return{port:t.localPort,family:"IPv4",address:t.localAddress}},r.prototype.signal=function(t){var e=this;if(e.destroyed)throw i("cannot signal after peer is destroyed","ERR_SIGNALING");if("string"==typeof t)try{t=JSON.parse(t)}catch(n){t={}}e._debug("signal()"),t.renegotiate&&(e._debug("got request to renegotiate"),e._needsNegotiation()),t.candidate&&(e._pc.remoteDescription&&e._pc.remoteDescription.type?e._addIceCandidate(t.candidate):e._pendingCandidates.push(t.candidate)),t.sdp&&e._pc.setRemoteDescription(new e._wrtc.RTCSessionDescription(t),function(){e.destroyed||(e._pendingCandidates.forEach(function(t){e._addIceCandidate(t)}),e._pendingCandidates=[],"offer"===e._pc.remoteDescription.type&&e._createAnswer())},function(t){e.destroy(i(t,"ERR_SET_REMOTE_DESCRIPTION"))}),t.sdp||t.candidate||t.renegotiate||e.destroy(i("signal() called with invalid signal data","ERR_SIGNALING"))},r.prototype._addIceCandidate=function(t){var e=this;try{e._pc.addIceCandidate(new e._wrtc.RTCIceCandidate(t),a,function(t){e.destroy(i(t,"ERR_ADD_ICE_CANDIDATE"))})}catch(n){e.destroy(i("error adding candidate: "+n.message,"ERR_ADD_ICE_CANDIDATE"))}},r.prototype.send=function(t){this._channel.send(t)},r.prototype.addStream=function(t){var e=this;e._debug("addStream()"),t.getTracks().forEach(function(n){e.addTrack(n,t)})},r.prototype.addTrack=function(t,e){var n=this;n._debug("addTrack()");var r=n._pc.addTrack(t,e),i=n._senderMap.get(t)||new b.default;i.set(e,r),n._senderMap.set(t,i),n._needsNegotiation()},r.prototype.removeTrack=function(t,e){var n=this;n._debug("removeSender()");var r=n._senderMap.get(t),i=r?r.get(e):null;i||n.destroy(new Error("Cannot remove track that was never added."));try{n._pc.removeTrack(i)}catch(a){"NS_ERROR_UNEXPECTED"===a.name?n._sendersAwaitingStable.push(i):n.destroy(a)}},r.prototype.removeStream=function(t){var e=this;e._debug("removeSenders()"),t.getTracks().forEach(function(n){e.removeTrack(n,t)})},r.prototype._needsNegotiation=function(){var t=this;t._debug("_needsNegotiation"),t._batchedNegotiation||(t._batchedNegotiation=!0,setTimeout(function(){t._batchedNegotiation=!1,t._debug("starting batched negotiation"),t.negotiate()},0))},r.prototype.negotiate=function(){var t=this;t.initiator?t._isNegotiating?(t._queuedNegotiation=!0,t._debug("already negotiating, queueing")):(t._debug("start negotiation"),t._createOffer()):(t._debug("requesting negotiation from initiator"),t.emit("signal",{renegotiate:!0})),t._isNegotiating=!0},r.prototype.destroy=function(t){this._destroy(t,function(){})},r.prototype._destroy=function(t,e){var n=this;if(!n.destroyed){if(n._debug("destroy (error: %s)",t&&(t.message||t)),n.readable=n.writable=!1,n._readableState.ended||n.push(null),n._writableState.finished||n.end(),n.destroyed=!0,n.connected=!1,n._pcReady=!1,n._channelReady=!1,n._remoteTracks=null,n._remoteStreams=null,n._senderMap=null,clearInterval(n._interval),n._interval=null,n._chunk=null,n._cb=null,n._onFinishBound&&n.removeListener("finish",n._onFinishBound),n._onFinishBound=null,n._channel){try{n._channel.close()}catch(t){}n._channel.onmessage=null,n._channel.onopen=null,n._channel.onclose=null,n._channel.onerror=null}if(n._pc){try{n._pc.close()}catch(t){}n._pc.oniceconnectionstatechange=null,n._pc.onicegatheringstatechange=null,n._pc.onsignalingstatechange=null,n._pc.onicecandidate=null,"addTrack"in n._pc&&(n._pc.ontrack=null),n._pc.ondatachannel=null}n._pc=null,n._channel=null,t&&n.emit("error",t),n.emit("close"),e()}},r.prototype._setupData=function(t){var e=this;if(!t.channel)return e.destroy(i("Data channel event is missing `channel` property","ERR_DATA_CHANNEL"));e._channel=t.channel,e._channel.binaryType="arraybuffer","number"==typeof e._channel.bufferedAmountLowThreshold&&(e._channel.bufferedAmountLowThreshold=65536),e.channelName=e._channel.label,e._channel.onmessage=function(t){e._onChannelMessage(t)},e._channel.onbufferedamountlow=function(){e._onChannelBufferedAmountLow()},e._channel.onopen=function(){e._onChannelOpen()},e._channel.onclose=function(){e._onChannelClose()},e._channel.onerror=function(t){e.destroy(i(t,"ERR_DATA_CHANNEL"))}},r.prototype._read=function(){},r.prototype._write=function(t,e,n){var r=this;if(r.destroyed)return n(i("cannot write after peer is destroyed","ERR_DATA_CHANNEL"));if(r.connected){try{r.send(t)}catch(a){return r.destroy(i(a,"ERR_DATA_CHANNEL"))}r._channel.bufferedAmount>65536?(r._debug("start backpressure: bufferedAmount %d",r._channel.bufferedAmount),r._cb=n):n(null)}else r._debug("write before connect"),r._chunk=t,r._cb=n},r.prototype._onFinish=function(){function t(){setTimeout(function(){e.destroy()},1e3)}var e=this;e.destroyed||(e.connected?t():e.once("connect",t))},r.prototype._createOffer=function(){var t=this;t.destroyed||t._pc.createOffer(function(e){function n(){t._debug("createOffer success"),t.destroyed||(t.trickle||t._iceComplete?a():t.once("_iceComplete",a))}function r(e){t.destroy(i(e,"ERR_SET_LOCAL_DESCRIPTION"))}function a(){var n=t._pc.localDescription||e;t._debug("signal"),t.emit("signal",{type:n.type,sdp:n.sdp})}t.destroyed||(e.sdp=t.sdpTransform(e.sdp),t._pc.setLocalDescription(e,n,r))},function(e){t.destroy(i(e,"ERR_CREATE_OFFER"))},t.offerConstraints)},r.prototype._createAnswer=function(){var t=this;t.destroyed||t._pc.createAnswer(function(e){function n(){t.destroyed||(t.trickle||t._iceComplete?a():t.once("_iceComplete",a))}function r(e){t.destroy(i(e,"ERR_SET_LOCAL_DESCRIPTION"))}function a(){var n=t._pc.localDescription||e;t._debug("signal"),t.emit("signal",{type:n.type,sdp:n.sdp})}t.destroyed||(e.sdp=t.sdpTransform(e.sdp),t._pc.setLocalDescription(e,n,r))},function(e){t.destroy(i(e,"ERR_CREATE_ANSWER"))},t.answerConstraints)},r.prototype._onIceStateChange=function(){var t=this;if(!t.destroyed){var e=t._pc.iceConnectionState,n=t._pc.iceGatheringState;t._debug("iceStateChange (connection: %s) (gathering: %s)",e,n),t.emit("iceStateChange",e,n),"connected"!==e&&"completed"!==e||(t._pcReady=!0,t._maybeReady()),"failed"===e&&t.destroy(i("Ice connection failed.","ERR_ICE_CONNECTION_FAILURE")),"closed"===e&&t.destroy(new Error("Ice connection closed."))}},r.prototype.getStats=function(t){var e=this;0===e._pc.getStats.length?e._pc.getStats().then(function(e){var n=[];e.forEach(function(t){n.push(t)}),t(null,n)},function(e){t(e)}):e._isReactNativeWebrtc?e._pc.getStats(null,function(e){var n=[];e.forEach(function(t){n.push(t)}),t(null,n)},function(e){t(e)}):e._pc.getStats.length>0?e._pc.getStats(function(n){if(!e.destroyed){var r=[];n.result().forEach(function(t){var e={};t.names().forEach(function(n){e[n]=t.stat(n)}),e.id=t.id,e.type=t.type,e.timestamp=t.timestamp,r.push(e)}),t(null,r)}},function(e){t(e)}):t(null,[])},r.prototype._maybeReady=function(){function t(){e.destroyed||e.getStats(function(n,r){function a(t){l=!0;var n=s[t.localCandidateId];n&&n.ip?(e.localAddress=n.ip,e.localPort=Number(n.port)):n&&n.ipAddress?(e.localAddress=n.ipAddress,e.localPort=Number(n.portNumber)):"string"==typeof t.googLocalAddress&&(n=t.googLocalAddress.split(":"),e.localAddress=n[0],e.localPort=Number(n[1]));var r=o[t.remoteCandidateId];r&&r.ip?(e.remoteAddress=r.ip,e.remotePort=Number(r.port)):r&&r.ipAddress?(e.remoteAddress=r.ipAddress,e.remotePort=Number(r.portNumber)):"string"==typeof t.googRemoteAddress&&(r=t.googRemoteAddress.split(":"),e.remoteAddress=r[0],e.remotePort=Number(r[1])),e.remoteFamily="IPv4",e._debug("connect local: %s:%s remote: %s:%s",e.localAddress,e.localPort,e.remoteAddress,e.remotePort)}if(!e.destroyed){n&&(r=[]);var o={},s={},u={},l=!1;if(r.forEach(function(t){"remotecandidate"!==t.type&&"remote-candidate"!==t.type||(o[t.id]=t),"localcandidate"!==t.type&&"local-candidate"!==t.type||(s[t.id]=t),"candidatepair"!==t.type&&"candidate-pair"!==t.type||(u[t.id]=t)}),r.forEach(function(t){"transport"===t.type&&t.selectedCandidatePairId&&a(u[t.selectedCandidatePairId]),("googCandidatePair"===t.type&&"true"===t.googActiveConnection||("candidatepair"===t.type||"candidate-pair"===t.type)&&t.selected)&&a(t)}),!(l||(0,G.default)(u).length&&!(0,G.default)(s).length))return void setTimeout(t,100);if(e._connecting=!1,e.connected=!0,e._chunk){try{e.send(e._chunk)}catch(n){return e.destroy(i(n,"ERR_DATA_CHANNEL"))}e._chunk=null,e._debug('sent chunk from "write before connect"');var c=e._cb;e._cb=null,c(null)}"number"!=typeof e._channel.bufferedAmountLowThreshold&&(e._interval=setInterval(function(){e._onInterval()},150),e._interval.unref&&e._interval.unref()),e._debug("connect"),e.emit("connect")}})}var e=this;e._debug("maybeReady pc %s channel %s",e._pcReady,e._channelReady),!e.connected&&!e._connecting&&e._pcReady&&e._channelReady&&(e._connecting=!0,t())},r.prototype._onInterval=function(){var t=this;!t._cb||!t._channel||t._channel.bufferedAmount>65536||t._onChannelBufferedAmountLow()},r.prototype._onSignalingStateChange=function(){var t=this;t.destroyed||("stable"===t._pc.signalingState&&(t._isNegotiating=!1,t._debug("flushing sender queue",t._sendersAwaitingStable),t._sendersAwaitingStable.forEach(function(e){t.removeTrack(e),t._queuedNegotiation=!0}),t._sendersAwaitingStable=[],t._queuedNegotiation&&(t._debug("flushing negotiation queue"),t._queuedNegotiation=!1,t._needsNegotiation()),t._debug("negotiate"),t.emit("negotiate")),t._debug("signalingStateChange %s",t._pc.signalingState),t.emit("signalingStateChange",t._pc.signalingState))},r.prototype._onIceCandidate=function(t){var e=this;e.destroyed||(t.candidate&&e.trickle?e.emit("signal",{candidate:{candidate:t.candidate.candidate,sdpMLineIndex:t.candidate.sdpMLineIndex,sdpMid:t.candidate.sdpMid}}):t.candidate||(e._iceComplete=!0,e.emit("_iceComplete")))},r.prototype._onChannelMessage=function(t){var e=this;if(!e.destroyed){var r=t.data;r instanceof ArrayBuffer&&(r=n.from(r)),e.push(r)}},r.prototype._onChannelBufferedAmountLow=function(){var t=this;if(!t.destroyed&&t._cb){t._debug("ending backpressure: bufferedAmount %d",t._channel.bufferedAmount);var e=t._cb;t._cb=null,e(null)}},r.prototype._onChannelOpen=function(){var t=this;t.connected||t.destroyed||(t._debug("on channel open"),t._channelReady=!0,t._maybeReady())},r.prototype._onChannelClose=function(){var t=this;t.destroyed||(t._debug("on channel close"),t.destroy())},r.prototype._onTrack=function(t){var e=this;e.destroyed||t.streams.forEach(function(n){e._debug("on track"),e.emit("track",t.track,n),e._remoteTracks.push({track:t.track,stream:n}),e._remoteStreams.some(function(t){return t.id===n.id})||(e._remoteStreams.push(n),setTimeout(function(){e.emit("stream",n)},0))})},r.prototype._debug=function(){var t=this,e=[].slice.call(arguments);e[0]="["+t._id+"] "+e[0],o.apply(null,e)},r.prototype._transformConstraints=function(t){var e=this;if(0===(0,G.default)(t).length)return t;if((t.mandatory||t.optional)&&!e._isChromium){var n=(0,F.default)({},t.optional,t.mandatory);return void 0!==n.OfferToReceiveVideo&&(n.offerToReceiveVideo=n.OfferToReceiveVideo,delete n["OfferToReceiveVideo"]),void 0!==n.OfferToReceiveAudio&&(n.offerToReceiveAudio=n.OfferToReceiveAudio,delete n["OfferToReceiveAudio"]),n}return t.mandatory||t.optional||!e._isChromium?t:(void 0!==t.offerToReceiveVideo&&(t.OfferToReceiveVideo=t.offerToReceiveVideo,delete t["offerToReceiveVideo"]),void 0!==t.offerToReceiveAudio&&(t.OfferToReceiveAudio=t.offerToReceiveAudio,delete t["offerToReceiveAudio"]),{mandatory:t})}}).call(this,t("buffer").Buffer)},{buffer:11,debug:43,"get-browser-rtc":14,inherits:16,randombytes:28,"readable-stream":37}],43:[function(t,e,n){(function(r){function i(t){return(i="function"==typeof N.default&&"symbol"===(0,H.default)(O.default)?function(t){return void 0===t?"undefined":(0,H.default)(t)}:function(t){return t&&"function"==typeof N.default&&t.constructor===N.default&&t!==N.default.prototype?"symbol":void 0===t?"undefined":(0,H.default)(t)})(t)}function a(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type&&!window.process.__nwjs)||("undefined"==typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))}function o(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),this.useColors){var n="color: "+this.color;t.splice(1,0,n,"color: inherit");var r=0,i=0;t[0].replace(/%[a-zA-Z%]/g,function(t){"%%"!==t&&(r++,"%c"===t&&(i=r))}),t.splice(i,0,n)}}function s(){var t;return"object"===("undefined"==typeof console?"undefined":i(console))&&console.log&&(t=console).log.apply(t,arguments)}function u(t){try{t?n.storage.setItem("debug",t):n.storage.removeItem("debug")}catch(e){}}function l(){var t;try{t=n.storage.getItem("debug")}catch(e){}return!t&&void 0!==r&&"env"in r&&(t=r.env.DEBUG),t}n.log=s,n.formatArgs=o,n.save=u,n.load=l,n.useColors=a,n.storage=function(){try{return localStorage}catch(t){}}(),n.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],e.exports=t("./common")(n),e.exports.formatters.j=function(t){try{return(0,j.default)(t)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}}).call(this,t("_process"))},{"./common":44,_process:23}],44:[function(t,e,n){arguments[4][8][0].apply(n,arguments)},{dup:8,ms:20}],45:[function(t,e,n){(function(n,r){function i(t){var e=this;if(!(e instanceof i))return new i(t);if(t||(t={}),"string"==typeof t&&(t={url:t}),null==t.url&&null==t.socket)throw new Error("Missing required `url` or `socket` option");if(null!=t.url&&null!=t.socket)throw new Error("Must specify either `url` or `socket` option, not both");if(e._id=s(4).toString("hex").slice(0,7),e._debug("new websocket: %o",t),t=(0,F.default)({allowHalfOpen:!1},t),u.Duplex.call(e,t),e.connected=!1,e.destroyed=!1,e._chunk=null,e._cb=null,e._interval=null,t.socket)e.url=t.socket.url,e._ws=t.socket;else{e.url=t.url;try{e._ws="function"==typeof l?new c(t.url,t):new c(t.url)}catch(r){return void n.nextTick(function(){e.destroy(r)})}}e._ws.binaryType="arraybuffer",e._ws.onopen=function(){e._onOpen()},e._ws.onmessage=function(t){e._onMessage(t)},e._ws.onclose=function(){e._onClose()},e._ws.onerror=function(){e.destroy(new Error("connection error to "+e.url))},e._onFinishBound=function(){e._onFinish()},e.once("finish",e._onFinishBound)}e.exports=i;var a=t("debug")("simple-websocket"),o=t("inherits"),s=t("randombytes"),u=t("readable-stream"),l=t("ws"),c="function"!=typeof l?WebSocket:l;o(i,u.Duplex),i.WEBSOCKET_SUPPORT=!!c,i.prototype.send=function(t){this._ws.send(t)},i.prototype.destroy=function(t){this._destroy(t,function(){})},i.prototype._destroy=function(t,e){var n=this;if(!n.destroyed){if(n._debug("destroy (error: %s)",t&&(t.message||t)),n.readable=n.writable=!1,n._readableState.ended||n.push(null),n._writableState.finished||n.end(),n.connected=!1,n.destroyed=!0,clearInterval(n._interval),n._interval=null,n._chunk=null,n._cb=null,n._onFinishBound&&n.removeListener("finish",n._onFinishBound),n._onFinishBound=null,n._ws){var r=n._ws,i=function(){r.onclose=null};if(r.readyState===c.CLOSED)i();else try{r.onclose=i,r.close()}catch(t){i()}r.onopen=null,r.onmessage=null,r.onerror=function(){}}if(n._ws=null,t){if("undefined"!=typeof DOMException&&t instanceof DOMException){var a=t.code;t=new Error(t.message),t.code=a}n.emit("error",t)}n.emit("close"),e()}},i.prototype._read=function(){},i.prototype._write=function(t,e,n){if(this.destroyed)return n(new Error("cannot write after socket is destroyed"));if(this.connected){try{this.send(t)}catch(r){return this.destroy(r)}"function"!=typeof l&&this._ws.bufferedAmount>65536?(this._debug("start backpressure: bufferedAmount %d",this._ws.bufferedAmount),this._cb=n):n(null)}else this._debug("write before connect"),this._chunk=t,this._cb=n},i.prototype._onFinish=function(){function t(){setTimeout(function(){e.destroy()},1e3)}var e=this;e.destroyed||(e.connected?t():e.once("connect",t))},i.prototype._onMessage=function(t){if(!this.destroyed){var e=t.data;e instanceof ArrayBuffer&&(e=r.from(e)),this.push(e)}},i.prototype._onOpen=function(){var t=this;if(!t.connected&&!t.destroyed){if(t.connected=!0,t._chunk){try{t.send(t._chunk)}catch(n){return t.destroy(n)}t._chunk=null,t._debug('sent chunk from "write before connect"');var e=t._cb;t._cb=null,e(null)}"function"!=typeof l&&(t._interval=setInterval(function(){t._onInterval()},150),t._interval.unref&&t._interval.unref()),t._debug("connect"),t.emit("connect")}},i.prototype._onInterval=function(){if(this._cb&&this._ws&&!(this._ws.bufferedAmount>65536)){this._debug("ending backpressure: bufferedAmount %d",this._ws.bufferedAmount);var t=this._cb;this._cb=null,t(null)}},i.prototype._onClose=function(){this.destroyed||(this._debug("on close"),this.destroy())},i.prototype._debug=function(){var t=[].slice.call(arguments);t[0]="["+this._id+"] "+t[0],a.apply(null,t)}}).call(this,t("_process"),t("buffer").Buffer)},{_process:23,buffer:11,debug:46,inherits:16,randombytes:28,"readable-stream":37,ws:9}],46:[function(t,e,n){(function(r){function i(t){return(i="function"==typeof N.default&&"symbol"===(0,H.default)(O.default)?function(t){return void 0===t?"undefined":(0,H.default)(t)}:function(t){return t&&"function"==typeof N.default&&t.constructor===N.default&&t!==N.default.prototype?"symbol":void 0===t?"undefined":(0,H.default)(t)})(t)}function a(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type&&!window.process.__nwjs)||("undefined"==typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))}function o(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),this.useColors){var n="color: "+this.color;t.splice(1,0,n,"color: inherit");var r=0,i=0;t[0].replace(/%[a-zA-Z%]/g,function(t){"%%"!==t&&(r++,"%c"===t&&(i=r))}),t.splice(i,0,n)}}function s(){var t;return"object"===("undefined"==typeof console?"undefined":i(console))&&console.log&&(t=console).log.apply(t,arguments)}function u(t){try{t?n.storage.setItem("debug",t):n.storage.removeItem("debug")}catch(e){}}function l(){var t;try{t=n.storage.getItem("debug")}catch(e){}return!t&&void 0!==r&&"env"in r&&(t=r.env.DEBUG),t}n.log=s,n.formatArgs=o,n.save=u,n.load=l,n.useColors=a,n.storage=function(){try{return localStorage}catch(t){}}(),n.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],e.exports=t("./common")(n),e.exports.formatters.j=function(t){try{return(0,j.default)(t)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}}).call(this,t("_process"))},{"./common":47,_process:23}],47:[function(t,e,n){arguments[4][8][0].apply(n,arguments)},{dup:8,ms:20}],48:[function(t,e,n){function r(t){if(!t)return"utf8";for(var e;;)switch(t){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return t;default:if(e)return;t=(""+t).toLowerCase(),e=!0}}function i(t){var e=r(t);if("string"!=typeof e&&(y.isEncoding===_||!_(t)))throw new Error("Unknown encoding: "+t);return e||t}function a(t){this.encoding=i(t);var e;switch(this.encoding){case"utf16le":this.text=h,this.end=f,e=4;break;case"utf8":this.fillLast=l,e=4;break;case"base64":this.text=p,this.end=m,e=3;break;default:return this.write=g,void(this.end=v)}this.lastNeed=0,this.lastTotal=0,this.lastChar=y.allocUnsafe(e)}function o(t){return t<=127?0:t>>5==6?2:t>>4==14?3:t>>3==30?4:t>>6==2?-1:-2}function s(t,e,n){var r=e.length-1;if(r<n)return 0;var i=o(e[r]);return i>=0?(i>0&&(t.lastNeed=i-1),i):--r<n||-2===i?0:(i=o(e[r]))>=0?(i>0&&(t.lastNeed=i-2),i):--r<n||-2===i?0:(i=o(e[r]),i>=0?(i>0&&(2===i?i=0:t.lastNeed=i-3),i):0)}function u(t,e,n){if(128!=(192&e[0]))return t.lastNeed=0,"";if(t.lastNeed>1&&e.length>1){if(128!=(192&e[1]))return t.lastNeed=1,"";if(t.lastNeed>2&&e.length>2&&128!=(192&e[2]))return t.lastNeed=2,""}}function l(t){var e=this.lastTotal-this.lastNeed,n=u(this,t,e);return void 0!==n?n:this.lastNeed<=t.length?(t.copy(this.lastChar,e,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(t.copy(this.lastChar,e,0,t.length),void(this.lastNeed-=t.length))}function c(t,e){var n=s(this,t,e);if(!this.lastNeed)return t.toString("utf8",e);this.lastTotal=n;var r=t.length-(n-this.lastNeed);return t.copy(this.lastChar,0,r),t.toString("utf8",e,r)}function d(t){var e=t&&t.length?this.write(t):"";return this.lastNeed?e+"":e}function h(t,e){if((t.length-e)%2==0){var n=t.toString("utf16le",e);if(n){var r=n.charCodeAt(n.length-1);if(r>=55296&&r<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=t[t.length-2],this.lastChar[1]=t[t.length-1],n.slice(0,-1)}return n}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=t[t.length-1],t.toString("utf16le",e,t.length-1)}function f(t){var e=t&&t.length?this.write(t):"";if(this.lastNeed){var n=this.lastTotal-this.lastNeed;return e+this.lastChar.toString("utf16le",0,n)}return e}function p(t,e){var n=(t.length-e)%3;return 0===n?t.toString("base64",e):(this.lastNeed=3-n,this.lastTotal=3,1===n?this.lastChar[0]=t[t.length-1]:(this.lastChar[0]=t[t.length-2],this.lastChar[1]=t[t.length-1]),t.toString("base64",e,t.length-n))}function m(t){var e=t&&t.length?this.write(t):"";return this.lastNeed?e+this.lastChar.toString("base64",0,3-this.lastNeed):e}function g(t){return t.toString(this.encoding)}function v(t){return t&&t.length?this.write(t):""}var y=t("safe-buffer").Buffer,_=y.isEncoding||function(t){switch((t=""+t)&&t.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};n.StringDecoder=a,a.prototype.write=function(t){if(0===t.length)return"";var e,n;if(this.lastNeed){if(void 0===(e=this.fillLast(t)))return"";n=this.lastNeed,this.lastNeed=0}else n=0;return n<t.length?e?e+this.text(t,n):this.text(t,n):e||""},a.prototype.end=d,a.prototype.text=c,a.prototype.fillLast=function(t){if(this.lastNeed<=t.length)return t.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);t.copy(this.lastChar,this.lastTotal-this.lastNeed,0,t.length),this.lastNeed-=t.length}},{"safe-buffer":39}],49:[function(t,e,n){(function(e,r){function i(t,e){this._id=t,this._clearFn=e}var a=t("process/browser.js").nextTick,o=Function.prototype.apply,s=Array.prototype.slice,u={},l=0;n.setTimeout=function(){return new i(o.call(setTimeout,window,arguments),clearTimeout)},n.setInterval=function(){return new i(o.call(setInterval,window,arguments),clearInterval)},n.clearTimeout=n.clearInterval=function(t){t.close()},i.prototype.unref=i.prototype.ref=function(){},i.prototype.close=function(){this._clearFn.call(window,this._id)},n.enroll=function(t,e){clearTimeout(t._idleTimeoutId),t._idleTimeout=e},n.unenroll=function(t){clearTimeout(t._idleTimeoutId),t._idleTimeout=-1},n._unrefActive=n.active=function(t){clearTimeout(t._idleTimeoutId);var e=t._idleTimeout;e>=0&&(t._idleTimeoutId=setTimeout(function(){t._onTimeout&&t._onTimeout()},e))},n.setImmediate="function"==typeof e?e:function(t){var e=l++,r=!(arguments.length<2)&&s.call(arguments,1);return u[e]=!0,a(function(){u[e]&&(r?t.apply(null,r):t.call(null),n.clearImmediate(e))}),e},n.clearImmediate="function"==typeof r?r:function(t){delete u[t]}}).call(this,t("timers").setImmediate,t("timers").clearImmediate)},{"process/browser.js":23,timers:49}],50:[function(t,e,n){function r(t,e){for(var n=1,r=t.length,i=t[0],a=t[0],o=1;o<r;++o)if(a=i,i=t[o],e(i,a)){if(o===n){n++;continue}t[n++]=i}return t.length=n,t}function i(t){for(var e=1,n=t.length,r=t[0],i=t[0],a=1;a<n;++a,i=r)if(i=r,(r=t[a])!==i){if(a===e){e++;continue}t[e++]=r}return t.length=e,t}function a(t,e,n){return 0===t.length?t:e?(n||t.sort(e),r(t,e)):(n||t.sort(),i(t))}e.exports=a},{}],51:[function(t,e,n){function r(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}function i(t,e,n){if(t&&l.isObject(t)&&t instanceof r)return t;var i=new r;return i.parse(t,e,n),i}function a(t){return l.isString(t)&&(t=i(t)),t instanceof r?t.format():r.prototype.format.call(t)}function o(t,e){return i(t,!1,!0).resolve(e)}function s(t,e){return t?i(t,!1,!0).resolveObject(e):e}var u=t("punycode"),l=t("./util");n.parse=i,n.resolve=o,n.resolveObject=s,n.format=a,n.Url=r;var c=/^([a-z0-9.+-]+:)/i,d=/:[0-9]*$/,h=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,f=["<",">",'"',"`"," ","\r","\n","\t"],p=["{","}","|","\\","^","`"].concat(f),m=["'"].concat(p),g=["%","/","?",";","#"].concat(m),v=["/","?","#"],y=/^[+a-z0-9A-Z_-]{0,63}$/,_=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,b={javascript:!0,"javascript:":!0},E={javascript:!0,"javascript:":!0},w={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},A=t("querystring");r.prototype.parse=function(t,e,n){if(!l.isString(t))throw new TypeError("Parameter 'url' must be a string, not "+(void 0===t?"undefined":(0,H.default)(t)));var r=t.indexOf("?"),i=-1!==r&&r<t.indexOf("#")?"?":"#",a=t.split(i),o=/\\/g;a[0]=a[0].replace(o,"/"),t=a.join(i);var s=t;if(s=s.trim(),!n&&1===t.split("#").length){var d=h.exec(s);if(d)return this.path=s,this.href=s,this.pathname=d[1],d[2]?(this.search=d[2],this.query=e?A.parse(this.search.substr(1)):this.search.substr(1)):e&&(this.search="",this.query={}),this}var f=c.exec(s);if(f){f=f[0];var p=f.toLowerCase();this.protocol=p,s=s.substr(f.length)}if(n||f||s.match(/^\/\/[^@\/]+@[^@\/]+/)){var S="//"===s.substr(0,2);!S||f&&E[f]||(s=s.substr(2),this.slashes=!0)}if(!E[f]&&(S||f&&!w[f])){for(var T=-1,x=0;x<v.length;x++){var k=s.indexOf(v[x]);-1!==k&&(-1===T||k<T)&&(T=k)}var C,M;M=-1===T?s.lastIndexOf("@"):s.lastIndexOf("@",T),-1!==M&&(C=s.slice(0,M),s=s.slice(M+1),this.auth=decodeURIComponent(C)),T=-1;for(var x=0;x<g.length;x++){var k=s.indexOf(g[x]);-1!==k&&(-1===T||k<T)&&(T=k)}-1===T&&(T=s.length),this.host=s.slice(0,T),s=s.slice(T),this.parseHost(),this.hostname=this.hostname||"";var R="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!R)for(var L=this.hostname.split(/\./),x=0,I=L.length;x<I;x++){var P=L[x];if(P&&!P.match(y)){for(var O="",D=0,N=P.length;D<N;D++)P.charCodeAt(D)>127?O+="x":O+=P[D];if(!O.match(y)){var U=L.slice(0,x),F=L.slice(x+1),B=P.match(_);B&&(U.push(B[1]),F.unshift(B[2])),F.length&&(s="/"+F.join(".")+s),this.hostname=U.join(".");break}}}this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),R||(this.hostname=u.toASCII(this.hostname));var j=this.port?":"+this.port:"",V=this.hostname||"";this.host=V+j,this.href+=this.host,R&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==s[0]&&(s="/"+s))}if(!b[p])for(var x=0,I=m.length;x<I;x++){var G=m[x];if(-1!==s.indexOf(G)){var z=encodeURIComponent(G);z===G&&(z=escape(G)),s=s.split(G).join(z)}}var K=s.indexOf("#");-1!==K&&(this.hash=s.substr(K),s=s.slice(0,K));var Y=s.indexOf("?");if(-1!==Y?(this.search=s.substr(Y),this.query=s.substr(Y+1),e&&(this.query=A.parse(this.query)),s=s.slice(0,Y)):e&&(this.search="",this.query={}),s&&(this.pathname=s),w[p]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var j=this.pathname||"",W=this.search||"";this.path=j+W}return this.href=this.format(),this},r.prototype.format=function(){var t=this.auth||"";t&&(t=encodeURIComponent(t),t=t.replace(/%3A/i,":"),t+="@");var e=this.protocol||"",n=this.pathname||"",r=this.hash||"",i=!1,a="";this.host?i=t+this.host:this.hostname&&(i=t+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(i+=":"+this.port)),this.query&&l.isObject(this.query)&&(0,G.default)(this.query).length&&(a=A.stringify(this.query));var o=this.search||a&&"?"+a||"";return e&&":"!==e.substr(-1)&&(e+=":"),this.slashes||(!e||w[e])&&!1!==i?(i="//"+(i||""),n&&"/"!==n.charAt(0)&&(n="/"+n)):i||(i=""),r&&"#"!==r.charAt(0)&&(r="#"+r),o&&"?"!==o.charAt(0)&&(o="?"+o),n=n.replace(/[?#]/g,function(t){return encodeURIComponent(t)}),o=o.replace("#","%23"),e+i+n+o+r},r.prototype.resolve=function(t){return this.resolveObject(i(t,!1,!0)).format()},r.prototype.resolveObject=function(t){if(l.isString(t)){var e=new r;e.parse(t,!1,!0),t=e}for(var n=new r,i=(0,G.default)(this),a=0;a<i.length;a++){var o=i[a];n[o]=this[o]}if(n.hash=t.hash,""===t.href)return n.href=n.format(),n;if(t.slashes&&!t.protocol){for(var s=(0,G.default)(t),u=0;u<s.length;u++){var c=s[u];"protocol"!==c&&(n[c]=t[c])}return w[n.protocol]&&n.hostname&&!n.pathname&&(n.path=n.pathname="/"),n.href=n.format(),n}if(t.protocol&&t.protocol!==n.protocol){if(!w[t.protocol]){for(var d=(0,G.default)(t),h=0;h<d.length;h++){var f=d[h];n[f]=t[f]}return n.href=n.format(),n}if(n.protocol=t.protocol,t.host||E[t.protocol])n.pathname=t.pathname;else{for(var p=(t.pathname||"").split("/");p.length&&!(t.host=p.shift()););t.host||(t.host=""),t.hostname||(t.hostname=""),""!==p[0]&&p.unshift(""),p.length<2&&p.unshift(""),n.pathname=p.join("/")}if(n.search=t.search,n.query=t.query,n.host=t.host||"",n.auth=t.auth,n.hostname=t.hostname||t.host,n.port=t.port,n.pathname||n.search){var m=n.pathname||"",g=n.search||"";n.path=m+g}return n.slashes=n.slashes||t.slashes,n.href=n.format(),n}var v=n.pathname&&"/"===n.pathname.charAt(0),y=t.host||t.pathname&&"/"===t.pathname.charAt(0),_=y||v||n.host&&t.pathname,b=_,A=n.pathname&&n.pathname.split("/")||[],p=t.pathname&&t.pathname.split("/")||[],S=n.protocol&&!w[n.protocol];if(S&&(n.hostname="",n.port=null,n.host&&(""===A[0]?A[0]=n.host:A.unshift(n.host)),n.host="",t.protocol&&(t.hostname=null,t.port=null,t.host&&(""===p[0]?p[0]=t.host:p.unshift(t.host)),t.host=null),_=_&&(""===p[0]||""===A[0])),y)n.host=t.host||""===t.host?t.host:n.host,n.hostname=t.hostname||""===t.hostname?t.hostname:n.hostname,n.search=t.search,n.query=t.query,A=p;else if(p.length)A||(A=[]),A.pop(),A=A.concat(p),n.search=t.search,n.query=t.query;else if(!l.isNullOrUndefined(t.search)){if(S){n.hostname=n.host=A.shift();var T=!!(n.host&&n.host.indexOf("@")>0)&&n.host.split("@");T&&(n.auth=T.shift(),n.host=n.hostname=T.shift())}return n.search=t.search,n.query=t.query,l.isNull(n.pathname)&&l.isNull(n.search)||(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.href=n.format(),n}if(!A.length)return n.pathname=null,n.search?n.path="/"+n.search:n.path=null,n.href=n.format(),n;for(var x=A.slice(-1)[0],k=(n.host||t.host||A.length>1)&&("."===x||".."===x)||""===x,C=0,M=A.length;M>=0;M--)x=A[M],"."===x?A.splice(M,1):".."===x?(A.splice(M,1),C++):C&&(A.splice(M,1),C--);if(!_&&!b)for(;C--;C)A.unshift("..");!_||""===A[0]||A[0]&&"/"===A[0].charAt(0)||A.unshift(""),k&&"/"!==A.join("/").substr(-1)&&A.push("");var R=""===A[0]||A[0]&&"/"===A[0].charAt(0);if(S){n.hostname=n.host=R?"":A.length?A.shift():"";var T=!!(n.host&&n.host.indexOf("@")>0)&&n.host.split("@");T&&(n.auth=T.shift(),n.host=n.hostname=T.shift())}return _=_||n.host&&A.length,_&&!R&&A.unshift(""),A.length?n.pathname=A.join("/"):(n.pathname=null,n.path=null),l.isNull(n.pathname)&&l.isNull(n.search)||(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.auth=t.auth||n.auth,n.slashes=n.slashes||t.slashes,n.href=n.format(),n},r.prototype.parseHost=function(){var t=this.host,e=d.exec(t);e&&(e=e[0],":"!==e&&(this.port=e.substr(1)),t=t.substr(0,t.length-e.length)),t&&(this.hostname=t)}},{"./util":52,punycode:24,querystring:27}],52:[function(t,e,n){e.exports={isString:function(t){return"string"==typeof t},isObject:function(t){return"object"===(void 0===t?"undefined":(0,H.default)(t))&&null!==t},isNull:function(t){return null===t},isNullOrUndefined:function(t){return null==t}}},{}],53:[function(t,e,n){(function(t){function n(t,e){function n(){if(!i){if(r("throwDeprecation"))throw new Error(e);r("traceDeprecation")?console.trace(e):console.warn(e),i=!0}return t.apply(this,arguments)}if(r("noDeprecation"))return t;var i=!1;return n}function r(e){try{if(!t.localStorage)return!1}catch(r){return!1}var n=t.localStorage[e];return null!=n&&"true"===String(n).toLowerCase()}e.exports=n}).call(this,void 0!==r?r:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],54:[function(t,e,n){function r(t,e){function n(){for(var e=new Array(arguments.length),n=0;n<e.length;n++)e[n]=arguments[n];var r=t.apply(this,e),i=e[e.length-1];return"function"==typeof r&&r!==i&&(0,G.default)(i).forEach(function(t){r[t]=i[t]}),r}if(t&&e)return r(t)(e);if("function"!=typeof t)throw new TypeError("need wrapper function");return(0,G.default)(t).forEach(function(e){n[e]=t[e]}),n}e.exports=r},{}],55:[function(t,e,n){function r(){for(var t={},e=0;e<arguments.length;e++){var n=arguments[e];for(var r in n)i.call(n,r)&&(t[r]=n[r])}return t}e.exports=r;var i=Object.prototype.hasOwnProperty},{}],56:[function(t,e,n){function r(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)i.call(n,r)&&(t[r]=n[r])}return t}e.exports=r;var i=Object.prototype.hasOwnProperty},{}],57:[function(t,e,n){e.exports=t("./main.js").default},{"./main.js":58}],58:[function(t,e,n){function r(t){return t&&t.__esModule?t:{default:t}}function i(t){return new l.default(t)}function a(){return l.default.isSupported()}Object.defineProperty(n,"__esModule",{value:!0});var o=t("./utils/polyfill"),s=r(o),u=t("./p2phls/engine"),l=r(u),c=t("./p2ploader/loader-interface");s.default.install();var d={};d.createEngine=i,d.isSupported=a,d.Events=c.Events,Object.defineProperty(d,"version",{enumerable:!0,get:function(){return"1.0.0"}}),n.default=d},{"./p2phls/engine":59,"./p2ploader/loader-interface":66,"./utils/polyfill":71}],59:[function(t,e,n){function r(t){return t&&t.__esModule?t:{default:t}}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==(void 0===e?"undefined":(0,H.default)(e))&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+(void 0===e?"undefined":(0,H.default)(e)));t.prototype=(0,C.default)(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(x.default?(0,x.default)(t,e):t.__proto__=e)}Object.defineProperty(n,"__esModule",{value:!0});var s=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),(0,R.default)(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),u=t("events"),l=r(u),c=t("../p2ploader/loader-interface"),d=t("../p2ploader/hybrid-loader"),h=r(d),f=t("./segment-manager"),p=r(f),m=t("./hlsjs-loader"),g=r(m),v=t("./hlsjs-loader-class"),y=function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i(this,e);var n=a(this,(e.__proto__||(0,S.default)(e)).call(this));return n.loader=new h.default(t),n.segmentManager=new p.default(n.loader,t.segments),(0,G.default)(c.Events).map(function(t){return c.Events[t]}).forEach(function(t){return n.loader.on(t,function(){for(var e=arguments.length,r=Array(e),i=0;i<e;i++)r[i]=arguments[i];return n.emit.apply(n,[t].concat(r))})}),n}return o(e,t),s(e,null,[{key:"isSupported",value:function(){return h.default.isSupported()}}]),s(e,[{key:"createLoaderClass",value:function(){return v.createHlsJsLoaderClass(g.default,this)}},{key:"destroy",value:function(){this.loader.destroy(),this.segmentManager.destroy()}},{key:"getSettings",value:function(){return{segments:this.segmentManager.getSettings(),loader:this.loader.getSettings()}}},{key:"getDetails",value:function(){return{loader:this.loader.getDetails()}}},{key:"setPlayingSegment",value:function(t,e,n,r){this.segmentManager.setPlayingSegment(t,e,n,r)}},{key:"setPlayingSegmentByCurrentTime",value:function(t){this.segmentManager.setPlayingSegmentByCurrentTime(t)}}]),e}(l.default);n.default=y},{"../p2ploader/hybrid-loader":65,"../p2ploader/loader-interface":66,"./hlsjs-loader":61,"./hlsjs-loader-class":60,"./segment-manager":62,events:10}],60:[function(t,e,n){function r(t,e){function n(){this.impl=new t(e.segmentManager),this.stats=this.impl.stats}return n.prototype.load=function(t,e,n){this.context=t,this.impl.load(t,e,n)},n.prototype.abort=function(){this.impl.abort(this.context)},n.prototype.destroy=function(){this.context&&this.impl.abort(this.context)},n.getEngine=function(){return e},n}e.exports.createHlsJsLoaderClass=r},{}],61:[function(t,e,n){function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),(0,R.default)(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),a=function(){function t(e){r(this,t),this.stats={},this.segmentManager=e}return i(t,[{key:"load",value:function(t,e,n){var r=this;if(t.type)try{this.segmentManager.loadPlaylist(t.url).then(function(e){r.successPlaylist(e,t,n)}).catch(function(e){return r.error(e,t,n)})}catch(i){this.error(i,t,n)}else if(t.frag)try{this.segmentManager.loadSegment(t.url,void 0==t.rangeStart||void 0==t.rangeEnd?void 0:{offset:t.rangeStart,length:t.rangeEnd-t.rangeStart},function(e,i){return setTimeout(function(){return r.successSegment(e,i,t,n)},0)},function(e){return setTimeout(function(){return r.error(e,t,n)},0)})}catch(i){setTimeout(function(){return r.error(i,t,n)},0)}else console.warn("Unknown load request",t)}},{key:"abort",value:function(t){this.segmentManager.abortSegment(t.url,void 0==t.rangeStart||void 0==t.rangeEnd?void 0:{offset:t.rangeStart,length:t.rangeEnd-t.rangeStart})}},{key:"successPlaylist",value:function(t,e,n){var r=performance.now();this.stats.trequest=r-300,this.stats.tfirst=r-200,this.stats.tload=r,this.stats.loaded=t.response.length,n.onSuccess({url:t.responseURL,data:t.response},this.stats,e)}},{key:"successSegment",value:function(t,e,n,r){var i=performance.now();if(void 0!==t&&void 0!==t.byteLength){var a=t.byteLength/(e<=0?12500:e);this.stats.trequest=i-1-a,this.stats.tfirst=i-a,this.stats.tload=i,this.stats.loaded=t.byteLength,r.onSuccess({url:n.url,data:t},this.stats,n)}}},{key:"error",value:function(t,e,n){n.onError(t,e)}}]),t}();n.default=a},{}],62:[function(t,e,n){function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function t(t,e){var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=(0,y.default)(t);!(r=(o=s.next()).done)&&(n.push(o.value),!e||n.length!==e);r=!0);}catch(u){i=!0,a=u}finally{try{!r&&s["return"]&&s["return"]()}finally{if(i)throw a}}return n}return function(e,n){if(Array.isArray(e))return e;if((0,g.default)(Object(e)))return t(e,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),a=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),(0,R.default)(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=t("../p2ploader/loader-interface"),s=t("m3u8-parser"),u={forwardSegmentCount:20,swarmId:void 0,assetsStorage:void 0},l=function(){function t(e,n,i){r(this,t),this.requestUrl=e,this.responseUrl=n,this.manifest=i,this.streamSwarmId=""}return a(t,[{key:"getSegmentIndex",value:function(t,e){for(var n=0;n<this.manifest.segments.length;++n){var r=this.manifest.segments[n];if(t===this.getSegmentAbsoluteUrl(r.uri)&&this.compareByterange(r.byterange,e))return n}return-1}},{key:"getSegmentAbsoluteUrl",value:function(t){return new URL(t,this.responseUrl).toString()}},{key:"compareByterange",value:function(t,e){return void 0===t?void 0===e:void 0!==e&&t.length===e.length&&t.offset===e.offset}},{key:"byterangeToString",value:function(t){if(void 0!==t){var e=t.offset+t.length-1;return"bytes="+t.offset+"-"+e}}}]),t}(),c=function f(t,e,n,i,a,o){r(this,f),this.segmentUrl=t,this.segmentByterange=e,this.segmentSequence=n,this.playlistRequestUrl=i,this.onSuccess=a,this.onError=o},d=function(){function t(e){var n=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};r(this,t),this.masterPlaylist=null,this.variantPlaylists=new p.default,this.segmentRequest=null,this.playQueue=[],this.onSegmentLoaded=function(t){n.segmentRequest&&n.segmentRequest.segmentUrl===t.url&&n.byterangeToString(n.segmentRequest.segmentByterange)===t.range&&(n.segmentRequest.onSuccess(t.data.slice(0),t.downloadBandwidth),n.segmentRequest=null)},this.onSegmentError=function(t,e){n.segmentRequest&&n.segmentRequest.segmentUrl===t.url&&n.byterangeToString(n.segmentRequest.segmentByterange)===t.range&&(n.segmentRequest.onError(e),n.segmentRequest=null)},this.onSegmentAbort=function(t){n.segmentRequest&&n.segmentRequest.segmentUrl===t.url&&n.byterangeToString(n.segmentRequest.segmentByterange)===t.range&&(n.segmentRequest.onError("Loading aborted: internal abort"),n.segmentRequest=null)},this.settings=(0,F.default)(u,i),this.loader=e,this.loader.on(o.Events.SegmentLoaded,this.onSegmentLoaded),this.loader.on(o.Events.SegmentError,this.onSegmentError),this.loader.on(o.Events.SegmentAbort,this.onSegmentAbort)}return a(t,[{key:"getSettings",value:function(){return this.settings}},{key:"processPlaylist",value:function(t,e,n){var r=new s.Parser;r.push(e),r.end();var a=new l(t,n,r.manifest);if(a.manifest.playlists){this.masterPlaylist=a;var o=!0,u=!1,c=void 0;try{for(var d,h=(0,y.default)(this.variantPlaylists);!(o=(d=h.next()).done);o=!0){var f=i(d.value,2),p=f[0],m=f[1],g=this.getStreamSwarmId(m.requestUrl),v=g.streamSwarmId,_=g.found,b=g.index;_?(m.streamSwarmId=v,m.streamId="V"+b.toString()):this.variantPlaylists.delete(p)}}catch(w){u=!0,c=w}finally{try{!o&&h.return&&h.return()}finally{if(u)throw c}}}else{var E=this.getStreamSwarmId(t),v=E.streamSwarmId,_=E.found,b=E.index;(_||null===this.masterPlaylist)&&(a.streamSwarmId=v,a.streamId=null===this.masterPlaylist?void 0:"V"+b.toString(),this.variantPlaylists.set(t,a),this.updateSegments())}}},{key:"loadPlaylist",value:function(t){var e=this,n=this.settings.assetsStorage,r=void 0;if(void 0!==n){var i=void 0;i=this.getMasterSwarmId(),void 0===i&&(i=t.split("?")[0]);var a=n.getAsset(t,void 0,i);void 0!==a?r={responseURL:a.responseUri,response:a.data}:(r=this.loadContent(t,"text"),r.then(function(r){n.storeAsset({masterManifestUri:null!==e.masterPlaylist?e.masterPlaylist.requestUrl:t,masterSwarmId:i,requestUri:t,responseUri:r.responseURL,data:r.response}),e.processPlaylist(t,r.response,r.responseURL)}))}else r=this.loadContent(t,"text"),r.then(function(n){e.processPlaylist(t,n.response,n.responseURL)});return r}},{key:"loadSegment",value:function(t,e,n,r){var i=this.getSegmentLocation(t,e),a=this.byterangeToString(e);if(i){var o=(i.playlist.manifest.mediaSequence?i.playlist.manifest.mediaSequence:0)+i.segmentIndex;if(this.playQueue.length>0){this.playQueue[this.playQueue.length-1].segmentSequence!==o-1&&(this.playQueue=[])}this.segmentRequest&&this.segmentRequest.onError("Cancel segment request: simultaneous segment requests are not supported"),this.segmentRequest=new c(t,e,o,i.playlist.requestUrl,n,r),this.playQueue.push({segmentUrl:t,segmentByterange:e,segmentSequence:o}),this.loadSegments(i.playlist,i.segmentIndex,!0)}else{var s=void 0,u=this.settings.assetsStorage;if(void 0!==u){var l=null!==this.masterPlaylist?this.masterPlaylist.requestUrl:void 0,d=void 0;if(d=this.getMasterSwarmId(),void 0===d&&1===this.variantPlaylists.size&&(d=this.variantPlaylists.values().next().value.requestUrl.split("?")[0]),void 0===l&&1===this.variantPlaylists.size&&(l=this.variantPlaylists.values().next().value.requestUrl),void 0!==d&&void 0!==l){var h=u.getAsset(t,a,d);if(void 0!==h)s=h.data;else{this.loadContent(t,"arraybuffer",a).then(function(e){s=e.response,u.storeAsset({masterManifestUri:l,masterSwarmId:d,requestUri:t,requestRange:a,responseUri:e.responseURL,data:s}),n(s,0)}).catch(function(t){return r(t)})}}}if(void 0===s){this.loadContent(t,"arraybuffer",a).then(function(t){s=t.response,n(s,0)}).catch(function(t){return r(t)})}}}},{key:"setPlayingSegment",value:function(t,e,n,r){var i=this,a=this.playQueue.findIndex(function(n){return n.segmentUrl==t&&i.compareByterange(n.segmentByterange,e)});a>=0&&(this.playQueue=this.playQueue.slice(a),this.playQueue[0].playPosition={start:n,duration:r},this.updateSegments())}},{key:"setPlayingSegmentByCurrentTime",value:function(t){if(0!==this.playQueue.length&&this.playQueue[0].playPosition){var e=this.playQueue[0].playPosition;e.start+e.duration-t<.2&&(this.playQueue=this.playQueue.slice(1),this.updateSegments())}}},{key:"abortSegment",value:function(t,e){this.segmentRequest&&this.segmentRequest.segmentUrl===t&&this.compareByterange(this.segmentRequest.segmentByterange,e)&&(this.segmentRequest.onSuccess(void 0,0),this.segmentRequest=null)}},{key:"destroy",value:function(){this.segmentRequest&&(this.segmentRequest.onError("Loading aborted: object destroyed"),this.segmentRequest=null),this.masterPlaylist=null,this.variantPlaylists.clear(),this.playQueue=[],void 0!==this.settings.assetsStorage&&this.settings.assetsStorage.destroy(),this.loader.destroy()}},{key:"updateSegments",value:function(){if(this.segmentRequest){var t=this.getSegmentLocation(this.segmentRequest.segmentUrl,this.segmentRequest.segmentByterange);t&&this.loadSegments(t.playlist,t.segmentIndex,!1)}}},{key:"getSegmentLocation",value:function(t,e){var n=!0,r=!1,i=void 0;try{for(var a,o=(0,y.default)(this.variantPlaylists.values());!(n=(a=o.next()).done);n=!0){var s=a.value,u=s.getSegmentIndex(t,e);if(u>=0)return{playlist:s,segmentIndex:u}}}catch(l){r=!0,i=l}finally{try{!n&&o.return&&o.return()}finally{if(r)throw i}}}},{key:"loadSegments",value:function(t,e,n){var r=[],i=t.manifest.segments;t.manifest.endList&&(this.settings.forwardSegmentCount=50);for(var a=t.manifest.mediaSequence?t.manifest.mediaSequence:0,s=null,u=Math.max(0,this.playQueue.length-1),l=this.getMasterSwarmId(),c=e;c<i.length&&r.length<this.settings.forwardSegmentCount;++c){var d=t.manifest.segments[c],h=t.getSegmentAbsoluteUrl(d.uri),f=d.byterange,p=this.getSegmentId(t,a+c);r.push(new o.Segment(p,h,void 0!==l?l:t.streamSwarmId,null!==this.masterPlaylist?this.masterPlaylist.requestUrl:t.requestUrl,t.streamId,(a+c).toString(),this.byterangeToString(f),u++)),n&&!s&&(s=p)}if(this.loader.load(r,t.streamSwarmId),s){var m=this.loader.getSegment(s);m&&this.onSegmentLoaded(m)}}},{key:"getSegmentId",value:function(t,e){return t.streamSwarmId+"+"+e}},{key:"getMasterSwarmId",value:function(){var t=this.settings.swarmId&&0!==this.settings.swarmId.length?this.settings.swarmId:void 0;return void 0!==t?t:null!==this.masterPlaylist?this.masterPlaylist.requestUrl.split("?")[0]:void 0}},{key:"getStreamSwarmId",value:function(t){var e=this.getMasterSwarmId();if(null!==this.masterPlaylist)for(var n=0;n<this.masterPlaylist.manifest.playlists.length;++n){var r=new URL(this.masterPlaylist.manifest.playlists[n].uri,this.masterPlaylist.responseUrl).toString();if(r===t)return{streamSwarmId:e+"+V"+n,found:!0,index:n}}return{streamSwarmId:void 0!==e?e:t.split("?")[0],found:!1,index:-1}}},{key:"loadContent",value:function(t,e,n){var r=this;return new h.default(function(i,a){var o=new XMLHttpRequest;o.open("GET",t,!0),o.responseType=e,n&&o.setRequestHeader("Range",n),o.addEventListener("readystatechange",function(){4===o.readyState&&(o.status>=200&&o.status<300?i(o):a(o.statusText))});var s=r.loader.getSettings().xhrSetup;s&&s(o,t),o.send()})}},{key:"compareByterange",value:function(t,e){return void 0===t?void 0===e:void 0!==e&&t.length===e.length&&t.offset===e.offset}},{key:"byterangeToString",value:function(t){if(void 0!==t){var e=t.offset+t.length-1;return"bytes="+t.offset+"-"+e}}}]),t}();n.default=d},{"../p2ploader/loader-interface":66,"m3u8-parser":19}],63:[function(t,e,n){function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),(0,R.default)(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),a=function s(t,e){r(this,s),this.value=t,this.timeStamp=e},o=function(){function t(){r(this,t),this.lastBytes=[],this.currentBytesSum=0,this.lastBandwidth=[]}return i(t,[{key:"addBytes",value:function(t,e){for(this.lastBytes.push(new a(t,e)),this.currentBytesSum+=t;e-this.lastBytes[0].timeStamp>1e3;)this.currentBytesSum-=this.lastBytes.shift().value;this.lastBandwidth.push(new a(this.currentBytesSum/1e3,e))}},{key:"getBandwidth",value:function(t){for(;0!=this.lastBandwidth.length&&t-this.lastBandwidth[0].timeStamp>6e4;)this.lastBandwidth.shift();var e=0,n=!0,r=!1,i=void 0;try{for(var a,o=(0,y.default)(this.lastBandwidth);!(n=(a=o.next()).done);n=!0){var s=a.value;s.value>e&&(e=s.value)}}catch(u){r=!0,i=u}finally{try{!n&&o.return&&o.return()}finally{if(r)throw i}}return e}},{key:"getSmoothInterval",value:function(){return 1e3}},{key:"getMeasureInterval",value:function(){return 6e4}}]),t}();n.default=o},{}],64:[function(t,e,n){function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==(void 0===e?"undefined":(0,H.default)(e))&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+(void 0===e?"undefined":(0,H.default)(e)));t.prototype=(0,C.default)(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(x.default?(0,x.default)(t,e):t.__proto__=e)}Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),(0,R.default)(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),s=t("./stringly-typed-event-emitter"),u=function(t){return t&&t.__esModule?t:{default:t}}(s),l=t("../p2ploader/loader-interface"),c=function(t){function e(t){r(this,e);var n=i(this,(e.__proto__||(0,S.default)(e)).call(this));return n.settings=t,n.xhrRequests=new p.default,n.failedSegments=new p.default,n.now=function(){return performance.now()},n}return a(e,t),o(e,[{key:"download",value:function(t,e){if(!this.isDownloading(t)){this.cleanTimedOutFailedSegments();var n=this.settings.segmentUrlBuilder?this.settings.segmentUrlBuilder(t):t.url,r=new XMLHttpRequest;if(r.open("GET",n,!0),r.responseType="arraybuffer",t.range)r.setRequestHeader("Range",t.range),e=void 0;else if(void 0!==e&&this.settings.httpUseRanges){var i=0,a=!0,o=!1,s=void 0;try{for(var u,l=(0,y.default)(e);!(a=(u=l.next()).done);a=!0){var c=u.value;i+=c.byteLength}}catch(d){o=!0,s=d}finally{try{!a&&l.return&&l.return()}finally{if(o)throw s}}r.setRequestHeader("Range","bytes="+i+"-")}else e=void 0;this.setupXhrEvents(r,t,e),this.settings.xhrSetup&&this.settings.xhrSetup(r,n),this.xhrRequests.set(t.id,{xhr:r,segment:t}),r.send()}}},{key:"abort",value:function(t){var e=this.xhrRequests.get(t.id);e&&(e.xhr.abort(),this.xhrRequests.delete(t.id))}},{key:"isDownloading",value:function(t){return this.xhrRequests.has(t.id)}},{key:"isFailed",value:function(t){var e=this.failedSegments.get(t.id);return void 0!==e&&e>this.now()}},{key:"getActiveDownloads",value:function(){return this.xhrRequests}},{key:"getActiveDownloadsCount",value:function(){return this.xhrRequests.size}},{key:"destroy",value:function(){this.xhrRequests.forEach(function(t){return t.xhr.abort()}),this.xhrRequests.clear()}},{key:"setupXhrEvents",value:function(t,e,n){var r=this,i=0;t.addEventListener("progress",function(t){var e=t.loaded-i;r.emit("bytes-downloaded",e),i=t.loaded}),t.addEventListener("load",function(t){if(t.target.status<200||t.target.status>=300)return void r.segmentFailure(e,t);var i=t.target.response;if(void 0!==n&&206===t.target.status){var a=0,o=!0,s=!1,u=void 0;try{for(var l,c=(0,y.default)(n);!(o=(l=c.next()).done);o=!0){a+=l.value.byteLength}}catch(b){s=!0,u=b}finally{try{!o&&c.return&&c.return()}finally{if(s)throw u}}var d=new Uint8Array(a+i.byteLength),h=0,f=!0,p=!1,m=void 0;try{for(var g,v=(0,y.default)(n);!(f=(g=v.next()).done);f=!0){var _=g.value;d.set(new Uint8Array(_),h),h+=_.byteLength}}catch(b){p=!0,m=b}finally{try{!f&&v.return&&v.return()}finally{if(p)throw m}}d.set(new Uint8Array(i),h),i=d.buffer}r.segmentDownloadFinished(e,i)}),t.addEventListener("error",function(t){r.segmentFailure(e,t)}),t.addEventListener("timeout",function(t){r.segmentFailure(e,t)})}},{key:"segmentDownloadFinished",value:function(t,e){if(this.settings.segmentValidator)try{this.settings.segmentValidator(new l.Segment(t.id,t.url,t.masterSwarmId,t.masterManifestUri,t.streamId,t.sequence,t.range,t.priority,e),"http")}catch(n){return void this.segmentFailure(t,n)}this.xhrRequests.delete(t.id),this.emit("segment-loaded",t,e)}},{key:"segmentFailure",value:function(t,e){this.xhrRequests.delete(t.id),this.failedSegments.set(t.id,this.now()+this.settings.httpFailedSegmentTimeout),this.emit("segment-error",t,e)}},{key:"cleanTimedOutFailedSegments",value:function(){var t=this,e=this.now(),n=[];this.failedSegments.forEach(function(t,r){t<e&&n.push(r)}),n.forEach(function(e){return t.failedSegments.delete(e)})}}]),e}(u.default);n.default=c},{"../p2ploader/loader-interface":66,"./stringly-typed-event-emitter":70}],65:[function(t,e,n){function r(t){return t&&t.__esModule?t:{default:t}}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==(void 0===e?"undefined":(0,H.default)(e))&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+(void 0===e?"undefined":(0,H.default)(e)));t.prototype=(0,C.default)(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(x.default?(0,x.default)(t,e):t.__proto__=e)}Object.defineProperty(n,"__esModule",{value:!0});var s=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),(0,R.default)(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),u=t("./loader-interface"),l=t("events"),c=r(l),d=t("./http-media-manager"),h=r(d),f=t("./p2p-media-manager"),p=r(f),m=t("./media-peer"),g=r(m),v=t("./bandwidth-approximator"),_=r(v),b=t("./segments-memory-storage"),E=r(b),w=t("get-browser-rtc"),A=r(w),T=t("simple-peer"),k=r(T),M={cachedSegmentExpiration:3e5,cachedSegmentsCount:30,useP2P:!0,consumeOnly:!1,requiredSegmentsPriority:1,simultaneousHttpDownloads:2,httpDownloadProbability:.1,httpDownloadProbabilityInterval:1e3,httpDownloadProbabilitySkipIfNoPeers:!1,httpFailedSegmentTimeout:1e4,httpDownloadMaxPriority:20,httpDownloadInitialTimeout:0,httpDownloadInitialTimeoutPerSegment:4e3,httpUseRanges:!1,simultaneousP2PDownloads:3,p2pDownloadMaxPriority:20,p2pSegmentDownloadTimeout:6e4,webRtcMaxMessageSize:65535,trackerAnnounce:["wss://tracker.novage.com.ua","wss://tracker.openwebtorrent.com"],peerRequestsPerAnnounce:10,rtcConfig:k.default.config},L={cachedSegmentExpiration:864e5,cachedSegmentsCount:1e3,useP2P:!0,consumeOnly:!1,requiredSegmentsPriority:2,httpDownloadProbabilitySkipIfNoPeers:!0,httpFailedSegmentTimeout:1e3,httpDownloadMaxPriority:9,httpDownloadProbability:.06,httpDownloadProbabilityInterval:1e3,httpDownloadInitialTimeout:12e4,httpDownloadInitialTimeoutPerSegment:17e3,httpUseRanges:!0,simultaneousP2PDownloads:20,p2pDownloadMaxPriority:50,simultaneousHttpDownloads:2,p2pSegmentDownloadTimeout:6e4,webRtcMaxMessageSize:65535,trackerAnnounce:["wss://tracker.novage.com.ua","wss://tracker.openwebtorrent.com"],peerRequestsPerAnnounce:10,rtcConfig:k.default.config},I=function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i(this,e);var n=a(this,(e.__proto__||(0,S.default)(e)).call(this));return n.segmentsQueue=[],n.bandwidthApproximator=new _.default,n.httpDownloadInitialTimeoutTimestamp=-1/0,n.processInitialSegmentTimeout=function(){if(void 0!==n.httpRandomDownloadInterval){if(void 0!==n.masterSwarmId){var t=n.segmentsStorage.getSegmentsMap(n.masterSwarmId);n.processSegmentsQueue(t)&&!n.settings.consumeOnly&&n.p2pManager.sendSegmentsMapToAll(n.createSegmentsMap(t))}n.httpDownloadInitialTimeoutTimestamp!==-1/0&&setTimeout(n.processInitialSegmentTimeout,n.settings.httpDownloadInitialTimeoutPerSegment)}},n.downloadRandomSegmentOverHttp=function(){if(!(void 0===n.masterSwarmId||void 0===n.httpRandomDownloadInterval||n.httpDownloadInitialTimeoutTimestamp!==-1/0||n.httpManager.getActiveDownloadsCount()>=n.settings.simultaneousHttpDownloads||n.settings.httpDownloadProbabilitySkipIfNoPeers&&0===n.p2pManager.getPeers().size||n.settings.consumeOnly)){var t=n.segmentsStorage.getSegmentsMap(n.masterSwarmId),e=n.p2pManager.getOvrallSegmentsMap(),r=n.segmentsQueue.filter(function(r){return!n.p2pManager.isDownloading(r)&&!n.httpManager.isDownloading(r)&&!e.has(r.id)&&!n.httpManager.isFailed(r)&&r.priority<=n.settings.httpDownloadMaxPriority&&!t.has(r.id)});if(0!=r.length&&!(Math.random()>n.settings.httpDownloadProbability*r.length)){var i=r[Math.floor(Math.random()*r.length)];n.httpManager.download(i),n.p2pManager.sendSegmentsMapToAll(n.createSegmentsMap(t))}}},n.onPieceBytesDownloaded=function(t,e,r){n.bandwidthApproximator.addBytes(e,n.now()),n.emit(u.Events.PieceBytesDownloaded,t,e,r)},n.onPieceBytesUploaded=function(t,e,r){n.emit(u.Events.PieceBytesUploaded,t,e,r)},n.onSegmentLoaded=function(t,e,r){if(void 0!==n.masterSwarmId){t.data=e,t.downloadBandwidth=n.bandwidthApproximator.getBandwidth(n.now()),n.segmentsStorage.storeSegment(t),n.emit(u.Events.SegmentLoaded,t,r);var i=void 0;i=void 0===i?n.segmentsStorage.getSegmentsMap(n.masterSwarmId):i,n.processSegmentsQueue(i),n.settings.consumeOnly||n.p2pManager.sendSegmentsMapToAll(n.createSegmentsMap(i))}},n.onSegmentError=function(t,e,r){if(n.emit(u.Events.SegmentError,t,e,r),void 0!==n.masterSwarmId){var i=n.segmentsStorage.getSegmentsMap(n.masterSwarmId);n.processSegmentsQueue(i)&&!n.settings.consumeOnly&&n.p2pManager.sendSegmentsMapToAll(n.createSegmentsMap(i))}},n.onPeerConnect=function(t){n.emit(u.Events.PeerConnect,t),n.settings.consumeOnly||void 0===n.masterSwarmId||n.p2pManager.sendSegmentsMap(t.id,n.createSegmentsMap(n.segmentsStorage.getSegmentsMap(n.masterSwarmId)))},n.onPeerClose=function(t){n.emit(u.Events.PeerClose,t)},n.onTrackerUpdate=function(t){if(n.httpDownloadInitialTimeoutTimestamp!==-1/0&&void 0!==t.incomplete&&t.incomplete<=1&&(n.httpDownloadInitialTimeoutTimestamp=-1/0,void 0!==n.masterSwarmId)){var e=n.segmentsStorage.getSegmentsMap(n.masterSwarmId);n.processSegmentsQueue(e)&&!n.settings.consumeOnly&&n.p2pManager.sendSegmentsMapToAll(n.createSegmentsMap(e))}},"LIVE"===t.playbacktype?n.settings=(0,F.default)({},M,t):(n.settings=(0,F.default)({},L,t),console.log("Assign settings to VOD")),t.bufferedSegmentsCount&&(void 0===t.p2pDownloadMaxPriority&&(n.settings.p2pDownloadMaxPriority=t.bufferedSegmentsCount),void 0===t.httpDownloadMaxPriority&&(n.settings.httpDownloadMaxPriority=t.bufferedSegmentsCount),delete n.settings.bufferedSegmentsCount),n.segmentsStorage=void 0===n.settings.segmentsStorage?new E.default(n.settings):n.settings.segmentsStorage,n.httpManager=n.createHttpManager(),n.httpManager.on("segment-loaded",n.onSegmentLoaded),n.httpManager.on("segment-error",n.onSegmentError),n.httpManager.on("bytes-downloaded",function(t){return n.onPieceBytesDownloaded("http",t)}),n.p2pManager=n.createP2PManager(),n.p2pManager.on("segment-loaded",n.onSegmentLoaded),n.p2pManager.on("segment-error",n.onSegmentError),n.p2pManager.on("peer-data-updated",function(){if(void 0!==n.masterSwarmId){var t=n.segmentsStorage.getSegmentsMap(n.masterSwarmId);n.processSegmentsQueue(t)&&!n.settings.consumeOnly&&n.p2pManager.sendSegmentsMapToAll(n.createSegmentsMap(t))}}),n.p2pManager.on("bytes-downloaded",function(t,e){return n.onPieceBytesDownloaded("p2p",t,e)}),n.p2pManager.on("bytes-uploaded",function(t,e){return n.onPieceBytesUploaded("p2p",t,e)}),n.p2pManager.on("peer-connected",n.onPeerConnect),n.p2pManager.on("peer-closed",n.onPeerClose),n.p2pManager.on("tracker-update",n.onTrackerUpdate),n}return o(e,t),s(e,[{key:"createHttpManager",value:function(){return new h.default(this.settings)}},{key:"createP2PManager",value:function(){return new p.default(this.segmentsStorage,this.settings)}},{key:"load",value:function(t,e){var n=this;void 0===this.httpRandomDownloadInterval&&(this.httpRandomDownloadInterval=setInterval(this.downloadRandomSegmentOverHttp,this.settings.httpDownloadProbabilityInterval),this.settings.httpDownloadInitialTimeout>0&&this.settings.httpDownloadInitialTimeoutPerSegment>0&&(this.httpDownloadInitialTimeoutTimestamp=this.now(),setTimeout(this.processInitialSegmentTimeout,this.settings.httpDownloadInitialTimeoutPerSegment+100))),t.length>0&&(this.masterSwarmId=t[0].masterSwarmId),void 0!==this.masterSwarmId&&this.p2pManager.setStreamSwarmId(e,this.masterSwarmId);var r=!1,i=!0,a=!1,o=void 0;try{for(var s,l=(0,y.default)(this.segmentsQueue);!(i=(s=l.next()).done);i=!0)!function(){var e=s.value;t.find(function(t){return t.url==e.url})||(n.httpManager.isDownloading(e)?(r=!0,n.httpManager.abort(e)):n.p2pManager.abort(e),n.emit(u.Events.SegmentAbort,e))}()}catch(d){a=!0,o=d}finally{try{!i&&l.return&&l.return()}finally{if(a)throw o}}if(this.segmentsQueue=t,void 0!==this.masterSwarmId){var c=this.segmentsStorage.getSegmentsMap(this.masterSwarmId);r=this.processSegmentsQueue(c)||r,this.cleanSegmentsStorage()&&(c=this.segmentsStorage.getSegmentsMap(this.masterSwarmId),r=!0),r&&!this.settings.consumeOnly&&this.p2pManager.sendSegmentsMapToAll(this.createSegmentsMap(c))}}},{key:"getSegment",value:function(t){return void 0===this.masterSwarmId?void 0:this.segmentsStorage.getSegment(t,this.masterSwarmId)}},{key:"getSettings",value:function(){return this.settings}},{key:"getDetails",value:function(){return{peerId:this.p2pManager.getPeerId()}}},{key:"destroy",value:function(){void 0!==this.httpRandomDownloadInterval&&(clearInterval(this.httpRandomDownloadInterval),this.httpRandomDownloadInterval=void 0),this.httpDownloadInitialTimeoutTimestamp=-1/0,this.segmentsQueue=[],this.httpManager.destroy(),this.p2pManager.destroy(),this.masterSwarmId=void 0,this.segmentsStorage.destroy()}},{key:"processSegmentsQueue",value:function(t){if(void 0===this.masterSwarmId||0===this.segmentsQueue.length)return!1;var e=!1,n=void 0,r=!0;if(this.httpDownloadInitialTimeoutTimestamp!==-1/0){var i=void 0,a=!0,o=!1,s=void 0;try{for(var u,l=(0,y.default)(this.segmentsQueue);!(a=(u=l.next()).done);a=!0){var c=u.value;if(!t.has(c.id)){i=c.priority;break}}}catch(E){o=!0,s=E}finally{try{!a&&l.return&&l.return()}finally{if(o)throw s}}var d=this.now()-this.httpDownloadInitialTimeoutTimestamp;r=d>=this.settings.httpDownloadInitialTimeout||void 0!==i&&d>this.settings.httpDownloadInitialTimeoutPerSegment&&i<=0,r&&(this.httpDownloadInitialTimeoutTimestamp=-1/0)}for(var h=0;h<this.segmentsQueue.length;h++){var f=this.segmentsQueue[h];if(!t.has(f.id)&&!this.httpManager.isDownloading(f)){if(f.priority<=this.settings.requiredSegmentsPriority&&r&&!this.httpManager.isFailed(f)){if(this.httpManager.getActiveDownloadsCount()>=this.settings.simultaneousHttpDownloads)for(var p=this.segmentsQueue.length-1;p>h;p--){var m=this.segmentsQueue[p];if(this.httpManager.isDownloading(m)){this.httpManager.abort(m);break}}if(this.httpManager.getActiveDownloadsCount()<this.settings.simultaneousHttpDownloads){var v=this.p2pManager.abort(f);this.httpManager.download(f,v),e=!0;continue}}if(!this.p2pManager.isDownloading(f))if(f.priority<=this.settings.requiredSegmentsPriority){if(n=n||this.p2pManager.getOvrallSegmentsMap(),n.get(f.id)!==g.default.Loaded)continue;if(this.p2pManager.getActiveDownloadsCount()>=this.settings.simultaneousP2PDownloads)for(var _=this.segmentsQueue.length-1;_>h;_--){var b=this.segmentsQueue[_];if(this.p2pManager.isDownloading(b)){this.p2pManager.abort(b);break}}if(this.p2pManager.getActiveDownloadsCount()<this.settings.simultaneousP2PDownloads&&this.p2pManager.download(f))continue}else this.p2pManager.getActiveDownloadsCount()<this.settings.simultaneousP2PDownloads&&f.priority<=this.settings.p2pDownloadMaxPriority&&this.p2pManager.download(f)}}return e}},{key:"getStreamSwarmId",value:function(t){return void 0===t.streamId?t.masterSwarmId:t.masterSwarmId+"+"+t.streamId}},{key:"createSegmentsMap",value:function(t){var e=this,n={},r=function(t,r){var i=e.getStreamSwarmId(t),a=t.sequence,o=n[i];void 0===o&&(o=["",[]],n[i]=o);var s=o[1];o[0]+=0==s.length?a:"|"+a,s.push(r)},i=!0,a=!1,o=void 0;try{for(var s,u=(0,y.default)(t.values());!(i=(s=u.next()).done);i=!0){r(s.value.segment,g.default.Loaded)}}catch(p){a=!0,o=p}finally{try{!i&&u.return&&u.return()}finally{if(a)throw o}}var l=!0,c=!1,d=void 0;try{for(var h,f=(0,y.default)(this.httpManager.getActiveDownloads().values());!(l=(h=f.next()).done);l=!0){r(h.value.segment,g.default.LoadingByHttp)}}catch(p){c=!0,d=p}finally{try{!l&&f.return&&f.return()}finally{if(c)throw d}}return n}},{key:"cleanSegmentsStorage",value:function(){var t=this;return void 0!==this.masterSwarmId&&this.segmentsStorage.clean(this.masterSwarmId,function(e){return void 0!==t.segmentsQueue.find(function(t){return t.id===e})})}},{key:"now",value:function(){return performance.now()}}],[{key:"isSupported",value:function(){var t=(0,A.default)();return t&&void 0!==t.RTCPeerConnection.prototype.createDataChannel}}]),e}(c.default);n.default=I},{"./bandwidth-approximator":63,"./http-media-manager":64,"./loader-interface":66,"./media-peer":67,"./p2p-media-manager":68,"./segments-memory-storage":69,events:10,"get-browser-rtc":14,"simple-peer":42}],66:[function(t,e,n){function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=n.Segment=function a(t,e,n,i,o,s,u){var l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,c=arguments[8],d=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0;r(this,a),this.id=t,this.url=e,this.masterSwarmId=n,this.masterManifestUri=i,this.streamId=o,this.sequence=s,this.range=u,this.priority=l,this.data=c,this.downloadBandwidth=d};n.Segment=i;!function(t){t["SegmentLoaded"]="segment_loaded",t["SegmentError"]="segment_error",t["SegmentAbort"]="segment_abort",t["PeerConnect"]="peer_connect",t["PeerClose"]="peer_close",t["PieceBytesDownloaded"]="piece_bytes_downloaded",t["PieceBytesUploaded"]="piece_bytes_uploaded"}(n.Events||(n.Events={}))},{}],67:[function(t,e,n){function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==(void 0===e?"undefined":(0,H.default)(e))&&"function"!=typeof e?t:e}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+(void 0===e?"undefined":(0,H.default)(e)));t.prototype=(0,C.default)(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(x.default?(0,x.default)(t,e):t.__proto__=e)}function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),(0,R.default)(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),s=t("./stringly-typed-event-emitter"),u=function(t){return t&&t.__esModule?t:{default:t}}(s),l=t("safe-buffer"),c={};!function(t){t["SegmentData"]="SegmentData",t["SegmentAbsent"]="SegmentAbsent",t["SegmentsMap"]="SegmentsMap",t["SegmentRequest"]="SegmentRequest",t["CancelSegmentRequest"]="CancelSegmentRequest"}(c||(c={}));var d={};!function(t){t["Loaded"]="Loaded",t["LoadingByHttp"]="LoadingByHttp"}(d=n.MediaPeerSegmentStatus||(n.MediaPeerSegmentStatus={}));var h=function m(t,e){a(this,m),this.id=t,this.size=e,this.bytesDownloaded=0,this.pieces=[]},f=function(t){function e(t,n){a(this,e);var i=r(this,(e.__proto__||(0,S.default)(e)).call(this));return i.peer=t,i.settings=n,i.remoteAddress="",i.downloadingSegmentId=null,i.downloadingSegment=null,i.segmentsMap=new p.default,i.timer=null,i.peer.on("connect",function(){return i.onPeerConnect()}),i.peer.on("close",function(){return i.onPeerClose()}),i.peer.on("data",function(t){return i.onPeerData(t)}),i.id=t.id,i}return i(e,t),o(e,[{key:"onPeerConnect",value:function(){this.remoteAddress=this.peer.remoteAddress,this.emit("connect",this)}},{key:"onPeerClose",value:function(){this.terminateSegmentRequest(),this.emit("close",this)}},{key:"receiveSegmentPiece",value:function(t){if(this.downloadingSegment){this.downloadingSegment.bytesDownloaded+=t.byteLength,this.downloadingSegment.pieces.push(t),this.emit("bytes-downloaded",this,t.byteLength);var e=this.downloadingSegment.id;if(this.downloadingSegment.bytesDownloaded==this.downloadingSegment.size){var n=new Uint8Array(this.downloadingSegment.size),r=0,i=!0,a=!1,o=void 0;try{for(var s,u=(0,y.default)(this.downloadingSegment.pieces);!(i=(s=u.next()).done);i=!0){var l=s.value;n.set(new Uint8Array(l),r),r+=l.byteLength}}catch(c){a=!0,o=c}finally{try{!i&&u.return&&u.return()}finally{if(a)throw o}}this.terminateSegmentRequest(),this.emit("segment-loaded",this,e,n.buffer)}else this.downloadingSegment.bytesDownloaded>this.downloadingSegment.size&&(this.terminateSegmentRequest(),this.emit("segment-error",this,e,"Too many bytes received for segment"))}}},{key:"getJsonCommand",value:function(t){var e=new Uint8Array(t);if(123==e[0]&&34==e[1]&&125==e[t.byteLength-1])try{return JSON.parse((new TextDecoder).decode(t))}catch(n){return null}return null}},{key:"createSegmentsMap",value:function(t){if(void 0==t||!(t instanceof Object))return new p.default;var e=new p.default,n=!0,r=!1,i=void 0;try{for(var a,o=(0,y.default)((0,G.default)(t));!(n=(a=o.next()).done);n=!0){var s=a.value,u=t[s];if(!(u instanceof Array&&2===u.length&&"string"==typeof u[0]&&u[1]instanceof Array))return new p.default;var l=u[0].split("|"),c=u[1];if(l.length!==c.length)return new p.default;for(var h=0;h<l.length;h++){var f=c[h];if("number"!=typeof f||void 0===d[f])return new p.default;e.set(s+"+"+l[h],f)}}}catch(m){r=!0,i=m}finally{try{!n&&o.return&&o.return()}finally{if(r)throw i}}return e}},{key:"onPeerData",value:function(t){var e=this.getJsonCommand(t);if(null==e)return void this.receiveSegmentPiece(t);if(this.downloadingSegment){var n=this.downloadingSegment.id;return this.terminateSegmentRequest(),void this.emit("segment-error",this,n,"Segment download is interrupted by a command")}switch(e.c){case c.SegmentsMap:this.segmentsMap=this.createSegmentsMap(e.m),this.emit("data-updated");break;case c.SegmentRequest:this.emit("segment-request",this,e.i);break;case c.SegmentData:this.downloadingSegmentId===e.i&&(this.downloadingSegment=new h(e.i,e.s),this.cancelResponseTimeoutTimer());break;case c.SegmentAbsent:this.downloadingSegmentId===e.i&&(this.terminateSegmentRequest(),this.segmentsMap.delete(e.i),this.emit("segment-absent",this,e.i));break;case c.CancelSegmentRequest:}}},{key:"sendCommand",value:function(t){try{this.peer.write((0,j.default)(t))}catch(e){}}},{key:"destroy",value:function(){this.terminateSegmentRequest(),this.peer.destroy()}},{key:"getDownloadingSegmentId",value:function(){return this.downloadingSegmentId}},{key:"getSegmentsMap",value:function(){return this.segmentsMap}},{key:"sendSegmentsMap",value:function(t){this.sendCommand({c:c.SegmentsMap,m:t})}},{key:"sendSegmentData",value:function(t,e){this.sendCommand({c:c.SegmentData,i:t,s:e.byteLength});for(var n=e.byteLength;n>0;){var r=n>=this.settings.webRtcMaxMessageSize?this.settings.webRtcMaxMessageSize:n,i=l.Buffer.from(e,e.byteLength-n,r);try{this.peer.write(i)}catch(a){break}n-=r}this.emit("bytes-uploaded",this,e.byteLength-n)}},{key:"sendSegmentAbsent",value:function(t){this.sendCommand({c:c.SegmentAbsent,i:t})}},{key:"requestSegment",value:function(t){if(this.downloadingSegmentId)throw new Error("A segment is already downloading: "+this.downloadingSegmentId);this.sendCommand({c:c.SegmentRequest,i:t}),this.downloadingSegmentId=t,this.runResponseTimeoutTimer()}},{key:"cancelSegmentRequest",value:function(){var t=void 0;if(this.downloadingSegmentId){var e=this.downloadingSegmentId;t=this.downloadingSegment?this.downloadingSegment.pieces:void 0,this.terminateSegmentRequest(),this.sendCommand({c:c.CancelSegmentRequest,i:e})}return t}},{key:"runResponseTimeoutTimer",value:function(){var t=this;this.timer=setTimeout(function(){if(t.timer=null,t.downloadingSegmentId){var e=t.downloadingSegmentId;t.cancelSegmentRequest(),t.emit("segment-timeout",t,e)}},this.settings.p2pSegmentDownloadTimeout)}},{key:"cancelResponseTimeoutTimer",value:function(){this.timer&&(clearTimeout(this.timer),this.timer=null)}},{key:"terminateSegmentRequest",value:function(){this.downloadingSegmentId=null,this.downloadingSegment=null,this.cancelResponseTimeoutTimer()}}]),e}(u.default);n.default=f},{"./stringly-typed-event-emitter":70,"safe-buffer":39}],68:[function(t,e,n){function r(t){return t&&t.__esModule?t:{default:t}}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==(void 0===e?"undefined":(0,H.default)(e))&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+(void 0===e?"undefined":(0,H.default)(e)));t.prototype=(0,C.default)(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(x.default?(0,x.default)(t,e):t.__proto__=e)}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=T,n=0;n<20-T.length;n++)e+=t.charAt(Math.floor(Math.random()*t.length));return(new TextEncoder).encode(e).buffer}Object.defineProperty(n,"__esModule",{value:!0});var u=function(){function t(t,e){var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=(0,y.default)(t);!(r=(o=s.next()).done)&&(n.push(o.value),!e||n.length!==e);r=!0);}catch(u){i=!0,a=u}finally{try{!r&&s["return"]&&s["return"]()}finally{if(i)throw a}}return n}return function(e,n){if(Array.isArray(e))return e;if((0,g.default)(Object(e)))return t(e,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),l=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),(0,R.default)(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),c=t("./stringly-typed-event-emitter"),d=r(c),h=t("./media-peer"),f=r(h),m=t("./loader-interface"),v=t("safe-buffer"),_=t("sha.js/sha1"),b=r(_),E=t("bittorrent-tracker"),w="0.6.1",A=w.replace(/\d*./g,function(t){return("0"+parseInt(t,10)%100).slice(-2)}).slice(0,4),T="-WW"+A+"-",k=function L(t,e){o(this,L),this.peerId=t,this.segment=e},M=function(t){function e(t,n){o(this,e);var r=i(this,(e.__proto__||(0,S.default)(e)).call(this));return r.sementsStorage=t,r.settings=n,r.trackerClient=null,r.peers=new p.default,r.peerCandidates=new p.default,r.peerSegmentRequests=new p.default,r.streamSwarmId=null,r.pendingTrackerClient=null,r.onTrackerError=function(t){},r.onTrackerWarning=function(t){},r.onTrackerUpdate=function(t){r.emit("tracker-update",t)},r.onTrackerPeer=function(t){if(r.peers.has(t.id))return void t.destroy();var e=new f.default(t,r.settings);e.on("connect",r.onPeerConnect),e.on("close",r.onPeerClose),e.on("data-updated",r.onPeerDataUpdated),e.on("segment-request",r.onSegmentRequest),e.on("segment-loaded",r.onSegmentLoaded),e.on("segment-absent",r.onSegmentAbsent),e.on("segment-error",r.onSegmentError),e.on("segment-timeout",r.onSegmentTimeout),e.on("bytes-downloaded",r.onPieceBytesDownloaded),e.on("bytes-uploaded",r.onPieceBytesUploaded);var n=r.peerCandidates.get(e.id);n||(n=[],r.peerCandidates.set(e.id,n)),n.push(e)},r.onPieceBytesDownloaded=function(t,e){r.emit("bytes-downloaded",e,t.id)},r.onPieceBytesUploaded=function(t,e){r.emit("bytes-uploaded",e,t.id)},r.onPeerConnect=function(t){if(r.peers.get(t.id))return void t.destroy();r.peers.set(t.id,t);var e=r.peerCandidates.get(t.id);if(e){var n=!0,i=!1,a=void 0;try{for(var o,s=(0,y.default)(e);!(n=(o=s.next()).done);n=!0){var u=o.value;u!=t&&u.destroy()}}catch(l){i=!0,a=l}finally{try{!n&&s.return&&s.return()}finally{if(i)throw a}}r.peerCandidates.delete(t.id)}r.emit("peer-connected",{id:t.id,remoteAddress:t.remoteAddress})},r.onPeerClose=function(t){if(r.peers.get(t.id)!=t){var e=r.peerCandidates.get(t.id);if(!e)return;var n=e.indexOf(t);return-1!=n&&e.splice(n,1),void(0==e.length&&r.peerCandidates.delete(t.id))}var i=!0,a=!1,o=void 0;try{for(var s,l=(0,y.default)(r.peerSegmentRequests);!(i=(s=l.next()).done);i=!0){var c=u(s.value,2),d=c[0];c[1].peerId==t.id&&r.peerSegmentRequests.delete(d)}}catch(h){a=!0,o=h}finally{try{!i&&l.return&&l.return()}finally{if(a)throw o}}r.peers.delete(t.id),r.emit("peer-data-updated"),r.emit("peer-closed",t.id)},r.onPeerDataUpdated=function(){r.emit("peer-data-updated")},r.onSegmentRequest=function(t,e){if(void 0!==r.masterSwarmId){var n=r.sementsStorage.getSegment(e,r.masterSwarmId);n?t.sendSegmentData(e,n.data):t.sendSegmentAbsent(e)}},r.onSegmentLoaded=function(t,e,n){var i=r.peerSegmentRequests.get(e);if(i){var a=i.segment;if(r.settings.segmentValidator)try{r.settings.segmentValidator(new m.Segment(a.id,a.url,a.masterSwarmId,a.masterManifestUri,a.streamId,a.sequence,a.range,a.priority,n),"p2p",t.id)}catch(o){return r.peerSegmentRequests.delete(e),r.emit("segment-error",a,o,t.id),void r.onPeerClose(t)}r.peerSegmentRequests.delete(e),r.emit("segment-loaded",a,n,t.id)}},r.onSegmentAbsent=function(t,e){r.peerSegmentRequests.delete(e),r.emit("peer-data-updated")},r.onSegmentError=function(t,e,n){var i=r.peerSegmentRequests.get(e);i&&(r.peerSegmentRequests.delete(e),r.emit("segment-error",i.segment,n,t.id))},r.onSegmentTimeout=function(t,e){var n=r.peerSegmentRequests.get(e);n&&(r.peerSegmentRequests.delete(e),t.destroy(),r.peers.delete(n.peerId)&&r.emit("peer-data-updated"))},r.peerId=n.useP2P?s():new ArrayBuffer(0),r}return a(e,t),l(e,[{key:"getPeers",value:function(){return this.peers}},{key:"getPeerId",value:function(){return v.Buffer.from(this.peerId).toString("hex")}},{key:"setStreamSwarmId",value:function(t,e){if(this.streamSwarmId!==t){this.destroy(!0),this.streamSwarmId=t,this.masterSwarmId=e,this.pendingTrackerClient={isDestroyed:!1};var n=this.pendingTrackerClient,r=(new b.default).update(2+this.streamSwarmId).digest();n.isDestroyed?null!=this.trackerClient&&(this.trackerClient.destroy(),this.trackerClient=null):(this.pendingTrackerClient=null,this.createClient(r))}}},{key:"createClient",value:function(t){var e=this;if(this.settings.useP2P){var n={infoHash:v.Buffer.from(t,0,20),peerId:v.Buffer.from(this.peerId,0,20),announce:this.settings.trackerAnnounce,rtcConfig:this.settings.rtcConfig,port:6881,getAnnounceOpts:function(){return{numwant:e.settings.peerRequestsPerAnnounce}}},r=this.trackerClient;this.trackerClient=new E.Client(n),this.trackerClient.on("error",this.onTrackerError),this.trackerClient.on("warning",this.onTrackerWarning),this.trackerClient.on("update",this.onTrackerUpdate),this.trackerClient.on("peer",this.onTrackerPeer),this.trackerClient.start(),null!=r&&(r.destroy(),r=null)}}},{key:"onTrackerUpdate",value:function(t){this.emit("tracker-update",t)}},{key:"onTrackerPeer",value:function(t){if(this.peers.has(t.id))return void t.destroy();var e=new f.default(t,this.settings);e.on("connect",this.onPeerConnect),e.on("close",this.onPeerClose),e.on("data-updated",this.onPeerDataUpdated),e.on("segment-request",this.onSegmentRequest),e.on("segment-loaded",this.onSegmentLoaded),e.on("segment-absent",this.onSegmentAbsent),e.on("segment-error",this.onSegmentError),e.on("segment-timeout",this.onSegmentTimeout),e.on("bytes-downloaded",this.onPieceBytesDownloaded),e.on("bytes-uploaded",this.onPieceBytesUploaded);var n=this.peerCandidates.get(e.id);n||(n=[],this.peerCandidates.set(e.id,n)),n.push(e)}},{key:"download",value:function(t){if(this.isDownloading(t))return!1;var e=[],n=!0,r=!1,i=void 0;try{for(var a,o=(0,y.default)(this.peers.values());!(n=(a=o.next()).done);n=!0){var s=a.value;null==s.getDownloadingSegmentId()&&s.getSegmentsMap().get(t.id)===f.default.Loaded&&e.push(s)}}catch(l){r=!0,i=l}finally{try{!n&&o.return&&o.return()}finally{if(r)throw i}}if(0===e.length)return!1;var u=e[Math.floor(Math.random()*e.length)];return u.requestSegment(t.id),this.peerSegmentRequests.set(t.id,new k(u.id,t)),!0}},{key:"abort",value:function(t){var e=void 0,n=this.peerSegmentRequests.get(t.id);if(n){var r=this.peers.get(n.peerId);r&&(e=r.cancelSegmentRequest()),this.peerSegmentRequests.delete(t.id)}return e}},{key:"isDownloading",value:function(t){return this.peerSegmentRequests.has(t.id)}},{key:"getActiveDownloadsCount",value:function(){return this.peerSegmentRequests.size}},{key:"destroy",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.streamSwarmId=null,this.trackerClient&&(this.trackerClient.stop(),t?(this.trackerClient.removeAllListeners("error"),this.trackerClient.removeAllListeners("warning"),this.trackerClient.removeAllListeners("update"),this.trackerClient.removeAllListeners("peer")):(this.trackerClient.destroy(),this.trackerClient=null)),this.pendingTrackerClient&&(this.pendingTrackerClient.isDestroyed=!0,this.pendingTrackerClient=null),this.peers.forEach(function(t){return t.destroy()}),this.peers.clear(),this.peerSegmentRequests.clear();var e=!0,n=!1,r=void 0;try{for(var i,a=(0,y.default)(this.peerCandidates.values());!(e=(i=a.next()).done);e=!0){var o=i.value,s=!0,u=!1,l=void 0;try{for(var c,d=(0,y.default)(o);!(s=(c=d.next()).done);s=!0){c.value.destroy()}}catch(h){u=!0,l=h}finally{try{!s&&d.return&&d.return()}finally{if(u)throw l}}}}catch(h){n=!0,r=h}finally{try{!e&&a.return&&a.return()}finally{if(n)throw r}}this.peerCandidates.clear()}},{key:"sendSegmentsMapToAll",value:function(t){this.peers.forEach(function(e){return e.sendSegmentsMap(t)})}},{key:"sendSegmentsMap",value:function(t,e){var n=this.peers.get(t);n&&n.sendSegmentsMap(e)}},{key:"getOvrallSegmentsMap",value:function(){var t=new p.default,e=!0,n=!1,r=void 0;try{for(var i,a=(0,y.default)(this.peers.values());!(e=(i=a.next()).done);e=!0){var o=i.value,s=!0,l=!1,c=void 0;try{for(var d,h=(0,y.default)(o.getSegmentsMap());!(s=(d=h.next()).done);s=!0){var m=u(d.value,2),g=m[0];m[1]===f.default.Loaded?t.set(g,f.default.Loaded):t.get(g)||t.set(g,f.default.LoadingByHttp)}}catch(v){l=!0,c=v}finally{try{!s&&h.return&&h.return()}finally{if(l)throw c}}}}catch(v){n=!0,r=v}finally{try{!e&&a.return&&a.return()}finally{if(n)throw r}}return t}}]),e}(d.default);n.default=M},{"./loader-interface":66,"./media-peer":67,"./stringly-typed-event-emitter":70,"bittorrent-tracker":3,"safe-buffer":39,"sha.js/sha1":41}],69:[function(t,e,n){function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),(0,R.default)(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),a=function(){function t(e){r(this,t),this.settings=e,this.cache=new p.default}return i(t,[{key:"storeSegment",value:function(t){this.cache.set(t.id,{segment:t,lastAccessed:performance.now()})}},{key:"getSegmentsMap",value:function(t){return this.cache}},{key:"getSegment",value:function(t,e){var n=this.cache.get(t);if(void 0!==n)return n.lastAccessed=performance.now(),n.segment}},{key:"hasSegment",value:function(t,e){return this.cache.has(t)}},{key:"clean",value:function(t,e){var n=this,r=[],i=[],a=performance.now(),o=!0,s=!1,u=void 0;try{for(var l,c=(0,y.default)(this.cache.values());!(o=(l=c.next()).done);o=!0){var d=l.value;a-d.lastAccessed>this.settings.cachedSegmentExpiration?r.push(d.segment.id):i.push(d)}}catch(b){s=!0,u=b}finally{try{!o&&c.return&&c.return()}finally{if(s)throw u}}var h=i.length-this.settings.cachedSegmentsCount;if(h>0){i.sort(function(t,e){return t.lastAccessed-e.lastAccessed});var f=!0,p=!1,m=void 0;try{for(var g,v=(0,y.default)(i);!(f=(g=v.next()).done);f=!0){var _=g.value;if((void 0===e||!e(_.segment.id))&&(r.push(_.segment.id),0==--h))break}}catch(b){p=!0,m=b}finally{try{!f&&v.return&&v.return()}finally{if(p)throw m}}}return r.forEach(function(t){return n.cache.delete(t)}),r.length>0}},{key:"destroy",value:function(){this.cache.clear()}}]),t}();n.default=a},{}],70:[function(t,e,n){function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==(void 0===e?"undefined":(0,H.default)(e))&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+(void 0===e?"undefined":(0,H.default)(e)));t.prototype=(0,C.default)(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(x.default?(0,x.default)(t,e):t.__proto__=e)}Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),(0,R.default)(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),s=function h(t,e,n){null===t&&(t=Function.prototype);var r=(0,c.default)(t,e);if(void 0===r){var i=(0,S.default)(t);return null===i?void 0:h(i,e,n)}if("value"in r)return r.value;var a=r.get;if(void 0!==a)return a.call(n)},u=t("events"),l=function(t){return t&&t.__esModule?t:{default:t}}(u),d=function(t){function e(){return r(this,e),i(this,(e.__proto__||(0,S.default)(e)).apply(this,arguments))}return a(e,t),o(e,[{key:"on",value:function(t,n){return s(e.prototype.__proto__||(0,S.default)(e.prototype),"on",this).call(this,t,n)}},{key:"emit",value:function(t){for(var n,r=arguments.length,i=Array(r>1?r-1:0),a=1;a<r;a++)i[a-1]=arguments[a];return(n=s(e.prototype.__proto__||(0,S.default)(e.prototype),"emit",this)).call.apply(n,[this,t].concat(i))}}]),e}(l.default);n.default=d},{events:10}],71:[function(t,e,n){function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),(0,R.default)(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),a=function(){function e(){r(this,e)}return i(e,null,[{key:"install",value:function(){Object.setPrototypeOf=x.default||function(t,e){return t.__proto__=e,t},Object.assign=F.default||function(t){if(void 0===t||null===t)throw new TypeError("Cannot convert undefined or null to object");for(var e=Object(t),n=1;n<arguments.length;n++){var r=arguments[n];if(void 0!==r&&null!==r)for(var i in r)r.hasOwnProperty(i)&&(e[i]=r[i])}return e},"function"!=typeof self.Promise&&t("es6-promise").polyfill()}}]),e}();a.install(),n.default=a},{"es6-promise":13}]},{},[57])(57)})}).call(e,n(46))},function(t,e,n){t.exports={default:n(231),__esModule:!0}},function(t,e,n){n(36),n(34),t.exports=n(232)},function(t,e,n){var r=n(58),i=n(11)("iterator"),a=n(35);t.exports=n(5).isIterable=function(t){var e=Object(t);return void 0!==e[i]||"@@iterator"in e||a.hasOwnProperty(r(e))}},function(t,e,n){t.exports={default:n(234),__esModule:!0}},function(t,e,n){n(36),n(34),t.exports=n(235)},function(t,e,n){var r=n(18),i=n(86);t.exports=n(5).getIterator=function(t){var e=i(t);if("function"!=typeof e)throw TypeError(t+" is not iterable!");return r(e.call(t))}},function(t,e,n){t.exports={default:n(237),__esModule:!0}},function(t,e,n){n(53),n(36),n(238),n(240),n(241),t.exports=n(5).WeakMap},function(t,e,n){"use strict";var r,i=n(88)(0),a=n(74),o=n(45),s=n(96),u=n(239),l=n(17),c=n(25),d=n(61),h=o.getWeak,f=Object.isExtensible,p=u.ufstore,m={},g=function(t){return function(){return t(this,arguments.length>0?arguments[0]:void 0)}},v={get:function(t){if(l(t)){var e=h(t);return!0===e?p(d(this,"WeakMap")).get(t):e?e[this._i]:void 0}},set:function(t,e){return u.def(d(this,"WeakMap"),t,e)}},y=t.exports=n(122)("WeakMap",g,v,u,!0,!0);c(function(){return 7!=(new y).set((Object.freeze||Object)(m),7).get(m)})&&(r=u.getConstructor(g,"WeakMap"),s(r.prototype,v),o.NEED=!0,i(["delete","has","get","set"],function(t){var e=y.prototype,n=e[t];a(e,t,function(e,i){if(l(e)&&!f(e)){this._f||(this._f=new r);var a=this._f[t](e,i);return"set"==t?this:a}return n.call(this,e,i)})}))},function(t,e,n){"use strict";var r=n(60),i=n(45).getWeak,a=n(18),o=n(17),s=n(59),u=n(39),l=n(88),c=n(22),d=n(61),h=l(5),f=l(6),p=0,m=function(t){return t._l||(t._l=new g)},g=function(){this.a=[]},v=function(t,e){return h(t.a,function(t){return t[0]===e})};g.prototype={get:function(t){var e=v(this,t);if(e)return e[1]},has:function(t){return!!v(this,t)},set:function(t,e){var n=v(this,t);n?n[1]=e:this.a.push([t,e])},delete:function(t){var e=f(this.a,function(e){return e[0]===t});return~e&&this.a.splice(e,1),!!~e}},t.exports={getConstructor:function(t,e,n,a){var l=t(function(t,r){s(t,l,e,"_i"),t._t=e,t._i=p++,t._l=void 0,void 0!=r&&u(r,n,t[a],t)});return r(l.prototype,{delete:function(t){if(!o(t))return!1;var n=i(t);return!0===n?m(d(this,e))["delete"](t):n&&c(n,this._i)&&delete n[this._i]},has:function(t){if(!o(t))return!1;var n=i(t);return!0===n?m(d(this,e)).has(t):n&&c(n,this._i)}}),l},def:function(t,e,n){var r=i(a(e),!0);return!0===r?m(t).set(e,n):r[t._i]=n,t},ufstore:m}},function(t,e,n){n(123)("WeakMap")},function(t,e,n){n(124)("WeakMap")},function(t,e,n){t.exports={default:n(243),__esModule:!0}},function(t,e,n){n(244),t.exports=n(44).f("hasInstance")},function(t,e,n){"use strict";var r=n(17),i=n(75),a=n(11)("hasInstance"),o=Function.prototype;a in o||n(16).f(o,a,{value:function(t){if("function"!=typeof this||!r(t))return!1;if(!r(this.prototype))return t instanceof this;for(;t=i(t);)if(this.prototype===t)return!0;return!1}})},function(t,e,n){t.exports={default:n(246),__esModule:!0}},function(t,e,n){t.exports=n(44).f("species")},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(248),i=function(t){return t&&t.__esModule?t:{default:t}}(r);e.default=i.default,t.exports=e["default"]},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=n(85),a=r(i),o=n(0),s=r(o),u=n(1),l=r(u),c=n(3),d=r(c),h=n(2),f=r(h),p=n(38),m=r(p),g=n(4),v=r(g),y=n(13),_=(r(y),n(27)),b=r(_),E=n(249),w=r(E),A=n(250),S=r(A),T=function(t){function e(){(0,s.default)(this,e);for(var n=arguments.length,r=Array(n),i=0;i<n;i++)r[i]=arguments[i];var a=(0,l.default)(this,t.call.apply(t,[this].concat(r)));return a._levels=[],a._pendingAdaptationEvent=!1,a._isShakaReadyState=!1,a}return(0,f.default)(e,t),e.canPlay=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";S.default.polyfill.installAll();var n=S.default.Player.isBrowserSupported(),r=t.split("?")[0].match(/.*\.(.*)$/)||[];return n&&("mpd"===r[1]||e.indexOf("application/dash+xml")>-1)},(0,d.default)(e,[{key:"name",get:function(){return"dash_shaka_playback"}},{key:"shakaVersion",get:function(){return S.default.player.Player.version}},{key:"shakaPlayerInstance",get:function(){return this._player}},{key:"levels",get:function(){return this._levels}},{key:"currentLevel",set:function(t){var e=this;this._currentLevelId=t;var n=-1===this._currentLevelId;this.trigger(v.default.PLAYBACK_LEVEL_SWITCH_START),n?(this._player.configure({abr:{enabled:!0}}),this.trigger(v.default.PLAYBACK_LEVEL_SWITCH_END)):(this._player.configure({abr:{enabled:!1}}),this._pendingAdaptationEvent=!0,this.selectTrack(this.videoTracks.filter(function(t){return t.id===e._currentLevelId})[0]))},get:function(){return this._currentLevelId||-1}}],[{key:"Events",get:function(){return{SHAKA_READY:"shaka:ready"}}}]),e.prototype.play=function(){if(this._player||this._setup(),!this.isReady)return void this.once(e.Events.SHAKA_READY,this.play);this._stopped=!1,this._src=this.el.src,t.prototype.play.call(this)},e.prototype._setupSrc=function(){},e.prototype._ready=function(){},e.prototype._onShakaReady=function(){this._isShakaReadyState=!0,this.trigger(e.Events.SHAKA_READY),this.trigger(v.default.PLAYBACK_READY,this.name)},e.prototype.error=function(t){b.default.error("an error was raised by the video tag",t,this.el.error)},e.prototype.isHighDefinitionInUse=function(){return!!this.highDefinition},e.prototype.stop=function(){var e=this;clearInterval(this.sendStatsId),this._stopped=!0,this._player?(this._sendStats(),this._player.unload().then(function(){t.prototype.stop.call(e),e._player=null,e._isShakaReadyState=!1}).catch(function(){b.default.error("shaka could not be unloaded")})):t.prototype.stop.call(this)},e.prototype.getPlaybackType=function(){return(this.isReady&&this._player.isLive()?"live":"vod")||""},e.prototype.selectTrack=function(t){if("text"===t.type)this._player.selectTextTrack(t);else{if("variant"!==t.type)throw new Error("Unhandled track type:",t.type);this._player.selectVariantTrack(t),t.mimeType.startsWith("video/")&&this._onAdaptation()}},e.prototype._enableShakaTextTrack=function(t){this.el.textTracks&&(this._shakaTTVisible=t,(0,a.default)(this.el.textTracks).filter(function(t){return"subtitles"===t.kind}).forEach(function(e){return e.mode=!0===t?"showing":"hidden"}))},e.prototype._checkForClosedCaptions=function(){if(!this._ccIsSetup){if(this.hasClosedCaptionsTracks){this.trigger(v.default.PLAYBACK_SUBTITLE_AVAILABLE);var t=this.closedCaptionsTrackId;this.closedCaptionsTrackId=t}this._ccIsSetup=!0}},e.prototype.destroy=function(){var e=this;clearInterval(this.sendStatsId),this._player?this._player.destroy().then(function(){return e._destroy()}).catch(function(){e._destroy(),b.default.error("shaka could not be destroyed")}):this._destroy(),t.prototype.destroy.call(this)},e.prototype._setup=function(){var t=this;this._isShakaReadyState=!1,this._ccIsSetup=!1,this._player=this._createPlayer(),this._options.shakaConfiguration&&this._player.configure(this._options.shakaConfiguration),this._options.shakaOnBeforeLoad&&this._options.shakaOnBeforeLoad(this._player),this._player.load(this._options.src).then(function(){return t._loaded()}).catch(function(e){return t._setupError(e)})},e.prototype._createPlayer=function(){var t=new S.default.Player(this.el);return t.addEventListener("error",this._onError.bind(this)),t.addEventListener("adaptation",this._onAdaptation.bind(this)),t.addEventListener("buffering",this._onBuffering.bind(this)),t},e.prototype._onBuffering=function(t){if(!this._stopped){var e=t.buffering?v.default.PLAYBACK_BUFFERING:v.default.PLAYBACK_BUFFERFULL;this.trigger(e)}},e.prototype._loaded=function(){this._onShakaReady(),this._startToSendStats(),this._fillLevels(),this._checkForClosedCaptions()},e.prototype._fillLevels=function(){0===this._levels.length&&(this._levels=this.videoTracks.map(function(t){return{id:t.id,label:t.height+"p"}}).reverse(),this.trigger(v.default.PLAYBACK_LEVELS_AVAILABLE,this.levels))},e.prototype._startToSendStats=function(){var t=this,e=this._options.shakaSendStatsInterval||3e4;this.sendStatsId=setInterval(function(){return t._sendStats()},e)},e.prototype._sendStats=function(){this.trigger(v.default.PLAYBACK_STATS_ADD,this._player.getStats())},e.prototype._setupError=function(t){this._onError(t)},e.prototype._onError=function(e){var n={shakaError:e,videoError:this.el.error},r=n.shakaError.detail||n.shakaError,i=r.category,a=r.code,o=r.severity;if(n.videoError||!a&&!i)return t.prototype._onError.call(this);var s=o===S.default.util.Error.Severity.CRITICAL,u={code:i+"_"+a,description:"Category: "+i+", code: "+a+", severity: "+o,level:s?w.default.Levels.FATAL:w.default.Levels.WARN,raw:e},l=this.createError(u);b.default.error("Shaka error event:",l),this.trigger(v.default.PLAYBACK_ERROR,l)},e.prototype._onAdaptation=function(){var t=this.videoTracks.filter(function(t){return!0===t.active})[0];this._fillLevels(),this._sendStats(),this._pendingAdaptationEvent&&(this.trigger(v.default.PLAYBACK_LEVEL_SWITCH_END),this._pendingAdaptationEvent=!1),b.default.debug("an adaptation has happened:",t),this.highDefinition=t.height>=720,this.trigger(v.default.PLAYBACK_HIGHDEFINITIONUPDATE,this.highDefinition),this.trigger(v.default.PLAYBACK_BITRATE,{bandwidth:t.bandwidth,width:t.width,height:t.height,level:t.id,url:this._player.getManifestUri()})},e.prototype._destroy=function(){this._isShakaReadyState=!1,b.default.debug("shaka was destroyed")},(0,d.default)(e,[{key:"isReady",get:function(){return this._isShakaReadyState}},{key:"textTracks",get:function(){return this.isReady&&this._player.getTextTracks()}},{key:"audioTracks",get:function(){return this.isReady&&this._player.getVariantTracks().filter(function(t){return t.mimeType.startsWith("audio/")})}},{key:"videoTracks",get:function(){return this.isReady&&this._player.getVariantTracks().filter(function(t){return t.mimeType.startsWith("video/")})}},{key:"closedCaptionsTracks",get:function(){var t=0,e=function(){return t++};return(this.textTracks||[]).filter(function(t){return"subtitle"===t.kind}).map(function(t){return{id:e(),name:t.label||t.language,track:t}})}},{key:"closedCaptionsTrackId",get:function(){return t.prototype.closedCaptionsTrackId},set:function(t){if(this._player){var e=this.closedCaptionsTracks,n=void 0;if(-1!==t){if(!(n=e.find(function(e){return e.id===t})))return void b.default.warn('Track id "'+t+'" not found');if(this._shakaTTVisible&&!0===n.track.active)return void b.default.info('Track id "'+t+'" already showing')}n?(this._player.selectTextTrack(n.track),this._player.setTextTrackVisibility(!0),this._enableShakaTextTrack(!0)):(this._player.setTextTrackVisibility(!1),this._enableShakaTextTrack(!1)),this._ccTrackId=t,this.trigger(v.default.PLAYBACK_SUBTITLE_CHANGED,{id:t})}}}]),e}(m.default);e.default=T,t.exports=e["default"]},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(125),i=function(t){return t&&t.__esModule?t:{default:t}}(r);e.default=i.default,t.exports=e["default"]},function(t,e,n){(function(t){!function(){var n="undefined"!=typeof window?window:t,r={};(function(t,e){function n(){n=function(){},dd.Symbol||(dd.Symbol=hd)}function r(){n();var t=dd.Symbol.iterator;t||(t=dd.Symbol.iterator=dd.Symbol("iterator")),"function"!=typeof Array.prototype[t]&&cd(Array.prototype,t,{configurable:!0,writable:!0,value:function(){return a(this)}}),r=function(){}}function a(t){var e=0;return o(function(){return e<t.length?{done:!1,value:t[e++]}:{done:!0}})}function o(t){return r(),t={next:t},t[dd.Symbol.iterator]=function(){return this},t}function s(t){r();var e=t[Symbol.iterator];return e?e.call(t):a(t)}function u(t,e){if(e){for(var n=dd,r=t.split("."),i=0;i<r.length-1;i++){var a=r[i];a in n||(n[a]={}),n=n[a]}r=r[r.length-1],i=n[r],a=e(i),a!=i&&null!=a&&cd(n,r,{configurable:!0,writable:!0,value:a})}}function l(t){function e(e){return t.next(e)}function n(e){return t["throw"](e)}return new Promise(function(r,i){function a(t){t.done?r(t.value):Promise.resolve(t.value).then(e,n).then(a,i)}a(t.next())})}function c(t){return l(t())}function d(){this.g=!1,this.c=null,this.s=void 0,this.j=1,this.b=this.f=0,this.i=this.a=null}function h(t){if(t.g)throw new TypeError("Generator is already running");t.g=!0}function f(t,e){t.a={xd:e,Hd:!0},t.j=t.f||t.b}function p(t,e,n){return t.j=n,{value:e}}function m(t){t.j=0}function g(t,e,n){t.f=e,void 0!=n&&(t.b=n)}function v(t,e){t.f=0,t.b=e||0}function y(t,e){t.j=e,t.f=0}function _(t){t.f=0;var e=t.a.xd;return t.a=null,e}function b(t){t.i=[t.a],t.f=0,t.b=0}function E(t,e){var n=t.i.splice(0)[0];(n=t.a=t.a||n)?n.Hd?t.j=t.f||t.b:void 0!=n.A&&t.b<n.A?(t.j=n.A,t.a=null):t.j=t.b:t.j=e}function w(t){this.a=new d,this.b=t}function A(t,e){h(t.a);var n=t.a.c;return n?S(t,"return"in n?n["return"]:function(t){return{value:t,done:!0}},e,t.a["return"]):(t.a["return"](e),T(t))}function S(t,e,n,r){try{var i=e.call(t.a.c,n);if(!(i instanceof Object))throw new TypeError("Iterator result "+i+" is not an object");if(!i.done)return t.a.g=!1,i;var a=i.value}catch(o){return t.a.c=null,f(t.a,o),T(t)}return t.a.c=null,r.call(t.a,a),T(t)}function T(t){for(;t.a.j;)try{var e=t.b(t.a);if(e)return t.a.g=!1,{value:e.value,done:!1}}catch(n){t.a.s=void 0,f(t.a,n)}if(t.a.g=!1,t.a.a){if(e=t.a.a,t.a.a=null,e.Hd)throw e.xd;return{value:e["return"],done:!0}}return{value:void 0,done:!0}}function x(t){this.next=function(e){return h(t.a),t.a.c?e=S(t,t.a.c.next,e,t.a.h):(t.a.h(e),e=T(t)),e},this["throw"]=function(e){return h(t.a),t.a.c?e=S(t,t.a.c["throw"],e,t.a.h):(f(t.a,e),e=T(t)),e},this["return"]=function(e){return A(t,e)},r(),this[Symbol.iterator]=function(){return this}}function k(t,e){return x.prototype=t.prototype,new x(new w(e))}function C(t){if(!(t instanceof Array)){t=s(t);for(var e,n=[];!(e=t.next()).done;)n.push(e.value);t=n}return t}function M(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function R(t,e,n){t instanceof String&&(t=String(t));for(var r=t.length,i=0;i<r;i++){var a=t[i];if(e.call(n,a,i,t))return{Dd:i,je:a}}return{Dd:-1,je:void 0}}function L(t,e){r(),t instanceof String&&(t+="");var n=0,i={next:function(){if(n<t.length){var r=n++;return{value:e(r,t[r]),done:!1}}return i.next=function(){return{done:!0,value:void 0}},i.next()}};return i[Symbol.iterator]=function(){return i},i}function I(t,e,n){if(null==t)throw new TypeError("The 'this' value for String.prototype."+n+" must not be null or undefined");if(e instanceof RegExp)throw new TypeError("First argument to String.prototype."+n+" must not be a regular expression");return t+""}function P(t,e){var n=t.split("."),r=_d;n[0]in r||!r.execScript||r.execScript("var "+n[0]);for(var i;n.length&&(i=n.shift());)n.length||void 0===e?r=r[i]?r[i]:r[i]={}:r[i]=e}function O(t,e){function n(){}n.prototype=e.prototype,t.eg=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.sg=function(t,n,r){return e.prototype[n].apply(t,Array.prototype.slice.call(arguments,2))}}function D(t){this.c=Math.exp(Math.log(.5)/t),this.b=this.a=0}function N(t,e,n){var r=Math.pow(t.c,e);n=n*(1-r)+r*t.a,isNaN(n)||(t.a=n,t.b+=e)}function U(t){return t.a/(1-Math.pow(t.c,t.b))}function F(){this.b=new D(2),this.c=new D(5),this.a=0}function B(){}function j(){}function V(){}function G(t){var e;t instanceof G?(z(this,t.va),this.$a=t.$a,this.ra=t.ra,H(this,t.xb),this.ia=t.ia,K(this,t.a.clone()),this.Qa=t.Qa):t&&(e=String(t).match(bd))?(z(this,e[1]||"",!0),this.$a=Y(e[2]||""),this.ra=Y(e[3]||"",!0),H(this,e[4]),this.ia=Y(e[5]||"",!0),K(this,e[6]||"",!0),this.Qa=Y(e[7]||"")):this.a=new X(null)}function z(t,e,n){t.va=n?Y(e,!0):e,t.va&&(t.va=t.va.replace(/:$/,""))}function H(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.xb=e}else t.xb=null}function K(t,e,n){e instanceof X?t.a=e:(n||(e=W(e,Sd)),t.a=new X(e))}function Y(t,e){return t?e?decodeURI(t):decodeURIComponent(t):""}function W(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,q),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function q(t){return t=t.charCodeAt(0),"%"+(t>>4&15).toString(16)+(15&t).toString(16)}function X(t){this.a=t||null}function $(t){this.b=t,this.a=null}function Z(t){this.b=t,this.a=null}function Q(t,e){var n=tt();this.i=null==t.maxAttempts?n.maxAttempts:t.maxAttempts,this.f=null==t.baseDelay?n.baseDelay:t.baseDelay,this.h=null==t.fuzzFactor?n.fuzzFactor:t.fuzzFactor,this.g=null==t.backoffFactor?n.backoffFactor:t.backoffFactor,this.a=0,this.b=this.f,(this.c=void 0!==e&&e)&&(this.a=1)}function J(t){return c(function e(){var n,r;return k(e,function(e){switch(e.j){case 1:if(t.a>=t.i){if(!t.c)return e["return"](Promise.reject());t.a=1,t.b=t.f}return n=t.a,(t.a++,0==n)?e["return"]():(r=t.b*(1+(2*Math.random()-1)*t.h),p(e,new Promise(function(t){new Z(t).O(r/1e3)}),2));case 2:t.b*=t.g,m(e)}})})}function tt(){return{maxAttempts:2,baseDelay:1e3,backoffFactor:2,fuzzFactor:.5,timeout:0}}function et(t,e,n,r){for(var i=[],a=3;a<arguments.length;++a)i[a-3]=arguments[a];this.severity=t,this.category=e,this.code=n,this.data=i,this.handled=!1}function nt(){var t,e,n=new Promise(function(n,r){t=n,e=r});return n.resolve=t,n.reject=e,n}function rt(t,e){this.promise=t,this.Kd=e,this.a=!1}function it(t){return new rt(Promise.reject(t),function(){return Promise.resolve()})}function at(){var t=Promise.reject(new et(2,7,7001));return t["catch"](function(){}),new rt(t,function(){return Promise.resolve()})}function ot(t){return new rt(Promise.resolve(t),function(){return Promise.resolve()})}function st(t){return new rt(t,function(){return t["catch"](function(){})})}function ut(t){return new rt(Promise.all(t.map(function(t){return t.promise})),function(){return Promise.all(t.map(function(t){return t.abort()}))})}function lt(t,e,n){try{var r=t(e);return r&&r.promise&&r.abort?(n.resolve(r.promise),function(){return r.abort()}):(n.resolve(r),function(){return Promise.resolve(r).then(function(){})["catch"](function(){})})}catch(i){return n.reject(i),function(){return Promise.resolve()}}}function ct(e,n){n=void 0===n?{}:n;for(var r in n)this[r]=n[r];this.defaultPrevented=this.cancelable=this.bubbles=!1,this.timeStamp=t.performance&&t.performance.now?t.performance.now():Date.now(),this.type=e,this.isTrusted=!1,this.target=this.currentTarget=null,this.a=!1}function dt(){this.a={}}function ht(){this.Bc=new dt,this.Ub=this}function ft(t){function e(t){switch(typeof t){case"undefined":case"boolean":case"number":case"string":case"symbol":case"function":return t;default:if(!t||t.buffer&&t.buffer.constructor==ArrayBuffer)return t;if(n.has(t))return null;var r=t.constructor==Array;if(t.constructor!=Object&&!r)return null;n.add(t);var i,a=r?[]:{};for(i in t)a[i]=e(t[i]);return r&&(a.length=t.length),a}}var n=new Set;return e(t)}function pt(t,e){return!("number"!=typeof t||"number"!=typeof e||!isNaN(t)||!isNaN(e))||t===e}function mt(t,e){var n=t.indexOf(e);-1<n&&t.splice(n,1)}function gt(t,e){var n=0;return t.forEach(function(t){n+=e(t)?1:0}),n}function vt(t,e,n){if(n||(n=pt),t.length!=e.length)return!1;e=e.slice();var r={};t=s(t);for(var i=t.next();!i.done;r={item:r.item},i=t.next()){if(r.item=i.value,-1==(i=e.findIndex(function(t){return function(e){return n(t.item,e)}}(r))))return!1;e[i]=e[e.length-1],e.pop()}return 0==e.length}function yt(){this.a=[]}function _t(t,e){t.a.push(e["finally"](function(){mt(t.a,e)}))}function bt(t){ht.call(this),this.f=!1,this.g=new yt,this.a=new Set,this.b=new Set,this.c=t||null}function Et(t,e,n){n=n||3;var r=kd[t];(!r||n>=r.priority)&&(kd[t]={priority:n,zf:e})}function wt(t,e){return{uris:t,method:"GET",body:null,headers:{},allowCrossSiteCredentials:!1,retryParameters:e,licenseRequestType:null}}function At(t,e,n){var r=ot(void 0),i={};t=s(t.a);for(var a=t.next();!a.done;i={ed:i.ed},a=t.next())i.ed=a.value,r=r.U(function(t){return function(){return t.ed(e,n)}}(i));return r.U(void 0,function(t){if(t&&7001==t.code)throw t;throw new et(2,1,1006,t)})}function St(t,e,n,r,i,a,o){var s=new G(n.uris[i]),u=s.va,l=!1;u||(u=location.protocol,u=u.slice(0,-1),z(s,u),n.uris[i]=s.toString());var c=(u=kd[u])?u.zf:null;if(!c)return it(new et(2,1,1e3,s));var d;return st(J(r)).U(function(){return t.f?at():(d=Date.now(),c(n.uris[i],n,e,function(n,r,i){t.c&&1==e&&(t.c(n,r),l=!0,o.a=i)}))}).U(function(t){return void 0==t.timeMs&&(t.timeMs=Date.now()-d),{response:t,Ze:l}},function(s){if(s&&7001==s.code)throw s;if(t.f)return at();if(s&&1==s.severity)return t.dispatchEvent(new ct("retry",{error:s instanceof et?s:null})),i=(i+1)%n.uris.length,St(t,e,n,r,i,s,o);throw s||a})}function Tt(t,e,n){var r=ot(void 0);t=s(t.b);for(var i=t.next();!i.done;i=t.next())r=r.U(i.value.bind(null,e,n.response));return r.U(function(){return n},function(t){if(t&&7001==t.code)throw t;var e=2;throw t instanceof et&&(e=t.severity),new et(e,1,1007,t)})}function xt(){this.a=0}function kt(t,e,n){rt.call(this,t,e),this.b=n}function Ct(){}function Mt(){this.a=new dt}function Rt(t,e,n,r){this.target=t,this.type=e,this.listener=n,this.a=Lt(t,r),this.target.addEventListener(e,n,this.a)}function Lt(t,e){if(void 0==e)return!1;if("boolean"==typeof e)return e;var n=new Set(["passive","capture"]);return Object.keys(e).filter(function(t){return!n.has(t)}),It(t)?e:e.capture||!1}function It(t){var e=Ld;if(void 0==e){e=!1;try{var n={},r={get:function(){return e=!0,!1}};Object.defineProperty(n,"passive",r),Object.defineProperty(n,"capture",r),r=function(){},t.addEventListener("test",r,n),t.removeEventListener("test",r,n)}catch(i){e=!1}Ld=e}return e||!1}function Pt(t,e){for(var n=[],r=s(t),i=r.next();!i.done;i=r.next())n.push(e(i.value));return n}function Ot(t,e){for(var n=s(t),r=n.next();!r.done;r=n.next())if(!e(r.value))return!1;return!0}function Dt(t){var e=new Map;return Object.keys(t).forEach(function(n){e.set(n,t[n])}),e}function Nt(t){var e={};return t.forEach(function(t,n){e[n]=t}),e}function Ut(t,e){var n=t;return e&&(n+='; codecs="'+e+'"'),n}function Ft(t){var e=[t.mimeType];return Id.forEach(function(n,r){var i=t[r];i&&e.push(n+'="'+i+'"')}),e.join(";")}function Bt(t){t=t.split(".");var e=t[0];return t.pop(),[e,t.join(".")]}function jt(){return!(!t.MediaSource||!MediaSource.isTypeSupported)}function Vt(t){return""!=zt().canPlayType(t)}function Gt(t){return(navigator.userAgent||"").includes(t)}function zt(){return Od||(Pd||(Pd=new Z(function(){Od=null})),(Od=document.querySelector("video")||document.querySelector("audio"))||(Od=document.createElement("video")),Pd.O(1),Od)}function Ht(t){if(!t)return"";t=new Uint8Array(t),239==t[0]&&187==t[1]&&191==t[2]&&(t=t.subarray(3)),t=Xt(t),t=escape(t);try{return decodeURIComponent(t)}catch(e){throw new et(2,2,2004)}}function Kt(t,e,n){if(!t)return"";if(!n&&0!=t.byteLength%2)throw new et(2,2,2004);if(t instanceof ArrayBuffer)var r=t;else n=new Uint8Array(t.byteLength),n.set(new Uint8Array(t)),r=n.buffer;t=Math.floor(t.byteLength/2),n=new Uint16Array(t),r=new DataView(r);for(var i=0;i<t;i++)n[i]=r.getUint16(2*i,e);return Xt(n)}function Yt(t){var e=new Uint8Array(t);if(239==e[0]&&187==e[1]&&191==e[2])return Ht(e);if(254==e[0]&&255==e[1])return Kt(e.subarray(2),!1);if(255==e[0]&&254==e[1])return Kt(e.subarray(2),!0);var n=function(t,e){return t.byteLength<=e||32<=t[e]&&126>=t[e]}.bind(null,e);if(0==e[0]&&0==e[2])return Kt(t,!1);if(0==e[1]&&0==e[3])return Kt(t,!0);if(n(0)&&n(1)&&n(2)&&n(3))return Ht(t);throw new et(2,2,2003)}function Wt(t){t=encodeURIComponent(t),t=unescape(t);for(var e=new Uint8Array(t.length),n=0;n<t.length;++n)e[n]=t.charCodeAt(n);return e.buffer}function qt(t,e){for(var n=new Uint8Array(2*t.length),r=new DataView(n.buffer),i=0;i<t.length;++i)r.setUint16(2*i,t.charCodeAt(i),e);return n.buffer}function Xt(t){if(!Dd)for(var e={size:65536};0<e.size;e={size:e.size},e.size/=2)if(function(t){try{return C(new Uint8Array(t)),!0}catch(e){return!1}}(e.size)){Dd=function(t){return function(e){for(var n="",r=0;r<e.length;r+=t.size)n+=String.fromCharCode.apply(String,C(e.subarray(r,r+t.size)));return n}}(e);break}return Dd(t)}function $t(e,n){var r=Xt(e);return n=void 0==n||n,r=t.btoa(r).replace(/\+/g,"-").replace(/\//g,"_"),n?r:r.replace(/=*$/,"")}function Zt(e){e=t.atob(e.replace(/-/g,"+").replace(/_/g,"/"));for(var n=new Uint8Array(e.length),r=0;r<e.length;++r)n[r]=e.charCodeAt(r);return n}function Qt(e){for(var n=new Uint8Array(e.length/2),r=0;r<e.length;r+=2)n[r/2]=t.parseInt(e.substr(r,2),16);return n}function Jt(t){for(var e="",n=0;n<t.length;++n){var r=t[n].toString(16);1==r.length&&(r="0"+r),e+=r}return e}function te(t,e){if(!t&&!e)return!0;if(!t||!e||t.length!=e.length)return!1;for(var n=0;n<t.length;++n)if(t[n]!=e[n])return!1;return!0}function ee(t){for(var e=[],n=0;n<arguments.length;++n)e[n]=arguments[n];for(var r=n=0;r<e.length;++r)n+=e[r].length;n=new Uint8Array(n);for(var i=r=0;i<e.length;++i)n.set(e[i],r),r+=e[i].length;return n}function ne(t){var e=this;this.C=t,this.v=new Set,this.m=this.h=null,this.P=!1,this.a=null,this.i=new Mt,this.b=new Map,this.o=[],this.l=new nt,this.f=null,this.g=function(n){e.l.reject(n),t.onError(n)},this.na=new Map,this.T=new Map,this.M=new Z(function(){return Ae(e)}),this.c=!1,this.$=new nt,this.D=!1,this.G=[],this.ma=!1,this.W=new Z(function(){ke(e)}).La(1),this.l["catch"](function(){})}function re(t){return c(function e(){var n;return k(e,function(e){switch(e.j){case 1:return t.i.release(),t.i=null,t.l.reject(),t.W.stop(),t.W=null,t.M.stop(),t.M=null,n=Array.from(t.b.keys()),t.b.clear(),p(e,Promise.all(n.map(function(t){return Promise.resolve().then(function(){return c(function e(){return k(e,function(e){switch(e.j){case 1:return g(e,2),p(e,Ie(t),4);case 4:y(e,0);break;case 2:_(e),m(e)}})})})})),2);case 2:if(!t.m){e.A(3);break}return g(e,4),p(e,t.m.setMediaKeys(null),6);case 6:y(e,5);break;case 4:_(e);case 5:t.m=null;case 3:t.a=null,t.v.clear(),t.h=null,t.o=[],t.f=null,t.g=null,t.C=null,m(e)}})})}function ie(t,e,n){return t.o=[],t.D=n,se(t,e)}function ae(t,e,n){return t.o=n,t.D=0<n.length,se(t,e)}function oe(t,e,n,r,i,a){var o=new Map;return o.set(e,{audioCapabilities:i,videoCapabilities:a,distinctiveIdentifier:"optional",persistentState:"required",sessionTypes:["persistent-license"],label:e,drmInfos:[{keySystem:e,licenseServerUri:n,distinctiveIdentifierRequired:!1,persistentStateRequired:!0,audioRobustness:"",videoRobustness:"",serverCertificate:r,initData:null,keyIds:null}]}),me(t,o)}function se(t,e){var n=e.some(function(t){return 0<t.drmInfos.length});if(!n){var r=Dt(t.f.servers);Me(e,r)}var i=ge(t);if(i){var a=s(e);for(r=a.next();!r.done;r=a.next())r.value.drmInfos=[i]}for(i=s(e),r=i.next();!r.done;r=i.next())for(r=s(r.value.drmInfos),a=r.next();!a.done;a=r.next())Le(a.value,Dt(t.f.servers),Dt(t.f.advanced||{}));return r=pe(t,e),r.size?(r=me(t,r),n?r:r["catch"](function(){})):(t.P=!0,Promise.resolve())}function ue(t){return c(function e(){var n;return k(e,function(e){switch(e.j){case 1:if(!(t.h&&t.a&&t.a.serverCertificate&&t.a.serverCertificate.length)){e.A(0);break}return g(e,3),p(e,t.h.setServerCertificate(t.a.serverCertificate),5);case 5:y(e,0);break;case 3:return n=_(e),e["return"](Promise.reject(new et(2,6,6004,n.message)))}})})}function le(t,e){return c(function n(){var r,i,a;return k(n,function(n){switch(n.j){case 1:return p(n,ve(t,e),2);case 2:return(r=n.s)?(i=[],(a=t.b.get(r))&&(a.xa=new nt,i.push(a.xa)),i.push(r.remove()),p(n,Promise.all(i),0)):n["return"]()}})})}function ce(t){var e=t.a?t.a.initData:[];return e.forEach(function(e){return ye(t,e.initDataType,e.initData)}),t.o.forEach(function(e){return ve(t,e)}),e.length||t.o.length||t.l.resolve(),t.l}function de(t,e,n){var r=t.b.values();r=s(r);for(var i=r.next();!i.done;i=r.next())if(te(n,i.value.initData))return;ye(t,e,n)}function he(t,e){return!!Gt("Edge/")||t.v.has(e)}function fe(t){return t=t.b.keys(),t=Pt(t,function(t){return t.sessionId}),Array.from(t)}function pe(t,e){for(var n=new Set,r=s(e),i=r.next();!i.done;i=r.next()){var a=s(i.value.drmInfos);for(i=a.next();!i.done;i=a.next())n.add(i.value)}for(r=s(n),i=r.next();!i.done;i=r.next())Le(i.value,Dt(t.f.servers),Dt(t.f.advanced||{}));a=t.D?"required":"optional";var o=t.D?["persistent-license"]:["temporary"];for(r=new Map,n=s(n),i=n.next();!i.done;i=n.next())i=i.value,r.set(i.keySystem,{audioCapabilities:[],videoCapabilities:[],distinctiveIdentifier:"optional",persistentState:a,sessionTypes:o,label:i.keySystem,drmInfos:[]});for(n=s(e),i=n.next();!i.done;i=n.next()){i=i.value,a=i.audio,o=i.video;var u=a?Ut(a.mimeType,a.codecs):"",l=o?Ut(o.mimeType,o.codecs):"",c=s(i.drmInfos);for(i=c.next();!i.done;i=c.next()){i=i.value;var d=r.get(i.keySystem);d.drmInfos.push(i),i.distinctiveIdentifierRequired&&(d.distinctiveIdentifier="required"),i.persistentStateRequired&&(d.persistentState="required"),a&&d.audioCapabilities.push({robustness:i.audioRobustness||"",contentType:u}),o&&d.videoCapabilities.push({robustness:i.videoRobustness||"",contentType:l})}}return r}function me(t,e){if(1==e.size&&e.has(""))return Promise.reject(new et(2,6,6e3));for(var n=s(e.values()),r=n.next();!r.done;r=n.next())r=r.value,0==r.audioCapabilities.length&&delete r.audioCapabilities,0==r.videoCapabilities.length&&delete r.videoCapabilities;var i=n=new nt;return[!0,!1].forEach(function(t){var n=this;e.forEach(function(e,r){e.drmInfos.some(function(t){return!!t.licenseServerUri})==t&&(i=i["catch"](function(){if(!this.c)return navigator.requestMediaKeySystemAccess(r,[e])}.bind(n)))})}.bind(t)),i=i["catch"](function(){return Promise.reject(new et(2,6,6001))}),i=i.then(function(t){if(this.c)return Promise.reject();this.v.clear();var n=t.getConfiguration(),r=n.videoCapabilities||[],i=s(n.audioCapabilities||[]);for(n=i.next();!n.done;n=i.next())this.v.add(n.value.contentType);for(r=s(r),n=r.next();!n.done;n=r.next())this.v.add(n.value.contentType);r=t.keySystem,n=e.get(t.keySystem),i=[];var a=[],o=[],u=[];return Re(n.drmInfos,i,a,o,u),this.a={keySystem:r,licenseServerUri:i[0],distinctiveIdentifierRequired:"required"==n.distinctiveIdentifier,persistentStateRequired:"required"==n.persistentState,audioRobustness:n.audioCapabilities?n.audioCapabilities[0].robustness:"",videoRobustness:n.videoCapabilities?n.videoCapabilities[0].robustness:"",serverCertificate:a[0],initData:o,keyIds:u},this.a.licenseServerUri?t.createMediaKeys():Promise.reject(new et(2,6,6012,this.a.keySystem))}.bind(t)).then(function(t){if(this.c)return Promise.reject();this.h=t,this.P=!0}.bind(t))["catch"](function(t){if(!this.c)return this.a=null,this.v.clear(),t instanceof et?Promise.reject(t):Promise.reject(new et(2,6,6002,t.message))}.bind(t)),n.reject(),i}function ge(e){if(e=Dt(e.f.clearKeys),0==e.size)return null;var n=[],r=[];e.forEach(function(t,e){var i=Qt(e),a=Qt(t);i={kty:"oct",kid:$t(i,!1),k:$t(a,!1)},n.push(i),r.push(i.kid)}),e=JSON.stringify({keys:n});var i=JSON.stringify({kids:r});return i=[{initData:new Uint8Array(Wt(i)),initDataType:"keyids"}],{keySystem:"org.w3.clearkey",licenseServerUri:"data:application/json;base64,"+t.btoa(e),distinctiveIdentifierRequired:!1,persistentStateRequired:!1,audioRobustness:"",videoRobustness:"",serverCertificate:null,initData:i,keyIds:[]}}function ve(t,e){try{var n=t.h.createSession("persistent-license")}catch(a){var r=new et(2,6,6005,a.message);return t.g(r),Promise.reject(r)}t.i.w(n,"message",t.Sd.bind(t)),t.i.w(n,"keystatuseschange",t.Qd.bind(t));var i={initData:null,loaded:!1,Xc:1/0,xa:null};return t.b.set(n,i),n.load(e).then(function(t){return this.c?Promise.reject():t?(i.loaded=!0,Ce(this)&&this.l.resolve(),n):(this.b["delete"](n),void this.g(new et(2,6,6013)))}.bind(t),function(t){this.c||(this.b["delete"](n),this.g(new et(2,6,6005,t.message)))}.bind(t))}function ye(t,e,n){try{var r=t.D?t.h.createSession("persistent-license"):t.h.createSession()}catch(i){return void t.g(new et(2,6,6005,i.message))}t.i.w(r,"message",t.Sd.bind(t)),t.i.w(r,"keystatuseschange",t.Qd.bind(t)),t.b.set(r,{initData:n,loaded:!1,Xc:1/0,xa:null}),r.generateRequest(e,n.buffer)["catch"](function(e){if(!t.c){if(t.b["delete"](r),e.errorCode&&e.errorCode.systemCode){var n=e.errorCode.systemCode;0>n&&(n+=Math.pow(2,32)),n="0x"+n.toString(16)}t.g(new et(2,6,6006,e.message,e,n))}})}function _e(t,e){var n=e.target,r=t.b.get(n),i=t.a.licenseServerUri,a=t.f.advanced[t.a.keySystem];"individualization-request"==e.messageType&&a&&a.individualizationServer&&(i=a.individualizationServer),i=wt([i],t.f.retryParameters),i.body=e.message,i.method="POST",i.licenseRequestType=e.messageType,"com.microsoft.playready"!=t.a.keySystem&&"com.chromecast.playready"!=t.a.keySystem||be(i),t.a.keySystem.startsWith("com.apple.fps")&&Ee(i),t.C.rb.request(2,i).promise.then(function(t){return this.c?Promise.reject():(this.a.keySystem.startsWith("com.apple.fps")&&we(t),n.update(t.data).then(function(){var t=this;this.C.onEvent(new ct("drmsessionupdate")),r&&(r.xa&&r.xa.resolve(),new Z(function(){r.loaded=!0,Ce(t)&&t.l.resolve()}).O(Ud))}.bind(this)))}.bind(t),function(t){this.c||(t=new et(2,6,6007,t),this.g(t),r&&r.xa&&r.xa.reject(t))}.bind(t))["catch"](function(t){this.c||(t=new et(2,6,6008,t.message),this.g(t),r&&r.xa&&r.xa.reject(t))}.bind(t))}function be(t){var e=Kt(t.body,!0,!0);if(e.includes("PlayReadyKeyMessage")){e=(new DOMParser).parseFromString(e,"application/xml");for(var n=e.getElementsByTagName("HttpHeader"),r=0;r<n.length;++r)t.headers[n[r].querySelector("name").textContent]=n[r].querySelector("value").textContent;t.body=Zt(e.querySelector("Challenge").textContent).buffer}else t.headers["Content-Type"]="text/xml; charset=utf-8"}function Ee(t){var e=new Uint8Array(t.body);e="spc="+$t(e),t.headers["Content-Type"]="application/x-www-form-urlencoded",t.body=Wt(e)}function we(t){try{var e=Ht(t.data)}catch(n){return}e=e.trim(),"<ckc>"===e.substr(0,5)&&"</ckc>"===e.substr(-6)&&(e=e.slice(5,-6));try{e=JSON.parse(e).ckc}catch(n){}t.data=Zt(e).buffer}function Ae(t){var e=t.na,n=t.T;n.clear(),e.forEach(function(t,e){return n.set(e,t)}),e=Array.from(n.values()),e.length&&e.every(function(t){return"expired"==t})&&t.g(new et(2,6,6014)),t.C.kc(Nt(n))}function Se(){function t(t){return c(function e(){var i,a,o;return k(e,function(e){switch(e.j){case 1:return g(e,2),p(e,navigator.requestMediaKeySystemAccess(t,n),4);case 4:return i=e.s,o=!!(a=i.getConfiguration().sessionTypes)&&a.includes("persistent-license"),Gt("Tizen 3")&&(o=!1),r.set(t,{persistentState:o}),p(e,i.createMediaKeys(),5);case 5:y(e,0);break;case 2:_(e),r.set(t,null),m(e)}})})}var e=[{contentType:'video/mp4; codecs="avc1.42E01E"'},{contentType:'video/webm; codecs="vp8"'}],n=[{videoCapabilities:e,persistentState:"required",sessionTypes:["persistent-license"]},{videoCapabilities:e}],r=new Map;return e="org.w3.clearkey com.widevine.alpha com.microsoft.playready com.apple.fps.3_0 com.apple.fps.2_0 com.apple.fps.1_0 com.apple.fps com.adobe.primetime".split(" ").map(function(e){return t(e)}),Promise.all(e).then(function(){return Nt(r)})}function Te(t,e){var n=e.audio,r=e.video;if(n&&n.encrypted&&!he(t,Ut(n.mimeType,n.codecs))||r&&r.encrypted&&!he(t,Ut(r.mimeType,r.codecs)))return!1;var i=t.keySystem();return 0==e.drmInfos.length||e.drmInfos.some(function(t){return t.keySystem==i})}function xe(t,e){if(!t.length)return e;if(!e.length)return t;for(var n=[],r=0;r<t.length;r++)for(var i=0;i<e.length;i++)if(t[r].keySystem==e[i].keySystem){var a=t[r];i=e[i];var o=[];o=o.concat(a.initData||[]),o=o.concat(i.initData||[]);var s=[];s=s.concat(a.keyIds),s=s.concat(i.keyIds),n.push({keySystem:a.keySystem,licenseServerUri:a.licenseServerUri||i.licenseServerUri,distinctiveIdentifierRequired:a.distinctiveIdentifierRequired||i.distinctiveIdentifierRequired,persistentStateRequired:a.persistentStateRequired||i.persistentStateRequired,videoRobustness:a.videoRobustness||i.videoRobustness,audioRobustness:a.audioRobustness||i.audioRobustness,serverCertificate:a.serverCertificate||i.serverCertificate,initData:o,keyIds:s});break}return n}function ke(t){t.b.forEach(function(e,n){var r=e.Xc,i=n.expiration;isNaN(i)&&(i=1/0),i!=r&&(t.C.onExpirationUpdated(n.sessionId,i),e.Xc=i)})}function Ce(t){return t=t.b.values(),Ot(t,function(t){return t.loaded})}function Me(t,e){var n=[];e.forEach(function(t,e){n.push({keySystem:e,licenseServerUri:t,distinctiveIdentifierRequired:!1,persistentStateRequired:!1,audioRobustness:"",videoRobustness:"",serverCertificate:null,initData:[],keyIds:[]})});for(var r=s(t),i=r.next();!i.done;i=r.next())i.value.drmInfos=n}function Re(t,e,n,r,i){t.forEach(function(t){if(e.includes(t.licenseServerUri)||e.push(t.licenseServerUri),t.serverCertificate&&(n.some(function(e){return te(e,t.serverCertificate)})||n.push(t.serverCertificate)),t.initData&&t.initData.forEach(function(t){r.some(function(e){return!(!e.keyId||e.keyId!=t.keyId)||e.initDataType==t.initDataType&&te(e.initData,t.initData)})||r.push(t)}),t.keyIds)for(var a=0;a<t.keyIds.length;++a)i.includes(t.keyIds[a])||i.push(t.keyIds[a])})}function Le(e,n,r){!e.keySystem||"org.w3.clearkey"==e.keySystem&&e.licenseServerUri||(n.size&&(n=n.get(e.keySystem)||"",e.licenseServerUri=n),e.keyIds||(e.keyIds=[]),(r=r.get(e.keySystem))&&(e.distinctiveIdentifierRequired||(e.distinctiveIdentifierRequired=r.distinctiveIdentifierRequired),e.persistentStateRequired||(e.persistentStateRequired=r.persistentStateRequired),e.videoRobustness||(e.videoRobustness=r.videoRobustness),e.audioRobustness||(e.audioRobustness=r.audioRobustness),e.serverCertificate||(e.serverCertificate=r.serverCertificate)),t.cast&&t.cast.__platform__&&"com.microsoft.playready"==e.keySystem&&(e.keySystem="com.chromecast.playready"))}function Ie(t){return c(function e(){var n;return k(e,function(e){switch(e.j){case 1:return n=new Promise(function(t){new Z(t).O(Nd)}),p(e,Promise.race([t.close().then(function(){return!0}),n.then(function(){return!1})]),2);case 2:m(e)}})})}function Pe(){this.a=new muxjs.mp4.CaptionParser,this.g=[],this.f={}}function Oe(){}function De(t){return!t||1==t.length&&1e-6>t.end(0)-t.start(0)?null:t.length?t.end(t.length-1):null}function Ne(t,e,n){return n=void 0===n?0:n,!(!t||!t.length||1==t.length&&1e-6>t.end(0)-t.start(0)||e>t.end(t.length-1))&&e+n>=t.start(0)}function Ue(t,e){if(!t||!t.length||1==t.length&&1e-6>t.end(0)-t.start(0))return 0;for(var n=0,r=t.length-1;0<=r&&t.end(r)>e;--r)n+=t.end(r)-Math.max(t.start(r),e);return n}function Fe(t){if(!t)return[];for(var e=[],n=0;n<t.length;n++)e.push({start:t.start(n),end:t.end(n)});return e}function Be(t,e){if(0==e.length)return t;var n=e.map(function(t){return new G(t)});return t.map(function(t){return new G(t)}).map(function(t){return n.map(t.resolve.bind(t))}).reduce(Bd.yc,[]).map(function(t){return t.toString()})}function je(t,e){return{keySystem:t,licenseServerUri:"",distinctiveIdentifierRequired:!1,persistentStateRequired:!1,audioRobustness:"",videoRobustness:"",serverCertificate:null,initData:e||[],keyIds:[]}}function Ve(){this.a=new muxjs.mp4.Transmuxer({keepOriginalTimestamps:!0}),this.b=null,this.g=[],this.c=[],this.f=!1,this.a.on("data",this.i.bind(this)),this.a.on("done",this.h.bind(this))}function Ge(e,n){return!(!t.muxjs||"mp2t"!=e.split(";")[0].split("/")[1])&&(n?MediaSource.isTypeSupported(ze(n,e)):MediaSource.isTypeSupported(ze("audio",e))||MediaSource.isTypeSupported(ze("video",e)))}function ze(t,e){var n=e.replace("mp2t","mp4");"audio"==t&&(n=n.replace("video","audio"));var r=/avc1\.(66|77|100)\.(\d+)/.exec(n);if(r){var i="avc1.",a=r[1],o=Number(r[2]);i=("66"==a?i+"4200":"77"==a?i+"4d00":i+"6400")+(o>>4).toString(16),i+=(15&o).toString(16),n=n.replace(r[0],i)}return n}function He(t,e){t.f=!0,t.b=new nt,t.g=[],t.c=[];var n=new Uint8Array(e);return t.a.push(n),t.a.flush(),t.f&&t.b.reject(new et(2,3,3018)),t.b}function Ke(t,e,n){this.startTime=t,this.direction=Wd,this.endTime=e,this.payload=n,this.region=new Ye,this.position=null,this.positionAlign=Gd,this.size=100,this.textAlign=zd,this.writingMode=qd,this.lineInterpretation=Xd,this.line=null,this.lineHeight="",this.lineAlign=$d,this.displayAlign=Kd,this.backgroundColor=this.color="",this.backgroundImage=null,this.fontSize="",this.fontWeight=Qd,this.fontStyle=Jd,this.fontFamily="",this.textDecoration=[],this.wrapLine=!0,this.id=""}function Ye(){this.id="",this.regionAnchorY=this.regionAnchorX=this.viewportAnchorY=this.viewportAnchorX=0,this.height=this.width=100,this.viewportAnchorUnits=this.widthUnits=this.heightUnits=eh,this.scroll=nh}function We(t){this.g=null,this.c=t,this.f=this.m=0,this.h=1/0,this.b=this.a=null,this.l="",this.i=new Map}function qe(e){return!!(rh[e]||t.muxjs&&"application/cea-608"==e)}function Xe(t,e){"application/cea-608"!=e&&(t.g=new rh[e])}function $e(t,e,n,r){return Promise.resolve().then(function(){if(this.g&&this.c)if(null==n||null==r)this.g.parseInit(new Uint8Array(e));else{var t={periodStart:this.m,segmentStart:n,segmentEnd:r};t=this.g.parseMedia(new Uint8Array(e),t).filter(function(t){return t.startTime>=this.f&&t.startTime<this.h}.bind(this)),this.c.append(t),null==this.a&&(this.a=Math.max(n,this.f)),this.b=Math.min(r,this.h)}}.bind(t))}function Ze(t,e,n,r,i){var a=n+" "+r,o=new Map;e=s(e);for(var u=e.next();!u.done;u=e.next()){var l=u.value;u=l.stream,o.has(u)||o.set(u,new Map),o.get(u).has(a)||o.get(u).set(a,[]),l.startTime+=i,l.endTime+=i,l.startTime>=t.f&&l.startTime<t.h&&(l=new Ke(l.startTime,l.endTime,l.text),o.get(u).get(a).push(l),u==t.l&&t.c.append([l]))}for(i=s(o.keys()),a=i.next();!a.done;a=i.next())for(a=a.value,t.i.has(a)||t.i.set(a,new Map),e=s(o.get(a).keys()),u=e.next();!u.done;u=e.next())u=u.value,l=o.get(a).get(u),t.i.get(a).set(u,l);t.a=null==t.a?Math.max(n,t.f):Math.min(t.a,Math.max(n,t.f)),t.b=Math.max(t.b,Math.min(r,t.h))}function Qe(t,e,n){this.f=t,this.g=n,this.b={},this.a=null,this.c={},this.i=new Mt,this.v=!1,this.l={},this.m=e,t=this.o=new nt,e=new MediaSource,this.i.ha(e,"sourceopen",t.resolve),this.f.src=ih(e),this.h=e}function Je(t){var e=Ut(t.mimeType,t.codecs),n=Ft(t);return qe(e)||MediaSource.isTypeSupported(n)||Ge(e,t.type)}function tn(t,e){t.a||(t.a=new We(t.g)),Xe(t.a,e)}function en(t,e){if("text"==e)var n=t.a.a;else n=an(t,e),n=!n||1==n.length&&1e-6>n.end(0)-n.start(0)?null:1==n.length&&0>n.start(0)?0:n.length?n.start(0):null;return n}function nn(t,e){return"text"==e?t.a.b:De(an(t,e))}function rn(t,e,n){return"text"==e?(t=t.a,null==t.b||t.b<n?0:t.b-Math.max(n,t.a)):(t=an(t,e),Ue(t,n))}function an(t,e){try{return t.b[e].buffered}catch(n){return null}}function on(e,n,r,i,a,o){return"text"==n?$e(e.a,r,i,a):e.l[n]?He(e.l[n],r).then(function(t){return this.a||tn(this,"text/vtt"),t.captions&&Ze(this.a,t.captions,i,a,this.b.video.timestampOffset),ln(this,n,this.fe.bind(this,n,t.data.buffer))}.bind(e)):(o&&t.muxjs&&(e.a||tn(e,"text/vtt"),null==i&&null==a?e.m.init(r):e.m.b(r,function(t){t.length&&Ze(e.a,t,i,a,e.b.video.timestampOffset)})),ln(e,n,e.fe.bind(e,n,r)))}function sn(t,e){return"text"==e?t.a?(t.m.c(),t.a.remove(0,1/0)):Promise.resolve():ln(t,e,t.ge.bind(t,e,0,t.h.duration))}function un(t,e,n,r,i){return"text"==e?(t.a.m=n,t=t.a,t.f=r,t.h=i,Promise.resolve()):Promise.all([ln(t,e,t.pe.bind(t,e)),ln(t,e,t.Sf.bind(t,e,n)),ln(t,e,t.Pf.bind(t,e,r,i))])}function ln(t,e,n){if(t.v)return Promise.reject();if(n={start:n,p:new nt},t.c[e].push(n),1==t.c[e].length)try{n.start()}catch(r){"QuotaExceededError"==r.name?n.p.reject(new et(2,3,3017,e)):n.p.reject(new et(2,3,3015,r)),dn(t,e)}return n.p}function cn(t,e){if(t.v)return Promise.reject();var n,r=[];for(n in t.b){var i=new nt,a={start:function(t){t.resolve()}.bind(null,i),p:i};t.c[n].push(a),r.push(i),1==t.c[n].length&&a.start()}return Promise.all(r).then(function(){try{e()}catch(r){var t=Promise.reject(new et(2,3,3015,r))}for(var n in this.b)dn(this,n);return t}.bind(t),function(t){throw t}.bind(t))}function dn(t,e){t.c[e].shift();var n=t.c[e][0];if(n)try{n.start()}catch(r){n.p.reject(new et(2,3,3015,r)),dn(t,e)}}function hn(t,e){return t=pn(t),e=pn(e),t.split("-")[0]==e.split("-")[0]}function fn(t,e){t=pn(t),e=pn(e);var n=t.split("-"),r=e.split("-");return n[0]==r[0]&&1==n.length&&2==r.length}function pn(t){var e=t.split("-");return t=e[0]||"",e=e[1]||"",t=t.toLowerCase(),t=ah.get(t)||t,(e=e.toUpperCase())?t+"-"+e:t}function mn(t){return t.language?pn(t.language):t.audio&&t.audio.language?pn(t.audio.language):t.video&&t.video.language?pn(t.video.language):"und"}function gn(t,e){for(var n=pn(t),r=new Set,i=s(e),a=i.next();!a.done;a=i.next())r.add(pn(a.value));for(i=s(r),a=i.next();!a.done;a=i.next())if((a=a.value)==n)return a;for(i=s(r),a=i.next();!a.done;a=i.next())if(a=a.value,fn(a,n))return a;for(i=s(r),a=i.next();!a.done;a=i.next()){var o=a=a.value,u=n;if(o=pn(o),u=pn(u),o=o.split("-"),u=u.split("-"),2==o.length&&2==u.length&&o[0]==u[0])return a}for(r=s(r),a=r.next();!a.done;a=r.next())if(i=a.value,fn(n,i))return i;return null}function vn(t,e,n){function r(t,e,n){return t>=e&&t<=n}var i=t.video;return!(i&&i.width&&i.height&&!(r(i.width,e.minWidth,Math.min(e.maxWidth,n.width))&&r(i.height,e.minHeight,Math.min(e.maxHeight,n.height))&&r(i.width*i.height,e.minPixels,e.maxPixels))||!r(t.bandwidth,e.minBandwidth,e.maxBandwidth))}function yn(t,e,n){var r=!1;return t.forEach(function(t){var i=t.allowedByApplication;t.allowedByApplication=vn(t,e,n),i!=t.allowedByApplication&&(r=!0)}),r}function _n(t,e,n,r){r.variants=r.variants.filter(function(r){if(t&&t.P&&!Te(t,r))return!1;var i=r.audio;return r=r.video,!(i&&!Je(i)||r&&!Je(r)||i&&e&&!bn(i,e)||r&&n&&!bn(r,n))}),r.textStreams=r.textStreams.filter(function(t){return qe(Ut(t.mimeType,t.codecs))})}function bn(t,e){return t.mimeType==e.mimeType&&t.codecs.split(".")[0]==e.codecs.split(".")[0]}function En(t){var e=t.audio,n=t.video,r=e?e.codecs:null,i=n?n.codecs:null,a=[];i&&a.push(i),r&&a.push(r);var o=[];n&&o.push(n.mimeType),e&&o.push(e.mimeType),o=o[0]||null;var s=[];e&&s.push(e.kind),n&&s.push(n.kind),s=s[0]||null;var u=new Set;return e&&e.roles.forEach(function(t){return u.add(t)}),n&&n.roles.forEach(function(t){return u.add(t)}),t={id:t.id,active:!1,type:"variant",bandwidth:t.bandwidth,language:t.language,label:null,kind:s,width:null,height:null,frameRate:null,mimeType:o,codecs:a.join(", "),audioCodec:r,videoCodec:i,primary:t.primary,roles:Array.from(u),audioRoles:null,videoId:null,audioId:null,channelsCount:null,audioBandwidth:null,videoBandwidth:null,originalVideoId:null,originalAudioId:null,originalTextId:null},n&&(t.videoId=n.id,t.originalVideoId=n.originalId,t.width=n.width||null,t.height=n.height||null,t.frameRate=n.frameRate||null,t.videoBandwidth=n.bandwidth||null),e&&(t.audioId=e.id,t.originalAudioId=e.originalId,t.channelsCount=e.channelsCount,t.audioBandwidth=e.bandwidth||null,t.label=e.label,t.audioRoles=e.roles),t}function wn(t){return{id:t.id,active:!1,type:"text",bandwidth:0,language:t.language,label:t.label,kind:t.kind||null,width:null,height:null,frameRate:null,mimeType:t.mimeType,codecs:t.codecs||null,audioCodec:null,videoCodec:null,primary:t.primary,roles:t.roles,audioRoles:null,videoId:null,audioId:null,channelsCount:null,audioBandwidth:null,videoBandwidth:null,originalVideoId:null,originalAudioId:null,originalTextId:t.originalId}}function An(t){return t.__shaka_id||(t.__shaka_id=oh++),t.__shaka_id}function Sn(t){return{id:An(t),active:!1,type:"",bandwidth:0,language:pn(t.language),label:t.label,kind:t.kind,width:null,height:null,frameRate:null,mimeType:null,codecs:null,audioCodec:null,videoCodec:null,primary:!1,roles:[],audioRoles:null,videoId:null,audioId:null,channelsCount:null,audioBandwidth:null,videoBandwidth:null,originalVideoId:null,originalAudioId:null,originalTextId:null}}function Tn(t){return t.allowedByApplication&&t.allowedByKeySystem}function xn(t){return t.filter(function(t){return Tn(t)})}function kn(t,e){var n=t.filter(function(t){return t.audio&&t.audio.channelsCount}),r=new Map;n=s(n);for(var i=n.next();!i.done;i=n.next()){i=i.value;var a=i.audio.channelsCount;r.has(a)||r.set(a,[]),r.get(a).push(i)}return n=Array.from(r.keys()),0==n.length?t:(i=n.filter(function(t){return t<=e}),i.length?r.get(Math.max.apply(null,i)):r.get(Math.min.apply(null,n)))}function Cn(t,e,n){var r=t,i=t.filter(function(t){return t.primary});i.length&&(r=i);var a=r.length?r[0].language:"";if(r=r.filter(function(t){return t.language==a}),e){var o=gn(pn(e),t.map(function(t){return t.language}));o&&(r=t.filter(function(t){return pn(t.language)==o}))}if(n){if(t=Mn(r,n),t.length)return t}else if(t=r.filter(function(t){return 0==t.roles.length}),t.length)return t;return t=r.map(function(t){return t.roles}).reduce(Bd.yc,[]),t.length?Mn(r,t[0]):r}function Mn(t,e){return t.filter(function(t){return t.roles.includes(e)})}function Rn(t,e,n){for(var r=0;r<n.length;r++)if(n[r].audio==t&&n[r].video==e)return n[r];return null}function Ln(t){var e=[];return t.audio&&e.push(t.audio),t.video&&e.push(t.video),e}function In(){this.h=null,this.f=!1,this.b=new F,this.c=[],this.i=!1,this.a=this.g=null}function Pn(t,e){return t&&(e=e.filter(function(e){return vn(e,t,{width:1/0,height:1/0})})),e.sort(function(t,e){return t.bandwidth-e.bandwidth})}function On(t,e){this.a=t,this.b=e}function Dn(t,e){var n=new On(2,6),r=sh,i=r.a,a=n.b-i.b;(0<(n.a-i.a||a)?r.c:r.b)(r.a,n,t,e)}function Nn(t,e,n,r){j([n,"has been deprecated and will be removed in",e,". We are currently at version",t,". Additional information:",r].join(" "))}function Un(t,e,n,r){B([n,"has been deprecated and has been removed in",e,". We are now at version",t,". Additional information:",r].join(""))}function Fn(t){return JSON.stringify(t,function(t,e){if("function"!=typeof e){if(e instanceof Event||e instanceof ct){var n,r={};for(n in e){var i=e[n];i&&"object"==typeof i?"detail"==n&&(r[n]=i):n in Event||(r[n]=i)}return r}if(e instanceof TimeRanges)for(r={__type__:"TimeRanges",length:e.length,start:[],end:[]},n=0;n<e.length;++n)r.start.push(e.start(n)),r.end.push(e.end(n));else r=e instanceof Uint8Array?{__type__:"Uint8Array",entries:Array.from(e)}:"number"==typeof e?isNaN(e)?"NaN":isFinite(e)?e:0>e?"-Infinity":"Infinity":e;return r}})}function Bn(t){return JSON.parse(t,function(t,e){return"NaN"==e?NaN:"-Infinity"==e?-1/0:"Infinity"==e?1/0:e&&"object"==typeof e&&"TimeRanges"==e.__type__?jn(e):e&&"object"==typeof e&&"Uint8Array"==e.__type__?new Uint8Array(e.entries):e})}function jn(t){return{length:t.length,start:function(e){return t.start[e]},end:function(e){return t.end[e]}}}function Vn(t,e,n,r,i,a){this.P=t,this.f=new Z(e),this.T=n,this.l=!1,this.G=r,this.M=i,this.C=a,this.b=this.h=!1,this.D="",this.i=null,this.m=this.Od.bind(this),this.o=this.kf.bind(this),this.a={video:{},player:{}},this.v=0,this.c={},this.g=null}function Gn(t){var e=bh;e.removeUpdateListener(t.m),e.removeMessageListener("urn:x-cast:com.google.shaka.v2",t.o)}function zn(t){for(var e in t.c){var n=t.c[e];delete t.c[e],n.reject(new et(1,7,7e3))}}function Hn(t){t=Fn(t),bh.sendMessage("urn:x-cast:com.google.shaka.v2",t,function(){},V)}function Kn(t,e,n){ht.call(this),this.c=t,this.b=e,this.i=this.g=this.f=this.l=this.h=null,this.a=new Vn(n,this.Tf.bind(this),this.Uf.bind(this),this.Vf.bind(this),this.Wf.bind(this),this.Bd.bind(this)),Yn(this)}function Yn(t){t.a.init(),t.i=new Mt,uh.forEach(function(t){this.i.w(this.c,t,this.mg.bind(this))}.bind(t)),hh.forEach(function(t){this.i.w(this.b,t,this.yf.bind(this))}.bind(t)),t.h={};for(var e in t.c)Object.defineProperty(t.h,e,{configurable:!1,enumerable:!0,get:t.lg.bind(t,e),set:t.ng.bind(t,e)});t.l={};for(var n in t.b)Object.defineProperty(t.l,n,{configurable:!1,enumerable:!0,get:t.Vd.bind(t,n)});t.f=new ht,t.f.Ub=t.h,t.g=new ht,t.g.Ub=t.l}function Wn(t,e,n,r){var i=this;ht.call(this),this.a=t,this.b=e,this.c=new Mt,this.D={video:t,player:e},this.o=n||function(){},this.G=r||function(t){return t},this.v=!1,this.h=!0,this.g=0,this.m=!1,this.l=!0,this.i=this.f=null,this.C=new Z(function(){Zn(i)}),qn(this)}function qn(t){var e=cast.receiver.CastReceiverManager.getInstance();e.onSenderConnected=t.Rd.bind(t),e.onSenderDisconnected=t.Rd.bind(t),e.onSystemVolumeChanged=t.Be.bind(t),t.i=e.getCastMessageBus("urn:x-cast:com.google.cast.media"),t.i.onMessage=t.ef.bind(t),t.f=e.getCastMessageBus("urn:x-cast:com.google.shaka.v2"),t.f.onMessage=t.rf.bind(t),e.start(),uh.forEach(function(t){this.c.w(this.a,t,this.Xd.bind(this,"video"))}.bind(t)),hh.forEach(function(t){this.c.w(this.b,t,this.Xd.bind(this,"player"))}.bind(t)),cast.__platform__&&cast.__platform__.canDisplayType('video/mp4; codecs="avc1.640028"; width=3840; height=2160')?t.b.jd(3840,2160):t.b.jd(1920,1080),t.c.w(t.a,"loadeddata",function(){this.m=!0}.bind(t)),t.c.w(t.b,"loading",function(){this.h=!1,Xn(this)}.bind(t)),t.c.w(t.a,"playing",function(){this.h=!1,Xn(this)}.bind(t)),t.c.w(t.a,"pause",function(){Xn(this)}.bind(t)),t.c.w(t.b,"unloading",function(){this.h=!0,Xn(this)}.bind(t)),t.c.w(t.a,"ended",function(){var t=this;new Z(function(){t.a&&t.a.ended&&(t.h=!0,Xn(t))}).O(5)}.bind(t))}function Xn(t){Promise.resolve().then(function(){this.b&&(this.dispatchEvent(new ct("caststatuschanged")),Qn(this)||er(this,0))}.bind(t))}function $n(t,e,n){for(var r in e.player)t.b[r](e.player[r]);t.o(n),n=Promise.resolve();var i=t.a.autoplay;e.manifest&&(t.a.autoplay=!1,n=t.b.load(e.manifest,e.startTime)),n.then(function(){if(t.b){for(var n in e.video)t.a[n]=e.video[n];for(var r in e.playerAfterLoad)t.b[r](e.playerAfterLoad[r]);t.a.autoplay=i,e.manifest&&(t.a.play(),er(t,0))}},function(e){t.b.dispatchEvent(new ct("error",{detail:e}))})}function Zn(t){t.C.O(.5);var e={video:{},player:{}};if(lh.forEach(function(t){e.video[t]=this.a[t]}.bind(t)),t.b.V())for(var n in ph)0==t.g%ph[n]&&(e.player[n]=t.b[n]());for(var r in fh)0==t.g%fh[r]&&(e.player[r]=t.b[r]());(n=cast.receiver.CastReceiverManager.getInstance().getSystemVolume())&&(e.video.volume=n.level,e.video.muted=n.muted),t.m&&(t.g+=1),tr(t,{type:"update",update:e},t.f),Qn(t)}function Qn(t){return!(!t.l||!t.a.duration&&!t.b.V())&&(Jn(t),t.l=!1,!0)}function Jn(t){er(t,0,{contentId:t.b.bc(),streamType:t.b.V()?"LIVE":"BUFFERED",duration:t.a.duration,contentType:""})}function tr(t,e,n,r){t.v&&(t=Fn(e),r?n.getCastChannel(r).send(t):n.broadcast(t))}function er(t,e,n){var r=t.a.playbackRate,i=Eh;i=t.h?i.IDLE:t.b.Nc()?i.ke:t.a.paused?i.me:i.ne,r={mediaSessionId:0,playbackRate:r,playerState:i,currentTime:t.a.currentTime,supportedMediaCommands:15,volume:{level:t.a.volume,muted:t.a.muted}},n&&(r.media=n),tr(t,{requestId:e,type:"MEDIA_STATUS",status:[r]},t.i)}function nr(t,e,n){var r=sr(t),i=null;t=[];var a=[],o=new Set(r.map(function(t){return t.keyId}));if(o["delete"](null),1<o.size)throw new et(2,4,4010);if(n||(a=r.filter(function(t){return"urn:mpeg:dash:mp4protection:2011"!=t.be||(i=t.init||i,!1)}),a.length&&(t=or(i,e,a),0==t.length&&(t=[je("",i)]))),r.length&&(n||!a.length))for(t=[],e=s(Ah.values()),n=e.next();!n.done;n=e.next())"org.w3.clearkey"!=(n=n.value)&&t.push(je(n,i));if(o=Array.from(o)[0]||null)for(e=s(t),n=e.next();!n.done;n=e.next())for(n=s(n.value.initData),r=n.next();!r.done;r=n.next())r.value.keyId=o;return{vd:o,tg:i,drmInfos:t,Ad:!0}}function rr(t,e,n,r){var i=nr(t,e,r);if(n.Ad)t=1==n.drmInfos.length&&!n.drmInfos[0].keySystem,e=0==i.drmInfos.length,(0==n.drmInfos.length||t&&!e)&&(n.drmInfos=i.drmInfos),n.Ad=!1;else if(0<i.drmInfos.length&&(n.drmInfos=n.drmInfos.filter(function(t){return i.drmInfos.some(function(e){return e.keySystem==t.keySystem})}),0==n.drmInfos.length))throw new et(2,4,4008);return i.vd||n.vd}function ir(t){var e=0,n=new DataView(t).getUint32(e,!0);if(n!==t.byteLength)return[];e+=6,n=[];for(var r=new DataView(t);e<t.byteLength-1;){var i=r.getUint16(e,!0);e+=2;var a=r.getUint16(e,!0);e+=2;var o=new Uint8Array(t,e,a);n.push({type:i,value:o}),e+=a}return n}function ar(t){return(t=t.querySelector("DATA > LA_URL"))?t.textContent:""}function or(t,e,n){var r=[];n=s(n);for(var i=n.next();!i.done;i=n.next()){i=i.value;var a=Ah.get(i.be);if(a){var o=je(a,i.init||t);(a=Sh.get(a))&&(o.licenseServerUri=a(i)),r.push(o)}else for(i=e(i.node)||[],i=s(i),o=i.next();!o.done;o=i.next())r.push(o.value)}return r}function sr(t){var e=[];t=s(t);for(var n=t.next();!n.done;n=t.next())(n=ur(n.value))&&e.push(n);return e}function ur(t){var e=t.getAttribute("schemeIdUri"),n=wh.getAttributeNS(t,"urn:mpeg:cenc:2013","default_KID"),r=wh.zd(t,"urn:mpeg:cenc:2013","pssh").map(wh.cc);if(!e)return null;if(e=e.toLowerCase(),n&&(n=n.replace(/-/g,"").toLowerCase(),n.includes(" ")))throw new et(2,4,4009);var i=[];try{i=r.map(function(t){return{initDataType:"cenc",initData:Zt(t),keyId:null}})}catch(a){throw new et(2,4,4007)}return{node:t,be:e,keyId:n,init:0<i.length?i:null}}function lr(e,n,r,i,a){var o={RepresentationID:n,Number:r,Bandwidth:i,Time:a};return e.replace(/\$(RepresentationID|Number|Bandwidth|Time)?(?:%0([0-9]+)([diouxX]))?\$/g,function(e,n,r,i){if("$$"==e)return"$";var a=o[n];if(null==a)return e;switch("RepresentationID"==n&&r&&(r=void 0),"Time"==n&&(a=Math.round(a)),i){case void 0:case"d":case"i":case"u":e=a.toString();break;case"o":e=a.toString(8);break;case"x":e=a.toString(16);break;case"X":e=a.toString(16).toUpperCase();break;default:e=a.toString()}return r=t.parseInt(r,10)||1,Array(Math.max(0,r-e.length)+1).join("0")+e})}function cr(t,e){var n=dr(t,e,"timescale"),r=1;n&&(r=wh.nc(n)||1),n=dr(t,e,"duration"),(n=wh.nc(n||""))&&(n/=r);var i=dr(t,e,"startNumber"),a=Number(dr(t,e,"presentationTimeOffset"))||0,o=wh.vb(i||"");null!=i&&null!=o||(o=1);var s=hr(t,e,"SegmentTimeline");if(i=null,s){i=r;var u=t.S.duration||1/0;s=wh.R(s,"S");for(var l=[],c=0,d=0;d<s.length;++d){var h=s[d],f=wh.J(h,"t",wh.vb),p=wh.J(h,"d",wh.vb);if(h=wh.J(h,"r",wh.parseInt),null!=f&&(f-=a),!p)break;if(f=null!=f?f:c,0>(h=h||0))if(d+1<s.length){if(null==(h=wh.J(s[d+1],"t",wh.vb)))break;if(f>=h)break;h=Math.ceil((h-f)/p)-1}else{if(1/0==u)break;if(f/i>=u)break;h=Math.ceil((u*i-f)/p)-1}0<l.length&&f!=c&&(l[l.length-1].end=f/i);for(var m=0;m<=h;++m)c=f+p,l.push({start:f/i,end:c/i,ig:f}),f=c}i=l}return{timescale:r,Z:n,Za:o,la:a/r||0,rd:a,N:i}}function dr(t,e,n){return[e(t.B),e(t.ca),e(t.ja)].filter(Bd.Ga).map(function(t){return t.getAttribute(n)}).reduce(function(t,e){return t||e})}function hr(t,e,n){return[e(t.B),e(t.ca),e(t.ja)].filter(Bd.Ga).map(function(t){return wh.$b(t,n)}).reduce(function(t,e){return t||e})}function fr(t,e,n,r,i,a){for(var o=wh.getAttributeNS(t,"http://www.w3.org/1999/xlink","href"),s=wh.getAttributeNS(t,"http://www.w3.org/1999/xlink","actuate")||"onRequest",u=0;u<t.attributes.length;u++){var l=t.attributes[u];"http://www.w3.org/1999/xlink"==l.namespaceURI&&(t.removeAttributeNS(l.namespaceURI,l.localName),--u)}if(5<=a)return it(new et(2,4,4028));if("onLoad"!=s)return it(new et(2,4,4027));var c=Be([r],[o]);return i.request(0,wt(c,e)).U(function(r){if(!(r=wh.Td(r.data,t.tagName)))return it(new et(2,4,4001,o));for(;t.childNodes.length;)t.removeChild(t.childNodes[0]);for(;r.childNodes.length;){var s=r.childNodes[0];r.removeChild(s),t.appendChild(s)}for(s=0;s<r.attributes.length;s++){var u=r.attributes[s].nodeName,l=r.getAttribute(u);t.setAttribute(u,l)}return pr(t,e,n,c[0],i,a+1)})}function pr(t,e,n,r,i,a){if(a=void 0===a?0:a,wh.getAttributeNS(t,"http://www.w3.org/1999/xlink","href")){var o=fr(t,e,n,r,i,a);return n&&(o=o.U(void 0,function(){return pr(t,e,n,r,i,a)})),o}o=[];for(var s=0;s<t.childNodes.length;s++){var u=t.childNodes[s];u instanceof Element&&("urn:mpeg:dash:resolve-to-zero:2013"==wh.getAttributeNS(u,"http://www.w3.org/1999/xlink","href")?(t.removeChild(u),--s):"SegmentTimeline"!=u.tagName&&o.push(pr(u,e,n,r,i,a)))}return ut(o).U(function(){return t})}function mr(t,e,n){this.c=t,this.b=e,this.a=n}function gr(t,e,n,r,i,a){this.position=t,this.startTime=e,this.endTime=n,this.c=r,this.b=i,this.a=a}function vr(t,e){this.K=t,this.b=e==Th,this.a=0}function yr(){throw new et(2,3,3e3)}function _r(){this.c=[],this.b=[],this.a=!1}function br(t){for(;t.reader.sa()&&!t.parser.a;)t.parser.mc(t.start,t.reader,t.partialOkay)}function Er(t){for(var e=t.reader.F();0<e&&!t.parser.a;--e)t.parser.mc(t.start,t.reader,t.partialOkay)}function wr(t){return function(e){t(e.reader.Xa(e.reader.K.byteLength-e.reader.ba()))}}function Ar(t){for(var e=0,n=0;n<t.length;n++)e=e<<8|t.charCodeAt(n);return e}function Sr(t){return String.fromCharCode(t>>24&255,t>>16&255,t>>8&255,255&t)}function Tr(t,e,n,r){var i,a=(new _r).ea("sidx",function(t){i=xr(e,r,n,t)});if(t&&a.parse(t),i)return i;throw new et(2,3,3004)}function xr(t,e,n,r){var i=[];r.reader.L(4);var a=r.reader.F();if(0==a)throw new et(2,3,3005);if(0==r.version)var o=r.reader.F(),s=r.reader.F();else o=r.reader.yb(),s=r.reader.yb();r.reader.L(2);var u=r.reader.Lb();for(t=t+r.size+s,s=0;s<u;s++){var l=r.reader.F(),c=(2147483648&l)>>>31;l&=2147483647;var d=r.reader.F();if(r.reader.L(4),1==c)throw new et(2,3,3006);i.push(new gr(i.length,o/a-e,(o+d)/a-e,function(){return n},t,t+l-1)),o+=d,t+=l}return r.parser.stop(),i}function kr(t){this.a=t}function Cr(t,e){for(;t.a.length&&t.a[t.a.length-1].startTime>=e;)t.a.pop();for(;t.a.length&&0>=t.a[0].endTime;)t.a.shift();if(0!=t.a.length){var n=t.a[t.a.length-1];t.a[t.a.length-1]=new gr(n.position,n.startTime,e,n.c,n.b,n.a)}}function Mr(t){this.b=t,this.a=new vr(t,0),xh||(xh=[new Uint8Array([255]),new Uint8Array([127,255]),new Uint8Array([63,255,255]),new Uint8Array([31,255,255,255]),new Uint8Array([15,255,255,255,255]),new Uint8Array([7,255,255,255,255,255]),new Uint8Array([3,255,255,255,255,255,255]),new Uint8Array([1,255,255,255,255,255,255,255])])}function Rr(t){var e=Lr(t);if(7<e.length)throw new et(2,3,3002);for(var n=0,r=0;r<e.length;r++)n=256*n+e[r];e=n,n=Lr(t);t:{for(r=0;r<xh.length;r++)if(te(n,xh[r])){r=!0;break t}r=!1}if(r)n=t.b.byteLength-t.a.ba();else{if(8==n.length&&224&n[1])throw new et(2,3,3001);r=n[0]&(1<<8-n.length)-1;for(var i=1;i<n.length;i++)r=256*r+n[i];n=r}return n=t.a.ba()+n<=t.b.byteLength?n:t.b.byteLength-t.a.ba(),r=new DataView(t.b.buffer,t.b.byteOffset+t.a.ba(),n),t.a.L(n),new Ir(e,r)}function Lr(t){var e,n=t.a.ka();for(e=1;8>=e&&!(n&1<<8-e);e++);if(8<e)throw new et(2,3,3002);var r=new Uint8Array(e);for(r[0]=n,n=1;n<e;n++)r[n]=t.a.ka();return r}function Ir(t,e){this.id=t,this.a=e}function Pr(t){if(8<t.a.byteLength)throw new et(2,3,3002);if(8==t.a.byteLength&&224&t.a.getUint8(0))throw new et(2,3,3001);for(var e=0,n=0;n<t.a.byteLength;n++){e=256*e+t.a.getUint8(n)}return e}function Or(){}function Dr(t,e,n,r,i,a){function o(){return i}var s=[];t=new Mr(t.a);for(var u=null,l=null;t.sa();){var c=Rr(t);if(187==c.id){var d=Nr(c);d&&(c=n*d.jg,d=e+d.Df,null!=u&&s.push(new gr(s.length,u-a,c-a,o,l,d-1)),u=c,l=d)}}return null!=u&&s.push(new gr(s.length,u-a,r-a,o,l,null)),s}function Nr(t){var e=new Mr(t.a);if(t=Rr(e),179!=t.id)throw new et(2,3,3013);if(t=Pr(t),e=Rr(e),183!=e.id)throw new et(2,3,3012);e=new Mr(e.a);for(var n=0;e.sa();){var r=Rr(e);if(241==r.id){n=Pr(r);break}}return{jg:t,Df:n}}function Ur(t,e){var n=hr(t,e,"Initialization");if(!n)return null;var r=t.B.oa,i=n.getAttribute("sourceURL");i&&(r=Be(t.B.oa,[i])),i=0;var a=null;return(n=wh.J(n,"range",wh.oc))&&(i=n.start,a=n.end),new mr(function(){return r},i,a)}function Fr(t,e){var n=Number(dr(t,jr,"presentationTimeOffset"))||0,r=dr(t,jr,"timescale"),i=1;r&&(i=wh.nc(r)||1),n=n/i||0,r=Ur(t,jr);var a=t.B.contentType;if(i=t.B.mimeType.split("/")[1],"text"!=a&&"mp4"!=i&&"webm"!=i)throw new et(2,4,4006);if("webm"==i&&!r)throw new et(2,4,4005);a=hr(t,jr,"RepresentationIndex");var o=dr(t,jr,"indexRange"),s=t.B.oa;if(o=wh.oc(o||""),a){var u=a.getAttribute("sourceURL");u&&(s=Be(t.B.oa,[u])),o=wh.J(a,"range",wh.oc,o)}if(!o)throw new et(2,4,4002);return i=Br(t,e,r,s,o.start,o.end,i,n),{createSegmentIndex:i.createSegmentIndex,findSegmentPosition:i.findSegmentPosition,getSegmentReference:i.getSegmentReference,initSegmentReference:r,la:n}}function Br(t,e,n,r,i,a,o,s){var u=t.presentationTimeline,l=!t.kb||!t.S.Pc,c=t.S.start,d=t.S.duration,h=e,f=null;return{createSegmentIndex:function(){var t=[h(r,i,a),"webm"==o?h(n.c(),n.b,n.a):null];return h=null,Promise.all(t).then(function(t){var e=t[0];t=t[1]||null,e="mp4"==o?Tr(e,i,r,s):(new Or).parse(e,t,r,s),u.sb(e,c),f=new kr(e),l&&Cr(f,d)})},findSegmentPosition:function(t){return f.find(t)},getSegmentReference:function(t){return f.get(t)}}}function jr(t){return t.Nb}function Vr(t,e){var n=Ur(t,Gr),r=Hr(t),i=cr(t,Gr),a=i.Za;0==a&&(a=1);var o=0;if(i.Z?o=i.Z*(a-1):i.N&&0<i.N.length&&(o=i.N[0].start),r={Z:i.Z,startTime:o,Za:a,la:i.la,N:i.N,qb:r},!r.Z&&!r.N&&1<r.qb.length)throw new et(2,4,4002);if(!r.Z&&!t.S.duration&&!r.N&&1==r.qb.length)throw new et(2,4,4002);if(r.N&&0==r.N.length)throw new et(2,4,4002);return a=i=null,t.ja.id&&t.B.id&&(a=t.ja.id+","+t.B.id,i=e[a]),o=zr(t.S.duration,r.Za,t.B.oa,r),i?(i.Sc(o),a=t.presentationTimeline.Gb(),i.Dc(a-t.S.start)):(t.presentationTimeline.sb(o,t.S.start),i=new kr(o),a&&t.kb&&(e[a]=i)),t.kb&&t.S.Pc||Cr(i,t.S.duration),{createSegmentIndex:Promise.resolve.bind(Promise),findSegmentPosition:i.find.bind(i),getSegmentReference:i.get.bind(i),initSegmentReference:n,la:r.la}}function Gr(t){return t.Ja}function zr(t,e,n,r){var i=r.qb.length;r.N&&r.N.length!=r.qb.length&&(i=Math.min(r.N.length,r.qb.length));for(var a=[],o=r.startTime,s=0;s<i;s++){var u=r.qb[s],l=Be(n,[u.cf]),c=void 0;c=null!=r.Z?o+r.Z:r.N?r.N[s].end:o+t,a.push(new gr(s+e,o,c,function(t){return t}.bind(null,l),u.start,u.end)),o=c}return a}function Hr(t){return[t.B.Ja,t.ca.Ja,t.ja.Ja].filter(Bd.Ga).map(function(t){return wh.R(t,"SegmentURL")}).reduce(function(t,e){return 0<t.length?t:e}).map(function(e){e.getAttribute("indexRange")&&!t.Gd&&(t.Gd=!0);var n=e.getAttribute("media");return e=wh.J(e,"mediaRange",wh.oc,{start:0,end:null}),{cf:n,start:e.start,end:e.end}})}function Kr(t,e,n,r){var i=Xr(t),a=cr(t,Yr),o=dr(t,Yr,"media"),s=dr(t,Yr,"index");if(a={Z:a.Z,timescale:a.timescale,Za:a.Za,la:a.la,rd:a.rd,N:a.N,Rc:o,Ib:s},o=a.Ib?1:0,o+=a.N?1:0,0==(o+=a.Z?1:0))throw new et(2,4,4002);if(1!=o&&(a.Ib&&(a.N=null),a.Z=null),!a.Ib&&!a.Rc)throw new et(2,4,4002);if(a.Ib){if("mp4"!=(n=t.B.mimeType.split("/")[1])&&"webm"!=n)throw new et(2,4,4006);if("webm"==n&&!i)throw new et(2,4,4005);r=lr(a.Ib,t.B.id,null,t.bandwidth||null,null),r=Be(t.B.oa,[r]),t=Br(t,e,i,r,0,null,n,a.la)}else a.Z?(r||(t.presentationTimeline.Uc(a.Z),t.presentationTimeline.Vc(t.S.start)),t=Wr(t,a)):(o=e=null,t.ja.id&&t.B.id&&(o=t.ja.id+","+t.B.id,e=n[o]),s=qr(t,a),r=!t.kb||!t.S.Pc,e?(r&&Cr(new kr(s),t.S.duration),e.Sc(s),n=t.presentationTimeline.Gb(),e.Dc(n-t.S.start)):(t.presentationTimeline.sb(s,t.S.start),e=new kr(s),o&&t.kb&&(n[o]=e)),r&&Cr(e,t.S.duration),t={createSegmentIndex:Promise.resolve.bind(Promise),findSegmentPosition:e.find.bind(e),getSegmentReference:e.get.bind(e)});return{createSegmentIndex:t.createSegmentIndex,findSegmentPosition:t.findSegmentPosition,getSegmentReference:t.getSegmentReference,initSegmentReference:i,la:a.la}}function Yr(t){return t.Pb}function Wr(t,e){var n=t.S.duration,r=e.Z,i=e.Za,a=e.timescale,o=e.Rc,s=t.bandwidth||null,u=t.B.id,l=t.B.oa;return{createSegmentIndex:Promise.resolve.bind(Promise),findSegmentPosition:function(t){return 0>t||n&&t>=n?null:Math.floor(t/r)},getSegmentReference:function(t){var e=t*r,c=e+r;return n&&(c=Math.min(c,n)),0>c||n&&e>=n?null:new gr(t,e,c,function(){var n=lr(o,u,t+i,s,e*a);return Be(l,[n])},0,null)}}}function qr(t,e){for(var n=[],r=0;r<e.N.length;r++){var i=r+e.Za;n.push(new gr(i,e.N[r].start,e.N[r].end,function(t,e,n,r,i,a){return t=lr(t,e,i,n,a),Be(r,[t]).map(function(t){return t.toString()})}.bind(null,e.Rc,t.B.id,t.bandwidth||null,t.B.oa,i,e.N[r].ig+e.rd),0,null))}return n}function Xr(t){var e=dr(t,Yr,"initialization");if(!e)return null;var n=t.B.id,r=t.bandwidth||null,i=t.B.oa;return new mr(function(){var t=lr(e,n,null,r,null);return Be(i,[t])},0,null)}function $r(t,e,n){this.f=t,this.pc=e,this.h=this.g=1/0,this.a=1,this.b=this.c=null,this.l=0,this.m=!0,this.i=0,this.o=void 0===n||n}function Zr(t,e,n,r){return t=wt(t,r),0==e&&null==n||(t.headers.Range=n?"bytes="+e+"-"+n:"bytes="+e+"-"),t}function Qr(){var t=this;this.a=this.b=null,this.f=[],this.c=null,this.l=[],this.h=1,this.m={},this.o=0,this.v=new D(5),this.i=new Z(function(){ai(t)}),this.g=new yt}function Jr(t){var e=Date.now(),n=t.a.networkingEngine.request(0,wt(t.f,t.b.retryParameters));return _t(t.g,n),n.promise.then(function(e){if(t.a)return e.uri&&!t.f.includes(e.uri)&&t.f.unshift(e.uri),ti(t,e.data,e.uri)}).then(function(){var n=(Date.now()-e)/1e3;return N(t.v,1,n),n})}function ti(t,e,n){if(!(e=wh.Td(e,"MPD")))throw new et(2,4,4001,n);return e=pr(e,t.b.retryParameters,t.b.dash.xlinkFailGracefully,n,t.a.networkingEngine),_t(t.g,e),e.promise.then(function(e){return ei(t,e,n)})}function ei(t,e,n){return c(function r(){var i,a,o,s,u,l,c,d,h,f,g,v,y,_,b,E,w,A,S,T,x,C,M,R,L,I;return k(r,function(r){switch(r.j){case 1:s=Bd,u=wh,l=[n],c=u.R(e,"Location").map(u.cc).filter(s.Ga),0<c.length&&(d=Be(l,c),l=t.f=d),h=u.R(e,"BaseURL").map(u.cc),f=Be(l,h),g=t.b.dash.ignoreMinBufferTime,v=0,g||(v=u.J(e,"minBufferTime",u.Ba)),t.o=u.J(e,"minimumUpdatePeriod",u.Ba,-1),y=u.J(e,"availabilityStartTime",u.vf),_=u.J(e,"timeShiftBufferDepth",u.Ba),b=u.J(e,"suggestedPresentationDelay",u.Ba),E=u.J(e,"maxSegmentDuration",u.Ba),w=e.getAttribute("type")||"static",t.c?A=t.c.presentationTimeline:(S=Math.max(t.b.dash.defaultPresentationDelay,1.5*v),T=null!=b?b:S,A=new $r(y,T,t.b.dash.autoCorrectDrift)),x={kb:"static"!=w,presentationTimeline:A,ja:null,S:null,ca:null,B:null,bandwidth:0,Gd:!1};for(var k=x,P=f,O=wh.J(e,"mediaPresentationDuration",wh.Ba),D=[],N=0,U=wh.R(e,"Period"),F=0;F<U.length;F++){var B=U[F];N=wh.J(B,"start",wh.Ba,N);var j=wh.J(B,"duration",wh.Ba),V=null;if(F!=U.length-1){var G=wh.J(U[F+1],"start",wh.Ba);null!=G&&(V=G-N)}else null!=O&&(V=O-N);if(null==V&&(V=j),B=ni(t,k,P,{start:N,duration:V,node:B,Pc:null==V||F==U.length-1}),D.push(B),j=k.ja.id,t.l.includes(j)||(t.l.push(j),t.c&&(t.a.filterNewPeriod(B),t.c.periods.push(B))),null==V){N=null;break}N+=V}if(null==t.c&&t.a.filterAllPeriods(D),null!=O?(i=D,a=O,o=!1):(i=D,a=N,o=!0),C=a,M=i,A.Qb("static"==w),"static"!=w&&o||A.wa(C||1/0),(R=A.V())&&!isNaN(t.b.availabilityWindowOverride)&&(_=t.b.availabilityWindowOverride),null==_&&(_=1/0),A.ld(_),A.Uc(E||1),t.c){r.A(0);break}if(t.c={presentationTimeline:A,periods:M,offlineSessionIds:[],minBufferTime:v||0},!A.ie()){r.A(0);break}return L=u.R(e,"UTCTiming"),p(r,di(t,f,L),4);case 4:if(I=r.s,!t.a)return r["return"]();A.de(I),m(r)}})})}function ni(t,e,n,r){if(e.ja=si(r.node,null,n),e.S=r,e.ja.id||(e.ja.id="__shaka_period_"+r.start),wh.R(r.node,"EventStream").forEach(t.wf.bind(t,r.start,r.duration)),n=wh.R(r.node,"AdaptationSet").map(t.uf.bind(t,e)).filter(Bd.Ga),e.kb){e=[];for(var i=s(n),a=i.next();!a.done;a=i.next()){a=s(a.value.Gf);for(var o=a.next();!o.done;o=a.next())e.push(o.value)}if(e.length!=new Set(e).size)throw new et(2,4,4018)}var u=n.filter(function(t){return!t.pd});if(n.filter(function(t){return t.pd}).forEach(function(t){var e=t.streams[0],n=t.pd;u.forEach(function(t){t.id==n&&t.streams.forEach(function(t){t.trickModeVideo=e})})}),e=ri(u,"video"),i=ri(u,"audio"),!e.length&&!i.length)throw new et(2,4,4004);for(i.length||(i=[null]),e.length||(e=[null]),n=[],a=0;a<i.length;a++)for(o=0;o<e.length;o++)ii(t,i[a],e[o],n);for(t=ri(u,"text"),e=[],i=0;i<t.length;i++)e.push.apply(e,t[i].streams);return{startTime:r.start,textStreams:e,variants:n}}function ri(t,e){return t.filter(function(t){return t.contentType==e})}function ii(t,e,n,r){if(e||n)if(e&&n){var i=e.drmInfos,a=n.drmInfos;if(i.length&&a.length?0<xe(i,a).length:1){a=xe(e.drmInfos,n.drmInfos);for(var o=0;o<e.streams.length;o++)for(var s=0;s<n.streams.length;s++)i=(n.streams[s].bandwidth||0)+(e.streams[o].bandwidth||0),i={id:t.h++,language:e.language,primary:e.Qc||n.Qc,audio:e.streams[o],video:n.streams[s],bandwidth:i,drmInfos:a,allowedByApplication:!0,allowedByKeySystem:!0},r.push(i)}}else for(a=e||n,o=0;o<a.streams.length;o++)i=a.streams[o].bandwidth||0,i={id:t.h++,language:a.language||"und",primary:a.Qc,audio:e?a.streams[o]:null,video:n?a.streams[o]:null,bandwidth:i,drmInfos:a.drmInfos,allowedByApplication:!0,allowedByKeySystem:!0},r.push(i)}function ai(t){c(function e(){var n,r;return k(e,function(e){switch(e.j){case 1:return n=0,g(e,2),p(e,Jr(t),4);case 4:n=e.s,y(e,3);break;case 2:r=_(e),t.a&&(r.severity=1,t.a.onError(r));case 3:if(!t.a)return e["return"]();oi(t,n),m(e)}})})}function oi(t,e){0>t.o||t.i.O(Math.max(3,t.o-e,U(t.v)))}function si(t,e,n){e=e||{contentType:"",mimeType:"",codecs:"",emsgSchemeIdUris:[],frameRate:void 0,Wc:null},n=n||e.oa;var r=wh.vb,i=wh.Ae,a=wh.R(t,"BaseURL").map(wh.cc),o=t.getAttribute("contentType")||e.contentType,u=t.getAttribute("mimeType")||e.mimeType,l=t.getAttribute("codecs")||e.codecs;i=wh.J(t,"frameRate",i)||e.frameRate;var c=wh.R(t,"InbandEventStream"),d=e.emsgSchemeIdUris.slice();c=s(c);for(var h=c.next();!h.done;h=c.next())h=h.value.getAttribute("schemeIdUri"),d.includes(h)||d.push(h);return c=wh.R(t,"AudioChannelConfiguration"),c=ui(c)||e.Wc,o||(o=hi(u,l)),{oa:Be(n,a),Nb:wh.$b(t,"SegmentBase")||e.Nb,Ja:wh.$b(t,"SegmentList")||e.Ja,Pb:wh.$b(t,"SegmentTemplate")||e.Pb,width:wh.J(t,"width",r)||e.width,height:wh.J(t,"height",r)||e.height,contentType:o,mimeType:u,codecs:l,frameRate:i,emsgSchemeIdUris:d,id:t.getAttribute("id"),Wc:c}}function ui(t){for(var e=0;e<t.length;++e){var n=t[e],r=n.getAttribute("schemeIdUri");if(r&&(n=n.getAttribute("value")))switch(r){case"urn:mpeg:dash:outputChannelPositionList:2012":return n.trim().split(/ +/).length;case"urn:mpeg:dash:23003:3:audio_channel_configuration:2011":case"urn:dts:dash:audio_channel_configuration:2012":if(!(r=parseInt(n,10)))continue;return r;case"tag:dolby.com,2014:dash:audio_channel_configuration:2011":case"urn:dolby:dash:audio_channel_configuration:2011":if(r=parseInt(n,16)){for(t=0;r;)1&r&&++t,r>>=1;return t}}}return null}function li(t){var e=t.Nb?1:0;return e+=t.Ja?1:0,0==(e+=t.Pb?1:0)?"text"==t.contentType||"application"==t.contentType:(1!=e&&(t.Nb&&(t.Ja=null),t.Pb=null),!0)}function ci(t,e,n,r){return e=Be(e,[n]),e=wt(e,t.b.retryParameters),e.method=r,e=t.a.networkingEngine.request(4,e),_t(t.g,e),e.promise.then(function(t){if("HEAD"==r){if(!t.headers||!t.headers.date)return 0;t=t.headers.date}else t=Ht(t.data);return t=Date.parse(t),isNaN(t)?0:t-Date.now()})}function di(t,e,n){n=n.map(function(t){return{scheme:t.getAttribute("schemeIdUri"),value:t.getAttribute("value")}});var r=t.b.dash.clockSyncUri;return!n.length&&r&&n.push({scheme:"urn:mpeg:dash:utc:http-head:2014",value:r}),Bd.ye(n,function(t){var n=t.scheme;switch(t=t.value,n){case"urn:mpeg:dash:utc:http-head:2014":case"urn:mpeg:dash:utc:http-head:2012":return ci(this,e,t,"HEAD");case"urn:mpeg:dash:utc:http-xsdate:2014":case"urn:mpeg:dash:utc:http-iso:2014":case"urn:mpeg:dash:utc:http-xsdate:2012":case"urn:mpeg:dash:utc:http-iso:2012":return ci(this,e,t,"GET");case"urn:mpeg:dash:utc:direct:2014":case"urn:mpeg:dash:utc:direct:2012":return n=Date.parse(t),isNaN(n)?0:n-Date.now();case"urn:mpeg:dash:utc:http-ntp:2014":case"urn:mpeg:dash:utc:ntp:2014":case"urn:mpeg:dash:utc:sntp:2014":return j("NTP UTCTiming scheme is not supported"),Promise.reject();default:return j("Unrecognized scheme in UTCTiming element",n),Promise.reject()}}.bind(t))["catch"](function(){return j("A UTCTiming element should always be given in live manifests! This content may not play on clients with bad clocks!"),0})}function hi(t,e){return qe(Ut(t,e))?"text":t.split("/")[0]}function fi(t,e,n,r){this.b=t,this.type=e,this.a=n,this.segments=r||null}function pi(t,e,n,r){this.id=t,this.name=e,this.a=n,this.value=void 0===r?null:r}function mi(t,e){this.name=t,this.value=e}function gi(t,e,n){return(t=t.getAttribute(e))?t.value:n||null}function vi(t,e){this.b=e,this.a=t}function yi(t){this.b=t,this.a=0}function _i(t){bi(t,/[ \t]+/gm)}function bi(t,e){e.lastIndex=t.a;var n=e.exec(t.b);return n=null==n?null:{position:n.index,length:n[0].length,Jf:n},t.a==t.b.length||null==n||n.position!=t.a?null:(t.a+=n.length,n.Jf)}function Ei(t){return t.a==t.b.length?null:(t=bi(t,/[^ \t\n]*/gm))?t[0]:null}function wi(){this.a=0}function Ai(t,e,n){e=Ht(e),e=e.replace(/\r\n|\r(?=[^\n]|$)/gm,"\n").trim();var r=e.split(/\n+/m);if(!/^#EXTM3U($|[ \t\n])/m.test(r[0]))throw new et(2,4,4015);e=0;for(var i=1;i<r.length;i++)if(!Ch.Oc(r[i])){var a=Ti(t,r[i]);if(--t.a,Mh.includes(a.name)){e=1;break}"EXT-X-STREAM-INF"==a.name&&(i+=1)}for(i=[],a=1;a<r.length;)if(Ch.Oc(r[a]))a+=1;else{var o=Ti(t,r[a]);if(Rh.includes(o.name)){if(1!=e)throw new et(2,4,4017);return r=r.splice(a,r.length-a),t=Si(t,n,r,i),new fi(n,e,i,t)}i.push(o),a+=1,"EXT-X-STREAM-INF"==o.name&&(o.a.push(new mi("URI",r[a])),a+=1)}return new fi(n,e,i)}function Si(t,e,n,r){var i=[],a=[];return n.forEach(function(n){if(/^(#EXT)/.test(n))n=Ti(t,n),Mh.includes(n.name)?r.push(n):a.push(n);else{if(Ch.Oc(n))return[];n=Ch.zc(e,n.trim()),i.push(new vi(n,a)),a=[]}}),i}function Ti(t,e){var n=t.a++,r=e.match(/^#(EXT[^:]*)(?::(.*))?$/);if(!r)throw new et(2,4,4016,e);var i=r[1],a=r[2];r=[];var o;if(a){a=new yi(a);var s;(s=bi(a,/^([^,=]+)(?:,|$)/g))&&(o=s[1]);for(var u=/([^=]+)=(?:"([^"]*)"|([^",]*))(?:,|$)/g;s=bi(a,u);)r.push(new mi(s[1],s[2]||s[3]))}return new pi(n,i,r,o)}function xi(t){try{var e=xi.parse(t);return ot({uri:t,$c:t,data:e.data,headers:{"content-type":e.contentType}})}catch(n){return it(n)}}function ki(){var t=this;this.c=this.g=null,this.$=1,this.D=new Map,this.T=new Set,this.a=new Map,this.b=null,this.v="",this.o=new wi,this.P=0,this.h=new Z(function(){ra(t)}),this.f=Oh,this.m=null,this.C=0,this.G=1/0,this.i=new yt,this.M=[],this.l=new Map,this.W=!1}function Ci(t,e){return c(function n(){var r,i,a,o,s,u,l,c,d,h,f;return k(n,function(n){switch(n.j){case 1:return r=Ch,i=Dh,a=e.qe,p(n,na(t,a),2);case 2:if(o=n.s,s=Ai(t.o,o.data,o.uri),1!=s.type)throw new et(2,4,4017);return l=(u=r.Ra(s.a,"EXT-X-MEDIA-SEQUENCE"))?Number(u.value):0,c=e.stream,p(n,Hi(t,e.tc,s,l,c.mimeType,c.codecs),3);case 3:d=n.s,e.Ob.a=d,h=d[d.length-1],(f=r.Ra(s.a,"EXT-X-ENDLIST"))&&(ia(t,i.Oa),t.b.wa(h.endTime)),m(n)}})})}function Mi(t,e){return c(function n(){var r,i,a,o,u,l,c,d,h,f,g;return k(n,function(n){switch(n.j){case 1:if(r=Ai(t.o,e,t.v),0!=r.type)throw new et(2,4,4022);return p(n,Ri(t,r),2);case 2:if(i=n.s,!t.g)throw new et(2,7,7001);if(t.W&&0==i.variants.length)throw new et(2,4,4034);t.g.filterAllPeriods([i]),a=1/0,o=0,u=1/0;for(var v=s(t.a.values()),y=v.next();!y.done;y=v.next())l=y.value,a=Math.min(a,l.Tc),o=Math.max(o,l.Tc),"text"!=l.stream.type&&(u=Math.min(u,l.duration));if(t.f!=Dh.Oa?(t.b=new $r(0,3*t.C),t.b.Qb(!1)):(t.b=new $r(null,0),t.b.Qb(!0)),zi(t),t.f!=Dh.Oa){for(t.P=t.G,c=Dh,t.f==c.sd&&(d=t.b.pc,isNaN(t.c.availabilityWindowOverride)||(d=t.c.availabilityWindowOverride),t.b.ld(d)),h=0;95443.7176888889<=o;)h+=95443.7176888889,o-=95443.7176888889;if(h)for(v=s(t.a.values()),y=v.next();!y.done;y=v.next())f=y.value,95443.7176888889>f.Tc&&(f.stream.presentationTimeOffset=-h,f.Ob.offset(h))}else for(t.b.wa(u),t.b.offset(-a),v=s(t.a.values()),y=v.next();!y.done;y=v.next())g=y.value,g.stream.presentationTimeOffset=a,g.Ob.offset(-a),Cr(g.Ob,u);t.m={presentationTimeline:t.b,periods:[i],offlineSessionIds:[],minBufferTime:0},m(n)}})})}function Ri(t,e){return c(function n(){var r,i,a,o,s,u,l,c,d,h,f,m;return k(n,function(n){switch(n.j){case 1:return r=Ch,i=Bd,a=e.a,o=r.lb(e.a,"EXT-X-MEDIA"),s=o.filter(function(t){return"SUBTITLES"==ta(t,"TYPE")}.bind(t)),u=s.map(function(t){return Di(this,t)}.bind(t)),l=o.filter(function(t){return"CLOSED-CAPTIONS"==ta(t,"TYPE")}),Ni(t,l),p(n,Promise.all(u),2);case 2:return c=n.s,d=r.lb(a,"EXT-X-STREAM-INF"),h=d.map(function(t){return Li(this,t,e)}.bind(t)),p(n,Promise.all(h),3);case 3:return f=n.s,m=f.reduce(i.yc,[]),m=m.filter(function(t){return null!=t}),n["return"]({startTime:0,variants:m,textStreams:c})}})})}function Li(t,e,n){return c(function r(){var i,a,o,s,u,l,c,d,h,f,m,g,v,y,_,b,E,w,A,S,T,x,C,M,R,L,I;return k(r,function(r){switch(r.j){case 1:return i=jd,a=Ch,o=gi(e,"CODECS","avc1.42E01E,mp4a.40.2"),s=$i(o.split(/\s*,\s*/)),u=e.getAttribute("RESOLUTION"),c=l=null,d=gi(e,"FRAME-RATE"),h=Number(ta(e,"BANDWIDTH")),u&&(f=u.value.split("x"),l=f[0],c=f[1]),m=a.lb(n.a,"EXT-X-MEDIA"),m=m.filter(function(t){return"CLOSED-CAPTIONS"!=ta(t,"TYPE")}),m=m.filter(function(t){var e=gi(t,"URI")||"";return"SUBTITLES"==(gi(t,"TYPE")||"")||""!=e}),g=gi(e,"AUDIO"),v=gi(e,"VIDEO"),g?m=a.Gc(m,"AUDIO",g):v&&(m=a.Gc(m,"VIDEO",v)),(y=Zi(i.qa,s))&&((_=gi(e,"SUBTITLES"))&&(b=a.Gc(m,"SUBTITLES",_),b.length&&(E=t.D.get(b[0].id),E.stream.codecs=y)),mt(s,y)),w=m.map(function(t){return Ui(this,t,s)}.bind(t)),A=[],S=[],p(r,Promise.all(w),2);case 2:if(x=r.s,x=x.filter(function(t){return null!=t}),g?A=x:v&&(S=x),M=!1,A.length||S.length?A.length?(L=ta(e,"URI"),I=A[0].tc,L==I?(C=i.Ab,M=!0):C=i.Na):C=i.Ab:1==s.length?(R=Zi(i.Na,s),C=u||d||R?i.Na:i.Ab):(C=i.Na,s=[s.join(",")]),M){r.A(3);break}return p(r,Fi(t,e,s,C),4);case 4:T=r.s;case 3:if(T)T.stream.type==i.Ab?A=[T]:S=[T];else if(null===T)return r["return"]([]);return S&&Ii(S),A&&Ii(A),r["return"](Pi(t,A,S,h,l,c,d))}})})}function Ii(t){t.forEach(function(t){var e=t.stream.codecs.split(",");e=e.filter(function(t){return"mp4a.40.34"!=t}),t.stream.codecs=e.join(",")})}function Pi(t,e,n,r,i,a,o){n.forEach(function(t){(t=t.stream)&&(t.width=Number(i)||void 0,t.height=Number(a)||void 0,t.frameRate=Number(o)||void 0)}.bind(t)),e.length||(e=[null]),n.length||(n=[null]);var u=[];e=s(e);for(var l=e.next();!l.done;l=e.next()){l=l.value;for(var c=s(n),d=c.next();!d.done;d=c.next()){var h=d.value;d=l?l.stream:null;var f=h?h.stream:null,p=l?l.drmInfos:null,m=h?h.drmInfos:null;h=(h?h.tc:"")+" - "+(l?l.tc:"");var g=void 0;if(d&&f){if(!(p.length&&m.length?0<xe(p,m).length:1))continue;g=xe(p,m)}else d?g=p:f&&(g=m);t.T.has(h)||(d=Oi(t,d,f,r,g),u.push(d),t.T.add(h))}}return u}function Oi(t,e,n,r,i){return{id:t.$++,language:e?e.language:"und",primary:!!e&&e.primary||!!n&&n.primary,audio:e,video:n,bandwidth:r,drmInfos:i,allowedByApplication:!0,allowedByKeySystem:!0}}function Di(t,e){return c(function n(){var r;return k(n,function(n){switch(n.j){case 1:return ta(e,"TYPE"),p(n,Ui(t,e,[]),2);case 2:return r=n.s,n["return"](r.stream)}})})}function Ni(t,e){for(var n=s(e),r=n.next();!r.done;r=n.next()){r=r.value,ta(r,"TYPE");var i=gi(r,"LANGUAGE")||"und";i=pn(i);var a=ta(r,"GROUP-ID");r=ta(r,"INSTREAM-ID"),t.l.get(a)||t.l.set(a,new Map),t.l.get(a).set(r,i)}}function Ui(t,e,n){return c(function r(){var i,a,o,s,u,l,c,d,h,f,m;return k(r,function(r){switch(r.j){case 1:if(i=ta(e,"URI"),t.a.has(i))return r["return"](t.a.get(i));if(a=ta(e,"TYPE").toLowerCase(),o=jd,"subtitles"==a&&(a=o.qa),s=pn(gi(e,"LANGUAGE","und")),u=gi(e,"NAME"),l=e.getAttribute("DEFAULT"),c=e.getAttribute("AUTOSELECT"),d=gi(e,"CHANNELS"),"audio"==a)if(d){var g=d.split("/")[0];g=parseInt(g,10)}else g=null;else g=null;return h=g,f=!!l||!!c,p(r,Bi(t,i,n,a,s,f,u,h,null),2);case 2:return null==(m=r.s)?r["return"](null):t.a.has(i)?r["return"](t.a.get(i)):(t.D.set(e.id,m),t.a.set(i,m),r["return"](m))}})})}function Fi(t,e,n,r){return c(function i(){var a,o,s,u,l;return k(i,function(i){switch(i.j){case 1:return a=jd,(o=ta(e,"URI"),t.a.has(o))?i["return"](t.a.get(o)):(s=gi(e,"CLOSED-CAPTIONS"),u=null,r==a.Na&&s&&"NONE"!=s&&(u=t.l.get(s)),p(i,Bi(t,o,n,r,"und",!1,null,null,u),2));case 2:return null==(l=i.s)?i["return"](null):t.a.has(o)?i["return"](t.a.get(o)):(t.a.set(o,l),i["return"](l))}})})}function Bi(t,e,n,r,i,a,o,u,l){return c(function d(){var c,h,f,m,g,v,y,_,b,E,w,A,S,T,x,C,M,R,L,I,P,O,D,N,U,F;return k(d,function(d){switch(d.j){case 1:return c=Ch,h=c.zc(t.v,e),m="",p(d,na(t,h),2);case 2:if(v=d.s,h=v.uri,f=Ai(t.o,v.data,h),1!=f.type)throw new et(2,4,4017);y=[],f.segments.forEach(function(t){t=c.lb(t.b,"EXT-X-KEY"),y.push.apply(y,t)}),_=!1,b=[],E=null;for(var k=s(y),B=k.next();!B.done;B=k.next())if(w=B.value,"NONE"!=(A=ta(w,"METHOD"))){if(_=!0,"AES-128"==A)return t.W=!0,d["return"](null);S=ta(w,"KEYFORMAT"),(x=(T=Ph[S])?T(w):null)&&(x.keyIds.length&&(E=x.keyIds[0]),b.push(x))}if(_&&!b.length)throw new et(2,4,4026);return ji(t,f),m=Qi(r,n),p(d,Ji(t,r,m,f),3);case 3:return g=C=d.s,R=(M=c.Ra(f.a,"EXT-X-MEDIA-SEQUENCE"))?Number(M.value):0,p(d,Hi(t,e,f,R,g,m),4);case 4:return L=d.s,I=L[0].startTime,P=L[L.length-1].endTime,O=P-I,D=new kr(L),N=Vi(f),U=void 0,"text"==r&&(U="subtitle"),F={id:t.$++,originalId:o,createSegmentIndex:Promise.resolve.bind(Promise),findSegmentPosition:D.find.bind(D),getSegmentReference:D.get.bind(D),initSegmentReference:N,presentationTimeOffset:0,mimeType:g,codecs:m,kind:U,encrypted:_,keyId:E,language:i,label:o,type:r,primary:a,trickModeVideo:null,emsgSchemeIdUris:null,frameRate:void 0,width:void 0,height:void 0,bandwidth:void 0,roles:[],channelsCount:u,closedCaptions:l},d["return"]({stream:F,Ob:D,drmInfos:b,tc:e,qe:h,Tc:I,ug:P,duration:O})}})})}function ji(t,e){var n=Dh,r=Ch.Ra(e.a,"EXT-X-PLAYLIST-TYPE"),i=Ch.Ra(e.a,"EXT-X-ENDLIST");i=r&&"VOD"==r.value||i,r=r&&"EVENT"==r.value&&!i,r=!i&&!r,i?ia(t,n.Oa):(r?ia(t,n.sd):ia(t,n.le),n=ea(e.a,"EXT-X-TARGETDURATION"),n=Number(n.value),t.C=Math.max(n,t.C),t.G=Math.min(n,t.G))}function Vi(t){var e=Ch.lb(t.a,"EXT-X-MAP");if(!e.length)return null;if(1<e.length)throw new et(2,4,4020);e=e[0];var n=ta(e,"URI"),r=Ch.zc(t.b,n);return t=0,n=null,(e=gi(e,"BYTERANGE"))&&(t=e.split("@"),e=Number(t[0]),t=Number(t[1]),n=t+e-1),new mr(function(){return[r]},t,n)}function Gi(t,e,n,r){var i=e.b,a=e.a;e=ea(i,"EXTINF").value.split(","),e=r+Number(e[0]);var o=0,s=null;return(i=Ch.Ra(i,"EXT-X-BYTERANGE"))&&(o=i.value.split("@"),i=Number(o[0]),o=o[1]?Number(o[1]):t.a+1,s=o+i-1),new gr(n,r,e,function(){return[a]},o,s)}function zi(t){t.b&&(t.M.forEach(function(e){t.b.sb(e,0)}),t.M=[])}function Hi(t,e,n,r,i,a){return c(function o(){var s,u,l,c,d,h,f,m,g,v,y;return k(o,function(o){switch(o.j){case 1:return s=n.segments,u=[],l=s[0].a,c=Gi(null,s[0],r,0),d=Vi(n),p(o,Yi(t,e,d,c,i,a),2);case 2:h=o.s,l.split("/").pop();for(var _=0;_<s.length;++_)f=s[_],m=u[u.length-1],g=0==_?h:m.endTime,v=r+_,y=Gi(m,f,v,g),u.push(y);return t.M.push(u),zi(t),o["return"](u)}})})}function Ki(t,e){return c(function n(){var r,i,a,o,s,u;return k(n,function(n){switch(n.j){case 1:return r=xd,i=Zr(e.c(),e.b,e.b+2048-1,t.c.retryParameters),a=Zr(e.c(),e.b,e.a,t.c.retryParameters),g(n,2),p(n,aa(t,i,r.td),4);case 4:return o=n.s,n["return"](o);case 2:if(s=_(n),7001==s.code)throw s;return j("Unable to fetch a partial HLS segment! Falling back to a full segment request, which is expensive!  Your server should support Range requests and CORS preflights.",i.uris[0]),p(n,aa(t,a,r.td),5);case 5:return u=n.s,n["return"](u)}})})}function Yi(t,e,n,r,i,a){return c(function o(){var s,u,l,c,d,h,f,m,g;return k(o,function(o){switch(o.j){case 1:if(t.m&&(s=t.a.get(e),u=s.Ob,l=u.get(r.position)))return o["return"](l.startTime);if("audio/mpeg"==i)return o["return"](0);if("video/mp4"!=i&&"audio/mp4"!=i){o.A(2);break}return c=[Ki(t,r)],n&&c.push(Ki(t,n)),p(o,Promise.all(c),3);case 3:return d=o.s,h=d[0],f=d[1]||d[0],o["return"](Wi(h.data,f.data));case 2:if("video/mp2t"!=i){o.A(4);break}return p(o,Ki(t,r),5);case 5:return m=o.s,o["return"](qi(m.data));case 4:if("application/mp4"!=i&&!i.startsWith("text/")){o.A(6);break}return p(o,Ki(t,r),7);case 7:return g=o.s,o["return"](Xi(i,a,g.data));case 6:throw new et(2,4,4030)}})})}function Wi(t,e){var n=0;if((new _r).H("moov",br).H("trak",br).H("mdia",br).ea("mdhd",function(t){t.reader.L(0==t.version?8:16),n=t.reader.F(),t.parser.stop()}).parse(e,!0),!n)throw new et(2,4,4030);var r=0,i=!1;if((new _r).H("moof",br).H("traf",br).ea("tfdt",function(t){r=(0==t.version?t.reader.F():t.reader.yb())/n,i=!0,t.parser.stop()}).parse(t,!0),!i)throw new et(2,4,4030);return r}function qi(t){function e(){throw new et(2,4,4030)}t=new vr(new DataView(t),0);for(var n=0,r=0;;){if(n=t.ba(),r=t.ka(),71!=r&&e(),16384&t.Lb()||e(),r=(48&t.ka())>>4,0!=r&&2!=r||e(),3==r&&(r=t.ka(),t.L(r)),1==t.F()>>8)return t.L(3),n=t.ka()>>6,0!=n&&1!=n||e(),0==t.ka()&&e(),n=t.ka(),r=t.Lb(),t=t.Lb(),(1073741824*((14&n)>>1)+((65534&r)<<14|(65534&t)>>1))/9e4;t.seek(n+188),r=t.ka(),71!=r&&(t.seek(n+192),r=t.ka()),71!=r&&(t.seek(n+204),r=t.ka()),71!=r&&e(),t.ae(1)}}function Xi(t,e,n){return t=Ut(t,e),qe(t)?(e=new We(null),Xe(e,t),e.Lc(n)):0}function $i(t){var e=new Set,n=[];t=s(t);for(var r=t.next();!r.done;r=t.next()){r=r.value;var i=Bt(r)[0];e.has(i)||(n.push(r),e.add(i))}return n}function Zi(t,e){for(var n=Lh[t],r=0;r<n.length;r++)for(var i=0;i<e.length;i++)if(n[r].test(e[i].trim()))return e[i].trim();return"text"==t?"":null}function Qi(t,e){if(1==e.length)return e[0];var n=Zi(t,e);if(null!=n)return n;throw new et(2,4,4025,e)}function Ji(t,e,n,r){return c(function i(){var a,o,s,u,l,c,d,h,f,m;return k(i,function(i){switch(i.j){case 1:return a=jd,(o=xd,s=r.segments[0].a,u=new G(s),l=u.ia.split(".").pop(),c=Ih[e],d=c[l])?i["return"](d):e==a.qa?n&&"vtt"!=n?i["return"]("application/mp4"):i["return"]("text/vtt"):(h=wt([s],t.c.retryParameters),h.method="HEAD",p(i,aa(t,h,o.td),2));case 2:if(f=i.s,!(m=f.headers["content-type"]))throw new et(2,4,4021,l);return i["return"](m.split(";")[0])}})})}function ta(t,e){var n=t.getAttribute(e);if(!n)throw new et(2,4,4023,e);return n.value}function ea(t,e){var n=Ch.Ra(t,e);if(!n)throw new et(2,4,4024,e);return n}function na(t,e){return aa(t,wt([e],t.c.retryParameters),xd.rg)}function ra(t){c(function e(){var n,r;return k(e,function(e){switch(e.j){case 1:return t.g?(g(e,2),p(e,t.update(),4)):e["return"]();case 4:n=t.P,t.h.O(n),y(e,0);break;case 2:r=_(e),r.severity=1,t.g.onError(r),t.h.O(.1),m(e)}})})}function ia(t,e){t.f=e,t.b&&t.b.Qb(t.f==Dh.Oa),t.f!=Dh.Oa||t.h.stop()}function aa(t,e,n){if(!t.i)throw new et(2,7,7001);return e=t.g.networkingEngine.request(n,e),_t(t.i,e),e.promise}function oa(){this.a=new Map}function sa(t,e,n){ua(t,e).text=n}function ua(t,e){return t.a.has(e)||t.a.set(e,new la),t.a.get(e)}function la(){this.text=this.variant=null}function ca(t,e){this.a=t,this.b=new Set([t]),e=e||[];for(var n=s(e),r=n.next();!r.done;r=n.next())this.add(r.value)}function da(t,e){var n;if(!(n=!!t.audio!=!!e.audio||!!t.video!=!!e.video||t.language!=e.language)&&(n=t.audio&&e.audio)){n=t.audio;var r=e.audio;n=!(n.channelsCount==r.channelsCount&&ha(n,r)&&fa(n.roles,r.roles))}return!n&&(n=t.video&&e.video)&&(n=t.video,r=e.video,n=!(ha(n,r)&&fa(n.roles,r.roles))),!n}function ha(t,e){if(t.mimeType!=e.mimeType)return!1;var n=t.codecs.split(",").map(function(t){return Bt(t)[0]}),r=e.codecs.split(",").map(function(t){return Bt(t)[0]});if(n.length!=r.length)return!1;n.sort(),r.sort();for(var i=0;i<n.length;i++)if(n[i]!=r[i])return!1;return!0}function fa(t,e){var n=new Set(t),r=new Set(e);if(n["delete"]("main"),r["delete"]("main"),n.size!=r.size)return!1;n=s(n);for(var i=n.next();!i.done;i=n.next())if(!r.has(i.value))return!1;return!0}function pa(t){this.a=t,this.b=new ma(t.language,"",t.audio&&t.audio.channelsCount?t.audio.channelsCount:0)}function ma(t,e,n){this.c=t,this.b=e,this.a=n}function ga(t,e){var n=pn(e),r=gn(n,t.map(function(t){return mn(t)}));return r?t.filter(function(t){return r==mn(t)}):[]}function va(t,e){return t.filter(function(t){var n=t.audio;return t=t.video,n&&0<=n.roles.indexOf(e)||t&&0<=t.roles.indexOf(e)})}function ya(t,e){this.a=Uh,this.b=(new Map).set(Uh,e).set(Nh,t)}function _a(t,e){this.f=t,this.g=wa(t),this.b=t.a.currentTime,this.c=Date.now()/1e3,this.h=e,this.a=function(){}}function ba(t,e){t.a=e}function Ea(t){this.a=t}function wa(t){if(t.a.paused||0==t.a.playbackRate||null==t.a.buffered)var e=!1;else t:{e=t.a.buffered,t=t.a.currentTime;for(var n=0;n<e.length;n++){var r=e.start(n),i=e.end(n);if(!(t<r||t>i-.5)){e=!0;break t}}e=!1}return e}function Aa(t,e,n,r,i){var a=this;this.a=t,this.v=e,this.o=n,this.l=i,this.f=new Mt,this.i=!1,this.m=t.readyState,this.c=!1,this.b=r,this.h=!1,this.f.w(t,"waiting",function(){return Sa(a)}),this.g=new Z(function(){Sa(a)}).La(.25)}function Sa(t){if(0!=t.a.readyState){if(t.a.seeking){if(!t.i)return}else t.i=!1;if(!t.a.paused){t.a.readyState!=t.m&&(t.c=!1,t.m=t.a.readyState);var e=t.o.smallGapLimit,n=t.a.currentTime,r=t.a.buffered;t:{if(r&&r.length&&!(1==r.length&&1e-6>r.end(0)-r.start(0)))for(var i=Gt("Edge/")||Gt("Trident/")||Gt("Tizen")||Gt("CrKey")?.5:.1,a=0;a<r.length;a++)if(r.start(a)>n&&(0==a||r.end(a-1)-n<=i)){i=a;break t}i=null}if(null==i)t.b&&(t=t.b,n=t.f,r=wa(n),n=n.a.currentTime,i=Date.now()/1e3,t.b==n&&t.g==r||(t.c=i,t.b=n,t.g=r),(n=i-t.c)>=t.h&&r&&t.a(t.b,n));else if(0!=i||t.h){a=r.start(i);var o=t.v.za();if(!(a>=o)){o=a-n,e=o<=e;var s=!1;.001>o||(e||t.c||(t.c=!0,n=new ct("largegap",{currentTime:n,gapSize:o}),n.cancelable=!0,t.l(n),t.o.jumpLargeGaps&&!n.defaultPrevented&&(s=!0)),!e&&!s)||(0!=i&&r.end(i-1),t.a.currentTime=a)}}}}}function Ta(t){var e=this;this.c=t,this.a=new Set,this.b=new Z(function(){xa(e,!1)}).La(.25)}function xa(t,e){for(var n=s(t.a),r=n.next();!r.done;r=n.next())r.value.g(t.c.currentTime,e)}function ka(t){var e=[];t=s(t);for(var n=t.next();!n.done;n=t.next()){n=s(n.value.variants);for(var r=n.next();!r.done;r=n.next())e.push(r.value)}return e}function Ca(t,e){for(var n=null,r=s(t),i=r.next();!i.done;i=r.next())i=i.value,e>=i.startTime&&(n=i);return n}function Ma(t){this.c=t,this.a=null,this.b=function(){}}function Ra(t,e){t.b=e}function La(t){var e=this;this.a=t,this.f=!1,this.c=this.a.ec(),this.b=new Z(function(){e.a.Jd(.25*e.c)})}function Ia(t){t.b.stop();var e=t.f?0:t.c;if(0<=e)try{return void(t.a.ec()!=e&&t.a.kd(e))}catch(n){}t.b.La(.25),0!=t.a.ec()&&t.a.kd(0)}function Pa(t,e,n){this.a=t,this.f=e,this.g=n,this.b=new Mt,this.c=new Fa(t),0<t.readyState?Na(this,n):Da(this,n)}function Oa(t){return 0<t.a.readyState?t.a.currentTime:t.g}function Da(t,e){t.g=e,t.b.da(t.a,"loadedmetadata"),t.b.ha(t.a,"loadedmetadata",function(){Na(t,e)})}function Na(t,e){.001>Math.abs(t.a.currentTime-e)?Ua(t):(t.b.ha(t.a,"seeking",function(){Ua(t)}),Ba(t.c,0==t.a.currentTime?e:t.a.currentTime))}function Ua(t){t.b.w(t.a,"seeking",function(){return t.f()})}function Fa(t){var e=this;this.b=t,this.h=10,this.g=this.f=this.c=0,this.a=new Z(function(){0>=e.c?e.a.stop():e.b.currentTime!=e.f?e.a.stop():(e.b.currentTime=e.g,e.c--)})}function Ba(t,e){t.f=t.b.currentTime,t.g=e,t.c=t.h,t.b.currentTime=e,t.a.La(.1)}function ja(t){function e(){n.f=!0,null!=n.b&&(n.a.currentTime=n.b)}var n=this;this.a=t,this.f=!1,this.b=null,this.c=new Mt,0==this.a.readyState?this.c.ha(this.a,"loadedmetadata",e):e()}function Va(t,e,n,r,i,a){var o=this;this.b=t,this.a=e.presentationTimeline,this.C=e.minBufferTime||0,this.g=n,this.v=i,this.l=null,this.f=new Aa(t,e.presentationTimeline,n,Ya(t,n),a),this.c=new Pa(t,function(){var t=o.f;t.i=!0,t.h=!1,t.c=!1;var e=Oa(o.c);return t=Ha(o,e),.001<Math.abs(t-e)&&(e=(new Date).getTime()/1e3,!o.l||o.l<e-1)?(o.l=e,e=o.c,0<e.a.readyState?Ba(e.c,t):Da(e,t),t=void 0):(o.v(),t=void 0),t},Ga(this,r)),this.i=new Z(function(){if(0!=o.b.readyState&&!o.b.paused){var t=o.b.currentTime,e=o.a.mb(),n=o.a.za();3>n-e&&(e=n-3),t<e&&(t=Ha(o,t),o.b.currentTime=t)}}).La(.25)}function Ga(t,e){return null==e?e=1/0>t.a.Y()?t.a.mb():t.a.za():0>e&&(e=t.a.za()+e),za(t,Ka(t,e))}function za(t,e){var n=t.a.Y();return e>=n?n-t.g.durationBackoff:e}function Ha(t,e){var n=Ne.bind(null,t.b.buffered),r=Math.max(t.C,t.g.rebufferingGoal),i=t.g.safeSeekOffset,a=t.a.mb(),o=t.a.za(),s=t.a.Y();3>o-a&&(a=o-3);var u=t.a.Fb(r),l=t.a.Fb(i);return r=t.a.Fb(r+i),e>=s?za(t,e):e>o?o:e<a?n(l)?l:r:e>=u||n(e)?e:r}function Ka(t,e){var n=t.a.mb();return e<n?n:(n=t.a.za(),e>n?n:e)}function Ya(t,e){if(!e.stallEnabled)return null;var n=e.stallSkip,r=new _a(new Ea(t),e.stallThreshold);return ba(r,function(){t.currentTime+=n}),r}function Wa(){this.b=function(){},this.a=new Set}function qa(t,e){t.b=e}function Xa(t){var e=this;this.h=t,this.f=new Map,this.a=function(){},this.b=function(){},this.c=function(){},this.i=[{bb:null,ab:Bh,Ua:function(t,n){return e.a(t,n)}},{bb:Fh,ab:Bh,Ua:function(t,n){return e.a(t,n)}},{bb:jh,ab:Bh,Ua:function(t,n){return e.a(t,n)}},{bb:Bh,ab:Fh,Ua:function(t,n){return e.b(t,n)}},{bb:Bh,ab:jh,Ua:function(t,n){return e.b(t,n)}},{bb:Fh,ab:jh,Ua:function(t,n){return e.c(t,n)}},{bb:jh,ab:Fh,Ua:function(t,n){return e.c(t,n)}}]}function $a(t,e,n,r){t.a=e,t.b=n,t.c=r}function Za(t,e){this.a=e,this.c=t,this.g=null,this.l=1,this.v=Promise.resolve(),this.h=[],this.i=new Map,this.b=new Map,this.o=!1,this.G=null,this.D=this.f=this.m=!1,this.C=0}function Qa(t){return to(t,"audio")}function Ja(t){return to(t,"video")}function to(t,e){var n=t.b.get(e);return n?n.Ia||n.stream:null}function eo(t,e){return c(function n(){var r,i,a,o,s,u,l,c,d,h;return k(n,function(n){switch(n.j){case 1:return r=jd,p(n,sn(t.a.I,r.qa),2);case 2:return t.C++,t.D=!1,i=t.C,a=t.a.I,o=new Map,s=new Set,o.set(r.qa,e),s.add(e),p(n,a.init(o,!1),3);case 3:return t.f?n["return"]():p(n,ho(t,s),4);case 4:if(t.f)return n["return"]();l=(u=t.a.I.g.isTextVisible())||t.g.alwaysStreamText,t.C!=i||t.b.has(r.qa)||t.D||!l||(c=t.a.Sa(),d=ko(t,c),h=lo(e,d,0),t.b.set(r.qa,h),Lo(t,h,0)),m(n)}})})}function no(t,e){var n=t.b.get("video");if(n){var r=n.stream;if(r)if(e){var i=r.trickModeVideo;i&&!n.Ia&&(io(t,i,!1,0,!1),n.Ia=r)}else(r=n.Ia)&&(n.Ia=null,io(t,r,!0,0,!1))}}function ro(t,e,n,r){e.video&&io(t,e.video,n,r,!1),e.audio&&io(t,e.audio,n,r,!1)}function io(t,e,n,r,i){var a=t.b.get(e.type);if(!a&&"text"==e.type&&t.g.ignoreTextStreamFailures)eo(t,e);else if(a){var o=Co(t,e),s=Array.from(t.b.values()).every(function(t){return t.pa==a.pa});n&&o!=a.pa&&s?t.b.forEach(function(e){so(t,e)}):(a.Ia&&(e.trickModeVideo?(a.Ia=e,e=e.trickModeVideo):a.Ia=null),(s=t.h[o])&&s.zb&&(s=t.i.get(e.id))&&s.zb&&(a.stream!=e||i)&&("text"==e.type&&tn(t.a.I,Ut(e.mimeType,e.codecs)),a.stream=e,a.hc=!0,ao(t,a,o)&&a.Jb.abort(),n&&(a.Pa?a.uc=!0:a.Ha?(a.Ma=!0,a.Yb=r,a.uc=!0):(Io(a),Ro(t,a,!0,r)["catch"](function(e){t.a&&t.a.onError(e)})))))}}function ao(t,e,n){if(!e.Jb)return!1;var r=t.a.Sa(),i=nn(t.a.I,e.type);if(null==(n=(n=vo(t,e,r,i,n))&&n.a?n.a-n.b:null))return!1;var a=e.stream.initSegmentReference;return a&&(n+=(a.a?a.a-a.b:null)||0),a=t.a.getBandwidthEstimate(),8*n/a<i-r-Math.max(t.c.minBufferTime||0,t.g.rebufferingGoal)||e.Jb.b.a>n}function oo(t){function e(e){var i=t.a.I;return"text"==e?(e=i.a,e=null!=e.a&&null!=e.b&&(n>=e.a&&n<e.b)):(e=an(i,e),e=Ne(e,n,r)),e}var n=t.a.Sa(),r=t.g.smallGapLimit,i=ko(t,n);if(Ot(t.b.values(),function(t){return t.pa==i}))for(var a=s(t.b.keys()),o=a.next();!o.done;o=a.next())o=o.value,e(o)||so(t,t.b.get(o));else Ot(t.b.keys(),e)||t.b.forEach(function(e){so(t,e)})}function so(t,e){e.Pa||e.Ma||(e.Ha?(e.Ma=!0,e.Yb=0):null==en(t.a.I,e.type)?null==e.Da&&Lo(t,e,0):(Io(e),Ro(t,e,!1,0)["catch"](function(e){t.a&&t.a.onError(e)})))}function uo(t,e,n,r,i){return c(function a(){var o,s,u,l,c,d,h;return k(a,function(a){switch(a.j){case 1:return o=t.a.Sa(),s=ko(t,o),u=jd,l=new Map,c=new Set,e&&(l.set(u.Ab,e),c.add(e)),n&&(l.set(u.Na,n),c.add(n)),r&&(l.set(u.qa,r),c.add(r)),d=t.a.I,h=t.g.forceTransmuxTS,p(a,d.init(l,h),2);case 2:return t.f?a["return"]():(fo(t),p(a,ho(t,c),3));case 3:if(t.f)return a["return"]();l.forEach(function(e,n){if(!t.b.has(n)){var r=lo(e,s,i);t.b.set(n,r),Lo(t,r,0)}}),m(a)}})})}function lo(t,e,n){return{stream:t,type:t.type,pb:null,Aa:null,Ia:null,hc:!0,pa:e,endOfStream:!1,Ha:!1,Da:null,Ma:!1,Yb:0,uc:!1,Pa:!1,cd:!1,Hb:!1,$d:n||0,Jb:null}}function co(t,e){var n=t.h[e];if(n)return n.promise;n={promise:new nt,zb:!1},t.h[e]=n;for(var r=new Set,i=s(t.c.periods[e].variants),a=i.next();!a.done;a=i.next())a=a.value,a.video&&r.add(a.video),a.video&&a.video.trickModeVideo&&r.add(a.video.trickModeVideo),a.audio&&r.add(a.audio);for(i=s(t.c.periods[e].textStreams),a=i.next();!a.done;a=i.next())r.add(a.value);return t.v=t.v.then(function(){if(!this.f)return ho(this,r)}.bind(t)).then(function(){this.f||(this.h[e].promise.resolve(),this.h[e].zb=!0)}.bind(t))["catch"](function(t){this.f||(this.h[e].promise["catch"](function(){}),this.h[e].promise.reject(),delete this.h[e],this.a.onError(t))}.bind(t)),n.promise}function ho(t,e){return c(function n(){var r,i,a,o,u,l,c;return k(n,function(n){switch(n.j){case 1:r=[];for(var d=s(e),h=d.next();!h.done;h=d.next())i=h.value,(a=t.i.get(i.id))?r.push(a.promise):(t.i.set(i.id,{promise:new nt,zb:!1}),r.push(i.createSegmentIndex()));return g(n,2),p(n,Promise.all(r),4);case 4:if(t.f)return n["return"]();y(n,3);break;case 2:if(o=_(n),t.f)return n["return"]();for(n=s(e),h=n.next();!h.done;h=n.next())u=h.value,t.i.get(u.id).promise["catch"](function(){}),t.i.get(u.id).promise.reject(),t.i["delete"](u.id);throw o;case 3:for(d=s(e),h=d.next();!h.done;h=d.next())l=h.value,c=t.i.get(l.id),c.zb||(c.promise.resolve(),c.zb=!0);m(n)}})})}function fo(t){var e=t.c.presentationTimeline.Y();1/0>e?t.a.I.wa(e):t.a.I.wa(Math.pow(2,32))}function po(t,e){if(!t.f&&!e.Ha&&null!=e.Da&&!e.Pa)if(e.Da=null,e.Ma)Ro(t,e,e.uc,e.Yb);else{try{var n=mo(t,e);null!=n&&(Lo(t,e,n),e.Hb=!1)}catch(r){return void Po(t,r)}n=Array.from(t.b.values()),To(t,e),t.o&&n.every(function(t){return t.endOfStream})&&t.a.I.endOfStream().then(function(){if(!this.f){var t=this.a.I.Y();0!=t&&t<this.c.presentationTimeline.Y()&&this.c.presentationTimeline.wa(t)}}.bind(t))}}function mo(t,e){function n(t){return"text"==t.type&&"application/cea-608"==t.stream.mimeType}if(n(e))return t.a.I.rc(e.stream.originalId||""),null;var r=t.a.Sa(),i=go(t,e,r),a=Co(t,e.stream),o=ko(t,i),s=rn(t.a.I,e.type,r),u=Math.max(t.c.minBufferTime||0,t.g.rebufferingGoal,t.g.bufferingGoal)*t.l;if(i>=t.c.presentationTimeline.Y())return e.endOfStream=!0,"video"==e.type&&(i=t.b.get("text"))&&"application/cea-608"==i.stream.mimeType&&(i.endOfStream=!0),null;if(e.endOfStream=!1,e.pa=o,o!=a)return null;if(s>=u)return.5;if(o=nn(t.a.I,e.type),!(o=vo(t,e,r,o,a)))return 1;var l=1/0;return Array.from(t.b.values()).forEach(function(e){n(e)||(e=go(t,e,r),l=Math.min(l,e))}),i>=l+t.c.presentationTimeline.a?1:(e.$d=0,_o(t,e,r,a,o),null)}function go(t,e,n){return e.pb&&e.Aa?(n=Co(t,e.pb),t.c.periods[n].startTime+e.Aa.endTime):Math.max(n,e.$d)}function vo(t,e,n,r,i){if(e.Aa&&e.stream==e.pb)return yo(t,e,i,e.Aa.position+1);if(e.Aa?(n=Co(t,e.pb),n=e.stream.findSegmentPosition(Math.max(0,t.c.periods[n].startTime+e.Aa.endTime-t.c.periods[i].startTime))):n=e.stream.findSegmentPosition(Math.max(0,(r||n)-t.c.periods[i].startTime)),null==n)return null;var a=null;return null==r&&(a=yo(t,e,i,Math.max(0,n-1))),a||yo(t,e,i,n)}function yo(t,e,n,r){return n=t.c.periods[n],(e=e.stream.getSegmentReference(r))?(r=t.c.presentationTimeline,t=r.Gb(),r=r.nb(),n.startTime+e.endTime<t||n.startTime+e.startTime>r?null:e):null}function _o(t,e,n,r,i){var a=t.c.periods[r],o=e.stream,s=t.c.presentationTimeline.Y(),u=t.c.periods[r+1];r=Eo(t,e,r,Math.max(0,a.startTime-.1),u?u.startTime+.01:s),e.Ha=!0,e.hc=!1,s=Mo(t,e,i),Promise.all([r,s]).then(function(t){if(!this.f&&!this.m)return wo(this,e,n,a,o,i,t[1])}.bind(t)).then(function(){this.f||this.m||(e.Ha=!1,e.cd=!1,e.Ma||this.a.Yc(),Lo(this,e,0),So(this,o))}.bind(t))["catch"](function(t){this.f||this.m||(e.Ha=!1,"text"==e.type&&this.g.ignoreTextStreamFailures?this.b["delete"]("text"):7001==t.code?(e.Ha=!1,e.Da=null,Lo(this,e,0)):3017==t.code?bo(this,e,t):(e.Hb=!0,t.severity=2,Po(this,t)))}.bind(t))}function bo(t,e,n){if(!Array.from(t.b.values()).some(function(t){return t!=e&&t.cd})){var r=Math.round(100*t.l);if(20<r)t.l-=.2;else{if(!(4<r))return e.Hb=!0,t.m=!0,void t.a.onError(n);t.l-=.04}e.cd=!0}Lo(t,e,4)}function Eo(t,e,n,r,i){return e.hc?(n=un(t.a.I,e.type,t.c.periods[n].startTime-e.stream.presentationTimeOffset,r,i),e.stream.initSegmentReference?(t=Mo(t,e,e.stream.initSegmentReference).then(function(t){if(!this.f)return on(this.a.I,e.type,t,null,null,e.stream.closedCaptions&&0<e.stream.closedCaptions.size)}.bind(t))["catch"](function(t){return e.hc=!0,Promise.reject(t)}),Promise.all([n,t])):n):Promise.resolve()}function wo(t,e,n,r,i,a,o){var s=i.closedCaptions&&0<i.closedCaptions.size;return null!=i.emsgSchemeIdUris&&0<i.emsgSchemeIdUris.length&&(new _r).ea("emsg",t.M.bind(t,r,a,i.emsgSchemeIdUris)).parse(o),Ao(t,e,n).then(function(){if(!this.f)return on(this.a.I,e.type,o,a.startTime+r.startTime,a.endTime+r.startTime,s)}.bind(t)).then(function(){if(!this.f)return e.pb=i,e.Aa=a,Promise.resolve()}.bind(t))}function Ao(t,e,n){var r=Math.max(t.g.bufferBehind,t.c.presentationTimeline.a),i=en(t.a.I,e.type);return null==i?Promise.resolve():(n=n-i-r,0>=n?Promise.resolve():t.a.I.remove(e.type,i,i+n).then(function(){}.bind(t)))}function So(t,e){if(!t.o){var n=Array.from(t.b.values());if(1==n.length&&"text"==n[0].type||(t.o=n.every(function(t){return"text"==t.type||!t.Ma&&!t.Pa&&t.Aa})),t.o){for(n=Co(t,e),t.h[n]||co(t,n).then(function(){this.f||this.a.Ld()}.bind(t))["catch"](Bd.ic),n=0;n<t.c.periods.length;++n)co(t,n)["catch"](Bd.ic);t.a.sf&&t.a.sf()}}}function To(t,e){var n=Co(t,e.stream);if(e.pa!=n){var r=e.pa,i=Array.from(t.b.values());i.every(function(t){return t.pa==r})&&i.every(xo)&&co(t,r).then(function(){if(!this.f&&i.every(function(t){var e=xo(t),n=Co(this,t.stream);return e&&t.pa==r&&n!=r}.bind(this))){var t=this.c.periods[r],e=this.a.Md(t),n=new Map;e.variant&&e.variant.video&&n.set("video",e.variant.video),e.variant&&e.variant.audio&&n.set("audio",e.variant.audio),e.text&&n.set("text",e.text);var a=s(this.b.keys());for(e=a.next();!e.done;e=a.next())if(e=e.value,!n.has(e)&&"text"!=e)return void this.a.onError(new et(2,5,5005));for(a=s(Array.from(n.keys())),e=a.next();!e.done;e=a.next())if(e=e.value,!this.b.has(e)){if("text"!=e)return void this.a.onError(new et(2,5,5005));uo(this,null,null,n.get("text"),t.startTime),n["delete"](e)}for(t=s(Array.from(this.b.keys())),e=t.next();!e.done;e=t.next())e=e.value,(a=n.get(e))?(io(this,a,!1,0,!1),Lo(this,this.b.get(e),0)):this.b["delete"](e);this.a.Ld()}}.bind(t))["catch"](Bd.ic)}}function xo(t){return!t.Ha&&null==t.Da&&!t.Ma&&!t.Pa}function ko(t,e){var n=Ca(t.c.periods,e+Vd);return n?t.c.periods.indexOf(n):0}function Co(t,e){for(var n=t.c.periods,r=0;r<n.length;r++){for(var i=n[r],a=new Set,o=s(i.variants),u=o.next();!u.done;u=o.next())u=u.value,u.audio&&a.add(u.audio),u.video&&a.add(u.video),u.video&&u.video.trickModeVideo&&a.add(u.video.trickModeVideo);for(i=s(i.textStreams),o=i.next();!o.done;o=i.next())a.add(o.value);if(a.has(e))return r}return-1}function Mo(t,e,n){return n=Zr(n.c(),n.b,n.a,t.g.retryParameters),t=t.a.rb.request(1,n),e.Jb=t,t.promise.then(function(t){return e.Jb=null,t.data})}function Ro(t,e,n,r){return c(function i(){var a,o,s;return k(i,function(i){switch(i.j){case 1:return e.Ma=!1,e.uc=!1,e.Yb=0,e.Pa=!0,r?(o=t.a.Sa(),s=t.a.I.Y(),a=t.a.I.remove(e.type,o+r,s)):a=sn(t.a.I,e.type).then(function(){if(!this.f&&n)return this.a.I.flush(e.type)}.bind(t)),p(i,a,2);case 2:if(t.f)return i["return"]();e.pb=null,e.Aa=null,e.Pa=!1,e.endOfStream=!1,Lo(t,e,0),m(i)}})})}function Lo(t,e,n){e.Da=new $(function(){return c(function n(){var r;return k(n,function(n){switch(n.j){case 1:return g(n,2),p(n,po(t,e),4);case 4:y(n,0);break;case 2:r=_(n),t.a&&t.a.onError(r),m(n)}})})}).O(n)}function Io(t){null!=t.Da&&(t.Da.stop(),t.Da=null)}function Po(t,e){J(t.G).then(function(){this.f||(this.a.onError(e),e.handled||this.g.failureCallback(e))}.bind(t))}function Oo(t,e,n,r,i,a){if(200<=n&&299>=n&&202!=n)return{uri:i||r,$c:r,data:e,headers:t,fromCache:!!t["x-shaka-from-cache"]};i=null;try{i=Yt(e)}catch(o){}throw new et(401==n||403==n?2:1,1,1001,r,n,i,t,a)}function Do(t,e,n,r){var i=new Do.b;Dt(e.headers).forEach(function(t,e){i.append(e,t)});var a=new Do.a,o={ud:!1,he:!1};if(t=Do.l(t,n,{body:e.body||void 0,headers:i,method:e.method,signal:a.signal,credentials:e.allowCrossSiteCredentials?"include":void 0},o,r),t=new rt(t,function(){return o.ud=!0,a.abort(),Promise.resolve()}),e=e.retryParameters.timeout){var s=new Z(function(){o.he=!0,a.abort()});s.O(e/1e3),t["finally"](function(){s.stop()})}return t}function No(t,e,n,r){var i=new No.f,a=Date.now(),o=0;return new rt(new Promise(function(u,l){i.open(e.method,t,!0),i.responseType="arraybuffer",i.timeout=e.retryParameters.timeout,i.withCredentials=e.allowCrossSiteCredentials,i.onabort=function(){l(new et(1,1,7001,t,n))},i.onload=function(e){e=e.target;var r=e.getAllResponseHeaders().trim().split("\r\n"),i={};r=s(r);for(var a=r.next();!a.done;a=r.next())a=a.value.split(": "),i[a[0].toLowerCase()]=a.slice(1).join(": ");try{var o=Oo(i,e.response,e.status,t,e.responseURL,n);u(o)}catch(c){l(c)}},i.onerror=function(e){l(new et(1,1,1002,t,e,n))},i.ontimeout=function(){l(new et(1,1,1003,t,n))},i.onprogress=function(t){var e=Date.now();(100<e-a||t.lengthComputable&&t.loaded==t.total)&&(r(e-a,t.loaded-o,t.total-t.loaded),o=t.loaded,a=e)};for(var c in e.headers)i.setRequestHeader(c.toLowerCase(),e.headers[c]);i.send(e.body)}),function(){return i.abort(),Promise.resolve()})}function Uo(){this.a=this.f=this.b=0,this.c=new Map,this.g=0}function Fo(t,e){t.b+=e;var n=t.g;return t.g++,t.c.set(n,e),n}function Bo(t,e){this.g=t,this.b=new Map,this.c=!1,this.f=e,this.a=new Uo}function jo(t,e,n,r,i){var a=Fo(t.a,r);r=t.b.get(e)||Promise.resolve(),t.b.set(e,r.then(function(){return c(function e(){var r;return k(e,function(e){switch(e.j){case 1:return p(e,Go(t,n),2);case 2:if(r=e.s,t.c)throw new et(2,9,7001);t.a.close(a,r.byteLength);var o=t.a;return t.f(0==o.b?0:o.f/o.b,t.a.a),e["return"](i(r))}})})}))}function Vo(t){return c(function e(){return k(e,function(e){switch(e.j){case 1:return p(e,Promise.all(t.b.values()),2);case 2:return e["return"](t.a.a)}})})}function Go(t,e){return c(function n(){var r,i;return k(n,function(n){switch(n.j){case 1:return r=t.g.request(1,e),p(n,r.promise,2);case 2:return i=n.s,n["return"](i.data)}})})}function zo(t,e){var n=this;this.c=t,this.b=t.objectStore(e),this.a=new nt,t.onabort=function(t){t.preventDefault(),n.a.reject()},t.onerror=function(t){t.preventDefault(),n.a.reject()},t.oncomplete=function(){n.a.resolve()}}function Ho(t,e){return new Promise(function(n,r){var i=t.b.openCursor();i.onerror=r,i.onsuccess=function(t){if(!(t=t.target.result))return n();e(t.key,t.value,t),t["continue"]()}})}function Ko(t){this.b=t,this.a=[]}function Yo(t,e){return qo(t,e,"readonly")}function Wo(t,e){return qo(t,e,"readwrite")}function qo(t,e,n){n=t.b.transaction([e],n);var r=new zo(n,e);return t.a.push(r),r.promise().then(function(){mt(t.a,r)},function(){mt(t.a,r)}),r}function Xo(t){this.a=new Ko(t)}function $o(){this.a=new Map}function Zo(t){var e=null;if(t.a.forEach(function(t,n){t.getCells().forEach(function(t,r){t.hasFixedKeySpace()||e||(e={path:{ua:n,aa:r},aa:t})})}),e)return e;throw new et(2,9,9013,"Could not find a cell that supports add-operations")}function Qo(t,e){t.a.forEach(function(t,n){t.getCells().forEach(function(t,r){e({ua:n,aa:r},t)})})}function Jo(t,e,n){if(!(t=t.a.get(e)))throw new et(2,9,9013,"Could not find mechanism with name "+e);if(!(e=t.getCells().get(n)))throw new et(2,9,9013,"Could not find cell with name "+n);return e}function ts(t,e){t.a.forEach(function(t){e(t.getEmeSessionCell())})}function es(t){var e=Array.from(t.a.keys());if(!e.length)throw new et(2,9,9e3,"No supported storage mechanisms found");return t.a.get(e[0]).getEmeSessionCell()}function ns(t,e){Vh.set(t,e)}function rs(t){this.a=new Ko(t)}function is(t){return Promise.reject(new et(2,9,9011,"Cannot add new value to "+t))}function as(t,e,n,r){t=Wo(t.a,e);var i=t.store();return n.forEach(function(t){i["delete"](t).onsuccess=function(){return r(t)}}),t.promise()}function os(t,e,n){t=Yo(t.a,e);var r=t.store(),i={},a=[];return n.forEach(function(t){r.get(t).onsuccess=function(e){e=e.target.result,void 0==e&&a.push(t),i[t]=e}}),t.promise().then(function(){return a.length?Promise.reject(new et(2,9,9012,"Could not find values for "+a)):n.map(function(t){return i[t]})})}function ss(t){return{originalManifestUri:t.originalManifestUri,duration:t.duration,size:t.size,expiration:null==t.expiration?1/0:t.expiration,periods:t.periods.map(us),sessionIds:t.sessionIds,drmInfo:t.drmInfo,appMetadata:t.appMetadata}}function us(t){return fs(t),t.streams.forEach(function(){}),{startTime:t.startTime,streams:t.streams.map(ls)}}function ls(t){var e=t.$e?hs(t.$e):null;return{id:t.id,originalId:null,primary:t.primary,presentationTimeOffset:t.presentationTimeOffset,contentType:t.contentType,mimeType:t.mimeType,codecs:t.codecs,frameRate:t.frameRate,kind:t.kind,language:t.language,label:t.label,width:t.width,height:t.height,initSegmentKey:e,encrypted:t.encrypted,keyId:t.keyId,segments:t.segments.map(cs),variantIds:t.variantIds}}function cs(t){var e=hs(t.uri);return{startTime:t.startTime,endTime:t.endTime,dataKey:e}}function ds(t){return{data:t.data}}function hs(t){var e;if((e=/^offline:[0-9]+\/[0-9]+\/([0-9]+)$/.exec(t))||(e=/^offline:segment\/([0-9]+)$/.exec(t)))return Number(e[1]);throw new et(2,9,9004,"Could not parse uri "+t)}function fs(t){var e=t.streams.filter(function(t){return"audio"==t.contentType}),n=t.streams.filter(function(t){return"video"==t.contentType});if(!e.every(function(t){return t.variantIds})||!n.every(function(t){return t.variantIds})){e.forEach(function(t){t.variantIds=[]}),n.forEach(function(t){t.variantIds=[]});var r=0;if(n.length&&!e.length){var i=r++;n.forEach(function(t){t.variantIds.push(i)})}if(!n.length&&e.length){var a=r++;e.forEach(function(t){t.variantIds.push(a)})}n.length&&e.length&&e.forEach(function(t){n.forEach(function(e){var n=r++;t.variantIds.push(n),e.variantIds.push(n)})})}}function ps(t,e,n,r){this.a=new Ko(t),this.c=e,this.b=n,this.f=r}function ms(t,e,n){if(t.f)return Promise.reject(new et(1,9,9011,"Cannot add new value to "+e));t=Wo(t.a,e);var r=t.store(),i=[];return n.forEach(function(t){r.add(t).onsuccess=function(t){i.push(t.target.result)}}),t.promise().then(function(){return i})}function gs(t,e,n,r){t=Wo(t.a,e);var i=t.store();return n.forEach(function(t){i["delete"](t).onsuccess=function(){return r(t)}}),t.promise()}function vs(t,e,n){t=Yo(t.a,e);var r=t.store(),i={},a=[];return n.forEach(function(t){var e=r.get(t);e.onsuccess=function(){void 0==e.result&&a.push(t),i[t]=e.result}}),t.promise().then(function(){return a.length?Promise.reject(new et(1,9,9012,"Could not find values for "+a)):n.map(function(t){return i[t]})})}function ys(){this.g=this.c=this.b=this.a=this.f=null}function _s(){var e=new nt,n=t.indexedDB.deleteDatabase("shaka_offline_db");return n.onblocked=function(){},n.onsuccess=function(){e.resolve()},n.onerror=function(t){e.reject(new et(2,9,9001,n.error)),t.preventDefault()},e}function bs(t,e,n,r){this.a=t,this.g=e,this.f=n,this.c=r,this.b=["offline:",t,"/",e,"/",n,"/",r].join("")}function Es(t){if(null==(t=/^offline:([a-z]+)\/([^\/]+)\/([^\/]+)\/([0-9]+)$/.exec(t)))return null;var e=t[1];if("manifest"!=e&&"segment"!=e)return null;var n=t[2];if(!n)return null;var r=t[3];return r&&null!=e?new bs(e,n,r,Number(t[4])):null}function ws(t,e){this.b=t,this.a=e}function As(t,e){var n=new $r(null,0);n.wa(e.duration);var r=e.periods.map(function(e){return Ss(t,e,n)}),i=e.drmInfo?[e.drmInfo]:[];return e.drmInfo&&r.forEach(function(t){t.variants.forEach(function(t){t.drmInfos=i})}),{presentationTimeline:n,minBufferTime:2,offlineSessionIds:e.sessionIds,periods:r}}function Ss(t,e,n){var r=e.streams.filter(function(t){return"audio"==t.contentType}),i=e.streams.filter(function(t){return"video"==t.contentType});return r=Ts(t,r,i),i=e.streams.filter(function(t){return"text"==t.contentType}).map(function(e){return xs(t,e)}),e.streams.forEach(function(r){r=r.segments.map(function(e,n){return ks(t,n,e)}),n.sb(r,e.startTime)}),{startTime:e.startTime,variants:Array.from(r.values()),textStreams:i}}function Ts(t,e,n){for(var r=new Set,i=s(e),a=i.next();!a.done;a=i.next()){var o=s(a.value.variantIds);for(a=o.next();!a.done;a=o.next())r.add(a.value)}for(i=s(n),a=i.next();!a.done;a=i.next())for(o=s(a.value.variantIds),a=o.next();!a.done;a=o.next())r.add(a.value);for(i=new Map,r=s(r),a=r.next();!a.done;a=r.next())a=a.value,i.set(a,{id:a,language:"",primary:!1,audio:null,video:null,bandwidth:0,drmInfos:[],allowedByApplication:!0,allowedByKeySystem:!0});for(e=s(e),r=e.next();!r.done;r=e.next())for(r=r.value,a=xs(t,r),o=s(r.variantIds),r=o.next();!r.done;r=o.next())r=i.get(r.value),r.language=a.language,r.primary=r.primary||a.primary,r.audio=a;for(n=s(n),e=n.next();!e.done;e=n.next())for(r=e.value,e=xs(t,r),a=s(r.variantIds),r=a.next();!r.done;r=a.next())r=i.get(r.value),r.primary=r.primary||e.primary,r.video=e;return i}function xs(t,e){var n=e.segments.map(function(e,n){return ks(t,n,e)}),r=new kr(n);return n={id:e.id,originalId:e.originalId,createSegmentIndex:function(){return Promise.resolve()},findSegmentPosition:function(t){return r.find(t)},getSegmentReference:function(t){return r.get(t)},initSegmentReference:null,presentationTimeOffset:e.presentationTimeOffset,mimeType:e.mimeType,codecs:e.codecs,width:e.width||void 0,height:e.height||void 0,frameRate:e.frameRate||void 0,kind:e.kind,encrypted:e.encrypted,keyId:e.keyId,language:e.language,label:e.label||null,type:e.contentType,primary:e.primary,trickModeVideo:null,emsgSchemeIdUris:null,roles:[],channelsCount:null,closedCaptions:null},null!=e.initSegmentKey&&(n.initSegmentReference=Cs(t,e.initSegmentKey)),n}function ks(t,e,n){var r=new bs("segment",t.b,t.a,n.dataKey);return new gr(e,n.startTime,n.endTime,function(){return[r.toString()]},0,null)}function Cs(t,e){var n=new bs("segment",t.b,t.a,e);return new mr(function(){return[n.toString()]},0,null)}function Ms(){this.a=null}function Rs(t){var e=Es(t);return e&&"manifest"==e.a?Rs.h(t):e&&"segment"==e.a?Rs.i(e.key(),e):it(new et(2,1,9004,t))}function Ls(t,e,n){return c(function r(){var i,a,o,u,l,c;return k(r,function(r){switch(r.j){case 1:i=[];for(var d=[],h=s(n),f=h.next();!f.done;f=h.next()){f=f.value;for(var m=!1,g=s(d),v=g.next();!v.done;v=g.next())if(v=v.value,Ps(v.info,f)){v.sessionIds.push(f.sessionId),m=!0;break}m||d.push({info:f,sessionIds:[f.sessionId]})}a=s(d),o=a.next();case 2:if(o.done){r.A(4);break}return u=o.value,l=Is(t,e,u),p(r,l,5);case 5:c=r.s,i=i.concat(c),o=a.next(),r.A(2);break;case 4:return r["return"](i)}})})}function Is(t,e,n){return c(function r(){var i,a;return k(r,function(r){switch(r.j){case 1:return i=new ne({rb:e,onError:function(){},kc:function(){},onExpirationUpdated:function(){},onEvent:function(){}}),g(r,2),i.configure(t),p(r,oe(i,n.info.keySystem,n.info.licenseUri,n.info.serverCertificate,n.info.audioCapabilities,n.info.videoCapabilities),4);case 4:y(r,3);break;case 2:return _(r),p(r,i.destroy(),5);case 5:return r["return"]([]);case 3:return g(r,6),p(r,ue(i),8);case 8:y(r,7);break;case 6:return _(r),p(r,i.destroy(),9);case 9:return r["return"]([]);case 7:return a=[],p(r,Promise.all(n.sessionIds.map(function(t){return c(function e(){return k(e,function(e){switch(e.j){case 1:return g(e,2),p(e,le(i,t),4);case 4:a.push(t),y(e,0);break;case 2:_(e),m(e)}})})})),10);case 10:return p(r,i.destroy(),11);case 11:return r["return"](a)}})})}function Ps(t,e){function n(t,e){return t.robustness==e.robustness&&t.contentType==e.contentType}return t.keySystem==e.keySystem&&t.licenseUri==e.licenseUri&&vt(t.audioCapabilities,e.audioCapabilities,n)&&vt(t.videoCapabilities,e.videoCapabilities,n)}function Os(t,e){var n=Ju(),r=this;this.g=e,this.c=t,this.i=n,this.h=null,this.f=[],this.b=this.a=null,this.l=!0,this.m=Promise.resolve().then(function(){return Ns(r)})}function Ds(t,e){var n={tb:function(){},jc:function(){},Wa:function(){},onError:function(){},lc:function(){},wg:function(){}};return t.f.push({create:e,ta:n}),t.b&&t.b.abort(),Fs(t),n}function Ns(t){return c(function e(){return k(e,function(e){switch(e.j){case 1:if(t.l){if(0==t.f.length||t.a&&!t.a.Ta)var n=!1;else{t.a&&(t.a.ta.Wa(),t.a=null),n=t.f.shift();var r=n.create(t.i);r?(n.ta.tb(),t.a={node:r.node,payload:r.payload,Ta:r.Ta,ta:n.ta}):n.ta.lc(),n=!0}return n?n=Promise.resolve():t.a?n=Us(t):(t.g.ff(t.c),t.h=new nt,n=t.h),p(e,n,1)}e.A(0)}})})}function Us(t){return c(function e(){var n,r;return k(e,function(e){switch(e.j){case 1:return t.c=t.g.Pe(t.c,t.i,t.a.node,t.a.payload),g(e,2),t.b=t.g.ze(t.c,t.i,t.a.payload),p(e,t.b.promise,4);case 4:t.b=null,t.c==t.a.node&&(t.a.ta.jc(),t.a=null),y(e,0);break;case 2:return n=_(e),7001==n.code?t.a.ta.Wa():t.a.ta.onError(n),t.a=null,t.b=null,r=t,p(e,t.g.handleError(t.i,n),5);case 5:r.c=e.s,m(e)}})})}function Fs(t){t.h&&(t.h.resolve(),t.h=null)}function Bs(t){this.a=null;for(var e=0;e<t.textTracks.length;++e){var n=t.textTracks[e];n.mode="disabled","Shaka Player TextTrack"==n.label&&(this.a=n)}this.a||(this.a=t.addTextTrack("subtitles","Shaka Player TextTrack")),this.a.mode="hidden"}function js(t){if(t.startTime>=t.endTime)return null;var e=new VTTCue(t.startTime,t.endTime,t.payload);e.lineAlign=t.lineAlign,e.positionAlign=t.positionAlign,e.size=t.size;try{e.align=t.textAlign}catch(n){}return"center"==t.textAlign&&"center"!=e.align&&(e.align="middle"),"vertical-lr"==t.writingMode?e.vertical="lr":"vertical-rl"==t.writingMode&&(e.vertical="rl"),1==t.lineInterpretation&&(e.snapToLines=!1),null!=t.line&&(e.line=t.line),null!=t.position&&(e.position=t.position),e}function Vs(t,e){var n=t.mode;t.mode="showing"==n?"showing":"hidden";for(var r=t.cues,i=r.length-1;0<=i;i--){var a=r[i];a&&e(a)&&t.removeCue(a)}t.mode=n}function Gs(t,e,n,r,i){var a,o=i in r,s=!0;for(a in e){var u=i+"."+a,l=o?r[i]:n[a];o||a in n?void 0===e[a]?void 0===l||o?delete t[a]:t[a]=ft(l):l.constructor==Object&&e[a]&&e[a].constructor==Object?(t[a]||(t[a]=ft(l)),u=Gs(t[a],e[a],l,r,u),s=s&&u):typeof e[a]!=typeof l||null==e[a]||e[a].constructor!=l.constructor?s=!1:t[a]=e[a]:s=!1}return s}function zs(t,e){for(var n={},r=n,i=0,a=0;!(0>(i=t.indexOf(".",i)));)0!=i&&"\\"==t[i-1]||(a=t.substring(a,i).replace(/\\\./g,"."),r[a]={},r=r[a],a=i+1),i+=1;return r[t.substring(a).replace(/\\\./g,".")]=e,n}function Hs(){}function Ks(){var t=5e5,e=1/0;navigator.connection&&(t=1e6*navigator.connection.downlink,navigator.connection.saveData&&(e=360));var n={retryParameters:tt(),servers:{},clearKeys:{},advanced:{},delayLicenseRequestUntilPlayed:!1},r={retryParameters:tt(),availabilityWindowOverride:NaN,dash:{customScheme:function(t){if(t)return null},clockSyncUri:"",ignoreDrmInfo:!1,xlinkFailGracefully:!1,defaultPresentationDelay:10,ignoreMinBufferTime:!1,autoCorrectDrift:!0}},i={retryParameters:tt(),failureCallback:function(){},rebufferingGoal:2,bufferingGoal:10,bufferBehind:30,ignoreTextStreamFailures:!1,alwaysStreamText:!1,startAtSegmentBoundary:!1,smallGapLimit:.5,jumpLargeGaps:!1,durationBackoff:1,forceTransmuxTS:!1,safeSeekOffset:5,stallEnabled:!0,stallThreshold:1,stallSkip:.1};Gt("Web0S")&&(i.stallEnabled=!1);var a={trackSelectionCallback:function(t){return t},progressCallback:function(){},usePersistentLicense:!0},o={drm:n,manifest:r,streaming:i,offline:a,abrFactory:In,abr:{enabled:!0,defaultBandwidthEstimate:t,switchInterval:8,bandwidthUpgradeTarget:.85,bandwidthDowngradeTarget:.95,restrictions:{minWidth:0,maxWidth:1/0,minHeight:0,maxHeight:e,minPixels:0,maxPixels:1/0,minBandwidth:0,maxBandwidth:1/0}},preferredAudioLanguage:"",preferredTextLanguage:"",preferredVariantRole:"",preferredTextRole:"",preferredAudioChannelCount:2,restrictions:{minWidth:0,maxWidth:1/0,minHeight:0,maxHeight:1/0,minPixels:0,maxPixels:1/0,minBandwidth:0,maxBandwidth:1/0},playRangeStart:0,playRangeEnd:1/0,textDisplayFactory:function(){return null}};return a.trackSelectionCallback=function(t){return Ws(t,o.preferredAudioLanguage)},o}function Ys(t,e,n){var r={".drm.servers":"",".drm.clearKeys":"",".drm.advanced":{distinctiveIdentifierRequired:!1,persistentStateRequired:!1,videoRobustness:"",audioRobustness:"",serverCertificate:new Uint8Array(0),individualizationServer:""}};return Gs(t,e,n||Ks(),r,"")}function Ws(t,e){var n=t.filter(function(t){return"variant"==t.type}),r=[],i=gn(e,n.map(function(t){return t.language}));i&&(r=n.filter(function(t){return pn(t.language)==i})),0==r.length&&(r=n.filter(function(t){return t.primary})),0==r.length&&(n.map(function(t){return t.language}),r=n);var a=r.filter(function(t){return t.height&&480>=t.height});if(a.length&&(a.sort(function(t,e){return e.height-t.height}),r=a.filter(function(t){return t.height==a[0].height})),n=[],r.length){var o=Math.floor(r.length/2);r.sort(function(t,e){return t.bandwidth-e.bandwidth}),n.push(r[o])}for(r=s(t),o=r.next();!o.done;o=r.next())o=o.value,"text"==o.type&&n.push(o);return n}function qs(){this.a=null,this.b=[]}function Xs(t,e){if(null==t.a)t.a={timestamp:Date.now()/1e3,state:e,duration:0};else{var n=Date.now()/1e3;t.a.duration=n-t.a.timestamp,t.a.state!=e&&(t.b.push(t.a),t.a={timestamp:n,state:e,duration:0})}}function $s(t,e){var n=0;t.a&&t.a.state==e&&(n+=t.a.duration);for(var r=s(t.b),i=r.next();!i.done;i=r.next())i=i.value,n+=i.state==e?i.duration:0;return n}function Zs(t){function e(t){return{timestamp:t.timestamp,state:t.state,duration:t.duration}}for(var n=[],r=s(t.b),i=r.next();!i.done;i=r.next())n.push(e(i.value));return t.a&&n.push(e(t.a)),n}function Qs(){this.b=this.c=null,this.a=[]}function Js(){this.f=this.l=this.b=this.h=this.i=this.g=this.m=NaN,this.a=new qs,this.c=new Qs}function tu(e,n){var r=this;ht.call(this),this.h=Yh,this.a=null,this.eb=!1,this.i=new Mt,this.vc=this.l=this.Bb=this.c=this.m=this.f=this.Rb=this.P=this.Sb=this.W=this.gb=this.o=this.D=this.g=this.G=null,this.Id=1e9,this.Vb=new Set,this.ib=!0,this.Ea=null,this.Ed=!1,this.Cd=0,this.na=null,this.$=new oa,this.b=Eu(this),this.Wb={width:1/0,height:1/0},this.v=null,this.Tb=new ma(this.b.preferredAudioLanguage,this.b.preferredVariantRole,this.b.preferredAudioChannelCount),this.ma=this.b.preferredTextLanguage,this.cb=this.b.preferredTextRole,n&&n(this),this.G=fu(this),this.i.w(t,"online",function(){r.fd()}),this.C={name:"detach"},this.M={name:"attach"},this.Fa={name:"unload"},this.Ec={name:"manifest-parser"},this.Cc={name:"manifest"},this.fb={name:"media-source"},this.wc={name:"drm-engine"},this.T={name:"load"},this.Hc={name:"src-equals-drm-engine"},this.hb={name:"src-equals"};var i=new Map;i.set(this.M,function(t,e){return st(nu(r,t,e))}),i.set(this.C,function(t){return t.u&&(r.i.da(t.u,"error"),t.u=null),r.a=null,t=Promise.resolve(),st(t)}),i.set(this.Fa,function(t){return st(ru(r,t))}),i.set(this.fb,function(t){return t=iu(r,t),st(t)}),i.set(this.Ec,function(t,e){return st(au(r,t,e))}),i.set(this.Cc,function(t){return ou(r,t)}),i.set(this.wc,function(){return st(su(r))}),i.set(this.T,function(t,e){return st(uu(r,t,e))}),i.set(this.Hc,function(t){return t=lu(r,t),st(t)}),i.set(this.hb,function(t,e){return cu(r,t,e)}),this.jb=new Os(this.C,{Pe:function(t,e,n,i){var a=null;return t==r.C&&(a=n==r.C?r.C:r.M),t==r.M&&(a=n==r.C||e.u!=i.u?r.C:n==r.M?r.M:n==r.fb||n==r.T?r.fb:n==r.hb?r.Hc:null),t==r.fb&&(a=n==r.T&&e.u==i.u?r.Ec:r.Fa),t==r.Ec&&(a=Qu(r.T,r.Cc,r.Fa,n,e,i)),t==r.Cc&&(a=Qu(r.T,r.wc,r.Fa,n,e,i)),t==r.wc&&(a=Qu(r.T,r.T,r.Fa,n,e,i)),t==r.Hc&&(a=n==r.hb&&e.u==i.u?r.hb:r.Fa),t!=r.T&&t!=r.hb||(a=r.Fa),t==r.Fa&&(a=i.u&&e.u==i.u?r.M:r.C),a},ze:function(t,e,n){return r.dispatchEvent(new ct("onstatechange",{state:t.name})),i.get(t)(e,n)},handleError:function(t){return c(function e(){return k(e,function(e){switch(e.j){case 1:return p(e,ru(r,t),2);case 2:return e["return"](t.u?r.M:r.C)}})})},ff:function(t){r.dispatchEvent(new ct("onstateidle",{state:t.name}))}}),e&&this.Cb(e,!0)}function eu(t){if(t.ya)return!1;if(!jt())return!0;var e=t.mimeType;return t=t.uri||"",e||(e={mp4:"video/mp4",m4v:"video/mp4",m4a:"audio/mp4",webm:"video/webm",ts:"video/mp2t",m3u8:"application/x-mpegurl",mp3:"audio/mpeg",aac:"audio/aac",flac:"audio/flac"}[kh.getExtension(t)]),!!e&&(!!Vt(e)&&(!kh.isSupported(t,e)||!!navigator.vendor&&navigator.vendor.includes("Apple")))}function nu(t,e,n){return null==e.u&&(e.u=n.u,t.i.w(e.u,"error",function(){var e=Fu(t);e&&t.Ka(e)})),t.a=e.u,Promise.resolve()}function ru(t,e){return c(function n(){return k(n,function(n){switch(n.j){case 1:if(t.h!=Kh&&(t.h=Yh),t.dispatchEvent(new ct("unloading")),e.ya=null,e.mimeType=null,e.startTime=null,e.uri=null,e.u&&(t.i.da(e.u,"loadeddata"),t.i.da(e.u,"playing"),t.i.da(e.u,"pause"),t.i.da(e.u,"ended"),t.i.da(e.u,"ratechange")),t.gb&&(t.gb.release(),t.gb=null),t.Sb&&(t.Sb.stop(),t.Sb=null),!t.m){n.A(2);break}return p(n,t.m.stop(),3);case 3:t.m=null;case 2:if(!t.l){n.A(4);break}return p(n,t.l.stop(),4);case 4:if(!t.f){n.A(6);break}return p(n,t.f.destroy(),7);case 7:t.f=null;case 6:if(t.o&&(t.o.release(),t.o=null),!t.D){n.A(8);break}return p(n,t.D.destroy(),9);case 9:t.D=null;case 8:if(e.u&&e.u.src&&(e.u.removeAttribute("src"),e.u.load()),!t.g){n.A(10);break}return p(n,t.g.destroy(),11);case 11:t.g=null;case 10:t.$.a.clear(),t.Bb=null,t.P=null,t.Vb.clear(),t.c=null,t.v=null,t.xc=null,t.ib=!0,ku(t),m(n)}})})}function iu(e,n){return c(function r(){var i,a,o,s;return k(r,function(r){switch(r.j){case 1:return i=t.muxjs?new Pe:new Oe,a=e.b.textDisplayFactory,o=new a,e.xc=a,s=new Qe(n.u,i,o),p(r,s.o,2);case 2:e.D=s,m(r)}})})}function au(t,e,n){return c(function r(){var i,a,o;return k(r,function(r){switch(r.j){case 1:if(e.ya=n.ya,e.mimeType=n.mimeType,e.uri=n.uri,i=e.uri,a=t.G,t.Bb=i,e.ya){t.m=e.ya(),r.A(2);break}return o=t,p(r,kh.create(i,a,t.b.manifest.retryParameters,e.mimeType),3);case 3:o.m=r.s;case 2:t.m.configure(t.b.manifest),m(r)}})})}function ou(t,e){var n=e.uri,r=t.G;t.Rb=new Wa,qa(t.Rb,function(e){Uu(t,"timelineregionadded",e)});var i={networkingEngine:r,filterNewPeriod:function(e){return t.Fc(e)},filterAllPeriods:function(e){return Au(t,e)},onTimelineRegionAdded:function(e){var n=t.Rb;t:{for(var r=s(n.a),i=r.next();!i.done;i=r.next())if(i=i.value,i.schemeIdUri==e.schemeIdUri&&i.startTime==e.startTime&&i.endTime==e.endTime){r=i;break t}r=null}null==r&&(n.a.add(e),n.b(e))},onEvent:function(e){return t.dispatchEvent(e)},onError:function(e){return t.Ka(e)}};return new rt(Promise.resolve().then(function(){return c(function e(){var r;return k(e,function(e){switch(e.j){case 1:return r=t,p(e,t.m.start(n,i),2);case 2:if(r.c=e.s,t.dispatchEvent(new ct("manifestparsed")),0==t.c.periods.length)throw new et(2,4,4014);du(t.c.periods),m(e)}})})}),function(){return t.m.stop()})}function su(t){return c(function e(){return k(e,function(e){switch(e.j){case 1:return t.g=new ne({rb:t.G,onError:function(e){t.Ka(e)},kc:function(e){Bu(t,e)},onExpirationUpdated:function(e,n){ju(t,e,n)},onEvent:function(e){t.dispatchEvent(e)}}),t.g.configure(t.b.drm),p(e,ae(t.g,ka(t.c.periods),t.c.offlineSessionIds),2);case 2:Au(t,t.c.periods),m(e)}})})}function uu(t,e,n){return c(function r(){var i,a,o,u,l,c,d,h,f;return k(r,function(r){switch(r.j){case 1:return e.startTime=n.startTime,i=e.u,a=e.uri,t.Bb=a,t.v=new Js,o=function(){return Cu(t)},u=function(){var e=t.a.playbackRate;0!=e&&t.W.set(e)},t.i.w(i,"playing",o),t.i.w(i,"pause",o),t.i.w(i,"ended",o),t.i.w(i,"ratechange",u),l=t.b.abrFactory,t.l&&t.vc==l||(t.vc=l,t.l=new l,t.l.configure(t.b.abr)),wu(t,t.c.periods),t.Tb=new ma(t.b.preferredAudioLanguage,t.b.preferredVariantRole,t.b.preferredAudioChannelCount),t.ma=t.b.preferredTextLanguage,Vu(t.c.presentationTimeline,t.b.playRangeStart,t.b.playRangeEnd),p(r,t.g.Cb(i),2);case 2:return t.l.init(function(e,n,r){n=void 0!==n&&n,r=void 0===r?0:r;t:{for(var i=s(t.c.periods),a=i.next();!a.done;a=i.next())if(a=a.value,a.variants.includes(e)){i=a;break t}i=null}_u(t,i,e,!0),t.f&&(ro(t.f,e,n,r),Lu(t))}),t.o=pu(t,e.startTime),t.gb=mu(t),t.W=new La({ec:function(){return e.u.playbackRate},kd:function(t){e.u.playbackRate=t},Jd:function(t){e.u.currentTime+=t}}),c=Math.max(t.c.minBufferTime,t.b.streaming.rebufferingGoal),gu(t,c),t.f=vu(t),t.f.configure(t.b.streaming),hu(t),t.h=Wh,t.dispatchEvent(new ct("streaming")),p(r,t.f.start(),3);case 3:t.b.streaming.startAtSegmentBoundary&&(d=t.o.h(),h=xu(t,d),t.o.m(h)),t.c.periods.forEach(t.Fc.bind(t)),Iu(t),Lu(t),f=qu(t),f.variants.some(function(t){return t.primary}),Mu(t,f.variants),t.i.ha(i,"loadeddata",function(){t.v.b=Date.now()/1e3-n.nd}),m(r)}})})}function lu(t,e){return c(function n(){var r,i;return k(n,function(n){switch(n.j){case 1:return r=jd,t.g=new ne({rb:t.G,onError:function(e){t.Ka(e)},kc:function(e){Bu(t,e)},onExpirationUpdated:function(e,n){ju(t,e,n)},onEvent:function(e){t.dispatchEvent(e)}}),t.g.configure(t.b.drm),i={id:0,language:"und",primary:!1,audio:null,video:{id:0,originalId:null,createSegmentIndex:Promise.resolve.bind(Promise),findSegmentPosition:function(){return null},getSegmentReference:function(){return null},initSegmentReference:null,presentationTimeOffset:0,mimeType:"video/mp4",codecs:"",encrypted:!0,keyId:null,language:"und",label:null,type:r.Na,primary:!1,trickModeVideo:null,emsgSchemeIdUris:null,roles:[],channelsCount:null,closedCaptions:null},bandwidth:100,drmInfos:[],allowedByApplication:!0,allowedByKeySystem:!0},p(n,ae(t.g,[i],[]),2);case 2:return p(n,t.g.Cb(e.u),0)}})})}function cu(t,e,n){function r(){return Cu(t)}if(e.uri=n.uri,e.startTime=n.startTime,t.Bb=e.uri,t.v=new Js,t.o=new ja(e.u),null!=e.startTime&&t.o.m(e.startTime),t.W=new La({ec:function(){return e.u.playbackRate},kd:function(t){e.u.playbackRate=t},Jd:function(t){e.u.currentTime+=t}}),gu(t,t.b.streaming.rebufferingGoal),t.i.w(e.u,"playing",r),t.i.w(e.u,"pause",r),t.i.w(e.u,"ended",r),t.i.ha(e.u,"loadeddata",function(){t.v.b=Date.now()/1e3-n.nd}),t.a.audioTracks&&(t.i.w(t.a.audioTracks,"addtrack",function(){return Iu(t)}),t.i.w(t.a.audioTracks,"removetrack",function(){return Iu(t)})),t.a.textTracks){var i=t.a.textTracks;t.i.w(i,"addtrack",function(){return Iu(t)}),t.i.w(i,"removetrack",function(){return Iu(t)})}e.u.src=e.uri,t.h=qh,t.dispatchEvent(new ct("streaming"));var a=new nt;return t.a.readyState>=HTMLMediaElement.HAVE_CURRENT_DATA?a.resolve():t.a.error?a.reject(Fu(t)):(t.i.ha(t.a,"loadeddata",function(){a.resolve()}),t.i.ha(t.a,"error",function(){a.reject(Fu(t))})),new rt(a,function(){return a.reject(new et(2,7,7001)),Promise.resolve()})}function du(t){function e(t){return t.video&&t.audio||t.video&&t.video.codecs.includes(",")}t.some(function(t){return t.variants.some(e)})&&t.forEach(function(t){t.variants=t.variants.filter(e)})}function hu(t){function e(t){var e="";t.video&&(e=Bt(t.video.codecs)[0]);var n="";return t.audio&&(n=Bt(t.audio.codecs)[0]),e+"-"+n}var n=t.c.periods.reduce(function(t,e){return t.concat(e.variants)},[]);n=kn(n,t.b.preferredAudioChannelCount);var r=new dt;n.forEach(function(t){var n=e(t);r.push(n,t)});var i=null,a=1/0;r.forEach(function(t,e){var n=0,r=0;e.forEach(function(t){n+=t.bandwidth||0,++r});var o=n/r;o<a&&(i=t,a=o)}),t.c.periods.forEach(function(t){t.variants=t.variants.filter(function(t){return e(t)==i})})}function fu(t){return new bt(function(e,n){t.l&&t.l.segmentDownloaded(e,n)})}function pu(t,e){return new Va(t.a,t.c,t.b.streaming,e,function(){t.gb&&xa(t.gb,!0),t.f&&oo(t.f)},function(e){return t.dispatchEvent(e)})}function mu(t){var e=new Ma(t.c);Ra(e,function(){Iu(t)});var n=new Xa(t.Rb);$a(n,function(e){Uu(t,"timelineregionenter",e)},function(e){Uu(t,"timelineregionexit",e)},function(e,n){n||(Uu(t,"timelineregionenter",e),Uu(t,"timelineregionexit",e))});var r=new Ta(t.a);return r.a.add(e),r.a.add(n),r}function gu(t,e){t.P=new ya(e,Math.min(.5,e/2)),t.P.a=Nh,ku(t),t.Sb=new Z(function(){switch(t.h){case qh:var e=!!t.a.ended||De(t.a.buffered)>=t.a.duration-.1;break;case Wh:t:{var n;if((n=t.a.ended)||(n=t.D,n=!n.h||"ended"==n.h.readyState),n)e=!0;else{if(t.c.presentationTimeline.V()&&(n=t.c.presentationTimeline.nb(),De(t.a.buffered)>=n)){e=!0;break t}e=!1}}break;default:e=!1}var r=Ue(t.a.buffered,t.a.currentTime);n=t.P;var i=e,a=n.b.get(n.a);e=n.a,r=i||r>=a?Uh:Nh,n.a=r,e!=r&&ku(t)}).La(.25)}function vu(t){return new Za(t.c,{Sa:function(){return t.o.h()},getBandwidthEstimate:function(){return t.l.getBandwidthEstimate()},I:t.D,rb:t.G,Md:t.df.bind(t),Ld:t.ue.bind(t),onError:t.Ka.bind(t),onEvent:function(e){return t.dispatchEvent(e)},hf:t.jf.bind(t),Yc:t.qf.bind(t)})}function yu(t){if(t.m&&t.m.configure(t.b.manifest),t.g&&t.g.configure(t.b.drm),t.f){t.f.configure(t.b.streaming);try{t.c.periods.forEach(t.Fc.bind(t))}catch(a){t.Ka(a)}var e=Qa(t.f),n=Ja(t.f),r=qu(t);e=Rn(e,n,r.variants),t.l&&e&&e.allowedByApplication&&e.allowedByKeySystem?Mu(t,r.variants):Ru(t,r)}if(t.D&&(r=t.b.textDisplayFactory,t.xc!=r)){e=new r,n=t.D;var i=n.g;n.g=e,i&&(e.setTextVisibility(i.isTextVisible()),i.destroy()),n.a&&(n.a.c=e),t.xc=r,t.f&&(r=t.f,(e=r.b.get("text"))&&io(r,e.stream,!0,0,!0))}t.l&&(t.l.configure(t.b.abr),t.b.abr.enabled&&!t.ib?t.l.enable():t.l.disable(),Nu(t))}function _u(t,e,n,r){ua(t.$,e).variant=n,t=t.v.c,t.c!=n&&(t.c=n,t.a.push({timestamp:Date.now()/1e3,id:n.id,type:"variant",fromAdaptation:r,bandwidth:n.bandwidth}))}function bu(t,e,n,r){sa(t.$,e,n),t=t.v.c,t.b!=n&&(t.b=n,t.a.push({timestamp:Date.now()/1e3,id:n.id,type:"text",fromAdaptation:r,bandwidth:null}))}function Eu(t){var e=Ks();return e.streaming.failureCallback=function(e){var n=[1001,1002,1003];t.V()&&n.includes(e.code)&&(e.severity=1,t.fd())},e.textDisplayFactory=function(){return new Bs(t.a)},e}function wu(t,e){for(var n=0;n<e.length;n++){for(var r=e[n],i=new Map,a=s(r.variants),o=a.next();!o.done;o=a.next())if(o=o.value,o.video&&o.video.closedCaptions){o=o.video;for(var u=s(o.closedCaptions.keys()),l=u.next();!l.done;l=u.next())if(l=l.value,!i.has(l)){var c={id:t.Id++,originalId:l,createSegmentIndex:Promise.resolve.bind(Promise),findSegmentPosition:function(){return null},getSegmentReference:function(){return null},initSegmentReference:null,presentationTimeOffset:0,mimeType:"application/cea-608",codecs:"",kind:"caption",encrypted:!1,keyId:null,language:o.closedCaptions.get(l),label:null,type:"text",primary:!1,trickModeVideo:null,emsgSchemeIdUris:null,roles:o.roles,channelsCount:null,closedCaptions:null};i.set(l,c)}}for(i=s(i.values()),a=i.next();!a.done;a=i.next())r.textStreams.push(a.value)}}function Au(t,e){var n=t.f?Qa(t.f):null,r=t.f?Ja(t.f):null;if(e.forEach(_n.bind(null,t.g,n,r)),0==(n=gt(e,function(t){return t.variants.some(Tn)})))throw new et(2,4,4032);if(n<e.length)throw new et(2,4,4011);e.forEach(function(t){yn(t.variants,this.b.restrictions,this.Wb)&&this.f&&qu(this)==t&&Iu(this),Gu(this,t.variants)}.bind(t))}function Su(t,e,n,r){n=void 0!==n&&n,r=void 0===r?0:r,t.ib?(t.Ea=e,t.Ed=n,t.Cd=r):(ro(t.f,e,n,r),Pu(t))}function Tu(t,e){t.ib?t.na=e:(io(t.f,e,!0,0,!1),Ou(t))}function xu(t,e){function n(t,e){if(!t)return null;var n=t.findSegmentPosition(e-a.startTime);return null==n?null:(n=t.getSegmentReference(n))?n.startTime+a.startTime:null}var r=Qa(t.f),i=Ja(t.f),a=qu(t);return r=n(r,e),i=n(i,e),null!=i&&null!=r?Math.max(i,r):null!=i?i:null!=r?r:e}function ku(t){var e=t.Nc();if(t.v&&t.P&&t.o){var n=t.W;n.f=e,Ia(n),Cu(t)}t.dispatchEvent(new ct("buffering",{buffering:e}))}function Cu(t){if(t.v&&t.P){var e=t.v.a;t.P.a==Nh?Xs(e,"buffering"):t.a.paused?Xs(e,"paused"):t.a.ended?Xs(e,"ended"):Xs(e,"playing")}}function Mu(t,e){try{Gu(t,e)}catch(r){return t.Ka(r),null}var n=e.filter(function(t){return Tn(t)});return n=t.Tb.create(n),t.l.setVariants(Array.from(n.values())),t.l.chooseVariant()}function Ru(t,e){var n=Mu(t,e.variants);n&&(_u(t,e,n,!0),Su(t,n,!0)),(n=Cn(e.textStreams,t.ma,t.cb)[0]||null)&&(t.b.streaming.alwaysStreamText||t.gc())&&(bu(t,e,n,!0),Tu(t,n)),Lu(t)}function Lu(t){zu(t,new ct("adaptation"))}function Iu(t){zu(t,new ct("trackschanged"))}function Pu(t){zu(t,new ct("variantchanged"))}function Ou(t){zu(t,new ct("textchanged"))}function Du(t){zu(t,new ct("texttrackvisibility"))}function Nu(t){zu(t,new ct("abrstatuschanged",{vg:t.b.abr.enabled}))}function Uu(t,e,n){t.dispatchEvent(new ct(e,{detail:{schemeIdUri:n.schemeIdUri,value:n.value,startTime:n.startTime,endTime:n.endTime,id:n.id,eventElement:n.eventElement}}))}function Fu(t){if(!t.a.error)return null;var e=t.a.error.code;if(1==e)return null;var n=t.a.error.msExtendedCode;return n&&(0>n&&(n+=Math.pow(2,32)),n=n.toString(16)),new et(2,3,3016,e,n,t.a.error.message)}function Bu(t,e){if(t.f){var n=qu(t),r=!1,i=Object.keys(e),a=1==i.length&&"00"==i[0];i.length&&n.variants.forEach(function(t){Ln(t).forEach(function(n){var i=t.allowedByKeySystem;n.keyId&&(n=e[a?"00":n.keyId],t.allowedByKeySystem=!!n&&!zh.includes(n)),i!=t.allowedByKeySystem&&(r=!0)})}),i=Qa(t.f);(i=Rn(i,Ja(t.f),n.variants))&&!i.allowedByKeySystem&&Ru(t,n),r&&(Iu(t),Mu(t,n.variants))}}function ju(t,e,n){t.m&&t.m.onExpirationUpdated&&t.m.onExpirationUpdated(e,n),t.dispatchEvent(new ct("expirationupdated"))}function Vu(t,e,n){0<e&&(t.V()||t.ee(e)),n<t.Y()&&(t.V()||t.wa(n))}function Gu(t,e){var n=t.g?Nt(t.g.T):{},r=Object.keys(n);r=r.length&&"00"==r[0];for(var i=!1,a=!1,o=[],u=[],l=s(e),c=l.next();!c.done;c=l.next()){c=c.value;var d=[];c.audio&&d.push(c.audio),c.video&&d.push(c.video),d=s(d);for(var h=d.next();!h.done;h=d.next())if(h=h.value,h.keyId){var f=n[r?"00":h.keyId];f?zh.includes(f)&&(u.includes(f)||u.push(f)):o.includes(h.keyId)||o.push(h.keyId)}c.allowedByApplication?c.allowedByKeySystem&&(i=!0):a=!0}if(!i)throw new et(2,4,4012,{hasAppRestrictions:a,missingKeys:o,restrictedKeyStatuses:u})}function zu(t,e){c(function n(){return k(n,function(n){switch(n.j){case 1:return p(n,Promise.resolve(),2);case 2:t.h!=Kh&&t.dispatchEvent(e),m(n)}})})}function Hu(t){var e=new Set;t=s(t);for(var n=t.next();!n.done;n=t.next())n=n.value,n.language?e.add(pn(n.language)):e.add("und");return e}function Ku(t){var e=new Map;t=s(t);for(var n=t.next();!n.done;n=t.next()){var r=n.value;n="und";var i=[];for(r.language&&(n=pn(r.language)),i="variant"==r.type?r.audioRoles:r.roles,i&&i.length||(i=[""]),e.has(n)||e.set(n,new Set),r=s(i),i=r.next();!i.done;i=r.next())i=i.value,e.get(n).add(i)}var a=[];return e.forEach(function(t,e){for(var n=s(t),r=n.next();!r.done;r=n.next())a.push({language:e,role:r.value})}),a}function Yu(t){return t=qu(t),null==t?[]:t.variants.filter(function(t){return Tn(t)})}function Wu(t){var e=qu(t);return null==e?[]:e.textStreams.filter(function(e){return!t.Vb.has(e)})}function qu(t){var e=t.o.h(),n=null;t=s(t.c.periods);for(var r=t.next();!r.done;r=t.next())r=r.value,r.startTime<=e&&(n=r);return n}function Xu(t){var e=qu(t);return ua(t.$,e).variant}function $u(t){var e=qu(t);if(null==e)return null;if(!ua(t.$,e).text){var n=Cn(e.textStreams,t.ma,t.cb);n.length&&sa(t.$,e,n[0])}return ua(t.$,e).text}function Zu(){return new et(2,7,7e3)}function Qu(t,e,n,r,i,a){return r==t&&i.u==a.u&&i.uri==a.uri&&i.mimeType==a.mimeType&&i.ya==a.ya?e:n}function Ju(){return{ya:null,u:null,mimeType:null,startTime:null,nd:null,uri:null}}function tl(t){return new Promise(function(e,n){t.Wa=function(){return n(Zu())},t.jc=function(){return e()},t.onError=function(t){return n(t)},t.lc=function(){return n(Zu())}})}function el(t,e,n){var r=void 0==e.expiration?1/0:e.expiration,i=e.presentationTimeline.Y();return e=rl(e.periods[0]),{offlineUri:null,originalManifestUri:t,duration:i,size:0,expiration:r,tracks:e,appMetadata:n}}function nl(t,e){var n=Ss(new ws(t.ua(),t.aa()),e.periods[0],new $r(null,0)),r=e.appMetadata||{};return n=rl(n),{offlineUri:t.toString(),originalManifestUri:e.originalManifestUri,duration:e.duration,size:e.size,expiration:e.expiration,tracks:n,appMetadata:r}}function rl(t){var e=[],n=xn(t.variants);n=s(n);for(var r=n.next();!r.done;r=n.next())e.push(En(r.value));for(t=s(t.textStreams),n=t.next();!n.done;n=t.next())e.push(wn(n.value));return e}function il(){this.a={}}function al(t,e,n){return n=n.endTime-n.startTime,ol(t,e)*n}function ol(t,e){var n=t.a[e];return null==n&&(n=0),n}function sl(t){this.a=!1,this.b=new nt,this.c=t}function ul(t,e){for(var n={width:1/0,height:1/0},r=s(t.periods),i=r.next();!i.done;i=r.next())i=i.value,i.variants=i.variants.filter(function(t){return vn(t,e,n)})}function ll(t){t=s(t.periods);for(var e=t.next();!e.done;e=t.next())e=e.value,e.variants=e.variants.filter(function(t){var e=!0;return t.audio&&(e=e&&Je(t.audio)),t.video&&(e=e&&Je(t.video)),e})}function cl(t,e){for(var n=s(t.periods),r=n.next();!r.done;r=n.next())r=r.value,r.variants=r.variants.filter(function(t){return Te(e,t)})}function dl(t){var e=new pl;t.periods.forEach(function(t,n){var r=vl(t.variants);if(0==n){r=s(r.a);for(var i=r.next();!i.done;i=r.next())e.add(i.value)}else ml(e,r)}),t=s(t.periods);for(var n=t.next();!n.done;n=t.next())n=n.value,n.variants=n.variants.filter(function(t){return gl(e,new fl(t))})}function hl(t,e){var n=new pl;t.periods.forEach(function(t,r){0<r&&(t.variants=t.variants.filter(function(t){return gl(n,new fl(t))})),e(t),n=vl(t.variants)})}function fl(t){var e=t.audio;t=t.video,this.b=e?e.mimeType:null,this.a=e?e.codecs.split(".")[0]:null,this.f=t?t.mimeType:null,this.c=t?t.codecs.split(".")[0]:null}function pl(){this.a=[]}function ml(t,e){t.a=t.a.filter(function(t){return gl(e,t)})}function gl(t,e){return t.a.some(function(t){return e.b==t.b&&e.a==t.a&&e.f==t.f&&e.c==t.c})}function vl(t){var e=new pl;t=s(t);for(var n=t.next();!n.done;n=t.next())e.add(new fl(n.value));return e}function yl(t){var e=this;if(t&&t.constructor!=tu)throw new et(2,9,9008);this.b=this.a=null,t?(this.a=t.b,this.b=t.Eb()):(this.a=Ks(),this.b=new bt),this.f=!1,this.c=[],this.g=[];var n=!t;this.h=new sl(function(){return c(function t(){var r;return k(t,function(t){switch(t.j){case 1:return r=function(){},p(t,Promise.all(e.g.map(function(t){return t.then(r,r)})),2);case 2:if(!n){t.A(3);break}return p(t,e.b.destroy(),3);case 3:e.a=null,e.b=null,m(t)}})})})}function _l(){if(jt())t:{for(var t=s(Vh.values()),e=t.next();!e.done;e=t.next())if(e=e.value,e=e()){e.destroy(),t=!0;break t}t=!1}else t=!1;return t}function bl(t,e,n,r){return c(function i(){var a,o,s,u,l,c,d,h,f,m;return k(i,function(i){switch(i.j){case 1:return Nl(),t.f?i["return"](Promise.reject(new et(2,9,9006))):(t.f=!0,p(i,Ml(t,e,r),2));case 2:if(a=i.s,Dl(t),!(o=!a.presentationTimeline.V()&&!a.presentationTimeline.Va()))throw new et(2,9,9005,e);return s=null,u=new $o,c=l=null,g(i,3,4),p(i,Rl(t,a,function(t){c=c||t}),6);case 6:if(s=i.s,Dl(t),c)throw c;return El(t,a,s),p(i,u.init(),7);case 7:return Dl(t),p(i,Zo(u),8);case 8:return l=i.s,Dl(t),p(i,wl(t,l.aa,s,a,e,n),9);case 9:if(d=i.s,Dl(t),c)throw c;return p(i,l.aa.addManifests([d]),10);case 10:return h=i.s,Dl(t),f=new bs("manifest",l.path.ua,l.path.aa,h[0]),i["return"](nl(f,d));case 4:return b(i),t.f=!1,t.c=[],p(i,u.destroy(),11);case 11:if(!s){i.A(12);break}return p(i,s.destroy(),12);case 12:E(i,0);break;case 3:if(m=_(i),!l){i.A(14);break}return p(i,l.aa.removeSegments(t.c,function(){}),14);case 14:throw c||m}})})}function El(t,e,n){ul(e,t.a.restrictions),ll(e),cl(e,n),dl(e),hl(e,function(e){for(var n=[],r=s(e.variants),i=r.next();!i.done;i=r.next())n.push(En(i.value));for(r=s(e.textStreams),i=r.next();!i.done;i=r.next())n.push(wn(i.value));n=t.a.offline.trackSelectionCallback(n);var a=new Set,o=new Set;for(n=s(n),r=n.next();!r.done;r=n.next())r=r.value,"variant"==r.type&&a.add(r.id),"text"==r.type&&o.add(r.id);e.variants=e.variants.filter(function(t){return a.has(t.id)}),e.textStreams=e.textStreams.filter(function(t){return o.has(t.id)})}),Vl(e)}function wl(t,e,n,r,i,a){return c(function o(){var s,u,l,c;return k(o,function(o){switch(o.j){case 1:return s=el(i,r,a),u=new Bo(t.b,function(e,n){s.size=n,t.a.offline.progressCallback(s,e)}),v(o,2),c=l=Ll(t,u,e,n,r,i,a),p(o,Vo(u),4);case 4:return c.size=o.s,o["return"](l);case 2:return b(o),p(o,u.destroy(),5);case 5:E(o,0)}})})}function Al(t,e){return c(function n(){var r,i,a,o,s,u;return k(n,function(n){switch(n.j){case 1:return Nl(),null==(r=Es(e))||"manifest"!=r.a?n["return"](Promise.reject(new et(2,9,9004,e))):(i=r,a=new $o,v(n,2),p(n,a.init(),4));case 4:return p(n,Jo(a,i.ua(),i.aa()),5);case 5:return o=n.s,p(n,o.getManifests([i.key()]),6);case 6:return s=n.s,u=s[0],p(n,Promise.all([Tl(t,u,a),xl(t,o,i,u)]),2);case 2:return b(n),p(n,a.destroy(),8);case 8:E(n,0)}})})}function Sl(t,e){for(var n=[],r=s(t.periods),i=r.next();!i.done;i=r.next()){i=s(i.value.streams);for(var a=i.next();!a.done;a=i.next())a=a.value,e&&"video"==a.contentType?n.push({contentType:Ut(a.mimeType,a.codecs),robustness:t.drmInfo.videoRobustness}):e||"audio"!=a.contentType||n.push({contentType:Ut(a.mimeType,a.codecs),robustness:t.drmInfo.audioRobustness})}return n}function Tl(t,e,n){return c(function r(){return k(r,function(r){switch(r.j){case 1:return p(r,Bl(t.b,t.a.drm,n,e),0)}})})}function xl(t,e,n,r){function i(){s+=1,t.a.offline.progressCallback(u,s/o)}var a=Fl(r),o=a.length+1,s=0,u=nl(n,r);return Promise.all([e.removeSegments(a,i),e.removeManifests([n.key()],i)])}function kl(t){return c(function e(){var n,r,i,a,o,u,l,d,h;return k(e,function(e){switch(e.j){case 1:return Nl(),n=t.b,r=t.a.drm,i=new $o,a=!1,v(e,2),p(e,i.init(),4);case 4:for(o=[],ts(i,function(t){return o.push(t)}),u=Promise.resolve(),l={},d=s(o),h=d.next();!h.done;l={qc:l.qc},h=d.next())l.qc=h.value,u=u.then(function(t){return function(){return c(function e(){var i,o;return k(e,function(e){switch(e.j){case 1:return p(e,t.qc.getAll(),2);case 2:return i=e.s,p(e,Ls(r,n,i),3);case 3:return o=e.s,p(e,t.qc.remove(o),4);case 4:o.length!=i.length&&(a=!0),m(e)}})})}}(l));return p(e,u,2);case 2:return b(e),p(e,i.destroy(),6);case 6:E(e,3);break;case 3:return e["return"](!a)}})})}function Cl(){return c(function t(){var e,n,r;return k(t,function(t){switch(t.j){case 1:return Nl(),e=[],n=new $o,v(t,2),p(t,n.init(),4);case 4:return r=Promise.resolve(),Qo(n,function(t,n){r=r.then(function(){return c(function r(){var i;return k(r,function(r){switch(r.j){case 1:return p(r,n.getAllManifests(),2);case 2:i=r.s,i.forEach(function(n,r){var i=nl(new bs("manifest",t.ua,t.aa,r),n);e.push(i)}),m(r)}})})})}),p(t,r,2);case 2:return b(t),p(t,n.destroy(),6);case 6:E(t,3);break;case 3:return t["return"](e)}})})}function Ml(t,e,n){return c(function r(){var i,a,o,s,u,l;return k(r,function(r){switch(r.j){case 1:return i=null,a=t.b,o={networkingEngine:a,filterAllPeriods:function(){},filterNewPeriod:function(){},onTimelineRegionAdded:function(){},onEvent:function(){},onError:function(t){i=t}},p(r,n(),2);case 2:return s=r.s,s.configure(t.a.manifest),Dl(t),v(r,3),p(r,s.start(e,o),5);case 5:return u=r.s,Dl(t),l=jl(u),p(r,Promise.all(Array.from(l).map(function(t){return t.createSegmentIndex()})),6);case 6:if(Dl(t),i)throw i;return r["return"](u);case 3:return b(r),p(r,s.stop(),7);case 7:E(r,0)}})})}function Rl(t,e,n){return c(function r(){var i,a,o;return k(r,function(r){switch(r.j){case 1:return i=new ne({rb:t.b,onError:n,kc:function(){},onExpirationUpdated:function(){},onEvent:function(){}}),a=ka(e.periods),o=t.a,i.configure(o.drm),p(r,ie(i,a,o.offline.usePersistentLicense),2);case 2:return p(r,ue(i),3);case 3:return p(r,ce(i),4);case 4:return r["return"](i)}})})}function Ll(t,e,n,r,i,a,o){var s=new il,u=i.periods.map(function(r){return Il(t,e,n,s,i,r)}),l=r.a,c=fe(r);if(l&&t.a.offline.usePersistentLicense){if(!c.length)throw new et(2,9,9007,a);l.initData=[]}return{originalManifestUri:a,duration:i.presentationTimeline.Y(),size:0,expiration:r.dc(),periods:u,sessionIds:t.a.offline.usePersistentLicense?c:[],drmInfo:l,appMetadata:o}}function Il(t,e,n,r,i,a){i.periods.forEach(function(t){t.variants.forEach(function(t){var e=t.audio,n=t.video;if(e&&!n&&(r.a[e.id]=e.bandwidth||t.bandwidth),!e&&n&&(r.a[n.id]=n.bandwidth||t.bandwidth),e&&n){var i=e.bandwidth||393216,a=n.bandwidth||t.bandwidth-i;0>=a&&(a=t.bandwidth),r.a[e.id]=i,r.a[n.id]=a}}),t.textStreams.forEach(function(t){r.a[t.id]=52})});var o=jl(i),u=new Map;o=s(o);for(var l=o.next();!l.done;l=o.next()){l=l.value;var c=Pl(t,e,n,r,i,l);u.set(l.id,c)}return a.variants.forEach(function(t){t.audio&&u.get(t.audio.id).variantIds.push(t.id),t.video&&u.get(t.video.id).variantIds.push(t.id)}),{startTime:a.startTime,streams:Array.from(u.values())}}function Pl(t,e,n,r,i,a){var o={id:a.id,originalId:a.originalId,primary:a.primary,presentationTimeOffset:a.presentationTimeOffset||0,contentType:a.type,mimeType:a.mimeType,codecs:a.codecs,frameRate:a.frameRate,kind:a.kind,language:a.language,label:a.label,width:a.width||null,height:a.height||null,initSegmentKey:null,encrypted:a.encrypted,keyId:a.keyId,segments:[],variantIds:[]};i=i.presentationTimeline.Gb();var s=a.id;return Ol(a,i,function(i){var u=Zr(i.c(),i.b,i.a,t.a.streaming.retryParameters);jo(e,s,u,al(r,a.id,i),function(e){return n.addSegments([{data:e}]).then(function(e){t.c.push(e[0]),o.segments.push({startTime:i.startTime,endTime:i.endTime,dataKey:e[0]})})})}),(i=a.initSegmentReference)&&(i=Zr(i.c(),i.b,i.a,t.a.streaming.retryParameters),jo(e,s,i,.5*ol(r,a.id),function(e){return n.addSegments([{data:e}]).then(function(e){t.c.push(e[0]),o.initSegmentKey=e[0]})})),o}function Ol(t,e,n){e=t.findSegmentPosition(e);for(var r=null==e?null:t.getSegmentReference(e);r;)n(r),r=t.getSegmentReference(++e)}function Dl(t){if(t.h.a)throw new et(2,9,7001)}function Nl(){if(!_l())throw new et(2,9,9e3)}function Ul(t,e){return c(function n(){return k(n,function(n){switch(n.j){case 1:return t.g.push(e),v(n,2),p(n,e,4);case 4:return n["return"](n.s);case 2:b(n),mt(t.g,e),E(n,0)}})})}function Fl(t){var e=[];return t.periods.forEach(function(t){t.streams.forEach(function(t){null!=t.initSegmentKey&&e.push(t.initSegmentKey),t.segments.forEach(function(t){e.push(t.dataKey)})})}),e}function Bl(t,e,n,r){return c(function i(){var a,o,s;return k(i,function(i){switch(i.j){case 1:return r.drmInfo?(a=es(n),o=r.sessionIds.map(function(t){return{sessionId:t,keySystem:r.drmInfo.keySystem,licenseUri:r.drmInfo.licenseServerUri,serverCertificate:r.drmInfo.serverCertificate,audioCapabilities:Sl(r,!1),videoCapabilities:Sl(r,!0)}}),p(i,Ls(e,t,o),2)):i["return"]();case 2:return s=i.s,p(i,a.remove(s),3);case 3:return p(i,a.add(o.filter(function(t){return-1==s.indexOf(t.sessionId)})),0)}})})}function jl(t){var e=new Set;t=s(t.periods);for(var n=t.next();!n.done;n=t.next()){n=n.value;for(var r=s(n.textStreams),i=r.next();!i.done;i=r.next())e.add(i.value);for(n=s(n.variants),r=n.next();!r.done;r=n.next())r=r.value,r.audio&&e.add(r.audio),r.video&&e.add(r.video)}return e}function Vl(t){if(0==t.periods.length)throw new et(2,4,4014);t=s(t.periods);for(var e=t.next();!e.done;e=t.next())Gl(e.value)}function Gl(t){t.variants.map(function(t){return t.video});var e=new Set(t.variants.map(function(t){return t.audio}));t=t.textStreams;for(var n=s(e),r=n.next();!r.done;r=n.next()){r=s(e);for(var i=r.next();!i.done;i=r.next());}for(e=s(t),n=e.next();!n.done;n=e.next())for(n=s(t),r=n.next();!r.done;r=n.next());}function zl(t,e){e=e||0;for(var n={priority:e,se:t},r=0;r<Xh.length;r++)if(Xh[r].priority<e)return void Xh.splice(r,0,n);Xh.push(n)}function Hl(t){var e=t.type.replace(/^(webkit|moz|MS)/,"").toLowerCase();if("function"==typeof Event)var n=new Event(e,t);else n=document.createEvent("Event"),n.initEvent(e,t.bubbles,t.cancelable);t.target.dispatchEvent(n)}function Kl(t,e,n){if("input"==t)switch(this.type){case"range":t="change"}HTMLInputElement.prototype.originalAddEventListener.call(this,t,e,n)}function Yl(){var t=MediaSource.prototype.addSourceBuffer;MediaSource.prototype.addSourceBuffer=function(e){for(var n=[],r=0;r<arguments.length;++r)n[r]=arguments[r];return n=t.apply(this,n),n.abort=function(){},n}}function Wl(){var t=SourceBuffer.prototype.remove;SourceBuffer.prototype.remove=function(e,n){return t.call(this,e,n-.001)}}function ql(){var t=MediaSource.prototype.endOfStream;MediaSource.prototype.endOfStream=function(e){for(var n=[],r=0;r<arguments.length;++r)n[r]=arguments[r];for(var i=r=0;i<this.sourceBuffers.length;++i){var a=this.sourceBuffers[i];a=a.buffered.end(a.buffered.length-1),r=Math.max(r,a)}if(!isNaN(this.duration)&&r<this.duration)for(this.Fd=!0,r=0;r<this.sourceBuffers.length;++r)this.sourceBuffers[r].wd=!1;return t.apply(this,n)};var e=!1,n=MediaSource.prototype.addSourceBuffer;MediaSource.prototype.addSourceBuffer=function(t){for(var r=[],i=0;i<arguments.length;++i)r[i]=arguments[i];return r=n.apply(this,r),r.mediaSource_=this,r.addEventListener("updateend",Xl,!1),e||(this.addEventListener("sourceclose",$l,!1),e=!0),r}}function Xl(t){var e=t.target,n=e.mediaSource_;if(n.Fd){for(t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation(),e.wd=!0,t=0;t<n.sourceBuffers.length;++t)if(0==n.sourceBuffers[t].wd)return;n.Fd=!1}}function $l(t){t=t.target;for(var e=0;e<t.sourceBuffers.length;++e)t.sourceBuffers[e].removeEventListener("updateend",Xl,!1);t.removeEventListener("sourceclose",$l,!1)}function Zl(){var t=MediaSource.isTypeSupported;MediaSource.isTypeSupported=function(e){return"mp2t"!=e.split(/ *; */)[0].split("/")[1]&&t(e)}}function Ql(){var t=MediaSource.isTypeSupported;MediaSource.isTypeSupported=function(e){return"opus"!=Bt(e)[0]&&t(e)}}function Jl(){var t=MediaSource.isTypeSupported,e=/^dv(?:h[e1]|a[v1])\./;MediaSource.isTypeSupported=function(n){for(var r=n.split(/ *; */),i=r[0],a={},o=1;o<r.length;++o){var s=r[o].split("="),u=s[0];s=s[1].replace(/"(.*)"/,"$1"),a[u]=s}if(!(r=a.codecs))return t(n);var l=!1,c=!1;n=r.split(",").filter(function(t){return e.test(t)&&(c=!0),/^(hev|hvc)1\.2/.test(t)&&(l=!0),!0}),c&&(l=!1),a.codecs=n.join(","),l&&(a.eotf="smpte2084");for(var d in a)i+="; "+d+'="'+a[d]+'"';return cast.__platform__.canDisplayType(i)}}function tc(t,e){try{var n=new ec(t,e);return Promise.resolve(n)}catch(r){return Promise.reject(r)}}function ec(t,e){if(this.keySystem=t,t.startsWith("com.apple.fps"))for(var n=s(e),r=n.next();!r.done;r=n.next()){var i=r.value;if("required"==i.persistentState)r=null;else{r={audioCapabilities:[],videoCapabilities:[],persistentState:"optional",distinctiveIdentifier:"optional",initDataTypes:i.initDataTypes,sessionTypes:["temporary"],label:i.label};var a=!1,o=!1;if(i.audioCapabilities)for(var u=s(i.audioCapabilities),l=u.next();!l.done;l=u.next())if(l=l.value,l.contentType){a=!0;var c=l.contentType.split(";")[0];WebKitMediaKeys.isTypeSupported(this.keySystem,c)&&(r.audioCapabilities.push(l),o=!0)}if(i.videoCapabilities)for(i=s(i.videoCapabilities),l=i.next();!l.done;l=i.next())u=l.value,u.contentType&&(a=!0,l=u.contentType.split(";")[0],WebKitMediaKeys.isTypeSupported(this.keySystem,l)&&(r.videoCapabilities.push(u),o=!0));a||(o=WebKitMediaKeys.isTypeSupported(this.keySystem,"video/mp4")),r=o?r:null}if(r)return void(this.a=r)}throw n=Error("Unsupported keySystem"),n.name="NotSupportedError",n.code=DOMException.NOT_SUPPORTED_ERR,n}function nc(t){var e=this.mediaKeys;return e&&e!=t&&ic(e,null),delete this.mediaKeys,(this.mediaKeys=t)?ic(t,this):Promise.resolve()}function rc(t){this.b=new WebKitMediaKeys(t),this.a=new Mt,this.c=null}function ic(t,e){if(t.a.Ya(),!e)return Promise.resolve();t.a.w(e,"webkitneedkey",sc);try{return 1<=e.readyState?e.webkitSetMediaKeys(t.b):t.a.ha(e,"loadedmetadata",function(){e.webkitSetMediaKeys(t.b)}),Promise.resolve()}catch(n){return Promise.reject(n)}}function ac(t){ht.call(this),this.c=null,this.g=t,this.b=this.a=null,this.f=new Mt,this.sessionId="",this.expiration=NaN,this.closed=new nt,this.keyStatuses=new lc}function oc(t,e){function n(t){new DataView(a.buffer).setUint32(o,t.byteLength,!0),o+=4,a.set(t,o),o+=t.byteLength}var r=new Uint8Array(t);if(new DataView(r.buffer).getUint32(0,!0)+4!=r.byteLength)throw Error("Malformed init data!");var i=Kt(r.slice(4),!0);i=new G(i).ra,i=new Uint8Array(qt(i,!0));var a=new Uint8Array(r.byteLength+4+i.byteLength+4+e.byteLength),o=0;return a.set(r,o),o+=r.byteLength,n(i),n(new Uint8Array(e)),a}function sc(t){var e=this.mediaKeys.c,n=new Event("encrypted");n.initDataType="cenc",n.initData=oc(t.initData,e),this.dispatchEvent(n)}function uc(t,e){var n=t.keyStatuses;n.size=void 0==e?0:1,n.a=e,t.dispatchEvent(new ct("keystatuseschange"))}function lc(){this.size=0,this.a=void 0}function cc(t){this.f=[],this.b=[],this.a=[],(new _r).ea("pssh",this.c.bind(this)).parse(t.buffer)}function dc(t,e){try{var n=new hc(t,e);return Promise.resolve(n)}catch(r){return Promise.reject(r)}}function hc(t,e){this.keySystem=t;for(var n=!1,r=0;r<e.length;++r){var i=e[r],a={audioCapabilities:[],videoCapabilities:[],persistentState:"optional",distinctiveIdentifier:"optional",initDataTypes:i.initDataTypes,sessionTypes:["temporary"],label:i.label},o=!1;if(i.audioCapabilities)for(var s=0;s<i.audioCapabilities.length;++s){var u=i.audioCapabilities[s];if(u.contentType){o=!0;var l=u.contentType.split(";")[0];MSMediaKeys.isTypeSupported(this.keySystem,l)&&(a.audioCapabilities.push(u),n=!0)}}if(i.videoCapabilities)for(s=0;s<i.videoCapabilities.length;++s)u=i.videoCapabilities[s],u.contentType&&(o=!0,l=u.contentType.split(";")[0],MSMediaKeys.isTypeSupported(this.keySystem,l)&&(a.videoCapabilities.push(u),n=!0));if(o||(n=MSMediaKeys.isTypeSupported(this.keySystem,"video/mp4")),"required"==i.persistentState&&(n=!1),n)return void(this.a=a)}throw n=Error("Unsupported keySystem"),n.name="NotSupportedError",n.code=DOMException.NOT_SUPPORTED_ERR,n}function fc(t){var e=this.mediaKeys;return e&&e!=t&&mc(e,null),delete this.mediaKeys,(this.mediaKeys=t)?mc(t,this):Promise.resolve()}function pc(t){this.a=new MSMediaKeys(t),this.b=new Mt}function mc(t,e){function n(){e.msSetMediaKeys(r.a),e.removeEventListener("loadedmetadata",n)}if(t.b.Ya(),!e)return Promise.resolve();t.b.w(e,"msneedkey",vc);var r=t;try{return 1<=e.readyState?e.msSetMediaKeys(t.a):e.addEventListener("loadedmetadata",n),Promise.resolve()}catch(i){return Promise.reject(i)}}function gc(t){ht.call(this),this.c=null,this.g=t,this.b=this.a=null,this.f=new Mt,this.sessionId="",this.expiration=NaN,this.closed=new nt,this.keyStatuses=new bc}function vc(t){if(t.initData){var e=document.createEvent("CustomEvent");e.initCustomEvent("encrypted",!1,!1,null),e.initDataType="cenc",e.initData=yc(t.initData),this.dispatchEvent(e)}}function yc(t){if(!t)return t;var e=new cc(t);if(1>=e.a.length)return t;for(var n=[],r=0;r<e.a.length;r++)n.push(t.subarray(e.a[r].start,e.a[r].end+1));for(t=[],e={},r=s(n),n=r.next();!n.done;e={fc:e.fc},n=r.next())e.fc=n.value,t.some(function(t){return function(e){return te(e,t.fc)}}(e))||t.push(e.fc);for(e=0,r=s(t),n=r.next();!n.done;n=r.next())e+=n.value.length;for(e=new Uint8Array(e),r=0,t=s(t),n=t.next();!n.done;n=t.next())n=n.value,e.set(n,r),r+=n.length;return e}function _c(t,e){var n=t.keyStatuses;n.size=void 0==e?0:1,n.a=e,t.dispatchEvent(new ct("keystatuseschange"))}function bc(){this.size=0,this.a=void 0}function Ec(){return Promise.reject(Error("The key system specified is not supported."))}function wc(t){return null==t?Promise.resolve():Promise.reject(Error("MediaKeys not supported."))}function Ac(){throw new TypeError("Illegal constructor.")}function Sc(){throw new TypeError("Illegal constructor.")}function Tc(t){var e=Qh;return e?e+t.charAt(0).toUpperCase()+t.slice(1):t}function xc(t,e){try{var n=new Cc(t,e);return Promise.resolve(n)}catch(r){return Promise.reject(r)}}function kc(t){var e=this.mediaKeys;return e&&e!=t&&Rc(e,null),delete this.mediaKeys,(this.mediaKeys=t)&&Rc(t,this),Promise.resolve()}function Cc(t,e){this.a=this.keySystem=t;var n=!1;"org.w3.clearkey"==t&&(this.a="webkit-org.w3.clearkey",n=!1);var r=!1,i=document.getElementsByTagName("video");i=i.length?i[0]:document.createElement("video");for(var a=0;a<e.length;++a){var o=e[a],s={audioCapabilities:[],videoCapabilities:[],persistentState:"optional",distinctiveIdentifier:"optional",initDataTypes:o.initDataTypes,sessionTypes:["temporary"],label:o.label},u=!1;if(o.audioCapabilities)for(var l=0;l<o.audioCapabilities.length;++l){var c=o.audioCapabilities[l];if(c.contentType){u=!0;var d=c.contentType.split(";")[0];i.canPlayType(d,this.a)&&(s.audioCapabilities.push(c),r=!0)}}if(o.videoCapabilities)for(l=0;l<o.videoCapabilities.length;++l)c=o.videoCapabilities[l],c.contentType&&(u=!0,i.canPlayType(c.contentType,this.a)&&(s.videoCapabilities.push(c),r=!0));if(u||(r=i.canPlayType("video/mp4",this.a)||i.canPlayType("video/webm",this.a)),"required"==o.persistentState&&(n?(s.persistentState="required",s.sessionTypes=["persistent-license"]):r=!1),r)return void(this.b=s)}throw n="Unsupported keySystem","org.w3.clearkey"!=t&&"com.widevine.alpha"!=t||(n="None of the requested configurations were supported."),n=Error(n),n.name="NotSupportedError",n.code=DOMException.NOT_SUPPORTED_ERR,n}function Mc(t){this.g=t,this.b=null,this.a=new Mt,this.c=[],this.f={}}function Rc(t,e){t.b=e,t.a.Ya();var n=Qh;e&&(t.a.w(e,n+"needkey",t.tf.bind(t)),t.a.w(e,n+"keymessage",t.cg.bind(t)),t.a.w(e,n+"keyadded",t.ag.bind(t)),t.a.w(e,n+"keyerror",t.bg.bind(t)))}function Lc(t,e){var n=t.f[e];return n||((n=t.c.shift())?(n.sessionId=e,t.f[e]=n):null)}function Ic(t,e,n){ht.call(this),this.f=t,this.h=!1,this.a=this.b=null,this.c=e,this.g=n,this.sessionId="",this.expiration=NaN,this.closed=new nt,this.keyStatuses=new Dc}function Pc(t,e,n){if(t.h)return Promise.reject(Error("The session is already initialized."));t.h=!0;try{if("persistent-license"==t.g)if(n)var r=new Uint8Array(Wt("LOAD_SESSION|"+n));else{var a=Wt("PERSISTENT|"),o=new Uint8Array(a.byteLength+e.byteLength);o.set(new Uint8Array(a),0),o.set(new Uint8Array(e),a.byteLength),r=o}else r=new Uint8Array(e)}catch(i){return Promise.reject(i)}t.b=new nt;var s=Tc("generateKeyRequest");try{t.f[s](t.c,r)}catch(i){if("InvalidStateError"!=i.name)return t.b=null,Promise.reject(i);new Z(function(){try{t.f[s](t.c,r)}catch(e){t.b.reject(e),t.b=null}}).O(.01)}return t.b}function Oc(t,e){var n=t.keyStatuses;n.size=void 0==e?0:1,n.a=e,t.dispatchEvent(new ct("keystatuseschange"))}function Dc(){this.size=0,this.a=void 0}function Nc(t){if(t=t.target,"picture-in-picture"==t.webkitPresentationMode){document.pictureInPictureElement=t;var e=new Event("enterpictureinpicture");t.dispatchEvent(e)}else document.pictureInPictureElement==t&&(document.pictureInPictureElement=null),e=new Event("leavepictureinpicture"),t.dispatchEvent(e)}function Uc(){return this.webkitSupportsPresentationMode("picture-in-picture")?(this.webkitSetPresentationMode("picture-in-picture"),document.pictureInPictureElement=this,Promise.resolve()):Promise.reject(Error("PiP not allowed by video element"))}function Fc(){var t=document.pictureInPictureElement;return t?(t.webkitSetPresentationMode("inline"),document.pictureInPictureElement=null,Promise.resolve()):Promise.reject(Error("No picture in picture element found"))}function Bc(){return{droppedVideoFrames:this.webkitDroppedFrameCount,totalVideoFrames:this.webkitDecodedFrameCount,corruptedVideoFrames:0,creationTime:NaN,totalFrameDelay:0}}function jc(e,n,r){return new t.TextTrackCue(e,n,r)}function Vc(e,n,r){return new t.TextTrackCue(e+"-"+n+"-"+r,e,n,r)}function Gc(){}function zc(t){var e=[];if(!t)return e;for(var n=t.childNodes,r=0;r<n.length;r++){var i="span"==n[r].nodeName&&"p"==t.nodeName;n[r].nodeType!=Node.ELEMENT_NODE||"br"==n[r].nodeName||i||(i=zc(n[r]),e=e.concat(i))}return e.length||e.push(t),e}function Hc(t,e){for(var n=t.childNodes,r=0;r<n.length;r++)if("br"==n[r].nodeName&&0<r)n[r-1].textContent+="\n";else if(0<n[r].childNodes.length)Hc(n[r],e);else if(e){var i=n[r].textContent.trim();i=i.replace(/\s+/g," "),n[r].textContent=i}}function Kc(t,e,n,r,i,a,o,s){if(!t.hasAttribute("begin")&&!t.hasAttribute("end")&&/^\s*$/.test(t.textContent))return null;Hc(t,s),s=Qc(t.getAttribute("begin"),n);var u=Qc(t.getAttribute("end"),n);n=Qc(t.getAttribute("dur"),n);var l=t.textContent;if(null==u&&null!=n&&(u=s+n),null==s||null==u)throw new et(2,2,2001);if(e=new Ke(s+e,u+e,l),(a=Zc(t,"region",a,""))&&a.getAttribute("xml:id")){var c=a.getAttribute("xml:id");o=o.filter(function(t){return t.id==c}),e.region=o[0]}return r=Zc(t,"smpte:backgroundImage",r,"#"),Yc(e,t,a,r,i),e}function Yc(t,e,n,r,i){"rtl"==qc(e,n,i,"direction")&&(t.direction="rtl");var a=qc(e,n,i,"writingMode");if("tb"==a||"tblr"==a?t.writingMode="vertical-lr":"tbrl"==a?t.writingMode="vertical-rl":"rltb"==a||"rl"==a?t.direction="rtl":a&&(t.direction=Wd),(a=qc(e,n,i,"textAlign"))&&(t.positionAlign=df[a],t.lineAlign=cf[a],t.textAlign=Hd[a.toUpperCase()]),(a=qc(e,n,i,"displayAlign"))&&(t.displayAlign=Yd[a.toUpperCase()]),(a=qc(e,n,i,"color"))&&(t.color=a),(a=qc(e,n,i,"backgroundColor"))&&(t.backgroundColor=a),(a=qc(e,n,i,"fontFamily"))&&(t.fontFamily=a),(a=qc(e,n,i,"fontWeight"))&&"bold"==a&&(t.fontWeight=700),(a=qc(e,n,i,"wrapOption"))&&"noWrap"==a&&(t.wrapLine=!1),(a=qc(e,n,i,"lineHeight"))&&a.match(ef)&&(t.lineHeight=a),(a=qc(e,n,i,"fontSize"))&&a.match(ef)&&(t.fontSize=a),(a=qc(e,n,i,"fontStyle"))&&(t.fontStyle=th[a.toUpperCase()]),r){a=r.getAttribute("imagetype");var o=r.getAttribute("encoding");r=r.textContent,"PNG"==a&&"Base64"==o&&r&&(t.backgroundImage="data:image/png;base64,"+r)}(n=Xc(n,i,"textDecoration"))&&Wc(t,n),(e=$c(e,i,"textDecoration"))&&Wc(t,e)}function Wc(t,e){for(var n=e.split(" "),r=0;r<n.length;r++)switch(n[r]){case"underline":t.textDecoration.includes("underline")||t.textDecoration.push("underline");break;case"noUnderline":t.textDecoration.includes("underline")&&mt(t.textDecoration,"underline");break;case"lineThrough":t.textDecoration.includes("lineThrough")||t.textDecoration.push("lineThrough");break;case"noLineThrough":t.textDecoration.includes("lineThrough")&&mt(t.textDecoration,"lineThrough");break;case"overline":t.textDecoration.includes("overline")||t.textDecoration.push("overline");break;case"noOverline":t.textDecoration.includes("overline")&&mt(t.textDecoration,"overline")}}function qc(t,e,n,r){return(t=$c(t,n,r))?t:Xc(e,n,r)}function Xc(t,e,n){for(var r=zc(t),i=0;i<r.length;i++){var a=wh.getAttributeNS(r[i],"http://www.w3.org/ns/ttml#styling",n);if(a)return a}return(t=Zc(t,"style",e,""))?wh.getAttributeNS(t,"http://www.w3.org/ns/ttml#styling",n):null}function $c(t,e,n){return(t=Zc(t,"style",e,""))?wh.getAttributeNS(t,"http://www.w3.org/ns/ttml#styling",n):null}function Zc(t,e,n,r){if(!t||1>n.length)return null;var i=null,a=t;for(t=null;a&&!(t=a.getAttribute(e))&&(a=a.parentNode)instanceof Element;);if(e=t)for(t=0;t<n.length;t++)if(r+n[t].getAttribute("xml:id")==e){i=n[t];break}return i}function Qc(t,e){var n=null;if(rf.test(t)){n=rf.exec(t);var r=Number(n[1]),i=Number(n[2]),a=Number(n[3]),o=Number(n[4]);o+=(Number(n[5])||0)/e.b,a+=o/e.frameRate,n=a+60*i+3600*r}else af.test(t)?n=Jc(af,t):of.test(t)?n=Jc(of,t):sf.test(t)?(n=sf.exec(t),n=Number(n[1])/e.frameRate):uf.test(t)?(n=uf.exec(t),n=Number(n[1])/e.a):lf.test(t)&&(n=Jc(lf,t));return n}function Jc(t,e){var n=t.exec(e);return null==n||""==n[0]?null:(Number(n[4])||0)/1e3+(Number(n[3])||0)+60*(Number(n[2])||0)+3600*(Number(n[1])||0)}function td(t,e,n,r){this.frameRate=Number(t)||30,this.b=Number(e)||1,this.a=Number(r),0==this.a&&(this.a=t?this.frameRate*this.b:1),n&&(t=/^(\d+) (\d+)$/g.exec(n))&&(this.frameRate*=Number(t[1])/Number(t[2]))}function ed(){this.a=new Gc}function nd(){}function rd(t,e,n){var r;(r=/^align:(start|middle|center|end|left|right)$/.exec(e))?(e=r[1],t.textAlign="middle"==e?zd:Hd[e.toUpperCase()]):(r=/^vertical:(lr|rl)$/.exec(e))?t.writingMode="lr"==r[1]?"vertical-lr":"vertical-rl":(r=/^size:([\d.]+)%$/.exec(e))?t.size=Number(r[1]):(r=/^position:([\d.]+)%(?:,(line-left|line-right|center|start|end))?$/.exec(e))?(t.position=Number(r[1]),r[2]&&(e=r[2],t.positionAlign="line-left"==e||"start"==e?"line-left":"line-right"==e||"end"==e?"line-right":"center")):(r=/^region:(.*)$/.exec(e))?(e=id(n,r[1]))&&(t.region=e):(n=/^line:([\d.]+)%(?:,(start|end|center))?$/.exec(e))?(t.lineInterpretation=1,t.line=Number(n[1]),n[2]&&(t.lineAlign=Zd[n[2].toUpperCase()])):(n=/^line:(-?\d+)(?:,(start|end|center))?$/.exec(e))&&(t.lineInterpretation=Xd,t.line=Number(n[1]),n[2]&&(t.lineAlign=Zd[n[2].toUpperCase()]))}function id(t,e){var n=t.filter(function(t){return t.id==e});return n.length?n[0]:null}function ad(t){if(null==(t=bi(t,/(?:(\d{1,}):)?(\d{2}):(\d{2})\.(\d{3})/g)))return null;var e=Number(t[2]),n=Number(t[3]);return 59<e||59<n?null:Number(t[4])/1e3+n+60*e+3600*(Number(t[1])||0)}function od(){this.a=null}function sd(t,e,n){var r,i,a;return(new _r).H("payl",wr(function(t){r=Ht(t)})).H("iden",wr(function(t){i=Ht(t)})).H("sttg",wr(function(t){a=Ht(t)})).parse(t),r?ud(r,i,a,e,n):null}function ud(t,e,n,r,i){if(t=new Ke(r,i,t),e&&(t.id=e),n)for(e=new yi(n),n=Ei(e);n;)rd(t,n,[]),_i(e),n=Ei(e);return t}var ld,cd="function"==typeof Object.defineProperties?Object.defineProperty:function(t,e,n){t!=Array.prototype&&t!=Object.prototype&&(t[e]=n.value)},dd=void 0!==t&&t===this?this:void 0!==e&&null!=e?e:this,hd=function(){var t=0;return function(e){return"jscomp_symbol_"+(e||"")+t++}}();u("Promise",function(t){function e(t){this.b=0,this.g=void 0,this.a=[];var e=this.c();try{t(e.resolve,e.reject)}catch(n){e.reject(n)}}function n(){this.a=null}function r(t){return t instanceof e?t:new e(function(e){e(t)})}if(t)return t;n.prototype.b=function(t){null==this.a&&(this.a=[],this.f()),this.a.push(t)},n.prototype.f=function(){var t=this;this.c(function(){t.h()})};var i=dd.setTimeout;n.prototype.c=function(t){i(t,0)},n.prototype.h=function(){for(;this.a&&this.a.length;){var t=this.a;this.a=[];for(var e=0;e<t.length;++e){var n=t[e];t[e]=null;try{n()}catch(r){this.g(r)}}}this.a=null},n.prototype.g=function(t){this.c(function(){throw t})},e.prototype.c=function(){function t(t){return function(r){n||(n=!0,t.call(e,r))}}var e=this,n=!1;return{resolve:t(this.o),reject:t(this.f)}},e.prototype.o=function(t){if(t===this)this.f(new TypeError("A Promise cannot resolve to itself"));else if(t instanceof e)this.v(t);else{t:switch(typeof t){case"object":var n=null!=t;break t;case"function":n=!0;break t;default:n=!1}n?this.m(t):this.h(t)}},e.prototype.m=function(t){var e=void 0;try{e=t.then}catch(n){return void this.f(n)}"function"==typeof e?this.C(e,t):this.h(t)},e.prototype.f=function(t){this.i(2,t)},e.prototype.h=function(t){this.i(1,t)},e.prototype.i=function(t,e){if(0!=this.b)throw Error("Cannot settle("+t+", "+e+"): Promise already settled in state"+this.b);this.b=t,this.g=e,this.l()},e.prototype.l=function(){if(null!=this.a){for(var t=0;t<this.a.length;++t)a.b(this.a[t]);this.a=null}};var a=new n;return e.prototype.v=function(t){var e=this.c();t.Xb(e.resolve,e.reject)},e.prototype.C=function(t,e){var n=this.c();try{t.call(e,n.resolve,n.reject)}catch(r){n.reject(r)}},e.prototype.then=function(t,n){function r(t,e){return"function"==typeof t?function(e){try{i(t(e))}catch(n){a(n)}}:e}var i,a,o=new e(function(t,e){i=t,a=e});return this.Xb(r(t,i),r(n,a)),o},e.prototype["catch"]=function(t){return this.then(void 0,t)},e.prototype.Xb=function(t,e){function n(){switch(r.b){case 1:t(r.g);break;case 2:e(r.g);break;default:throw Error("Unexpected state: "+r.b)}}var r=this;null==this.a?a.b(n):this.a.push(n)},e.resolve=r,e.reject=function(t){return new e(function(e,n){n(t)})},e.race=function(t){return new e(function(e,n){for(var i=s(t),a=i.next();!a.done;a=i.next())r(a.value).Xb(e,n)})},e.all=function(t){var n=s(t),i=n.next();return i.done?r([]):new e(function(t,e){var a=[],o=0;do{a.push(void 0),o++,r(i.value).Xb(function(e){return function(n){a[e]=n,0==--o&&t(a)}}(a.length-1),e),i=n.next()}while(!i.done)})},e}),u("Promise.prototype.finally",function(t){return t||function(t){return this.then(function(e){return Promise.resolve(t()).then(function(){return e})},function(e){return Promise.resolve(t()).then(function(){throw e})})}});var fd,pd="function"==typeof Object.create?Object.create:function(t){function e(){}return e.prototype=t,new e};if("function"==typeof Object.setPrototypeOf)fd=Object.setPrototypeOf;else{var md;t:{var gd={oe:!0},vd={};try{vd.__proto__=gd,md=vd.oe;break t}catch(hf){}md=!1}fd=md?function(t,e){if(t.__proto__=e,t.__proto__!==e)throw new TypeError(t+" is not extensible");return t}:null}var yd=fd;d.prototype.h=function(t){this.s=t},d.prototype["return"]=function(t){this.a={return:t},this.j=this.b},d.prototype.A=function(t){this.j=t},u("WeakMap",function(t){function e(t){if(this.a=(u+=Math.random()+1).toString(),t){n(),r(),t=s(t);for(var e;!(e=t.next()).done;)e=e.value,this.set(e[0],e[1])}}function i(t){M(t,o)||cd(t,o,{value:{}})}function a(t){var e=Object[t];e&&(Object[t]=function(t){return i(t),e(t)})}if(function(){if(!t||!Object.seal)return!1;try{var e=Object.seal({}),n=Object.seal({}),r=new t([[e,2],[n,3]]);return 2==r.get(e)&&3==r.get(n)&&(r["delete"](e),r.set(n,4),!r.has(e)&&4==r.get(n))}catch(i){return!1}}())return t;var o="$jscomp_hidden_"+Math.random();a("freeze"),a("preventExtensions"),a("seal");var u=0;return e.prototype.set=function(t,e){if(i(t),!M(t,o))throw Error("WeakMap key fail: "+t);return t[o][this.a]=e,this},e.prototype.get=function(t){return M(t,o)?t[o][this.a]:void 0},e.prototype.has=function(t){return M(t,o)&&M(t[o],this.a)},e.prototype["delete"]=function(t){return!(!M(t,o)||!M(t[o],this.a))&&delete t[o][this.a]},e}),u("Map",function(t){function e(){var t={};return t.Ca=t.next=t.head=t}function i(t,e){var n=t.a;return o(function(){if(n){for(;n.head!=t.a;)n=n.Ca;for(;n.next!=n.head;)return n=n.next,{done:!1,value:e(n)};n=null}return{done:!0,value:void 0}})}function a(t,e){var n=e&&typeof e;"object"==n||"function"==n?l.has(e)?n=l.get(e):(n=""+ ++c,l.set(e,n)):n="p_"+e;var r=t.b[n];if(r&&M(t.b,n))for(var i=0;i<r.length;i++){var a=r[i];if(e!==e&&a.key!==a.key||e===a.key)return{id:n,list:r,index:i,X:a}}return{id:n,list:r,index:-1,X:void 0}}function u(t){if(this.b={},this.a=e(),this.size=0,t){t=s(t);for(var n;!(n=t.next()).done;)n=n.value,this.set(n[0],n[1])}}if(function(){if(!t||"function"!=typeof t||!t.prototype.entries||"function"!=typeof Object.seal)return!1;try{var e=Object.seal({x:4}),n=new t(s([[e,"s"]]));if("s"!=n.get(e)||1!=n.size||n.get({x:4})||n.set({x:4},"t")!=n||2!=n.size)return!1;var r=n.entries(),i=r.next();return!i.done&&i.value[0]==e&&"s"==i.value[1]&&(i=r.next(),!(i.done||4!=i.value[0].x||"t"!=i.value[1]||!r.next().done))}catch(a){return!1}}())return t;n(),r();var l=new WeakMap;u.prototype.set=function(t,e){var n=a(this,t);return n.list||(n.list=this.b[n.id]=[]),n.X?n.X.value=e:(n.X={next:this.a,Ca:this.a.Ca,head:this.a,key:t,value:e},n.list.push(n.X),this.a.Ca.next=n.X,this.a.Ca=n.X,this.size++),this},u.prototype["delete"]=function(t){return t=a(this,t),!(!t.X||!t.list)&&(t.list.splice(t.index,1),t.list.length||delete this.b[t.id],t.X.Ca.next=t.X.next,t.X.next.Ca=t.X.Ca,t.X.head=null,this.size--,!0)},u.prototype.clear=function(){this.b={},this.a=this.a.Ca=e(),this.size=0},u.prototype.has=function(t){return!!a(this,t).X},u.prototype.get=function(t){return(t=a(this,t).X)&&t.value},u.prototype.entries=function(){return i(this,function(t){return[t.key,t.value]})},u.prototype.keys=function(){return i(this,function(t){return t.key})},u.prototype.values=function(){return i(this,function(t){return t.value})},u.prototype.forEach=function(t,e){for(var n,r=this.entries();!(n=r.next()).done;)n=n.value,t.call(e,n[1],n[0],this)},u.prototype[Symbol.iterator]=u.prototype.entries;var c=0;return u}),u("Set",function(t){function e(t){if(this.a=new Map,t){t=s(t);for(var e;!(e=t.next()).done;)this.add(e.value)}this.size=this.a.size}return function(){if(!t||"function"!=typeof t||!t.prototype.entries||"function"!=typeof Object.seal)return!1;try{var e=Object.seal({x:4}),n=new t(s([e]));if(!n.has(e)||1!=n.size||n.add(e)!=n||1!=n.size||n.add({x:4})!=n||2!=n.size)return!1;var r=n.entries(),i=r.next();return!i.done&&i.value[0]==e&&i.value[1]==e&&(i=r.next(),!i.done&&i.value[0]!=e&&4==i.value[0].x&&i.value[1]==i.value[0]&&r.next().done)}catch(a){return!1}}()?t:(n(),r(),e.prototype.add=function(t){return this.a.set(t,t),this.size=this.a.size,this},e.prototype["delete"]=function(t){return t=this.a["delete"](t),this.size=this.a.size,t},e.prototype.clear=function(){this.a.clear(),this.size=0},e.prototype.has=function(t){return this.a.has(t)},e.prototype.entries=function(){return this.a.entries()},e.prototype.values=function(){return this.a.values()},e.prototype.keys=e.prototype.values,e.prototype[Symbol.iterator]=e.prototype.values,e.prototype.forEach=function(t,e){var n=this;this.a.forEach(function(r){return t.call(e,r,r,n)})},e)}),u("Array.prototype.findIndex",function(t){return t||function(t,e){return R(this,t,e).Dd}}),u("Array.prototype.keys",function(t){return t||function(){return L(this,function(t){return t})}}),u("Object.is",function(t){return t||function(t,e){return t===e?0!==t||1/t==1/e:t!==t&&e!==e}}),u("Array.prototype.includes",function(t){return t||function(t,e){var n=this;n instanceof String&&(n=String(n));var r=n.length,i=e||0;for(0>i&&(i=Math.max(i+r,0));i<r;i++){var a=n[i];if(a===t||Object.is(a,t))return!0}return!1}}),u("String.prototype.includes",function(t){return t||function(t,e){return-1!==I(this,t,"includes").indexOf(t,e||0)}}),u("Array.from",function(t){return t||function(t,e,n){r(),e=null!=e?e:function(t){return t};var i=[],a=t[Symbol.iterator];if("function"==typeof a)for(t=a.call(t);!(a=t.next()).done;)i.push(e.call(n,a.value));else{a=t.length;for(var o=0;o<a;o++)i.push(e.call(n,t[o]))}return i}}),u("String.prototype.startsWith",function(t){return t||function(t,e){for(var n=I(this,t,"startsWith"),r=n.length,i=t.length,a=Math.max(0,Math.min(0|e,n.length)),o=0;o<i&&a<r;)if(n[a++]!=t[o++])return!1;return o>=i}}),u("Array.prototype.find",function(t){return t||function(t,e){return R(this,t,e).je}});var _d=this;_d.a=!0,F.prototype.getBandwidthEstimate=function(t){return 128e3>this.a?t:Math.min(U(this.b),U(this.c))},t.console&&t.console.log.bind&&(j=console.warn.bind(console),B=console.error.bind(console));var bd=/^(?:([^:\/?#.]+):)?(?:\/\/(?:([^\/?#]*)@)?([^\/#?]*?)(?::([0-9]+))?(?=[\/#?]|$))?([^?#]+)?(?:\?([^#]*))?(?:#(.*))?$/;ld=G.prototype,ld.va="",ld.$a="",ld.ra="",ld.xb=null,ld.ia="",ld.Qa="",ld.toString=function(){var t=[],e=this.va;if(e&&t.push(W(e,Ed,!0),":"),e=this.ra){t.push("//");var n=this.$a;n&&t.push(W(n,Ed,!0),"@"),t.push(encodeURIComponent(e).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e=this.xb,null!=e&&t.push(":",String(e))}return(e=this.ia)&&(this.ra&&"/"!=e.charAt(0)&&t.push("/"),t.push(W(e,"/"==e.charAt(0)?Ad:wd,!0))),(e=this.a.toString())&&t.push("?",e),(e=this.Qa)&&t.push("#",W(e,Td)),t.join("")},ld.resolve=function(t){var e=this.clone();"data"===e.va&&(e=new G);var n=!!t.va;n?z(e,t.va):n=!!t.$a,n?e.$a=t.$a:n=!!t.ra,n?e.ra=t.ra:n=null!=t.xb;var r=t.ia;if(n)H(e,t.xb);else if(n=!!t.ia){if("/"!=r.charAt(0))if(this.ra&&!this.ia)r="/"+r;else{var i=e.ia.lastIndexOf("/");-1!=i&&(r=e.ia.substr(0,i+1)+r)}if(".."==r||"."==r)r="";else if(-1!=r.indexOf("./")||-1!=r.indexOf("/.")){i=0==r.lastIndexOf("/",0),r=r.split("/");for(var a=[],o=0;o<r.length;){var s=r[o++];"."==s?i&&o==r.length&&a.push(""):".."==s?((1<a.length||1==a.length&&""!=a[0])&&a.pop(),i&&o==r.length&&a.push("")):(a.push(s),i=!0)}r=a.join("/")}}return n?e.ia=r:n=""!==t.a.toString(),n?K(e,t.a.clone()):n=!!t.Qa,n&&(e.Qa=t.Qa),e},ld.clone=function(){return new G(this)};var Ed=/[#\/\?@]/g,wd=/[#\?:]/g,Ad=/[#\?]/g,Sd=/[#\?@]/g,Td=/#/g;ld=X.prototype,ld.ga=null,ld.Zb=null,ld.add=function(t,e){if(!this.ga&&(this.ga={},this.Zb=0,this.a))for(var n=this.a.split("&"),r=0;r<n.length;r++){var i=n[r].indexOf("="),a=null;if(0<=i){var o=n[r].substring(0,i);a=n[r].substring(i+1)}else o=n[r];o=decodeURIComponent(o.replace(/\+/g," ")),a=a||"",this.add(o,decodeURIComponent(a.replace(/\+/g," ")))}return this.a=null,(n=this.ga.hasOwnProperty(t)&&this.ga[t])||(this.ga[t]=n=[]),n.push(e),this.Zb++,this},ld.toString=function(){if(this.a)return this.a;if(!this.ga)return"";var t,e=[];for(t in this.ga)for(var n=encodeURIComponent(t),r=this.ga[t],i=0;i<r.length;i++){var a=n;""!==r[i]&&(a+="="+encodeURIComponent(r[i])),e.push(a)}return this.a=e.join("&")},ld.clone=function(){var t=new X;if(t.a=this.a,this.ga){var e,n={};for(e in this.ga)n[e]=this.ga[e].concat();t.ga=n,t.Zb=this.Zb}return t},$.prototype.O=function(e){var n=this;this.stop();var r=!0,i=null;return this.a=function(){t.clearTimeout(i),r=!1},i=t.setTimeout(function(){r&&n.b()},1e3*e),this},$.prototype.stop=function(){this.a&&(this.a(),this.a=null)},P("shaka.util.Timer",Z),Z.prototype.sc=function(){return this.stop(),this.b(),this},Z.prototype.tickNow=Z.prototype.sc,Z.prototype.O=function(t){var e=this;return this.stop(),this.a=new $(function(){e.b()}).O(t),this},Z.prototype.tickAfter=Z.prototype.O,Z.prototype.La=function(t){var e=this;return this.stop(),this.a=new $(function(){e.a.O(t),e.b()}).O(t),this},Z.prototype.tickEvery=Z.prototype.La,Z.prototype.stop=function(){this.a&&(this.a.stop(),this.a=null)},Z.prototype.stop=Z.prototype.stop,P("shaka.util.Error",et),et.prototype.toString=function(){return"shaka.util.Error "+JSON.stringify(this,null,"  ")},et.Severity={RECOVERABLE:1,CRITICAL:2},et.Category={NETWORK:1,TEXT:2,MEDIA:3,MANIFEST:4,STREAMING:5,DRM:6,PLAYER:7,CAST:8,STORAGE:9},et.Code={UNSUPPORTED_SCHEME:1e3,BAD_HTTP_STATUS:1001,HTTP_ERROR:1002,TIMEOUT:1003,MALFORMED_DATA_URI:1004,UNKNOWN_DATA_URI_ENCODING:1005,REQUEST_FILTER_ERROR:1006,RESPONSE_FILTER_ERROR:1007,MALFORMED_TEST_URI:1008,UNEXPECTED_TEST_REQUEST:1009,INVALID_TEXT_HEADER:2e3,INVALID_TEXT_CUE:2001,UNABLE_TO_DETECT_ENCODING:2003,BAD_ENCODING:2004,INVALID_XML:2005,INVALID_MP4_TTML:2007,INVALID_MP4_VTT:2008,UNABLE_TO_EXTRACT_CUE_START_TIME:2009,BUFFER_READ_OUT_OF_BOUNDS:3e3,JS_INTEGER_OVERFLOW:3001,EBML_OVERFLOW:3002,EBML_BAD_FLOATING_POINT_SIZE:3003,MP4_SIDX_WRONG_BOX_TYPE:3004,MP4_SIDX_INVALID_TIMESCALE:3005,MP4_SIDX_TYPE_NOT_SUPPORTED:3006,WEBM_CUES_ELEMENT_MISSING:3007,WEBM_EBML_HEADER_ELEMENT_MISSING:3008,WEBM_SEGMENT_ELEMENT_MISSING:3009,WEBM_INFO_ELEMENT_MISSING:3010,WEBM_DURATION_ELEMENT_MISSING:3011,WEBM_CUE_TRACK_POSITIONS_ELEMENT_MISSING:3012,WEBM_CUE_TIME_ELEMENT_MISSING:3013,MEDIA_SOURCE_OPERATION_FAILED:3014,MEDIA_SOURCE_OPERATION_THREW:3015,VIDEO_ERROR:3016,QUOTA_EXCEEDED_ERROR:3017,TRANSMUXING_FAILED:3018,UNABLE_TO_GUESS_MANIFEST_TYPE:4e3,DASH_INVALID_XML:4001,DASH_NO_SEGMENT_INFO:4002,DASH_EMPTY_ADAPTATION_SET:4003,DASH_EMPTY_PERIOD:4004,DASH_WEBM_MISSING_INIT:4005,DASH_UNSUPPORTED_CONTAINER:4006,DASH_PSSH_BAD_ENCODING:4007,DASH_NO_COMMON_KEY_SYSTEM:4008,DASH_MULTIPLE_KEY_IDS_NOT_SUPPORTED:4009,DASH_CONFLICTING_KEY_IDS:4010,UNPLAYABLE_PERIOD:4011,RESTRICTIONS_CANNOT_BE_MET:4012,NO_PERIODS:4014,HLS_PLAYLIST_HEADER_MISSING:4015,INVALID_HLS_TAG:4016,HLS_INVALID_PLAYLIST_HIERARCHY:4017,DASH_DUPLICATE_REPRESENTATION_ID:4018,HLS_MULTIPLE_MEDIA_INIT_SECTIONS_FOUND:4020,HLS_COULD_NOT_GUESS_MIME_TYPE:4021,HLS_MASTER_PLAYLIST_NOT_PROVIDED:4022,HLS_REQUIRED_ATTRIBUTE_MISSING:4023,HLS_REQUIRED_TAG_MISSING:4024,HLS_COULD_NOT_GUESS_CODECS:4025,HLS_KEYFORMATS_NOT_SUPPORTED:4026,DASH_UNSUPPORTED_XLINK_ACTUATE:4027,DASH_XLINK_DEPTH_LIMIT:4028,HLS_COULD_NOT_PARSE_SEGMENT_START_TIME:4030,CONTENT_UNSUPPORTED_BY_BROWSER:4032,CANNOT_ADD_EXTERNAL_TEXT_TO_LIVE_STREAM:4033,HLS_AES_128_ENCRYPTION_NOT_SUPPORTED:4034,INVALID_STREAMS_CHOSEN:5005,NO_RECOGNIZED_KEY_SYSTEMS:6e3,REQUESTED_KEY_SYSTEM_CONFIG_UNAVAILABLE:6001,FAILED_TO_CREATE_CDM:6002,FAILED_TO_ATTACH_TO_VIDEO:6003,INVALID_SERVER_CERTIFICATE:6004,FAILED_TO_CREATE_SESSION:6005,FAILED_TO_GENERATE_LICENSE_REQUEST:6006,LICENSE_REQUEST_FAILED:6007,LICENSE_RESPONSE_REJECTED:6008,ENCRYPTED_CONTENT_WITHOUT_DRM_INFO:6010,NO_LICENSE_SERVER_GIVEN:6012,OFFLINE_SESSION_REMOVED:6013,EXPIRED:6014,LOAD_INTERRUPTED:7e3,OPERATION_ABORTED:7001,NO_VIDEO_ELEMENT:7002,CAST_API_UNAVAILABLE:8e3,NO_CAST_RECEIVERS:8001,ALREADY_CASTING:8002,UNEXPECTED_CAST_ERROR:8003,CAST_CANCELED_BY_USER:8004,CAST_CONNECTION_TIMED_OUT:8005,CAST_RECEIVER_APP_UNAVAILABLE:8006,STORAGE_NOT_SUPPORTED:9e3,INDEXED_DB_ERROR:9001,DEPRECATED_OPERATION_ABORTED:9002,REQUESTED_ITEM_NOT_FOUND:9003,MALFORMED_OFFLINE_URI:9004,CANNOT_STORE_LIVE_OFFLINE:9005,STORE_ALREADY_IN_PROGRESS:9006,NO_INIT_DATA_FOR_OFFLINE:9007,LOCAL_PLAYER_INSTANCE_REQUIRED:9008,NEW_KEY_OPERATION_NOT_SUPPORTED:9011,KEY_NOT_FOUND:9012,MISSING_STORAGE_CELL:9013},nt.prototype.resolve=function(){},nt.prototype.reject=function(){},P("shaka.util.AbortableOperation",rt),rt.failed=it,rt.aborted=at,rt.completed=ot,rt.notAbortable=st,rt.prototype.abort=function(){return this.a=!0,this.Kd()},rt.prototype.abort=rt.prototype.abort,rt.all=ut,rt.prototype["finally"]=function(t){return this.promise.then(function(){return t(!0)},function(){return t(!1)}),this},rt.prototype["finally"]=rt.prototype["finally"],rt.prototype.U=function(t,e){function n(){return i.reject(new et(2,7,7001)),r.abort()}var r=this,i=new nt;return this.promise.then(function(e){r.a?i.reject(new et(2,7,7001)):t?n=lt(t,e,i):i.resolve(e)},function(t){e?n=lt(e,t,i):i.reject(t)}),new rt(i,function(){return n()})},rt.prototype.chain=rt.prototype.U,ct.prototype.preventDefault=function(){this.cancelable&&(this.defaultPrevented=!0)},ct.prototype.stopImmediatePropagation=function(){this.a=!0},ct.prototype.stopPropagation=function(){},ld=dt.prototype,ld.push=function(t,e){this.a.hasOwnProperty(t)?this.a[t].push(e):this.a[t]=[e]},ld.get=function(t){return(t=this.a[t])?t.slice():null},ld.getAll=function(){var t,e=[];for(t in this.a)e.push.apply(e,this.a[t]);return e},ld.remove=function(t,e){var n=this.a[t];if(n)for(var r=0;r<n.length;++r)n[r]==e&&(n.splice(r,1),--r)},ld.forEach=function(t){for(var e in this.a)t(e,this.a[e])},ht.prototype.addEventListener=function(t,e){this.Bc.push(t,e)},ht.prototype.removeEventListener=function(t,e){this.Bc.remove(t,e)},ht.prototype.dispatchEvent=function(t){for(var e=this.Bc.get(t.type)||[],n=0;n<e.length;++n){t.target=this.Ub,t.currentTarget=this.Ub;var r=e[n];try{r.handleEvent?r.handleEvent(t):r.call(this,t)}catch(i){}if(t.a)break}return t.defaultPrevented},yt.prototype.destroy=function(){var t=[];return this.a.forEach(function(e){e.promise["catch"](function(){}),t.push(e.abort())}),this.a=[],Promise.all(t)},O(bt,ht),P("shaka.net.NetworkingEngine",bt);var xd={MANIFEST:0,SEGMENT:1,LICENSE:2,APP:3,TIMING:4};bt.RequestType=xd,bt.PluginPriority={FALLBACK:1,PREFERRED:2,APPLICATION:3};var kd={};bt.registerScheme=Et,bt.unregisterScheme=function(t){delete kd[t]},bt.prototype.Bf=function(t){this.a.add(t)},bt.prototype.registerRequestFilter=bt.prototype.Bf,bt.prototype.gg=function(t){this.a["delete"](t)},bt.prototype.unregisterRequestFilter=bt.prototype.gg,bt.prototype.we=function(){this.a.clear()},bt.prototype.clearAllRequestFilters=bt.prototype.we,bt.prototype.Cf=function(t){this.b.add(t)},bt.prototype.registerResponseFilter=bt.prototype.Cf,bt.prototype.hg=function(t){this.b["delete"](t)},bt.prototype.unregisterResponseFilter=bt.prototype.hg,bt.prototype.xe=function(){this.b.clear()},bt.prototype.clearAllResponseFilters=bt.prototype.xe,bt.prototype.destroy=function(){return this.f=!0,this.a.clear(),this.b.clear(),this.g.destroy()},bt.prototype.destroy=bt.prototype.destroy,bt.prototype.request=function(t,e){var n=this,r=new xt;if(this.f){var i=Promise.reject(new et(2,7,7001));return i["catch"](function(){}),new kt(i,function(){return Promise.resolve()},r)}e.method=e.method||"GET",e.headers=e.headers||{},e.retryParameters=e.retryParameters?ft(e.retryParameters):tt(),e.uris=ft(e.uris),i=At(this,t,e);var a=i.U(function(){return St(n,t,e,new Q(e.retryParameters,!1),0,null,r)}),o=a.U(function(e){return Tt(n,t,e)}),s=Date.now(),u=0;i.promise.then(function(){u=Date.now()-s},function(){});var l=0;return a.promise.then(function(){l=Date.now()},function(){}),i=o.U(function(e){var r=Date.now()-l,i=e.response;return i.timeMs+=u,i.timeMs+=r,e.Ze||!n.c||i.fromCache||1!=t||n.c(i.timeMs,i.data.byteLength),i},function(t){throw t&&(t.severity=2),t}),i=new kt(i.promise,i.Kd,r),_t(this.g,i),i},bt.prototype.request=bt.prototype.request,bt.NumBytesRemainingClass=xt;var Cd=kt;if(Cd.prototype=pd(rt.prototype),Cd.prototype.constructor=Cd,yd)yd(Cd,rt);else for(var Md in rt)if("prototype"!=Md)if(Object.defineProperties){var Rd=Object.getOwnPropertyDescriptor(rt,Md);Rd&&Object.defineProperty(Cd,Md,Rd)}else Cd[Md]=rt[Md];Cd.eg=rt.prototype,bt.PendingRequest=kt,kt.all=ut,kt.notAbortable=st,kt.completed=ot,kt.aborted=at,kt.failed=it,P("shaka.util.IReleasable",Ct),Ct.prototype.release=function(){},P("shaka.util.EventManager",Mt),Mt.prototype.release=function(){this.Ya(),this.a=null},Mt.prototype.release=Mt.prototype.release,Mt.prototype.w=function(t,e,n,r){this.a&&(t=new Rt(t,e,n,r),this.a.push(e,t))},Mt.prototype.listen=Mt.prototype.w,Mt.prototype.ha=function(t,e,n,r){function i(r){a.da(t,e,i),n(r)}var a=this;this.w(t,e,i,r)},Mt.prototype.listenOnce=Mt.prototype.ha,Mt.prototype.da=function(t,e,n){if(this.a){var r=this.a.get(e)||[];r=s(r);for(var i=r.next();!i.done;i=r.next())i=i.value,i.target!=t||n!=i.listener&&n||(i.da(),this.a.remove(e,i))}},Mt.prototype.unlisten=Mt.prototype.da,Mt.prototype.Ya=function(){if(this.a){var t=this.a.getAll();t=s(t);for(var e=t.next();!e.done;e=t.next())e.value.da();this.a.a={}}},Mt.prototype.removeAll=Mt.prototype.Ya,Rt.prototype.da=function(){this.target.removeEventListener(this.type,this.listener,this.a),this.listener=this.target=null,this.a=!1},Rt.prototype.unlisten=Rt.prototype.da;var Ld=void 0,Id=(new Map).set("codecs","codecs").set("frameRate","framerate").set("bandwidth","bitrate").set("width","width").set("height","height").set("channelsCount","channels"),Pd=null,Od=null;P("shaka.util.StringUtils.fromUTF8",Ht),P("shaka.util.StringUtils.fromUTF16",Kt),P("shaka.util.StringUtils.fromBytesAutoDetect",Yt),P("shaka.util.StringUtils.toUTF8",Wt),P("shaka.util.StringUtils.toUTF16",qt);var Dd=null;P("shaka.util.Uint8ArrayUtils.toBase64",$t),P("shaka.util.Uint8ArrayUtils.fromBase64",Zt),P("shaka.util.Uint8ArrayUtils.fromHex",Qt),P("shaka.util.Uint8ArrayUtils.toHex",Jt),P("shaka.util.Uint8ArrayUtils.equal",te),P("shaka.util.Uint8ArrayUtils.concat",ee),ld=ne.prototype,ld.destroy=function(){var t=this;return c(function e(){return k(e,function(e){switch(e.j){case 1:return t.c?p(e,t.$,0):(t.c=!0,p(e,re(t),4));case 4:t.$.resolve(),e.A(0)}})})},ld.configure=function(t){this.f=t},ld.Cb=function(t){var e=this;if(!this.h)return this.i.ha(t,"encrypted",function(){e.g(new et(2,6,6010))}),Promise.resolve();this.m=t,this.i.ha(this.m,"play",function(){for(var t=0;t<e.G.length;t++)_e(e,e.G[t]);e.ma=!0,e.G=[]}),t=this.m.setMediaKeys(this.h),t=t["catch"](function(t){return Promise.reject(new et(2,6,6003,t.message))});var n=ue(this);return Promise.all([t,n]).then(function(){if(e.c)return Promise.reject();ce(e),e.a.initData.length||e.o.length||e.i.w(e.m,"encrypted",function(t){return de(e,t.initDataType,new Uint8Array(t.initData))})})["catch"](function(t){if(!e.c)return Promise.reject(t)})},ld.keySystem=function(){return this.a?this.a.keySystem:""},ld.dc=function(){var t=1/0,e=this.b.keys();e=s(e);for(var n=e.next();!n.done;n=e.next())n=n.value,isNaN(n.expiration)||(t=Math.min(t,n.expiration));return t},ld.Sd=function(t){this.f.delayLicenseRequestUntilPlayed&&this.m.paused&&!this.ma?this.G.push(t):_e(this,t)},ld.Qd=function(t){t=t.target;var e=this.b.get(t),n=!1;t.keyStatuses.forEach(function(t,r){if("string"==typeof r){var i=r;r=t,t=i}if("com.microsoft.playready"==this.a.keySystem&&16==r.byteLength&&!Gt("Tizen")){i=new DataView(r);var a=i.getUint32(0,!0),o=i.getUint16(4,!0),s=i.getUint16(6,!0);i.setUint32(0,a,!1),i.setUint16(4,o,!1),i.setUint16(6,s,!1)}"com.microsoft.playready"==this.a.keySystem&&"status-pending"==t&&(t="usable"),"status-pending"!=t&&(e.loaded=!0),"expired"==t&&(n=!0),i=Jt(new Uint8Array(r)),this.na.set(i,t)}.bind(this));var r=t.expiration-Date.now();(0>r||n&&1e3>r)&&e&&!e.xa&&(this.b["delete"](t),t.close()["catch"](function(){})),Ce(this)&&(this.l.resolve(),this.M.O(Fd))};var Nd=1,Ud=5,Fd=.5;Pe.prototype.init=function(t){var e=muxjs.mp4.probe;t=new Uint8Array(t),this.g=e.videoTrackIds(t),this.f=e.timescale(t),this.a.init()},Pe.prototype.b=function(t,e){var n=new Uint8Array(t);(n=this.a.parse(n,this.g,this.f))&&n.captions&&e(n.captions),this.a.clearParsedCaptions()},Pe.prototype.c=function(){this.a.resetCaptionStream()},Oe.prototype.init=function(){},Oe.prototype.b=function(){},Oe.prototype.c=function(){};var Bd={ye:function(t,e){return t.reduce(function(t,e,n){return e["catch"](t.bind(null,n))}.bind(null,e),Promise.reject())},yc:function(t,e){return t.concat(e)},ic:function(){},Ga:function(t){return null!=t}},jd={Na:"video",Ab:"audio",qa:"text",og:"application"},Vd=1/15;Ve.prototype.destroy=function(){return this.a.dispose(),this.a=null,Promise.resolve()},Ve.prototype.i=function(t){this.c=t.captions;var e=new Uint8Array(t.data.byteLength+t.initSegment.byteLength);e.set(t.initSegment,0),e.set(t.data,t.initSegment.byteLength),this.g.push(e)},Ve.prototype.h=function(){var t={data:ee.apply(null,this.g),captions:this.c};this.b.resolve(t),this.f=!1},P("shaka.text.Cue",Ke);var Gd="auto";Ke.positionAlign={LEFT:"line-left",RIGHT:"line-right",CENTER:"center",AUTO:Gd};var zd="center",Hd={LEFT:"left",RIGHT:"right",CENTER:zd,START:"start",END:"end"};Ke.textAlign=Hd;var Kd="after",Yd={BEFORE:"before",CENTER:"center",AFTER:Kd};Ke.displayAlign=Yd;var Wd="ltr";Ke.direction={HORIZONTAL_LEFT_TO_RIGHT:Wd,HORIZONTAL_RIGHT_TO_LEFT:"rtl"};var qd="horizontal-tb";Ke.writingMode={HORIZONTAL_TOP_TO_BOTTOM:qd,VERTICAL_LEFT_TO_RIGHT:"vertical-lr",VERTICAL_RIGHT_TO_LEFT:"vertical-rl"};var Xd=0;Ke.lineInterpretation={LINE_NUMBER:Xd,PERCENTAGE:1};var $d="start",Zd={CENTER:"center",START:$d,END:"end"};Ke.lineAlign=Zd;var Qd=400;Ke.fontWeight={NORMAL:Qd,BOLD:700};var Jd="normal",th={NORMAL:Jd,ITALIC:"italic",OBLIQUE:"oblique"};Ke.fontStyle=th,Ke.textDecoration={UNDERLINE:"underline",LINE_THROUGH:"lineThrough",OVERLINE:"overline"},P("shaka.text.CueRegion",Ye);var eh=1;Ye.units={PX:0,PERCENTAGE:eh,LINES:2};var nh="";Ye.scrollMode={NONE:nh,UP:"up"};var rh={};P("shaka.text.TextEngine.registerParser",function(t,e){rh[t]=e}),P("shaka.text.TextEngine.unregisterParser",function(t){delete rh[t]}),We.prototype.destroy=function(){return this.c=this.g=null,this.i.clear(),Promise.resolve()},We.prototype.Lc=function(t){var e={periodStart:0,segmentStart:null,segmentEnd:0};try{return this.g.parseMedia(new Uint8Array(t),e)[0].startTime}catch(n){throw new et(2,2,2009,n)}},We.prototype.remove=function(t,e){return Promise.resolve().then(function(){!this.c||!this.c.remove(t,e)||null==this.a||e<=this.a||t>=this.b||(t<=this.a&&e>=this.b?this.a=this.b=null:t<=this.a&&e<this.b?this.a=e:t>this.a&&e>=this.b&&(this.b=t))}.bind(this))},We.prototype.re=function(t){this.c.append(t)},We.prototype.appendCues=We.prototype.re,We.prototype.rc=function(t,e){this.l=t;var n=this.i.get(t);if(n)for(var r=s(n.keys()),i=r.next();!i.done;i=r.next())(i=n.get(i.value))&&(i=i.filter(function(t){return t.endTime<=e}),this.c.append(i))},We.prototype.setSelectedClosedCaptionId=We.prototype.rc;var ih=t.URL.createObjectURL;ld=Qe.prototype,ld.destroy=function(){var t=this;this.v=!0;var e,n=[];for(e in this.c){var r=this.c[e],i=r[0];for(this.c[e]=r.slice(0,1),i&&n.push(i.p["catch"](Bd.ic)),i=1;i<r.length;++i)r[i].p.reject()}this.a&&n.push(this.a.destroy()),this.g&&n.push(this.g.destroy());for(var a in this.l)n.push(this.l[a].destroy());return Promise.all(n).then(function(){t.i&&(t.i.release(),t.i=null),t.f&&(t.f.removeAttribute("src"),t.f.load(),t.f=null),t.h=null,t.a=null,t.g=null,t.b={},t.l={},t.m=null,t.c={}})},ld.init=function(t,e){var n=this;return c(function r(){var i;return k(r,function(r){switch(r.j){case 1:return i=jd,p(r,n.o,2);case 2:t.forEach(function(t,r){var a=Ut(t.mimeType,t.codecs);r==i.qa?tn(n,a):(!e&&MediaSource.isTypeSupported(a)||!Ge(a,r)||(n.l[r]=new Ve,a=ze(r,a)),a=n.h.addSourceBuffer(a),n.i.w(a,"error",n.Xf.bind(n,r)),n.i.w(a,"updateend",n.ub.bind(n,r)),n.b[r]=a,n.c[r]=[])}),m(r)}})})},ld.Ic=function(t){if(t.total=Fe(this.f.buffered),t.audio=Fe(an(this,"audio")),t.video=Fe(an(this,"video")),t.text=[],this.a){var e=this.a.a,n=this.a.b;null!=e&&null!=n&&t.text.push({start:e,end:n})}},ld.rc=function(t){var e=nn(this,"video")||0;this.a.rc(t,e)},ld.remove=function(t,e,n){return"text"==t?this.a.remove(e,n):ln(this,t,this.ge.bind(this,t,e,n))},ld.flush=function(t){return"text"==t?Promise.resolve():ln(this,t,this.Ce.bind(this,t))},ld.endOfStream=function(t){return cn(this,function(){t?this.h.endOfStream(t):this.h.endOfStream()}.bind(this))},ld.wa=function(t){return cn(this,function(){this.h.duration=t}.bind(this))},ld.Y=function(){return this.h.duration},ld.fe=function(t,e){this.b[t].appendBuffer(e)},ld.ge=function(t,e,n){n<=e?this.ub(t):this.b[t].remove(e,n)},ld.pe=function(t){var e=this.b[t].appendWindowStart,n=this.b[t].appendWindowEnd;this.b[t].abort(),this.b[t].appendWindowStart=e,this.b[t].appendWindowEnd=n,this.ub(t)},ld.Ce=function(t){this.f.currentTime-=.001,this.ub(t)},ld.Sf=function(t,e){0>e&&(e+=.001),this.b[t].timestampOffset=e,this.ub(t)},ld.Pf=function(t,e,n){this.b[t].appendWindowStart=0,this.b[t].appendWindowEnd=n,this.b[t].appendWindowStart=e,this.ub(t)},ld.Xf=function(t){this.c[t][0].p.reject(new et(2,3,3014,this.f.error?this.f.error.code:0))},ld.ub=function(t){var e=this.c[t][0];e&&(e.p.resolve(),dn(this,t))};var ah=new Map([["aar","aa"],["abk","ab"],["afr","af"],["aka","ak"],["alb","sq"],["amh","am"],["ara","ar"],["arg","an"],["arm","hy"],["asm","as"],["ava","av"],["ave","ae"],["aym","ay"],["aze","az"],["bak","ba"],["bam","bm"],["baq","eu"],["bel","be"],["ben","bn"],["bih","bh"],["bis","bi"],["bod","bo"],["bos","bs"],["bre","br"],["bul","bg"],["bur","my"],["cat","ca"],["ces","cs"],["cha","ch"],["che","ce"],["chi","zh"],["chu","cu"],["chv","cv"],["cor","kw"],["cos","co"],["cre","cr"],["cym","cy"],["cze","cs"],["dan","da"],["deu","de"],["div","dv"],["dut","nl"],["dzo","dz"],["ell","el"],["eng","en"],["epo","eo"],["est","et"],["eus","eu"],["ewe","ee"],["fao","fo"],["fas","fa"],["fij","fj"],["fin","fi"],["fra","fr"],["fre","fr"],["fry","fy"],["ful","ff"],["geo","ka"],["ger","de"],["gla","gd"],["gle","ga"],["glg","gl"],["glv","gv"],["gre","el"],["grn","gn"],["guj","gu"],["hat","ht"],["hau","ha"],["heb","he"],["her","hz"],["hin","hi"],["hmo","ho"],["hrv","hr"],["hun","hu"],["hye","hy"],["ibo","ig"],["ice","is"],["ido","io"],["iii","ii"],["iku","iu"],["ile","ie"],["ina","ia"],["ind","id"],["ipk","ik"],["isl","is"],["ita","it"],["jav","jv"],["jpn","ja"],["kal","kl"],["kan","kn"],["kas","ks"],["kat","ka"],["kau","kr"],["kaz","kk"],["khm","km"],["kik","ki"],["kin","rw"],["kir","ky"],["kom","kv"],["kon","kg"],["kor","ko"],["kua","kj"],["kur","ku"],["lao","lo"],["lat","la"],["lav","lv"],["lim","li"],["lin","ln"],["lit","lt"],["ltz","lb"],["lub","lu"],["lug","lg"],["mac","mk"],["mah","mh"],["mal","ml"],["mao","mi"],["mar","mr"],["may","ms"],["mkd","mk"],["mlg","mg"],["mlt","mt"],["mon","mn"],["mri","mi"],["msa","ms"],["mya","my"],["nau","na"],["nav","nv"],["nbl","nr"],["nde","nd"],["ndo","ng"],["nep","ne"],["nld","nl"],["nno","nn"],["nob","nb"],["nor","no"],["nya","ny"],["oci","oc"],["oji","oj"],["ori","or"],["orm","om"],["oss","os"],["pan","pa"],["per","fa"],["pli","pi"],["pol","pl"],["por","pt"],["pus","ps"],["que","qu"],["roh","rm"],["ron","ro"],["rum","ro"],["run","rn"],["rus","ru"],["sag","sg"],["san","sa"],["sin","si"],["slk","sk"],["slo","sk"],["slv","sl"],["sme","se"],["smo","sm"],["sna","sn"],["snd","sd"],["som","so"],["sot","st"],["spa","es"],["sqi","sq"],["srd","sc"],["srp","sr"],["ssw","ss"],["sun","su"],["swa","sw"],["swe","sv"],["tah","ty"],["tam","ta"],["tat","tt"],["tel","te"],["tgk","tg"],["tgl","tl"],["tha","th"],["tib","bo"],["tir","ti"],["ton","to"],["tsn","tn"],["tso","ts"],["tuk","tk"],["tur","tr"],["twi","tw"],["uig","ug"],["ukr","uk"],["urd","ur"],["uzb","uz"],["ven","ve"],["vie","vi"],["vol","vo"],["wel","cy"],["wln","wa"],["wol","wo"],["xho","xh"],["yid","yi"],["yor","yo"],["zha","za"],["zho","zh"],["zul","zu"]]),oh=0;P("shaka.abr.SimpleAbrManager",In),In.prototype.stop=function(){this.h=null,this.f=!1,this.c=[],this.g=null},In.prototype.stop=In.prototype.stop,In.prototype.init=function(t){this.h=t},In.prototype.init=In.prototype.init,In.prototype.chooseVariant=function(){var t=Pn(this.a.restrictions,this.c),e=this.b.getBandwidthEstimate(this.a.defaultBandwidthEstimate);this.c.length&&!t.length&&(t=Pn(null,this.c),t=[t[0]]);for(var n=t[0]||null,r=0;r<t.length;++r){var i=t[r],a=(t[r+1]||{bandwidth:1/0}).bandwidth/this.a.bandwidthUpgradeTarget;e>=i.bandwidth/this.a.bandwidthDowngradeTarget&&e<=a&&(n=i)}return this.g=Date.now(),n},In.prototype.chooseVariant=In.prototype.chooseVariant,In.prototype.enable=function(){this.f=!0},In.prototype.enable=In.prototype.enable,In.prototype.disable=function(){this.f=!1},In.prototype.disable=In.prototype.disable,In.prototype.segmentDownloaded=function(t,e){var n=this.b;if(!(16e3>e)){var r=8e3*e/t,i=t/1e3;n.a+=e,N(n.b,i,r),N(n.c,i,r)}if(null!=this.g&&this.f)t:{if(this.i){if(Date.now()-this.g<1e3*this.a.switchInterval)break t}else{if(!(128e3<=this.b.a))break t;this.i=!0}n=this.chooseVariant(),this.b.getBandwidthEstimate(this.a.defaultBandwidthEstimate),this.h(n)}},In.prototype.segmentDownloaded=In.prototype.segmentDownloaded,In.prototype.getBandwidthEstimate=function(){return this.b.getBandwidthEstimate(this.a.defaultBandwidthEstimate)},In.prototype.getBandwidthEstimate=In.prototype.getBandwidthEstimate,In.prototype.setVariants=function(t){this.c=t},In.prototype.setVariants=In.prototype.setVariants,In.prototype.configure=function(t){this.a=t},In.prototype.configure=In.prototype.configure,On.prototype.toString=function(){return"v"+this.a+"."+this.b};var sh=null,uh="ended play playing pause pausing ratechange seeked seeking timeupdate volumechange".split(" "),lh="buffered currentTime duration ended loop muted paused playbackRate seeking videoHeight videoWidth volume".split(" "),ch=["loop","playbackRate"],dh=["pause","play"],hh="abrstatuschanged adaptation buffering emsg error loading streaming texttrackvisibility timelineregionadded timelineregionenter timelineregionexit trackschanged unloading variantchanged textchanged".split(" "),fh={getAssetUri:2,getAudioLanguages:2,getAudioLanguagesAndRoles:2,getBufferedInfo:2,getConfiguration:2,getExpiration:2,getPlaybackRate:2,getTextLanguages:2,getTextLanguagesAndRoles:2,getTextTracks:2,getStats:5,getVariantTracks:2,isAudioOnly:10,isBuffering:1,isInProgress:1,isLive:10,isTextTrackVisible:1,keySystem:10,seekRange:1,usingEmbeddedTextTrack:2,getLoadMode:10},ph={getPlayheadTimeAsDate:1,getPresentationStartTimeAsDate:20},mh=[["getConfiguration","configure"]],gh=[["isTextTrackVisible","setTextTrackVisibility"]],vh="addTextTrack cancelTrickPlay configure resetConfiguration retryStreaming selectAudioLanguage selectEmbeddedTextTrack selectTextLanguage selectTextTrack selectVariantTrack setTextTrackVisibility trickPlay".split(" "),yh=["attach","detach","load","unload"],_h=!1,bh=null;ld=Vn.prototype,ld.destroy=function(){return zn(this),bh&&Gn(this),this.f&&(this.f.stop(),this.f=null),this.M=this.G=null,this.b=this.h=!1,this.o=this.m=this.g=this.c=this.a=this.i=null,Promise.resolve()},ld.fa=function(){return this.b},ld.bd=function(){return this.D},ld.init=function(){if(t.chrome&&chrome.cast&&chrome.cast.isAvailable){delete t.__onGCastApiAvailable,this.h=!0,this.f.sc();var e=new chrome.cast.SessionRequest(this.P);e=new chrome.cast.ApiConfig(e,this.Pd.bind(this),this.pf.bind(this),"origin_scoped"),chrome.cast.initialize(e,function(){},function(){}),_h&&this.f.O(.02),(e=bh)&&e.status!=chrome.cast.SessionStatus.STOPPED?this.Pd(e):bh=null}else t.__onGCastApiAvailable=function(t){t&&this.init()}.bind(this)},ld.hd=function(t){this.i=t,this.b&&Hn({type:"appData",appData:this.i})},ld.cast=function(t){return this.h?_h?this.b?Promise.reject(new et(1,8,8002)):(this.g=new nt,chrome.cast.requestSession(this.Zc.bind(this,t),this.Nd.bind(this)),this.g):Promise.reject(new et(1,8,8001)):Promise.reject(new et(1,8,8e3))},ld.ac=function(){this.b&&(zn(this),bh&&(Gn(this),bh.stop(function(){},function(){}),bh=null))},ld.get=function(t,e){if("video"==t){if(dh.includes(e))return this.Zd.bind(this,t,e)}else if("player"==t){if(ph[e]&&!this.get("player","isLive")())return function(){};if(vh.includes(e))return this.Zd.bind(this,t,e);if(yh.includes(e))return this.Ef.bind(this,t,e);if(fh[e])return this.Wd.bind(this,t,e)}return this.Wd(t,e)},ld.set=function(t,e,n){this.a[t][e]=n,Hn({type:"set",targetName:t,property:e,value:n})},ld.Zc=function(t,e){bh=e,e.addUpdateListener(this.m),e.addMessageListener("urn:x-cast:com.google.shaka.v2",this.o),this.Od(),Hn({type:"init",initState:t,appData:this.i}),this.g.resolve()},ld.Nd=function(t){var e=8003;switch(t.code){case"cancel":e=8004;break;case"timeout":e=8005;break;case"receiver_unavailable":e=8006}this.g.reject(new et(2,8,e,t))},ld.Wd=function(t,e){return this.a[t][e]},ld.Zd=function(t,e,n){for(var r=[],i=2;i<arguments.length;++i)r[i-2]=arguments[i];Hn({type:"call",targetName:t,methodName:e,args:r})},ld.Ef=function(t,e,n){for(var r=[],i=2;i<arguments.length;++i)r[i-2]=arguments[i];i=new nt;var a=this.v.toString();return this.v++,this.c[a]=i,Hn({type:"asyncCall",targetName:t,methodName:e,args:r,id:a}),i},ld.Pd=function(t){var e=this.C();this.g=new nt,this.l=!0,this.Zc(e,t)},ld.pf=function(t){_h="available"==t,this.f.sc()},ld.Od=function(){var t=!!bh&&"connected"==bh.status;if(this.b&&!t){this.M();for(var e in this.a)this.a[e]={};zn(this)}this.D=(this.b=t)?bh.receiver.friendlyName:"",this.f.sc()},ld.kf=function(t,e){var n=Bn(e);switch(n.type){case"event":var r=n.event;this.G(n.targetName,new ct(r.type,r));break;case"update":r=n.update;for(var i in r){n=this.a[i]||{};for(var a in r[i])n[a]=r[i][a]}this.l&&(this.T(),this.l=!1);break;case"asyncComplete":if(i=n.id,n=n.error,a=this.c[i],delete this.c[i],a)if(n){i=new et(n.severity,n.category,n.code);for(r in n)i[r]=n[r];a.reject(i)}else a.resolve()}},O(Kn,ht),P("shaka.cast.CastProxy",Kn),Kn.prototype.destroy=function(t){return t&&this.a&&this.a.ac(),this.i&&(this.i.release(),this.i=null),t=[],this.b&&(t.push(this.b.destroy()),this.b=null),this.a&&(t.push(this.a.destroy()),this.a=null),this.l=this.h=this.c=null,Promise.all(t)},Kn.prototype.destroy=Kn.prototype.destroy,Kn.prototype.Ye=function(){return this.h},Kn.prototype.getVideo=Kn.prototype.Ye,Kn.prototype.Re=function(){return this.l},Kn.prototype.getPlayer=Kn.prototype.Re,Kn.prototype.te=function(){return!!this.a&&(this.a.h&&_h)},Kn.prototype.canCast=Kn.prototype.te,Kn.prototype.fa=function(){return!!this.a&&this.a.fa()},Kn.prototype.isCasting=Kn.prototype.fa,Kn.prototype.bd=function(){return this.a?this.a.bd():""},Kn.prototype.receiverName=Kn.prototype.bd,Kn.prototype.cast=function(){var t=this.Bd();return this.a.cast(t).then(function(){if(this.b)return this.b.qd()}.bind(this))},Kn.prototype.cast=Kn.prototype.cast,Kn.prototype.hd=function(t){this.a.hd(t)},Kn.prototype.setAppData=Kn.prototype.hd,Kn.prototype.dg=function(){var t=this.a;if(t.b){var e=t.C();chrome.cast.requestSession(t.Zc.bind(t,e),t.Nd.bind(t))}},Kn.prototype.suggestDisconnect=Kn.prototype.dg,Kn.prototype.ac=function(){this.a.ac()},Kn.prototype.forceDisconnect=Kn.prototype.ac,ld=Kn.prototype,ld.Bd=function(){var t={video:{},player:{},playerAfterLoad:{},manifest:this.b.bc(),startTime:null};return this.c.pause(),ch.forEach(function(e){t.video[e]=this.c[e]}.bind(this)),this.c.ended||(t.startTime=this.c.currentTime),mh.forEach(function(e){var n=e[1];e=this.b[e[0]](),t.player[n]=e}.bind(this)),gh.forEach(function(e){var n=e[1];e=this.b[e[0]](),t.playerAfterLoad[n]=e}.bind(this)),t},ld.Tf=function(){this.dispatchEvent(new ct("caststatuschanged"))},ld.Uf=function(){this.f.dispatchEvent(new ct(this.h.paused?"pause":"play"))},ld.Wf=function(){var t=this;mh.forEach(function(t){var e=t[1];t=this.a.get("player",t[0])(),this.b[e](t)}.bind(this));var e=this.a.get("player","getAssetUri")(),n=this.a.get("video","ended"),r=Promise.resolve(),i=this.c.autoplay,a=null;n||(a=this.a.get("video","currentTime")),e&&(this.c.autoplay=!1,r=this.b.load(e,a));var o={};ch.forEach(function(t){o[t]=this.a.get("video",t)}.bind(this)),r.then(function(){t.c&&(ch.forEach(function(t){this.c[t]=o[t]}.bind(t)),gh.forEach(function(t){var e=t[1];t=this.a.get("player",t[0])(),this.b[e](t)}.bind(t)),t.c.autoplay=i,e&&t.c.play())},function(e){t.b.dispatchEvent(new ct("error",{detail:e}))})},ld.lg=function(t){if("addEventListener"==t)return this.f.addEventListener.bind(this.f);if("removeEventListener"==t)return this.f.removeEventListener.bind(this.f);if(this.a.fa()&&0==Object.keys(this.a.a.video).length){var e=this.c[t];if("function"!=typeof e)return e}return this.a.fa()?this.a.get("video",t):(t=this.c[t],"function"==typeof t&&(t=t.bind(this.c)),t)},ld.ng=function(t,e){this.a.fa()?this.a.set("video",t,e):this.c[t]=e},ld.mg=function(t){this.a.fa()||this.f.dispatchEvent(new ct(t.type,t))},ld.Vd=function(t){if("addEventListener"==t)return this.g.addEventListener.bind(this.g);if("removeEventListener"==t)return this.g.removeEventListener.bind(this.g);if("getMediaElement"==t)return function(){return this.h}.bind(this);if("getSharedConfiguration"==t)return this.a.get("player","getConfiguration");if("getNetworkingEngine"==t)return this.b.Eb.bind(this.b);if(this.a.fa()){if("getManifest"==t||"drmInfo"==t)return function(){return j(t+"() does not work while casting!"),null};if("getManifestUri"==t)return Dn("getManifestUri",'Please use "getAssetUri" instead.'),this.Vd("getAssetUri");if("attach"==t||"detach"==t)return function(){return j(t+"() does not work while casting!"),Promise.resolve()}}return this.a.fa()&&0==Object.keys(this.a.a.video).length&&fh[t]||!this.a.fa()?this.b[t].bind(this.b):this.a.get("player",t)},ld.yf=function(t){this.a.fa()||this.g.dispatchEvent(t)},ld.Vf=function(t,e){this.a.fa()&&("video"==t?this.f.dispatchEvent(e):"player"==t&&this.g.dispatchEvent(e))},O(Wn,ht),P("shaka.cast.CastReceiver",Wn),Wn.prototype.isConnected=function(){return this.v},Wn.prototype.isConnected=Wn.prototype.isConnected,Wn.prototype.bf=function(){return this.h},Wn.prototype.isIdle=Wn.prototype.bf,Wn.prototype.destroy=function(){var t=this;return c(function e(){var n,r;return k(e,function(e){switch(e.j){case 1:return t.c&&(t.c.release(),t.c=null),n=[],t.b&&(n.push(t.b.destroy()),t.b=null),t.C&&(t.C.stop(),t.C=null),t.a=null,t.D=null,t.o=null,t.v=!1,t.h=!0,t.f=null,t.i=null,p(e,Promise.all(n),2);case 2:r=cast.receiver.CastReceiverManager.getInstance(),r.stop(),m(e)}})})},Wn.prototype.destroy=Wn.prototype.destroy,ld=Wn.prototype,ld.Rd=function(){this.g=0,this.l=!0,this.v=0!=cast.receiver.CastReceiverManager.getInstance().getSenders().length,Xn(this)},ld.Xd=function(t,e){this.b&&(Zn(this),tr(this,{type:"event",targetName:t,event:e},this.f))},ld.Be=function(){var t=cast.receiver.CastReceiverManager.getInstance().getSystemVolume();t&&tr(this,{type:"update",update:{video:{volume:t.level,muted:t.muted}}},this.f),tr(this,{type:"event",targetName:"video",event:{type:"volumechange"}},this.f)},ld.rf=function(t){var e=Bn(t.data);switch(e.type){case"init":this.g=0,this.m=!1,this.l=!0,$n(this,e.initState,e.appData),Zn(this);break;case"appData":this.o(e.appData);break;case"set":var n=e.targetName,r=e.property;if(e=e.value,"video"==n){var i=cast.receiver.CastReceiverManager.getInstance();if("volume"==r){i.setSystemVolumeLevel(e);break}if("muted"==r){i.setSystemVolumeMuted(e);break}}this.D[n][r]=e;break;case"call":n=this.D[e.targetName],n[e.methodName].apply(n,e.args);break;case"asyncCall":n=e.targetName,r=e.methodName,"player"==n&&"load"==r&&(this.g=0,this.m=!1),i=e.id,t=t.senderId;var a=this.D[n];e=a[r].apply(a,e.args),"player"==n&&"load"==r&&(e=e.then(function(){this.l=!0}.bind(this))),e.then(this.ce.bind(this,t,i,null),this.ce.bind(this,t,i))}},ld.ef=function(t){var e=Bn(t.data);switch(e.type){case"PLAY":this.a.play(),er(this,0);break;case"PAUSE":this.a.pause(),er(this,0);break;case"SEEK":t=e.currentTime;var n=e.resumeState;null!=t&&(this.a.currentTime=Number(t)),n&&"PLAYBACK_START"==n?(this.a.play(),er(this,0)):n&&"PLAYBACK_PAUSE"==n&&(this.a.pause(),er(this,0));break;case"STOP":this.b.qd().then(function(){this.b&&er(this,0)}.bind(this));break;case"GET_STATUS":er(this,Number(e.requestId));break;case"VOLUME":n=e.volume,t=n.level,n=n.muted;var r=this.a.volume,i=this.a.muted;null!=t&&(this.a.volume=Number(t)),null!=n&&(this.a.muted=n),r==this.a.volume&&i==this.a.muted||er(this,0);break;case"LOAD":this.g=0,this.l=this.m=!1,t=e.media,n=e.currentTime,r=this.G(t.contentId),i=e.autoplay||!0,this.o(t.customData),i&&(this.a.autoplay=!0),this.b.load(r,n).then(function(){this.b&&Jn(this)}.bind(this))["catch"](function(t){var n="LOAD_FAILED";7==t.category&&7e3==t.code&&(n="LOAD_CANCELLED"),tr(this,{requestId:Number(e.requestId),type:n},this.i)}.bind(this));break;default:tr(this,{requestId:Number(e.requestId),type:"INVALID_REQUEST",reason:"INVALID_COMMAND"},this.i)}},ld.ce=function(t,e,n){this.b&&tr(this,{type:"asyncComplete",id:e,error:n},this.f,t)};var Eh={IDLE:"IDLE",ne:"PLAYING",ke:"BUFFERING",me:"PAUSED"},wh={$b:function(t,e){var n=wh.R(t,e);return 1!=n.length?null:n[0]},yd:function(t,e,n){return t=wh.zd(t,e,n),1!=t.length?null:t[0]},R:function(t,e){return Array.prototype.filter.call(t.childNodes,function(t){return t instanceof Element&&t.tagName==e})},zd:function(t,e,n){return Array.prototype.filter.call(t.childNodes,function(t){return t instanceof Element&&t.localName==n&&t.namespaceURI==e})},getAttributeNS:function(t,e,n){return t.hasAttributeNS(e,n)?t.getAttributeNS(e,n):null},cc:function(t){return Array.prototype.every.call(t.childNodes,function(t){return t.nodeType==Node.TEXT_NODE||t.nodeType==Node.CDATA_SECTION_NODE})?t.textContent.trim():null},J:function(t,e,n,r){r=void 0===r?null:r;var i=null;return t=t.getAttribute(e),null!=t&&(i=n(t)),null==i?r:i},vf:function(t){return t?(/^\d+-\d+-\d+T\d+:\d+:\d+(\.\d+)?$/.test(t)&&(t+="Z"),t=Date.parse(t),isNaN(t)?null:Math.floor(t/1e3)):null},Ba:function(t){return t&&(t=/^P(?:([0-9]*)Y)?(?:([0-9]*)M)?(?:([0-9]*)D)?(?:T(?:([0-9]*)H)?(?:([0-9]*)M)?(?:([0-9.]*)S)?)?$/.exec(t))?(t=31536e3*Number(t[1]||null)+2592e3*Number(t[2]||null)+86400*Number(t[3]||null)+3600*Number(t[4]||null)+60*Number(t[5]||null)+Number(t[6]||null),isFinite(t)?t:null):null},oc:function(t){var e=/([0-9]+)-([0-9]+)/.exec(t);return e?(t=Number(e[1]),isFinite(t)?(e=Number(e[2]),isFinite(e)?{start:t,end:e}:null):null):null},parseInt:function(t){return t=Number(t),0==t%1?t:null},nc:function(t){return t=Number(t),0==t%1&&0<t?t:null},vb:function(t){return t=Number(t),0==t%1&&0<=t?t:null},parseFloat:function(t){return t=Number(t),isNaN(t)?null:t},Ae:function(t){var e;return t=(e=t.match(/^(\d+)\/(\d+)$/))?Number(e[1])/Number(e[2]):Number(t),isNaN(t)?null:t},Ud:function(t,e){var n=new DOMParser;try{var r=n.parseFromString(t,"text/xml")}catch(a){}if(r&&r.documentElement.tagName==e)var i=r.documentElement;return i&&0<i.getElementsByTagName("parsererror").length?null:i},Td:function(t,e){try{var n=Ht(t);return wh.Ud(n,e)}catch(r){}}},Ah=(new Map).set("urn:uuid:1077efec-c0b2-4d02-ace3-3c1e52e2fb4b","org.w3.clearkey").set("urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed","com.widevine.alpha").set("urn:uuid:9a04f079-9840-4286-ab92-e65be0885f95","com.microsoft.playready").set("urn:uuid:f239e769-efa3-4850-9c16-a903c6932efb","com.adobe.primetime"),Sh=(new Map).set("com.widevine.alpha",function(t){return(t=wh.yd(t.node,"urn:microsoft","laurl"))?t.getAttribute("licenseUrl")||"":""}).set("com.microsoft.playready",function(t){return(t=wh.yd(t.node,"urn:microsoft:playready","pro"))?(t=Zt(t.textContent),(t=ir(t.buffer).filter(function(t){return 1===t.type})[0])?(t=Kt(t.value,!0),(t=wh.Ud(t,"WRMHEADER"))?ar(t):""):""):""});P("shaka.media.InitSegmentReference",mr),mr.prototype.Ac=function(){return this.c()},mr.prototype.createUris=mr.prototype.Ac,mr.prototype.Kc=function(){return this.b},mr.prototype.getStartByte=mr.prototype.Kc,mr.prototype.Jc=function(){return this.a},mr.prototype.getEndByte=mr.prototype.Jc,P("shaka.media.SegmentReference",gr),gr.prototype.ba=function(){return this.position},gr.prototype.getPosition=gr.prototype.ba,gr.prototype.Lc=function(){return this.startTime},gr.prototype.getStartTime=gr.prototype.Lc,gr.prototype.Ge=function(){return this.endTime},gr.prototype.getEndTime=gr.prototype.Ge,gr.prototype.Ac=function(){return this.c()},gr.prototype.createUris=gr.prototype.Ac,gr.prototype.Kc=function(){return this.b},gr.prototype.getStartByte=gr.prototype.Kc,gr.prototype.Jc=function(){return this.a},gr.prototype.getEndByte=gr.prototype.Jc,P("shaka.util.DataViewReader",vr);var Th=1;vr.Endianness={pg:0,qg:Th},vr.prototype.sa=function(){return this.a<this.K.byteLength},vr.prototype.hasMoreData=vr.prototype.sa,vr.prototype.ba=function(){return this.a},vr.prototype.getPosition=vr.prototype.ba,vr.prototype.Ie=function(){return this.K.byteLength},vr.prototype.getLength=vr.prototype.Ie,vr.prototype.ka=function(){try{var t=this.K.getUint8(this.a);return this.a+=1,t}catch(e){yr()}},vr.prototype.readUint8=vr.prototype.ka,vr.prototype.Lb=function(){try{var t=this.K.getUint16(this.a,this.b);return this.a+=2,t}catch(e){yr()}},vr.prototype.readUint16=vr.prototype.Lb,vr.prototype.F=function(){try{var t=this.K.getUint32(this.a,this.b);return this.a+=4,t}catch(e){yr()}},vr.prototype.readUint32=vr.prototype.F,vr.prototype.Yd=function(){try{var t=this.K.getInt32(this.a,this.b);return this.a+=4,t}catch(e){yr()}},vr.prototype.readInt32=vr.prototype.Yd,vr.prototype.yb=function(){try{if(this.b)var t=this.K.getUint32(this.a,!0),e=this.K.getUint32(this.a+4,!0);else e=this.K.getUint32(this.a,!1),t=this.K.getUint32(this.a+4,!1)}catch(n){yr()}if(2097151<e)throw new et(2,3,3001);return this.a+=8,e*Math.pow(2,32)+t},vr.prototype.readUint64=vr.prototype.yb,vr.prototype.Xa=function(t){this.a+t>this.K.byteLength&&yr();var e=new Uint8Array(this.K.buffer,this.K.byteOffset+this.a,t);return this.a+=t,new Uint8Array(e)},vr.prototype.readBytes=vr.prototype.Xa,vr.prototype.L=function(t){this.a+t>this.K.byteLength&&yr(),this.a+=t},vr.prototype.skip=vr.prototype.L,vr.prototype.ae=function(t){this.a<t&&yr(),this.a-=t},vr.prototype.rewind=vr.prototype.ae,vr.prototype.seek=function(t){(0>t||t>this.K.byteLength)&&yr(),this.a=t},vr.prototype.seek=vr.prototype.seek,vr.prototype.ad=function(){for(var t=this.a;this.sa()&&0!=this.K.getUint8(this.a);)this.a+=1;return t=new Uint8Array(this.K.buffer,this.K.byteOffset+t,this.a-t),this.a+=1,Ht(t)},vr.prototype.readTerminatedString=vr.prototype.ad,P("shaka.util.Mp4Parser",_r),_r.prototype.H=function(t,e){var n=Ar(t);return this.c[n]=0,this.b[n]=e,this},_r.prototype.box=_r.prototype.H,_r.prototype.ea=function(t,e){var n=Ar(t);return this.c[n]=1,this.b[n]=e,this},_r.prototype.fullBox=_r.prototype.ea,_r.prototype.stop=function(){this.a=!0},_r.prototype.stop=_r.prototype.stop,_r.prototype.parse=function(t,e){var n=new Uint8Array(t);for(n=new vr(new DataView(n.buffer,n.byteOffset,n.byteLength),0),this.a=!1;n.sa()&&!this.a;)this.mc(0,n,e)},_r.prototype.parse=_r.prototype.parse,_r.prototype.mc=function(t,e,n){var r=e.ba(),i=e.F(),a=e.F();switch(i){case 0:i=e.K.byteLength-r;break;case 1:i=e.yb()}var o=this.b[a];if(o){var s=null,u=null;1==this.c[a]&&(u=e.F(),s=u>>>24,u&=16777215),a=r+i,n&&a>e.K.byteLength&&(a=e.K.byteLength),a-=e.ba(),e=0<a?e.Xa(a):new Uint8Array(0),e=new vr(new DataView(e.buffer,e.byteOffset,e.byteLength),0),o({parser:this,partialOkay:n||!1,version:s,flags:u,reader:e,size:i,start:r+t})}else e.L(Math.min(r+i-e.ba(),e.K.byteLength-e.ba()))},_r.prototype.parseNext=_r.prototype.mc,_r.children=br,_r.sampleDescription=Er,_r.allData=wr,_r.typeToString=Sr,P("shaka.media.SegmentIndex",kr),kr.prototype.destroy=function(){return this.a=null,Promise.resolve()},kr.prototype.destroy=kr.prototype.destroy,kr.prototype.find=function(t){for(var e=this.a.length-1;0<=e;--e){var n=this.a[e];if(t>=n.startTime&&t<n.endTime)return n.position}return this.a.length&&t<this.a[0].startTime?this.a[0].position:null},kr.prototype.find=kr.prototype.find,kr.prototype.get=function(t){return 0==this.a.length?null:(t-=this.a[0].position,0>t||t>=this.a.length?null:this.a[t])},kr.prototype.get=kr.prototype.get,kr.prototype.offset=function(t){for(var e=0;e<this.a.length;++e)this.a[e].startTime+=t,this.a[e].endTime+=t},kr.prototype.offset=kr.prototype.offset,kr.prototype.Sc=function(t){for(var e=[],n=0,r=0;n<this.a.length&&r<t.length;){var i=this.a[n],a=t[r];i.startTime<a.startTime?(e.push(i),n++):(i.startTime>a.startTime?0==n&&e.push(a):(.1<Math.abs(i.endTime-a.endTime)?e.push(new gr(i.position,a.startTime,a.endTime,a.c,a.b,a.a)):e.push(i),n++),r++)}for(;n<this.a.length;)e.push(this.a[n++]);if(e.length)for(n=e[e.length-1].position+1;r<t.length;)i=t[r++],i=new gr(n++,i.startTime,i.endTime,i.c,i.b,i.a),e.push(i);else e=t;this.a=e},kr.prototype.merge=kr.prototype.Sc,kr.prototype.Dc=function(t){for(var e=0;e<this.a.length;++e)if(this.a[e].endTime>t)return void this.a.splice(0,e);this.a=[]},kr.prototype.evict=kr.prototype.Dc;var xh;Mr.prototype.sa=function(){return this.a.sa()},Or.prototype.parse=function(t,e,n,r){var i;if(e=new Mr(new DataView(e)),440786851!=Rr(e).id)throw new et(2,3,3008);var a=Rr(e);if(408125543!=a.id)throw new et(2,3,3009);for(e=a.a.byteOffset,a=new Mr(a.a),i=null;a.sa();){var o=Rr(a);if(357149030==o.id){i=o;break}}if(!i)throw new et(2,3,3010);for(a=new Mr(i.a),i=1e6,o=null;a.sa();){var s=Rr(a);if(2807729==s.id)i=Pr(s);else if(17545==s.id)if(o=s,4==o.a.byteLength)o=o.a.getFloat32(0);else{if(8!=o.a.byteLength)throw new et(2,3,3003);o=o.a.getFloat64(0)}}if(null==o)throw new et(2,3,3011);if(a=i/1e9,i=o*a,t=Rr(new Mr(new DataView(t))),475249515!=t.id)throw new et(2,3,3007);return Dr(t,e,a,i,n,r)};var kh={wb:{},Kb:{},dd:function(t,e){kh.Kb[t]=e}};P("shaka.media.ManifestParser.registerParserByExtension",kh.dd),kh.Mb=function(t,e){kh.wb[t]=e},P("shaka.media.ManifestParser.registerParserByMime",kh.Mb),kh.Af=function(){var t={};if(jt()){for(var e in kh.wb)t[e]=!0;for(var n in kh.Kb)t[n]=!0}e={mpd:"application/dash+xml",m3u8:"application/x-mpegurl",ism:"application/vnd.ms-sstr+xml"},n=s(["application/dash+xml","application/x-mpegurl","application/vnd.apple.mpegurl","application/vnd.ms-sstr+xml"]);for(var r=n.next();!r.done;r=n.next())r=r.value,t[r]=jt()?!!kh.wb[r]:Vt(r);for(var i in e)t[i]=jt()?!!kh.Kb[i]:Vt(e[i]);return t},kh.create=function(t,e,n,r){return c(function i(){var a,o;return k(i,function(i){switch(i.j){case 1:return g(i,2),p(i,kh.He(t,e,n,r),4);case 4:return a=i.s,i["return"](new a);case 2:throw o=_(i),o.severity=2,o}})})},kh.He=function(t,e,n,r){return c(function i(){var a,o,s,u,l;return k(i,function(i){switch(i.j){case 1:if(a=kh,r&&(o=a.wb[r.toLowerCase()]))return i["return"](o);if((s=a.getExtension(t))&&(u=a.Kb[s]))return i["return"](u);if(r){i.A(2);break}return p(i,a.Oe(t,e,n),3);case 3:if((r=i.s)&&(l=kh.wb[r]))return i["return"](l);case 2:throw new et(2,4,4e3,t)}})})},kh.Oe=function(t,e,n){return c(function r(){var i,a,o;return k(r,function(r){switch(r.j){case 1:return i=wt([t],n),i.method="HEAD",p(r,e.request(0,i).promise,2);case 2:return a=r.s,o=a.headers["content-type"],r["return"](o?o.toLowerCase():"")}})})},kh.getExtension=function(t){return t=new G(t).ia.split("/").pop().split("."),1==t.length?"":t.pop().toLowerCase()},kh.isSupported=function(t,e){return!!jt()&&(e in kh.wb||kh.getExtension(t)in kh.Kb)},P("shaka.media.PresentationTimeline",$r),$r.prototype.Y=function(){return this.g},$r.prototype.getDuration=$r.prototype.Y,$r.prototype.wa=function(t){this.g=t},$r.prototype.setDuration=$r.prototype.wa,$r.prototype.Te=function(){return this.f},$r.prototype.getPresentationStartTime=$r.prototype.Te,$r.prototype.de=function(t){this.l=t},$r.prototype.setClockOffset=$r.prototype.de,$r.prototype.Qb=function(t){this.m=t},$r.prototype.setStatic=$r.prototype.Qb,$r.prototype.ld=function(t){this.h=t},$r.prototype.setSegmentAvailabilityDuration=$r.prototype.ld,$r.prototype.Qf=function(t){this.pc=t},$r.prototype.setDelay=$r.prototype.Qf,$r.prototype.Fe=function(){return this.pc},$r.prototype.getDelay=$r.prototype.Fe,$r.prototype.sb=function(t,e){if(0!=t.length){var n=t[t.length-1].endTime+e;this.Vc(t[0].startTime+e),this.a=t.reduce(function(t,e){return Math.max(t,e.endTime-e.startTime)},this.a),this.b=Math.max(this.b,n),null!=this.f&&this.o&&(this.f=(Date.now()+this.l)/1e3-this.b-this.a)}},$r.prototype.notifySegments=$r.prototype.sb,$r.prototype.Vc=function(t){this.c=null==this.c?t:Math.min(this.c,t)},$r.prototype.notifyMinSegmentStartTime=$r.prototype.Vc,$r.prototype.Uc=function(t){this.a=Math.max(this.a,t)},$r.prototype.notifyMaxSegmentDuration=$r.prototype.Uc,$r.prototype.offset=function(t){null!=this.c&&(this.c+=t),null!=this.b&&(this.b+=t)},$r.prototype.offset=$r.prototype.offset,$r.prototype.V=function(){return 1/0==this.g&&!this.m},$r.prototype.isLive=$r.prototype.V,$r.prototype.Va=function(){return 1/0!=this.g&&!this.m},$r.prototype.isInProgress=$r.prototype.Va,$r.prototype.Gb=function(){if(1/0==this.h)return this.i;var t=this.nb()-this.h;return Math.max(this.i,t)},$r.prototype.getSegmentAvailabilityStart=$r.prototype.Gb,$r.prototype.ee=function(t){this.i=t},$r.prototype.setUserSeekStart=$r.prototype.ee,$r.prototype.nb=function(){return this.V()||this.Va()?Math.min(Math.max(0,(Date.now()+this.l)/1e3-this.a-this.f),this.g):this.g},$r.prototype.getSegmentAvailabilityEnd=$r.prototype.nb,$r.prototype.Fb=function(t){var e=Math.max(this.c,this.i);if(1/0==this.h)return e;var n=this.nb()-this.h;return t=Math.min(n+t,this.za()),Math.max(e,t)},$r.prototype.getSafeSeekRangeStart=$r.prototype.Fb,$r.prototype.mb=function(){return this.Fb(0)},$r.prototype.getSeekRangeStart=$r.prototype.mb,$r.prototype.za=function(){var t=this.V()||this.Va()?this.pc:0;return Math.max(0,this.nb()-t)},$r.prototype.getSeekRangeEnd=$r.prototype.za,$r.prototype.ie=function(){return null!=this.f&&null==this.b},$r.prototype.usingPresentationStartTime=$r.prototype.ie,P("shaka.dash.DashParser",Qr),ld=Qr.prototype,ld.configure=function(t){this.b=t},ld.start=function(t,e){var n=this;return c(function r(){var i;return k(r,function(r){switch(r.j){case 1:return n.f=[t],n.a=e,p(r,Jr(n),2);case 2:if(i=r.s,n.a&&oi(n,i),!n.a)throw new et(2,7,7001);return r["return"](n.c)}})})},ld.stop=function(){return this.b=this.a=null,this.f=[],this.c=null,this.l=[],this.m={},null!=this.i&&(this.i.stop(),this.i=null),this.g.destroy()},ld.update=function(){Jr(this)["catch"](function(t){this.a&&this.a.onError(t)}.bind(this))},ld.onExpirationUpdated=function(){},ld.uf=function(t,e){t.ca=si(e,t.ja,null);var n=!1,r=wh.R(e,"Role"),i=r.map(function(t){return t.getAttribute("value")}).filter(Bd.Ga),a=void 0,o="text"==t.ca.contentType;o&&(a="subtitle");for(var u=0;u<r.length;u++){var l=r[u].getAttribute("schemeIdUri");if(null==l||"urn:mpeg:dash:role:2011"==l)switch(l=r[u].getAttribute("value")){case"main":n=!0;break;case"caption":case"subtitle":a=l}}var c=null,d=!1;wh.R(e,"EssentialProperty").forEach(function(t){"http://dashif.org/guidelines/trickmode"==t.getAttribute("schemeIdUri")?c=t.getAttribute("value"):d=!0}),u=wh.R(e,"Accessibility");var h=new Map;for(r={},u=s(u),l=u.next();!l.done;r={Db:r.Db},l=u.next()){l=l.value;var f=l.getAttribute("schemeIdUri");"urn:scte:dash:cc:cea-608:2015"!=f&&"urn:scte:dash:cc:cea-708:2015"!=f||(r.Db=1,l=l.getAttribute("value"),null!=l?l.split(";").forEach(function(t){return function(e){if(e.includes("=")){e=e.split("=");var n=e[0].startsWith("CC")?e[0]:"CC"+e[0];e=e[1].split(",")[0].split(":").pop()}else n="CC"+t.Db,t.Db+=2;h.set(n,pn(e))}}(r)):h.set("CC1","und"))}if(d)return null;r=wh.R(e,"ContentProtection");var p=nr(r,this.b.dash.customScheme,this.b.dash.ignoreDrmInfo);if(r=pn(e.getAttribute("lang")||"und"),l=e.getAttribute("label"),u=wh.R(e,"Representation"),i=u.map(this.xf.bind(this,t,p,a,r,l,n,i,h)).filter(function(t){return!!t}),0==i.length){if(o)return null;throw new et(2,4,4003)}return t.ca.contentType&&"application"!=t.ca.contentType||(t.ca.contentType=hi(i[0].mimeType,i[0].codecs),i.forEach(function(e){e.type=t.ca.contentType})),i.forEach(function(t){p.drmInfos.forEach(function(e){t.keyId&&e.keyIds.push(t.keyId)})}),o=u.map(function(t){return t.getAttribute("id")}).filter(Bd.Ga),{id:t.ca.id||"__fake__"+this.h++,contentType:t.ca.contentType,language:r,Qc:n,streams:i,drmInfos:p.drmInfos,pd:c,Gf:o}},ld.xf=function(t,e,n,r,i,a,o,s,u){if(t.B=si(u,t.ca,null),!li(t.B))return null;t.bandwidth=wh.J(u,"bandwidth",wh.nc)||0;var l=t.B.contentType;l="text"==l||"application"==l;try{var c=this.Hf.bind(this);if(t.B.Nb)var d=Fr(t,c);else if(t.B.Ja)d=Vr(t,this.m);else if(t.B.Pb)d=Kr(t,c,this.m,!!this.c);else{var h=t.B.oa,f=t.S.duration||0;d={createSegmentIndex:Promise.resolve.bind(Promise),findSegmentPosition:function(t){return 0<=t&&t<f?1:null},getSegmentReference:function(t){return 1!=t?null:new gr(1,0,f,function(){return h},0,null)},initSegmentReference:null,la:0}}}catch(p){if(l&&4002==p.code)return null;throw p}return u=wh.R(u,"ContentProtection"),u=rr(u,this.b.dash.customScheme,e,this.b.dash.ignoreDrmInfo),{id:this.h++,originalId:t.B.id,createSegmentIndex:d.createSegmentIndex,findSegmentPosition:d.findSegmentPosition,getSegmentReference:d.getSegmentReference,initSegmentReference:d.initSegmentReference,presentationTimeOffset:d.la,mimeType:t.B.mimeType,codecs:t.B.codecs,frameRate:t.B.frameRate,bandwidth:t.bandwidth,width:t.B.width,height:t.B.height,kind:n,encrypted:0<e.drmInfos.length,keyId:u,language:r,label:i,type:t.ca.contentType,primary:a,trickModeVideo:null,emsgSchemeIdUris:t.B.emsgSchemeIdUris,roles:o,channelsCount:t.B.Wc,closedCaptions:s}},ld.wf=function(t,e,n){var r=wh.vb,i=n.getAttribute("schemeIdUri")||"",a=n.getAttribute("value")||"",o=wh.J(n,"timescale",r)||1;wh.R(n,"Event").forEach(function(n){var s=wh.J(n,"presentationTime",r)||0,u=wh.J(n,"duration",r)||0;s=s/o+t,u=s+u/o,null!=e&&(s=Math.min(s,t+e),u=Math.min(u,t+e)),n={schemeIdUri:i,value:a,startTime:s,endTime:u,id:n.getAttribute("id")||"",eventElement:n},this.a.onTimelineRegionAdded(n)}.bind(this))},ld.Hf=function(t,e,n){return t=Zr(t,e,n,this.b.retryParameters),t=this.a.networkingEngine.request(1,t),_t(this.g,t),t.promise.then(function(t){return t.data})},kh.dd("mpd",Qr),kh.Mb("application/dash+xml",Qr),pi.prototype.toString=function(){function t(t){return t.name+"="+(isNaN(Number(t.value))?'"'+t.value+'"':t.value)}var e="#"+this.name,n=this.a?this.a.map(t):[];return this.value&&n.unshift(this.value),0<n.length&&(e+=":"+n.join(",")),e},pi.prototype.getAttribute=function(t){var e=this.a.filter(function(e){return e.name==t});return e.length?e[0]:null};var Ch={lb:function(t,e){return t.filter(function(t){return t.name==e})},Ra:function(t,e){var n=Ch.lb(t,e);return n.length?n[0]:null},Gc:function(t,e,n){return t.filter(function(t){var r=t.getAttribute("TYPE");return t=t.getAttribute("GROUP-ID"),r.value==e&&t.value==n})},zc:function(t,e){return Be([t],[e])[0]},Oc:function(t){return/^#(?!EXT)/m.test(t)}},Mh="EXT-X-TARGETDURATION EXT-X-MEDIA-SEQUENCE EXT-X-DISCONTINUITY-SEQUENCE EXT-X-PLAYLIST-TYPE EXT-X-MAP EXT-X-I-FRAMES-ONLY EXT-X-ENDLIST".split(" "),Rh="EXTINF EXT-X-BYTERANGE EXT-X-DISCONTINUITY EXT-X-PROGRAM-DATE-TIME EXT-X-KEY EXT-X-DATERANGE".split(" ");P("shaka.net.DataUriPlugin",xi),xi.parse=function(e){var n=e.split(":");if(2>n.length||"data"!=n[0])throw new et(2,1,1004,e);if(n=n.slice(1).join(":").split(","),2>n.length)throw new et(2,1,1004,e);var r=n[0];n=t.decodeURIComponent(n.slice(1).join(",")),r=r.split(";");var i=null;if(1<r.length&&(i=r[1]),"base64"==i)e=Zt(n).buffer;else{if(i)throw new et(2,1,1005,e);e=Wt(n)}return{data:e,contentType:r[0]}},Et("data",xi),P("shaka.hls.HlsParser",ki),ld=ki.prototype,ld.configure=function(t){this.c=t},ld.start=function(t,e){var n=this;return c(function r(){var i,a;return k(r,function(r){switch(r.j){case 1:return n.g=e,p(r,na(n,t),2);case 2:return i=r.s,n.v=i.uri,p(r,Mi(n,i.data),3);case 3:return a=n.P,0<a&&n.h.O(a),r["return"](n.m)}})})},ld.stop=function(){this.h&&(this.h.stop(),this.h=null);var t=[];return this.i&&(t.push(this.i.destroy()),this.i=null),this.c=this.g=null,this.D.clear(),this.T.clear(),this.a.clear(),this.m=null,Promise.all(t)},ld.update=function(){if(this.f!=Dh.Oa){for(var t=[],e=s(this.a.values()),n=e.next();!n.done;n=e.next())t.push(Ci(this,n.value));return Promise.all(t)}},ld.onExpirationUpdated=function(){};var Lh={audio:[/^vorbis$/,/^opus$/,/^flac$/,/^mp4a/,/^[ae]c-3$/],video:[/^avc/,/^hev/,/^hvc/,/^vp0?[89]/,/^av1$/],text:[/^vtt$/,/^wvtt/,/^stpp/]},Ih={audio:{mp4:"audio/mp4",m4s:"audio/mp4",m4i:"audio/mp4",m4a:"audio/mp4",ts:"video/mp2t"},video:{mp4:"video/mp4",m4s:"video/mp4",m4i:"video/mp4",m4v:"video/mp4",ts:"video/mp2t"},text:{mp4:"application/mp4",m4s:"application/mp4",m4i:"application/mp4",vtt:"text/vtt",ttml:"application/ttml+xml"}},Ph={"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed":function(t){var e=ta(t,"METHOD");return Dn("HLS SAMPLE-AES-CENC","SAMPLE-AES-CENC will no longer be supported, see Issue #1227"),["SAMPLE-AES","SAMPLE-AES-CTR","SAMPLE-AES-CENC"].includes(e)?(e=ta(t,"URI"),e=xi.parse(e),e=new Uint8Array(e.data),e=je("com.widevine.alpha",[{initDataType:"cenc",initData:e}]),(t=gi(t,"KEYID"))&&(e.keyIds=[t.substr(2).toLowerCase()]),e):null}},Oh="VOD",Dh={Oa:Oh,le:"EVENT",sd:"LIVE"};kh.dd("m3u8",ki),kh.Mb("application/x-mpegurl",ki),kh.Mb("application/vnd.apple.mpegurl",ki),ca.prototype.add=function(t){return!!da(this.a,t)&&(this.b.add(t),!0)},ca.prototype.values=function(){return this.b.values()},pa.prototype.create=function(t){var e=this,n=t.filter(function(t){return da(e.a,t)});return n.length?new ca(n[0],n):this.b.create(t)},ma.prototype.create=function(t){var e=[];e=ga(t,this.c);var n=t.filter(function(t){return t.primary});for(e=e.length?e:n.length?n:t,this.b&&(t=va(e,this.b),t.length&&(e=t)),this.a&&(t=kn(e,this.a),t.length&&(e=t)),t=new ca(e[0]),e=s(e),n=e.next();!n.done;n=e.next())n=n.value,da(t.a,n)&&t.add(n);return t};var Nh=0,Uh=1;_a.prototype.release=function(){this.f=null,this.a=function(){}},Aa.prototype.release=function(){this.f&&(this.f.release(),this.f=null),null!=this.g&&(this.g.stop(),this.g=null),this.b&&(this.b.release(),this.b=null),this.a=this.v=this.l=null},Aa.prototype.Yc=function(){this.h=!0,Sa(this)},Ta.prototype.release=function(){this.b.stop();for(var t=s(this.a),e=t.next();!e.done;e=t.next())e.value.release();this.a.clear()},Ma.prototype.release=function(){this.a=this.c=null,this.b=function(){}},Ma.prototype.g=function(t){var e=this.a,n=this.c.periods;t=Ca(n,t)||n[0],e!=t&&this.b(t),this.a=t},La.prototype.release=function(){this.b&&(this.b.stop(),this.b=null),this.a=null},La.prototype.set=function(t){this.c=t,Ia(this)},Pa.prototype.release=function(){this.b&&(this.b.release(),this.b=null),null!=this.c&&(this.c.release(),this.c=null),this.f=function(){},this.a=null},Fa.prototype.release=function(){this.a&&(this.a.stop(),this.a=null),this.b=null},ja.prototype.release=function(){this.c&&(this.c.release(),this.c=null),this.a=null},ja.prototype.m=function(t){this.b=this.f?this.b:t},ja.prototype.h=function(){return(this.f?this.a.currentTime:this.b)||0},ja.prototype.o=function(){},Va.prototype.release=function(){this.c&&(this.c.release(),this.c=null),this.f&&(this.f.release(),this.f=null),this.i&&(this.i.stop(),this.i=null),this.b=this.c=this.a=this.g=null,this.v=function(){}},Va.prototype.m=function(t){var e=this.c;0<e.a.readyState?Ba(e.c,t):Da(e,t)},Va.prototype.h=function(){var t=Oa(this.c);return 0<this.b.readyState&&!this.b.paused?Ka(this,t):t},Va.prototype.o=function(){this.f.Yc()},Wa.prototype.release=function(){this.b=function(){},this.a.clear()},Xa.prototype.release=function(){this.h=null,this.f.clear(),this.a=function(){},this.b=function(){},this.c=function(){}},Xa.prototype.g=function(t,e){for(var n=s(this.h.a),r=n.next();!r.done;r=n.next()){r=r.value;var i=this.f.get(r),a=t<r.startTime?Fh:t>r.endTime?jh:Bh;this.f.set(r,a);for(var o=s(this.i),u=o.next();!u.done;u=o.next())u=u.value,u.bb==i&&u.ab==a&&u.Ua(r,e)}};var Fh=1,Bh=2,jh=3;Za.prototype.destroy=function(){for(var t=s(this.b.values()),e=t.next();!e.done;e=t.next())Io(e.value);return this.b.clear(),this.i.clear(),this.g=this.h=this.v=this.c=this.a=null,this.f=!0,Promise.resolve()},Za.prototype.configure=function(t){this.g=t,this.G=new Q({maxAttempts:Math.max(t.retryParameters.maxAttempts,2),baseDelay:t.retryParameters.baseDelay,backoffFactor:t.retryParameters.backoffFactor,fuzzFactor:t.retryParameters.fuzzFactor,timeout:0},!0)},Za.prototype.start=function(){var t=this;return c(function e(){var n,r,i;return k(e,function(e){switch(e.j){case 1:return n=t.a.Sa(),r=ko(t,n),i=t.a.Md(t.c.periods[r]),i.variant||i.text?p(e,uo(t,i.variant?i.variant.audio:null,i.variant?i.variant.video:null,i.text,n),2):e["return"](new et(2,5,5005));case 2:if(t.f)return e["return"]();t.a&&t.a.gf&&t.a.gf(),m(e)}})})},Za.prototype.M=function(t,e,n,r){var i=r.reader.ad(),a=r.reader.ad(),o=r.reader.F(),s=r.reader.F(),u=r.reader.F(),l=r.reader.F();r=r.reader.Xa(r.reader.K.byteLength-r.reader.ba()),t=t.startTime+e.startTime+s/o,n.includes(i)&&("urn:mpeg:dash:event:2012"==i?this.a.hf():this.a.onEvent(new ct("emsg",{detail:{startTime:t,endTime:t+u/o,schemeIdUri:i,value:a,timescale:o,presentationTimeDelta:s,eventDuration:u,id:l,messageData:r}})))},P("shaka.net.HttpFetchPlugin",Do),Do.l=function(t,e,n,r,i){return c(function a(){var o,s,u,l,d,h,f,v,b,E,w,A,S,T;return k(a,function(a){switch(a.j){case 1:return o=Do.g,s=Do.c,h=d=0,f=Date.now(),g(a,2),p(a,o(t,n),4);case 4:return u=a.s,v=u.clone().body.getReader(),E=(b=u.headers.get("Content-Length"))?parseInt(b,10):0,w=function(t){function e(){return c(function n(){var r,a;return k(n,function(n){switch(n.j){case 1:return g(n,2),p(n,v.read(),4);case 4:r=n.s,y(n,3);break;case 2:return _(n),n["return"]();case 3:r.done||(d+=r.value.byteLength),a=Date.now(),(100<a-f||r.done)&&(i(a-f,d-h,E-d),h=d,f=a),r.done?t.close():(t.enqueue(r.value),e()),m(n)}})})}e()},new s({start:w}),p(a,u.arrayBuffer(),5);case 5:l=a.s,y(a,3);break;case 2:if(A=_(a),r.ud)throw new et(1,1,7001,t,e);if(r.he)throw new et(1,1,1003,t,e);throw new et(1,1,1002,t,A,e);case 3:return S={},T=u.headers,T.forEach(function(t,e){S[e.trim()]=t}),a["return"](Oo(S,l,u.status,t,u.url,e))}})})},Do.isSupported=function(){if(!t.ReadableStream)return!1;try{new ReadableStream({})}catch(hf){return!1}return!(!t.fetch||!t.AbortController)},Do.isSupported=Do.isSupported,Do.g=t.fetch,Do.a=t.AbortController,Do.c=t.ReadableStream,Do.b=t.Headers,Do.isSupported()&&(Et("http",Do,2),Et("https",Do,2)),P("shaka.net.HttpXHRPlugin",No),No.f=t.XMLHttpRequest,Et("http",No,1),Et("https",No,1),Uo.prototype.close=function(t,e){if(this.c.has(t)){var n=this.c.get(t);this.c["delete"](t),this.f+=n,this.a+=e}},Bo.prototype.destroy=function(){return this.c=!0,Promise.all(this.b.values()).then(function(){},function(){})},zo.prototype.abort=function(){try{this.c.abort()}catch(hf){}return this.a["catch"](function(){})},zo.prototype.store=function(){return this.b},zo.prototype.promise=function(){return this.a},Ko.prototype.destroy=function(){return Promise.all(this.a.map(function(t){return t.abort()}))},Xo.prototype.destroy=function(){return this.a.destroy()},Xo.prototype.getAll=function(){var t=this;return c(function e(){var n,r;return k(e,function(e){switch(e.j){case 1:return n=Yo(t.a,"session-ids"),r=[],p(e,Ho(n,function(t,e){r.push(e)}),2);case 2:return p(e,n.promise(),3);case 3:return e["return"](r)}})})},Xo.prototype.add=function(t){var e=Wo(this.a,"session-ids"),n=e.store();t=s(t);for(var r=t.next();!r.done;r=t.next())n.add(r.value);return e.promise()},Xo.prototype.remove=function(t){var e=this;return c(function n(){var r;return k(n,function(n){switch(n.j){case 1:return r=Wo(e.a,"session-ids"),p(n,Ho(r,function(e,n,r){0<=t.indexOf(n.sessionId)&&r["delete"]()}),2);case 2:return p(n,r.promise(),0)}})})},$o.prototype.destroy=function(){for(var t=[],e=s(this.a.values()),n=e.next();!n.done;n=e.next())t.push(n.value.destroy());return this.a.clear(),Promise.all(t)},$o.prototype.init=function(){var t=this;Vh.forEach(function(e,n){var r=e();r&&t.a.set(n,r)});for(var e=[],n=s(this.a.values()),r=n.next();!r.done;r=n.next())e.push(r.value.init());return Promise.all(e)},$o.prototype.erase=function(){var t=this;return c(function e(){var n,r,i;return k(e,function(e){switch(e.j){case 1:return n=Array.from(t.a.values()),r=0<n.length,r||(i=Vh,i.forEach(function(t){(t=t())&&n.push(t)})),p(e,Promise.all(n.map(function(t){return t.erase()})),2);case 2:if(!r)return p(e,Promise.all(n.map(function(t){return t.destroy()})),0);e.A(0)}})})},P("shaka.offline.StorageMuxer.register",ns),P("shaka.offline.StorageMuxer.unregister",function(t){Vh["delete"](t)});var Vh=new Map;ld=rs.prototype,ld.destroy=function(){return this.a.destroy()},ld.hasFixedKeySpace=function(){return!0},ld.addSegments=function(){return is("segment")},ld.removeSegments=function(t,e){return as(this,"segment",t,e)},ld.getSegments=function(t){return os(this,"segment",t).then(function(t){return t.map(ds)})},ld.addManifests=function(){return is("manifest")},ld.updateManifestExpiration=function(t,e){var n=Wo(this.a,"manifest"),r=n.store(),i=new nt;return r.get(t).onsuccess=function(n){(n=n.target.result)?(n.expiration=e,r.put(n),i.resolve()):i.reject(new et(2,9,9012,"Could not find values for "+t))},n.promise().then(function(){return i})},ld.removeManifests=function(t,e){return as(this,"manifest",t,e)},ld.getManifests=function(t){return os(this,"manifest",t).then(function(t){return t.map(ss)})},ld.getAllManifests=function(){var t=this;return c(function e(){var n,r;return k(e,function(e){switch(e.j){case 1:return n=Yo(t.a,"manifest"),r=new Map,p(e,Ho(n,function(t,e){r.set(t,ss(e))}),2);case 2:return p(e,n.promise(),3);case 3:return e["return"](r)}})})},ld=ps.prototype,ld.destroy=function(){return this.a.destroy()},ld.hasFixedKeySpace=function(){return this.f},ld.addSegments=function(t){return ms(this,this.c,t)},ld.removeSegments=function(t,e){return gs(this,this.c,t,e)},ld.getSegments=function(t){return vs(this,this.c,t)},ld.addManifests=function(t){return ms(this,this.b,t)},ld.updateManifestExpiration=function(t,e){var n=Wo(this.a,this.b),r=n.store();return r.get(t).onsuccess=function(n){(n=n.target.result)&&(n.expiration=e,r.put(n,t))},n.promise()},ld.removeManifests=function(t,e){return gs(this,this.b,t,e)},ld.getManifests=function(t){return vs(this,this.b,t)},ld.getAllManifests=function(){var t=this;return c(function e(){var n,r;return k(e,function(e){switch(e.j){case 1:return n=Yo(t.a,t.b),r=new Map,p(e,Ho(n,function(t,e){r.set(t,e)}),2);case 2:return p(e,n.promise(),3);case 3:return e["return"](r)}})})},ld=ys.prototype,ld.init=function(){var e=this,n=new nt,r=t.indexedDB.open("shaka_offline_db",4);return r.onsuccess=function(t){t=t.target.result,e.f=t;var r=t.objectStoreNames;r=r.contains("manifest")&&r.contains("segment")?new rs(t):null,e.a=r,r=t.objectStoreNames,r=r.contains("manifest-v2")&&r.contains("segment-v2")?new ps(t,"segment-v2","manifest-v2",!0):null,e.b=r,r=t.objectStoreNames,r=r.contains("manifest-v3")&&r.contains("segment-v3")?new ps(t,"segment-v3","manifest-v3",!1):null,e.c=r,t=t.objectStoreNames.contains("session-ids")?new Xo(t):null,e.g=t,n.resolve()},r.onupgradeneeded=function(t){t=t.target.result;for(var e=s(["segment-v3","manifest-v3","session-ids"]),n=e.next();!n.done;n=e.next())n=n.value,t.objectStoreNames.contains(n)||t.createObjectStore(n,{autoIncrement:!0})},r.onerror=function(t){n.reject(new et(2,9,9001,r.error)),t.preventDefault()},n},ld.destroy=function(){var t=this;return c(function e(){return k(e,function(e){switch(e.j){case 1:if(!t.a){e.A(2);break}return p(e,t.a.destroy(),2);case 2:if(!t.b){e.A(4);break}return p(e,t.b.destroy(),4);case 4:if(!t.c){e.A(6);break}return p(e,t.c.destroy(),6);case 6:if(!t.g){e.A(8);break}return p(e,t.g.destroy(),8);case 8:t.f&&t.f.close(),m(e)}})})},ld.getCells=function(){var t=new Map;return this.a&&t.set("v1",this.a),this.b&&t.set("v2",this.b),this.c&&t.set("v3",this.c),t},ld.getEmeSessionCell=function(){return this.g},ld.erase=function(){var t=this;return c(function e(){return k(e,function(e){switch(e.j){case 1:if(!t.a){e.A(2);break}return p(e,t.a.destroy(),2);case 2:if(!t.b){e.A(4);break}return p(e,t.b.destroy(),4);case 4:if(!t.c){e.A(6);break}return p(e,t.c.destroy(),6);case 6:return t.f&&t.f.close(),p(e,_s(),8);case 8:return t.f=null,t.a=null,t.b=null,t.c=null,p(e,t.init(),0)}})})},ns("idb",function(){return t.indexedDB?new ys:null}),bs.prototype.ua=function(){return this.g},bs.prototype.aa=function(){return this.f},bs.prototype.key=function(){return this.c},bs.prototype.toString=function(){return this.b},ld=Ms.prototype,ld.configure=function(){},ld.start=function(t){var e=this;return c(function n(){var r,i,a,o,s,u;return k(n,function(n){switch(n.j){case 1:return r=Es(t),(e.a=r,null==r||"manifest"!=r.a)?n["return"](Promise.reject(new et(2,1,9004,r))):(i=new $o,v(n,2),p(n,i.init(),4));case 4:return p(n,Jo(i,r.ua(),r.aa()),5);case 5:return a=n.s,p(n,a.getManifests([r.key()]),6);case 6:return o=n.s,s=o[0],u=new ws(r.ua(),r.aa()),n["return"](As(u,s));case 2:return b(n),p(n,i.destroy(),7);case 7:E(n,0)}})})},ld.stop=function(){return Promise.resolve()},ld.update=function(){},ld.onExpirationUpdated=function(t,e){var n=this;return c(function r(){var i,a,o,s,u,l,c;return k(r,function(r){switch(r.j){case 1:return i=n.a,a=new $o,g(r,2,3),p(r,a.init(),5);case 5:return p(r,Jo(a,i.ua(),i.aa()),6);case 6:return o=r.s,p(r,o.getManifests([i.key()]),7);case 7:if(s=r.s,u=s[0],l=u.sessionIds.includes(t),c=void 0==u.expiration||u.expiration>e,!l||!c){r.A(3);break}return p(r,o.updateManifestExpiration(i.key(),e),3);case 3:return b(r),p(r,a.destroy(),10);case 10:E(r,0);break;case 2:_(r),r.A(3)}})})},kh.Mb("application/x-offline-manifest",Ms),P("shaka.offline.OfflineScheme",Rs),Rs.h=function(t){return t={uri:t,$c:t,data:new ArrayBuffer(0),headers:{"content-type":"application/x-offline-manifest"}},ot(t)},Rs.i=function(t,e){var n=new $o;return ot(void 0).U(function(){return n.init()}).U(function(){return Jo(n,e.ua(),e.aa())}).U(function(t){return t.getSegments([e.key()])}).U(function(t){return{uri:e,$c:e,data:t[0].data,headers:{}}})["finally"](function(){return n.destroy()})},Et("offline",Rs),Os.prototype.destroy=function(){var t=this;return c(function e(){var n;return k(e,function(e){switch(e.j){case 1:return t.l=!1,t.b&&t.b.abort(),Fs(t),p(e,t.m,2);case 2:t.a&&t.a.ta.Wa();for(var r=s(t.f),i=r.next();!i.done;i=r.next())n=i.value,n.ta.Wa();t.a=null,t.f=[],t.g=null,m(e)}})})},P("shaka.text.SimpleTextDisplayer",Bs),Bs.prototype.remove=function(t,e){return!!this.a&&(Vs(this.a,function(n){return n.startTime<e&&n.endTime>t}),!0)},Bs.prototype.remove=Bs.prototype.remove,Bs.prototype.append=function(t){for(var e=js,n=[],r=0;r<t.length;r++){var i=e(t[r]);i&&n.push(i)}n.slice().sort(function(t,e){return t.startTime!=e.startTime?t.startTime-e.startTime:t.endTime!=e.endTime?t.endTime-e.startTime:n.indexOf(e)-n.indexOf(t)}).forEach(function(t){this.a.addCue(t)}.bind(this))},Bs.prototype.append=Bs.prototype.append,Bs.prototype.destroy=function(){return this.a&&Vs(this.a,function(){return!0}),this.a=null,Promise.resolve()},Bs.prototype.destroy=Bs.prototype.destroy,Bs.prototype.isTextVisible=function(){return"showing"==this.a.mode},Bs.prototype.isTextVisible=Bs.prototype.isTextVisible,Bs.prototype.setTextVisibility=function(t){this.a.mode=t?"showing":"hidden"},Bs.prototype.setTextVisibility=Bs.prototype.setTextVisibility,P("shaka.util.ConfigUtils.mergeConfigObjects",Gs),P("shaka.util.ConfigUtils.convertToConfigObject",zs),P("shaka.util.PlayerConfiguration",Hs),Hs.mergeConfigObjects=Ys,O(tu,ht),P("shaka.Player",tu),tu.prototype.destroy=function(){var t=this;return c(function e(){var n;return k(e,function(e){switch(e.j){case 1:return t.h==Kh?e["return"]():(t.h=Kh,n=Ds(t.jb,function(){return{node:t.C,payload:Ju(),Ta:!1}}),p(e,new Promise(function(t){n.tb=function(){},n.jc=function(){t()},n.Wa=function(){t()},n.onError=function(){t()},n.lc=function(){t()}}),2));case 2:return p(e,t.jb.destroy(),3);case 3:if(t.i&&(t.i.release(),t.i=null),t.vc=null,t.l=null,t.b=null,!t.G){e.A(0);break}return p(e,t.G.destroy(),5);case 5:t.G=null,m(e)}})})},tu.prototype.destroy=tu.prototype.destroy,tu.version="v2.5.3";var Gh=["2","5"];sh=new function(t){this.a=t,this.c=Nn,this.b=Un}(new On(Number(Gh[0]),Number(Gh[1])));var zh=["output-restricted","internal-error"],Hh={};tu.registerSupportPlugin=function(t,e){Hh[t]=e},tu.isBrowserSupported=function(){return!!(t.Promise&&t.Uint8Array&&Array.prototype.forEach&&t.MediaKeys&&t.navigator&&t.navigator.requestMediaKeySystemAccess&&t.MediaKeySystemAccess&&t.MediaKeySystemAccess.prototype.getConfiguration)&&(!!jt()||Vt("application/x-mpegurl"))},tu.probeSupport=function(){return Se().then(function(t){for(var e=kh.Af(),n={},r=s('video/mp4; codecs="avc1.42E01E",video/mp4; codecs="avc3.42E01E",video/mp4; codecs="hev1.1.6.L93.90",video/mp4; codecs="hvc1.1.6.L93.90",video/mp4; codecs="hev1.2.4.L153.B0"; eotf="smpte2084",video/mp4; codecs="hvc1.2.4.L153.B0"; eotf="smpte2084",video/mp4; codecs="vp9",video/mp4; codecs="vp09.00.10.08",audio/mp4; codecs="mp4a.40.2",audio/mp4; codecs="ac-3",audio/mp4; codecs="ec-3",audio/mp4; codecs="opus",audio/mp4; codecs="flac",video/webm; codecs="vp8",video/webm; codecs="vp9",video/webm; codecs="vp09.00.10.08",audio/webm; codecs="vorbis",audio/webm; codecs="opus",video/mp2t; codecs="avc1.42E01E",video/mp2t; codecs="avc3.42E01E",video/mp2t; codecs="hvc1.1.6.L93.90",video/mp2t; codecs="mp4a.40.2",video/mp2t; codecs="ac-3",video/mp2t; codecs="ec-3",text/vtt,application/mp4; codecs="wvtt",application/ttml+xml,application/mp4; codecs="stpp"'.split(",")),i=r.next();!i.done;i=r.next()){i=i.value,n[i]=jt()?!!qe(i)||(MediaSource.isTypeSupported(i)||Ge(i)):Vt(i);var a=i.split(";")[0];n[a]=n[a]||n[i]}t={manifest:e,media:n,drm:t};for(var o in Hh)t[o]=Hh[o]();return t})},tu.prototype.Cb=function(t,e){if(e=void 0===e||e,this.h==Kh)return Promise.reject(Zu());var n=Ju();n.u=t,jt()||(e=!1);var r=e?this.fb:this.M,i=Ds(this.jb,function(){return{node:r,payload:n,Ta:!1}});return i.tb=function(){},tl(i)},tu.prototype.attach=tu.prototype.Cb,tu.prototype.detach=function(){var t=this;if(this.h==Kh)return Promise.reject(Zu());var e=Ds(this.jb,function(){return{node:t.C,payload:Ju(),Ta:!1}});return e.tb=function(){},tl(e)},tu.prototype.detach=tu.prototype.detach,tu.prototype.qd=function(t){var e=this;if(t=void 0===t||t,this.h==Kh)return Promise.reject(Zu());jt()||(t=!1);var n=Ju(),r=Ds(this.jb,function(r){var i=r.u&&t?e.fb:r.u?e.M:e.C;return n.u=r.u,{node:i,payload:n,Ta:!1}});return r.tb=function(){},tl(r)},tu.prototype.unload=tu.prototype.qd,tu.prototype.load=function(t,e,n){if(this.h==Kh)return Promise.reject(Zu());this.dispatchEvent(new ct("loading"));var r=Ju();r.uri=t,r.nd=Date.now()/1e3,n&&"string"!=typeof n&&(Dn("Loading with a manifest parser factory","Please register a manifest parser and for the mime-type."),r.ya=function(){return new n}),n&&"string"==typeof n&&(r.mimeType=n),void 0!==e&&(r.startTime=e);var i=eu(r)?this.hb:this.T,a=Ds(this.jb,function(t){return null==t.u?null:(r.u=t.u,{node:i,payload:r,Ta:!0})});return a.tb=function(){},new Promise(function(t,e){a.lc=function(){return e(new et(2,7,7002))},a.jc=function(){return t()},a.Wa=function(){return e(Zu())},a.onError=function(t){return e(t)}})},tu.prototype.load=tu.prototype.load,tu.prototype.configure=function(t,e){2==arguments.length&&"string"==typeof t&&(t=zs(t,e));var n=Ys(this.b,t,Eu(this));return yu(this),n},tu.prototype.configure=tu.prototype.configure,tu.prototype.getConfiguration=function(){var t=Eu(this);return Ys(t,this.b,Eu(this)),t},tu.prototype.getConfiguration=tu.prototype.getConfiguration,tu.prototype.If=function(){for(var t in this.b)delete this.b[t];Ys(this.b,Eu(this),Eu(this)),yu(this)},tu.prototype.resetConfiguration=tu.prototype.If,tu.prototype.Je=function(){return this.h},tu.prototype.getLoadMode=tu.prototype.Je,tu.prototype.Ne=function(){return this.a},tu.prototype.getMediaElement=tu.prototype.Ne,tu.prototype.Eb=function(){return this.G},tu.prototype.getNetworkingEngine=tu.prototype.Eb,tu.prototype.bc=function(){return this.Bb},tu.prototype.getAssetUri=tu.prototype.bc,tu.prototype.Me=function(){return Dn("getManifestUri",'Please use "getAssetUri" instead.'),this.bc()},tu.prototype.getManifestUri=tu.prototype.Me,tu.prototype.V=function(){return this.c?this.c.presentationTimeline.V():!(!this.a||!this.a.src)&&1/0==this.a.duration},tu.prototype.isLive=tu.prototype.V,tu.prototype.Va=function(){return!!this.c&&this.c.presentationTimeline.Va()},tu.prototype.isInProgress=tu.prototype.Va,tu.prototype.af=function(){if(this.c){if(!this.c.periods.length)return!1;var t=this.c.periods[0].variants;return!!t.length&&!t[0].video}return!(!this.a||!this.a.src)&&(this.a.videoTracks?0==this.a.videoTracks.length:0==this.a.videoHeight)},tu.prototype.isAudioOnly=tu.prototype.af,tu.prototype.Kf=function(){if(this.c){var t=this.c.presentationTimeline;return{start:t.mb(),end:t.za()}}return this.a&&this.a.src&&(t=this.a.seekable,t.length)?{start:t.start(0),end:t.end(t.length-1)}:{start:0,end:0}},tu.prototype.seekRange=tu.prototype.Kf,tu.prototype.keySystem=function(){return this.g?this.g.keySystem():""},tu.prototype.keySystem=tu.prototype.keySystem,tu.prototype.drmInfo=function(){return this.g?this.g.a:null},tu.prototype.drmInfo=tu.prototype.drmInfo,tu.prototype.dc=function(){return this.g?this.g.dc():1/0},tu.prototype.getExpiration=tu.prototype.dc,tu.prototype.Nc=function(){return!!this.P&&this.P.a==Nh},tu.prototype.isBuffering=tu.prototype.Nc,tu.prototype.Qe=function(){if(this.W){var t=this.W;t=t.f?0:t.c}else t=0;return t},tu.prototype.getPlaybackRate=tu.prototype.Qe,tu.prototype.fg=function(t){0==t?j("A trick play rate of 0 is unsupported!"):(this.a.paused&&this.a.play(),this.W.set(t),this.h==Wh&&no(this.f,1<Math.abs(t)))},tu.prototype.trickPlay=tu.prototype.fg,tu.prototype.ve=function(){this.h==qh&&this.W.set(1),this.h==Wh&&(this.W.set(1),no(this.f,!1))},tu.prototype.cancelTrickPlay=tu.prototype.ve,tu.prototype.Mc=function(){if(this.c&&this.o){for(var t=Xu(this),e=[],n=s(Yu(this)),r=n.next();!r.done;r=n.next()){r=r.value;var i=En(r);i.active=r==t,e.push(i)}return e}return this.a&&this.a.audioTracks?Array.from(this.a.audioTracks).map(function(t){var e=Sn(t);return e.active=t.enabled,e.type="variant",e.originalAudioId=t.id,"main"==t.kind?(e.primary=!0,e.roles=["main"],e.audioRoles=["main"]):e.audioRoles=[],e}):[]},tu.prototype.getVariantTracks=tu.prototype.Mc,tu.prototype.ob=function(){if(this.c&&this.o){for(var t=$u(this),e=[],n=s(Wu(this)),r=n.next();!r.done;r=n.next()){r=r.value;var i=wn(r);i.active=r==t,e.push(i)}return e}return this.a&&this.a.src&&this.a.textTracks?Array.from(this.a.textTracks).map(function(t){var e=Sn(t);return e.active="disabled"!=t.mode,e.type="text",e.originalTextId=t.id,"captions"==t.kind&&(e.mimeType="application/cea-608"),e}):[]},tu.prototype.getTextTracks=tu.prototype.ob,tu.prototype.gd=function(t){if(this.c&&this.f){var e=qu(this),n=e.textStreams.find(function(e){return e.id==t.id});n&&(bu(this,e,n,!1),Tu(this,n),this.ma=n.language)}else if(this.a&&this.a.src&&this.a.textTracks){for(e=Array.from(this.a.textTracks),e=s(e),n=e.next();!n.done;n=e.next())n=n.value,An(n)==t.id?n.mode=this.eb?"showing":"hidden":n.mode="disabled";Ou(this)}},tu.prototype.selectTextTrack=tu.prototype.gd,tu.prototype.Mf=function(){Dn("selectEmbeddedTextTrack","If closed captions are signaled in the manifest, a text stream will be created to represent them. Please use SelectTextTrack.");var t=this.ob().filter(function(t){return"application/cea-608"==t.mimeType});0<t.length&&this.gd(t[0])},tu.prototype.selectEmbeddedTextTrack=tu.prototype.Mf,tu.prototype.kg=function(){Dn("usingEmbeddedTextTrack","If closed captions are signaled in the manifest, a text stream will be created to represent them. There should be no reason to know if the player is playing embedded text.");var t=this.ob().filter(function(t){return t.active})[0];return!!t&&"application/cea-608"==t.mimeType},tu.prototype.usingEmbeddedTextTrack=tu.prototype.kg,tu.prototype.Of=function(t,e,n){if(n=void 0===n?0:n,this.c&&this.f){var r=qu(this);this.b.abr.enabled&&j("Changing tracks while abr manager is enabled will likely result in the selected track being overriden. Consider disabling abr before calling selectVariantTrack().");var i=r.variants.find(function(e){return e.id==t.id});i&&Tn(i)&&(_u(this,r,i,!1),Su(this,i,e,n),this.Tb=new pa(i),Mu(this,r.variants))}else if(this.a&&this.a.audioTracks){for(e=Array.from(this.a.audioTracks),e=s(e),n=e.next();!n.done;n=e.next())n=n.value,An(n)==t.id&&(n.enabled=!0);Pu(this)}},tu.prototype.selectVariantTrack=tu.prototype.Of,tu.prototype.Ee=function(){return Ku(this.Mc())},tu.prototype.getAudioLanguagesAndRoles=tu.prototype.Ee,tu.prototype.Xe=function(){return Ku(this.ob())},tu.prototype.getTextLanguagesAndRoles=tu.prototype.Xe,tu.prototype.De=function(){return Array.from(Hu(this.Mc()))},tu.prototype.getAudioLanguages=tu.prototype.De,tu.prototype.We=function(){return Array.from(Hu(this.ob()))},tu.prototype.getTextLanguages=tu.prototype.We,tu.prototype.Lf=function(t,e){if(this.c&&this.o){var n=qu(this);this.Tb=new ma(t,e||"",0),Ru(this,n)}else if(this.a&&this.a.audioTracks){n=Array.from(this.a.audioTracks),n=s(n);for(var r=n.next();!r.done;r=n.next())r=r.value,r.language==t&&(r.enabled=!0);Pu(this)}},tu.prototype.selectAudioLanguage=tu.prototype.Lf,tu.prototype.Nf=function(t,e){if(this.c&&this.o){var n=qu(this);this.ma=t,this.cb=e||"";var r=Cn(n.textStreams,this.ma,this.cb)[0]||null;r&&(bu(this,n,r,!1),(this.b.streaming.alwaysStreamText||this.gc())&&Tu(this,r))}else(n=this.ob().filter(function(e){return e.language==t})[0])&&this.gd(n)},tu.prototype.selectTextLanguage=tu.prototype.Nf,tu.prototype.gc=function(){var t=this.eb;return this.c?this.D.g.isTextVisible():this.a&&this.a.src&&this.a.textTracks?Array.from(this.a.textTracks).some(function(t){return"showing"==t.mode}):t},tu.prototype.isTextTrackVisible=tu.prototype.gc,tu.prototype.Rf=function(t){var e=this;return c(function n(){var r,i,a,o,u,l;return k(n,function(n){switch(n.j){case 1:if(r=e.eb,i=t,r==i)return n["return"]();if(e.eb=i,e.h!=Wh){if(e.a&&e.a.src&&e.a.textTracks){a=Array.from(e.a.textTracks);for(var c=s(a),d=c.next();!d.done;d=c.next())o=d.value,"disabled"!=o.mode&&(o.mode=t?"showing":"hidden")}n.A(2);break}if(e.D.g.setTextVisibility(t),e.b.streaming.alwaysStreamText){n.A(2);break}if(!t){c=e.f,c.D=!0,(d=c.b.get("text"))&&(Io(d),c.b["delete"]("text")),n.A(2);break}if(u=qu(e),l=Cn(u.textStreams,e.ma,e.cb),!(0<l.length)){n.A(2);break}return p(n,eo(e.f,l[0]),2);case 2:Du(e),m(n)}})})},tu.prototype.setTextTrackVisibility=tu.prototype.Rf,tu.prototype.Se=function(){if(!this.V())return null;if(this.c)return new Date(1e3*(this.c.presentationTimeline.f+this.a.currentTime));if(this.a&&this.a.getStartDate){var t=this.a.getStartDate();return isNaN(t.getTime())?null:new Date(t.getTime()+1e3*this.a.currentTime)}return null},tu.prototype.getPlayheadTimeAsDate=tu.prototype.Se,tu.prototype.Ue=function(){if(!this.V())return null;if(this.c)return new Date(1e3*this.c.presentationTimeline.f);if(this.a&&this.a.getStartDate){var t=this.a.getStartDate();return isNaN(t.getTime())?null:t}return null},tu.prototype.getPresentationStartTimeAsDate=tu.prototype.Ue,tu.prototype.Ic=function(){var t={total:[],audio:[],video:[],text:[]};return this.h==qh&&(t.total=Fe(this.a.buffered)),this.h==Wh&&this.D.Ic(t),t},tu.prototype.getBufferedInfo=tu.prototype.Ic,tu.prototype.getStats=function(){if(this.h!=Wh&&this.h!=qh)return{width:NaN,height:NaN,streamBandwidth:NaN,decodedFrames:NaN,droppedFrames:NaN,estimatedBandwidth:NaN,loadLatency:NaN,playTime:NaN,pauseTime:NaN,bufferingTime:NaN,switchHistory:[],stateHistory:[]};Cu(this);var t=this.a;if(t.getVideoPlaybackQuality){t=t.getVideoPlaybackQuality();var e=this.v,n=Number(t.totalVideoFrames);e.i=Number(t.droppedVideoFrames),e.h=n}this.h==Wh&&((t=Xu(this))&&(this.v.l=t.bandwidth),t&&t.video&&(e=this.v,n=t.video.height||NaN,e.m=t.video.width||NaN,e.g=n),t=this.l.getBandwidthEstimate(),this.v.f=t);var r=this.v;t=r.m,e=r.g,n=r.l;var i=r.h,a=r.i,o=r.f,u=r.b,l=$s(r.a,"playing"),c=$s(r.a,"paused"),d=$s(r.a,"buffering"),h=Zs(r.a),f=[];r=s(r.c.a);for(var p=r.next();!p.done;p=r.next())p=p.value,f.push({timestamp:p.timestamp,id:p.id,type:p.type,fromAdaptation:p.fromAdaptation,bandwidth:p.bandwidth});return{width:t,height:e,streamBandwidth:n,decodedFrames:i,droppedFrames:a,estimatedBandwidth:o,loadLatency:u,playTime:l,pauseTime:c,bufferingTime:d,stateHistory:h,switchHistory:f}},tu.prototype.getStats=tu.prototype.getStats,tu.prototype.addTextTrack=function(t,e,n,r,i,a){var o=this;return c(function s(){var u,l,c,d,h,f,m,g,v;return k(s,function(s){switch(s.j){case 1:if(o.h==qh)throw Error("State error!");if(o.h!=Wh)throw Error("State error!");if(u=qu(o),l=jd,c=o.c.periods.indexOf(u),d=c+1,h=d>=o.c.periods.length?o.c.presentationTimeline.Y():o.c.periods[d].startTime,f=h-u.startTime,1/0==f)throw new et(1,4,4033);return m=new gr(1,0,f,function(){return[t]},0,null),g={id:o.Id++,originalId:null,createSegmentIndex:Promise.resolve.bind(Promise),findSegmentPosition:function(){return 1},getSegmentReference:function(t){return 1==t?m:null},initSegmentReference:null,presentationTimeOffset:0,mimeType:r,codecs:i||"",kind:n,encrypted:!1,keyId:null,language:e,label:a||null,type:l.qa,primary:!1,trickModeVideo:null,emsgSchemeIdUris:null,roles:[],channelsCount:null,closedCaptions:null},o.Vb.add(g),u.textStreams.push(g),p(s,eo(o.f,g),2);case 2:return(v=to(o.f,"text"))&&sa(o.$,u,v),o.Vb["delete"](g),Ru(o,u),Iu(o),s["return"](wn(g))}})})},tu.prototype.addTextTrack=tu.prototype.addTextTrack,tu.prototype.jd=function(t,e){this.Wb.width=t,this.Wb.height=e},tu.prototype.setMaxHardwareResolution=tu.prototype.jd,tu.prototype.fd=function(){if(this.h==Wh){var t=this.f;if(t.f)t=!1;else if(t.m)t=!1;else{for(var e=s(t.b.values()),n=e.next();!n.done;n=e.next())n=n.value,n.Hb&&(n.Hb=!1,Lo(t,n,.1));t=!0}}else t=!1;return t},tu.prototype.retryStreaming=tu.prototype.fd,tu.prototype.Ke=function(){return this.c},tu.prototype.getManifest=tu.prototype.Ke,tu.prototype.Le=function(){return this.m?this.m.constructor:null},tu.prototype.getManifestParserFactory=tu.prototype.Le,ld=tu.prototype,ld.Fc=function(t){var e=this.f?Qa(this.f):null,n=this.f?Ja(this.f):null;if(_n(this.g,e,n,t),e=t.variants,!e.some(Tn))throw new et(2,4,4011);if(Gu(this,t.variants),yn(e,this.b.restrictions,this.Wb)&&this.f&&qu(this)==t&&Iu(this),t=this.g?this.g.a:null)for(e=s(e),n=e.next();!n.done;n=e.next()){n=s(n.value.drmInfos);for(var r=n.next();!r.done;r=n.next())if(r=r.value,r.keySystem==t.keySystem){r=s(r.initData||[]);for(var i=r.next();!i.done;i=r.next())i=i.value,de(this.g,i.initDataType,i.initData)}}},ld.df=function(t){try{this.ib=!0,this.l.disable(),Nu(this);var e=Mu(this,t.variants),n=Cn(t.textStreams,this.ma,this.cb)[0]||null;this.Ea&&(t.variants.includes(this.Ea)&&(e=this.Ea),this.Ea=null),this.na&&(t.textStreams.includes(this.na)&&(n=this.na),this.na=null),e&&_u(this,t,e,!0),n&&bu(this,t,n,!0);var r=this.f,i=r.b.get("video");if(i)var a=r.c.periods[i.pa];else{var o=r.b.get("audio");a=o?r.c.periods[o.pa]:null}var s=e?e.audio:null;if(!a&&n){var u;if(u=s){t=n;var l=pn(this.b.preferredTextLanguage),c=pn(s.language),d=pn(t.language);u=hn(d,l)&&!hn(c,d)}u&&(this.eb=!0),this.eb&&this.D.g.setTextVisibility(!0),Du(this)}return this.b.streaming.alwaysStreamText||this.gc()?{variant:e,text:n}:{variant:e,text:null}}catch(h){return this.Ka(h),{variant:null,text:null}}},ld.ue=function(){this.ib=!1,this.b.abr.enabled&&(this.l.enable(),Nu(this)),this.Ea&&(ro(this.f,this.Ea,this.Ed,this.Cd),Pu(this),this.Ea=null),this.na&&(io(this.f,this.na,!0,0,!1),Ou(this),this.na=null)},ld.jf=function(){this.m&&this.m.update&&this.m.update()},ld.qf=function(){this.o&&this.o.o()},ld.Ka=function(t){if(this.h!=Kh){var e=new ct("error",{detail:t});this.dispatchEvent(e),e.defaultPrevented&&(t.handled=!0)}};var Kh=0,Yh=1,Wh=2,qh=3;tu.LoadMode={DESTROYED:Kh,NOT_LOADED:Yh,MEDIA_SOURCE:Wh,SRC_EQUALS:qh},sl.prototype.destroy=function(){var t=this;return this.a?this.b:(this.a=!0,this.c().then(function(){t.b.resolve()},function(){t.b.resolve()}))},pl.prototype.add=function(t){gl(this,t)||this.a.push(t)},P("shaka.offline.Storage",yl),yl.support=_l,yl.prototype.destroy=function(){return this.h.destroy()},yl.prototype.destroy=yl.prototype.destroy,yl.prototype.configure=function(t,e){2==arguments.length&&"string"==typeof t&&(t=zs(t,e));var n=t,r=!1;return null!=n.trackSelectionCallback&&(r=!0,n.offline=n.offline||{},n.offline.trackSelectionCallback=n.trackSelectionCallback,delete n.trackSelectionCallback),null!=n.progressCallback&&(r=!0,n.offline=n.offline||{},n.offline.progressCallback=n.progressCallback,delete n.progressCallback),null!=n.usePersistentLicense&&(r=!0,n.offline=n.offline||{},n.offline.usePersistentLicense=n.usePersistentLicense,delete n.usePersistentLicense),r&&Dn("Storage.configure with OfflineConfig","Please configure storage with a player configuration."),Ys(this.a,t)},yl.prototype.configure=yl.prototype.configure,yl.prototype.getConfiguration=function(){var t=Ks();return Ys(t,this.a,Ks()),t},yl.prototype.getConfiguration=yl.prototype.getConfiguration,yl.prototype.Eb=function(){return this.b},yl.prototype.getNetworkingEngine=yl.prototype.Eb,yl.prototype.store=function(t,e,n){var r=this;return Ul(this,bl(this,t,e||{},function(){return c(function e(){var i,a;return k(e,function(e){switch(e.j){case 1:return n&&"string"!=typeof n?(Dn("Storing with a manifest parser factory","Please register a manifest parser and for the mime-type."),i=n,e["return"](new i)):p(e,kh.create(t,r.b,r.a.manifest.retryParameters,n),2);case 2:return a=e.s,e["return"](a)}})})}))},yl.prototype.store=yl.prototype.store,yl.prototype.Ve=function(){return this.f},yl.prototype.getStoreInProgress=yl.prototype.Ve,yl.prototype.remove=function(t){return Ul(this,Al(this,t))},yl.prototype.remove=yl.prototype.remove,yl.prototype.Ff=function(){return Ul(this,kl(this))},yl.prototype.removeEmeSessions=yl.prototype.Ff,yl.prototype.list=function(){return Ul(this,Cl())},yl.prototype.list=yl.prototype.list,yl.deleteAll=function(){return c(function t(){var e;return k(t,function(t){switch(t.j){case 1:return e=new $o,v(t,2),p(t,e.erase(),2);case 2:return b(t),p(t,e.destroy(),5);case 5:E(t,0)}})})},Hh.offline=_l,P("shaka.polyfill.installAll",function(){for(var t=0;t<Xh.length;++t)Xh[t].se()});var Xh=[];P("shaka.polyfill.register",zl),zl(function(){if(t.Document){var e=Element.prototype;e.requestFullscreen=e.requestFullscreen||e.mozRequestFullScreen||e.msRequestFullscreen||e.webkitRequestFullscreen,e=Document.prototype,e.exitFullscreen=e.exitFullscreen||e.mozCancelFullScreen||e.msExitFullscreen||e.webkitExitFullscreen,"fullscreenElement"in document||(Object.defineProperty(document,"fullscreenElement",{get:function(){return document.mozFullScreenElement||document.msFullscreenElement||document.webkitFullscreenElement}}),Object.defineProperty(document,"fullscreenEnabled",{get:function(){return document.mozFullScreenEnabled||document.msFullscreenEnabled||document.webkitSupportsFullscreen||document.webkitFullscreenEnabled}})),document.addEventListener("webkitfullscreenchange",Hl),document.addEventListener("webkitfullscreenerror",Hl),document.addEventListener("mozfullscreenchange",Hl),document.addEventListener("mozfullscreenerror",Hl),document.addEventListener("MSFullscreenChange",Hl),document.addEventListener("MSFullscreenError",Hl)}}),zl(function(){Gt("CrKey")&&delete t.indexedDB}),zl(function(){Gt("Trident/")&&!HTMLInputElement.prototype.originalAddEventListener&&(HTMLInputElement.prototype.originalAddEventListener=HTMLInputElement.prototype.addEventListener,HTMLInputElement.prototype.addEventListener=Kl)}),zl(function(){navigator.languages||Object.defineProperty(navigator,"languages",{get:function(){return navigator.language?[navigator.language]:["en"]}})}),zl(function(){}),zl(function(){if(t.MediaSource)if(t.cast&&cast.__platform__&&cast.__platform__.canDisplayType)Jl();else if(navigator.vendor&&navigator.vendor.includes("Apple")){var e=navigator.appVersion;Zl(),e.includes("Version/8")?t.MediaSource=null:e.includes("Version/9")?Yl():e.includes("Version/10")?(Yl(),ql()):(e.includes("Version/11")||e.includes("Version/12"))&&(Yl(),Wl())}else Gt("Tizen")&&Ql()}),ec.prototype.createMediaKeys=function(){var t=new rc(this.keySystem);return Promise.resolve(t)},ec.prototype.getConfiguration=function(){return this.a},rc.prototype.createSession=function(t){if("temporary"!=(t=t||"temporary"))throw new TypeError("Session type "+t+" is unsupported on this platform.");return new ac(this.b,t)},rc.prototype.setServerCertificate=function(t){return this.c=t?new Uint8Array(t):null,Promise.resolve(!0)},O(ac,ht),ld=ac.prototype,ld.generateRequest=function(t,e){this.a=new nt;try{this.c=this.g.createSession("video/mp4",new Uint8Array(e)),this.f.w(this.c,"webkitkeymessage",this.$f.bind(this)),this.f.w(this.c,"webkitkeyadded",this.Yf.bind(this)),this.f.w(this.c,"webkitkeyerror",this.Zf.bind(this)),uc(this,"status-pending")}catch(n){this.a.reject(n)}return this.a},ld.load=function(){return Promise.reject(Error("MediaKeySession.load not yet supported"))},ld.update=function(t){this.b=new nt;try{this.c.update(new Uint8Array(t))}catch(e){this.b.reject(e)}return this.b},ld.close=function(){try{this.c.close(),this.closed.resolve(),this.f.Ya()}catch(hf){this.closed.reject(hf)}return this.closed},ld.remove=function(){return Promise.reject(Error("MediaKeySession.remove is only applicable for persistent licenses, which are not supported on this platform"))},ld.$f=function(t){this.a&&(this.a.resolve(),this.a=null),this.dispatchEvent(new ct("message",{messageType:void 0==this.keyStatuses.a?"license-request":"license-renewal",message:t.message.buffer}))},ld.Yf=function(){this.b&&(uc(this,"usable"),this.b.resolve(),this.b=null)},ld.Zf=function(){var t=Error("EME PatchedMediaKeysApple key error");if(t.errorCode=this.c.error,null!=this.a)this.a.reject(t),this.a=null;else if(null!=this.b)this.b.reject(t),this.b=null;else switch(this.c.error.code){case WebKitMediaKeyError.MEDIA_KEYERR_OUTPUT:case WebKitMediaKeyError.MEDIA_KEYERR_HARDWARECHANGE:uc(this,"output-not-allowed");break;default:uc(this,"internal-error")}};var $h;ld=lc.prototype,ld.forEach=function(t){this.a&&t(this.a,$h)},ld.get=function(t){if(this.has(t))return this.a},ld.has=function(t){var e=$h;return!(!this.a||!te(new Uint8Array(t),new Uint8Array(e)))},ld.entries=function(){},ld.keys=function(){},ld.values=function(){},zl(function(){t.HTMLVideoElement&&t.WebKitMediaKeys&&($h=new Uint8Array([0]).buffer,delete HTMLMediaElement.prototype.mediaKeys,HTMLMediaElement.prototype.mediaKeys=null,HTMLMediaElement.prototype.setMediaKeys=nc,t.MediaKeys=rc,t.MediaKeySystemAccess=ec,navigator.requestMediaKeySystemAccess=tc)}),cc.prototype.c=function(t){if(!(1<t.version)){var e=Jt(t.reader.Xa(16)),n=[];if(0<t.version)for(var r=t.reader.F(),i=0;i<r;++i){var a=Jt(t.reader.Xa(16));n.push(a)}r=t.reader.F(),t.reader.L(r),this.b.push.apply(this.b,n),this.f.push(e),this.a.push({start:t.start,end:t.start+t.size-1})}},hc.prototype.createMediaKeys=function(){var t=new pc(this.keySystem);return Promise.resolve(t)},hc.prototype.getConfiguration=function(){return this.a},pc.prototype.createSession=function(t){if("temporary"!=(t=t||"temporary"))throw new TypeError("Session type "+t+" is unsupported on this platform.");return new gc(this.a,t)},pc.prototype.setServerCertificate=function(){return Promise.resolve(!1)},O(gc,ht),ld=gc.prototype,ld.generateRequest=function(t,e){this.a=new nt;try{this.c=this.g.createSession("video/mp4",new Uint8Array(e),null),this.f.w(this.c,"mskeymessage",this.nf.bind(this)),this.f.w(this.c,"mskeyadded",this.lf.bind(this)),this.f.w(this.c,"mskeyerror",this.mf.bind(this)),_c(this,"status-pending")}catch(n){this.a.reject(n)}return this.a},ld.load=function(){return Promise.reject(Error("MediaKeySession.load not yet supported"))},ld.update=function(t){this.b=new nt;try{this.c.update(new Uint8Array(t))}catch(e){this.b.reject(e)}return this.b},ld.close=function(){try{this.c.close(),this.closed.resolve(),this.f.Ya()}catch(hf){this.closed.reject(hf)}return this.closed},ld.remove=function(){return Promise.reject(Error("MediaKeySession.remove is only applicable for persistent licenses, which are not supported on this platform"))},ld.nf=function(t){this.a&&(this.a.resolve(),this.a=null),this.dispatchEvent(new ct("message",{messageType:void 0==this.keyStatuses.a?"license-request":"license-renewal",message:t.message.buffer}))},ld.lf=function(){this.a?(_c(this,"usable"),this.a.resolve(),this.a=null):this.b&&(_c(this,"usable"),this.b.resolve(),this.b=null)},ld.mf=function(){var t=Error("EME PatchedMediaKeysMs key error");if(t.errorCode=this.c.error,null!=this.a)this.a.reject(t),this.a=null;else if(null!=this.b)this.b.reject(t),this.b=null;else switch(this.c.error.code){case MSMediaKeyError.MS_MEDIA_KEYERR_OUTPUT:case MSMediaKeyError.MS_MEDIA_KEYERR_HARDWARECHANGE:_c(this,"output-not-allowed");break;default:_c(this,"internal-error")}};var Zh;ld=bc.prototype,ld.forEach=function(t){this.a&&t(this.a,Zh)},ld.get=function(t){if(this.has(t))return this.a},ld.has=function(t){var e=Zh;return!(!this.a||!te(new Uint8Array(t),new Uint8Array(e)))},ld.entries=function(){},ld.keys=function(){},ld.values=function(){},zl(function(){!t.HTMLVideoElement||!t.MSMediaKeys||navigator.requestMediaKeySystemAccess&&MediaKeySystemAccess.prototype.getConfiguration||(Zh=new Uint8Array([0]).buffer,delete HTMLMediaElement.prototype.mediaKeys,HTMLMediaElement.prototype.mediaKeys=null,HTMLMediaElement.prototype.setMediaKeys=fc,t.MediaKeys=pc,t.MediaKeySystemAccess=hc,navigator.requestMediaKeySystemAccess=dc)}),Ac.prototype.createSession=function(){},Ac.prototype.setServerCertificate=function(){},Sc.prototype.getConfiguration=function(){},Sc.prototype.createMediaKeys=function(){},zl(function(){!t.HTMLVideoElement||navigator.requestMediaKeySystemAccess&&MediaKeySystemAccess.prototype.getConfiguration||(navigator.requestMediaKeySystemAccess=Ec,delete HTMLMediaElement.prototype.mediaKeys,HTMLMediaElement.prototype.mediaKeys=null,HTMLMediaElement.prototype.setMediaKeys=wc,t.MediaKeys=Ac,t.MediaKeySystemAccess=Sc)},-10);var Qh="";Cc.prototype.createMediaKeys=function(){var t=new Mc(this.a);return Promise.resolve(t)},Cc.prototype.getConfiguration=function(){return this.b},ld=Mc.prototype,ld.createSession=function(t){if("temporary"!=(t=t||"temporary")&&"persistent-license"!=t)throw new TypeError("Session type "+t+" is unsupported on this platform.");var e=this.b||document.createElement("video");return e.src||(e.src="about:blank"),t=new Ic(e,this.g,t),this.c.push(t),t},ld.setServerCertificate=function(){return Promise.resolve(!1)},ld.tf=function(t){var e=document.createEvent("CustomEvent");e.initCustomEvent("encrypted",!1,!1,null),e.initDataType="webm",e.initData=t.initData,this.b.dispatchEvent(e)},ld.cg=function(t){var e=Lc(this,t.sessionId);e&&(t=new ct("message",{messageType:void 0==e.keyStatuses.a?"licenserequest":"licenserenewal",message:t.message}),e.b&&(e.b.resolve(),e.b=null),e.dispatchEvent(t))},ld.ag=function(t){(t=Lc(this,t.sessionId))&&(Oc(t,"usable"),t.a&&t.a.resolve(),t.a=null)},ld.bg=function(t){var e=Lc(this,t.sessionId);e&&e.handleError(t)},O(Ic,ht),ld=Ic.prototype,ld.handleError=function(t){var e=Error("EME v0.1b key error");e.errorCode=t.errorCode,e.errorCode.systemCode=t.systemCode,!t.sessionId&&this.b?(e.method="generateRequest",45==t.systemCode&&(e.message="Unsupported session type."),this.b.reject(e),this.b=null):t.sessionId&&this.a?(e.method="update",this.a.reject(e),this.a=null):(e=t.systemCode,t.errorCode.code==MediaKeyError.MEDIA_KEYERR_OUTPUT?Oc(this,"output-restricted"):1==e?Oc(this,"expired"):Oc(this,"internal-error"))},ld.md=function(t,e){if(this.a)this.a.then(this.md.bind(this,t,e))["catch"](this.md.bind(this,t,e));else{if(this.a=t,"webkit-org.w3.clearkey"==this.c){var n=Ht(e),r=JSON.parse(n);"oct"!=r.keys[0].kty&&(this.a.reject(Error("Response is not a valid JSON Web Key Set.")),this.a=null),n=Zt(r.keys[0].k),r=Zt(r.keys[0].kid)}else n=new Uint8Array(e),r=null;var i=Tc("addKey");try{this.f[i](this.c,n,r,this.sessionId)}catch(a){this.a.reject(a),this.a=null}}},ld.generateRequest=function(t,e){return Pc(this,e,null)},ld.load=function(t){return"persistent-license"==this.g?Pc(this,null,t):Promise.reject(Error("Not a persistent session."))},ld.update=function(t){var e=new nt;return this.md(e,t),e},ld.close=function(){if("persistent-license"!=this.g){if(!this.sessionId)return this.closed.reject(Error("The session is not callable.")),this.closed;var t=Tc("cancelKeyRequest");try{this.f[t](this.c,this.sessionId)}catch(e){}}return this.closed.resolve(),this.closed},ld.remove=function(){return"persistent-license"!=this.g?Promise.reject(Error("Not a persistent session.")):this.close()};var Jh;ld=Dc.prototype,ld.forEach=function(t){this.a&&t(this.a,Jh)},ld.get=function(t){if(this.has(t))return this.a},ld.has=function(t){var e=Jh;return!(!this.a||!te(new Uint8Array(t),new Uint8Array(e)))},ld.entries=function(){},ld.keys=function(){},ld.values=function(){},zl(function(){if(!(!t.HTMLVideoElement||navigator.requestMediaKeySystemAccess&&MediaKeySystemAccess.prototype.getConfiguration)){if(HTMLMediaElement.prototype.webkitGenerateKeyRequest)Qh="webkit";else if(!HTMLMediaElement.prototype.generateKeyRequest)return;Jh=new Uint8Array([0]).buffer,navigator.requestMediaKeySystemAccess=xc,delete HTMLMediaElement.prototype.mediaKeys,HTMLMediaElement.prototype.mediaKeys=null,HTMLMediaElement.prototype.setMediaKeys=kc,t.MediaKeys=Mc,t.MediaKeySystemAccess=Cc}}),zl(function(){if(t.HTMLVideoElement){var e=HTMLVideoElement.prototype;e.requestPictureInPicture&&document.exitPictureInPicture||!e.webkitSupportsPresentationMode||(document.pictureInPictureEnabled=!0,document.pictureInPictureElement=null,e.requestPictureInPicture=Uc,document.exitPictureInPicture=Fc,document.addEventListener("webkitpresentationmodechanged",Nc,!0))}}),zl(function(){if(t.HTMLMediaElement){var e=HTMLMediaElement.prototype.play;HTMLMediaElement.prototype.play=function(){var t=e.apply(this);return t&&t["catch"](function(){}),t}}}),zl(function(){if(t.HTMLVideoElement){var e=HTMLVideoElement.prototype;!e.getVideoPlaybackQuality&&"webkitDroppedFrameCount"in e&&(e.getVideoPlaybackQuality=Bc)}}),zl(function(){if(!t.VTTCue&&t.TextTrackCue){var e=TextTrackCue.length;if(3==e)t.VTTCue=jc;else if(6==e)t.VTTCue=Vc;else{try{var n=!!jc(1,2,"")}catch(r){n=!1}n&&(t.VTTCue=jc)}}}),Gc.prototype.parseInit=function(){},Gc.prototype.parseMedia=function(t,e){var n=Ht(t),r=[],i=new DOMParser,a=null;try{a=i.parseFromString(n,"text/xml")}catch(_){throw new et(2,2,2005)}if(a){if(!(a=a.getElementsByTagName("tt")[0]))throw new et(2,2,2005);var o=wh.getAttributeNS(a,"http://www.w3.org/ns/ttml#parameter","frameRate"),s=wh.getAttributeNS(a,"http://www.w3.org/ns/ttml#parameter","subFrameRate"),u=wh.getAttributeNS(a,"http://www.w3.org/ns/ttml#parameter","frameRateMultiplier"),l=wh.getAttributeNS(a,"http://www.w3.org/ns/ttml#parameter","tickRate");if(n=a.getAttribute("xml:space")||"default",i=a.getAttribute("tts:extent"),"default"!=n&&"preserve"!=n)throw new et(2,2,2005);n="default"==n,o=new td(o,s,u,l),s=zc(a.getElementsByTagName("metadata")[0]),u=zc(a.getElementsByTagName("styling")[0]),l=zc(a.getElementsByTagName("layout")[0]);for(var c=[],d=0;d<l.length;d++){var h=l[d],f=u,p=i,m=new Ye,g=h.getAttribute("xml:id");if(g){m.id=g,g=null,p&&(g=tf.exec(p)||nf.exec(p)),p=g?Number(g[1]):null,g=g?Number(g[2]):null;var v,y;(v=Xc(h,f,"extent"))&&null!=(v=(y=tf.exec(v))||nf.exec(v))&&(m.width=null!=p?100*Number(v[1])/p:Number(v[1]),m.height=null!=g?100*Number(v[2])/g:Number(v[2]),m.widthUnits=y||null!=p?eh:0,m.heightUnits=y||null!=g?eh:0),(h=Xc(h,f,"origin"))&&null!=(v=(y=tf.exec(h))||nf.exec(h))&&(m.viewportAnchorX=null!=g?100*Number(v[1])/g:Number(v[1]),m.viewportAnchorY=null!=p?100*Number(v[2])/p:Number(v[2]),m.viewportAnchorUnits=y||null!=p?eh:0)}else m=null;m&&c.push(m)}for(i=zc(a.getElementsByTagName("body")[0]),a=0;a<i.length;a++)(d=Kc(i[a],e.periodStart,o,s,u,l,c,n))&&r.push(d)}return r};var tf=/^(\d{1,2}|100)% (\d{1,2}|100)%$/,ef=/^(\d+px|\d+em)$/,nf=/^(\d+)px (\d+)px$/,rf=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,af=/^(?:(\d{2,}):)?(\d{2}):(\d{2})$/,of=/^(?:(\d{2,}):)?(\d{2}):(\d{2}\.\d{2,})$/,sf=/^(\d*(?:\.\d*)?)f$/,uf=/^(\d*(?:\.\d*)?)t$/,lf=/^(?:(\d*(?:\.\d*)?)h)?(?:(\d*(?:\.\d*)?)m)?(?:(\d*(?:\.\d*)?)s)?(?:(\d*(?:\.\d*)?)ms)?$/,cf={left:$d,center:"center",right:"end",start:$d,end:"end"},df={left:"line-left",center:"center",right:"line-right"};rh["application/ttml+xml"]=Gc,ed.prototype.parseInit=function(t){var e=!1;if((new _r).H("moov",br).H("trak",br).H("mdia",br).H("minf",br).H("stbl",br).ea("stsd",Er).H("stpp",function(t){e=!0,t.parser.stop()}).parse(t),!e)throw new et(2,2,2007)},ed.prototype.parseMedia=function(t,e){var n=!1,r=[];if((new _r).H("mdat",wr(function(t){n=!0,r=r.concat(this.a.parseMedia(t,e))}.bind(this))).parse(t),!n)throw new et(2,2,2007);return r},rh['application/mp4; codecs="stpp"']=ed,rh['application/mp4; codecs="stpp.TTML.im1t"']=ed,nd.prototype.parseInit=function(){},nd.prototype.parseMedia=function(t,e){var n=Ht(t);if(n=n.replace(/\r\n|\r(?=[^\n]|$)/gm,"\n"),n=n.split(/\n{2,}/m),!/^WEBVTT($|[ \t\n])/m.test(n[0]))throw new et(2,2,2e3);var r=e.segmentStart;if(null==r&&(r=0,n[0].includes("X-TIMESTAMP-MAP"))){var i=n[0].match(/LOCAL:((?:(\d{1,}):)?(\d{2}):(\d{2})\.(\d{3}))/m),a=n[0].match(/MPEGTS:(\d+)/m);if(i&&a){if(null==(r=ad(new yi(i[1]))))throw new et(2,2,2e3);r=e.periodStart+(Number(a[1])/9e4-r)}}a=[];var o=n[0].split("\n");for(i=1;i<o.length;i++)if(/^Region:/.test(o[i])){var s=new yi(o[i]),u=new Ye;Ei(s),_i(s);for(var l=Ei(s);l;){var c=u,d=l;(l=/^id=(.*)$/.exec(d))?c.id=l[1]:(l=/^width=(\d{1,2}|100)%$/.exec(d))?c.width=Number(l[1]):(l=/^lines=(\d+)$/.exec(d))?(c.height=Number(l[1]),c.heightUnits=2):(l=/^regionanchor=(\d{1,2}|100)%,(\d{1,2}|100)%$/.exec(d))?(c.regionAnchorX=Number(l[1]),c.regionAnchorY=Number(l[2])):(l=/^viewportanchor=(\d{1,2}|100)%,(\d{1,2}|100)%$/.exec(d))?(c.viewportAnchorX=Number(l[1]),c.viewportAnchorY=Number(l[2])):/^scroll=up$/.exec(d)&&(c.scroll="up"),_i(s),l=Ei(s)}a.push(u)}for(i=[],s=1;s<n.length;s++){if(o=n[s].split("\n"),l=o,d=r,o=a,1==l.length&&!l[0]||/^NOTE($|[ \t])/.test(l[0])||"STYLE"==l[0])o=null;else{u=null,l[0].includes("--\x3e")||(u=l[0],l.splice(0,1)),c=new yi(l[0]);var h=ad(c),f=bi(c,/[ \t]+--\x3e[ \t]+/g),p=ad(c);if(null==h||null==f||null==p)throw new et(2,2,2001);for(l=new Ke(h+d,p+d,l.slice(1).join("\n").trim()),_i(c),d=Ei(c);d;)rd(l,d,o),_i(c),d=Ei(c);null!=u&&(l.id=u),o=l}o&&i.push(o)}return i},rh["text/vtt"]=nd,rh['text/vtt; codecs="vtt"']=nd,od.prototype.parseInit=function(t){var e=!1;if((new _r).H("moov",br).H("trak",br).H("mdia",br).ea("mdhd",function(t){0==t.version?(t.reader.L(4),t.reader.L(4),this.a=t.reader.F(),t.reader.L(4)):(t.reader.L(8),t.reader.L(8),this.a=t.reader.F(),t.reader.L(8)),t.reader.L(4)}.bind(this)).H("minf",br).H("stbl",br).ea("stsd",Er).H("wvtt",function(){e=!0}).parse(t),!this.a)throw new et(2,2,2008);if(!e)throw new et(2,2,2008)},od.prototype.parseMedia=function(t,e){var n=this;if(!this.a)throw new et(2,2,2008);var r,i=0,a=[],o=[],s=!1,u=!1,l=!1,c=null;if((new _r).H("moof",br).H("traf",br).ea("tfdt",function(t){s=!0,i=0==t.version?t.reader.F():t.reader.yb()}).ea("tfhd",function(t){var e=t.flags;t=t.reader,t.L(4),1&e&&t.L(8),2&e&&t.L(4),c=8&e?t.F():null}).ea("trun",function(t){u=!0;var e=t.version,n=t.flags;t=t.reader;var r=t.F();1&n&&t.L(4),4&n&&t.L(4);for(var i=[],o=0;o<r;o++){var s={duration:null,sampleSize:null,od:null};256&n&&(s.duration=t.F()),512&n&&(s.sampleSize=t.F()),1024&n&&t.L(4),2048&n&&(s.od=0==e?t.F():t.Yd()),i.push(s)}a=i}).H("mdat",wr(function(t){l=!0,r=t})).parse(t),!l&&!s&&!u)throw new et(2,2,2008);var d=i,h=new DataView(r.buffer,r.byteOffset,r.byteLength),f=new vr(h,0);return a.forEach(function(t){var r=t.duration||c,a=t.od?i+t.od:d;d=a+(r||0);var s=0;do{var u=f.F();s+=u;var l=f.F(),h=null;"vttc"==Sr(l)?8<u&&(h=f.Xa(u-8)):f.L(u-8),r&&h&&o.push(sd(h,e.periodStart+a/n.a,e.periodStart+d/n.a))}while(t.sampleSize&&s<t.sampleSize)}),o.filter(Bd.Ga)},rh['application/mp4; codecs="wvtt"']=od,P("shaka.util.Dom.createHTMLElement",function(t){return document.createElement(t)}),P("shaka.util.Dom.createVideoElement",function(){var t=document.createElement("video");return t.muted=!0,t.width=600,t.height=400,t}),P("shaka.util.Dom.asHTMLElement",function(t){return t}),P("shaka.util.Dom.asHTMLMediaElement",function(t){return t}),P("shaka.util.Dom.removeAllChildren",function(t){for(;t.firstChild;)t.removeChild(t.firstChild)})}).call(r,n,n);for(var i in r.shaka)e[i]=r.shaka[i]}()}).call(e,n(46))},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(252),i=function(t){return t&&t.__esModule?t:{default:t}}(r);e.default=i.default,t.exports=e["default"]},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),u=n(3),l=r(u),c=n(2),d=r(c),h=n(31),f=r(h),p=n(4),m=r(p),g=n(6),v=r(g),y=n(10),_=r(y),b=n(253),E=r(b),w=n(254),A=r(w),S=function(t){function e(n){(0,a.default)(this,e);var r=(0,s.default)(this,t.call(this,n));return r.template=(0,_.default)(E.default),r.showTimeout=null,r.listenTo(r.container,m.default.CONTAINER_STATE_BUFFERING,r.onBuffering),r.listenTo(r.container,m.default.CONTAINER_STATE_BUFFERFULL,r.onBufferFull),r.listenTo(r.container,m.default.CONTAINER_STOP,r.onStop),r.listenTo(r.container,m.default.CONTAINER_ENDED,r.onStop),r.listenTo(r.container,m.default.CONTAINER_ERROR,r.onStop),r.render(),r}return(0,d.default)(e,t),(0,l.default)(e,[{key:"name",get:function(){return"spinner"}},{key:"attributes",get:function(){return{"data-spinner":"",class:"spinner-three-bounce"}}}]),e.prototype.onBuffering=function(){this.show()},e.prototype.onBufferFull=function(){this.hide()},e.prototype.onStop=function(){this.hide()},e.prototype.show=function(){var t=this;null===this.showTimeout&&(this.showTimeout=setTimeout(function(){return t.$el.show()},300))},e.prototype.hide=function(){null!==this.showTimeout&&(clearTimeout(this.showTimeout),this.showTimeout=null),this.$el.hide()},e.prototype.render=function(){this.$el.html(this.template());var t=v.default.getStyleFor(A.default);return this.container.$el.append(t),this.container.$el.append(this.$el),this.$el.hide(),this.container.buffering&&this.onBuffering(),this},e}(f.default);e.default=S,t.exports=e["default"]},function(t,e){t.exports="<div data-bounce1></div><div data-bounce2></div><div data-bounce3></div>"},function(t,e,n){e=t.exports=n(7)(!1),e.push([t.i,".spinner-three-bounce[data-spinner]{position:absolute;margin:0 auto;width:70px;text-align:center;z-index:999;left:0;right:0;margin-left:auto;margin-right:auto;top:50%;-webkit-transform:translateY(-50%);-moz-transform:translateY(-50%);-ms-transform:translateY(-50%);-o-transform:translateY(-50%);transform:translateY(-50%)}.spinner-three-bounce[data-spinner]>div{width:18px;height:18px;background-color:#fff;border-radius:100%;display:inline-block;-webkit-animation:bouncedelay 1.4s infinite ease-in-out;-moz-animation:bouncedelay 1.4s infinite ease-in-out;animation:bouncedelay 1.4s infinite ease-in-out;-webkit-animation-fill-mode:both;-moz-animation-fill-mode:both;animation-fill-mode:both}.spinner-three-bounce[data-spinner] [data-bounce1]{-webkit-animation-delay:-.32s;-moz-animation-delay:-.32s;animation-delay:-.32s}.spinner-three-bounce[data-spinner] [data-bounce2]{-webkit-animation-delay:-.16s;-moz-animation-delay:-.16s;animation-delay:-.16s}@-webkit-keyframes bouncedelay{0%,80%,to{-webkit-transform:scale(0)}40%{-webkit-transform:scale(1)}}@-moz-keyframes bouncedelay{0%,80%,to{-moz-transform:scale(0)}40%{-moz-transform:scale(1)}}@keyframes bouncedelay{0%,80%,to{-webkit-transform:scale(0);-moz-transform:scale(0);-ms-transform:scale(0);-o-transform:scale(0);transform:scale(0)}40%{-webkit-transform:scale(1);-moz-transform:scale(1);-ms-transform:scale(1);-o-transform:scale(1);transform:scale(1)}}",""])},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(256),i=function(t){return t&&t.__esModule?t:{default:t}}(r);e.default=i.default,t.exports=e["default"]},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),u=n(3),l=r(u),c=n(2),d=r(c),h=n(47),f=r(h),p=n(4),m=r(p),g=n(9),v=r(g),y=function(t){function e(n){(0,a.default)(this,e);var r=(0,s.default)(this,t.call(this,n));return r.setInitialAttrs(),r.reportInterval=r.options.reportInterval||5e3,r.state="IDLE",r}return(0,d.default)(e,t),(0,l.default)(e,[{key:"name",get:function(){return"stats"}}]),e.prototype.bindEvents=function(){this.listenTo(this.container.playback,m.default.PLAYBACK_PLAY,this.onPlay),this.listenTo(this.container,m.default.CONTAINER_STOP,this.onStop),this.listenTo(this.container,m.default.CONTAINER_ENDED,this.onStop),this.listenTo(this.container,m.default.CONTAINER_DESTROYED,this.onStop),this.listenTo(this.container,m.default.CONTAINER_STATE_BUFFERING,this.onBuffering),this.listenTo(this.container,m.default.CONTAINER_STATE_BUFFERFULL,this.onBufferFull),this.listenTo(this.container,m.default.CONTAINER_STATS_ADD,this.onStatsAdd),this.listenTo(this.container,m.default.CONTAINER_BITRATE,this.onStatsAdd),this.listenTo(this.container.playback,m.default.PLAYBACK_STATS_ADD,this.onStatsAdd)},e.prototype.setInitialAttrs=function(){this.firstPlay=!0,this.startupTime=0,this.rebufferingTime=0,this.watchingTime=0,this.rebuffers=0,this.externalMetrics={}},e.prototype.onPlay=function(){this.state="PLAYING",this.watchingTimeInit=Date.now(),this.intervalId||(this.intervalId=setInterval(this.report.bind(this),this.reportInterval))},e.prototype.onStop=function(){clearInterval(this.intervalId),this.report(),this.intervalId=void 0,this.state="STOPPED"},e.prototype.onBuffering=function(){this.firstPlay?this.startupTimeInit=Date.now():this.rebufferingTimeInit=Date.now(),this.state="BUFFERING",this.rebuffers++},e.prototype.onBufferFull=function(){this.firstPlay&&this.startupTimeInit?(this.firstPlay=!1,this.startupTime=Date.now()-this.startupTimeInit,this.watchingTimeInit=Date.now()):this.rebufferingTimeInit&&(this.rebufferingTime+=this.getRebufferingTime()),this.rebufferingTimeInit=void 0,this.state="PLAYING"},e.prototype.getRebufferingTime=function(){return Date.now()-this.rebufferingTimeInit},e.prototype.getWatchingTime=function(){return Date.now()-this.watchingTimeInit-this.rebufferingTime},e.prototype.isRebuffering=function(){return!!this.rebufferingTimeInit},e.prototype.onStatsAdd=function(t){v.default.extend(this.externalMetrics,t)},e.prototype.getStats=function(){var t={startupTime:this.startupTime,rebuffers:this.rebuffers,rebufferingTime:this.isRebuffering()?this.rebufferingTime+this.getRebufferingTime():this.rebufferingTime,watchingTime:this.isRebuffering()?this.getWatchingTime()-this.getRebufferingTime():this.getWatchingTime()};return v.default.extend(t,this.externalMetrics),t},e.prototype.report=function(){this.container.statsReport(this.getStats())},e}(f.default);e.default=y,t.exports=e["default"]},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(258),i=function(t){return t&&t.__esModule?t:{default:t}}(r);e.default=i.default,t.exports=e["default"]},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),u=n(3),l=r(u),c=n(2),d=r(c),h=n(31),f=r(h),p=n(4),m=r(p),g=n(6),v=r(g),y=n(10),_=r(y),b=n(259),E=r(b),w=n(260),A=r(w),S=function(t){function e(n){(0,a.default)(this,e);var r=(0,s.default)(this,t.call(this,n));return r.configure(),r}return(0,d.default)(e,t),(0,l.default)(e,[{key:"name",get:function(){return"watermark"}},{key:"template",get:function(){return(0,_.default)(A.default)}}]),e.prototype.bindEvents=function(){this.listenTo(this.container,m.default.CONTAINER_PLAY,this.onPlay),this.listenTo(this.container,m.default.CONTAINER_STOP,this.onStop),this.listenTo(this.container,m.default.CONTAINER_OPTIONS_CHANGE,this.configure)},e.prototype.configure=function(){this.position=this.options.position||"top-right",this.options.watermark&&""!==this.options.watermark?(this.imageUrl=this.options.watermark,this.imageLink=this.options.watermarkLink,this.render()):this.$el.remove()},e.prototype.onPlay=function(){this.hidden||this.$el.show()},e.prototype.onStop=function(){this.$el.hide()},e.prototype.render=function(){this.$el.hide();var t={position:this.position,imageUrl:this.imageUrl,imageLink:this.imageLink};this.$el.html(this.template(t));var e=v.default.getStyleFor(E.default);return this.container.$el.append(e),this.container.$el.append(this.$el),this},e}(f.default);e.default=S,t.exports=e["default"]},function(t,e,n){e=t.exports=n(7)(!1),e.push([t.i,"[data-watermark]{position:absolute;min-width:70px;max-width:200px;width:12%;text-align:center;z-index:10}[data-watermark] a{outline:none;cursor:pointer}[data-watermark] img{max-width:100%}[data-watermark-bottom-left]{bottom:10px;left:10px}[data-watermark-bottom-right]{bottom:10px;right:42px}[data-watermark-top-left]{top:10px;left:10px}[data-watermark-top-right]{top:10px;right:37px}",""])},function(t,e){t.exports="<div data-watermark data-watermark-<%=position %>>\r\n<% if(typeof imageLink !== 'undefined') { %>\r\n<a target=_blank href=\"<%= imageLink %>\">\r\n<% } %>\r\n<img src=\"<%= imageUrl %>\">\r\n<% if(typeof imageLink !== 'undefined') { %>\r\n</a>\r\n<% } %>\r\n</div>\r\n"},function(t,e,n){"use strict";(function(r){function i(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var a=n(0),o=i(a),s=n(1),u=i(s),l=n(3),c=i(l),d=n(2),h=i(d),f=n(31),p=i(f),m=n(4),g=i(m),v=n(6),y=i(v),_=n(10),b=i(_),E=n(13),w=i(E),A=n(125),S=i(A),T=n(262),x=i(T),k=n(263),C=i(k),M=function(t){function e(n){(0,o.default)(this,e);var i=(0,u.default)(this,t.call(this,n));return i.hasStartedPlaying=!1,i.playRequested=!1,i.played=!1,i.render(),r.nextTick(function(){return i.update()}),i}return(0,h.default)(e,t),(0,c.default)(e,[{key:"name",get:function(){return"poster"}},{key:"template",get:function(){return(0,b.default)(x.default)}},{key:"shouldRender",get:function(){var t=!(!this.options.poster||!this.options.poster.showForNoOp||""===this.options.poster);return"html_img"!==this.container.playback.name&&(this.container.playback.getPlaybackType()!==w.default.NO_OP||t)}},{key:"events",get:function(){return{click:"clicked"}}},{key:"showOnVideoEnd",get:function(){return!this.options.poster||this.options.poster.showOnVideoEnd||void 0===this.options.poster.showOnVideoEnd}}]),e.prototype.bindEvents=function(){this.listenTo(this.container,g.default.CONTAINER_STOP,this.onStop),this.listenTo(this.container,g.default.CONTAINER_PLAY,this.onPlay),this.listenTo(this.container,g.default.CONTAINER_STATE_BUFFERING,this.update),this.listenTo(this.container,g.default.CONTAINER_STATE_BUFFERFULL,this.update),this.listenTo(this.container,g.default.CONTAINER_OPTIONS_CHANGE,this.render),this.listenTo(this.container,g.default.CONTAINER_ERROR,this.onError),this.listenTo(this.container,g.default.CONTAINER_ERRORPLAY,this.onErrorPlay),this.showOnVideoEnd&&this.listenTo(this.container,g.default.CONTAINER_ENDED,this.onStop)},e.prototype.onError=function(t){this.hasFatalError=t.level===S.default.Levels.FATAL,this.hasFatalError&&(this.hasStartedPlaying=!1,this.playRequested=!1,this.showPlayButton())},e.prototype.onErrorPlay=function(){this.played=!0,this.hasStartedPlaying=!1,this.playRequested=!1,this.showPoster(),this.showPlayButton()},e.prototype.onPlay=function(){this.played=!0,this.hasStartedPlaying=!0,this.update()},e.prototype.onStop=function(){this.hasStartedPlaying=!1,this.playRequested=!1,this.update()},e.prototype.updatePlayButton=function(t){!t||this.options.chromeless&&!this.options.allowUserInteraction?this.hidePlayButton():this.showPlayButton()},e.prototype.showPlayButton=function(){this.hasFatalError&&!this.options.disableErrorScreen||this.$playButton.show()},e.prototype.hidePlayButton=function(){this.$playButton.hide()},e.prototype.clicked=function(){if(!this.hasStartedPlaying)return this.options.chromeless&&!this.options.allowUserInteraction||(this.playRequested=!0,this.update(),this.container.play()),!1},e.prototype.shouldHideOnPlay=function(){return!this.container.playback.isAudioOnly},e.prototype.update=function(){if(this.shouldRender&&(!this.options.autoPlay||this.played)){var t=!this.playRequested&&!this.hasStartedPlaying&&!this.container.buffering;this.updatePlayButton(t),this.updatePoster()}},e.prototype.updatePoster=function(){this.hasStartedPlaying?this.hidePoster():this.showPoster()},e.prototype.showPoster=function(){this.container.disableMediaControl(),this.$el.show()},e.prototype.hidePoster=function(){this.container.enableMediaControl(),this.shouldHideOnPlay()&&this.$el.hide()},e.prototype.render=function(){if(this.shouldRender){this.options.autoPlay&&!this.played&&this.$el.hide(),this.$el.html(this.template());var t=y.default.getStyleFor(C.default);this.container.$el.append(t);this.options.poster&&void 0===this.options.poster.custom||this.options.poster&&this.$el.css({background:this.options.poster.custom}),this.container.$el.append(this.$el),this.$playButton=this.$el.find("svg");var e=this.options.mediacontrol&&this.options.mediacontrol.buttons;return e&&this.$el.find("svg path").css("fill",e),this.options.mediacontrol&&this.options.mediacontrol.buttons&&(e=this.options.mediacontrol.buttons,this.$playButton.css("color",e)),this.update(),this}},e}(p.default);e.default=M,t.exports=e["default"]}).call(e,n(84))},function(t,e){t.exports='<div data-poster data-poster-center>\n    <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"\n\t viewBox="0 0 496.158 496.158" style="enable-background:new 0 0 496.158 496.158;" xml:space="preserve">\n<path style="fill:#32BEA6;" d="M496.158,248.085c0-137.021-111.07-248.082-248.076-248.082C111.07,0.002,0,111.062,0,248.085\n\tc0,137.002,111.07,248.071,248.083,248.071C385.088,496.155,496.158,385.086,496.158,248.085z"/>\n<path style="fill:#FFFFFF;" d="M370.805,235.242L195.856,127.818c-4.776-2.934-11.061-3.061-15.951-0.322\n\tc-4.979,2.785-8.071,8.059-8.071,13.762v214c0,5.693,3.083,10.963,8.046,13.752c2.353,1.32,5.024,2.02,7.725,2.02\n\tc2.897,0,5.734-0.797,8.205-2.303l174.947-106.576c4.657-2.836,7.556-7.986,7.565-13.44\n\tC378.332,243.258,375.452,238.096,370.805,235.242z"/>\n</svg>\n</div>'},function(t,e,n){e=t.exports=n(7)(!1),e.push([t.i,"[data-poster]{position:absolute;min-width:32px;max-width:64px;width:64px;height:64px;text-align:center;z-index:998}[data-poster-center]{left:50%;top:50%;transform:translate(-50%,-50%)}[data-poster] svg{max-width:100%;width:100%}",""])},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(265),i=function(t){return t&&t.__esModule?t:{default:t}}(r);e.default=i.default,t.exports=e["default"]},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),u=n(3),l=r(u),c=n(2),d=r(c),h=n(47),f=r(h),p=n(4),m=r(p),g=n(13),v=r(g),y=function(t){function e(n){return(0,a.default)(this,e),(0,s.default)(this,t.call(this,n))}return(0,d.default)(e,t),(0,l.default)(e,[{key:"name",get:function(){return"click_to_pause"}}]),e.prototype.bindEvents=function(){void 0!=this._options.video360&&this._options.video360||(this.listenTo(this.container,m.default.CONTAINER_CLICK,this.click),this.listenTo(this.container,m.default.CONTAINER_SETTINGSUPDATE,this.settingsUpdate))},e.prototype.click=function(){void 0!=this._options.video360&&this._options.video360||(this.container.getPlaybackType()!==v.default.LIVE||this.container.isDvrEnabled())&&(this.container.isPlaying()?this.container.pause():this.container.play())},e.prototype.settingsUpdate=function(){this.container.$el.removeClass("pointer-enabled"),(this.container.getPlaybackType()!==v.default.LIVE||this.container.isDvrEnabled())&&this.container.$el.addClass("pointer-enabled")},e}(f.default);e.default=y,t.exports=e["default"]},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=n(56),a=r(i),o=n(0),s=r(o),u=n(1),l=r(u),c=n(3),d=r(c),h=n(2),f=r(h),p=n(47),m=r(p),g=n(4),v=r(g),y=n(128),_=r(y),b=n(27),E=r(b),w=n(267),A=r(w),S=function(t){function e(n){(0,s.default)(this,e);var r=(0,l.default)(this,t.call(this,n));return r._runEach=(0,_.default)(n,"options.powerStats.runEach",5e3),r._onReport=(0,_.default)(n,"options.powerStats.onReport",r._defaultReport),r._uriToMeasureLatency=(0,_.default)(n,"options.powerStats.uriToMeasureLatency"),r._urisToMeasureBandwidth=(0,_.default)(n,"options.powerStats.urisToMeasureBandwidth"),r._runBandwidthTestEvery=(0,_.default)(n,"options.powerStats.runBandwidthTestEvery",10),r._bwMeasureCount=0,r._completion={watch:(0,_.default)(n,"options.powerStats.onCompletion",[]),calls:[]},r._newMetrics(),r.on(e.REPORT_EVENT,r._onReport),r._needsend=!0,r._webReporter=new A.default(r.options.powerStats.baseurl,r.options.powerStats.reportserver,r.options.powerStats.streamid,r.options.powerStats.contentid,r.options.powerStats.videoname,r.options.powerStats.videoid,r.options.powerStats.siteid,r.options.powerStats.username,r.options.src),r}return(0,f.default)(e,t),e.prototype._now=function(){return window.performance&&"function"==typeof window.performance.now?window.performance.now():new Date},e.prototype._inc=function(t){this._metrics.counters[t]+=1},e.prototype._timerHasStarted=function(t){return void 0!==this["_start"+t]},e.prototype._start=function(t){this["_start"+t]=this._now()},e.prototype._stop=function(t){this._metrics.timers[t]+=this._now()-this["_start"+t]},e.prototype._defaultReport=function(t){},(0,d.default)(e,[{key:"name",get:function(){return"powerplayer_stats"}},{key:"_playbackName",get:function(){return this.container.playback.name}},{key:"_playbackType",get:function(){return this.container.getPlaybackType()}}]),e.prototype.bindEvents=function(){var t=this;this.listenTo(this.container,v.default.CONTAINER_BITRATE,this.onBitrate),this.listenTo(this.container,v.default.CONTAINER_STOP,this.stopReporting),this.listenTo(this.container,v.default.CONTAINER_ENDED,this.stopReporting),this.listenToOnce(this.container.playback,v.default.PLAYBACK_PLAY_INTENT,this.startTimers),this.listenToOnce(this.container,v.default.CONTAINER_PLAY,this.onFirstPlaying),this.listenTo(this.container,v.default.CONTAINER_PLAY,this.onPlay),this.listenTo(this.container,v.default.CONTAINER_PAUSE,this.onPause),this.listenToOnce(this.container,v.default.CONTAINER_STATE_BUFFERING,this.onBuffering),this.listenTo(this.container,v.default.CONTAINER_SEEK,this.onSeek),this.listenTo(this.container,v.default.CONTAINER_ERROR,function(){return t._inc("error")}),this.listenTo(this.container,v.default.CONTAINER_FULLSCREEN,function(){return t._inc("fullscreen")}),this.listenTo(this.container,v.default.CONTAINER_PLAYBACKDVRSTATECHANGED,function(e){e&&t._inc("dvrUsage")}),this.listenTo(this.container.playback,v.default.PLAYBACK_PROGRESS,this.onProgress),this.listenTo(this.container.playback,v.default.PLAYBACK_TIMEUPDATE,this.onTimeUpdate),this.listenTo(this.container.playback,v.default.PLAYBACK_FRAGMENT_LOADED,this.onFragmentLoaded),this.listenTo(this.container.playback,v.default.PLAYBACK_P2P_STATUS,this.onP2PStatus)},e.prototype.destroy=function(){this.stopReporting(),t.prototype.destroy.call(this)},e.prototype.onBitrate=function(t){var e=t.url[0],n=parseInt((0,_.default)(t,"bitrate",0),10),r=this._now();if(this._metrics.extra.bitratesHistory.length>0){var i=this._metrics.extra.bitratesHistory[this._metrics.extra.bitratesHistory.length-1];i.end=r,i.time=r-i.start}if(this._metrics.extra.bitratesHistory.push({start:this._now(),bitrate:n}),void 0!==e){var a=e.substring(7,e.length);a=a.substring(0,a.indexOf(":")),this._webReporter.dataPack.serverIp=a}this._inc("changeLevel")},e.prototype.stopReporting=function(){this._buildReport(),this._webReporter.updateMetrics(this._metrics),this._webReporter.send("end"),clearInterval(this._intervalId),this._newMetrics(),this.stopListening(this.container,v.default.CONTAINER_TIMEUPDATE,this.onContainerUpdateWhilePlaying),this.bindEvents()},e.prototype.startTimers=function(){this._intervalId=setInterval(this._buildReport.bind(this),this._runEach),this._start("session"),this._start("startup")},e.prototype.onFirstPlaying=function(){this.listenTo(this.container,v.default.CONTAINER_TIMEUPDATE,this.onContainerUpdateWhilePlaying),this._start("watch"),this._stop("startup"),this._webReporter.send("start")},e.prototype.playAfterPause=function(){this.listenTo(this.container,v.default.CONTAINER_TIMEUPDATE,this.onContainerUpdateWhilePlaying),this._stop("pause"),this._start("watch"),this._webReporter.setStatus("PLAYING"),this._webReporter.send("status")},e.prototype.onPlay=function(){this._inc("play"),this._webReporter.setStatus("PLAYING"),this._webReporter.send("status")},e.prototype.onPause=function(){this._stop("watch"),this._start("pause"),this._inc("pause"),this._webReporter.setStatus("PAUSED"),this._webReporter.send("status"),this.listenToOnce(this.container,v.default.CONTAINER_PLAY,this.playAfterPause),this.stopListening(this.container,v.default.CONTAINER_TIMEUPDATE,this.onContainerUpdateWhilePlaying)},e.prototype.onSeek=function(t){this._inc("seek"),this._metrics.extra.watchHistory.push([1e3*t,1e3*t])},e.prototype.onTimeUpdate=function(t){var e=1e3*t.current,n=1e3*t.total,r=this._metrics.extra.watchHistory.length;if(this._metrics.extra.duration=n,this._metrics.extra.currentTime=e,this._metrics.extra.watchedPercentage=e/n*100,0===r?this._metrics.extra.watchHistory.push([e,e]):this._metrics.extra.watchHistory[r-1][1]=e,this._metrics.extra.bitratesHistory.length>0){var i=this._metrics.extra.bitratesHistory[this._metrics.extra.bitratesHistory.length-1];i.end||(i.time=this._now()-i.start)}this._onCompletion()},e.prototype.onContainerUpdateWhilePlaying=function(){this.container.playback.isPlaying()&&(this._stop("watch"),this._start("watch"))},e.prototype.onBuffering=function(){this._inc("buffering"),this._start("buffering"),this._webReporter.setStatus("BUFFERING"),this._webReporter.send("status"),this.listenToOnce(this.container,v.default.CONTAINER_STATE_BUFFERFULL,this.onBufferfull)},e.prototype.onBufferfull=function(){this._stop("buffering"),this.listenToOnce(this.container,v.default.CONTAINER_STATE_BUFFERING,this.onBuffering)},e.prototype.onProgress=function(t){this._metrics.extra.buffersize=1e3*t.current},e.prototype._newMetrics=function(){this._metrics={counters:{play:0,pause:0,error:0,buffering:0,decodedFrames:0,droppedFrames:0,fps:0,changeLevel:0,seek:0,fullscreen:0,dvrUsage:0,decodedByteCount:0,bps:0},timers:{startup:0,watch:0,pause:0,buffering:0,session:0,latency:0},extra:{playbackName:"",playbackType:"",bitratesHistory:[],bitrateWeightedMean:0,bitrateMostUsed:0,buffersize:0,watchHistory:[],watchedPercentage:0,bufferingPercentage:0,bandwidth:0,duration:0,currentTime:0,bytesLoaded:0},p2pstatus:{totalMb:0,p2pMb:0,uploadMb:0,totalbps:0,p2pbps:0,uploadbps:0,p2pcount:0}}},e.prototype._onCompletion=function(){var t=this._metrics.extra.watchedPercentage,n=this._completion.watch,r=-1!=this._completion.calls.indexOf(t);-1==n.indexOf(t)||r||(E.default.info(this.name+" PERCENTAGE_EVENT: "+t),this._completion.calls.push(t),this.trigger(e.PERCENTAGE_EVENT,t))},e.prototype._buildReport=function(){this._stop("session"),this._start("session"),this._metrics.extra.playbackName=this._playbackName,this._metrics.extra.playbackType=this._playbackType,this._calculateBitrates(),this._calculatePercentages(),this._fetchFPS(),this._measureLatency(),this._measureBandwidth(),this._needsend&&(this._webReporter.updateMetrics(this._metrics),this._webReporter.send("heart")),this._needsend=!this._needsend,this.trigger(e.REPORT_EVENT,JSON.parse((0,a.default)(this._metrics)))},e.prototype._fetchFPS=function(){var t={html5_video:this._html5FetchFPS,hls:this._html5FetchFPS,dash_shaka_playback:this._html5FetchFPS,p2phls:this._html5FetchFPS,flv:this._html5FetchFPS};t[this._playbackName]&&t[this._playbackName].call(this)},e.prototype._calculateBitrates=function(){var t=this._metrics.extra.bitratesHistory.map(function(t){return t.time}).reduce(function(t,e){return t+e},0);this._metrics.extra.bitrateWeightedMean=this._metrics.extra.bitratesHistory.map(function(t){return t.bitrate*t.time}).reduce(function(t,e){return t+e},0)/t,this._metrics.extra.bitratesHistory.length>0&&(this._metrics.extra.bitrateMostUsed=this._metrics.extra.bitratesHistory.slice().sort(function(t,e){return t.time<e.time})[0].bitrate)},e.prototype._calculatePercentages=function(){this._metrics.extra.duration>0&&(this._metrics.extra.bufferingPercentage=this._metrics.timers.buffering/this._metrics.extra.duration*100)},e.prototype._html5FetchFPS=function(){var t=this.container.playback.el,e=t.webkitDecodedFrameCount||t.mozDecodedFrames||0,n=t.webkitDroppedFrameCount||t.mozParsedFrames-t.mozDecodedFrames||0,r=e-(this._lastDecodedFramesCount||0),i=(t.webkitVideoDecodedByteCount||0)+(t.webkitAudioDecodedByteCount||0),a=i-(this._lastDecodedByteCount||0);this._metrics.counters.decodedFrames=e,this._metrics.counters.droppedFrames=n,this._metrics.counters.fps=r/(this._runEach/1e3),this._metrics.counters.decodedByteCount=i,this._metrics.counters.bps=a/(this._runEach/1e3),this._lastDecodedFramesCount=e,this._lastDecodedByteCount=i},e.prototype._measureLatency=function(){var t=this;if(this._uriToMeasureLatency){var e,n=[],r=function(){e=n[2]-n[1],t._metrics.timers.latency=e};!function i(){if(n.push(t._now()),n.length>2)r();else{var e=new Image;e.onload=i,e.src=t._uriToMeasureLatency+"?"+Math.random()+"="+t._now()}}()}},e.prototype._measureBandwidth=function(){var t=this;if(this._urisToMeasureBandwidth&&this._bwMeasureCount%this._runBandwidthTestEvery==0){var e=0,n=function(n){var r=(t._urisToMeasureBandwidth[e-1].end-t._urisToMeasureBandwidth[e-1].start)/1e3,i=8*n.loaded/r;t._metrics.extra.bandwidth=i,t._urisToMeasureBandwidth.forEach(function(t){t.start=0,t.end=0,t.expired=!1,clearTimeout(t.timer)})};!function r(i){if(e>0&&(t._urisToMeasureBandwidth[e-1].end=t._now(),clearTimeout(t._urisToMeasureBandwidth[e-1].timer)),e>=t._urisToMeasureBandwidth.length||e>0&&t._urisToMeasureBandwidth[e-1].expired)n(i);else{var a=new XMLHttpRequest;a.open("GET",t._urisToMeasureBandwidth[e].url,!0),a.responseType="arraybuffer",a.onload=a.onabort=r,t._urisToMeasureBandwidth[e].start=t._now(),t._urisToMeasureBandwidth[e].timer=setTimeout(function(e){t._urisToMeasureBandwidth[e].expired=!0,a.abort()},t._urisToMeasureBandwidth[e].timeout,e),a.send()}e++}()}this._bwMeasureCount++},e.prototype.onFragmentLoaded=function(t){this._metrics.extra.bytesLoaded+=t.stats.loaded},e.prototype.onP2PStatus=function(t){this._metrics.p2pstatus=t},e}(m.default);e.default=S,S.REPORT_EVENT="pwplayer:stats:report",S.PERCENTAGE_EVENT="pwplayer:stats:percentage",t.exports=e["default"]},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(0),i=function(t){return t&&t.__esModule?t:{default:t}}(r),a=function(){function t(e,n,r,a,o,s,u,l,c){if((0,i.default)(this,t),this.heartId=null,this.playingTimerId=null,this.reportUrl="/service/flashPlayerService-report.action",this.webUrl=e,this.statisticsServer=n,this.lastFlow=0,void 0!==n&&""!=n)if(n.indexOf("|")>0){var d=new Array;if(d=n.split("|"),d.length>1){var h=0,f=d.length-1,p=Math.round(Math.random()*(f-h))+h;this.statisticsServer=d[p]}}else if(n.indexOf(",")>0){var d=new Array;if(d=n.split(","),d.length>1){var h=0,f=d.length-1,p=Math.round(Math.random()*(f-h))+h;this.statisticsServer=d[p]}}this.reportAddress=this.webUrl+this.reportUrl,void 0!==this.statisticsServer&&""!=this.statisticsServer&&(0==window.location.href.indexOf("https://")?this.reportAddress="https://"+this.statisticsServer+"/reportService"+this.reportUrl:this.reportAddress="http://"+this.statisticsServer+"/reportService"+this.reportUrl),this.oldFlowRate=0,this.bufferCompleteTime=0,this.haveSendEnd=!1,this.haveSendError=!1;var m=c;0==m.indexOf("http://")?m=m.substring(7,m.length):0==m.indexOf("https://")&&(m=m.substring(8,m.length)),m.lastIndexOf(":")>0&&(m=m.substring(0,m.indexOf(":")));var g=r;if(void 0===g||""==g){g="";for(var v=1;v<=32;v++){g+=Math.floor(16*Math.random()).toString(16)}}void 0!==l&&""!=l||(l="anonymous"),this.dataPack={streamId:g,entityId:a,progName:encodeURIComponent(o),duration:0,userName:encodeURIComponent(l),fileId:s,siteId:u,provider:"http",position:0,time:0,flowRate:0,realSpeed:null,httpAvSpeed:null,realPlayTime:0,serverIp:m,userAgent:"html5",type:"",playStatus:null,weburlparam:encodeURIComponent(this.webUrl)}}return t.prototype.setStatus=function(t){this.dataPack.playStatus=t},t.prototype.updateMetrics=function(t){this.dataPack.userAgent=encodeURIComponent(t.extra.playbackName),this.dataPack.position=Math.round(t.extra.currentTime/1e3),this.dataPack.duration=Math.round(t.extra.duration/1e3),this.dataPack.realPlayTime=Math.round(t.timers.watch/1e3),this.dataPack.flowRate=t.extra.bytesLoaded,0===this.dataPack.flowRate&&(this.dataPack.flowRate=t.counters.decodedByteCount),this.dataPack.realSpeed=Math.round((this.dataPack.flowRate-this.lastFlow)/1024/10)+" KB/s",!isNaN(t.extra.bitrateWeightedMean)&&t.extra.bitrateWeightedMean>0?this.dataPack.httpAvSpeed=Math.round(t.extra.bitrateWeightedMean/1024)+" KB/s":t.counters.decodedByteCount>0&&t.timers.watch>0?this.dataPack.httpAvSpeed=Math.round(t.counters.decodedByteCount/1024/(t.timers.watch/1e3))+" KB/s":this.dataPack.httpAvSpeed="0 KB/s",this.lastFlow=this.dataPack.flowRate},t.prototype.freshDataPack=function(){this.dataPack.time=(new Date).getTime()},t.prototype.parseJsonToParams=function(t){var e=[];for(var n in t){var r=n+"="+t[n];e.push(r)}return e.join("&")},t.prototype.send=function(t,e){if(void 0!==this.webUrl&&""!=this.webUrl&&("playError"!=t||!this.haveSendError)){"playError"==t&&(this.haveSendError=!0),this.dataPack.type=t,this.freshDataPack();var n=this.parseJsonToParams(this.dataPack);e&&(n+="&"+this.parseJsonToParams(e));var r=document.getElementsByTagName("head")[0]||document.documentElement,i=document.createElement("script");i.src=this.reportAddress+"?"+n,r.insertBefore(i,r.firstChild),i.onload=i.onreadystatechange=function(){this.readyState&&!/loaded|complete/.test(i.readyState)||(i.onload=i.onreadystatechange=null,r&&i.parentNode&&(r.removeChild(i),console.log("remove report ")))}}},t}();e.default=a,t.exports=e["default"]},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(269),i=function(t){return t&&t.__esModule?t:{default:t}}(r);e.default=i.default,t.exports=e["default"]},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),u=n(3),l=r(u),c=n(2),d=r(c),h=n(31),f=r(h),p=n(4),m=r(p),g=n(6),v=r(g),y=n(10),_=r(y),b=n(270),E=r(b),w=n(271),A=r(w),S=n(272),T=(r(S),n(129)),x=r(T),k=function(t){function e(n){(0,a.default)(this,e);var r=(0,s.default)(this,t.call(this,n));return r.configure(),r.hidden=!0,r}return(0,d.default)(e,t),(0,l.default)(e,[{key:"name",get:function(){return"ads_paused"}},{key:"template",get:function(){return(0,_.default)(A.default)}}]),e.prototype.bindEvents=function(){this.listenTo(this.container,m.default.CONTAINER_PLAY,this.onPlay),this.listenTo(this.container,m.default.CONTAINER_CLICK,this.onClick),this.listenTo(this.container,m.default.CONTAINER_STOP,this.onStop),this.listenTo(this.container,m.default.CONTAINER_OPTIONS_CHANGE,this.configure)},e.prototype.configure=function(){this.position="center","ads"in this.options&&"paused"in this.options.ads?(this.imageUrl=this.options.ads.paused.image,this.imageLink=this.options.ads.paused.imageLink,this.adId=this.options.ads.paused.adId,this.render(),this._adReporter=new x.default(this.options.powerStats.baseurl,this.options.powerStats.reportserver,this.options.powerStats.siteid,this.options.powerStats.contentid,this.options.powerStats.videoid,this.options.powerStats.username)):this.$el.remove()},e.prototype.onPlay=function(){this.hidden||(this.$el.hide(),this.hidden=!0)},e.prototype.onPause=function(){if(this.hidden){this.container.currentTime>3&&(this.$el.show(),this.hidden=!1)}},e.prototype.onClick=function(){if(!this.container.isPlaying()&&this.hidden){this.container.currentTime>3&&(this.$el.show(),this.hidden=!1)}},e.prototype.onStop=function(){this.$el.hide()},e.prototype.hide=function(t){t&&(this.$el.hide(),t.stopPropagation())},e.prototype.adClicked=function(t){if(t){var e={adMode:"pause",adId:this.adId};this._adReporter.send("",e),t.stopPropagation()}},e.prototype.render=function(){this.$el.hide();var t={position:this.position,imageUrl:this.imageUrl,imageLink:this.imageLink};this.$el.html(this.template(t));var e=v.default.getStyleFor(E.default);return this.container.$el.append(e),this.container.$el.append(this.$el),this},(0,l.default)(e,[{key:"events",get:function(){return{"click [data-close-button]":"hide","click [data-adspic ]":"adClicked"}}}]),e}(f.default);e.default=k,t.exports=e["default"]},function(t,e,n){e=t.exports=n(7)(!1),e.push([t.i,"[data-adspaused]{position:absolute;min-width:70px;max-width:200px;width:50%;text-align:center;z-index:998}[data-adspaused] img{max-width:100%;width:100%}[data-adspaused-bottom-left]{bottom:10px;left:10px}[data-adspaused-bottom-right]{bottom:10px;right:42px}[data-adspaused-top-left]{top:10px;left:10px}[data-adspaused-top-right]{top:10px;right:37px}[data-adspaused-center]{left:50%;top:50%;transform:translate(-50%,-50%)}[data-adspaused] a{outline:none;cursor:pointer}[data-adspaused] a.close-button{position:absolute;right:.3em;top:0;font-size:18px;cursor:pointer;color:#fff}",""])},function(t,e){t.exports='<div data-adspaused data-adspaused-<%=position %>>\r\n<a class="close-button" data-close-button>&times;</a>\r\n<% if(typeof imageLink !== \'undefined\') { %>\r\n<a data-adspic target=_blank href="<%= imageLink %>">\r\n    <% } %>\r\n    <img src="<%= imageUrl %>">\r\n    <% if(typeof imageLink !== \'undefined\') { %>\r\n</a>\r\n    <% } %>\r\n</div>\r\n'},function(t,e){t.exports='<svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 25 25" enable-background="new 0 0 25 25" xml:space="preserve"><image id="image0" width="25" height="25" x="0" y="0" xlink:href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAAZCAQAAABu4E3oAAAABGdBTUEAALGPC/xhBQAAACBjSFJN AAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAAmJLR0QA/4ePzL8AAAAHdElN RQfiCAESKCxvs4naAAAB3klEQVQ4y42Uz0sUURzAPzOzDeQkSmQdRmMZnYiwDaHNQBD3YMmCJG0X yX6whP+CHfIa7blDh8CDCWq6HdKbXiQIxe0S0w+hdP1xiMKFiXZZt0E9jIMzb3Xdz2Xe+/I+3+/7 PuY9KU6AU0S4yWUa0Mjzh+8s8pn//iWST1Hopp+ziNhMM4tTrug8JcxxZEmxdZDZdL8mz7nA8dTT hcX2odLIC85QGZUOFvkLMhBiCI2T0Rgi5Cq9FXoIEqYXZFQSVQoACVSZKHX+WPp20jicDYTTPQGl jhsy0WCa+bXElXtN7rhP729dyAp1rivmfer9kcy2U3x8bW/Hsu82Pmkbt17/EBQlRIO43bcbijRw VddixqQ1JtaAc6Gjjnd8/WJtzFjaHC0XQJMplEf79M7wx/X2Jq+nAAXFjAVPDO7og21TX1+u7O08 ijjFL7ag/FLMSxj+SNJ4EJmwRtfAsneLDyO1u59yASUjkwkmiZuzK28OepjYSH+71SJUyUhxlRFx axWwScqUSFctwDtKMjBDtkohy3v3T3ZIka9CyJPCcRXYYhj7BMFm2L3K3kXO8YHWI54Kj1WesekO PQUKzJGjmdNly3OM8Ip/3lQS3jGVKFGaOU8NBX7zk2WWKfmX7AOQ23+dcKeL+AAAACV0RVh0ZGF0 ZTpjcmVhdGUAMjAxOC0wOC0wMVQxODo0MDo0NCswODowMKaXtkQAAAAldEVYdGRhdGU6bW9kaWZ5 ADIwMTgtMDgtMDFUMTg6NDA6NDQrMDg6MDDXyg74AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFn ZVJlYWR5ccllPAAAAABJRU5ErkJggg=="></image></svg>'},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(274),i=function(t){return t&&t.__esModule?t:{default:t}}(r);e.default=i.default,t.exports=e["default"]},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),u=n(3),l=r(u),c=n(2),d=r(c),h=n(31),f=r(h),p=n(4),m=r(p),g=n(6),v=r(g),y=n(10),_=r(y),b=n(275),E=r(b),w=n(276),A=r(w),S=n(37),T=r(S),x=function(t){function e(n){(0,a.default)(this,e);var r=(0,s.default)(this,t.call(this,n));return r.template=(0,_.default)(E.default),r.showTimeout=null,T.default.on(r.options.playerId+":"+m.default.PLAYER_RESIZE,r.onPlayerResize,r),r.listenTo(r.container,m.default.CONTAINER_STATE_BUFFERING,r.onBuffering),r.listenTo(r.container,m.default.CONTAINER_STATE_BUFFERFULL,r.onBufferFull),r.listenTo(r.container,m.default.CONTAINER_READY,r.onReady),r.listenTo(r.container,m.default.CONTAINER_PLAY,r.onPlay),r.listenTo(r.container,m.default.CONTAINER_PAUSE,r.onPause),r.listenTo(r.container,m.default.CONTAINER_STOP,r.onStop),r.listenTo(r.container,m.default.CONTAINER_ENDED,r.onStop),r.listenTo(r.container,m.default.CONTAINER_ERROR,r.onStop),r.listenTo(r.container,m.default.CONTAINER_TIMEUPDATE,r.timeUpdated),r.render(),r}return(0,d.default)(e,t),(0,l.default)(e,[{key:"name",get:function(){return"comment"}},{key:"attributes",get:function(){return{"data-comment":"",class:"pwplayer-comment"}}}]),e.prototype.timeUpdated=function(t){this.cmManager&&this.cmManager.time(Math.round(t.current))},e.prototype.onPlayerResize=function(){},e.prototype.onBuffering=function(){},e.prototype.onBufferFull=function(){},e.prototype.onReady=function(){"comments"in this.options&&this.options.comments},e.prototype.onPlay=function(){this.cmManager&&this.cmManager.start()},e.prototype.onPause=function(){this.cmManager&&this.cmManager.stop()},e.prototype.onStop=function(){this.cmManager&&this.cmManager.stop()},e.prototype.render=function(){this.$el.html(this.template());var t=v.default.getStyleFor(A.default);return this.container.$el.append(t),this.container.$el.append(this.$el),this.container.buffering&&this.onBuffering(),this},e}(f.default);e.default=x,t.exports=e["default"]},function(t,e){t.exports='<div id="commentCanvas" class="container"></div>'},function(t,e,n){e=t.exports=n(7)(!1),e.push([t.i,'.comment-parent{position:relative}.comment-parent .pwplayer-comment{border:0;bottom:0;display:block;left:0;overflow:hidden;right:0;top:0;touch-callout:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;z-index:9999}.comment-parent .pwplayer-comment,.comment-parent .pwplayer-comment .cmt{margin:0;position:absolute;-webkit-transform:matrix(1,0,0,1,0,0);transform:matrix(1,0,0,1,0,0)}.comment-parent .pwplayer-comment .cmt{color:#fff;font-family:SimHei,SimSun,Heiti,MS Mincho,Meiryo,Microsoft YaHei,monospace;font-size:25px;letter-spacing:0;line-height:100%;padding:3px 0 0;text-decoration:none;text-shadow:-1px 0 #000,0 1px #000,1px 0 #000,0 -1px #000;-webkit-text-size-adjust:none;-ms-text-size-adjust:none;text-size-adjust:none;-webkit-transform-origin:0 0;-ms-transform-origin:0 0;transform-origin:0 0;white-space:pre;word-break:keep-all}.comment-parent .pwplayer-comment .cmt.noshadow{text-shadow:none}.comment-parent .pwplayer-comment .cmt.rshadow{text-shadow:-1px 0 #fff,0 1px #fff,1px 0 #fff,0 -1px #fff}@font-face{font-family:\\\\9ED1\\4F53;src:local("SimHei")}@font-face{font-family:\\\\5B8B\\4F53;src:local("SimSun")}@font-face{font-family:\\\\534E\\6587\\6977\\4F53;src:local("SimKai")}@font-face{font-family:\\\\5E7C\\5706;src:local("YouYuan")}@font-face{font-family:\\\\5FAE\\8F6F\\96C5\\9ED1;src:local("Microsoft YaHei")}',""])},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(278),i=function(t){return t&&t.__esModule?t:{default:t}}(r);e.default=i.default,t.exports=e["default"]},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(3),s=r(o),u=n(1),l=r(u),c=n(2),d=r(c),h=n(279),f=n(47),p=(r(f),n(31)),m=r(p),g=n(4),v=r(g),y=n(37),_=r(y),b=function(t){function e(n){(0,a.default)(this,e);var r=(0,l.default)(this,t.call(this,n));if(void 0===r._options.video360||!r._options.video360)return(0,l.default)(r);_.default.on(r.options.playerId+":"+v.default.PLAYER_RESIZE,r.updateSize,r);var i=n.options,o=i.height,s=i.width;i.autoplay;return n.playback.el.setAttribute("crossorigin","anonymous"),n.el.style.touchAction="none",n.el.addEventListener("touchmove",function(t){t.preventDefault()},!1),r.viewer=new h.Video({height:isNaN(o)?300:o,width:isNaN(s)?400:s,container:r.container.el,source:r.container.playback.el}),r.viewer.render(),r}return(0,d.default)(e,t),e.prototype.updateSize=function(){var t=this;setTimeout(function(){return t.viewer.setSize({height:t.container.$el.height(),width:t.container.$el.width()})},250)},(0,s.default)(e,[{key:"name",get:function(){return"Video360"}}]),e}(m.default);e.default=b,t.exports=e["default"]},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function a(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&u(t,e)}function s(t){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function u(t,e){return(u=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function l(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function c(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?l(t):e}function d(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=s(t)););return t}function h(t,e,n){return(h="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=d(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(n):i.value}})(t,e,n||t)}Object.defineProperty(e,"__esModule",{value:!0}),n.d(e,"Video",function(){return S}),n.d(e,"Image",function(){return E});var f={isiOS:function(){return/(ipad|iphone|ipod)/gi.test(navigator.userAgent)},isEdge:function(){return/(Edge)/gi.test(navigator.userAgent)},shouldUseAudioDriver:function(){var t=/iphone.*(7|8|9)_[0-9]/i.test(navigator.userAgent),e=/(iPhone|iPod).*AppleWebKit(?!.*Safari)/i.test(navigator.userAgent);return t||e},shouldUseCanvasInBetween:function(){return/trident|edge/i.test(navigator.userAgent)}},p={REVISION:"75"},m=p;void 0===Number.EPSILON&&(Number.EPSILON=Math.pow(2,-52)),void 0===Math.sign&&(Math.sign=function(t){return t<0?-1:t>0?1:+t}),void 0===Function.prototype.name&&void 0!==Object.defineProperty&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*(\S*)\s*\(/)[1]}}),void 0===Object.assign&&Object.defineProperty(Object,"assign",{writable:!0,configurable:!0,value:function(t){if(void 0===t||null===t)throw new TypeError("Cannot convert first argument to object");for(var e=Object(t),n=1,r=arguments.length;n!==r;++n){var i=arguments[n];if(void 0!==i&&null!==i){i=Object(i);for(var a=Object.keys(i),o=0,s=a.length;o!==s;++o){var u=a[o],l=Object.getOwnPropertyDescriptor(i,u);void 0!==l&&l.enumerable&&(e[u]=i[u])}}}return e}}),p.MOUSE={LEFT:0,MIDDLE:1,RIGHT:2},p.CullFaceNone=0,p.CullFaceBack=1,p.CullFaceFront=2,p.CullFaceFrontBack=3,p.FrontFaceDirectionCW=0,p.FrontFaceDirectionCCW=1,p.BasicShadowMap=0,p.PCFShadowMap=1,p.PCFSoftShadowMap=2,p.FrontSide=0,p.BackSide=1,p.DoubleSide=2,p.FlatShading=1,p.SmoothShading=2,p.NoColors=0,p.FaceColors=1,p.VertexColors=2,p.NoBlending=0,p.NormalBlending=1,p.AdditiveBlending=2,p.SubtractiveBlending=3,p.MultiplyBlending=4,p.CustomBlending=5,p.AddEquation=100,p.SubtractEquation=101,p.ReverseSubtractEquation=102,p.MinEquation=103,p.MaxEquation=104,p.ZeroFactor=200,p.OneFactor=201,p.SrcColorFactor=202,p.OneMinusSrcColorFactor=203,p.SrcAlphaFactor=204,p.OneMinusSrcAlphaFactor=205,p.DstAlphaFactor=206,p.OneMinusDstAlphaFactor=207,p.DstColorFactor=208,p.OneMinusDstColorFactor=209,p.SrcAlphaSaturateFactor=210,p.NeverDepth=0,p.AlwaysDepth=1,p.LessDepth=2,p.LessEqualDepth=3,p.EqualDepth=4,p.GreaterEqualDepth=5,p.GreaterDepth=6,p.NotEqualDepth=7,p.MultiplyOperation=0,p.MixOperation=1,p.AddOperation=2,p.NoToneMapping=0,p.LinearToneMapping=1,p.ReinhardToneMapping=2,p.Uncharted2ToneMapping=3,p.CineonToneMapping=4,p.UVMapping=300,p.CubeReflectionMapping=301,p.CubeRefractionMapping=302,p.EquirectangularReflectionMapping=303,p.EquirectangularRefractionMapping=304,p.SphericalReflectionMapping=305,p.CubeUVReflectionMapping=306,p.CubeUVRefractionMapping=307,p.RepeatWrapping=1e3,p.ClampToEdgeWrapping=1001,p.MirroredRepeatWrapping=1002,p.NearestFilter=1003,p.NearestMipMapNearestFilter=1004,p.NearestMipMapLinearFilter=1005,p.LinearFilter=1006,p.LinearMipMapNearestFilter=1007,p.LinearMipMapLinearFilter=1008,p.UnsignedByteType=1009,p.ByteType=1010,p.ShortType=1011,p.UnsignedShortType=1012,p.IntType=1013,p.UnsignedIntType=1014,p.FloatType=1015,p.HalfFloatType=1025,p.UnsignedShort4444Type=1016,p.UnsignedShort5551Type=1017,p.UnsignedShort565Type=1018,p.AlphaFormat=1019,p.RGBFormat=1020,p.RGBAFormat=1021,p.LuminanceFormat=1022,p.LuminanceAlphaFormat=1023,p.RGBEFormat=p.RGBAFormat,p.RGB_S3TC_DXT1_Format=2001,p.RGBA_S3TC_DXT1_Format=2002,p.RGBA_S3TC_DXT3_Format=2003,p.RGBA_S3TC_DXT5_Format=2004,p.RGB_PVRTC_4BPPV1_Format=2100,p.RGB_PVRTC_2BPPV1_Format=2101,p.RGBA_PVRTC_4BPPV1_Format=2102,p.RGBA_PVRTC_2BPPV1_Format=2103,p.RGB_ETC1_Format=2151,p.LoopOnce=2200,p.LoopRepeat=2201,p.LoopPingPong=2202,p.InterpolateDiscrete=2300,p.InterpolateLinear=2301,p.InterpolateSmooth=2302,p.ZeroCurvatureEnding=2400,p.ZeroSlopeEnding=2401,p.WrapAroundEnding=2402,p.TrianglesDrawMode=0,p.TriangleStripDrawMode=1,p.TriangleFanDrawMode=2,p.LinearEncoding=3e3,p.sRGBEncoding=3001,p.GammaEncoding=3007,p.RGBEEncoding=3002,p.LogLuvEncoding=3003,p.RGBM7Encoding=3004,p.RGBM16Encoding=3005,p.RGBDEncoding=3006,p.Math={generateUUID:function(){var t,e="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),n=new Array(36),r=0;return function(){for(var i=0;i<36;i++)8===i||13===i||18===i||23===i?n[i]="-":14===i?n[i]="4":(r<=2&&(r=33554432+16777216*Math.random()|0),t=15&r,r>>=4,n[i]=e[19===i?3&t|8:t]);return n.join("")}}(),clamp:function(t,e,n){return Math.max(e,Math.min(n,t))},euclideanModulo:function(t,e){return(t%e+e)%e},mapLinear:function(t,e,n,r,i){return r+(t-e)*(i-r)/(n-e)},smoothstep:function(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e))*t*(3-2*t)},smootherstep:function(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e))*t*t*(t*(6*t-15)+10)},random16:function(){return Math.random()},randInt:function(t,e){return t+Math.floor(Math.random()*(e-t+1))},randFloat:function(t,e){return t+Math.random()*(e-t)},randFloatSpread:function(t){return t*(.5-Math.random())},degToRad:function(){var t=Math.PI/180;return function(e){return e*t}}(),radToDeg:function(){var t=180/Math.PI;return function(e){return e*t}}(),isPowerOfTwo:function(t){return 0==(t&t-1)&&0!==t},nearestPowerOfTwo:function(t){return Math.pow(2,Math.round(Math.log(t)/Math.LN2))},nextPowerOfTwo:function(t){return t--,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,t|=t>>16,++t}},p.Color=function(t){return 3===arguments.length?this.fromArray(arguments):this.set(t)},p.Color.prototype={constructor:p.Color,r:1,g:1,b:1,set:function(t){return t instanceof p.Color?this.copy(t):"number"==typeof t?this.setHex(t):"string"==typeof t&&this.setStyle(t),this},setScalar:function(t){this.r=t,this.g=t,this.b=t},setHex:function(t){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,this},setRGB:function(t,e,n){return this.r=t,this.g=e,this.b=n,this},setHSL:function(){function t(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+6*(e-t)*n:n<.5?e:n<2/3?t+6*(e-t)*(2/3-n):t}return function(e,n,r){if(e=p.Math.euclideanModulo(e,1),n=p.Math.clamp(n,0,1),r=p.Math.clamp(r,0,1),0===n)this.r=this.g=this.b=r;else{var i=r<=.5?r*(1+n):r+n-r*n,a=2*r-i;this.r=t(a,i,e+1/3),this.g=t(a,i,e),this.b=t(a,i,e-1/3)}return this}}(),setStyle:function(t){var e;if(e=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(t)){var n,r=e[1],i=e[2];switch(r){case"rgb":case"rgba":if(n=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(i))return this.r=Math.min(255,parseInt(n[1],10))/255,this.g=Math.min(255,parseInt(n[2],10))/255,this.b=Math.min(255,parseInt(n[3],10))/255,n[5],this;if(n=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(i))return this.r=Math.min(100,parseInt(n[1],10))/100,this.g=Math.min(100,parseInt(n[2],10))/100,this.b=Math.min(100,parseInt(n[3],10))/100,n[5],this;break;case"hsl":case"hsla":if(n=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(i)){var a=parseFloat(n[1])/360,o=parseInt(n[2],10)/100,s=parseInt(n[3],10)/100;return n[5],this.setHSL(a,o,s)}}}else if(e=/^\#([A-Fa-f0-9]+)$/.exec(t)){var u=e[1],l=u.length;if(3===l)return this.r=parseInt(u.charAt(0)+u.charAt(0),16)/255,this.g=parseInt(u.charAt(1)+u.charAt(1),16)/255,this.b=parseInt(u.charAt(2)+u.charAt(2),16)/255,this;if(6===l)return this.r=parseInt(u.charAt(0)+u.charAt(1),16)/255,this.g=parseInt(u.charAt(2)+u.charAt(3),16)/255,this.b=parseInt(u.charAt(4)+u.charAt(5),16)/255,this}if(t&&t.length>0){var u=p.ColorKeywords[t];void 0!==u&&this.setHex(u)}return this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this},copyGammaToLinear:function(t,e){return void 0===e&&(e=2),this.r=Math.pow(t.r,e),this.g=Math.pow(t.g,e),this.b=Math.pow(t.b,e),this},copyLinearToGamma:function(t,e){void 0===e&&(e=2);var n=e>0?1/e:1;return this.r=Math.pow(t.r,n),this.g=Math.pow(t.g,n),this.b=Math.pow(t.b,n),this},convertGammaToLinear:function(){var t=this.r,e=this.g,n=this.b;return this.r=t*t,this.g=e*e,this.b=n*n,this},convertLinearToGamma:function(){return this.r=Math.sqrt(this.r),this.g=Math.sqrt(this.g),this.b=Math.sqrt(this.b),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(t){var e,n,r=t||{h:0,s:0,l:0},i=this.r,a=this.g,o=this.b,s=Math.max(i,a,o),u=Math.min(i,a,o),l=(u+s)/2;if(u===s)e=0,n=0;else{var c=s-u;switch(n=l<=.5?c/(s+u):c/(2-s-u),s){case i:e=(a-o)/c+(a<o?6:0);break;case a:e=(o-i)/c+2;break;case o:e=(i-a)/c+4}e/=6}return r.h=e,r.s=n,r.l=l,r},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(t,e,n){var r=this.getHSL();return r.h+=t,r.s+=e,r.l+=n,this.setHSL(r.h,r.s,r.l),this},add:function(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this},addColors:function(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this},addScalar:function(t){return this.r+=t,this.g+=t,this.b+=t,this},multiply:function(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this},multiplyScalar:function(t){return this.r*=t,this.g*=t,this.b*=t,this},lerp:function(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this},equals:function(t){return t.r===this.r&&t.g===this.g&&t.b===this.b},fromArray:function(t,e){return void 0===e&&(e=0),this.r=t[e],this.g=t[e+1],this.b=t[e+2],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t}},p.ColorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},p.Vector2=function(t,e){this.x=t||0,this.y=e||0},p.Vector2.prototype={constructor:p.Vector2,get width(){return this.x},set width(t){this.x=t},get height(){return this.y},set height(t){this.y=t},set:function(t,e){return this.x=t,this.y=e,this},setScalar:function(t){return this.x=t,this.y=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(t){return this.x=t.x,this.y=t.y,this},add:function(t,e){return void 0!==e?this.addVectors(t,e):(this.x+=t.x,this.y+=t.y,this)},addScalar:function(t){return this.x+=t,this.y+=t,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this},addScaledVector:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this},sub:function(t,e){return void 0!==e?this.subVectors(t,e):(this.x-=t.x,this.y-=t.y,this)},subScalar:function(t){return this.x-=t,this.y-=t,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this},multiply:function(t){return this.x*=t.x,this.y*=t.y,this},multiplyScalar:function(t){return isFinite(t)?(this.x*=t,this.y*=t):(this.x=0,this.y=0),this},divide:function(t){return this.x/=t.x,this.y/=t.y,this},divideScalar:function(t){return this.multiplyScalar(1/t)},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this},clamp:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this},clampScalar:function(){var t,e;return function(n,r){return void 0===t&&(t=new p.Vector2,e=new p.Vector2),t.set(n,n),e.set(r,r),this.clamp(t,e)}}(),clampLength:function(t,e){var n=this.length();return this.multiplyScalar(Math.max(t,Math.min(e,n))/n),this},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(t){return this.x*t.x+this.y*t.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length())},angle:function(){var t=Math.atan2(this.y,this.x);return t<0&&(t+=2*Math.PI),t},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var e=this.x-t.x,n=this.y-t.y;return e*e+n*n},setLength:function(t){return this.multiplyScalar(t/this.length())},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this},lerpVectors:function(t,e,n){return this.subVectors(e,t).multiplyScalar(n).add(t),this},equals:function(t){return t.x===this.x&&t.y===this.y},fromArray:function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t},fromAttribute:function(t,e,n){return void 0===n&&(n=0),e=e*t.itemSize+n,this.x=t.array[e],this.y=t.array[e+1],this},rotateAround:function(t,e){var n=Math.cos(e),r=Math.sin(e),i=this.x-t.x,a=this.y-t.y;return this.x=i*n-a*r+t.x,this.y=i*r+a*n+t.y,this}},p.Vector3=function(t,e,n){this.x=t||0,this.y=e||0,this.z=n||0},p.Vector3.prototype={constructor:p.Vector3,set:function(t,e,n){return this.x=t,this.y=e,this.z=n,this},setScalar:function(t){return this.x=t,this.y=t,this.z=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setZ:function(t){return this.z=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},add:function(t,e){return void 0!==e?this.addVectors(t,e):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)},addScalar:function(t){return this.x+=t,this.y+=t,this.z+=t,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this},addScaledVector:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this},sub:function(t,e){return void 0!==e?this.subVectors(t,e):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)},subScalar:function(t){return this.x-=t,this.y-=t,this.z-=t,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this},multiply:function(t,e){return void 0!==e?this.multiplyVectors(t,e):(this.x*=t.x,this.y*=t.y,this.z*=t.z,this)},multiplyScalar:function(t){return isFinite(t)?(this.x*=t,this.y*=t,this.z*=t):(this.x=0,this.y=0,this.z=0),this},multiplyVectors:function(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this},applyEuler:function(){var t;return function(e){return void 0===t&&(t=new p.Quaternion),this.applyQuaternion(t.setFromEuler(e)),this}}(),applyAxisAngle:function(){var t;return function(e,n){return void 0===t&&(t=new p.Quaternion),this.applyQuaternion(t.setFromAxisAngle(e,n)),this}}(),applyMatrix3:function(t){var e=this.x,n=this.y,r=this.z,i=t.elements;return this.x=i[0]*e+i[3]*n+i[6]*r,this.y=i[1]*e+i[4]*n+i[7]*r,this.z=i[2]*e+i[5]*n+i[8]*r,this},applyMatrix4:function(t){var e=this.x,n=this.y,r=this.z,i=t.elements;return this.x=i[0]*e+i[4]*n+i[8]*r+i[12],this.y=i[1]*e+i[5]*n+i[9]*r+i[13],this.z=i[2]*e+i[6]*n+i[10]*r+i[14],this},applyProjection:function(t){var e=this.x,n=this.y,r=this.z,i=t.elements,a=1/(i[3]*e+i[7]*n+i[11]*r+i[15]);return this.x=(i[0]*e+i[4]*n+i[8]*r+i[12])*a,this.y=(i[1]*e+i[5]*n+i[9]*r+i[13])*a,this.z=(i[2]*e+i[6]*n+i[10]*r+i[14])*a,this},applyQuaternion:function(t){var e=this.x,n=this.y,r=this.z,i=t.x,a=t.y,o=t.z,s=t.w,u=s*e+a*r-o*n,l=s*n+o*e-i*r,c=s*r+i*n-a*e,d=-i*e-a*n-o*r;return this.x=u*s+d*-i+l*-o-c*-a,this.y=l*s+d*-a+c*-i-u*-o,this.z=c*s+d*-o+u*-a-l*-i,this},project:function(){var t;return function(e){return void 0===t&&(t=new p.Matrix4),t.multiplyMatrices(e.projectionMatrix,t.getInverse(e.matrixWorld)),this.applyProjection(t)}}(),unproject:function(){var t;return function(e){return void 0===t&&(t=new p.Matrix4),t.multiplyMatrices(e.matrixWorld,t.getInverse(e.projectionMatrix)),this.applyProjection(t)}}(),transformDirection:function(t){var e=this.x,n=this.y,r=this.z,i=t.elements;return this.x=i[0]*e+i[4]*n+i[8]*r,this.y=i[1]*e+i[5]*n+i[9]*r,this.z=i[2]*e+i[6]*n+i[10]*r,this.normalize(),this},divide:function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this},divideScalar:function(t){return this.multiplyScalar(1/t)},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this},clamp:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this},clampScalar:function(){var t,e;return function(n,r){return void 0===t&&(t=new p.Vector3,e=new p.Vector3),t.set(n,n,n),e.set(r,r,r),this.clamp(t,e)}}(),clampLength:function(t,e){var n=this.length();return this.multiplyScalar(Math.max(t,Math.min(e,n))/n),this},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(t){return this.multiplyScalar(t/this.length())},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this},lerpVectors:function(t,e,n){return this.subVectors(e,t).multiplyScalar(n).add(t),this},cross:function(t,e){if(void 0!==e)return this.crossVectors(t,e);var n=this.x,r=this.y,i=this.z;return this.x=r*t.z-i*t.y,this.y=i*t.x-n*t.z,this.z=n*t.y-r*t.x,this},crossVectors:function(t,e){var n=t.x,r=t.y,i=t.z,a=e.x,o=e.y,s=e.z;return this.x=r*s-i*o,this.y=i*a-n*s,this.z=n*o-r*a,this},projectOnVector:function(){var t,e;return function(n){return void 0===t&&(t=new p.Vector3),t.copy(n).normalize(),e=this.dot(t),this.copy(t).multiplyScalar(e)}}(),projectOnPlane:function(){var t;return function(e){return void 0===t&&(t=new p.Vector3),t.copy(this).projectOnVector(e),this.sub(t)}}(),reflect:function(){var t;return function(e){return void 0===t&&(t=new p.Vector3),this.sub(t.copy(e).multiplyScalar(2*this.dot(e)))}}(),angleTo:function(t){var e=this.dot(t)/Math.sqrt(this.lengthSq()*t.lengthSq());return Math.acos(p.Math.clamp(e,-1,1))},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var e=this.x-t.x,n=this.y-t.y,r=this.z-t.z;return e*e+n*n+r*r},setFromSpherical:function(t){var e=Math.sin(t.phi)*t.radius;return this.x=e*Math.sin(t.theta),this.y=Math.cos(t.phi)*t.radius,this.z=e*Math.cos(t.theta),this},setFromMatrixPosition:function(t){return this.setFromMatrixColumn(t,3)},setFromMatrixScale:function(t){var e=this.setFromMatrixColumn(t,0).length(),n=this.setFromMatrixColumn(t,1).length(),r=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=n,this.z=r,this},setFromMatrixColumn:function(t,e){return"number"==typeof t&&(t=arguments[1],e=arguments[0]),this.fromArray(t.elements,4*e)},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z},fromArray:function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this.z=t[e+2],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t},fromAttribute:function(t,e,n){return void 0===n&&(n=0),e=e*t.itemSize+n,this.x=t.array[e],this.y=t.array[e+1],this.z=t.array[e+2],this}},p.Vector4=function(t,e,n,r){this.x=t||0,this.y=e||0,this.z=n||0,this.w=void 0!==r?r:1},p.Vector4.prototype={constructor:p.Vector4,set:function(t,e,n,r){return this.x=t,this.y=e,this.z=n,this.w=r,this},setScalar:function(t){return this.x=t,this.y=t,this.z=t,this.w=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setZ:function(t){return this.z=t,this},setW:function(t){return this.w=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=void 0!==t.w?t.w:1,this},add:function(t,e){return void 0!==e?this.addVectors(t,e):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this)},addScalar:function(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this},addScaledVector:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this},sub:function(t,e){return void 0!==e?this.subVectors(t,e):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this)},subScalar:function(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this},multiplyScalar:function(t){return isFinite(t)?(this.x*=t,this.y*=t,this.z*=t,this.w*=t):(this.x=0,this.y=0,this.z=0,this.w=0),this},applyMatrix4:function(t){var e=this.x,n=this.y,r=this.z,i=this.w,a=t.elements;return this.x=a[0]*e+a[4]*n+a[8]*r+a[12]*i,this.y=a[1]*e+a[5]*n+a[9]*r+a[13]*i,this.z=a[2]*e+a[6]*n+a[10]*r+a[14]*i,this.w=a[3]*e+a[7]*n+a[11]*r+a[15]*i,this},divideScalar:function(t){return this.multiplyScalar(1/t)},setAxisAngleFromQuaternion:function(t){this.w=2*Math.acos(t.w);var e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this},setAxisAngleFromRotationMatrix:function(t){var e,n,r,i,a=t.elements,o=a[0],s=a[4],u=a[8],l=a[1],c=a[5],d=a[9],h=a[2],f=a[6],p=a[10];if(Math.abs(s-l)<.01&&Math.abs(u-h)<.01&&Math.abs(d-f)<.01){if(Math.abs(s+l)<.1&&Math.abs(u+h)<.1&&Math.abs(d+f)<.1&&Math.abs(o+c+p-3)<.1)return this.set(1,0,0,0),this;e=Math.PI;var m=(o+1)/2,g=(c+1)/2,v=(p+1)/2,y=(s+l)/4,_=(u+h)/4,b=(d+f)/4;return m>g&&m>v?m<.01?(n=0,r=.707106781,i=.707106781):(n=Math.sqrt(m),r=y/n,i=_/n):g>v?g<.01?(n=.707106781,r=0,i=.707106781):(r=Math.sqrt(g),n=y/r,i=b/r):v<.01?(n=.707106781,r=.707106781,i=0):(i=Math.sqrt(v),n=_/i,r=b/i),this.set(n,r,i,e),this}var E=Math.sqrt((f-d)*(f-d)+(u-h)*(u-h)+(l-s)*(l-s));return Math.abs(E)<.001&&(E=1),this.x=(f-d)/E,this.y=(u-h)/E,this.z=(l-s)/E,this.w=Math.acos((o+c+p-1)/2),this},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this},clamp:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this},clampScalar:function(){var t,e;return function(n,r){return void 0===t&&(t=new p.Vector4,e=new p.Vector4),t.set(n,n,n,n),e.set(r,r,r,r),this.clamp(t,e)}}(),floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length())},setLength:function(t){return this.multiplyScalar(t/this.length())},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this},lerpVectors:function(t,e,n){return this.subVectors(e,t).multiplyScalar(n).add(t),this},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w},fromArray:function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t},fromAttribute:function(t,e,n){return void 0===n&&(n=0),e=e*t.itemSize+n,this.x=t.array[e],this.y=t.array[e+1],this.z=t.array[e+2],this.w=t.array[e+3],this}},p.Matrix3=function(){this.elements=new Float32Array([1,0,0,0,1,0,0,0,1])},p.Matrix3.prototype={constructor:p.Matrix3,set:function(t,e,n,r,i,a,o,s,u){var l=this.elements;return l[0]=t,l[1]=r,l[2]=o,l[3]=e,l[4]=i,l[5]=s,l[6]=n,l[7]=a,l[8]=u,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},clone:function(){return(new this.constructor).fromArray(this.elements)},copy:function(t){var e=t.elements;return this.set(e[0],e[3],e[6],e[1],e[4],e[7],e[2],e[5],e[8]),this},setFromMatrix4:function(t){var e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this},applyToVector3Array:function(){var t;return function(e,n,r){void 0===t&&(t=new p.Vector3),void 0===n&&(n=0),void 0===r&&(r=e.length);for(var i=0,a=n;i<r;i+=3,a+=3)t.fromArray(e,a),t.applyMatrix3(this),t.toArray(e,a);return e}}(),applyToBuffer:function(){var t;return function(e,n,r){void 0===t&&(t=new p.Vector3),void 0===n&&(n=0),void 0===r&&(r=e.length/e.itemSize);for(var i=0,a=n;i<r;i++,a++)t.x=e.getX(a),t.y=e.getY(a),t.z=e.getZ(a),t.applyMatrix3(this),e.setXYZ(t.x,t.y,t.z);return e}}(),multiplyScalar:function(t){var e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this},determinant:function(){var t=this.elements,e=t[0],n=t[1],r=t[2],i=t[3],a=t[4],o=t[5],s=t[6],u=t[7],l=t[8];return e*a*l-e*o*u-n*i*l+n*o*s+r*i*u-r*a*s},getInverse:function(t,e){var n=t.elements,r=this.elements,i=n[0],a=n[1],o=n[2],s=n[3],u=n[4],l=n[5],c=n[6],d=n[7],h=n[8],f=h*u-l*d,p=l*c-h*s,m=d*s-u*c,g=i*f+a*p+o*m;if(0===g){if(e)throw new Error("THREE.Matrix3.getInverse(): can't invert matrix, determinant is 0");return this.identity()}return r[0]=f,r[1]=o*d-h*a,r[2]=l*a-o*u,r[3]=p,r[4]=h*i-o*c,r[5]=o*s-l*i,r[6]=m,r[7]=a*c-d*i,r[8]=u*i-a*s,this.multiplyScalar(1/g)},transpose:function(){var t,e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this},flattenToArrayOffset:function(t,e){var n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t},getNormalMatrix:function(t){return this.setFromMatrix4(t).getInverse(this).transpose()},transposeIntoArray:function(t){var e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this},fromArray:function(t){return this.elements.set(t),this},toArray:function(){var t=this.elements;return[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8]]}},p.Matrix4=function(){this.elements=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])},p.Matrix4.prototype={constructor:p.Matrix4,set:function(t,e,n,r,i,a,o,s,u,l,c,d,h,f,p,m){var g=this.elements;return g[0]=t,g[4]=e,g[8]=n,g[12]=r,g[1]=i,g[5]=a,g[9]=o,g[13]=s,g[2]=u,g[6]=l,g[10]=c,g[14]=d,g[3]=h,g[7]=f,g[11]=p,g[15]=m,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return(new p.Matrix4).fromArray(this.elements)},copy:function(t){return this.elements.set(t.elements),this},copyPosition:function(t){var e=this.elements,n=t.elements;return e[12]=n[12],e[13]=n[13],e[14]=n[14],this},extractBasis:function(t,e,n){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this},makeBasis:function(t,e,n){return this.set(t.x,e.x,n.x,0,t.y,e.y,n.y,0,t.z,e.z,n.z,0,0,0,0,1),this},extractRotation:function(){var t;return function(e){void 0===t&&(t=new p.Vector3);var n=this.elements,r=e.elements,i=1/t.setFromMatrixColumn(e,0).length(),a=1/t.setFromMatrixColumn(e,1).length(),o=1/t.setFromMatrixColumn(e,2).length();return n[0]=r[0]*i,n[1]=r[1]*i,n[2]=r[2]*i,n[4]=r[4]*a,n[5]=r[5]*a,n[6]=r[6]*a,n[8]=r[8]*o,n[9]=r[9]*o,n[10]=r[10]*o,this}}(),makeRotationFromEuler:function(t){var e=this.elements,n=t.x,r=t.y,i=t.z,a=Math.cos(n),o=Math.sin(n),s=Math.cos(r),u=Math.sin(r),l=Math.cos(i),c=Math.sin(i);if("XYZ"===t.order){var d=a*l,h=a*c,f=o*l,p=o*c;e[0]=s*l,e[4]=-s*c,e[8]=u,e[1]=h+f*u,e[5]=d-p*u,e[9]=-o*s,e[2]=p-d*u,e[6]=f+h*u,e[10]=a*s}else if("YXZ"===t.order){var m=s*l,g=s*c,v=u*l,y=u*c;e[0]=m+y*o,e[4]=v*o-g,e[8]=a*u,e[1]=a*c,e[5]=a*l,e[9]=-o,e[2]=g*o-v,e[6]=y+m*o,e[10]=a*s}else if("ZXY"===t.order){var m=s*l,g=s*c,v=u*l,y=u*c;e[0]=m-y*o,e[4]=-a*c,e[8]=v+g*o,e[1]=g+v*o,e[5]=a*l,e[9]=y-m*o,e[2]=-a*u,e[6]=o,e[10]=a*s}else if("ZYX"===t.order){var d=a*l,h=a*c,f=o*l,p=o*c;e[0]=s*l,e[4]=f*u-h,e[8]=d*u+p,e[1]=s*c,e[5]=p*u+d,e[9]=h*u-f,e[2]=-u,e[6]=o*s,e[10]=a*s}else if("YZX"===t.order){var _=a*s,b=a*u,E=o*s,w=o*u;e[0]=s*l,e[4]=w-_*c,e[8]=E*c+b,e[1]=c,e[5]=a*l,e[9]=-o*l,e[2]=-u*l,e[6]=b*c+E,e[10]=_-w*c}else if("XZY"===t.order){var _=a*s,b=a*u,E=o*s,w=o*u;e[0]=s*l,e[4]=-c,e[8]=u*l,e[1]=_*c+w,e[5]=a*l,e[9]=b*c-E,e[2]=E*c-b,e[6]=o*l,e[10]=w*c+_}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this},makeRotationFromQuaternion:function(t){var e=this.elements,n=t.x,r=t.y,i=t.z,a=t.w,o=n+n,s=r+r,u=i+i,l=n*o,c=n*s,d=n*u,h=r*s,f=r*u,p=i*u,m=a*o,g=a*s,v=a*u;return e[0]=1-(h+p),e[4]=c-v,e[8]=d+g,e[1]=c+v,e[5]=1-(l+p),e[9]=f-m,e[2]=d-g,e[6]=f+m,e[10]=1-(l+h),e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this},lookAt:function(){var t,e,n;return function(r,i,a){void 0===t&&(t=new p.Vector3),void 0===e&&(e=new p.Vector3),void 0===n&&(n=new p.Vector3);var o=this.elements;return n.subVectors(r,i).normalize(),0===n.lengthSq()&&(n.z=1),t.crossVectors(a,n).normalize(),0===t.lengthSq()&&(n.x+=1e-4,t.crossVectors(a,n).normalize()),e.crossVectors(n,t),o[0]=t.x,o[4]=e.x,o[8]=n.x,o[1]=t.y,o[5]=e.y,o[9]=n.y,o[2]=t.z,o[6]=e.z,o[10]=n.z,this}}(),multiply:function(t,e){return void 0!==e?this.multiplyMatrices(t,e):this.multiplyMatrices(this,t)},multiplyMatrices:function(t,e){var n=t.elements,r=e.elements,i=this.elements,a=n[0],o=n[4],s=n[8],u=n[12],l=n[1],c=n[5],d=n[9],h=n[13],f=n[2],p=n[6],m=n[10],g=n[14],v=n[3],y=n[7],_=n[11],b=n[15],E=r[0],w=r[4],A=r[8],S=r[12],T=r[1],x=r[5],k=r[9],C=r[13],M=r[2],R=r[6],L=r[10],I=r[14],P=r[3],O=r[7],D=r[11],N=r[15];return i[0]=a*E+o*T+s*M+u*P,i[4]=a*w+o*x+s*R+u*O,i[8]=a*A+o*k+s*L+u*D,i[12]=a*S+o*C+s*I+u*N,i[1]=l*E+c*T+d*M+h*P,i[5]=l*w+c*x+d*R+h*O,i[9]=l*A+c*k+d*L+h*D,i[13]=l*S+c*C+d*I+h*N,i[2]=f*E+p*T+m*M+g*P,i[6]=f*w+p*x+m*R+g*O,i[10]=f*A+p*k+m*L+g*D,i[14]=f*S+p*C+m*I+g*N,i[3]=v*E+y*T+_*M+b*P,i[7]=v*w+y*x+_*R+b*O,i[11]=v*A+y*k+_*L+b*D,i[15]=v*S+y*C+_*I+b*N,this},multiplyToArray:function(t,e,n){var r=this.elements;return this.multiplyMatrices(t,e),n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=r[3],n[4]=r[4],n[5]=r[5],n[6]=r[6],n[7]=r[7],n[8]=r[8],n[9]=r[9],n[10]=r[10],n[11]=r[11],n[12]=r[12],n[13]=r[13],n[14]=r[14],n[15]=r[15],this},multiplyScalar:function(t){var e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this},applyToVector3Array:function(){var t;return function(e,n,r){void 0===t&&(t=new p.Vector3),void 0===n&&(n=0),void 0===r&&(r=e.length);for(var i=0,a=n;i<r;i+=3,a+=3)t.fromArray(e,a),t.applyMatrix4(this),t.toArray(e,a);return e}}(),applyToBuffer:function(){var t;return function(e,n,r){void 0===t&&(t=new p.Vector3),void 0===n&&(n=0),void 0===r&&(r=e.length/e.itemSize);for(var i=0,a=n;i<r;i++,a++)t.x=e.getX(a),t.y=e.getY(a),t.z=e.getZ(a),t.applyMatrix4(this),e.setXYZ(t.x,t.y,t.z);return e}}(),determinant:function(){var t=this.elements,e=t[0],n=t[4],r=t[8],i=t[12],a=t[1],o=t[5],s=t[9],u=t[13],l=t[2],c=t[6],d=t[10],h=t[14];return t[3]*(+i*s*c-r*u*c-i*o*d+n*u*d+r*o*h-n*s*h)+t[7]*(+e*s*h-e*u*d+i*a*d-r*a*h+r*u*l-i*s*l)+t[11]*(+e*u*c-e*o*h-i*a*c+n*a*h+i*o*l-n*u*l)+t[15]*(-r*o*l-e*s*c+e*o*d+r*a*c-n*a*d+n*s*l)},transpose:function(){var t,e=this.elements;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this},flattenToArrayOffset:function(t,e){var n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t[e+9]=n[9],t[e+10]=n[10],t[e+11]=n[11],t[e+12]=n[12],t[e+13]=n[13],t[e+14]=n[14],t[e+15]=n[15],t},getPosition:function(){var t;return function(){return void 0===t&&(t=new p.Vector3),t.setFromMatrixColumn(this,3)}}(),setPosition:function(t){var e=this.elements;return e[12]=t.x,e[13]=t.y,e[14]=t.z,this},getInverse:function(t,e){var n=this.elements,r=t.elements,i=r[0],a=r[1],o=r[2],s=r[3],u=r[4],l=r[5],c=r[6],d=r[7],h=r[8],f=r[9],p=r[10],m=r[11],g=r[12],v=r[13],y=r[14],_=r[15],b=f*y*d-v*p*d+v*c*m-l*y*m-f*c*_+l*p*_,E=g*p*d-h*y*d-g*c*m+u*y*m+h*c*_-u*p*_,w=h*v*d-g*f*d+g*l*m-u*v*m-h*l*_+u*f*_,A=g*f*c-h*v*c-g*l*p+u*v*p+h*l*y-u*f*y,S=i*b+a*E+o*w+s*A;if(0===S){if(e)throw new Error("THREE.Matrix4.getInverse(): can't invert matrix, determinant is 0");return this.identity()}return n[0]=b,n[1]=v*p*s-f*y*s-v*o*m+a*y*m+f*o*_-a*p*_,n[2]=l*y*s-v*c*s+v*o*d-a*y*d-l*o*_+a*c*_,n[3]=f*c*s-l*p*s-f*o*d+a*p*d+l*o*m-a*c*m,n[4]=E,n[5]=h*y*s-g*p*s+g*o*m-i*y*m-h*o*_+i*p*_,n[6]=g*c*s-u*y*s-g*o*d+i*y*d+u*o*_-i*c*_,n[7]=u*p*s-h*c*s+h*o*d-i*p*d-u*o*m+i*c*m,n[8]=w,n[9]=g*f*s-h*v*s-g*a*m+i*v*m+h*a*_-i*f*_,n[10]=u*v*s-g*l*s+g*a*d-i*v*d-u*a*_+i*l*_,n[11]=h*l*s-u*f*s-h*a*d+i*f*d+u*a*m-i*l*m,n[12]=A,n[13]=h*v*o-g*f*o+g*a*p-i*v*p-h*a*y+i*f*y,n[14]=g*l*o-u*v*o-g*a*c+i*v*c+u*a*y-i*l*y,n[15]=u*f*o-h*l*o+h*a*c-i*f*c-u*a*p+i*l*p,this.multiplyScalar(1/S)},scale:function(t){var e=this.elements,n=t.x,r=t.y,i=t.z;return e[0]*=n,e[4]*=r,e[8]*=i,e[1]*=n,e[5]*=r,e[9]*=i,e[2]*=n,e[6]*=r,e[10]*=i,e[3]*=n,e[7]*=r,e[11]*=i,this},getMaxScaleOnAxis:function(){var t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],n=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],r=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,n,r))},makeTranslation:function(t,e,n){return this.set(1,0,0,t,0,1,0,e,0,0,1,n,0,0,0,1),this},makeRotationX:function(t){var e=Math.cos(t),n=Math.sin(t);return this.set(1,0,0,0,0,e,-n,0,0,n,e,0,0,0,0,1),this},makeRotationY:function(t){var e=Math.cos(t),n=Math.sin(t);return this.set(e,0,n,0,0,1,0,0,-n,0,e,0,0,0,0,1),this},makeRotationZ:function(t){var e=Math.cos(t),n=Math.sin(t);return this.set(e,-n,0,0,n,e,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(t,e){var n=Math.cos(e),r=Math.sin(e),i=1-n,a=t.x,o=t.y,s=t.z,u=i*a,l=i*o;return this.set(u*a+n,u*o-r*s,u*s+r*o,0,u*o+r*s,l*o+n,l*s-r*a,0,u*s-r*o,l*s+r*a,i*s*s+n,0,0,0,0,1),this},makeScale:function(t,e,n){return this.set(t,0,0,0,0,e,0,0,0,0,n,0,0,0,0,1),this},compose:function(t,e,n){return this.makeRotationFromQuaternion(e),this.scale(n),this.setPosition(t),this},decompose:function(){var t,e;return function(n,r,i){void 0===t&&(t=new p.Vector3),void 0===e&&(e=new p.Matrix4);var a=this.elements,o=t.set(a[0],a[1],a[2]).length(),s=t.set(a[4],a[5],a[6]).length(),u=t.set(a[8],a[9],a[10]).length();this.determinant()<0&&(o=-o),n.x=a[12],n.y=a[13],n.z=a[14],e.elements.set(this.elements);var l=1/o,c=1/s,d=1/u;return e.elements[0]*=l,e.elements[1]*=l,e.elements[2]*=l,e.elements[4]*=c,e.elements[5]*=c,e.elements[6]*=c,e.elements[8]*=d,e.elements[9]*=d,e.elements[10]*=d,r.setFromRotationMatrix(e),i.x=o,i.y=s,i.z=u,this}}(),makeFrustum:function(t,e,n,r,i,a){var o=this.elements,s=2*i/(e-t),u=2*i/(r-n),l=(e+t)/(e-t),c=(r+n)/(r-n),d=-(a+i)/(a-i),h=-2*a*i/(a-i);return o[0]=s,o[4]=0,o[8]=l,o[12]=0,o[1]=0,o[5]=u,o[9]=c,o[13]=0,o[2]=0,o[6]=0,o[10]=d,o[14]=h,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this},makePerspective:function(t,e,n,r){var i=n*Math.tan(p.Math.degToRad(.5*t)),a=-i,o=a*e,s=i*e;return this.makeFrustum(o,s,a,i,n,r)},makeOrthographic:function(t,e,n,r,i,a){var o=this.elements,s=1/(e-t),u=1/(n-r),l=1/(a-i),c=(e+t)*s,d=(n+r)*u,h=(a+i)*l;return o[0]=2*s,o[4]=0,o[8]=0,o[12]=-c,o[1]=0,o[5]=2*u,o[9]=0,o[13]=-d,o[2]=0,o[6]=0,o[10]=-2*l,o[14]=-h,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this},equals:function(t){for(var e=this.elements,n=t.elements,r=0;r<16;r++)if(e[r]!==n[r])return!1;return!0},fromArray:function(t){return this.elements.set(t),this},toArray:function(){var t=this.elements;return[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15]]}},p.Plane=function(t,e){this.normal=void 0!==t?t:new p.Vector3(1,0,0),this.constant=void 0!==e?e:0},p.Plane.prototype={constructor:p.Plane,set:function(t,e){return this.normal.copy(t),this.constant=e,this},setComponents:function(t,e,n,r){return this.normal.set(t,e,n),this.constant=r,this},setFromNormalAndCoplanarPoint:function(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this},setFromCoplanarPoints:function(){var t=new p.Vector3,e=new p.Vector3;return function(n,r,i){var a=t.subVectors(i,r).cross(e.subVectors(n,r)).normalize();return this.setFromNormalAndCoplanarPoint(a,n),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.normal.copy(t.normal),this.constant=t.constant,this},normalize:function(){var t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(t){return this.normal.dot(t)+this.constant},distanceToSphere:function(t){return this.distanceToPoint(t.center)-t.radius},projectPoint:function(t,e){return this.orthoPoint(t,e).sub(t).negate()},orthoPoint:function(t,e){var n=this.distanceToPoint(t);return(e||new p.Vector3).copy(this.normal).multiplyScalar(n)},intersectLine:function(){var t=new p.Vector3;return function(e,n){var r=n||new p.Vector3,i=e.delta(t),a=this.normal.dot(i);if(0!==a){var o=-(e.start.dot(this.normal)+this.constant)/a;if(!(o<0||o>1))return r.copy(i).multiplyScalar(o).add(e.start)}else if(0===this.distanceToPoint(e.start))return r.copy(e.start)}}(),intersectsLine:function(t){var e=this.distanceToPoint(t.start),n=this.distanceToPoint(t.end);return e<0&&n>0||n<0&&e>0},intersectsBox:function(t){return t.intersectsPlane(this)},intersectsSphere:function(t){return t.intersectsPlane(this)},coplanarPoint:function(t){return(t||new p.Vector3).copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var t=new p.Vector3,e=new p.Vector3,n=new p.Matrix3;return function(r,i){var a=i||n.getNormalMatrix(r),o=t.copy(this.normal).applyMatrix3(a),s=this.coplanarPoint(e);return s.applyMatrix4(r),this.setFromNormalAndCoplanarPoint(o,s),this}}(),translate:function(t){return this.constant=this.constant-t.dot(this.normal),this},equals:function(t){return t.normal.equals(this.normal)&&t.constant===this.constant}},p.Quaternion=function(t,e,n,r){this._x=t||0,this._y=e||0,this._z=n||0,this._w=void 0!==r?r:1},p.Quaternion.prototype={constructor:p.Quaternion,get x(){return this._x},set x(t){this._x=t,this.onChangeCallback()},get y(){return this._y},set y(t){this._y=t,this.onChangeCallback()},get z(){return this._z},set z(t){this._z=t,this.onChangeCallback()},get w(){return this._w},set w(t){this._w=t,this.onChangeCallback()},set:function(t,e,n,r){return this._x=t,this._y=e,this._z=n,this._w=r,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this.onChangeCallback(),this},setFromEuler:function(t,e){if(t instanceof p.Euler==!1)throw new Error("THREE.Quaternion: .setFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var n=Math.cos(t._x/2),r=Math.cos(t._y/2),i=Math.cos(t._z/2),a=Math.sin(t._x/2),o=Math.sin(t._y/2),s=Math.sin(t._z/2),u=t.order;return"XYZ"===u?(this._x=a*r*i+n*o*s,this._y=n*o*i-a*r*s,this._z=n*r*s+a*o*i,this._w=n*r*i-a*o*s):"YXZ"===u?(this._x=a*r*i+n*o*s,this._y=n*o*i-a*r*s,this._z=n*r*s-a*o*i,this._w=n*r*i+a*o*s):"ZXY"===u?(this._x=a*r*i-n*o*s,this._y=n*o*i+a*r*s,this._z=n*r*s+a*o*i,this._w=n*r*i-a*o*s):"ZYX"===u?(this._x=a*r*i-n*o*s,this._y=n*o*i+a*r*s,this._z=n*r*s-a*o*i,this._w=n*r*i+a*o*s):"YZX"===u?(this._x=a*r*i+n*o*s,this._y=n*o*i+a*r*s,this._z=n*r*s-a*o*i,this._w=n*r*i-a*o*s):"XZY"===u&&(this._x=a*r*i-n*o*s,this._y=n*o*i-a*r*s,this._z=n*r*s+a*o*i,this._w=n*r*i+a*o*s),!1!==e&&this.onChangeCallback(),this},setFromAxisAngle:function(t,e){var n=e/2,r=Math.sin(n);return this._x=t.x*r,this._y=t.y*r,this._z=t.z*r,this._w=Math.cos(n),this.onChangeCallback(),this},setFromRotationMatrix:function(t){var e,n=t.elements,r=n[0],i=n[4],a=n[8],o=n[1],s=n[5],u=n[9],l=n[2],c=n[6],d=n[10],h=r+s+d;return h>0?(e=.5/Math.sqrt(h+1),this._w=.25/e,this._x=(c-u)*e,this._y=(a-l)*e,this._z=(o-i)*e):r>s&&r>d?(e=2*Math.sqrt(1+r-s-d),this._w=(c-u)/e,this._x=.25*e,this._y=(i+o)/e,this._z=(a+l)/e):s>d?(e=2*Math.sqrt(1+s-r-d),this._w=(a-l)/e,this._x=(i+o)/e,this._y=.25*e,this._z=(u+c)/e):(e=2*Math.sqrt(1+d-r-s),this._w=(o-i)/e,this._x=(a+l)/e,this._y=(u+c)/e,this._z=.25*e),this.onChangeCallback(),this},setFromUnitVectors:function(){var t,e;return function(n,r){return void 0===t&&(t=new p.Vector3),e=n.dot(r)+1,e<1e-6?(e=0,Math.abs(n.x)>Math.abs(n.z)?t.set(-n.y,n.x,0):t.set(0,-n.z,n.y)):t.crossVectors(n,r),this._x=t.x,this._y=t.y,this._z=t.z,this._w=e,this.normalize(),this}}(),inverse:function(){return this.conjugate().normalize(),this},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this.onChangeCallback(),this},dot:function(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this.onChangeCallback(),this},multiply:function(t,e){return void 0!==e?this.multiplyQuaternions(t,e):this.multiplyQuaternions(this,t)},multiplyQuaternions:function(t,e){var n=t._x,r=t._y,i=t._z,a=t._w,o=e._x,s=e._y,u=e._z,l=e._w;return this._x=n*l+a*o+r*u-i*s,this._y=r*l+a*s+i*o-n*u,this._z=i*l+a*u+n*s-r*o,this._w=a*l-n*o-r*s-i*u,this.onChangeCallback(),this},slerp:function(t,e){if(0===e)return this;if(1===e)return this.copy(t);var n=this._x,r=this._y,i=this._z,a=this._w,o=a*t._w+n*t._x+r*t._y+i*t._z;if(o<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,o=-o):this.copy(t),o>=1)return this._w=a,this._x=n,this._y=r,this._z=i,this;var s=Math.sqrt(1-o*o);if(Math.abs(s)<.001)return this._w=.5*(a+this._w),this._x=.5*(n+this._x),this._y=.5*(r+this._y),this._z=.5*(i+this._z),this;var u=Math.atan2(s,o),l=Math.sin((1-e)*u)/s,c=Math.sin(e*u)/s;return this._w=a*l+this._w*c,this._x=n*l+this._x*c,this._y=r*l+this._y*c,this._z=i*l+this._z*c,this.onChangeCallback(),this},equals:function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w},fromArray:function(t,e){return void 0===e&&(e=0),this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this.onChangeCallback(),this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t},onChange:function(t){return this.onChangeCallback=t,this},onChangeCallback:function(){}},Object.assign(p.Quaternion,{slerp:function(t,e,n,r){return n.copy(t).slerp(e,r)},slerpFlat:function(t,e,n,r,i,a,o){var s=n[r+0],u=n[r+1],l=n[r+2],c=n[r+3],d=i[a+0],h=i[a+1],f=i[a+2],p=i[a+3];if(c!==p||s!==d||u!==h||l!==f){var m=1-o,g=s*d+u*h+l*f+c*p,v=g>=0?1:-1,y=1-g*g;if(y>Number.EPSILON){var _=Math.sqrt(y),b=Math.atan2(_,g*v);m=Math.sin(m*b)/_,o=Math.sin(o*b)/_}var E=o*v;if(s=s*m+d*E,u=u*m+h*E,l=l*m+f*E,c=c*m+p*E,m===1-o){var w=1/Math.sqrt(s*s+u*u+l*l+c*c);s*=w,u*=w,l*=w,c*=w}}t[e]=s,t[e+1]=u,t[e+2]=l,t[e+3]=c}}),p.Triangle=function(t,e,n){this.a=void 0!==t?t:new p.Vector3,this.b=void 0!==e?e:new p.Vector3,this.c=void 0!==n?n:new p.Vector3},p.Triangle.normal=function(){var t=new p.Vector3;return function(e,n,r,i){var a=i||new p.Vector3;a.subVectors(r,n),t.subVectors(e,n),a.cross(t);var o=a.lengthSq();return o>0?a.multiplyScalar(1/Math.sqrt(o)):a.set(0,0,0)}}(),p.Triangle.barycoordFromPoint=function(){var t=new p.Vector3,e=new p.Vector3,n=new p.Vector3;return function(r,i,a,o,s){t.subVectors(o,i),e.subVectors(a,i),n.subVectors(r,i);var u=t.dot(t),l=t.dot(e),c=t.dot(n),d=e.dot(e),h=e.dot(n),f=u*d-l*l,m=s||new p.Vector3;if(0===f)return m.set(-2,-1,-1);var g=1/f,v=(d*c-l*h)*g,y=(u*h-l*c)*g;return m.set(1-v-y,y,v)}}(),p.Triangle.containsPoint=function(){var t=new p.Vector3;return function(e,n,r,i){var a=p.Triangle.barycoordFromPoint(e,n,r,i,t);return a.x>=0&&a.y>=0&&a.x+a.y<=1}}(),p.Triangle.prototype={constructor:p.Triangle,set:function(t,e,n){return this.a.copy(t),this.b.copy(e),this.c.copy(n),this},setFromPointsAndIndices:function(t,e,n,r){return this.a.copy(t[e]),this.b.copy(t[n]),this.c.copy(t[r]),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this},area:function(){var t=new p.Vector3,e=new p.Vector3;return function(){return t.subVectors(this.c,this.b),e.subVectors(this.a,this.b),.5*t.cross(e).length()}}(),midpoint:function(t){return(t||new p.Vector3).addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},normal:function(t){return p.Triangle.normal(this.a,this.b,this.c,t)},plane:function(t){return(t||new p.Plane).setFromCoplanarPoints(this.a,this.b,this.c)},barycoordFromPoint:function(t,e){return p.Triangle.barycoordFromPoint(t,this.a,this.b,this.c,e)},containsPoint:function(t){return p.Triangle.containsPoint(t,this.a,this.b,this.c)},equals:function(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}},p.Box3=function(t,e){this.min=void 0!==t?t:new p.Vector3(1/0,1/0,1/0),this.max=void 0!==e?e:new p.Vector3(-1/0,-1/0,-1/0)},p.Box3.prototype={constructor:p.Box3,set:function(t,e){return this.min.copy(t),this.max.copy(e),this},setFromArray:function(t){this.makeEmpty();for(var e=1/0,n=1/0,r=1/0,i=-1/0,a=-1/0,o=-1/0,s=0,u=t.length;s<u;s+=3){var l=t[s],c=t[s+1],d=t[s+2];l<e&&(e=l),c<n&&(n=c),d<r&&(r=d),l>i&&(i=l),c>a&&(a=c),d>o&&(o=d)}this.min.set(e,n,r),this.max.set(i,a,o)},setFromPoints:function(t){this.makeEmpty();for(var e=0,n=t.length;e<n;e++)this.expandByPoint(t[e]);return this},setFromCenterAndSize:function(){var t=new p.Vector3;return function(e,n){var r=t.copy(n).multiplyScalar(.5);return this.min.copy(e).sub(r),this.max.copy(e).add(r),this}}(),setFromObject:function(){var t;return function(e){void 0===t&&(t=new p.Box3);var n=this;return this.makeEmpty(),e.updateMatrixWorld(!0),e.traverse(function(e){var r=e.geometry;void 0!==r&&(null===r.boundingBox&&r.computeBoundingBox(),!1===r.boundingBox.isEmpty()&&(t.copy(r.boundingBox),t.applyMatrix4(e.matrixWorld),n.union(t)))}),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.min.copy(t.min),this.max.copy(t.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},center:function(t){return(t||new p.Vector3).addVectors(this.min,this.max).multiplyScalar(.5)},size:function(t){return(t||new p.Vector3).subVectors(this.max,this.min)},expandByPoint:function(t){return this.min.min(t),this.max.max(t),this},expandByVector:function(t){return this.min.sub(t),this.max.add(t),this},expandByScalar:function(t){return this.min.addScalar(-t),this.max.addScalar(t),this},containsPoint:function(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)},containsBox:function(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z},getParameter:function(t,e){return(e||new p.Vector3).set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))},intersectsBox:function(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)},intersectsSphere:function(){var t;return function(e){return void 0===t&&(t=new p.Vector3),this.clampPoint(e.center,t),t.distanceToSquared(e.center)<=e.radius*e.radius}}(),intersectsPlane:function(t){var e,n;return t.normal.x>0?(e=t.normal.x*this.min.x,n=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,n=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,n+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,n+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,n+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,n+=t.normal.z*this.min.z),e<=t.constant&&n>=t.constant},clampPoint:function(t,e){return(e||new p.Vector3).copy(t).clamp(this.min,this.max)},distanceToPoint:function(){var t=new p.Vector3;return function(e){return t.copy(e).clamp(this.min,this.max).sub(e).length()}}(),getBoundingSphere:function(){var t=new p.Vector3;return function(e){var n=e||new p.Sphere;return n.center=this.center(),n.radius=.5*this.size(t).length(),n}}(),intersect:function(t){return this.min.max(t.min),this.max.min(t.max),this},union:function(t){return this.min.min(t.min),this.max.max(t.max),this},applyMatrix4:function(){var t=[new p.Vector3,new p.Vector3,new p.Vector3,new p.Vector3,new p.Vector3,new p.Vector3,new p.Vector3,new p.Vector3];return function(e){return t[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),t[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),t[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),t[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),t[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),t[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),t[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),t[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.makeEmpty(),this.setFromPoints(t),this}}(),translate:function(t){return this.min.add(t),this.max.add(t),this},equals:function(t){return t.min.equals(this.min)&&t.max.equals(this.max)}},p.Euler=function(t,e,n,r){this._x=t||0,this._y=e||0,this._z=n||0,this._order=r||p.Euler.DefaultOrder},p.Euler.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],p.Euler.DefaultOrder="XYZ",p.Euler.prototype={constructor:p.Euler,get x(){return this._x},set x(t){this._x=t,this.onChangeCallback()},get y(){return this._y},set y(t){this._y=t,this.onChangeCallback()},get z(){return this._z},set z(t){this._z=t,this.onChangeCallback()},get order(){return this._order},set order(t){this._order=t,this.onChangeCallback()},set:function(t,e,n,r){return this._x=t,this._y=e,this._z=n,this._order=r||this._order,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this.onChangeCallback(),this},setFromRotationMatrix:function(t,e,n){var r=p.Math.clamp,i=t.elements,a=i[0],o=i[4],s=i[8],u=i[1],l=i[5],c=i[9],d=i[2],h=i[6],f=i[10];return e=e||this._order,"XYZ"===e?(this._y=Math.asin(r(s,-1,1)),Math.abs(s)<.99999?(this._x=Math.atan2(-c,f),this._z=Math.atan2(-o,a)):(this._x=Math.atan2(h,l),this._z=0)):"YXZ"===e?(this._x=Math.asin(-r(c,-1,1)),Math.abs(c)<.99999?(this._y=Math.atan2(s,f),this._z=Math.atan2(u,l)):(this._y=Math.atan2(-d,a),this._z=0)):"ZXY"===e?(this._x=Math.asin(r(h,-1,1)),Math.abs(h)<.99999?(this._y=Math.atan2(-d,f),this._z=Math.atan2(-o,l)):(this._y=0,this._z=Math.atan2(u,a))):"ZYX"===e?(this._y=Math.asin(-r(d,-1,1)),Math.abs(d)<.99999?(this._x=Math.atan2(h,f),this._z=Math.atan2(u,a)):(this._x=0,this._z=Math.atan2(-o,l))):"YZX"===e?(this._z=Math.asin(r(u,-1,1)),Math.abs(u)<.99999?(this._x=Math.atan2(-c,l),this._y=Math.atan2(-d,a)):(this._x=0,this._y=Math.atan2(s,f))):"XZY"===e&&(this._z=Math.asin(-r(o,-1,1)),Math.abs(o)<.99999?(this._x=Math.atan2(h,l),this._y=Math.atan2(s,a)):(this._x=Math.atan2(-c,f),this._y=0)),this._order=e,!1!==n&&this.onChangeCallback(),this},setFromQuaternion:function(){var t;return function(e,n,r){return void 0===t&&(t=new p.Matrix4),t.makeRotationFromQuaternion(e),this.setFromRotationMatrix(t,n,r),this}}(),setFromVector3:function(t,e){return this.set(t.x,t.y,t.z,e||this._order)},reorder:function(){var t=new p.Quaternion;return function(e){t.setFromEuler(this),this.setFromQuaternion(t,e)}}(),equals:function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order},fromArray:function(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this.onChangeCallback(),this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t},toVector3:function(t){return t?t.set(this._x,this._y,this._z):new p.Vector3(this._x,this._y,this._z)},onChange:function(t){return this.onChangeCallback=t,this},onChangeCallback:function(){}},p.Ray=function(t,e){this.origin=void 0!==t?t:new p.Vector3,this.direction=void 0!==e?e:new p.Vector3},p.Ray.prototype={constructor:p.Ray,set:function(t,e){return this.origin.copy(t),this.direction.copy(e),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this},at:function(t,e){return(e||new p.Vector3).copy(this.direction).multiplyScalar(t).add(this.origin)},lookAt:function(t){this.direction.copy(t).sub(this.origin).normalize()},recast:function(){var t=new p.Vector3;return function(e){return this.origin.copy(this.at(e,t)),this}}(),closestPointToPoint:function(t,e){var n=e||new p.Vector3;n.subVectors(t,this.origin);var r=n.dot(this.direction);return r<0?n.copy(this.origin):n.copy(this.direction).multiplyScalar(r).add(this.origin)},distanceToPoint:function(t){return Math.sqrt(this.distanceSqToPoint(t))},distanceSqToPoint:function(){var t=new p.Vector3;return function(e){var n=t.subVectors(e,this.origin).dot(this.direction);return n<0?this.origin.distanceToSquared(e):(t.copy(this.direction).multiplyScalar(n).add(this.origin),t.distanceToSquared(e))}}(),distanceSqToSegment:function(){var t=new p.Vector3,e=new p.Vector3,n=new p.Vector3;return function(r,i,a,o){t.copy(r).add(i).multiplyScalar(.5),e.copy(i).sub(r).normalize(),n.copy(this.origin).sub(t);var s,u,l,c,d=.5*r.distanceTo(i),h=-this.direction.dot(e),f=n.dot(this.direction),p=-n.dot(e),m=n.lengthSq(),g=Math.abs(1-h*h);if(g>0)if(s=h*p-f,u=h*f-p,c=d*g,s>=0)if(u>=-c)if(u<=c){var v=1/g;s*=v,u*=v,l=s*(s+h*u+2*f)+u*(h*s+u+2*p)+m}else u=d,s=Math.max(0,-(h*u+f)),l=-s*s+u*(u+2*p)+m;else u=-d,s=Math.max(0,-(h*u+f)),l=-s*s+u*(u+2*p)+m;else u<=-c?(s=Math.max(0,-(-h*d+f)),u=s>0?-d:Math.min(Math.max(-d,-p),d),l=-s*s+u*(u+2*p)+m):u<=c?(s=0,u=Math.min(Math.max(-d,-p),d),l=u*(u+2*p)+m):(s=Math.max(0,-(h*d+f)),u=s>0?d:Math.min(Math.max(-d,-p),d),l=-s*s+u*(u+2*p)+m);else u=h>0?-d:d,s=Math.max(0,-(h*u+f)),l=-s*s+u*(u+2*p)+m;return a&&a.copy(this.direction).multiplyScalar(s).add(this.origin),o&&o.copy(e).multiplyScalar(u).add(t),l}}(),intersectSphere:function(){var t=new p.Vector3;return function(e,n){t.subVectors(e.center,this.origin);var r=t.dot(this.direction),i=t.dot(t)-r*r,a=e.radius*e.radius;if(i>a)return null;var o=Math.sqrt(a-i),s=r-o,u=r+o;return s<0&&u<0?null:s<0?this.at(u,n):this.at(s,n)}}(),intersectsSphere:function(t){return this.distanceToPoint(t.center)<=t.radius},distanceToPlane:function(t){var e=t.normal.dot(this.direction);if(0===e)return 0===t.distanceToPoint(this.origin)?0:null;var n=-(this.origin.dot(t.normal)+t.constant)/e;return n>=0?n:null},intersectPlane:function(t,e){var n=this.distanceToPlane(t);return null===n?null:this.at(n,e)},intersectsPlane:function(t){var e=t.distanceToPoint(this.origin);return 0===e||t.normal.dot(this.direction)*e<0},intersectBox:function(t,e){var n,r,i,a,o,s,u=1/this.direction.x,l=1/this.direction.y,c=1/this.direction.z,d=this.origin;return u>=0?(n=(t.min.x-d.x)*u,r=(t.max.x-d.x)*u):(n=(t.max.x-d.x)*u,r=(t.min.x-d.x)*u),l>=0?(i=(t.min.y-d.y)*l,a=(t.max.y-d.y)*l):(i=(t.max.y-d.y)*l,a=(t.min.y-d.y)*l),n>a||i>r?null:((i>n||n!==n)&&(n=i),(a<r||r!==r)&&(r=a),c>=0?(o=(t.min.z-d.z)*c,s=(t.max.z-d.z)*c):(o=(t.max.z-d.z)*c,s=(t.min.z-d.z)*c),n>s||o>r?null:((o>n||n!==n)&&(n=o),(s<r||r!==r)&&(r=s),r<0?null:this.at(n>=0?n:r,e)))},intersectsBox:function(){var t=new p.Vector3;return function(e){return null!==this.intersectBox(e,t)}}(),intersectTriangle:function(){var t=new p.Vector3,e=new p.Vector3,n=new p.Vector3,r=new p.Vector3;return function(i,a,o,s,u){e.subVectors(a,i),n.subVectors(o,i),r.crossVectors(e,n);var l,c=this.direction.dot(r);if(c>0){if(s)return null;l=1}else{if(!(c<0))return null;l=-1,c=-c}t.subVectors(this.origin,i);var d=l*this.direction.dot(n.crossVectors(t,n));if(d<0)return null;var h=l*this.direction.dot(e.cross(t));if(h<0)return null;if(d+h>c)return null;var f=-l*t.dot(r);return f<0?null:this.at(f/c,u)}}(),applyMatrix4:function(t){return this.direction.add(this.origin).applyMatrix4(t),this.origin.applyMatrix4(t),this.direction.sub(this.origin),this.direction.normalize(),this},equals:function(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}},p.Sphere=function(t,e){this.center=void 0!==t?t:new p.Vector3,this.radius=void 0!==e?e:0},p.Sphere.prototype={constructor:p.Sphere,set:function(t,e){return this.center.copy(t),this.radius=e,this},setFromPoints:function(){var t=new p.Box3;return function(e,n){var r=this.center;void 0!==n?r.copy(n):t.setFromPoints(e).center(r);for(var i=0,a=0,o=e.length;a<o;a++)i=Math.max(i,r.distanceToSquared(e[a]));return this.radius=Math.sqrt(i),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.center.copy(t.center),this.radius=t.radius,this},empty:function(){return this.radius<=0},containsPoint:function(t){return t.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(t){return t.distanceTo(this.center)-this.radius},intersectsSphere:function(t){var e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e},intersectsBox:function(t){return t.intersectsSphere(this)},intersectsPlane:function(t){return Math.abs(this.center.dot(t.normal)-t.constant)<=this.radius},clampPoint:function(t,e){var n=this.center.distanceToSquared(t),r=e||new p.Vector3;return r.copy(t),n>this.radius*this.radius&&(r.sub(this.center).normalize(),r.multiplyScalar(this.radius).add(this.center)),r},getBoundingBox:function(t){var e=t||new p.Box3;return e.set(this.center,this.center),e.expandByScalar(this.radius),e},applyMatrix4:function(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this},translate:function(t){return this.center.add(t),this},equals:function(t){return t.center.equals(this.center)&&t.radius===this.radius}},p.Frustum=function(t,e,n,r,i,a){this.planes=[void 0!==t?t:new p.Plane,void 0!==e?e:new p.Plane,void 0!==n?n:new p.Plane,void 0!==r?r:new p.Plane,void 0!==i?i:new p.Plane,void 0!==a?a:new p.Plane]},p.Frustum.prototype={constructor:p.Frustum,set:function(t,e,n,r,i,a){var o=this.planes;return o[0].copy(t),o[1].copy(e),o[2].copy(n),o[3].copy(r),o[4].copy(i),o[5].copy(a),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){for(var e=this.planes,n=0;n<6;n++)e[n].copy(t.planes[n]);return this},setFromMatrix:function(t){var e=this.planes,n=t.elements,r=n[0],i=n[1],a=n[2],o=n[3],s=n[4],u=n[5],l=n[6],c=n[7],d=n[8],h=n[9],f=n[10],p=n[11],m=n[12],g=n[13],v=n[14],y=n[15];return e[0].setComponents(o-r,c-s,p-d,y-m).normalize(),e[1].setComponents(o+r,c+s,p+d,y+m).normalize(),e[2].setComponents(o+i,c+u,p+h,y+g).normalize(),e[3].setComponents(o-i,c-u,p-h,y-g).normalize(),e[4].setComponents(o-a,c-l,p-f,y-v).normalize(),e[5].setComponents(o+a,c+l,p+f,y+v).normalize(),this},intersectsObject:function(){var t=new p.Sphere;return function(e){var n=e.geometry;return null===n.boundingSphere&&n.computeBoundingSphere(),t.copy(n.boundingSphere),t.applyMatrix4(e.matrixWorld),this.intersectsSphere(t)}}(),intersectsSphere:function(t){for(var e=this.planes,n=t.center,r=-t.radius,i=0;i<6;i++){if(e[i].distanceToPoint(n)<r)return!1}return!0},intersectsBox:function(){var t=new p.Vector3,e=new p.Vector3;return function(n){for(var r=this.planes,i=0;i<6;i++){var a=r[i];t.x=a.normal.x>0?n.min.x:n.max.x,e.x=a.normal.x>0?n.max.x:n.min.x,t.y=a.normal.y>0?n.min.y:n.max.y,e.y=a.normal.y>0?n.max.y:n.min.y,t.z=a.normal.z>0?n.min.z:n.max.z,e.z=a.normal.z>0?n.max.z:n.min.z;var o=a.distanceToPoint(t),s=a.distanceToPoint(e);if(o<0&&s<0)return!1}return!0}}(),containsPoint:function(t){for(var e=this.planes,n=0;n<6;n++)if(e[n].distanceToPoint(t)<0)return!1;return!0}},p.EventDispatcher=function(){},p.EventDispatcher.prototype={constructor:p.EventDispatcher,apply:function(t){t.addEventListener=p.EventDispatcher.prototype.addEventListener,t.hasEventListener=p.EventDispatcher.prototype.hasEventListener,t.removeEventListener=p.EventDispatcher.prototype.removeEventListener,t.dispatchEvent=p.EventDispatcher.prototype.dispatchEvent},addEventListener:function(t,e){void 0===this._listeners&&(this._listeners={});var n=this._listeners;void 0===n[t]&&(n[t]=[]),-1===n[t].indexOf(e)&&n[t].push(e)},hasEventListener:function(t,e){if(void 0===this._listeners)return!1;var n=this._listeners;return void 0!==n[t]&&-1!==n[t].indexOf(e)},removeEventListener:function(t,e){if(void 0!==this._listeners){var n=this._listeners,r=n[t];if(void 0!==r){var i=r.indexOf(e);-1!==i&&r.splice(i,1)}}},dispatchEvent:function(t){if(void 0!==this._listeners){var e=this._listeners,n=e[t.type];if(void 0!==n){t.target=this;for(var r=[],i=n.length,a=0;a<i;a++)r[a]=n[a];for(var a=0;a<i;a++)r[a].call(this,t)}}}},p.Layers=function(){this.mask=1},p.Layers.prototype={constructor:p.Layers,set:function(t){this.mask=1<<t},enable:function(t){this.mask|=1<<t},toggle:function(t){this.mask^=1<<t},disable:function(t){this.mask&=~(1<<t)},test:function(t){return 0!=(this.mask&t.mask)}},p.Object3D=function(){function t(){i.setFromEuler(r,!1)}function e(){r.setFromQuaternion(i,void 0,!1)}Object.defineProperty(this,"id",{value:p.Object3DIdCount++}),this.uuid=p.Math.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=p.Object3D.DefaultUp.clone();var n=new p.Vector3,r=new p.Euler,i=new p.Quaternion,a=new p.Vector3(1,1,1);r.onChange(t),i.onChange(e),Object.defineProperties(this,{position:{enumerable:!0,value:n},rotation:{enumerable:!0,value:r},quaternion:{enumerable:!0,value:i},scale:{enumerable:!0,value:a},modelViewMatrix:{value:new p.Matrix4},normalMatrix:{value:new p.Matrix3}}),this.rotationAutoUpdate=!0,this.matrix=new p.Matrix4,this.matrixWorld=new p.Matrix4,this.matrixAutoUpdate=p.Object3D.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new p.Layers,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.userData={}},p.Object3D.DefaultUp=new p.Vector3(0,1,0),p.Object3D.DefaultMatrixAutoUpdate=!0,p.Object3D.prototype={constructor:p.Object3D,applyMatrix:function(t){this.matrix.multiplyMatrices(t,this.matrix),this.matrix.decompose(this.position,this.quaternion,this.scale)},setRotationFromAxisAngle:function(t,e){this.quaternion.setFromAxisAngle(t,e)},setRotationFromEuler:function(t){this.quaternion.setFromEuler(t,!0)},setRotationFromMatrix:function(t){this.quaternion.setFromRotationMatrix(t)},setRotationFromQuaternion:function(t){this.quaternion.copy(t)},rotateOnAxis:function(){var t=new p.Quaternion;return function(e,n){return t.setFromAxisAngle(e,n),this.quaternion.multiply(t),this}}(),rotateX:function(){var t=new p.Vector3(1,0,0);return function(e){return this.rotateOnAxis(t,e)}}(),rotateY:function(){var t=new p.Vector3(0,1,0);return function(e){return this.rotateOnAxis(t,e)}}(),rotateZ:function(){var t=new p.Vector3(0,0,1);return function(e){return this.rotateOnAxis(t,e)}}(),translateOnAxis:function(){var t=new p.Vector3;return function(e,n){return t.copy(e).applyQuaternion(this.quaternion),this.position.add(t.multiplyScalar(n)),this}}(),translateX:function(){var t=new p.Vector3(1,0,0);return function(e){return this.translateOnAxis(t,e)}}(),translateY:function(){var t=new p.Vector3(0,1,0);return function(e){return this.translateOnAxis(t,e)}}(),translateZ:function(){var t=new p.Vector3(0,0,1);return function(e){return this.translateOnAxis(t,e)}}(),localToWorld:function(t){return t.applyMatrix4(this.matrixWorld)},worldToLocal:function(){var t=new p.Matrix4;return function(e){return e.applyMatrix4(t.getInverse(this.matrixWorld))}}(),lookAt:function(){var t=new p.Matrix4;return function(e){t.lookAt(e,this.position,this.up),this.quaternion.setFromRotationMatrix(t)}}(),add:function(t){if(arguments.length>1){for(var e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return t===this?this:(t instanceof p.Object3D&&(null!==t.parent&&t.parent.remove(t),t.parent=this,t.dispatchEvent({type:"added"}),this.children.push(t)),this)},remove:function(t){if(arguments.length>1)for(var e=0;e<arguments.length;e++)this.remove(arguments[e]);var n=this.children.indexOf(t);-1!==n&&(t.parent=null,t.dispatchEvent({type:"removed"}),this.children.splice(n,1))},getObjectById:function(t){return this.getObjectByProperty("id",t)},getObjectByName:function(t){return this.getObjectByProperty("name",t)},getObjectByProperty:function(t,e){if(this[t]===e)return this;for(var n=0,r=this.children.length;n<r;n++){var i=this.children[n],a=i.getObjectByProperty(t,e);if(void 0!==a)return a}},getWorldPosition:function(t){var e=t||new p.Vector3;return this.updateMatrixWorld(!0),e.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(){var t=new p.Vector3,e=new p.Vector3;return function(n){var r=n||new p.Quaternion;return this.updateMatrixWorld(!0),this.matrixWorld.decompose(t,r,e),r}}(),getWorldRotation:function(){var t=new p.Quaternion;return function(e){var n=e||new p.Euler;return this.getWorldQuaternion(t),n.setFromQuaternion(t,this.rotation.order,!1)}}(),getWorldScale:function(){var t=new p.Vector3,e=new p.Quaternion;return function(n){var r=n||new p.Vector3;return this.updateMatrixWorld(!0),this.matrixWorld.decompose(t,e,r),r}}(),getWorldDirection:function(){var t=new p.Quaternion;return function(e){var n=e||new p.Vector3;return this.getWorldQuaternion(t),n.set(0,0,1).applyQuaternion(t)}}(),raycast:function(){},traverse:function(t){t(this);for(var e=this.children,n=0,r=e.length;n<r;n++)e[n].traverse(t)},traverseVisible:function(t){if(!1!==this.visible){t(this);for(var e=this.children,n=0,r=e.length;n<r;n++)e[n].traverseVisible(t)}},traverseAncestors:function(t){var e=this.parent;null!==e&&(t(e),e.traverseAncestors(t))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(t){!0===this.matrixAutoUpdate&&this.updateMatrix(),!0!==this.matrixWorldNeedsUpdate&&!0!==t||(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);for(var e=0,n=this.children.length;e<n;e++)this.children[e].updateMatrixWorld(t)},toJSON:function(t){function e(t){var e=[];for(var n in t){var r=t[n];delete r.metadata,e.push(r)}return e}var n=void 0===t,r={};n&&(t={geometries:{},materials:{},textures:{},images:{}},r.metadata={version:4.4,type:"Object",generator:"Object3D.toJSON"});var i={};if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),"{}"!==JSON.stringify(this.userData)&&(i.userData=this.userData),!0===this.castShadow&&(i.castShadow=!0),!0===this.receiveShadow&&(i.receiveShadow=!0),!1===this.visible&&(i.visible=!1),i.matrix=this.matrix.toArray(),void 0!==this.geometry&&(void 0===t.geometries[this.geometry.uuid]&&(t.geometries[this.geometry.uuid]=this.geometry.toJSON(t)),i.geometry=this.geometry.uuid),void 0!==this.material&&(void 0===t.materials[this.material.uuid]&&(t.materials[this.material.uuid]=this.material.toJSON(t)),i.material=this.material.uuid),this.children.length>0){i.children=[];for(var a=0;a<this.children.length;a++)i.children.push(this.children[a].toJSON(t).object)}if(n){var o=e(t.geometries),s=e(t.materials),u=e(t.textures),l=e(t.images);o.length>0&&(r.geometries=o),s.length>0&&(r.materials=s),u.length>0&&(r.textures=u),l.length>0&&(r.images=l)}return r.object=i,r},clone:function(t){return(new this.constructor).copy(this,t)},copy:function(t,e){if(void 0===e&&(e=!0),this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.rotationAutoUpdate=t.rotationAutoUpdate,this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.userData=JSON.parse(JSON.stringify(t.userData)),!0===e)for(var n=0;n<t.children.length;n++){var r=t.children[n];this.add(r.clone())}return this}},p.EventDispatcher.prototype.apply(p.Object3D.prototype),p.Object3DIdCount=0,p.Face3=function(t,e,n,r,i,a){this.a=t,this.b=e,this.c=n,this.normal=r instanceof p.Vector3?r:new p.Vector3,this.vertexNormals=Array.isArray(r)?r:[],this.color=i instanceof p.Color?i:new p.Color,this.vertexColors=Array.isArray(i)?i:[],this.materialIndex=void 0!==a?a:0},p.Face3.prototype={constructor:p.Face3,clone:function(){return(new this.constructor).copy(this)},copy:function(t){this.a=t.a,this.b=t.b,this.c=t.c,this.normal.copy(t.normal),this.color.copy(t.color),this.materialIndex=t.materialIndex;for(var e=0,n=t.vertexNormals.length;e<n;e++)this.vertexNormals[e]=t.vertexNormals[e].clone();for(var e=0,n=t.vertexColors.length;e<n;e++)this.vertexColors[e]=t.vertexColors[e].clone();return this}},p.BufferAttribute=function(t,e){this.uuid=p.Math.generateUUID(),this.array=t,this.itemSize=e,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.version=0},p.BufferAttribute.prototype={constructor:p.BufferAttribute,get count(){return this.array.length/this.itemSize},set needsUpdate(t){!0===t&&this.version++},setDynamic:function(t){return this.dynamic=t,this},copy:function(t){return this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.dynamic=t.dynamic,this},copyAt:function(t,e,n){t*=this.itemSize,n*=e.itemSize;for(var r=0,i=this.itemSize;r<i;r++)this.array[t+r]=e.array[n+r];return this},copyArray:function(t){return this.array.set(t),this},copyColorsArray:function(t){for(var e=this.array,n=0,r=0,i=t.length;r<i;r++){var a=t[r];void 0===a&&(a=new p.Color),e[n++]=a.r,e[n++]=a.g,e[n++]=a.b}return this},copyIndicesArray:function(t){for(var e=this.array,n=0,r=0,i=t.length;r<i;r++){var a=t[r];e[n++]=a.a,e[n++]=a.b,e[n++]=a.c}return this},copyVector2sArray:function(t){for(var e=this.array,n=0,r=0,i=t.length;r<i;r++){var a=t[r];void 0===a&&(a=new p.Vector2),e[n++]=a.x,e[n++]=a.y}return this},copyVector3sArray:function(t){for(var e=this.array,n=0,r=0,i=t.length;r<i;r++){var a=t[r];void 0===a&&(a=new p.Vector3),e[n++]=a.x,e[n++]=a.y,e[n++]=a.z}return this},copyVector4sArray:function(t){for(var e=this.array,n=0,r=0,i=t.length;r<i;r++){var a=t[r];void 0===a&&(a=new p.Vector4),e[n++]=a.x,e[n++]=a.y,e[n++]=a.z,e[n++]=a.w}return this},set:function(t,e){return void 0===e&&(e=0),this.array.set(t,e),this},getX:function(t){return this.array[t*this.itemSize]},setX:function(t,e){return this.array[t*this.itemSize]=e,this},getY:function(t){return this.array[t*this.itemSize+1]},setY:function(t,e){return this.array[t*this.itemSize+1]=e,this},getZ:function(t){return this.array[t*this.itemSize+2]},setZ:function(t,e){return this.array[t*this.itemSize+2]=e,this},getW:function(t){return this.array[t*this.itemSize+3]},setW:function(t,e){return this.array[t*this.itemSize+3]=e,this},setXY:function(t,e,n){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=n,this},setXYZ:function(t,e,n,r){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=n,this.array[t+2]=r,this},setXYZW:function(t,e,n,r,i){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=n,this.array[t+2]=r,this.array[t+3]=i,this},clone:function(){return(new this.constructor).copy(this)}},p.Int8Attribute=function(t,e){return new p.BufferAttribute(new Int8Array(t),e)},p.Uint8Attribute=function(t,e){return new p.BufferAttribute(new Uint8Array(t),e)},p.Uint8ClampedAttribute=function(t,e){return new p.BufferAttribute(new Uint8ClampedArray(t),e)},p.Int16Attribute=function(t,e){return new p.BufferAttribute(new Int16Array(t),e)},p.Uint16Attribute=function(t,e){return new p.BufferAttribute(new Uint16Array(t),e)},p.Int32Attribute=function(t,e){return new p.BufferAttribute(new Int32Array(t),e)},p.Uint32Attribute=function(t,e){return new p.BufferAttribute(new Uint32Array(t),e)},p.Float32Attribute=function(t,e){return new p.BufferAttribute(new Float32Array(t),e)},p.Float64Attribute=function(t,e){return new p.BufferAttribute(new Float64Array(t),e)},p.DynamicBufferAttribute=function(t,e){return new p.BufferAttribute(t,e).setDynamic(!0)},p.InstancedBufferAttribute=function(t,e,n){p.BufferAttribute.call(this,t,e),this.meshPerAttribute=n||1},p.InstancedBufferAttribute.prototype=Object.create(p.BufferAttribute.prototype),p.InstancedBufferAttribute.prototype.constructor=p.InstancedBufferAttribute,p.InstancedBufferAttribute.prototype.copy=function(t){return p.BufferAttribute.prototype.copy.call(this,t),this.meshPerAttribute=t.meshPerAttribute,this},p.BufferGeometry=function(){Object.defineProperty(this,"id",{value:p.GeometryIdCount++}),this.uuid=p.Math.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0}},p.BufferGeometry.prototype={constructor:p.BufferGeometry,getIndex:function(){return this.index},setIndex:function(t){this.index=t},addAttribute:function(t,e){return e instanceof p.BufferAttribute==!1&&e instanceof p.InterleavedBufferAttribute==!1?void this.addAttribute(t,new p.BufferAttribute(arguments[1],arguments[2])):"index"===t?void this.setIndex(e):(this.attributes[t]=e,this)},getAttribute:function(t){return this.attributes[t]},removeAttribute:function(t){return delete this.attributes[t],this},addGroup:function(t,e,n){this.groups.push({start:t,count:e,materialIndex:void 0!==n?n:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(t,e){this.drawRange.start=t,this.drawRange.count=e},applyMatrix:function(t){var e=this.attributes.position;void 0!==e&&(t.applyToVector3Array(e.array),e.needsUpdate=!0);var n=this.attributes.normal;if(void 0!==n){(new p.Matrix3).getNormalMatrix(t).applyToVector3Array(n.array),n.needsUpdate=!0}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},rotateX:function(){var t;return function(e){return void 0===t&&(t=new p.Matrix4),t.makeRotationX(e),this.applyMatrix(t),this}}(),rotateY:function(){var t;return function(e){return void 0===t&&(t=new p.Matrix4),t.makeRotationY(e),this.applyMatrix(t),this}}(),rotateZ:function(){var t;return function(e){return void 0===t&&(t=new p.Matrix4),t.makeRotationZ(e),this.applyMatrix(t),this}}(),translate:function(){var t;return function(e,n,r){return void 0===t&&(t=new p.Matrix4),t.makeTranslation(e,n,r),this.applyMatrix(t),this}}(),scale:function(){var t;return function(e,n,r){return void 0===t&&(t=new p.Matrix4),t.makeScale(e,n,r),this.applyMatrix(t),this}}(),lookAt:function(){var t;return function(e){void 0===t&&(t=new p.Object3D),t.lookAt(e),t.updateMatrix(),this.applyMatrix(t.matrix)}}(),center:function(){this.computeBoundingBox();var t=this.boundingBox.center().negate();return this.translate(t.x,t.y,t.z),t},setFromObject:function(t){var e=t.geometry;if(t instanceof p.Points||t instanceof p.Line){var n=new p.Float32Attribute(3*e.vertices.length,3),r=new p.Float32Attribute(3*e.colors.length,3);if(this.addAttribute("position",n.copyVector3sArray(e.vertices)),this.addAttribute("color",r.copyColorsArray(e.colors)),e.lineDistances&&e.lineDistances.length===e.vertices.length){var i=new p.Float32Attribute(e.lineDistances.length,1);this.addAttribute("lineDistance",i.copyArray(e.lineDistances))}null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone())}else t instanceof p.Mesh&&e instanceof p.Geometry&&this.fromGeometry(e);return this},updateFromObject:function(t){var e=t.geometry;if(t instanceof p.Mesh){var n=e.__directGeometry;if(void 0===n)return this.fromGeometry(e);n.verticesNeedUpdate=e.verticesNeedUpdate,n.normalsNeedUpdate=e.normalsNeedUpdate,n.colorsNeedUpdate=e.colorsNeedUpdate,n.uvsNeedUpdate=e.uvsNeedUpdate,n.groupsNeedUpdate=e.groupsNeedUpdate,e.verticesNeedUpdate=!1,e.normalsNeedUpdate=!1,e.colorsNeedUpdate=!1,e.uvsNeedUpdate=!1,e.groupsNeedUpdate=!1,e=n}if(!0===e.verticesNeedUpdate){var r=this.attributes.position;void 0!==r&&(r.copyVector3sArray(e.vertices),r.needsUpdate=!0),e.verticesNeedUpdate=!1}if(!0===e.normalsNeedUpdate){var r=this.attributes.normal;void 0!==r&&(r.copyVector3sArray(e.normals),r.needsUpdate=!0),e.normalsNeedUpdate=!1}if(!0===e.colorsNeedUpdate){var r=this.attributes.color;void 0!==r&&(r.copyColorsArray(e.colors),r.needsUpdate=!0),e.colorsNeedUpdate=!1}if(e.uvsNeedUpdate){var r=this.attributes.uv;void 0!==r&&(r.copyVector2sArray(e.uvs),r.needsUpdate=!0),e.uvsNeedUpdate=!1}if(e.lineDistancesNeedUpdate){var r=this.attributes.lineDistance;void 0!==r&&(r.copyArray(e.lineDistances),r.needsUpdate=!0),e.lineDistancesNeedUpdate=!1}return e.groupsNeedUpdate&&(e.computeGroups(t.geometry),this.groups=e.groups,e.groupsNeedUpdate=!1),this},fromGeometry:function(t){return t.__directGeometry=(new p.DirectGeometry).fromGeometry(t),this.fromDirectGeometry(t.__directGeometry)},fromDirectGeometry:function(t){var e=new Float32Array(3*t.vertices.length);if(this.addAttribute("position",new p.BufferAttribute(e,3).copyVector3sArray(t.vertices)),t.normals.length>0){var n=new Float32Array(3*t.normals.length);this.addAttribute("normal",new p.BufferAttribute(n,3).copyVector3sArray(t.normals))}if(t.colors.length>0){var r=new Float32Array(3*t.colors.length);this.addAttribute("color",new p.BufferAttribute(r,3).copyColorsArray(t.colors))}if(t.uvs.length>0){var i=new Float32Array(2*t.uvs.length);this.addAttribute("uv",new p.BufferAttribute(i,2).copyVector2sArray(t.uvs))}if(t.uvs2.length>0){var a=new Float32Array(2*t.uvs2.length);this.addAttribute("uv2",new p.BufferAttribute(a,2).copyVector2sArray(t.uvs2))}if(t.indices.length>0){var o=t.vertices.length>65535?Uint32Array:Uint16Array,s=new o(3*t.indices.length);this.setIndex(new p.BufferAttribute(s,1).copyIndicesArray(t.indices))}this.groups=t.groups;for(var u in t.morphTargets){for(var l=[],c=t.morphTargets[u],d=0,h=c.length;d<h;d++){var f=c[d],m=new p.Float32Attribute(3*f.length,3);l.push(m.copyVector3sArray(f))}this.morphAttributes[u]=l}if(t.skinIndices.length>0){var g=new p.Float32Attribute(4*t.skinIndices.length,4);this.addAttribute("skinIndex",g.copyVector4sArray(t.skinIndices))}if(t.skinWeights.length>0){var v=new p.Float32Attribute(4*t.skinWeights.length,4);this.addAttribute("skinWeight",v.copyVector4sArray(t.skinWeights))}return null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),this},computeBoundingBox:function(){new p.Vector3;return function(){null===this.boundingBox&&(this.boundingBox=new p.Box3);var t=this.attributes.position.array;t&&this.boundingBox.setFromArray(t),void 0!==t&&0!==t.length||(this.boundingBox.min.set(0,0,0),this.boundingBox.max.set(0,0,0)),isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z)}}(),computeBoundingSphere:function(){var t=new p.Box3,e=new p.Vector3;return function(){null===this.boundingSphere&&(this.boundingSphere=new p.Sphere);var n=this.attributes.position.array;if(n){var r=this.boundingSphere.center;t.setFromArray(n),t.center(r);for(var i=0,a=0,o=n.length;a<o;a+=3)e.fromArray(n,a),i=Math.max(i,r.distanceToSquared(e));this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)}}}(),computeFaceNormals:function(){},computeVertexNormals:function(){var t=this.index,e=this.attributes,n=this.groups;if(e.position){var r=e.position.array;if(void 0===e.normal)this.addAttribute("normal",new p.BufferAttribute(new Float32Array(r.length),3));else for(var i=e.normal.array,a=0,o=i.length;a<o;a++)i[a]=0;var s,u,l,c=e.normal.array,d=new p.Vector3,h=new p.Vector3,f=new p.Vector3,m=new p.Vector3,g=new p.Vector3;if(t){var v=t.array;0===n.length&&this.addGroup(0,v.length);for(var y=0,_=n.length;y<_;++y)for(var b=n[y],E=b.start,w=b.count,a=E,o=E+w;a<o;a+=3)s=3*v[a+0],u=3*v[a+1],l=3*v[a+2],d.fromArray(r,s),h.fromArray(r,u),f.fromArray(r,l),m.subVectors(f,h),g.subVectors(d,h),m.cross(g),c[s]+=m.x,c[s+1]+=m.y,c[s+2]+=m.z,c[u]+=m.x,c[u+1]+=m.y,c[u+2]+=m.z,c[l]+=m.x,c[l+1]+=m.y,c[l+2]+=m.z}else for(var a=0,o=r.length;a<o;a+=9)d.fromArray(r,a),h.fromArray(r,a+3),f.fromArray(r,a+6),m.subVectors(f,h),g.subVectors(d,h),m.cross(g),c[a]=m.x,c[a+1]=m.y,c[a+2]=m.z,c[a+3]=m.x,c[a+4]=m.y,c[a+5]=m.z,c[a+6]=m.x,c[a+7]=m.y,c[a+8]=m.z;this.normalizeNormals(),e.normal.needsUpdate=!0}},merge:function(t,e){if(t instanceof p.BufferGeometry!=!1){void 0===e&&(e=0);var n=this.attributes;for(var r in n)if(void 0!==t.attributes[r])for(var i=n[r],a=i.array,o=t.attributes[r],s=o.array,u=o.itemSize,l=0,c=u*e;l<s.length;l++,c++)a[c]=s[l];return this}},normalizeNormals:function(){for(var t,e,n,r,i=this.attributes.normal.array,a=0,o=i.length;a<o;a+=3)t=i[a],e=i[a+1],n=i[a+2],r=1/Math.sqrt(t*t+e*e+n*n),i[a]*=r,i[a+1]*=r,i[a+2]*=r},toNonIndexed:function(){if(null===this.index)return this;var t=new p.BufferGeometry,e=this.index.array,n=this.attributes;for(var r in n){for(var i=n[r],a=i.array,o=i.itemSize,s=new a.constructor(e.length*o),u=0,l=0,c=0,d=e.length;c<d;c++){u=e[c]*o;for(var h=0;h<o;h++)s[l++]=a[u++]}t.addAttribute(r,new p.BufferAttribute(s,o))}return t},toJSON:function(){var t={metadata:{version:4.4,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),void 0!==this.parameters){var e=this.parameters;for(var n in e)void 0!==e[n]&&(t[n]=e[n]);return t}t.data={attributes:{}};var r=this.index;if(null!==r){var i=Array.prototype.slice.call(r.array);t.data.index={type:r.array.constructor.name,array:i}}var a=this.attributes;for(var n in a){var o=a[n],i=Array.prototype.slice.call(o.array);t.data.attributes[n]={itemSize:o.itemSize,type:o.array.constructor.name,array:i}}var s=this.groups;s.length>0&&(t.data.groups=JSON.parse(JSON.stringify(s)));var u=this.boundingSphere;return null!==u&&(t.data.boundingSphere={center:u.center.toArray(),radius:u.radius}),t},clone:function(){return(new p.BufferGeometry).copy(this)},copy:function(t){var e=t.index;null!==e&&this.setIndex(e.clone());var n=t.attributes;for(var r in n){var i=n[r];this.addAttribute(r,i.clone())}for(var a=t.groups,o=0,s=a.length;o<s;o++){var u=a[o];this.addGroup(u.start,u.count)}return this},dispose:function(){this.dispatchEvent({type:"dispose"})}},p.EventDispatcher.prototype.apply(p.BufferGeometry.prototype),p.BufferGeometry.MaxIndex=65535,p.InterleavedBufferAttribute=function(t,e,n){this.uuid=p.Math.generateUUID(),this.data=t,this.itemSize=e,this.offset=n},p.InterleavedBufferAttribute.prototype={constructor:p.InterleavedBufferAttribute,get length(){return this.array.length},get count(){return this.data.count},setX:function(t,e){return this.data.array[t*this.data.stride+this.offset]=e,this},setY:function(t,e){return this.data.array[t*this.data.stride+this.offset+1]=e,this},setZ:function(t,e){return this.data.array[t*this.data.stride+this.offset+2]=e,this},setW:function(t,e){return this.data.array[t*this.data.stride+this.offset+3]=e,this},getX:function(t){return this.data.array[t*this.data.stride+this.offset]},getY:function(t){return this.data.array[t*this.data.stride+this.offset+1]},getZ:function(t){return this.data.array[t*this.data.stride+this.offset+2]},getW:function(t){return this.data.array[t*this.data.stride+this.offset+3]},setXY:function(t,e,n){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=n,this},setXYZ:function(t,e,n,r){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=n,this.data.array[t+2]=r,this},setXYZW:function(t,e,n,r,i){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=n,this.data.array[t+2]=r,this.data.array[t+3]=i,this}},p.InstancedBufferGeometry=function(){p.BufferGeometry.call(this),this.type="InstancedBufferGeometry",this.maxInstancedCount=void 0},p.InstancedBufferGeometry.prototype=Object.create(p.BufferGeometry.prototype),p.InstancedBufferGeometry.prototype.constructor=p.InstancedBufferGeometry,p.InstancedBufferGeometry.prototype.addGroup=function(t,e,n){this.groups.push({start:t,count:e,instances:n})},p.InstancedBufferGeometry.prototype.copy=function(t){var e=t.index;null!==e&&this.setIndex(e.clone());var n=t.attributes;for(var r in n){var i=n[r];this.addAttribute(r,i.clone())}for(var a=t.groups,o=0,s=a.length;o<s;o++){var u=a[o];this.addGroup(u.start,u.count,u.instances)}return this},p.EventDispatcher.prototype.apply(p.InstancedBufferGeometry.prototype),p.Geometry=function(){Object.defineProperty(this,"id",{value:p.GeometryIdCount++}),this.uuid=p.Math.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.elementsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1};p.Geometry.prototype={constructor:p.Geometry,applyMatrix:function(t){for(var e=(new p.Matrix3).getNormalMatrix(t),n=0,r=this.vertices.length;n<r;n++){this.vertices[n].applyMatrix4(t)}for(var n=0,r=this.faces.length;n<r;n++){var i=this.faces[n];i.normal.applyMatrix3(e).normalize();for(var a=0,o=i.vertexNormals.length;a<o;a++)i.vertexNormals[a].applyMatrix3(e).normalize()}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this},rotateX:function(){var t;return function(e){return void 0===t&&(t=new p.Matrix4),t.makeRotationX(e),this.applyMatrix(t),this}}(),rotateY:function(){var t;return function(e){return void 0===t&&(t=new p.Matrix4),t.makeRotationY(e),this.applyMatrix(t),this}}(),rotateZ:function(){var t;return function(e){return void 0===t&&(t=new p.Matrix4),t.makeRotationZ(e),this.applyMatrix(t),this}}(),translate:function(){var t;return function(e,n,r){return void 0===t&&(t=new p.Matrix4),t.makeTranslation(e,n,r),this.applyMatrix(t),this}}(),scale:function(){var t;return function(e,n,r){return void 0===t&&(t=new p.Matrix4),t.makeScale(e,n,r),this.applyMatrix(t),this}}(),lookAt:function(){var t;return function(e){void 0===t&&(t=new p.Object3D),t.lookAt(e),t.updateMatrix(),this.applyMatrix(t.matrix)}}(),fromBufferGeometry:function(t){function e(t,e,r,i){var a=void 0!==o?[c[t].clone(),c[e].clone(),c[r].clone()]:[],f=void 0!==s?[n.colors[t].clone(),n.colors[e].clone(),n.colors[r].clone()]:[],m=new p.Face3(t,e,r,a,f,i);n.faces.push(m),void 0!==u&&n.faceVertexUvs[0].push([d[t].clone(),d[e].clone(),d[r].clone()]),void 0!==l&&n.faceVertexUvs[1].push([h[t].clone(),h[e].clone(),h[r].clone()])}var n=this,r=null!==t.index?t.index.array:void 0,i=t.attributes,a=i.position.array,o=void 0!==i.normal?i.normal.array:void 0,s=void 0!==i.color?i.color.array:void 0,u=void 0!==i.uv?i.uv.array:void 0,l=void 0!==i.uv2?i.uv2.array:void 0;void 0!==l&&(this.faceVertexUvs[1]=[]);for(var c=[],d=[],h=[],f=0,m=0;f<a.length;f+=3,m+=2)n.vertices.push(new p.Vector3(a[f],a[f+1],a[f+2])),void 0!==o&&c.push(new p.Vector3(o[f],o[f+1],o[f+2])),void 0!==s&&n.colors.push(new p.Color(s[f],s[f+1],s[f+2])),void 0!==u&&d.push(new p.Vector2(u[m],u[m+1])),void 0!==l&&h.push(new p.Vector2(l[m],l[m+1]));if(void 0!==r){var g=t.groups;if(g.length>0)for(var f=0;f<g.length;f++)for(var v=g[f],y=v.start,_=v.count,m=y,b=y+_;m<b;m+=3)e(r[m],r[m+1],r[m+2],v.materialIndex);else for(var f=0;f<r.length;f+=3)e(r[f],r[f+1],r[f+2])}else for(var f=0;f<a.length/3;f+=3)e(f,f+1,f+2);return this.computeFaceNormals(),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),this},center:function(){this.computeBoundingBox();var t=this.boundingBox.center().negate();return this.translate(t.x,t.y,t.z),t},normalize:function(){this.computeBoundingSphere();var t=this.boundingSphere.center,e=this.boundingSphere.radius,n=0===e?1:1/e,r=new p.Matrix4;return r.set(n,0,0,-n*t.x,0,n,0,-n*t.y,0,0,n,-n*t.z,0,0,0,1),this.applyMatrix(r),this},computeFaceNormals:function(){for(var t=new p.Vector3,e=new p.Vector3,n=0,r=this.faces.length;n<r;n++){var i=this.faces[n],a=this.vertices[i.a],o=this.vertices[i.b],s=this.vertices[i.c];t.subVectors(s,o),e.subVectors(a,o),t.cross(e),t.normalize(),i.normal.copy(t)}},computeVertexNormals:function(t){void 0===t&&(t=!0);var e,n,r,i,a,o;for(o=new Array(this.vertices.length),e=0,n=this.vertices.length;e<n;e++)o[e]=new p.Vector3;if(t){var s,u,l,c=new p.Vector3,d=new p.Vector3;for(r=0,i=this.faces.length;r<i;r++)a=this.faces[r],s=this.vertices[a.a],u=this.vertices[a.b],l=this.vertices[a.c],c.subVectors(l,u),d.subVectors(s,u),c.cross(d),o[a.a].add(c),o[a.b].add(c),o[a.c].add(c)}else for(r=0,i=this.faces.length;r<i;r++)a=this.faces[r],o[a.a].add(a.normal),o[a.b].add(a.normal),o[a.c].add(a.normal);for(e=0,n=this.vertices.length;e<n;e++)o[e].normalize();for(r=0,i=this.faces.length;r<i;r++){a=this.faces[r];var h=a.vertexNormals;3===h.length?(h[0].copy(o[a.a]),h[1].copy(o[a.b]),h[2].copy(o[a.c])):(h[0]=o[a.a].clone(),h[1]=o[a.b].clone(),h[2]=o[a.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){var t,e,n,r,i;for(n=0,r=this.faces.length;n<r;n++)for(i=this.faces[n],i.__originalFaceNormal?i.__originalFaceNormal.copy(i.normal):i.__originalFaceNormal=i.normal.clone(),i.__originalVertexNormals||(i.__originalVertexNormals=[]),t=0,e=i.vertexNormals.length;t<e;t++)i.__originalVertexNormals[t]?i.__originalVertexNormals[t].copy(i.vertexNormals[t]):i.__originalVertexNormals[t]=i.vertexNormals[t].clone();var a=new p.Geometry;for(a.faces=this.faces,t=0,e=this.morphTargets.length;t<e;t++){if(!this.morphNormals[t]){this.morphNormals[t]={},this.morphNormals[t].faceNormals=[],this.morphNormals[t].vertexNormals=[];var o,s,u=this.morphNormals[t].faceNormals,l=this.morphNormals[t].vertexNormals;for(n=0,r=this.faces.length;n<r;n++)o=new p.Vector3,s={a:new p.Vector3,b:new p.Vector3,c:new p.Vector3},u.push(o),l.push(s)}var c=this.morphNormals[t];a.vertices=this.morphTargets[t].vertices,a.computeFaceNormals(),a.computeVertexNormals();var o,s;for(n=0,r=this.faces.length;n<r;n++)i=this.faces[n],o=c.faceNormals[n],s=c.vertexNormals[n],o.copy(i.normal),s.a.copy(i.vertexNormals[0]),s.b.copy(i.vertexNormals[1]),s.c.copy(i.vertexNormals[2])}for(n=0,r=this.faces.length;n<r;n++)i=this.faces[n],i.normal=i.__originalFaceNormal,i.vertexNormals=i.__originalVertexNormals},computeTangents:function(){},computeLineDistances:function(){for(var t=0,e=this.vertices,n=0,r=e.length;n<r;n++)n>0&&(t+=e[n].distanceTo(e[n-1])),this.lineDistances[n]=t},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new p.Box3),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new p.Sphere),this.boundingSphere.setFromPoints(this.vertices)},merge:function(t,e,n){if(t instanceof p.Geometry!=!1){var r,i=this.vertices.length,a=this.vertices,o=t.vertices,s=this.faces,u=t.faces,l=this.faceVertexUvs[0],c=t.faceVertexUvs[0];void 0===n&&(n=0),void 0!==e&&(r=(new p.Matrix3).getNormalMatrix(e));for(var d=0,h=o.length;d<h;d++){var f=o[d],m=f.clone();void 0!==e&&m.applyMatrix4(e),a.push(m)}for(d=0,h=u.length;d<h;d++){var g,v,y,_=u[d],b=_.vertexNormals,E=_.vertexColors;g=new p.Face3(_.a+i,_.b+i,_.c+i),g.normal.copy(_.normal),void 0!==r&&g.normal.applyMatrix3(r).normalize();for(var w=0,A=b.length;w<A;w++)v=b[w].clone(),void 0!==r&&v.applyMatrix3(r).normalize(),g.vertexNormals.push(v);g.color.copy(_.color);for(var w=0,A=E.length;w<A;w++)y=E[w],g.vertexColors.push(y.clone());g.materialIndex=_.materialIndex+n,s.push(g)}for(d=0,h=c.length;d<h;d++){var S=c[d],T=[];if(void 0!==S){for(var w=0,A=S.length;w<A;w++)T.push(S[w].clone());l.push(T)}}}},mergeMesh:function(t){t instanceof p.Mesh!=!1&&(t.matrixAutoUpdate&&t.updateMatrix(),this.merge(t.geometry,t.matrix))},mergeVertices:function(){var t,e,n,r,i,a,o,s,u={},l=[],c=[],d=Math.pow(10,4);for(n=0,r=this.vertices.length;n<r;n++)t=this.vertices[n],e=Math.round(t.x*d)+"_"+Math.round(t.y*d)+"_"+Math.round(t.z*d),void 0===u[e]?(u[e]=n,l.push(this.vertices[n]),c[n]=l.length-1):c[n]=c[u[e]];var h=[];for(n=0,r=this.faces.length;n<r;n++){i=this.faces[n],i.a=c[i.a],i.b=c[i.b],i.c=c[i.c],a=[i.a,i.b,i.c];for(var f=0;f<3;f++)if(a[f]===a[(f+1)%3]){h.push(n);break}}for(n=h.length-1;n>=0;n--){var p=h[n];for(this.faces.splice(p,1),o=0,s=this.faceVertexUvs.length;o<s;o++)this.faceVertexUvs[o].splice(p,1)}var m=this.vertices.length-l.length;return this.vertices=l,m},sortFacesByMaterialIndex:function(){function t(t,e){return t.materialIndex-e.materialIndex}for(var e=this.faces,n=e.length,r=0;r<n;r++)e[r]._id=r;e.sort(t);var i,a,o=this.faceVertexUvs[0],s=this.faceVertexUvs[1];o&&o.length===n&&(i=[]),s&&s.length===n&&(a=[]);for(var r=0;r<n;r++){var u=e[r]._id;i&&i.push(o[u]),a&&a.push(s[u])}i&&(this.faceVertexUvs[0]=i),a&&(this.faceVertexUvs[1]=a)},toJSON:function(){function t(t,e,n){return n?t|1<<e:t&~(1<<e)}function e(t){var e=t.x.toString()+t.y.toString()+t.z.toString();return void 0!==h[e]?h[e]:(h[e]=d.length/3,d.push(t.x,t.y,t.z),h[e])}function n(t){var e=t.r.toString()+t.g.toString()+t.b.toString();return void 0!==p[e]?p[e]:(p[e]=f.length,f.push(t.getHex()),p[e])}function r(t){var e=t.x.toString()+t.y.toString();return void 0!==g[e]?g[e]:(g[e]=m.length/2,m.push(t.x,t.y),g[e])}var i={metadata:{version:4.4,type:"Geometry",generator:"Geometry.toJSON"}};if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),void 0!==this.parameters){var a=this.parameters;for(var o in a)void 0!==a[o]&&(i[o]=a[o]);return i}for(var s=[],u=0;u<this.vertices.length;u++){var l=this.vertices[u];s.push(l.x,l.y,l.z)}for(var c=[],d=[],h={},f=[],p={},m=[],g={},u=0;u<this.faces.length;u++){var v=this.faces[u],y=void 0!==this.faceVertexUvs[0][u],_=v.normal.length()>0,b=v.vertexNormals.length>0,E=1!==v.color.r||1!==v.color.g||1!==v.color.b,w=v.vertexColors.length>0,A=0;if(A=t(A,0,0),A=t(A,1,!0),A=t(A,2,!1),A=t(A,3,y),A=t(A,4,_),A=t(A,5,b),A=t(A,6,E),A=t(A,7,w),c.push(A),c.push(v.a,v.b,v.c),c.push(v.materialIndex),y){var S=this.faceVertexUvs[0][u];c.push(r(S[0]),r(S[1]),r(S[2]))}if(_&&c.push(e(v.normal)),b){var T=v.vertexNormals;c.push(e(T[0]),e(T[1]),e(T[2]))}if(E&&c.push(n(v.color)),w){var x=v.vertexColors;c.push(n(x[0]),n(x[1]),n(x[2]))}}return i.data={},i.data.vertices=s,i.data.normals=d,f.length>0&&(i.data.colors=f),m.length>0&&(i.data.uvs=[m]),i.data.faces=c,i},clone:function(){return(new p.Geometry).copy(this)},copy:function(t){this.vertices=[],this.faces=[],this.faceVertexUvs=[[]];for(var e=t.vertices,n=0,r=e.length;n<r;n++)this.vertices.push(e[n].clone());for(var i=t.faces,n=0,r=i.length;n<r;n++)this.faces.push(i[n].clone());for(var n=0,r=t.faceVertexUvs.length;n<r;n++){var a=t.faceVertexUvs[n];void 0===this.faceVertexUvs[n]&&(this.faceVertexUvs[n]=[]);for(var o=0,s=a.length;o<s;o++){for(var u=a[o],l=[],c=0,d=u.length;c<d;c++){var h=u[c];l.push(h.clone())}this.faceVertexUvs[n].push(l)}}return this},dispose:function(){this.dispatchEvent({type:"dispose"})}},p.EventDispatcher.prototype.apply(p.Geometry.prototype),p.GeometryIdCount=0,p.DirectGeometry=function(){Object.defineProperty(this,"id",{value:p.GeometryIdCount++}),this.uuid=p.Math.generateUUID(),this.name="",this.type="DirectGeometry",this.indices=[],this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1},p.DirectGeometry.prototype={constructor:p.DirectGeometry,computeBoundingBox:p.Geometry.prototype.computeBoundingBox,computeBoundingSphere:p.Geometry.prototype.computeBoundingSphere,computeFaceNormals:function(){},computeVertexNormals:function(){},computeGroups:function(t){for(var e,n,r=[],i=t.faces,a=0;a<i.length;a++){var o=i[a];o.materialIndex!==n&&(n=o.materialIndex,void 0!==e&&(e.count=3*a-e.start,r.push(e)),e={start:3*a,materialIndex:n})}void 0!==e&&(e.count=3*a-e.start,r.push(e)),this.groups=r},fromGeometry:function(t){var e,n=t.faces,r=t.vertices,i=t.faceVertexUvs,a=i[0]&&i[0].length>0,o=i[1]&&i[1].length>0,s=t.morphTargets,u=s.length;if(u>0){e=[];for(var l=0;l<u;l++)e[l]=[];this.morphTargets.position=e}var c,d=t.morphNormals,h=d.length;if(h>0){c=[];for(var l=0;l<h;l++)c[l]=[];this.morphTargets.normal=c}for(var f=t.skinIndices,m=t.skinWeights,g=f.length===r.length,v=m.length===r.length,l=0;l<n.length;l++){var y=n[l];this.vertices.push(r[y.a],r[y.b],r[y.c]);var _=y.vertexNormals;if(3===_.length)this.normals.push(_[0],_[1],_[2]);else{var b=y.normal;this.normals.push(b,b,b)}var E=y.vertexColors;if(3===E.length)this.colors.push(E[0],E[1],E[2]);else{var w=y.color;this.colors.push(w,w,w)}if(!0===a){var A=i[0][l];void 0!==A?this.uvs.push(A[0],A[1],A[2]):this.uvs.push(new p.Vector2,new p.Vector2,new p.Vector2)}if(!0===o){var A=i[1][l];void 0!==A?this.uvs2.push(A[0],A[1],A[2]):this.uvs2.push(new p.Vector2,new p.Vector2,new p.Vector2)}for(var S=0;S<u;S++){var T=s[S].vertices;e[S].push(T[y.a],T[y.b],T[y.c])}for(var S=0;S<h;S++){var x=d[S].vertexNormals[l];c[S].push(x.a,x.b,x.c)}g&&this.skinIndices.push(f[y.a],f[y.b],f[y.c]),v&&this.skinWeights.push(m[y.a],m[y.b],m[y.c])}return this.computeGroups(t),this.verticesNeedUpdate=t.verticesNeedUpdate,this.normalsNeedUpdate=t.normalsNeedUpdate,this.colorsNeedUpdate=t.colorsNeedUpdate,this.uvsNeedUpdate=t.uvsNeedUpdate,this.groupsNeedUpdate=t.groupsNeedUpdate,this},dispose:function(){this.dispatchEvent({type:"dispose"})}},p.EventDispatcher.prototype.apply(p.DirectGeometry.prototype),p.Camera=function(){p.Object3D.call(this),this.type="Camera",this.matrixWorldInverse=new p.Matrix4,this.projectionMatrix=new p.Matrix4},p.Camera.prototype=Object.create(p.Object3D.prototype),p.Camera.prototype.constructor=p.Camera,p.Camera.prototype.getWorldDirection=function(){var t=new p.Quaternion;return function(e){var n=e||new p.Vector3;return this.getWorldQuaternion(t),n.set(0,0,-1).applyQuaternion(t)}}(),p.Camera.prototype.lookAt=function(){var t=new p.Matrix4;return function(e){t.lookAt(this.position,e,this.up),this.quaternion.setFromRotationMatrix(t)}}(),p.Camera.prototype.clone=function(){return(new this.constructor).copy(this)},p.Camera.prototype.copy=function(t){return p.Object3D.prototype.copy.call(this,t),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this},p.PerspectiveCamera=function(t,e,n,r){p.Camera.call(this),this.type="PerspectiveCamera",this.focalLength=10,this.zoom=1,this.fov=void 0!==t?t:50,this.aspect=void 0!==e?e:1,this.near=void 0!==n?n:.1,this.far=void 0!==r?r:2e3,this.updateProjectionMatrix()},p.PerspectiveCamera.prototype=Object.create(p.Camera.prototype),p.PerspectiveCamera.prototype.constructor=p.PerspectiveCamera,p.PerspectiveCamera.prototype.setLens=function(t,e){void 0===e&&(e=24),this.fov=2*p.Math.radToDeg(Math.atan(e/(2*t))),this.updateProjectionMatrix()},p.PerspectiveCamera.prototype.setViewOffset=function(t,e,n,r,i,a){this.fullWidth=t,this.fullHeight=e,this.x=n,this.y=r,this.width=i,this.height=a,this.updateProjectionMatrix()},p.PerspectiveCamera.prototype.updateProjectionMatrix=function(){var t=p.Math.radToDeg(2*Math.atan(Math.tan(.5*p.Math.degToRad(this.fov))/this.zoom));if(this.fullWidth){var e=this.fullWidth/this.fullHeight,n=Math.tan(p.Math.degToRad(.5*t))*this.near,r=-n,i=e*r,a=e*n,o=Math.abs(a-i),s=Math.abs(n-r);this.projectionMatrix.makeFrustum(i+this.x*o/this.fullWidth,i+(this.x+this.width)*o/this.fullWidth,n-(this.y+this.height)*s/this.fullHeight,n-this.y*s/this.fullHeight,this.near,this.far)}else this.projectionMatrix.makePerspective(t,this.aspect,this.near,this.far)},p.PerspectiveCamera.prototype.copy=function(t){return p.Camera.prototype.copy.call(this,t),this.focalLength=t.focalLength,this.zoom=t.zoom,this.fov=t.fov,this.aspect=t.aspect,this.near=t.near,this.far=t.far,this},p.PerspectiveCamera.prototype.toJSON=function(t){var e=p.Object3D.prototype.toJSON.call(this,t);return e.object.focalLength=this.focalLength,e.object.zoom=this.zoom,e.object.fov=this.fov,e.object.aspect=this.aspect,e.object.near=this.near,e.object.far=this.far,e},p.Light=function(t,e){p.Object3D.call(this),this.type="Light",this.color=new p.Color(t),this.intensity=void 0!==e?e:1,this.receiveShadow=void 0},p.Light.prototype=Object.create(p.Object3D.prototype),p.Light.prototype.constructor=p.Light,p.Light.prototype.copy=function(t){return p.Object3D.prototype.copy.call(this,t),this.color.copy(t.color),this.intensity=t.intensity,this},p.Light.prototype.toJSON=function(t){var e=p.Object3D.prototype.toJSON.call(this,t);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,void 0!==this.groundColor&&(e.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(e.object.distance=this.distance),void 0!==this.angle&&(e.object.angle=this.angle),void 0!==this.decay&&(e.object.decay=this.decay),void 0!==this.penumbra&&(e.object.penumbra=this.penumbra),e},p.Scene=function(){p.Object3D.call(this),this.type="Scene",this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0},p.Scene.prototype=Object.create(p.Object3D.prototype),p.Scene.prototype.constructor=p.Scene,p.Scene.prototype.copy=function(t,e){return p.Object3D.prototype.copy.call(this,t,e),null!==t.fog&&(this.fog=t.fog.clone()),null!==t.overrideMaterial&&(this.overrideMaterial=t.overrideMaterial.clone()),this.autoUpdate=t.autoUpdate,this.matrixAutoUpdate=t.matrixAutoUpdate,this},p.FogExp2=function(t,e){this.name="",this.color=new p.Color(t),this.density=void 0!==e?e:25e-5},p.FogExp2.prototype.clone=function(){return new p.FogExp2(this.color.getHex(),this.density)},p.ImmediateRenderObject=function(t){p.Object3D.call(this),this.material=t,this.render=function(t){}},p.ImmediateRenderObject.prototype=Object.create(p.Object3D.prototype),p.ImmediateRenderObject.prototype.constructor=p.ImmediateRenderObject,p.SphereBufferGeometry=function(t,e,n,r,i,a,o){p.BufferGeometry.call(this),this.type="SphereBufferGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:n,phiStart:r,phiLength:i,thetaStart:a,thetaLength:o},t=t||50,e=Math.max(3,Math.floor(e)||8),n=Math.max(2,Math.floor(n)||6),r=void 0!==r?r:0,i=void 0!==i?i:2*Math.PI,a=void 0!==a?a:0,o=void 0!==o?o:Math.PI;for(var s=a+o,u=(e+1)*(n+1),l=new p.BufferAttribute(new Float32Array(3*u),3),c=new p.BufferAttribute(new Float32Array(3*u),3),d=new p.BufferAttribute(new Float32Array(2*u),2),h=0,f=[],m=new p.Vector3,g=0;g<=n;g++){for(var v=[],y=g/n,_=0;_<=e;_++){var b=_/e,E=-t*Math.cos(r+b*i)*Math.sin(a+y*o),w=t*Math.cos(a+y*o),A=t*Math.sin(r+b*i)*Math.sin(a+y*o);m.set(E,w,A).normalize(),l.setXYZ(h,E,w,A),c.setXYZ(h,m.x,m.y,m.z),d.setXY(h,b,1-y),v.push(h),h++}f.push(v)}for(var S=[],g=0;g<n;g++)for(var _=0;_<e;_++){var T=f[g][_+1],x=f[g][_],k=f[g+1][_],C=f[g+1][_+1];(0!==g||a>0)&&S.push(T,x,C),(g!==n-1||s<Math.PI)&&S.push(x,k,C)}this.setIndex(new(l.count>65535?p.Uint32Attribute:p.Uint16Attribute)(S,1)),this.addAttribute("position",l),this.addAttribute("normal",c),this.addAttribute("uv",d),this.boundingSphere=new p.Sphere(new p.Vector3,t)},p.SphereBufferGeometry.prototype=Object.create(p.BufferGeometry.prototype),p.SphereBufferGeometry.prototype.constructor=p.SphereBufferGeometry,p.SphereGeometry=function(t,e,n,r,i,a,o){p.Geometry.call(this),this.type="SphereGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:n,phiStart:r,phiLength:i,thetaStart:a,thetaLength:o},this.fromBufferGeometry(new p.SphereBufferGeometry(t,e,n,r,i,a,o))},p.SphereGeometry.prototype=Object.create(p.Geometry.prototype),p.SphereGeometry.prototype.constructor=p.SphereGeometry,p.Material=function(){Object.defineProperty(this,"id",{value:p.MaterialIdCount++}),this.uuid=p.Math.generateUUID(),this.name="",this.type="Material",this.side=p.FrontSide,this.opacity=1,this.transparent=!1,this.blending=p.NormalBlending,this.blendSrc=p.SrcAlphaFactor,this.blendDst=p.OneMinusSrcAlphaFactor,this.blendEquation=p.AddEquation,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=p.LessEqualDepth,this.depthTest=!0,this.depthWrite=!0,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.alphaTest=0,this.premultipliedAlpha=!1,this.overdraw=0,this.visible=!0,this._needsUpdate=!0},p.Material.prototype={constructor:p.Material,get needsUpdate(){return this._needsUpdate},set needsUpdate(t){!0===t&&this.update(),this._needsUpdate=t},setValues:function(t){if(void 0!==t)for(var e in t){var n=t[e];if(void 0!==n){var r=this[e];void 0!==r&&(r instanceof p.Color?r.set(n):r instanceof p.Vector3&&n instanceof p.Vector3?r.copy(n):this[e]="overdraw"===e?Number(n):n)}}},toJSON:function(t){function e(t){var e=[];for(var n in t){var r=t[n];delete r.metadata,e.push(r)}return e}var n=void 0===t;n&&(t={textures:{},images:{}});var r={metadata:{version:4.4,type:"Material",generator:"Material.toJSON"}};if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),this.color instanceof p.Color&&(r.color=this.color.getHex()),.5!==this.roughness&&(r.roughness=this.roughness),.5!==this.metalness&&(r.metalness=this.metalness),this.emissive instanceof p.Color&&(r.emissive=this.emissive.getHex()),this.specular instanceof p.Color&&(r.specular=this.specular.getHex()),void 0!==this.shininess&&(r.shininess=this.shininess),this.map instanceof p.Texture&&(r.map=this.map.toJSON(t).uuid),this.alphaMap instanceof p.Texture&&(r.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap instanceof p.Texture&&(r.lightMap=this.lightMap.toJSON(t).uuid),this.bumpMap instanceof p.Texture&&(r.bumpMap=this.bumpMap.toJSON(t).uuid,r.bumpScale=this.bumpScale),this.normalMap instanceof p.Texture&&(r.normalMap=this.normalMap.toJSON(t).uuid,r.normalScale=this.normalScale.toArray()),this.displacementMap instanceof p.Texture&&(r.displacementMap=this.displacementMap.toJSON(t).uuid,r.displacementScale=this.displacementScale,r.displacementBias=this.displacementBias),this.roughnessMap instanceof p.Texture&&(r.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap instanceof p.Texture&&(r.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap instanceof p.Texture&&(r.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap instanceof p.Texture&&(r.specularMap=this.specularMap.toJSON(t).uuid),this.envMap instanceof p.Texture&&(r.envMap=this.envMap.toJSON(t).uuid,r.reflectivity=this.reflectivity),void 0!==this.size&&(r.size=this.size),void 0!==this.sizeAttenuation&&(r.sizeAttenuation=this.sizeAttenuation),void 0!==this.vertexColors&&this.vertexColors!==p.NoColors&&(r.vertexColors=this.vertexColors),void 0!==this.shading&&this.shading!==p.SmoothShading&&(r.shading=this.shading),void 0!==this.blending&&this.blending!==p.NormalBlending&&(r.blending=this.blending),void 0!==this.side&&this.side!==p.FrontSide&&(r.side=this.side),this.opacity<1&&(r.opacity=this.opacity),!0===this.transparent&&(r.transparent=this.transparent),this.alphaTest>0&&(r.alphaTest=this.alphaTest),!0===this.premultipliedAlpha&&(r.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(r.wireframe=this.wireframe),this.wireframeLinewidth>1&&(r.wireframeLinewidth=this.wireframeLinewidth),n){var i=e(t.textures),a=e(t.images);i.length>0&&(r.textures=i),a.length>0&&(r.images=a)}return r},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.name=t.name,this.side=t.side,this.opacity=t.opacity,this.transparent=t.transparent,this.blending=t.blending,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.alphaTest=t.alphaTest,this.premultipliedAlpha=t.premultipliedAlpha,this.overdraw=t.overdraw,this.visible=t.visible,this},update:function(){this.dispatchEvent({type:"update"})},dispose:function(){this.dispatchEvent({type:"dispose"})}},p.EventDispatcher.prototype.apply(p.Material.prototype),p.MaterialIdCount=0,p.LineBasicMaterial=function(t){p.Material.call(this),this.type="LineBasicMaterial",this.color=new p.Color(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.blending=p.NormalBlending,this.vertexColors=p.NoColors,this.fog=!0,this.setValues(t)},p.LineBasicMaterial.prototype=Object.create(p.Material.prototype),p.LineBasicMaterial.prototype.constructor=p.LineBasicMaterial,p.LineBasicMaterial.prototype.copy=function(t){return p.Material.prototype.copy.call(this,t),this.color.copy(t.color),this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this.vertexColors=t.vertexColors,this.fog=t.fog,this},p.LineDashedMaterial=function(t){p.Material.call(this),this.type="LineDashedMaterial",this.color=new p.Color(16777215),this.linewidth=1,this.scale=1,this.dashSize=3,this.gapSize=1,this.blending=p.NormalBlending,this.vertexColors=p.NoColors,this.fog=!0,this.setValues(t)},p.LineDashedMaterial.prototype=Object.create(p.Material.prototype),p.LineDashedMaterial.prototype.constructor=p.LineDashedMaterial,p.LineDashedMaterial.prototype.copy=function(t){return p.Material.prototype.copy.call(this,t),this.color.copy(t.color),this.linewidth=t.linewidth,this.scale=t.scale,this.dashSize=t.dashSize,this.gapSize=t.gapSize,this.vertexColors=t.vertexColors,this.fog=t.fog,this},p.PointsMaterial=function(t){p.Material.call(this),this.type="PointsMaterial",this.color=new p.Color(16777215),this.map=null,this.size=1,this.sizeAttenuation=!0,this.blending=p.NormalBlending,this.vertexColors=p.NoColors,this.fog=!0,this.setValues(t)},p.PointsMaterial.prototype=Object.create(p.Material.prototype),p.PointsMaterial.prototype.constructor=p.PointsMaterial,p.PointsMaterial.prototype.copy=function(t){return p.Material.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this.vertexColors=t.vertexColors,this.fog=t.fog,this},p.MeshDepthMaterial=function(t){p.Material.call(this),this.type="MeshDepthMaterial",this.morphTargets=!1,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(t)},p.MeshDepthMaterial.prototype=Object.create(p.Material.prototype),p.MeshDepthMaterial.prototype.constructor=p.MeshDepthMaterial,p.MeshDepthMaterial.prototype.copy=function(t){return p.Material.prototype.copy.call(this,t),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this},p.MeshNormalMaterial=function(t){p.Material.call(this,t),this.type="MeshNormalMaterial",this.wireframe=!1,this.wireframeLinewidth=1,this.morphTargets=!1,this.setValues(t)},p.MeshNormalMaterial.prototype=Object.create(p.Material.prototype),p.MeshNormalMaterial.prototype.constructor=p.MeshNormalMaterial,p.MeshNormalMaterial.prototype.copy=function(t){return p.Material.prototype.copy.call(this,t),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this},p.ShaderMaterial=function(t){p.Material.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.shading=p.SmoothShading,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.vertexColors=p.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,void 0!==t&&(t.attributes,this.setValues(t))},p.ShaderMaterial.prototype=Object.create(p.Material.prototype),p.ShaderMaterial.prototype.constructor=p.ShaderMaterial,p.ShaderMaterial.prototype.copy=function(t){return p.Material.prototype.copy.call(this,t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=p.UniformsUtils.clone(t.uniforms),this.defines=t.defines,this.shading=t.shading,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.fog=t.fog,this.lights=t.lights,this.vertexColors=t.vertexColors,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this.extensions=t.extensions,this},p.ShaderMaterial.prototype.toJSON=function(t){var e=p.Material.prototype.toJSON.call(this,t);return e.uniforms=this.uniforms,e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader,e},p.MeshBasicMaterial=function(t){p.Material.call(this),this.type="MeshBasicMaterial",this.color=new p.Color(16777215),this.map=null,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=p.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=p.SmoothShading,this.blending=p.NormalBlending,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=p.NoColors,this.skinning=!1,this.morphTargets=!1,this.setValues(t)},p.MeshBasicMaterial.prototype=Object.create(p.Material.prototype),p.MeshBasicMaterial.prototype.constructor=p.MeshBasicMaterial,p.MeshBasicMaterial.prototype.copy=function(t){return p.Material.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.fog=t.fog,this.shading=t.shading,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.vertexColors=t.vertexColors,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this},p.MeshLambertMaterial=function(t){p.Material.call(this),this.type="MeshLambertMaterial",this.color=new p.Color(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new p.Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=p.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.blending=p.NormalBlending,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=p.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)},p.MeshLambertMaterial.prototype=Object.create(p.Material.prototype),p.MeshLambertMaterial.prototype.constructor=p.MeshLambertMaterial,p.MeshLambertMaterial.prototype.copy=function(t){return p.Material.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.fog=t.fog,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.vertexColors=t.vertexColors,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},p.MeshStandardMaterial=function(t){p.Material.call(this),this.type="MeshStandardMaterial",this.color=new p.Color(16777215),this.roughness=.5,this.metalness=.5,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new p.Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new p.Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.fog=!0,this.shading=p.SmoothShading,this.blending=p.NormalBlending,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=p.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)},p.MeshStandardMaterial.prototype=Object.create(p.Material.prototype),p.MeshStandardMaterial.prototype.constructor=p.MeshStandardMaterial,p.MeshStandardMaterial.prototype.copy=function(t){return p.Material.prototype.copy.call(this,t),this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapIntensity=t.envMapIntensity,this.refractionRatio=t.refractionRatio,this.fog=t.fog,this.shading=t.shading,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.vertexColors=t.vertexColors,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},p.MeshPhongMaterial=function(t){p.Material.call(this),this.type="MeshPhongMaterial",this.color=new p.Color(16777215),this.specular=new p.Color(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new p.Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new p.Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=p.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=p.SmoothShading,this.blending=p.NormalBlending,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=p.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)},p.MeshPhongMaterial.prototype=Object.create(p.Material.prototype),p.MeshPhongMaterial.prototype.constructor=p.MeshPhongMaterial,p.MeshPhongMaterial.prototype.copy=function(t){return p.Material.prototype.copy.call(this,t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.fog=t.fog,this.shading=t.shading,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.vertexColors=t.vertexColors,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},p.MultiMaterial=function(t){this.uuid=p.Math.generateUUID(),this.type="MultiMaterial",this.materials=t instanceof Array?t:[],this.visible=!0},p.MultiMaterial.prototype={constructor:p.MultiMaterial,toJSON:function(t){for(var e={metadata:{version:4.2,type:"material",generator:"MaterialExporter"},uuid:this.uuid,type:this.type,materials:[]},n=this.materials,r=0,i=n.length;r<i;r++){var a=n[r].toJSON(t);delete a.metadata,e.materials.push(a)}return e.visible=this.visible,e},clone:function(){for(var t=new this.constructor,e=0;e<this.materials.length;e++)t.materials.push(this.materials[e].clone());return t.visible=this.visible,t}},p.RawShaderMaterial=function(t){p.ShaderMaterial.call(this,t),this.type="RawShaderMaterial"},p.RawShaderMaterial.prototype=Object.create(p.ShaderMaterial.prototype),p.RawShaderMaterial.prototype.constructor=p.RawShaderMaterial,p.Texture=function(t,e,n,r,i,a,o,s,u){Object.defineProperty(this,"id",{value:p.TextureIdCount++}),this.uuid=p.Math.generateUUID(),this.name="",this.sourceFile="",this.image=void 0!==t?t:p.Texture.DEFAULT_IMAGE,this.mipmaps=[],this.mapping=void 0!==e?e:p.Texture.DEFAULT_MAPPING,this.wrapS=void 0!==n?n:p.ClampToEdgeWrapping,this.wrapT=void 0!==r?r:p.ClampToEdgeWrapping,this.magFilter=void 0!==i?i:p.LinearFilter,this.minFilter=void 0!==a?a:p.LinearMipMapLinearFilter,this.anisotropy=void 0!==u?u:1,this.format=void 0!==o?o:p.RGBAFormat,this.type=void 0!==s?s:p.UnsignedByteType,this.offset=new p.Vector2(0,0),this.repeat=new p.Vector2(1,1),this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=p.LinearEncoding,this.version=0,this.onUpdate=null},p.Texture.DEFAULT_IMAGE=void 0,p.Texture.DEFAULT_MAPPING=p.UVMapping,p.Texture.prototype={constructor:p.Texture,set needsUpdate(t){!0===t&&this.version++},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.image=t.image,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.encoding=t.encoding,this},toJSON:function(t){if(void 0!==t.textures[this.uuid])return t.textures[this.uuid];var e={metadata:{version:4.4,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],wrap:[this.wrapS,this.wrapT],minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy};if(void 0!==this.image){var n=this.image;void 0===n.uuid&&(n.uuid=p.Math.generateUUID()),void 0===t.images[n.uuid]&&(t.images[n.uuid]={uuid:n.uuid,url:function(t){var e;return void 0!==t.toDataURL?e=t:(e=document.createElement("canvas"),e.width=t.width,e.height=t.height,e.getContext("2d").drawImage(t,0,0,t.width,t.height)),e.width>2048||e.height>2048?e.toDataURL("image/jpeg",.6):e.toDataURL("image/png")}(n)}),e.image=n.uuid}return t.textures[this.uuid]=e,e},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(t){if(this.mapping===p.UVMapping){if(t.multiply(this.repeat),t.add(this.offset),t.x<0||t.x>1)switch(this.wrapS){case p.RepeatWrapping:t.x=t.x-Math.floor(t.x);break;case p.ClampToEdgeWrapping:t.x=t.x<0?0:1;break;case p.MirroredRepeatWrapping:1===Math.abs(Math.floor(t.x)%2)?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x)}if(t.y<0||t.y>1)switch(this.wrapT){case p.RepeatWrapping:t.y=t.y-Math.floor(t.y);break;case p.ClampToEdgeWrapping:t.y=t.y<0?0:1;break;case p.MirroredRepeatWrapping:1===Math.abs(Math.floor(t.y)%2)?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y)}this.flipY&&(t.y=1-t.y)}}},p.EventDispatcher.prototype.apply(p.Texture.prototype),p.TextureIdCount=0,p.DataTexture=function(t,e,n,r,i,a,o,s,u,l,c){p.Texture.call(this,null,a,o,s,u,l,r,i,c),this.image={data:t,width:e,height:n},this.magFilter=void 0!==u?u:p.NearestFilter,this.minFilter=void 0!==l?l:p.NearestFilter,this.flipY=!1,this.generateMipmaps=!1},p.DataTexture.prototype=Object.create(p.Texture.prototype),p.DataTexture.prototype.constructor=p.DataTexture,p.CompressedTexture=function(t,e,n,r,i,a,o,s,u,l,c){p.Texture.call(this,null,a,o,s,u,l,r,i,c),this.image={width:e,height:n},this.mipmaps=t,this.flipY=!1,this.generateMipmaps=!1},p.CompressedTexture.prototype=Object.create(p.Texture.prototype),p.CompressedTexture.prototype.constructor=p.CompressedTexture,p.CubeTexture=function(t,e,n,r,i,a,o,s,u){t=void 0!==t?t:[],e=void 0!==e?e:p.CubeReflectionMapping,p.Texture.call(this,t,e,n,r,i,a,o,s,u),this.flipY=!1},p.CubeTexture.prototype=Object.create(p.Texture.prototype),p.CubeTexture.prototype.constructor=p.CubeTexture,Object.defineProperty(p.CubeTexture.prototype,"images",{get:function(){return this.image},set:function(t){this.image=t}}),p.VideoTexture=function(t,e,n,r,i,a,o,s,u){function l(){requestAnimationFrame(l),t.readyState>=t.HAVE_CURRENT_DATA&&(c.needsUpdate=!0)}p.Texture.call(this,t,e,n,r,i,a,o,s,u),this.generateMipmaps=!1;var c=this;l()},p.VideoTexture.prototype=Object.create(p.Texture.prototype),p.VideoTexture.prototype.constructor=p.VideoTexture,p.Sprite=function(){var t=new Uint16Array([0,1,2,0,2,3]),e=new Float32Array([-.5,-.5,0,.5,-.5,0,.5,.5,0,-.5,.5,0]),n=new Float32Array([0,0,1,0,1,1,0,1]),r=new p.BufferGeometry;return r.setIndex(new p.BufferAttribute(t,1)),r.addAttribute("position",new p.BufferAttribute(e,3)),r.addAttribute("uv",new p.BufferAttribute(n,2)),function(t){p.Object3D.call(this),this.type="Sprite",this.geometry=r,this.material=void 0!==t?t:new p.SpriteMaterial}}(),p.Sprite.prototype=Object.create(p.Object3D.prototype),p.Sprite.prototype.constructor=p.Sprite,p.Sprite.prototype.raycast=function(){var t=new p.Vector3;return function(e,n){t.setFromMatrixPosition(this.matrixWorld);var r=e.ray.distanceSqToPoint(t);r>this.scale.x*this.scale.y||n.push({distance:Math.sqrt(r),point:this.position,face:null,object:this})}}(),p.Sprite.prototype.clone=function(){return new this.constructor(this.material).copy(this)},p.Particle=p.Sprite,p.LensFlare=function(t,e,n,r,i){p.Object3D.call(this),this.lensFlares=[],this.positionScreen=new p.Vector3,this.customUpdateCallback=void 0,void 0!==t&&this.add(t,e,n,r,i)},p.LensFlare.prototype=Object.create(p.Object3D.prototype),p.LensFlare.prototype.constructor=p.LensFlare,p.LensFlare.prototype.add=function(t,e,n,r,i,a){void 0===e&&(e=-1),void 0===n&&(n=0),void 0===a&&(a=1),void 0===i&&(i=new p.Color(16777215)),void 0===r&&(r=p.NormalBlending),n=Math.min(n,Math.max(0,n)),this.lensFlares.push({texture:t,size:e,distance:n,x:0,y:0,z:0,scale:1,rotation:0,opacity:a,color:i,blending:r})},p.LensFlare.prototype.updateLensFlares=function(){var t,e,n=this.lensFlares.length,r=2*-this.positionScreen.x,i=2*-this.positionScreen.y;for(t=0;t<n;t++)e=this.lensFlares[t],e.x=this.positionScreen.x+r*e.distance,e.y=this.positionScreen.y+i*e.distance,e.wantedRotation=e.x*Math.PI*.25,e.rotation+=.25*(e.wantedRotation-e.rotation)},p.LensFlare.prototype.copy=function(t){p.Object3D.prototype.copy.call(this,t),this.positionScreen.copy(t.positionScreen),this.customUpdateCallback=t.customUpdateCallback;for(var e=0,n=t.lensFlares.length;e<n;e++)this.lensFlares.push(t.lensFlares[e]);return this},p.Line=function(t,e,n){if(1===n)return new p.LineSegments(t,e);p.Object3D.call(this),this.type="Line",this.geometry=void 0!==t?t:new p.Geometry,this.material=void 0!==e?e:new p.LineBasicMaterial({color:16777215*Math.random()})},p.Line.prototype=Object.create(p.Object3D.prototype),p.Line.prototype.constructor=p.Line,p.Line.prototype.raycast=function(){var t=new p.Matrix4,e=new p.Ray,n=new p.Sphere;return function(r,i){var a=r.linePrecision,o=a*a,s=this.geometry,u=this.matrixWorld;if(null===s.boundingSphere&&s.computeBoundingSphere(),n.copy(s.boundingSphere),n.applyMatrix4(u),!1!==r.ray.intersectsSphere(n)){t.getInverse(u),e.copy(r.ray).applyMatrix4(t);var l=new p.Vector3,c=new p.Vector3,d=new p.Vector3,h=new p.Vector3,f=this instanceof p.LineSegments?2:1;if(s instanceof p.BufferGeometry){var m=s.index,g=s.attributes,v=g.position.array;if(null!==m)for(var y=m.array,_=0,b=y.length-1;_<b;_+=f){var E=y[_],w=y[_+1];l.fromArray(v,3*E),c.fromArray(v,3*w);var A=e.distanceSqToSegment(l,c,h,d);if(!(A>o)){h.applyMatrix4(this.matrixWorld);var S=r.ray.origin.distanceTo(h);S<r.near||S>r.far||i.push({distance:S,point:d.clone().applyMatrix4(this.matrixWorld),index:_,face:null,faceIndex:null,object:this})}}else for(var _=0,b=v.length/3-1;_<b;_+=f){l.fromArray(v,3*_),c.fromArray(v,3*_+3);var A=e.distanceSqToSegment(l,c,h,d);if(!(A>o)){h.applyMatrix4(this.matrixWorld);var S=r.ray.origin.distanceTo(h);S<r.near||S>r.far||i.push({distance:S,point:d.clone().applyMatrix4(this.matrixWorld),index:_,face:null,faceIndex:null,object:this})}}}else if(s instanceof p.Geometry)for(var T=s.vertices,x=T.length,_=0;_<x-1;_+=f){var A=e.distanceSqToSegment(T[_],T[_+1],h,d);if(!(A>o)){h.applyMatrix4(this.matrixWorld);var S=r.ray.origin.distanceTo(h);S<r.near||S>r.far||i.push({distance:S,point:d.clone().applyMatrix4(this.matrixWorld),index:_,face:null,faceIndex:null,object:this})}}}}}(),p.Line.prototype.clone=function(){return new this.constructor(this.geometry,this.material).copy(this)},p.LineStrip=0,p.LinePieces=1,p.LineSegments=function(t,e){p.Line.call(this,t,e),this.type="LineSegments"},p.LineSegments.prototype=Object.create(p.Line.prototype),p.LineSegments.prototype.constructor=p.LineSegments,p.Mesh=function(t,e){p.Object3D.call(this),this.type="Mesh",this.geometry=void 0!==t?t:new p.Geometry,this.material=void 0!==e?e:new p.MeshBasicMaterial({color:16777215*Math.random()}),this.drawMode=p.TrianglesDrawMode,this.updateMorphTargets()},p.Mesh.prototype=Object.create(p.Object3D.prototype),p.Mesh.prototype.constructor=p.Mesh,p.Mesh.prototype.setDrawMode=function(t){this.drawMode=t},p.Mesh.prototype.updateMorphTargets=function(){if(void 0!==this.geometry.morphTargets&&this.geometry.morphTargets.length>0){this.morphTargetBase=-1,this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var t=0,e=this.geometry.morphTargets.length;t<e;t++)this.morphTargetInfluences.push(0),this.morphTargetDictionary[this.geometry.morphTargets[t].name]=t}},p.Mesh.prototype.getMorphTargetIndexByName=function(t){return void 0!==this.morphTargetDictionary[t]?this.morphTargetDictionary[t]:0},p.Mesh.prototype.raycast=function(){function t(t,e,n,r,i,a,o){return p.Triangle.barycoordFromPoint(t,e,n,r,g),i.multiplyScalar(g.x),a.multiplyScalar(g.y),o.multiplyScalar(g.z),i.add(a).add(o),i.clone()}function e(t,e,n,r,i,a,o){var s=t.material;if(null===(s.side===p.BackSide?n.intersectTriangle(a,i,r,!0,o):n.intersectTriangle(r,i,a,s.side!==p.DoubleSide,o)))return null;y.copy(o),y.applyMatrix4(t.matrixWorld);var u=e.ray.origin.distanceTo(y);return u<e.near||u>e.far?null:{distance:u,point:y.clone(),object:t}}function n(n,r,i,a,l,c,d,g){o.fromArray(a,3*c),s.fromArray(a,3*d),u.fromArray(a,3*g);var y=e(n,r,i,o,s,u,v);return y&&(l&&(h.fromArray(l,2*c),f.fromArray(l,2*d),m.fromArray(l,2*g),y.uv=t(v,o,s,u,h,f,m)),y.face=new p.Face3(c,d,g,p.Triangle.normal(o,s,u)),y.faceIndex=c),y}var r=new p.Matrix4,i=new p.Ray,a=new p.Sphere,o=new p.Vector3,s=new p.Vector3,u=new p.Vector3,l=new p.Vector3,c=new p.Vector3,d=new p.Vector3,h=new p.Vector2,f=new p.Vector2,m=new p.Vector2,g=new p.Vector3,v=new p.Vector3,y=new p.Vector3;return function(g,y){var _=this.geometry,b=this.material,E=this.matrixWorld;if(void 0!==b&&(null===_.boundingSphere&&_.computeBoundingSphere(),a.copy(_.boundingSphere),a.applyMatrix4(E),!1!==g.ray.intersectsSphere(a)&&(r.getInverse(E),i.copy(g.ray).applyMatrix4(r),null===_.boundingBox||!1!==i.intersectsBox(_.boundingBox)))){var w,A;if(_ instanceof p.BufferGeometry){var S,T,x,k=_.index,C=_.attributes,M=C.position.array;if(void 0!==C.uv&&(w=C.uv.array),null!==k)for(var R=k.array,L=0,I=R.length;L<I;L+=3)S=R[L],T=R[L+1],x=R[L+2],(A=n(this,g,i,M,w,S,T,x))&&(A.faceIndex=Math.floor(L/3),y.push(A));else for(var L=0,I=M.length;L<I;L+=9)S=L/3,T=S+1,x=S+2,(A=n(this,g,i,M,w,S,T,x))&&(A.index=S,y.push(A))}else if(_ instanceof p.Geometry){var P,O,D,N=b instanceof p.MultiMaterial,U=!0===N?b.materials:null,F=_.vertices,B=_.faces,j=_.faceVertexUvs[0];j.length>0&&(w=j);for(var V=0,G=B.length;V<G;V++){var z=B[V],H=!0===N?U[z.materialIndex]:b;if(void 0!==H){if(P=F[z.a],O=F[z.b],D=F[z.c],!0===H.morphTargets){var K=_.morphTargets,Y=this.morphTargetInfluences;o.set(0,0,0),s.set(0,0,0),u.set(0,0,0);for(var W=0,q=K.length;W<q;W++){var X=Y[W];if(0!==X){var $=K[W].vertices;o.addScaledVector(l.subVectors($[z.a],P),X),s.addScaledVector(c.subVectors($[z.b],O),X),u.addScaledVector(d.subVectors($[z.c],D),X)}}o.add(P),s.add(O),u.add(D),P=o,O=s,D=u}if(A=e(this,g,i,P,O,D,v)){if(w){var Z=w[V];h.copy(Z[0]),f.copy(Z[1]),m.copy(Z[2]),A.uv=t(v,P,O,D,h,f,m)}A.face=z,A.faceIndex=V,y.push(A)}}}}}}}(),p.Mesh.prototype.clone=function(){return new this.constructor(this.geometry,this.material).copy(this)},p.SkinnedMesh=function(t,e,n){p.Mesh.call(this,t,e),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new p.Matrix4,this.bindMatrixInverse=new p.Matrix4;var r=[];if(this.geometry&&void 0!==this.geometry.bones){for(var i,a,o=0,s=this.geometry.bones.length;o<s;++o)a=this.geometry.bones[o],i=new p.Bone(this),r.push(i),i.name=a.name,i.position.fromArray(a.pos),i.quaternion.fromArray(a.rotq),void 0!==a.scl&&i.scale.fromArray(a.scl);for(var o=0,s=this.geometry.bones.length;o<s;++o)a=this.geometry.bones[o],-1!==a.parent&&null!==a.parent?r[a.parent].add(r[o]):this.add(r[o])}this.normalizeSkinWeights(),this.updateMatrixWorld(!0),this.bind(new p.Skeleton(r,void 0,n),this.matrixWorld)},p.SkinnedMesh.prototype=Object.create(p.Mesh.prototype),p.SkinnedMesh.prototype.constructor=p.SkinnedMesh,p.SkinnedMesh.prototype.bind=function(t,e){this.skeleton=t,void 0===e&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),e=this.matrixWorld),this.bindMatrix.copy(e),this.bindMatrixInverse.getInverse(e)},p.SkinnedMesh.prototype.pose=function(){this.skeleton.pose()},p.SkinnedMesh.prototype.normalizeSkinWeights=function(){if(this.geometry instanceof p.Geometry)for(var t=0;t<this.geometry.skinWeights.length;t++){var e=this.geometry.skinWeights[t],n=1/e.lengthManhattan();n!==1/0?e.multiplyScalar(n):e.set(1,0,0,0)}else if(this.geometry instanceof p.BufferGeometry)for(var r=new p.Vector4,i=this.geometry.attributes.skinWeight,t=0;t<i.count;t++){r.x=i.getX(t),r.y=i.getY(t),r.z=i.getZ(t),r.w=i.getW(t);var n=1/r.lengthManhattan();n!==1/0?r.multiplyScalar(n):r.set(1,0,0,0),i.setXYZW(t,r.x,r.y,r.z,r.w)}},p.SkinnedMesh.prototype.updateMatrixWorld=function(t){p.Mesh.prototype.updateMatrixWorld.call(this,!0),"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):"detached"===this.bindMode&&this.bindMatrixInverse.getInverse(this.bindMatrix)},p.SkinnedMesh.prototype.clone=function(){return new this.constructor(this.geometry,this.material,this.useVertexTexture).copy(this)},p.Points=function(t,e){p.Object3D.call(this),this.type="Points",this.geometry=void 0!==t?t:new p.Geometry,this.material=void 0!==e?e:new p.PointsMaterial({color:16777215*Math.random()})},p.Points.prototype=Object.create(p.Object3D.prototype),p.Points.prototype.constructor=p.Points,p.Points.prototype.raycast=function(){var t=new p.Matrix4,e=new p.Ray,n=new p.Sphere;return function(r,i){function a(t,n){var a=e.distanceSqToPoint(t);if(a<d){var s=e.closestPointToPoint(t);s.applyMatrix4(u);var l=r.ray.origin.distanceTo(s);if(l<r.near||l>r.far)return;i.push({distance:l,distanceToRay:Math.sqrt(a),point:s.clone(),index:n,face:null,object:o})}}var o=this,s=this.geometry,u=this.matrixWorld,l=r.params.Points.threshold;if(null===s.boundingSphere&&s.computeBoundingSphere(),n.copy(s.boundingSphere),n.applyMatrix4(u),!1!==r.ray.intersectsSphere(n)){t.getInverse(u),e.copy(r.ray).applyMatrix4(t);var c=l/((this.scale.x+this.scale.y+this.scale.z)/3),d=c*c,h=new p.Vector3;if(s instanceof p.BufferGeometry){var f=s.index,m=s.attributes,g=m.position.array;if(null!==f)for(var v=f.array,y=0,_=v.length;y<_;y++){var b=v[y];h.fromArray(g,3*b),a(h,b)}else for(var y=0,E=g.length/3;y<E;y++)h.fromArray(g,3*y),a(h,y)}else for(var w=s.vertices,y=0,E=w.length;y<E;y++)a(w[y],y)}}}(),p.Points.prototype.clone=function(){return new this.constructor(this.geometry,this.material).copy(this)},p.Light=function(t,e){p.Object3D.call(this),this.type="Light",this.color=new p.Color(t),this.intensity=void 0!==e?e:1,this.receiveShadow=void 0},p.Light.prototype=Object.create(p.Object3D.prototype),p.Light.prototype.constructor=p.Light,p.Light.prototype.copy=function(t){return p.Object3D.prototype.copy.call(this,t),this.color.copy(t.color),this.intensity=t.intensity,this},p.Light.prototype.toJSON=function(t){var e=p.Object3D.prototype.toJSON.call(this,t);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,void 0!==this.groundColor&&(e.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(e.object.distance=this.distance),void 0!==this.angle&&(e.object.angle=this.angle),void 0!==this.decay&&(e.object.decay=this.decay),void 0!==this.penumbra&&(e.object.penumbra=this.penumbra),e},p.ShaderChunk={},p.ShaderChunk["alphamap_fragment"]="#ifdef USE_ALPHAMAP\n\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n\n#endif\n",p.ShaderChunk["alphamap_pars_fragment"]="#ifdef USE_ALPHAMAP\n\n\tuniform sampler2D alphaMap;\n\n#endif\n",p.ShaderChunk["alphatest_fragment"]="#ifdef ALPHATEST\n\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n\n#endif\n",p.ShaderChunk["aomap_fragment"]="#ifdef USE_AOMAP\n\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\n\t#endif\n\n#endif\n",p.ShaderChunk["aomap_pars_fragment"]="#ifdef USE_AOMAP\n\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n\n#endif",p.ShaderChunk["begin_vertex"]="\nvec3 transformed = vec3( position );\n",p.ShaderChunk["beginnormal_vertex"]="\nvec3 objectNormal = vec3( normal );\n",p.ShaderChunk["color_fragment"]="#ifdef USE_COLOR\n\n\tdiffuseColor.rgb *= vColor;\n\n#endif",p.ShaderChunk["color_pars_fragment"]="#ifdef USE_COLOR\n\n\tvarying vec3 vColor;\n\n#endif\n",p.ShaderChunk["color_pars_vertex"]="#ifdef USE_COLOR\n\n\tvarying vec3 vColor;\n\n#endif",p.ShaderChunk["color_vertex"]="#ifdef USE_COLOR\n\n\tvColor.xyz = color.xyz;\n\n#endif",p.ShaderChunk["common"]="#define PI 3.14159\n#define PI2 6.28318\n#define RECIPROCAL_PI 0.31830988618\n#define RECIPROCAL_PI2 0.15915494\n#define LOG2 1.442695\n#define EPSILON 1e-6\n\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#define whiteCompliment(a) ( 1.0 - saturate( a ) )\n\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\n\n\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\n\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\n\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n};\n\n\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n}\n\n// http://en.wikibooks.org/wiki/GLSL_Programming/Applying_Matrix_Transformations\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n\n}\n\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\n\treturn - distance * planeNormal + point;\n\n}\n\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n\n}\n\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n\n}\n",p.ShaderChunk["defaultnormal_vertex"]="#ifdef FLIP_SIDED\n\n\tobjectNormal = -objectNormal;\n\n#endif\n\nvec3 transformedNormal = normalMatrix * objectNormal;\n",p.ShaderChunk["encodings_fragment"]="  gl_FragColor = linearToOutputTexel( gl_FragColor );\n",p.ShaderChunk["encodings_pars_fragment"]="// For a discussion of what this is, please read this: http://lousodrome.net/blog/light/2013/05/26/gamma-correct-and-hdr-rendering-in-a-32-bits-buffer/\n\nvec4 LinearToLinear( in vec4 value ) {\n  return value;\n}\n\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n  return vec4( pow( value.xyz, vec3( gammaFactor ) ), value.w );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n  return vec4( pow( value.xyz, vec3( 1.0 / gammaFactor ) ), value.w );\n}\n\nvec4 sRGBToLinear( in vec4 value ) {\n  return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n  return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.w );\n}\n\nvec4 RGBEToLinear( in vec4 value ) {\n  return vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n  float maxComponent = max( max( value.r, value.g ), value.b );\n  float fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n  return vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n//  return vec4( value.brg, ( 3.0 + 128.0 ) / 256.0 );\n}\n\n// reference: http://iwasbeingirony.blogspot.ca/2010/06/difference-between-rgbm-and-rgbd.html\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n  return vec4( value.xyz * value.w * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n  float maxRGB = max( value.x, max( value.g, value.b ) );\n  float M      = clamp( maxRGB / maxRange, 0.0, 1.0 );\n  M            = ceil( M * 255.0 ) / 255.0;\n  return vec4( value.rgb / ( M * maxRange ), M );\n}\n\n// reference: http://iwasbeingirony.blogspot.ca/2010/06/difference-between-rgbm-and-rgbd.html\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n    return vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n    float maxRGB = max( value.x, max( value.g, value.b ) );\n    float D      = max( maxRange / maxRGB, 1.0 );\n    D            = min( floor( D ) / 255.0, 1.0 );\n    return vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\n\n// LogLuv reference: http://graphicrants.blogspot.ca/2009/04/rgbm-color-encoding.html\n\n// M matrix, for encoding\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value )  {\n  vec3 Xp_Y_XYZp = value.rgb * cLogLuvM;\n  Xp_Y_XYZp = max(Xp_Y_XYZp, vec3(1e-6, 1e-6, 1e-6));\n  vec4 vResult;\n  vResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n  float Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n  vResult.w = fract(Le);\n  vResult.z = (Le - (floor(vResult.w*255.0))/255.0)/255.0;\n  return vResult;\n}\n\n// Inverse M matrix, for decoding\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n  float Le = value.z * 255.0 + value.w;\n  vec3 Xp_Y_XYZp;\n  Xp_Y_XYZp.y = exp2((Le - 127.0) / 2.0);\n  Xp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n  Xp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n  vec3 vRGB = Xp_Y_XYZp.rgb * cLogLuvInverseM;\n  return vec4( max(vRGB, 0.0), 1.0 );\n}\n",p.ShaderChunk["envmap_fragment"]="#ifdef USE_ENVMAP\n\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\n\t\tvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\n\n\t\t// Transforming Normal Vectors with the Inverse Transformation\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\n\t\t\tvec3 reflectVec = reflect( cameraToVertex, worldNormal );\n\n\t\t#else\n\n\t\t\tvec3 reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );\n\n\t\t#endif\n\n\t#else\n\n\t\tvec3 reflectVec = vReflect;\n\n\t#endif\n\n\t#ifdef DOUBLE_SIDED\n\t\tfloat flipNormal = ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#else\n\t\tfloat flipNormal = 1.0;\n\t#endif\n\n\t#ifdef ENVMAP_TYPE_CUBE\n\n\t\tvec4 envColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\n\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\n\t\tvec2 sampleUV;\n\t\tsampleUV.y = saturate( flipNormal * reflectVec.y * 0.5 + 0.5 );\n\t\tsampleUV.x = atan( flipNormal * reflectVec.z, flipNormal * reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\tvec4 envColor = texture2D( envMap, sampleUV );\n\n\t#elif defined( ENVMAP_TYPE_SPHERE )\n\n\t\tvec3 reflectView = flipNormal * normalize((viewMatrix * vec4( reflectVec, 0.0 )).xyz + vec3(0.0,0.0,1.0));\n\t\tvec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\n\n\t#endif\n\n\tenvColor = envMapTexelToLinear( envColor );\n\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\n\t#endif\n\n#endif\n",p.ShaderChunk["envmap_pars_fragment"]="#if defined( USE_ENVMAP ) || defined( STANDARD )\n\tuniform float reflectivity;\n\tuniform float envMapIntenstiy;\n#endif\n\n#ifdef USE_ENVMAP\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\tuniform float flipEnvMap;\n\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( STANDARD )\n\n\t\tuniform float refractionRatio;\n\n\t#else\n\n\t\tvarying vec3 vReflect;\n\n\t#endif\n\n#endif\n",p.ShaderChunk["envmap_pars_vertex"]="#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP ) && ! defined( PHONG ) && ! defined( STANDARD )\n\n\tvarying vec3 vReflect;\n\n\tuniform float refractionRatio;\n\n#endif\n",p.ShaderChunk["envmap_vertex"]="#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP ) && ! defined( PHONG ) && ! defined( STANDARD )\n\n\tvec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\n\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\n\t#ifdef ENVMAP_MODE_REFLECTION\n\n\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\n\t#else\n\n\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\n\t#endif\n\n#endif\n",p.ShaderChunk["fog_fragment"]="#ifdef USE_FOG\n\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\n\t\tfloat depth = gl_FragDepthEXT / gl_FragCoord.w;\n\n\t#else\n\n\t\tfloat depth = gl_FragCoord.z / gl_FragCoord.w;\n\n\t#endif\n\n\t#ifdef FOG_EXP2\n\n\t\tfloat fogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * depth * depth * LOG2 ) );\n\n\t#else\n\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, depth );\n\n\t#endif\n\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n\n#endif\n",p.ShaderChunk["fog_pars_fragment"]="#ifdef USE_FOG\n\n\tuniform vec3 fogColor;\n\n\t#ifdef FOG_EXP2\n\n\t\tuniform float fogDensity;\n\n\t#else\n\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n\n#endif",p.ShaderChunk["logdepthbuf_fragment"]="#if defined(USE_LOGDEPTHBUF) && defined(USE_LOGDEPTHBUF_EXT)\n\n\tgl_FragDepthEXT = log2(vFragDepth) * logDepthBufFC * 0.5;\n\n#endif",p.ShaderChunk["logdepthbuf_pars_fragment"]="#ifdef USE_LOGDEPTHBUF\n\n\tuniform float logDepthBufFC;\n\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\n\t\tvarying float vFragDepth;\n\n\t#endif\n\n#endif\n",p.ShaderChunk["logdepthbuf_pars_vertex"]="#ifdef USE_LOGDEPTHBUF\n\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\n\t\tvarying float vFragDepth;\n\n\t#endif\n\n\tuniform float logDepthBufFC;\n\n#endif",p.ShaderChunk["logdepthbuf_vertex"]="#ifdef USE_LOGDEPTHBUF\n\n\tgl_Position.z = log2(max( EPSILON, gl_Position.w + 1.0 )) * logDepthBufFC;\n\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\n\t#else\n\n\t\tgl_Position.z = (gl_Position.z - 1.0) * gl_Position.w;\n\n\t#endif\n\n#endif\n",p.ShaderChunk["map_fragment"]="#ifdef USE_MAP\n\n\tvec4 texelColor = texture2D( map, vUv );\n\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n\n#endif\n",p.ShaderChunk["map_pars_fragment"]="#ifdef USE_MAP\n\n\tuniform sampler2D map;\n\n#endif\n",p.ShaderChunk["morphnormal_vertex"]="#ifdef USE_MORPHNORMALS\n\n\tobjectNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\n\tobjectNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\n\tobjectNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\n\tobjectNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\n\n#endif\n",p.ShaderChunk["morphtarget_pars_vertex"]="#ifdef USE_MORPHTARGETS\n\n\t#ifndef USE_MORPHNORMALS\n\n\tuniform float morphTargetInfluences[ 8 ];\n\n\t#else\n\n\tuniform float morphTargetInfluences[ 4 ];\n\n\t#endif\n\n#endif",p.ShaderChunk["morphtarget_vertex"]="#ifdef USE_MORPHTARGETS\n\n\ttransformed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\n\ttransformed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\n\ttransformed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\n\ttransformed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n\n\t#ifndef USE_MORPHNORMALS\n\n\ttransformed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\n\ttransformed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\n\ttransformed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\n\ttransformed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n\n\t#endif\n\n#endif\n",p.ShaderChunk["premultiplied_alpha_fragment"]="#ifdef PREMULTIPLIED_ALPHA\n\n\t// Get get normal blending with premultipled, use with CustomBlending, OneFactor, OneMinusSrcAlphaFactor, AddEquation.\n\tgl_FragColor.rgb *= gl_FragColor.a;\n\n#endif\n",p.ShaderChunk["project_vertex"]="#ifdef USE_SKINNING\n\n\tvec4 mvPosition = modelViewMatrix * skinned;\n\n#else\n\n\tvec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );\n\n#endif\n\ngl_Position = projectionMatrix * mvPosition;\n",p.ShaderChunk["skinbase_vertex"]="#ifdef USE_SKINNING\n\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n\n#endif",p.ShaderChunk["skinning_pars_vertex"]="#ifdef USE_SKINNING\n\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\n\t#ifdef BONE_TEXTURE\n\n\t\tuniform sampler2D boneTexture;\n\t\tuniform int boneTextureWidth;\n\t\tuniform int boneTextureHeight;\n\n\t\tmat4 getBoneMatrix( const in float i ) {\n\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureWidth ) );\n\t\t\tfloat y = floor( j / float( boneTextureWidth ) );\n\n\t\t\tfloat dx = 1.0 / float( boneTextureWidth );\n\t\t\tfloat dy = 1.0 / float( boneTextureHeight );\n\n\t\t\ty = dy * ( y + 0.5 );\n\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\n\t\t\treturn bone;\n\n\t\t}\n\n\t#else\n\n\t\tuniform mat4 boneGlobalMatrices[ MAX_BONES ];\n\n\t\tmat4 getBoneMatrix( const in float i ) {\n\n\t\t\tmat4 bone = boneGlobalMatrices[ int(i) ];\n\t\t\treturn bone;\n\n\t\t}\n\n\t#endif\n\n#endif\n",p.ShaderChunk["skinning_vertex"]="#ifdef USE_SKINNING\n\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\tskinned  = bindMatrixInverse * skinned;\n\n#endif\n",p.ShaderChunk["skinnormal_vertex"]="#ifdef USE_SKINNING\n\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\n#endif\n",p.ShaderChunk["specularmap_fragment"]="float specularStrength;\n\n#ifdef USE_SPECULARMAP\n\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n\n#else\n\n\tspecularStrength = 1.0;\n\n#endif",p.ShaderChunk["specularmap_pars_fragment"]="#ifdef USE_SPECULARMAP\n\n\tuniform sampler2D specularMap;\n\n#endif",p.ShaderChunk["tonemapping_fragment"]="#if defined( TONE_MAPPING )\n\n  gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n\n#endif\n",p.ShaderChunk["tonemapping_pars_fragment"]="#define saturate(a) clamp( a, 0.0, 1.0 )\n\nuniform float toneMappingExposure;\nuniform float toneMappingWhitePoint;\n\n// exposure only\nvec3 LinearToneMapping( vec3 color ) {\n\n  return toneMappingExposure * color;\n\n}\n\n// source: https://www.cs.utah.edu/~reinhard/cdrom/\nvec3 ReinhardToneMapping( vec3 color ) {\n\n  color *= toneMappingExposure;\n  return saturate( color / ( vec3( 1.0 ) + color ) );\n\n}\n\n// source: http://filmicgames.com/archives/75\n#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )\nvec3 Uncharted2ToneMapping( vec3 color ) {\n\n  // John Hable's filmic operator from Uncharted 2 video game\n  color *= toneMappingExposure;\n  return saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( toneMappingWhitePoint ) ) );\n\n}\n\n// source: http://filmicgames.com/archives/75\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\n  // optimized filmic operator by Jim Hejl and Richard Burgess-Dawson\n  color *= toneMappingExposure;\n  color = max( vec3( 0.0 ), color - 0.004 );\n  return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n\n}\n",p.ShaderChunk["uv2_pars_fragment"]="#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\n\tvarying vec2 vUv2;\n\n#endif";p.ShaderChunk["uv2_pars_vertex"]="#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\n#endif",p.ShaderChunk["uv2_vertex"]="#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\n\tvUv2 = uv2;\n\n#endif",p.ShaderChunk["uv_pars_fragment"]="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\n\tvarying vec2 vUv;\n\n#endif",p.ShaderChunk["uv_pars_vertex"]="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\n\tvarying vec2 vUv;\n\tuniform vec4 offsetRepeat;\n\n#endif\n",p.ShaderChunk["uv_vertex"]="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\n\tvUv = uv * offsetRepeat.zw + offsetRepeat.xy;\n\n#endif",p.ShaderChunk["worldpos_vertex"]="#if defined( USE_ENVMAP ) || defined( PHONG ) || defined( STANDARD ) || defined( LAMBERT ) || defined ( USE_SHADOWMAP )\n\n\t#ifdef USE_SKINNING\n\n\t\tvec4 worldPosition = modelMatrix * skinned;\n\n\t#else\n\n\t\tvec4 worldPosition = modelMatrix * vec4( transformed, 1.0 );\n\n\t#endif\n\n#endif\n",p.ShaderChunk["meshbasic_frag"]="uniform vec3 diffuse;\nuniform float opacity;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n#endif\n\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n\nvoid main() {\n\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\n\tReflectedLight reflectedLight;\n\treflectedLight.directDiffuse = vec3( 0.0 );\n\treflectedLight.directSpecular = vec3( 0.0 );\n\treflectedLight.indirectDiffuse = diffuseColor.rgb;\n\treflectedLight.indirectSpecular = vec3( 0.0 );\n\n\t#include <aomap_fragment>\n\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\n\t#include <envmap_fragment>\n\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\n}\n",p.ShaderChunk["meshbasic_vert"]="#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\n\t#ifdef USE_ENVMAP\n\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\n\t#endif\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\n}\n",p.UniformsUtils={merge:function(t){for(var e={},n=0;n<t.length;n++){var r=this.clone(t[n]);for(var i in r)e[i]=r[i]}return e},clone:function(t){var e={};for(var n in t){e[n]={};for(var r in t[n]){var i=t[n][r];i instanceof p.Color||i instanceof p.Vector2||i instanceof p.Vector3||i instanceof p.Vector4||i instanceof p.Matrix3||i instanceof p.Matrix4||i instanceof p.Texture?e[n][r]=i.clone():Array.isArray(i)?e[n][r]=i.slice():e[n][r]=i}}return e}},p.UniformsLib={common:{diffuse:{type:"c",value:new p.Color(15658734)},opacity:{type:"f",value:1},map:{type:"t",value:null},offsetRepeat:{type:"v4",value:new p.Vector4(0,0,1,1)},specularMap:{type:"t",value:null},alphaMap:{type:"t",value:null},envMap:{type:"t",value:null},flipEnvMap:{type:"f",value:-1},reflectivity:{type:"f",value:1},refractionRatio:{type:"f",value:.98}},aomap:{aoMap:{type:"t",value:null},aoMapIntensity:{type:"f",value:1}},lightmap:{lightMap:{type:"t",value:null},lightMapIntensity:{type:"f",value:1}},emissivemap:{emissiveMap:{type:"t",value:null}},bumpmap:{bumpMap:{type:"t",value:null},bumpScale:{type:"f",value:1}},normalmap:{normalMap:{type:"t",value:null},normalScale:{type:"v2",value:new p.Vector2(1,1)}},displacementmap:{displacementMap:{type:"t",value:null},displacementScale:{type:"f",value:1},displacementBias:{type:"f",value:0}},roughnessmap:{roughnessMap:{type:"t",value:null}},metalnessmap:{metalnessMap:{type:"t",value:null}},fog:{fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new p.Color(16777215)}},lights:{ambientLightColor:{type:"fv",value:[]},directionalLights:{type:"sa",value:[],properties:{direction:{type:"v3"},color:{type:"c"},shadow:{type:"i"},shadowBias:{type:"f"},shadowRadius:{type:"f"},shadowMapSize:{type:"v2"}}},directionalShadowMap:{type:"tv",value:[]},directionalShadowMatrix:{type:"m4v",value:[]},spotLights:{type:"sa",value:[],properties:{color:{type:"c"},position:{type:"v3"},direction:{type:"v3"},distance:{type:"f"},coneCos:{type:"f"},penumbraCos:{type:"f"},decay:{type:"f"},shadow:{type:"i"},shadowBias:{type:"f"},shadowRadius:{type:"f"},shadowMapSize:{type:"v2"}}},spotShadowMap:{type:"tv",value:[]},spotShadowMatrix:{type:"m4v",value:[]},pointLights:{type:"sa",value:[],properties:{color:{type:"c"},position:{type:"v3"},decay:{type:"f"},distance:{type:"f"},shadow:{type:"i"},shadowBias:{type:"f"},shadowRadius:{type:"f"},shadowMapSize:{type:"v2"}}},pointShadowMap:{type:"tv",value:[]},pointShadowMatrix:{type:"m4v",value:[]},hemisphereLights:{type:"sa",value:[],properties:{direction:{type:"v3"},skyColor:{type:"c"},groundColor:{type:"c"}}}},points:{diffuse:{type:"c",value:new p.Color(15658734)},opacity:{type:"f",value:1},size:{type:"f",value:1},scale:{type:"f",value:1},map:{type:"t",value:null},offsetRepeat:{type:"v4",value:new p.Vector4(0,0,1,1)}}},p.ShaderLib={basic:{uniforms:p.UniformsUtils.merge([p.UniformsLib["common"],p.UniformsLib["aomap"],p.UniformsLib["fog"]]),vertexShader:p.ShaderChunk["meshbasic_vert"],fragmentShader:p.ShaderChunk["meshbasic_frag"]},lambert:{uniforms:p.UniformsUtils.merge([p.UniformsLib["common"],p.UniformsLib["aomap"],p.UniformsLib["lightmap"],p.UniformsLib["emissivemap"],p.UniformsLib["fog"],p.UniformsLib["lights"],{emissive:{type:"c",value:new p.Color(0)}}]),vertexShader:p.ShaderChunk["meshlambert_vert"],fragmentShader:p.ShaderChunk["meshlambert_frag"]},phong:{uniforms:p.UniformsUtils.merge([p.UniformsLib["common"],p.UniformsLib["aomap"],p.UniformsLib["lightmap"],p.UniformsLib["emissivemap"],p.UniformsLib["bumpmap"],p.UniformsLib["normalmap"],p.UniformsLib["displacementmap"],p.UniformsLib["fog"],p.UniformsLib["lights"],{emissive:{type:"c",value:new p.Color(0)},specular:{type:"c",value:new p.Color(1118481)},shininess:{type:"f",value:30}}]),vertexShader:p.ShaderChunk["meshphong_vert"],fragmentShader:p.ShaderChunk["meshphong_frag"]},standard:{uniforms:p.UniformsUtils.merge([p.UniformsLib["common"],p.UniformsLib["aomap"],p.UniformsLib["lightmap"],p.UniformsLib["emissivemap"],p.UniformsLib["bumpmap"],p.UniformsLib["normalmap"],p.UniformsLib["displacementmap"],p.UniformsLib["roughnessmap"],p.UniformsLib["metalnessmap"],p.UniformsLib["fog"],p.UniformsLib["lights"],{emissive:{type:"c",value:new p.Color(0)},roughness:{type:"f",value:.5},metalness:{type:"f",value:0},envMapIntensity:{type:"f",value:1}}]),vertexShader:p.ShaderChunk["meshstandard_vert"],fragmentShader:p.ShaderChunk["meshstandard_frag"]},points:{uniforms:p.UniformsUtils.merge([p.UniformsLib["points"],p.UniformsLib["fog"]]),vertexShader:p.ShaderChunk["points_vert"],fragmentShader:p.ShaderChunk["points_frag"]},dashed:{uniforms:p.UniformsUtils.merge([p.UniformsLib["common"],p.UniformsLib["fog"],{scale:{type:"f",value:1},dashSize:{type:"f",value:1},totalSize:{type:"f",value:2}}]),vertexShader:p.ShaderChunk["linedashed_vert"],fragmentShader:p.ShaderChunk["linedashed_frag"]},depth:{uniforms:{mNear:{type:"f",value:1},mFar:{type:"f",value:2e3},opacity:{type:"f",value:1}},vertexShader:p.ShaderChunk["depth_vert"],fragmentShader:p.ShaderChunk["depth_frag"]},normal:{uniforms:{opacity:{type:"f",value:1}},vertexShader:p.ShaderChunk["normal_vert"],fragmentShader:p.ShaderChunk["normal_frag"]},cube:{uniforms:{tCube:{type:"t",value:null},tFlip:{type:"f",value:-1}},vertexShader:p.ShaderChunk["cube_vert"],fragmentShader:p.ShaderChunk["cube_frag"]},equirect:{uniforms:{tEquirect:{type:"t",value:null},tFlip:{type:"f",value:-1}},vertexShader:p.ShaderChunk["equirect_vert"],fragmentShader:p.ShaderChunk["equirect_frag"]},depthRGBA:{uniforms:{},vertexShader:p.ShaderChunk["depthRGBA_vert"],fragmentShader:p.ShaderChunk["depthRGBA_frag"]},distanceRGBA:{uniforms:{lightPos:{type:"v3",value:new p.Vector3(0,0,0)}},vertexShader:p.ShaderChunk["distanceRGBA_vert"],fragmentShader:p.ShaderChunk["distanceRGBA_frag"]}},p.WebGLRenderer=function(t){function e(){return null===_t?It:1}function n(t,e,n,r){!0===st&&(t*=r,e*=r,n*=r),Yt.clearColor(t,e,n,r)}function r(){Yt.init(),Yt.scissor(St.copy(Pt).multiplyScalar(It)),Yt.viewport(xt.copy(Dt).multiplyScalar(It)),n(Ct.r,Ct.g,Ct.b,Mt)}function i(){yt=null,At=null,wt="",Et=-1,Yt.reset()}function a(t){t.preventDefault(),i(),r(),Wt.clear()}function o(t){var e=t.target;e.removeEventListener("dispose",o),l(e),jt.textures--}function s(t){var e=t.target;e.removeEventListener("dispose",s),c(e),jt.textures--}function u(t){var e=t.target;e.removeEventListener("dispose",u),d(e)}function l(t){var e=Wt.get(t);if(t.image&&e.__image__webglTextureCube)Gt.deleteTexture(e.__image__webglTextureCube);else{if(void 0===e.__webglInit)return;Gt.deleteTexture(e.__webglTexture)}Wt.delete(t)}function c(t){var e=Wt.get(t),n=Wt.get(t.texture);if(t&&void 0!==n.__webglTexture){if(Gt.deleteTexture(n.__webglTexture),t instanceof p.WebGLRenderTargetCube)for(var r=0;r<6;r++)Gt.deleteFramebuffer(e.__webglFramebuffer[r]),Gt.deleteRenderbuffer(e.__webglDepthbuffer[r]);else Gt.deleteFramebuffer(e.__webglFramebuffer),Gt.deleteRenderbuffer(e.__webglDepthbuffer);Wt.delete(t.texture),Wt.delete(t)}}function d(t){h(t),Wt.delete(t)}function h(t){var e=Wt.get(t).program;t.program=void 0,void 0!==e&&Xt.releaseProgram(e)}function f(t,e,n,r){var i;if(!(n instanceof p.InstancedBufferGeometry&&null===(i=Ht.get("ANGLE_instanced_arrays")))){void 0===r&&(r=0),Yt.initAttributes();var a=n.attributes,o=e.getAttributes(),s=t.defaultAttributeValues;for(var u in o){var l=o[u];if(l>=0){var c=a[u];if(void 0!==c){var d=c.itemSize,h=qt.getAttributeBuffer(c);if(c instanceof p.InterleavedBufferAttribute){var f=c.data,m=f.stride,g=c.offset;f instanceof p.InstancedInterleavedBuffer?(Yt.enableAttributeAndDivisor(l,f.meshPerAttribute,i),void 0===n.maxInstancedCount&&(n.maxInstancedCount=f.meshPerAttribute*f.count)):Yt.enableAttribute(l),Gt.bindBuffer(Gt.ARRAY_BUFFER,h),Gt.vertexAttribPointer(l,d,Gt.FLOAT,!1,m*f.array.BYTES_PER_ELEMENT,(r*m+g)*f.array.BYTES_PER_ELEMENT)}else c instanceof p.InstancedBufferAttribute?(Yt.enableAttributeAndDivisor(l,c.meshPerAttribute,i),void 0===n.maxInstancedCount&&(n.maxInstancedCount=c.meshPerAttribute*c.count)):Yt.enableAttribute(l),Gt.bindBuffer(Gt.ARRAY_BUFFER,h),Gt.vertexAttribPointer(l,d,Gt.FLOAT,!1,0,r*d*4)}else if(void 0!==s){var v=s[u];if(void 0!==v)switch(v.length){case 2:Gt.vertexAttrib2fv(l,v);break;case 3:Gt.vertexAttrib3fv(l,v);break;case 4:Gt.vertexAttrib4fv(l,v);break;default:Gt.vertexAttrib1fv(l,v)}}}}Yt.disableUnusedAttributes()}}function m(t,e){return Math.abs(e[0])-Math.abs(t[0])}function g(t,e){return t.object.renderOrder!==e.object.renderOrder?t.object.renderOrder-e.object.renderOrder:t.material.id!==e.material.id?t.material.id-e.material.id:t.z!==e.z?t.z-e.z:t.id-e.id}function v(t,e){return t.object.renderOrder!==e.object.renderOrder?t.object.renderOrder-e.object.renderOrder:t.z!==e.z?e.z-t.z:t.id-e.id}function y(t,e,n,r,i){var a,o;n.transparent?(a=ht,o=++ft):(a=ct,o=++dt);var s=a[o];void 0!==s?(s.id=t.id,s.object=t,s.geometry=e,s.material=n,s.z=Ft.z,s.group=i):(s={id:t.id,object:t,geometry:e,material:n,z:Ft.z,group:i},a.push(s))}function _(t,e){if(!1!==t.visible){if(t.layers.test(e.layers))if(t instanceof p.Light)lt.push(t);else if(t instanceof p.Sprite)!1!==t.frustumCulled&&!0!==Nt.intersectsObject(t)||mt.push(t);else if(t instanceof p.LensFlare)gt.push(t);else if(t instanceof p.ImmediateRenderObject)!0===vt.sortObjects&&(Ft.setFromMatrixPosition(t.matrixWorld),Ft.applyProjection(Ut)),y(t,null,t.material,Ft.z,null);else if((t instanceof p.Mesh||t instanceof p.Line||t instanceof p.Points)&&(t instanceof p.SkinnedMesh&&t.skeleton.update(),!1===t.frustumCulled||!0===Nt.intersectsObject(t))){var n=t.material;if(!0===n.visible){!0===vt.sortObjects&&(Ft.setFromMatrixPosition(t.matrixWorld),Ft.applyProjection(Ut));var r=qt.update(t);if(n instanceof p.MultiMaterial)for(var i=r.groups,a=n.materials,o=0,s=i.length;o<s;o++){var u=i[o],l=a[u.materialIndex];!0===l.visible&&y(t,r,l,Ft.z,u)}else y(t,r,n,Ft.z,null)}}for(var c=t.children,o=0,s=c.length;o<s;o++)_(c[o],e)}}function b(t,e,n,r){for(var i=0,a=t.length;i<a;i++){var o=t[i],s=o.object,u=o.geometry,l=void 0===r?o.material:r,c=o.group;if(s.modelViewMatrix.multiplyMatrices(e.matrixWorldInverse,s.matrixWorld),s.normalMatrix.getNormalMatrix(s.modelViewMatrix),s instanceof p.ImmediateRenderObject){w(l);var d=S(e,n,l,s);wt="",s.render(function(t){vt.renderBufferImmediate(t,d,l)})}else vt.renderBufferDirect(e,n,u,l,s,c)}}function E(t,e,n){var r=Wt.get(t),i=Xt.getParameters(t,Bt,e,n),a=Xt.getProgramCode(t,i),o=r.program,s=!0;if(void 0===o)t.addEventListener("dispose",u);else if(o.code!==a)h(t);else{if(void 0!==i.shaderID)return;s=!1}if(s){if(i.shaderID){var l=p.ShaderLib[i.shaderID];r.__webglShader={name:t.type,uniforms:p.UniformsUtils.clone(l.uniforms),vertexShader:l.vertexShader,fragmentShader:l.fragmentShader}}else r.__webglShader={name:t.type,uniforms:t.uniforms,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader};t.__webglShader=r.__webglShader,o=Xt.acquireProgram(t,i,a),r.program=o,t.program=o}var c=o.getAttributes();if(t.morphTargets){t.numSupportedMorphTargets=0;for(var d=0;d<vt.maxMorphTargets;d++)c["morphTarget"+d]>=0&&t.numSupportedMorphTargets++}if(t.morphNormals){t.numSupportedMorphNormals=0;for(var d=0;d<vt.maxMorphNormals;d++)c["morphNormal"+d]>=0&&t.numSupportedMorphNormals++}r.uniformsList=[];var f=r.__webglShader.uniforms,m=r.program.getUniforms();for(var g in f){var v=m[g];v&&r.uniformsList.push([r.__webglShader.uniforms[g],v])}(t instanceof p.MeshPhongMaterial||t instanceof p.MeshLambertMaterial||t instanceof p.MeshStandardMaterial||t.lights)&&(r.lightsHash=Bt.hash,f.ambientLightColor.value=Bt.ambient,f.directionalLights.value=Bt.directional,f.spotLights.value=Bt.spot,f.pointLights.value=Bt.point,f.hemisphereLights.value=Bt.hemi,f.directionalShadowMap.value=Bt.directionalShadowMap,f.directionalShadowMatrix.value=Bt.directionalShadowMatrix,f.spotShadowMap.value=Bt.spotShadowMap,f.spotShadowMatrix.value=Bt.spotShadowMatrix,f.pointShadowMap.value=Bt.pointShadowMap,f.pointShadowMatrix.value=Bt.pointShadowMatrix),r.hasDynamicUniforms=!1;for(var y=0,_=r.uniformsList.length;y<_;y++){if(!0===r.uniformsList[y][0].dynamic){r.hasDynamicUniforms=!0;break}}}function w(t){A(t),!0===t.transparent?Yt.setBlending(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.premultipliedAlpha):Yt.setBlending(p.NoBlending),Yt.setDepthFunc(t.depthFunc),Yt.setDepthTest(t.depthTest),Yt.setDepthWrite(t.depthWrite),Yt.setColorWrite(t.colorWrite),Yt.setPolygonOffset(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits)}function A(t){t.side!==p.DoubleSide?Yt.enable(Gt.CULL_FACE):Yt.disable(Gt.CULL_FACE),Yt.setFlipSided(t.side===p.BackSide)}function S(t,e,n,r){kt=0;var i=Wt.get(n);void 0===i.program&&(n.needsUpdate=!0),void 0!==i.lightsHash&&i.lightsHash!==Bt.hash&&(n.needsUpdate=!0),n.needsUpdate&&(E(n,e,r),n.needsUpdate=!1);var a=!1,o=!1,s=!1,u=i.program,l=u.getUniforms(),c=i.__webglShader.uniforms;if(u.id!==yt&&(Gt.useProgram(u.program),yt=u.id,a=!0,o=!0,s=!0),n.id!==Et&&(Et=n.id,o=!0),(a||t!==At)&&(Gt.uniformMatrix4fv(l.projectionMatrix,!1,t.projectionMatrix.elements),Kt.logarithmicDepthBuffer&&Gt.uniform1f(l.logDepthBufFC,2/(Math.log(t.far+1)/Math.LN2)),t!==At&&(At=t,o=!0,s=!0),(n instanceof p.ShaderMaterial||n instanceof p.MeshPhongMaterial||n instanceof p.MeshStandardMaterial||n.envMap)&&void 0!==l.cameraPosition&&(Ft.setFromMatrixPosition(t.matrixWorld),Gt.uniform3f(l.cameraPosition,Ft.x,Ft.y,Ft.z)),(n instanceof p.MeshPhongMaterial||n instanceof p.MeshLambertMaterial||n instanceof p.MeshBasicMaterial||n instanceof p.MeshStandardMaterial||n instanceof p.ShaderMaterial||n.skinning)&&void 0!==l.viewMatrix&&Gt.uniformMatrix4fv(l.viewMatrix,!1,t.matrixWorldInverse.elements),void 0!==l.toneMappingExposure&&Gt.uniform1f(l.toneMappingExposure,vt.toneMappingExposure),void 0!==l.toneMappingWhitePoint&&Gt.uniform1f(l.toneMappingWhitePoint,vt.toneMappingWhitePoint)),n.skinning)if(r.bindMatrix&&void 0!==l.bindMatrix&&Gt.uniformMatrix4fv(l.bindMatrix,!1,r.bindMatrix.elements),r.bindMatrixInverse&&void 0!==l.bindMatrixInverse&&Gt.uniformMatrix4fv(l.bindMatrixInverse,!1,r.bindMatrixInverse.elements),Kt.floatVertexTextures&&r.skeleton&&r.skeleton.useVertexTexture){if(void 0!==l.boneTexture){var d=N();Gt.uniform1i(l.boneTexture,d),vt.setTexture(r.skeleton.boneTexture,d)}void 0!==l.boneTextureWidth&&Gt.uniform1i(l.boneTextureWidth,r.skeleton.boneTextureWidth),void 0!==l.boneTextureHeight&&Gt.uniform1i(l.boneTextureHeight,r.skeleton.boneTextureHeight)}else r.skeleton&&r.skeleton.boneMatrices&&void 0!==l.boneGlobalMatrices&&Gt.uniformMatrix4fv(l.boneGlobalMatrices,!1,r.skeleton.boneMatrices);return o&&((n instanceof p.MeshPhongMaterial||n instanceof p.MeshLambertMaterial||n instanceof p.MeshStandardMaterial||n.lights)&&O(c,s),e&&n.fog&&R(c,e),(n instanceof p.MeshBasicMaterial||n instanceof p.MeshLambertMaterial||n instanceof p.MeshPhongMaterial||n instanceof p.MeshStandardMaterial)&&x(c,n),n instanceof p.LineBasicMaterial?k(c,n):n instanceof p.LineDashedMaterial?(k(c,n),C(c,n)):n instanceof p.PointsMaterial?M(c,n):n instanceof p.MeshLambertMaterial?L(c,n):n instanceof p.MeshPhongMaterial?I(c,n):n instanceof p.MeshStandardMaterial?P(c,n):n instanceof p.MeshDepthMaterial?(c.mNear.value=t.near,c.mFar.value=t.far,c.opacity.value=n.opacity):n instanceof p.MeshNormalMaterial&&(c.opacity.value=n.opacity),F(i.uniformsList)),D(l,r),void 0!==l.modelMatrix&&Gt.uniformMatrix4fv(l.modelMatrix,!1,r.matrixWorld.elements),!0===i.hasDynamicUniforms&&T(i.uniformsList,r,t),u}function T(t,e,n){for(var r=[],i=0,a=t.length;i<a;i++){var o=t[i][0],s=o.onUpdateCallback;void 0!==s&&(s.bind(o)(e,n),r.push(t[i]))}F(r)}function x(t,e){t.opacity.value=e.opacity,t.diffuse.value=e.color,e.emissive&&t.emissive.value.copy(e.emissive).multiplyScalar(e.emissiveIntensity),t.map.value=e.map,t.specularMap.value=e.specularMap,t.alphaMap.value=e.alphaMap,e.aoMap&&(t.aoMap.value=e.aoMap,t.aoMapIntensity.value=e.aoMapIntensity);var n;if(e.map?n=e.map:e.specularMap?n=e.specularMap:e.displacementMap?n=e.displacementMap:e.normalMap?n=e.normalMap:e.bumpMap?n=e.bumpMap:e.roughnessMap?n=e.roughnessMap:e.metalnessMap?n=e.metalnessMap:e.alphaMap?n=e.alphaMap:e.emissiveMap&&(n=e.emissiveMap),void 0!==n){n instanceof p.WebGLRenderTarget&&(n=n.texture);var r=n.offset,i=n.repeat;t.offsetRepeat.value.set(r.x,r.y,i.x,i.y)}t.envMap.value=e.envMap,t.flipEnvMap.value=e.envMap instanceof p.WebGLRenderTargetCube?1:-1,t.reflectivity.value=e.reflectivity,t.refractionRatio.value=e.refractionRatio}function k(t,e){t.diffuse.value=e.color,t.opacity.value=e.opacity}function C(t,e){t.dashSize.value=e.dashSize,t.totalSize.value=e.dashSize+e.gapSize,t.scale.value=e.scale}function M(t,e){if(t.diffuse.value=e.color,t.opacity.value=e.opacity,t.size.value=e.size*It,t.scale.value=et.clientHeight/2,t.map.value=e.map,null!==e.map){var n=e.map.offset,r=e.map.repeat;t.offsetRepeat.value.set(n.x,n.y,r.x,r.y)}}function R(t,e){t.fogColor.value=e.color,e instanceof p.Fog?(t.fogNear.value=e.near,t.fogFar.value=e.far):e instanceof p.FogExp2&&(t.fogDensity.value=e.density)}function L(t,e){e.lightMap&&(t.lightMap.value=e.lightMap,t.lightMapIntensity.value=e.lightMapIntensity),e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap)}function I(t,e){t.specular.value=e.specular,t.shininess.value=Math.max(e.shininess,1e-4),e.lightMap&&(t.lightMap.value=e.lightMap,t.lightMapIntensity.value=e.lightMapIntensity),e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap),e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale),e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale)),e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}function P(t,e){t.roughness.value=e.roughness,t.metalness.value=e.metalness,e.roughnessMap&&(t.roughnessMap.value=e.roughnessMap),e.metalnessMap&&(t.metalnessMap.value=e.metalnessMap),e.lightMap&&(t.lightMap.value=e.lightMap,t.lightMapIntensity.value=e.lightMapIntensity),e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap),e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale),e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale)),e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias),e.envMap&&(t.envMapIntensity.value=e.envMapIntensity)}function O(t,e){t.ambientLightColor.needsUpdate=e,t.directionalLights.needsUpdate=e,t.pointLights.needsUpdate=e,t.spotLights.needsUpdate=e,t.hemisphereLights.needsUpdate=e}function D(t,e){Gt.uniformMatrix4fv(t.modelViewMatrix,!1,e.modelViewMatrix.elements),t.normalMatrix&&Gt.uniformMatrix3fv(t.normalMatrix,!1,e.normalMatrix.elements)}function N(){var t=kt;return kt+=1,t}function U(t,e,n,r){var i,a;if("1i"===e)Gt.uniform1i(n,r);else if("1f"===e)Gt.uniform1f(n,r);else if("2f"===e)Gt.uniform2f(n,r[0],r[1]);else if("3f"===e)Gt.uniform3f(n,r[0],r[1],r[2]);else if("4f"===e)Gt.uniform4f(n,r[0],r[1],r[2],r[3]);else if("1iv"===e)Gt.uniform1iv(n,r);else if("3iv"===e)Gt.uniform3iv(n,r);else if("1fv"===e)Gt.uniform1fv(n,r);else if("2fv"===e)Gt.uniform2fv(n,r);else if("3fv"===e)Gt.uniform3fv(n,r);else if("4fv"===e)Gt.uniform4fv(n,r);else if("Matrix2fv"===e)Gt.uniformMatrix2fv(n,!1,r);else if("Matrix3fv"===e)Gt.uniformMatrix3fv(n,!1,r);else if("Matrix4fv"===e)Gt.uniformMatrix4fv(n,!1,r);else if("i"===e)Gt.uniform1i(n,r);else if("f"===e)Gt.uniform1f(n,r);else if("v2"===e)Gt.uniform2f(n,r.x,r.y);else if("v3"===e)Gt.uniform3f(n,r.x,r.y,r.z);else if("v4"===e)Gt.uniform4f(n,r.x,r.y,r.z,r.w);else if("c"===e)Gt.uniform3f(n,r.r,r.g,r.b);else if("s"===e){var o=t.properties;for(var s in o){var u=o[s],l=n[s],c=r[s];U(u,u.type,l,c)}}else if("sa"===e)for(var o=t.properties,d=0,h=r.length;d<h;d++)for(var s in o){var u=o[s],l=n[d][s],c=r[d][s];U(u,u.type,l,c)}else if("iv1"===e)Gt.uniform1iv(n,r);else if("iv"===e)Gt.uniform3iv(n,r);else if("fv1"===e)Gt.uniform1fv(n,r);else if("fv"===e)Gt.uniform3fv(n,r);else if("v2v"===e){void 0===t._array&&(t._array=new Float32Array(2*r.length));for(var d=0,f=0,m=r.length;d<m;d++,f+=2)t._array[f+0]=r[d].x,t._array[f+1]=r[d].y;Gt.uniform2fv(n,t._array)}else if("v3v"===e){void 0===t._array&&(t._array=new Float32Array(3*r.length));for(var d=0,g=0,m=r.length;d<m;d++,g+=3)t._array[g+0]=r[d].x,t._array[g+1]=r[d].y,t._array[g+2]=r[d].z;Gt.uniform3fv(n,t._array)}else if("v4v"===e){void 0===t._array&&(t._array=new Float32Array(4*r.length));for(var d=0,v=0,m=r.length;d<m;d++,v+=4)t._array[v+0]=r[d].x,t._array[v+1]=r[d].y,t._array[v+2]=r[d].z,t._array[v+3]=r[d].w;Gt.uniform4fv(n,t._array)}else if("m2"===e)Gt.uniformMatrix2fv(n,!1,r.elements);else if("m3"===e)Gt.uniformMatrix3fv(n,!1,r.elements);else if("m3v"===e){void 0===t._array&&(t._array=new Float32Array(9*r.length));for(var d=0,m=r.length;d<m;d++)r[d].flattenToArrayOffset(t._array,9*d);Gt.uniformMatrix3fv(n,!1,t._array)}else if("m4"===e)Gt.uniformMatrix4fv(n,!1,r.elements);else if("m4v"===e){void 0===t._array&&(t._array=new Float32Array(16*r.length));for(var d=0,m=r.length;d<m;d++)r[d].flattenToArrayOffset(t._array,16*d);Gt.uniformMatrix4fv(n,!1,t._array)}else if("t"===e){if(i=r,a=N(),Gt.uniform1i(n,a),!i)return;i instanceof p.CubeTexture||Array.isArray(i.image)&&6===i.image.length?Y(i,a):i instanceof p.WebGLRenderTargetCube?W(i.texture,a):i instanceof p.WebGLRenderTarget?vt.setTexture(i.texture,a):vt.setTexture(i,a)}else if("tv"===e){void 0===t._array&&(t._array=[]);for(var d=0,m=t.value.length;d<m;d++)t._array[d]=N();Gt.uniform1iv(n,t._array);for(var d=0,m=t.value.length;d<m;d++)i=t.value[d],a=t._array[d],i&&(i instanceof p.CubeTexture||i.image instanceof Array&&6===i.image.length?Y(i,a):i instanceof p.WebGLRenderTarget?vt.setTexture(i.texture,a):i instanceof p.WebGLRenderTargetCube?W(i.texture,a):vt.setTexture(i,a))}}function F(t){for(var e=0,n=t.length;e<n;e++){var r=t[e][0];if(!1!==r.needsUpdate){U(r,r.type,t[e][1],r.value)}}}function B(t,e){var n,r,i,a,o,s,u=0,l=0,c=0,d=e.matrixWorldInverse,h=0,f=0,m=0,g=0,v=0;for(Bt.shadowsPointLight=0,n=0,r=t.length;n<r;n++)if(i=t[n],a=i.color,o=i.intensity,s=i.distance,i instanceof p.AmbientLight)u+=a.r*o,l+=a.g*o,c+=a.b*o;else if(i instanceof p.DirectionalLight){var y=$t.get(i);y.color.copy(i.color).multiplyScalar(i.intensity),y.direction.setFromMatrixPosition(i.matrixWorld),Ft.setFromMatrixPosition(i.target.matrixWorld),y.direction.sub(Ft),y.direction.transformDirection(d),y.shadow=i.castShadow,i.castShadow&&(y.shadowBias=i.shadow.bias,y.shadowRadius=i.shadow.radius,y.shadowMapSize=i.shadow.mapSize,Bt.shadows[v++]=i),Bt.directionalShadowMap[h]=i.shadow.map,Bt.directionalShadowMatrix[h]=i.shadow.matrix,Bt.directional[h++]=y}else if(i instanceof p.SpotLight){var y=$t.get(i);y.position.setFromMatrixPosition(i.matrixWorld),y.position.applyMatrix4(d),y.color.copy(a).multiplyScalar(o),y.distance=s,y.direction.setFromMatrixPosition(i.matrixWorld),Ft.setFromMatrixPosition(i.target.matrixWorld),y.direction.sub(Ft),y.direction.transformDirection(d),y.coneCos=Math.cos(i.angle),y.penumbraCos=Math.cos(i.angle*(1-i.penumbra)),y.decay=0===i.distance?0:i.decay,y.shadow=i.castShadow,i.castShadow&&(y.shadowBias=i.shadow.bias,y.shadowRadius=i.shadow.radius,y.shadowMapSize=i.shadow.mapSize,Bt.shadows[v++]=i),Bt.spotShadowMap[m]=i.shadow.map,Bt.spotShadowMatrix[m]=i.shadow.matrix,Bt.spot[m++]=y}else if(i instanceof p.PointLight){var y=$t.get(i);y.position.setFromMatrixPosition(i.matrixWorld),y.position.applyMatrix4(d),y.color.copy(i.color).multiplyScalar(i.intensity),y.distance=i.distance,y.decay=0===i.distance?0:i.decay,y.shadow=i.castShadow,i.castShadow&&(y.shadowBias=i.shadow.bias,y.shadowRadius=i.shadow.radius,y.shadowMapSize=i.shadow.mapSize,Bt.shadows[v++]=i),Bt.pointShadowMap[f]=i.shadow.map,void 0===Bt.pointShadowMatrix[f]&&(Bt.pointShadowMatrix[f]=new p.Matrix4),Ft.setFromMatrixPosition(i.matrixWorld).negate(),Bt.pointShadowMatrix[f].identity().setPosition(Ft),Bt.point[f++]=y}else if(i instanceof p.HemisphereLight){var y=$t.get(i);y.direction.setFromMatrixPosition(i.matrixWorld),y.direction.transformDirection(d),y.direction.normalize(),y.skyColor.copy(i.color).multiplyScalar(o),y.groundColor.copy(i.groundColor).multiplyScalar(o),Bt.hemi[g++]=y}Bt.ambient[0]=u,Bt.ambient[1]=l,Bt.ambient[2]=c,Bt.directional.length=h,Bt.spot.length=m,Bt.point.length=f,Bt.hemi.length=g,Bt.shadows.length=v,Bt.hash=h+","+f+","+m+","+g+","+v}function j(t,e,n){var r;if(n?(Gt.texParameteri(t,Gt.TEXTURE_WRAP_S,tt(e.wrapS)),Gt.texParameteri(t,Gt.TEXTURE_WRAP_T,tt(e.wrapT)),Gt.texParameteri(t,Gt.TEXTURE_MAG_FILTER,tt(e.magFilter)),Gt.texParameteri(t,Gt.TEXTURE_MIN_FILTER,tt(e.minFilter))):(Gt.texParameteri(t,Gt.TEXTURE_WRAP_S,Gt.CLAMP_TO_EDGE),Gt.texParameteri(t,Gt.TEXTURE_WRAP_T,Gt.CLAMP_TO_EDGE),e.wrapS!==p.ClampToEdgeWrapping||(e.wrapT,p.ClampToEdgeWrapping),Gt.texParameteri(t,Gt.TEXTURE_MAG_FILTER,J(e.magFilter)),Gt.texParameteri(t,Gt.TEXTURE_MIN_FILTER,J(e.minFilter)),e.minFilter!==p.NearestFilter&&(e.minFilter,p.LinearFilter)),r=Ht.get("EXT_texture_filter_anisotropic")){if(e.type===p.FloatType&&null===Ht.get("OES_texture_float_linear"))return;if(e.type===p.HalfFloatType&&null===Ht.get("OES_texture_half_float_linear"))return;(e.anisotropy>1||Wt.get(e).__currentAnisotropy)&&(Gt.texParameterf(t,r.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(e.anisotropy,vt.getMaxAnisotropy())),Wt.get(e).__currentAnisotropy=e.anisotropy)}}function V(t,e,n){void 0===t.__webglInit&&(t.__webglInit=!0,e.addEventListener("dispose",o),t.__webglTexture=Gt.createTexture(),jt.textures++),Yt.activeTexture(Gt.TEXTURE0+n),Yt.bindTexture(Gt.TEXTURE_2D,t.__webglTexture),Gt.pixelStorei(Gt.UNPACK_FLIP_Y_WEBGL,e.flipY),Gt.pixelStorei(Gt.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.premultiplyAlpha),Gt.pixelStorei(Gt.UNPACK_ALIGNMENT,e.unpackAlignment);var r=G(e.image,Kt.maxTextureSize);H(e)&&!1===z(r)&&(r=K(r));var i=z(r),a=tt(e.format),s=tt(e.type);j(Gt.TEXTURE_2D,e,i);var u,l=e.mipmaps;if(e instanceof p.DataTexture)if(l.length>0&&i){for(var c=0,d=l.length;c<d;c++)u=l[c],Yt.texImage2D(Gt.TEXTURE_2D,c,a,u.width,u.height,0,a,s,u.data);e.generateMipmaps=!1}else Yt.texImage2D(Gt.TEXTURE_2D,0,a,r.width,r.height,0,a,s,r.data);else if(e instanceof p.CompressedTexture)for(var c=0,d=l.length;c<d;c++)u=l[c],e.format!==p.RGBAFormat&&e.format!==p.RGBFormat?Yt.getCompressedTextureFormats().indexOf(a)>-1&&Yt.compressedTexImage2D(Gt.TEXTURE_2D,c,a,u.width,u.height,0,u.data):Yt.texImage2D(Gt.TEXTURE_2D,c,a,u.width,u.height,0,a,s,u.data);else if(l.length>0&&i){for(var c=0,d=l.length;c<d;c++)u=l[c],Yt.texImage2D(Gt.TEXTURE_2D,c,a,a,s,u);e.generateMipmaps=!1}else Yt.texImage2D(Gt.TEXTURE_2D,0,a,a,s,r);e.generateMipmaps&&i&&Gt.generateMipmap(Gt.TEXTURE_2D),t.__version=e.version,e.onUpdate&&e.onUpdate(e)}function G(t,e){if(t.width>e||t.height>e){var n=e/Math.max(t.width,t.height),r=document.createElement("canvas");r.width=Math.floor(t.width*n),r.height=Math.floor(t.height*n);return r.getContext("2d").drawImage(t,0,0,t.width,t.height,0,0,r.width,r.height),r}return t}function z(t){return p.Math.isPowerOfTwo(t.width)&&p.Math.isPowerOfTwo(t.height)}function H(t){return t.wrapS!==p.ClampToEdgeWrapping||t.wrapT!==p.ClampToEdgeWrapping||t.minFilter!==p.NearestFilter&&t.minFilter!==p.LinearFilter}function K(t){if(t instanceof HTMLImageElement||t instanceof HTMLCanvasElement){var e=document.createElement("canvas");e.width=p.Math.nearestPowerOfTwo(t.width),e.height=p.Math.nearestPowerOfTwo(t.height);return e.getContext("2d").drawImage(t,0,0,e.width,e.height),e}return t}function Y(t,e){var n=Wt.get(t);if(6===t.image.length)if(t.version>0&&n.__version!==t.version){n.__image__webglTextureCube||(t.addEventListener("dispose",o),n.__image__webglTextureCube=Gt.createTexture(),jt.textures++),Yt.activeTexture(Gt.TEXTURE0+e),Yt.bindTexture(Gt.TEXTURE_CUBE_MAP,n.__image__webglTextureCube),Gt.pixelStorei(Gt.UNPACK_FLIP_Y_WEBGL,t.flipY);for(var r=t instanceof p.CompressedTexture,i=t.image[0]instanceof p.DataTexture,a=[],s=0;s<6;s++)!vt.autoScaleCubemaps||r||i?a[s]=i?t.image[s].image:t.image[s]:a[s]=G(t.image[s],Kt.maxCubemapSize);var u=a[0],l=z(u),c=tt(t.format),d=tt(t.type);j(Gt.TEXTURE_CUBE_MAP,t,l);for(var s=0;s<6;s++)if(r)for(var h,f=a[s].mipmaps,m=0,g=f.length;m<g;m++)h=f[m],t.format!==p.RGBAFormat&&t.format!==p.RGBFormat?Yt.getCompressedTextureFormats().indexOf(c)>-1&&Yt.compressedTexImage2D(Gt.TEXTURE_CUBE_MAP_POSITIVE_X+s,m,c,h.width,h.height,0,h.data):Yt.texImage2D(Gt.TEXTURE_CUBE_MAP_POSITIVE_X+s,m,c,h.width,h.height,0,c,d,h.data);else i?Yt.texImage2D(Gt.TEXTURE_CUBE_MAP_POSITIVE_X+s,0,c,a[s].width,a[s].height,0,c,d,a[s].data):Yt.texImage2D(Gt.TEXTURE_CUBE_MAP_POSITIVE_X+s,0,c,c,d,a[s]);t.generateMipmaps&&l&&Gt.generateMipmap(Gt.TEXTURE_CUBE_MAP),n.__version=t.version,t.onUpdate&&t.onUpdate(t)}else Yt.activeTexture(Gt.TEXTURE0+e),Yt.bindTexture(Gt.TEXTURE_CUBE_MAP,n.__image__webglTextureCube)}function W(t,e){Yt.activeTexture(Gt.TEXTURE0+e),Yt.bindTexture(Gt.TEXTURE_CUBE_MAP,Wt.get(t).__webglTexture)}function q(t,e,n,r){var i=tt(e.texture.format),a=tt(e.texture.type);Yt.texImage2D(r,0,i,e.width,e.height,0,i,a,null),Gt.bindFramebuffer(Gt.FRAMEBUFFER,t),Gt.framebufferTexture2D(Gt.FRAMEBUFFER,n,r,Wt.get(e.texture).__webglTexture,0),Gt.bindFramebuffer(Gt.FRAMEBUFFER,null)}function X(t,e){Gt.bindRenderbuffer(Gt.RENDERBUFFER,t),e.depthBuffer&&!e.stencilBuffer?(Gt.renderbufferStorage(Gt.RENDERBUFFER,Gt.DEPTH_COMPONENT16,e.width,e.height),Gt.framebufferRenderbuffer(Gt.FRAMEBUFFER,Gt.DEPTH_ATTACHMENT,Gt.RENDERBUFFER,t)):e.depthBuffer&&e.stencilBuffer?(Gt.renderbufferStorage(Gt.RENDERBUFFER,Gt.DEPTH_STENCIL,e.width,e.height),Gt.framebufferRenderbuffer(Gt.FRAMEBUFFER,Gt.DEPTH_STENCIL_ATTACHMENT,Gt.RENDERBUFFER,t)):Gt.renderbufferStorage(Gt.RENDERBUFFER,Gt.RGBA4,e.width,e.height),Gt.bindRenderbuffer(Gt.RENDERBUFFER,null)}function $(t){var e=Wt.get(t);if(t instanceof p.WebGLRenderTargetCube){e.__webglDepthbuffer=[];for(var n=0;n<6;n++)Gt.bindFramebuffer(Gt.FRAMEBUFFER,e.__webglFramebuffer[n]),e.__webglDepthbuffer[n]=Gt.createRenderbuffer(),X(e.__webglDepthbuffer[n],t)}else Gt.bindFramebuffer(Gt.FRAMEBUFFER,e.__webglFramebuffer),e.__webglDepthbuffer=Gt.createRenderbuffer(),X(e.__webglDepthbuffer,t);Gt.bindFramebuffer(Gt.FRAMEBUFFER,null)}function Z(t){var e=Wt.get(t),n=Wt.get(t.texture);t.addEventListener("dispose",s),n.__webglTexture=Gt.createTexture(),jt.textures++;var r=t instanceof p.WebGLRenderTargetCube,i=p.Math.isPowerOfTwo(t.width)&&p.Math.isPowerOfTwo(t.height);if(r){e.__webglFramebuffer=[];for(var a=0;a<6;a++)e.__webglFramebuffer[a]=Gt.createFramebuffer()}else e.__webglFramebuffer=Gt.createFramebuffer();if(r){Yt.bindTexture(Gt.TEXTURE_CUBE_MAP,n.__webglTexture),j(Gt.TEXTURE_CUBE_MAP,t.texture,i);for(var a=0;a<6;a++)q(e.__webglFramebuffer[a],t,Gt.COLOR_ATTACHMENT0,Gt.TEXTURE_CUBE_MAP_POSITIVE_X+a);t.texture.generateMipmaps&&i&&Gt.generateMipmap(Gt.TEXTURE_CUBE_MAP),Yt.bindTexture(Gt.TEXTURE_CUBE_MAP,null)}else Yt.bindTexture(Gt.TEXTURE_2D,n.__webglTexture),j(Gt.TEXTURE_2D,t.texture,i),q(e.__webglFramebuffer,t,Gt.COLOR_ATTACHMENT0,Gt.TEXTURE_2D),t.texture.generateMipmaps&&i&&Gt.generateMipmap(Gt.TEXTURE_2D),Yt.bindTexture(Gt.TEXTURE_2D,null);t.depthBuffer&&$(t)}function Q(t){var e=t instanceof p.WebGLRenderTargetCube?Gt.TEXTURE_CUBE_MAP:Gt.TEXTURE_2D,n=Wt.get(t.texture).__webglTexture;Yt.bindTexture(e,n),Gt.generateMipmap(e),Yt.bindTexture(e,null)}function J(t){return t===p.NearestFilter||t===p.NearestMipMapNearestFilter||t===p.NearestMipMapLinearFilter?Gt.NEAREST:Gt.LINEAR}function tt(t){var e;if(t===p.RepeatWrapping)return Gt.REPEAT;if(t===p.ClampToEdgeWrapping)return Gt.CLAMP_TO_EDGE;if(t===p.MirroredRepeatWrapping)return Gt.MIRRORED_REPEAT;if(t===p.NearestFilter)return Gt.NEAREST;if(t===p.NearestMipMapNearestFilter)return Gt.NEAREST_MIPMAP_NEAREST;if(t===p.NearestMipMapLinearFilter)return Gt.NEAREST_MIPMAP_LINEAR;if(t===p.LinearFilter)return Gt.LINEAR;if(t===p.LinearMipMapNearestFilter)return Gt.LINEAR_MIPMAP_NEAREST;if(t===p.LinearMipMapLinearFilter)return Gt.LINEAR_MIPMAP_LINEAR;if(t===p.UnsignedByteType)return Gt.UNSIGNED_BYTE;if(t===p.UnsignedShort4444Type)return Gt.UNSIGNED_SHORT_4_4_4_4;if(t===p.UnsignedShort5551Type)return Gt.UNSIGNED_SHORT_5_5_5_1;if(t===p.UnsignedShort565Type)return Gt.UNSIGNED_SHORT_5_6_5;if(t===p.ByteType)return Gt.BYTE;if(t===p.ShortType)return Gt.SHORT;if(t===p.UnsignedShortType)return Gt.UNSIGNED_SHORT;if(t===p.IntType)return Gt.INT;if(t===p.UnsignedIntType)return Gt.UNSIGNED_INT;if(t===p.FloatType)return Gt.FLOAT;if(null!==(e=Ht.get("OES_texture_half_float"))&&t===p.HalfFloatType)return e.HALF_FLOAT_OES;if(t===p.AlphaFormat)return Gt.ALPHA;if(t===p.RGBFormat)return Gt.RGB;if(t===p.RGBAFormat)return Gt.RGBA;if(t===p.LuminanceFormat)return Gt.LUMINANCE;if(t===p.LuminanceAlphaFormat)return Gt.LUMINANCE_ALPHA;if(t===p.AddEquation)return Gt.FUNC_ADD;if(t===p.SubtractEquation)return Gt.FUNC_SUBTRACT;if(t===p.ReverseSubtractEquation)return Gt.FUNC_REVERSE_SUBTRACT;if(t===p.ZeroFactor)return Gt.ZERO;if(t===p.OneFactor)return Gt.ONE;if(t===p.SrcColorFactor)return Gt.SRC_COLOR;if(t===p.OneMinusSrcColorFactor)return Gt.ONE_MINUS_SRC_COLOR;if(t===p.SrcAlphaFactor)return Gt.SRC_ALPHA;if(t===p.OneMinusSrcAlphaFactor)return Gt.ONE_MINUS_SRC_ALPHA;if(t===p.DstAlphaFactor)return Gt.DST_ALPHA;if(t===p.OneMinusDstAlphaFactor)return Gt.ONE_MINUS_DST_ALPHA;if(t===p.DstColorFactor)return Gt.DST_COLOR;if(t===p.OneMinusDstColorFactor)return Gt.ONE_MINUS_DST_COLOR;if(t===p.SrcAlphaSaturateFactor)return Gt.SRC_ALPHA_SATURATE;if(null!==(e=Ht.get("WEBGL_compressed_texture_s3tc"))){if(t===p.RGB_S3TC_DXT1_Format)return e.COMPRESSED_RGB_S3TC_DXT1_EXT;if(t===p.RGBA_S3TC_DXT1_Format)return e.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(t===p.RGBA_S3TC_DXT3_Format)return e.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(t===p.RGBA_S3TC_DXT5_Format)return e.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(null!==(e=Ht.get("WEBGL_compressed_texture_pvrtc"))){if(t===p.RGB_PVRTC_4BPPV1_Format)return e.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(t===p.RGB_PVRTC_2BPPV1_Format)return e.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(t===p.RGBA_PVRTC_4BPPV1_Format)return e.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(t===p.RGBA_PVRTC_2BPPV1_Format)return e.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(null!==(e=Ht.get("WEBGL_compressed_texture_etc1"))&&t===p.RGB_ETC1_Format)return e.COMPRESSED_RGB_ETC1_WEBGL;if(null!==(e=Ht.get("EXT_blend_minmax"))){if(t===p.MinEquation)return e.MIN_EXT;if(t===p.MaxEquation)return e.MAX_EXT}return 0}t=t||{};var et=void 0!==t.canvas?t.canvas:document.createElement("canvas"),nt=void 0!==t.context?t.context:null,rt=void 0!==t.alpha&&t.alpha,it=void 0===t.depth||t.depth,at=void 0===t.stencil||t.stencil,ot=void 0!==t.antialias&&t.antialias,st=void 0===t.premultipliedAlpha||t.premultipliedAlpha,ut=void 0!==t.preserveDrawingBuffer&&t.preserveDrawingBuffer,lt=[],ct=[],dt=-1,ht=[],ft=-1,pt=new Float32Array(8),mt=[],gt=[];this.domElement=et,this.context=null,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.gammaFactor=2,this.gammaInput=!1,this.gammaOutput=!1,this.physicallyCorrectLights=!1,this.toneMapping=p.LinearToneMapping,this.toneMappingExposure=1,this.toneMappingWhitePoint=1,this.maxMorphTargets=8,this.maxMorphNormals=4,this.autoScaleCubemaps=!0;var vt=this,yt=null,_t=null,bt=null,Et=-1,wt="",At=null,St=new p.Vector4,Tt=null,xt=new p.Vector4,kt=0,Ct=new p.Color(0),Mt=0,Rt=et.width,Lt=et.height,It=1,Pt=new p.Vector4(0,0,Rt,Lt),Ot=!1,Dt=new p.Vector4(0,0,Rt,Lt),Nt=new p.Frustum,Ut=new p.Matrix4,Ft=new p.Vector3,Bt={hash:"",ambient:[0,0,0],directional:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadowMap:[],spotShadowMatrix:[],point:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],shadows:[],shadowsPointLight:0},jt={geometries:0,textures:0},Vt={calls:0,vertices:0,faces:0,points:0};this.info={render:Vt,memory:jt,programs:null};var Gt;try{var zt={alpha:rt,depth:it,stencil:at,antialias:ot,premultipliedAlpha:st,preserveDrawingBuffer:ut};if(null===(Gt=nt||et.getContext("webgl",zt)||et.getContext("experimental-webgl",zt)))throw null!==et.getContext("webgl")?"Error creating WebGL context with your selected attributes.":"Error creating WebGL context.";void 0===Gt.getShaderPrecisionFormat&&(Gt.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}}),et.addEventListener("webglcontextlost",a,!1)}catch(ne){}var Ht=new p.WebGLExtensions(Gt);Ht.get("OES_texture_float"),Ht.get("OES_texture_float_linear"),Ht.get("OES_texture_half_float"),Ht.get("OES_texture_half_float_linear"),Ht.get("OES_standard_derivatives"),Ht.get("ANGLE_instanced_arrays"),Ht.get("OES_element_index_uint")&&(p.BufferGeometry.MaxIndex=4294967296);var Kt=new p.WebGLCapabilities(Gt,Ht,t),Yt=new p.WebGLState(Gt,Ht,tt),Wt=new p.WebGLProperties,qt=new p.WebGLObjects(Gt,Wt,this.info),Xt=new p.WebGLPrograms(this,Kt),$t=new p.WebGLLights;this.info.programs=Xt.programs;var Zt=new p.WebGLBufferRenderer(Gt,Ht,Vt),Qt=new p.WebGLIndexedBufferRenderer(Gt,Ht,Vt);r(),this.context=Gt,this.capabilities=Kt,this.extensions=Ht,this.properties=Wt,this.state=Yt;var Jt=new p.WebGLShadowMap(this,Bt,qt);this.shadowMap=Jt;var te=new p.SpritePlugin(this,mt),ee=new p.LensFlarePlugin(this,gt);this.getContext=function(){return Gt},this.getContextAttributes=function(){return Gt.getContextAttributes()},this.forceContextLoss=function(){Ht.get("WEBGL_lose_context").loseContext()},this.getMaxAnisotropy=function(){var t;return function(){if(void 0!==t)return t;var e=Ht.get("EXT_texture_filter_anisotropic");return t=null!==e?Gt.getParameter(e.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0}}(),this.getPrecision=function(){return Kt.precision},this.getPixelRatio=function(){return It},this.setPixelRatio=function(t){void 0!==t&&(It=t,this.setSize(Dt.z,Dt.w,!1))},this.getSize=function(){return{width:Rt,height:Lt}},this.setSize=function(t,e,n){Rt=t,Lt=e,et.width=t*It,et.height=e*It,!1!==n&&(et.style.width=t+"px",et.style.height=e+"px"),this.setViewport(0,0,t,e)},this.setViewport=function(t,e,n,r){Yt.viewport(Dt.set(t,e,n,r))},this.setScissor=function(t,e,n,r){Yt.scissor(Pt.set(t,e,n,r))},this.setScissorTest=function(t){Yt.setScissorTest(Ot=t)},this.getClearColor=function(){return Ct},this.setClearColor=function(t,e){Ct.set(t),Mt=void 0!==e?e:1,n(Ct.r,Ct.g,Ct.b,Mt)},this.getClearAlpha=function(){return Mt},this.setClearAlpha=function(t){Mt=t,n(Ct.r,Ct.g,Ct.b,Mt)},this.clear=function(t,e,n){var r=0;(void 0===t||t)&&(r|=Gt.COLOR_BUFFER_BIT),(void 0===e||e)&&(r|=Gt.DEPTH_BUFFER_BIT),(void 0===n||n)&&(r|=Gt.STENCIL_BUFFER_BIT),Gt.clear(r)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.clearTarget=function(t,e,n,r){this.setRenderTarget(t),this.clear(e,n,r)},this.resetGLState=i,this.dispose=function(){et.removeEventListener("webglcontextlost",a,!1)},this.renderBufferImmediate=function(t,e,n){Yt.initAttributes();var r=Wt.get(t);t.hasPositions&&!r.position&&(r.position=Gt.createBuffer()),t.hasNormals&&!r.normal&&(r.normal=Gt.createBuffer()),t.hasUvs&&!r.uv&&(r.uv=Gt.createBuffer()),t.hasColors&&!r.color&&(r.color=Gt.createBuffer());var i=e.getAttributes();if(t.hasPositions&&(Gt.bindBuffer(Gt.ARRAY_BUFFER,r.position),Gt.bufferData(Gt.ARRAY_BUFFER,t.positionArray,Gt.DYNAMIC_DRAW),Yt.enableAttribute(i.position),Gt.vertexAttribPointer(i.position,3,Gt.FLOAT,!1,0,0)),t.hasNormals){if(Gt.bindBuffer(Gt.ARRAY_BUFFER,r.normal),"MeshPhongMaterial"!==n.type&&"MeshStandardMaterial"!==n.type&&n.shading===p.FlatShading)for(var a=0,o=3*t.count;a<o;a+=9){var s=t.normalArray,u=(s[a+0]+s[a+3]+s[a+6])/3,l=(s[a+1]+s[a+4]+s[a+7])/3,c=(s[a+2]+s[a+5]+s[a+8])/3;s[a+0]=u,s[a+1]=l,s[a+2]=c,s[a+3]=u,s[a+4]=l,s[a+5]=c,s[a+6]=u,s[a+7]=l,s[a+8]=c}Gt.bufferData(Gt.ARRAY_BUFFER,t.normalArray,Gt.DYNAMIC_DRAW),Yt.enableAttribute(i.normal),Gt.vertexAttribPointer(i.normal,3,Gt.FLOAT,!1,0,0)}t.hasUvs&&n.map&&(Gt.bindBuffer(Gt.ARRAY_BUFFER,r.uv),Gt.bufferData(Gt.ARRAY_BUFFER,t.uvArray,Gt.DYNAMIC_DRAW),Yt.enableAttribute(i.uv),Gt.vertexAttribPointer(i.uv,2,Gt.FLOAT,!1,0,0)),t.hasColors&&n.vertexColors!==p.NoColors&&(Gt.bindBuffer(Gt.ARRAY_BUFFER,r.color),Gt.bufferData(Gt.ARRAY_BUFFER,t.colorArray,Gt.DYNAMIC_DRAW),Yt.enableAttribute(i.color),Gt.vertexAttribPointer(i.color,3,Gt.FLOAT,!1,0,0)),Yt.disableUnusedAttributes(),Gt.drawArrays(Gt.TRIANGLES,0,t.count),t.count=0},this.renderBufferDirect=function(t,n,r,i,a,o){w(i);var s=S(t,n,i,a),u=!1,l=r.id+"_"+s.id+"_"+i.wireframe;l!==wt&&(wt=l,u=!0);var c=a.morphTargetInfluences;if(void 0!==c){for(var d=[],h=0,g=c.length;h<g;h++){var v=c[h];d.push([v,h])}d.sort(m),d.length>8&&(d.length=8);for(var y=r.morphAttributes,h=0,g=d.length;h<g;h++){var v=d[h];if(pt[h]=v[0],0!==v[0]){var _=v[1];!0===i.morphTargets&&y.position&&r.addAttribute("morphTarget"+h,y.position[_]),!0===i.morphNormals&&y.normal&&r.addAttribute("morphNormal"+h,y.normal[_])}else!0===i.morphTargets&&r.removeAttribute("morphTarget"+h),!0===i.morphNormals&&r.removeAttribute("morphNormal"+h)}var b=s.getUniforms();null!==b.morphTargetInfluences&&Gt.uniform1fv(b.morphTargetInfluences,pt),u=!0}var _=r.index,E=r.attributes.position;!0===i.wireframe&&(_=qt.getWireframeAttribute(r));var A;null!==_?(A=Qt,A.setIndex(_)):A=Zt,u&&(f(i,s,r),null!==_&&Gt.bindBuffer(Gt.ELEMENT_ARRAY_BUFFER,qt.getAttributeBuffer(_)));var T=1/0;null!==_?T=_.count:void 0!==E&&(T=E.count);var x=r.drawRange.start,k=r.drawRange.count,C=null!==o?o.start:0,M=null!==o?o.count:1/0,R=Math.max(0,x,C),L=Math.min(0+T,x+k,C+M)-1,I=Math.max(0,L-R+1);if(a instanceof p.Mesh)if(!0===i.wireframe)Yt.setLineWidth(i.wireframeLinewidth*e()),A.setMode(Gt.LINES);else switch(a.drawMode){case p.TrianglesDrawMode:A.setMode(Gt.TRIANGLES);break;case p.TriangleStripDrawMode:A.setMode(Gt.TRIANGLE_STRIP);break;case p.TriangleFanDrawMode:A.setMode(Gt.TRIANGLE_FAN)}else if(a instanceof p.Line){var P=i.linewidth;void 0===P&&(P=1),Yt.setLineWidth(P*e()),a instanceof p.LineSegments?A.setMode(Gt.LINES):A.setMode(Gt.LINE_STRIP)}else a instanceof p.Points&&A.setMode(Gt.POINTS);r instanceof p.InstancedBufferGeometry?r.maxInstancedCount>0&&A.renderInstances(r,R,I):A.render(R,I)},this.render=function(t,e,n,r){if(e instanceof p.Camera!=!1){var i=t.fog;if(wt="",Et=-1,At=null,!0===t.autoUpdate&&t.updateMatrixWorld(),null===e.parent&&e.updateMatrixWorld(),e.matrixWorldInverse.getInverse(e.matrixWorld),Ut.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),Nt.setFromMatrix(Ut),lt.length=0,dt=-1,ft=-1,mt.length=0,gt.length=0,_(t,e),ct.length=dt+1,ht.length=ft+1,!0===vt.sortObjects&&(ct.sort(g),ht.sort(v)),B(lt,e),Jt.render(t,e),Vt.calls=0,Vt.vertices=0,Vt.faces=0,Vt.points=0,void 0===n&&(n=null),this.setRenderTarget(n),(this.autoClear||r)&&this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil),t.overrideMaterial){var a=t.overrideMaterial;b(ct,e,i,a),b(ht,e,i,a)}else Yt.setBlending(p.NoBlending),b(ct,e,i),b(ht,e,i);if(te.render(t,e),ee.render(t,e,xt),n){var o=n.texture;o.generateMipmaps&&z(n)&&o.minFilter!==p.NearestFilter&&o.minFilter!==p.LinearFilter&&Q(n)}Yt.setDepthTest(!0),Yt.setDepthWrite(!0),Yt.setColorWrite(!0)}},this.setFaceCulling=function(t,e){t===p.CullFaceNone?Yt.disable(Gt.CULL_FACE):(e===p.FrontFaceDirectionCW?Gt.frontFace(Gt.CW):Gt.frontFace(Gt.CCW),t===p.CullFaceBack?Gt.cullFace(Gt.BACK):t===p.CullFaceFront?Gt.cullFace(Gt.FRONT):Gt.cullFace(Gt.FRONT_AND_BACK),Yt.enable(Gt.CULL_FACE))},this.setTexture=function(t,e){var n=Wt.get(t);if(t.version>0&&n.__version!==t.version){var r=t.image;if(void 0===r)return;if(!1===r.complete)return;return void V(n,t,e)}Yt.activeTexture(Gt.TEXTURE0+e),Yt.bindTexture(Gt.TEXTURE_2D,n.__webglTexture)},this.getCurrentRenderTarget=function(){return _t},this.setRenderTarget=function(t){_t=t,t&&void 0===Wt.get(t).__webglFramebuffer&&Z(t);var e,n=t instanceof p.WebGLRenderTargetCube;if(t){var r=Wt.get(t);e=n?r.__webglFramebuffer[t.activeCubeFace]:r.__webglFramebuffer,St.copy(t.scissor),Tt=t.scissorTest,xt.copy(t.viewport)}else e=null,St.copy(Pt).multiplyScalar(It),Tt=Ot,xt.copy(Dt).multiplyScalar(It);if(bt!==e&&(Gt.bindFramebuffer(Gt.FRAMEBUFFER,e),bt=e),Yt.scissor(St),Yt.setScissorTest(Tt),Yt.viewport(xt),n){var i=Wt.get(t.texture);Gt.framebufferTexture2D(Gt.FRAMEBUFFER,Gt.COLOR_ATTACHMENT0,Gt.TEXTURE_CUBE_MAP_POSITIVE_X+t.activeCubeFace,i.__webglTexture,t.activeMipMapLevel)}},this.readRenderTargetPixels=function(t,e,n,r,i,a){if(t instanceof p.WebGLRenderTarget!=!1){var o=Wt.get(t).__webglFramebuffer;if(o){var s=!1;o!==bt&&(Gt.bindFramebuffer(Gt.FRAMEBUFFER,o),s=!0);try{var u=t.texture;if(u.format!==p.RGBAFormat&&tt(u.format)!==Gt.getParameter(Gt.IMPLEMENTATION_COLOR_READ_FORMAT))return;if(!(u.type===p.UnsignedByteType||tt(u.type)===Gt.getParameter(Gt.IMPLEMENTATION_COLOR_READ_TYPE)||u.type===p.FloatType&&Ht.get("WEBGL_color_buffer_float")||u.type===p.HalfFloatType&&Ht.get("EXT_color_buffer_half_float")))return;Gt.checkFramebufferStatus(Gt.FRAMEBUFFER)===Gt.FRAMEBUFFER_COMPLETE&&Gt.readPixels(e,n,r,i,tt(u.format),tt(u.type),a)}finally{s&&Gt.bindFramebuffer(Gt.FRAMEBUFFER,bt)}}}}},p.WebGLExtensions=function(t){var e={};this.get=function(n){if(void 0!==e[n])return e[n];var r;switch(n){case"EXT_texture_filter_anisotropic":r=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;case"WEBGL_compressed_texture_etc1":r=t.getExtension("WEBGL_compressed_texture_etc1");break;default:r=t.getExtension(n)}return e[n]=r,r}},p.WebGLCapabilities=function(t,e,n){function r(e){if("highp"===e){if(t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.HIGH_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT).precision>0)return"highp";e="mediump"}return"mediump"===e&&t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.MEDIUM_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}this.getMaxPrecision=r,this.precision=void 0!==n.precision?n.precision:"highp",this.logarithmicDepthBuffer=void 0!==n.logarithmicDepthBuffer&&n.logarithmicDepthBuffer,this.maxTextures=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),this.maxVertexTextures=t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),this.maxCubemapSize=t.getParameter(t.MAX_CUBE_MAP_TEXTURE_SIZE),this.maxAttributes=t.getParameter(t.MAX_VERTEX_ATTRIBS),this.maxVertexUniforms=t.getParameter(t.MAX_VERTEX_UNIFORM_VECTORS),this.maxVaryings=t.getParameter(t.MAX_VARYING_VECTORS),this.maxFragmentUniforms=t.getParameter(t.MAX_FRAGMENT_UNIFORM_VECTORS),this.vertexTextures=this.maxVertexTextures>0,this.floatFragmentTextures=!!e.get("OES_texture_float"),this.floatVertexTextures=this.vertexTextures&&this.floatFragmentTextures;var i=r(this.precision);i!==this.precision&&(this.precision=i),this.logarithmicDepthBuffer&&(this.logarithmicDepthBuffer=!!e.get("EXT_frag_depth"))},p.WebGLProperties=function(){var t={};this.get=function(e){var n=e.uuid,r=t[n];return void 0===r&&(r={},t[n]=r),r},this.delete=function(e){delete t[e.uuid]},this.clear=function(){t={}}},p.WebGLLights=function(){var t={};this.get=function(e){if(void 0!==t[e.id])return t[e.id];var n;switch(e.type){case"DirectionalLight":n={direction:new p.Vector3,color:new p.Color,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new p.Vector2};break;case"SpotLight":n={position:new p.Vector3,direction:new p.Vector3,color:new p.Color,distance:0,coneCos:0,penumbraCos:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new p.Vector2};break;case"PointLight":n={position:new p.Vector3,color:new p.Color,distance:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new p.Vector2};break;case"HemisphereLight":n={direction:new p.Vector3,skyColor:new p.Color,groundColor:new p.Color}}return t[e.id]=n,n}},p.WebGLState=function(t,e,n){var r=this,i=new p.Vector4,a=new Uint8Array(16),o=new Uint8Array(16),s=new Uint8Array(16),u={},l=null,c=null,d=null,h=null,f=null,m=null,g=null,v=null,y=!1,_=null,b=null,E=null,w=null,A=null,S=null,T=null,x=null,k=null,C=null,M=null,R=null,L=null,I=null,P=null,O=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),D=void 0,N={},U=new p.Vector4,F=null,B=null,j=new p.Vector4,V=new p.Vector4,G=t.createTexture();t.bindTexture(t.TEXTURE_2D,G),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texImage2D(t.TEXTURE_2D,0,t.RGB,1,1,0,t.RGB,t.UNSIGNED_BYTE,new Uint8Array(3)),this.init=function(){this.clearColor(0,0,0,1),this.clearDepth(1),this.clearStencil(0),this.enable(t.DEPTH_TEST),t.depthFunc(t.LEQUAL),t.frontFace(t.CCW),t.cullFace(t.BACK),this.enable(t.CULL_FACE),this.enable(t.BLEND),t.blendEquation(t.FUNC_ADD),t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA)},this.initAttributes=function(){for(var t=0,e=a.length;t<e;t++)a[t]=0},this.enableAttribute=function(n){if(a[n]=1,0===o[n]&&(t.enableVertexAttribArray(n),o[n]=1),0!==s[n]){e.get("ANGLE_instanced_arrays").vertexAttribDivisorANGLE(n,0),s[n]=0}},this.enableAttributeAndDivisor=function(e,n,r){a[e]=1,0===o[e]&&(t.enableVertexAttribArray(e),o[e]=1),s[e]!==n&&(r.vertexAttribDivisorANGLE(e,n),s[e]=n)},this.disableUnusedAttributes=function(){for(var e=0,n=o.length;e<n;e++)o[e]!==a[e]&&(t.disableVertexAttribArray(e),o[e]=0)},this.enable=function(e){!0!==u[e]&&(t.enable(e),u[e]=!0)},this.disable=function(e){!1!==u[e]&&(t.disable(e),u[e]=!1)},this.getCompressedTextureFormats=function(){if(null===l&&(l=[],e.get("WEBGL_compressed_texture_pvrtc")||e.get("WEBGL_compressed_texture_s3tc")||e.get("WEBGL_compressed_texture_etc1")))for(var n=t.getParameter(t.COMPRESSED_TEXTURE_FORMATS),r=0;r<n.length;r++)l.push(n[r]);return l},this.setBlending=function(e,r,i,a,o,s,u,l){e===p.NoBlending?this.disable(t.BLEND):this.enable(t.BLEND),e===c&&l===y||(e===p.AdditiveBlending?l?(t.blendEquationSeparate(t.FUNC_ADD,t.FUNC_ADD),t.blendFuncSeparate(t.ONE,t.ONE,t.ONE,t.ONE)):(t.blendEquation(t.FUNC_ADD),t.blendFunc(t.SRC_ALPHA,t.ONE)):e===p.SubtractiveBlending?l?(t.blendEquationSeparate(t.FUNC_ADD,t.FUNC_ADD),t.blendFuncSeparate(t.ZERO,t.ZERO,t.ONE_MINUS_SRC_COLOR,t.ONE_MINUS_SRC_ALPHA)):(t.blendEquation(t.FUNC_ADD),t.blendFunc(t.ZERO,t.ONE_MINUS_SRC_COLOR)):e===p.MultiplyBlending?l?(t.blendEquationSeparate(t.FUNC_ADD,t.FUNC_ADD),t.blendFuncSeparate(t.ZERO,t.ZERO,t.SRC_COLOR,t.SRC_ALPHA)):(t.blendEquation(t.FUNC_ADD),t.blendFunc(t.ZERO,t.SRC_COLOR)):l?(t.blendEquationSeparate(t.FUNC_ADD,t.FUNC_ADD),t.blendFuncSeparate(t.ONE,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA)):(t.blendEquationSeparate(t.FUNC_ADD,t.FUNC_ADD),t.blendFuncSeparate(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA)),c=e,y=l),e===p.CustomBlending?(o=o||r,s=s||i,u=u||a,r===d&&o===m||(t.blendEquationSeparate(n(r),n(o)),d=r,m=o),i===h&&a===f&&s===g&&u===v||(t.blendFuncSeparate(n(i),n(a),n(s),n(u)),h=i,f=a,g=s,v=u)):(d=null,h=null,f=null,m=null,g=null,v=null)},this.setDepthFunc=function(e){if(_!==e){if(e)switch(e){case p.NeverDepth:t.depthFunc(t.NEVER);break;case p.AlwaysDepth:t.depthFunc(t.ALWAYS);break;case p.LessDepth:t.depthFunc(t.LESS);break;case p.LessEqualDepth:t.depthFunc(t.LEQUAL);break;case p.EqualDepth:t.depthFunc(t.EQUAL);break;case p.GreaterEqualDepth:t.depthFunc(t.GEQUAL);break;case p.GreaterDepth:t.depthFunc(t.GREATER);break;case p.NotEqualDepth:t.depthFunc(t.NOTEQUAL);break;default:t.depthFunc(t.LEQUAL)}else t.depthFunc(t.LEQUAL);_=e}},this.setDepthTest=function(e){e?this.enable(t.DEPTH_TEST):this.disable(t.DEPTH_TEST)},this.setDepthWrite=function(e){b!==e&&(t.depthMask(e),b=e)},this.setColorWrite=function(e){E!==e&&(t.colorMask(e,e,e,e),E=e)},this.setStencilFunc=function(e,n,r){A===e&&S===n&&T===r||(t.stencilFunc(e,n,r),A=e,S=n,T=r)},this.setStencilOp=function(e,n,r){x===e&&k===n&&C===r||(t.stencilOp(e,n,r),x=e,k=n,C=r)},this.setStencilTest=function(e){e?this.enable(t.STENCIL_TEST):this.disable(t.STENCIL_TEST)},this.setStencilWrite=function(e){w!==e&&(t.stencilMask(e),w=e)},this.setFlipSided=function(e){M!==e&&(e?t.frontFace(t.CW):t.frontFace(t.CCW),M=e)},this.setLineWidth=function(e){e!==R&&(t.lineWidth(e),R=e)},this.setPolygonOffset=function(e,n,r){e?this.enable(t.POLYGON_OFFSET_FILL):this.disable(t.POLYGON_OFFSET_FILL),!e||L===n&&I===r||(t.polygonOffset(n,r),L=n,I=r)},this.getScissorTest=function(){return P},this.setScissorTest=function(e){P=e,e?this.enable(t.SCISSOR_TEST):this.disable(t.SCISSOR_TEST)},this.activeTexture=function(e){void 0===e&&(e=t.TEXTURE0+O-1),D!==e&&(t.activeTexture(e),D=e)},this.bindTexture=function(e,n){void 0===D&&r.activeTexture();var i=N[D];void 0===i&&(i={type:void 0,texture:void 0},N[D]=i),i.type===e&&i.texture===n||(t.bindTexture(e,n||G),i.type=e,i.texture=n)},this.compressedTexImage2D=function(){try{t.compressedTexImage2D.apply(t,arguments)}catch(e){}},this.texImage2D=function(){try{t.texImage2D.apply(t,arguments)}catch(e){}},this.clearColor=function(e,n,r,a){i.set(e,n,r,a),!1===U.equals(i)&&(t.clearColor(e,n,r,a),U.copy(i))},this.clearDepth=function(e){F!==e&&(t.clearDepth(e),F=e)},this.clearStencil=function(e){B!==e&&(t.clearStencil(e),B=e)},this.scissor=function(e){!1===j.equals(e)&&(t.scissor(e.x,e.y,e.z,e.w),j.copy(e))},this.viewport=function(e){!1===V.equals(e)&&(t.viewport(e.x,e.y,e.z,e.w),V.copy(e))},this.reset=function(){for(var e=0;e<o.length;e++)1===o[e]&&(t.disableVertexAttribArray(e),o[e]=0);u={},l=null,D=void 0,N={},c=null,E=null,b=null,w=null,M=null}},p.WebGLGeometries=function(t,e,n){function r(t){var e=t.geometry;if(void 0!==l[e.id])return l[e.id];e.addEventListener("dispose",i);var r;return e instanceof p.BufferGeometry?r=e:e instanceof p.Geometry&&(void 0===e._bufferGeometry&&(e._bufferGeometry=(new p.BufferGeometry).setFromObject(t)),r=e._bufferGeometry),l[e.id]=r,n.memory.geometries++,r}function i(t){var r=t.target,a=l[r.id];null!==a.index&&o(a.index),s(a.attributes),r.removeEventListener("dispose",i),delete l[r.id];var u=e.get(r);u.wireframe&&o(u.wireframe),e.delete(r);var c=e.get(a);c.wireframe&&o(c.wireframe),e.delete(a),n.memory.geometries--}function a(t){return t instanceof p.InterleavedBufferAttribute?e.get(t.data).__webglBuffer:e.get(t).__webglBuffer}function o(e){var n=a(e);void 0!==n&&(t.deleteBuffer(n),u(e))}function s(t){for(var e in t)o(t[e])}function u(t){t instanceof p.InterleavedBufferAttribute?e.delete(t.data):e.delete(t)}var l={};this.get=r},p.WebGLBufferRenderer=function(t,e,n){function r(t){o=t}function i(e,r){t.drawArrays(o,e,r),n.calls++,n.vertices+=r,o===t.TRIANGLES&&(n.faces+=r/3)}function a(r){var i=e.get("ANGLE_instanced_arrays");if(null!==i){var a=r.attributes.position,s=0;a instanceof p.InterleavedBufferAttribute?(s=a.data.count,i.drawArraysInstancedANGLE(o,0,s,r.maxInstancedCount)):(s=a.count,i.drawArraysInstancedANGLE(o,0,s,r.maxInstancedCount)),n.calls++,n.vertices+=s*r.maxInstancedCount,o===t.TRIANGLES&&(n.faces+=r.maxInstancedCount*s/3)}}var o;this.setMode=r,this.render=i,this.renderInstances=a},p.WebGLIndexedBufferRenderer=function(t,e,n){function r(t){s=t}function i(n){n.array instanceof Uint32Array&&e.get("OES_element_index_uint")?(u=t.UNSIGNED_INT,l=4):(u=t.UNSIGNED_SHORT,l=2)}function a(e,r){t.drawElements(s,r,u,e*l),n.calls++,n.vertices+=r,s===t.TRIANGLES&&(n.faces+=r/3)}function o(r,i,a){var o=e.get("ANGLE_instanced_arrays");null!==o&&(o.drawElementsInstancedANGLE(s,a,u,i*l,r.maxInstancedCount),n.calls++,n.vertices+=a*r.maxInstancedCount,s===t.TRIANGLES&&(n.faces+=r.maxInstancedCount*a/3))}var s,u,l;this.setMode=r,this.setIndex=i,this.render=a,this.renderInstances=o},p.WebGLShader=function(){return function(t,e,n){var r=t.createShader(e);return t.shaderSource(r,n),t.compileShader(r),t.getShaderParameter(r,t.COMPILE_STATUS),t.getShaderInfoLog(r),r}}(),p.WebGLShadowMap=function(t,e,n){function r(t,e,n,r){var i=t.geometry,a=null,o=v,s=t.customDepthMaterial;if(n&&(o=y,s=t.customDistanceMaterial),s)a=s;else{var u=void 0!==i.morphTargets&&i.morphTargets.length>0&&e.morphTargets,l=t instanceof p.SkinnedMesh&&e.skinning,c=0;u&&(c|=f),l&&(c|=m),a=o[c]}return a.visible=e.visible,a.wireframe=e.wireframe,a.wireframeLinewidth=e.wireframeLinewidth,n&&void 0!==a.uniforms.lightPos&&a.uniforms.lightPos.value.copy(r),a}function i(t,e,n){if(!1!==t.visible){if(t.layers.test(e.layers)&&(t instanceof p.Mesh||t instanceof p.Line||t instanceof p.Points)&&t.castShadow&&(!1===t.frustumCulled||!0===s.intersectsObject(t))){!0===t.material.visible&&(t.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,t.matrixWorld),h.push(t))}for(var r=t.children,a=0,o=r.length;a<o;a++)i(r[a],e,n)}}for(var a=t.context,o=t.state,s=new p.Frustum,u=new p.Matrix4,l=new p.Vector2,c=new p.Vector3,d=new p.Vector3,h=[],f=1,m=2,g=1+(f|m),v=new Array(g),y=new Array(g),_=[new p.Vector3(1,0,0),new p.Vector3(-1,0,0),new p.Vector3(0,0,1),new p.Vector3(0,0,-1),new p.Vector3(0,1,0),new p.Vector3(0,-1,0)],b=[new p.Vector3(0,1,0),new p.Vector3(0,1,0),new p.Vector3(0,1,0),new p.Vector3(0,1,0),new p.Vector3(0,0,1),new p.Vector3(0,0,-1)],E=[new p.Vector4,new p.Vector4,new p.Vector4,new p.Vector4,new p.Vector4,new p.Vector4],w=p.ShaderLib["depthRGBA"],A=p.UniformsUtils.clone(w.uniforms),S=p.ShaderLib["distanceRGBA"],T=p.UniformsUtils.clone(S.uniforms),x=0;x!==g;++x){var k=0!=(x&f),C=0!=(x&m),M=new p.ShaderMaterial({uniforms:A,vertexShader:w.vertexShader,fragmentShader:w.fragmentShader,morphTargets:k,skinning:C});v[x]=M;var R=new p.ShaderMaterial({defines:{USE_SHADOWMAP:""},uniforms:T,vertexShader:S.vertexShader,fragmentShader:S.fragmentShader,morphTargets:k,skinning:C});y[x]=R}var L=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=p.PCFShadowMap,this.cullFace=p.CullFaceFront,this.render=function(f,m){var g,v,y=e.shadows;if(0!==y.length&&!1!==L.enabled&&(!1!==L.autoUpdate||!1!==L.needsUpdate)){o.clearColor(1,1,1,1),o.disable(a.BLEND),o.enable(a.CULL_FACE),a.frontFace(a.CCW),a.cullFace(L.cullFace===p.CullFaceFront?a.FRONT:a.BACK),o.setDepthTest(!0),o.setScissorTest(!1);for(var w=0,A=y.length;w<A;w++){var S=y[w],T=S.shadow,x=T.camera;if(l.copy(T.mapSize),S instanceof p.PointLight){g=6,v=!0;var k=l.x,C=l.y;E[0].set(2*k,C,k,C),E[1].set(0,C,k,C),E[2].set(3*k,C,k,C),E[3].set(k,C,k,C),E[4].set(3*k,0,k,C),E[5].set(k,0,k,C),l.x*=4,l.y*=2}else g=1,v=!1;if(null===T.map){var M={minFilter:p.NearestFilter,magFilter:p.NearestFilter,format:p.RGBAFormat};T.map=new p.WebGLRenderTarget(l.x,l.y,M),S instanceof p.SpotLight&&(x.aspect=l.x/l.y),x.updateProjectionMatrix()}var R=T.map,I=T.matrix;d.setFromMatrixPosition(S.matrixWorld),x.position.copy(d),t.setRenderTarget(R),t.clear();for(var P=0;P<g;P++){if(v){c.copy(x.position),c.add(_[P]),x.up.copy(b[P]),x.lookAt(c);var O=E[P];o.viewport(O)}else c.setFromMatrixPosition(S.target.matrixWorld),x.lookAt(c);x.updateMatrixWorld(),x.matrixWorldInverse.getInverse(x.matrixWorld),I.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),I.multiply(x.projectionMatrix),I.multiply(x.matrixWorldInverse),u.multiplyMatrices(x.projectionMatrix,x.matrixWorldInverse),s.setFromMatrix(u),h.length=0,i(f,m,x);for(var D=0,N=h.length;D<N;D++){var U=h[D],F=n.update(U),B=U.material;if(B instanceof p.MultiMaterial)for(var j=F.groups,V=B.materials,G=0,z=j.length;G<z;G++){var H=j[G],K=V[H.materialIndex];if(!0===K.visible){var Y=r(U,K,v,d);t.renderBufferDirect(x,null,F,Y,U,H)}}else{var Y=r(U,B,v,d);t.renderBufferDirect(x,null,F,Y,U,null)}}}}var W=t.getClearColor(),q=t.getClearAlpha();t.setClearColor(W,q),o.enable(a.BLEND),L.cullFace===p.CullFaceFront&&a.cullFace(a.BACK),L.needsUpdate=!1}}},p.SpritePlugin=function(t,e){function n(){var t=new Float32Array([-.5,-.5,0,0,.5,-.5,1,0,.5,.5,1,1,-.5,.5,0,1]),e=new Uint16Array([0,1,2,0,2,3]);a=d.createBuffer(),o=d.createBuffer(),d.bindBuffer(d.ARRAY_BUFFER,a),d.bufferData(d.ARRAY_BUFFER,t,d.STATIC_DRAW),d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,o),d.bufferData(d.ELEMENT_ARRAY_BUFFER,e,d.STATIC_DRAW),s=r(),u={position:d.getAttribLocation(s,"position"),uv:d.getAttribLocation(s,"uv")},l={uvOffset:d.getUniformLocation(s,"uvOffset"),uvScale:d.getUniformLocation(s,"uvScale"),rotation:d.getUniformLocation(s,"rotation"),scale:d.getUniformLocation(s,"scale"),color:d.getUniformLocation(s,"color"),map:d.getUniformLocation(s,"map"),opacity:d.getUniformLocation(s,"opacity"),modelViewMatrix:d.getUniformLocation(s,"modelViewMatrix"),projectionMatrix:d.getUniformLocation(s,"projectionMatrix"),fogType:d.getUniformLocation(s,"fogType"),fogDensity:d.getUniformLocation(s,"fogDensity"),fogNear:d.getUniformLocation(s,"fogNear"),fogFar:d.getUniformLocation(s,"fogFar"),fogColor:d.getUniformLocation(s,"fogColor"),alphaTest:d.getUniformLocation(s,"alphaTest")};var n=document.createElement("canvas");n.width=8,n.height=8;var i=n.getContext("2d");i.fillStyle="white",i.fillRect(0,0,8,8),c=new p.Texture(n),c.needsUpdate=!0}function r(){var e=d.createProgram(),n=d.createShader(d.VERTEX_SHADER),r=d.createShader(d.FRAGMENT_SHADER);return d.shaderSource(n,["precision "+t.getPrecision()+" float;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform float rotation;","uniform vec2 scale;","uniform vec2 uvOffset;","uniform vec2 uvScale;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uvOffset + uv * uvScale;","vec2 alignedPosition = position * scale;","vec2 rotatedPosition;","rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;","rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;","vec4 finalPosition;","finalPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );","finalPosition.xy += rotatedPosition;","finalPosition = projectionMatrix * finalPosition;","gl_Position = finalPosition;","}"].join("\n")),d.shaderSource(r,["precision "+t.getPrecision()+" float;","uniform vec3 color;","uniform sampler2D map;","uniform float opacity;","uniform int fogType;","uniform vec3 fogColor;","uniform float fogDensity;","uniform float fogNear;","uniform float fogFar;","uniform float alphaTest;","varying vec2 vUV;","void main() {","vec4 texture = texture2D( map, vUV );","if ( texture.a < alphaTest ) discard;","gl_FragColor = vec4( color * texture.xyz, texture.a * opacity );","if ( fogType > 0 ) {","float depth = gl_FragCoord.z / gl_FragCoord.w;","float fogFactor = 0.0;","if ( fogType == 1 ) {","fogFactor = smoothstep( fogNear, fogFar, depth );","} else {","const float LOG2 = 1.442695;","fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );","fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );","}","gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","}","}"].join("\n")),d.compileShader(n),d.compileShader(r),d.attachShader(e,n),d.attachShader(e,r),d.linkProgram(e),e}function i(t,e){return t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:e.id-t.id}var a,o,s,u,l,c,d=t.context,h=t.state,f=new p.Vector3,m=new p.Quaternion,g=new p.Vector3;this.render=function(r,v){if(0!==e.length){void 0===s&&n(),d.useProgram(s),h.initAttributes(),h.enableAttribute(u.position),h.enableAttribute(u.uv),h.disableUnusedAttributes(),h.disable(d.CULL_FACE),h.enable(d.BLEND),d.bindBuffer(d.ARRAY_BUFFER,a),d.vertexAttribPointer(u.position,2,d.FLOAT,!1,16,0),d.vertexAttribPointer(u.uv,2,d.FLOAT,!1,16,8),d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,o),d.uniformMatrix4fv(l.projectionMatrix,!1,v.projectionMatrix.elements),h.activeTexture(d.TEXTURE0),d.uniform1i(l.map,0);var y=0,_=0,b=r.fog;b?(d.uniform3f(l.fogColor,b.color.r,b.color.g,b.color.b),b instanceof p.Fog?(d.uniform1f(l.fogNear,b.near),d.uniform1f(l.fogFar,b.far),d.uniform1i(l.fogType,1),y=1,_=1):b instanceof p.FogExp2&&(d.uniform1f(l.fogDensity,b.density),d.uniform1i(l.fogType,2),y=2,_=2)):(d.uniform1i(l.fogType,0),y=0,_=0);for(var E=0,w=e.length;E<w;E++){var A=e[E];A.modelViewMatrix.multiplyMatrices(v.matrixWorldInverse,A.matrixWorld),A.z=-A.modelViewMatrix.elements[14]}e.sort(i);for(var S=[],E=0,w=e.length;E<w;E++){var A=e[E],T=A.material;d.uniform1f(l.alphaTest,T.alphaTest),d.uniformMatrix4fv(l.modelViewMatrix,!1,A.modelViewMatrix.elements),A.matrixWorld.decompose(f,m,g),S[0]=g.x,S[1]=g.y;var x=0;r.fog&&T.fog&&(x=_),y!==x&&(d.uniform1i(l.fogType,x),y=x),null!==T.map?(d.uniform2f(l.uvOffset,T.map.offset.x,T.map.offset.y),d.uniform2f(l.uvScale,T.map.repeat.x,T.map.repeat.y)):(d.uniform2f(l.uvOffset,0,0),d.uniform2f(l.uvScale,1,1)),d.uniform1f(l.opacity,T.opacity),d.uniform3f(l.color,T.color.r,T.color.g,T.color.b),d.uniform1f(l.rotation,T.rotation),d.uniform2fv(l.scale,S),h.setBlending(T.blending,T.blendEquation,T.blendSrc,T.blendDst),h.setDepthTest(T.depthTest),h.setDepthWrite(T.depthWrite),T.map&&T.map.image&&T.map.image.width?t.setTexture(T.map,0):t.setTexture(c,0),d.drawElements(d.TRIANGLES,6,d.UNSIGNED_SHORT,0)}h.enable(d.CULL_FACE),t.resetGLState()}}},p.LensFlarePlugin=function(t,e){function n(){var t=new Float32Array([-1,-1,0,0,1,-1,1,0,1,1,1,1,-1,1,0,1]),e=new Uint16Array([0,1,2,0,2,3]);i=h.createBuffer(),a=h.createBuffer(),h.bindBuffer(h.ARRAY_BUFFER,i),h.bufferData(h.ARRAY_BUFFER,t,h.STATIC_DRAW),h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,a),h.bufferData(h.ELEMENT_ARRAY_BUFFER,e,h.STATIC_DRAW),c=h.createTexture(),d=h.createTexture(),f.bindTexture(h.TEXTURE_2D,c),h.texImage2D(h.TEXTURE_2D,0,h.RGB,16,16,0,h.RGB,h.UNSIGNED_BYTE,null),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.CLAMP_TO_EDGE),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.CLAMP_TO_EDGE),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.NEAREST),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.NEAREST),f.bindTexture(h.TEXTURE_2D,d),h.texImage2D(h.TEXTURE_2D,0,h.RGBA,16,16,0,h.RGBA,h.UNSIGNED_BYTE,null),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.CLAMP_TO_EDGE),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.CLAMP_TO_EDGE),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.NEAREST),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.NEAREST),l=h.getParameter(h.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0;var n;n=l?{vertexShader:["uniform lowp int renderType;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","uniform sampler2D occlusionMap;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","varying float vVisibility;","void main() {","vUV = uv;","vec2 pos = position;","if ( renderType == 2 ) {","vec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );","vVisibility =        visibility.r / 9.0;","vVisibility *= 1.0 - visibility.g / 9.0;","vVisibility *=       visibility.b / 9.0;","vVisibility *= 1.0 - visibility.a / 9.0;","pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","}","gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["uniform lowp int renderType;","uniform sampler2D map;","uniform float opacity;","uniform vec3 color;","varying vec2 vUV;","varying float vVisibility;","void main() {","if ( renderType == 0 ) {","gl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );","} else if ( renderType == 1 ) {","gl_FragColor = texture2D( map, vUV );","} else {","vec4 texture = texture2D( map, vUV );","texture.a *= opacity * vVisibility;","gl_FragColor = texture;","gl_FragColor.rgb *= color;","}","}"].join("\n")}:{vertexShader:["uniform lowp int renderType;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uv;","vec2 pos = position;","if ( renderType == 2 ) {","pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","}","gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["precision mediump float;","uniform lowp int renderType;","uniform sampler2D map;","uniform sampler2D occlusionMap;","uniform float opacity;","uniform vec3 color;","varying vec2 vUV;","void main() {","if ( renderType == 0 ) {","gl_FragColor = vec4( texture2D( map, vUV ).rgb, 0.0 );","} else if ( renderType == 1 ) {","gl_FragColor = texture2D( map, vUV );","} else {","float visibility = texture2D( occlusionMap, vec2( 0.5, 0.1 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) ).a;","visibility = ( 1.0 - visibility / 4.0 );","vec4 texture = texture2D( map, vUV );","texture.a *= opacity * visibility;","gl_FragColor = texture;","gl_FragColor.rgb *= color;","}","}"].join("\n")},o=r(n),s={vertex:h.getAttribLocation(o,"position"),uv:h.getAttribLocation(o,"uv")},u={renderType:h.getUniformLocation(o,"renderType"),map:h.getUniformLocation(o,"map"),occlusionMap:h.getUniformLocation(o,"occlusionMap"),opacity:h.getUniformLocation(o,"opacity"),color:h.getUniformLocation(o,"color"),scale:h.getUniformLocation(o,"scale"),rotation:h.getUniformLocation(o,"rotation"),screenPosition:h.getUniformLocation(o,"screenPosition")}}function r(e){var n=h.createProgram(),r=h.createShader(h.FRAGMENT_SHADER),i=h.createShader(h.VERTEX_SHADER),a="precision "+t.getPrecision()+" float;\n";return h.shaderSource(r,a+e.fragmentShader),h.shaderSource(i,a+e.vertexShader),h.compileShader(r),h.compileShader(i),h.attachShader(n,r),h.attachShader(n,i),h.linkProgram(n),n}var i,a,o,s,u,l,c,d,h=t.context,f=t.state;this.render=function(r,m,g){if(0!==e.length){var v=new p.Vector3,y=g.w/g.z,_=.5*g.z,b=.5*g.w,E=16/g.w,w=new p.Vector2(E*y,E),A=new p.Vector3(1,1,0),S=new p.Vector2(1,1);void 0===o&&n(),h.useProgram(o),f.initAttributes(),f.enableAttribute(s.vertex),f.enableAttribute(s.uv),f.disableUnusedAttributes(),h.uniform1i(u.occlusionMap,0),h.uniform1i(u.map,1),h.bindBuffer(h.ARRAY_BUFFER,i),h.vertexAttribPointer(s.vertex,2,h.FLOAT,!1,16,0),h.vertexAttribPointer(s.uv,2,h.FLOAT,!1,16,8),h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,a),f.disable(h.CULL_FACE),f.setDepthWrite(!1);for(var T=0,x=e.length;T<x;T++){E=16/g.w,w.set(E*y,E);var k=e[T];if(v.set(k.matrixWorld.elements[12],k.matrixWorld.elements[13],k.matrixWorld.elements[14]),v.applyMatrix4(m.matrixWorldInverse),v.applyProjection(m.projectionMatrix),A.copy(v),S.x=A.x*_+_,S.y=A.y*b+b,l||S.x>0&&S.x<g.z&&S.y>0&&S.y<g.w){f.activeTexture(h.TEXTURE0),f.bindTexture(h.TEXTURE_2D,null),f.activeTexture(h.TEXTURE1),f.bindTexture(h.TEXTURE_2D,c),h.copyTexImage2D(h.TEXTURE_2D,0,h.RGB,g.x+S.x-8,g.y+S.y-8,16,16,0),h.uniform1i(u.renderType,0),h.uniform2f(u.scale,w.x,w.y),h.uniform3f(u.screenPosition,A.x,A.y,A.z),f.disable(h.BLEND),f.enable(h.DEPTH_TEST),h.drawElements(h.TRIANGLES,6,h.UNSIGNED_SHORT,0),f.activeTexture(h.TEXTURE0),f.bindTexture(h.TEXTURE_2D,d),h.copyTexImage2D(h.TEXTURE_2D,0,h.RGBA,g.x+S.x-8,g.y+S.y-8,16,16,0),h.uniform1i(u.renderType,1),f.disable(h.DEPTH_TEST),f.activeTexture(h.TEXTURE1),f.bindTexture(h.TEXTURE_2D,c),h.drawElements(h.TRIANGLES,6,h.UNSIGNED_SHORT,0),k.positionScreen.copy(A),k.customUpdateCallback?k.customUpdateCallback(k):k.updateLensFlares(),h.uniform1i(u.renderType,2),f.enable(h.BLEND);for(var C=0,M=k.lensFlares.length;C<M;C++){var R=k.lensFlares[C];R.opacity>.001&&R.scale>.001&&(A.x=R.x,A.y=R.y,A.z=R.z,E=R.size*R.scale/g.w,w.x=E*y,w.y=E,h.uniform3f(u.screenPosition,A.x,A.y,A.z),h.uniform2f(u.scale,w.x,w.y),h.uniform1f(u.rotation,R.rotation),h.uniform1f(u.opacity,R.opacity),h.uniform3f(u.color,R.color.r,R.color.g,R.color.b),f.setBlending(R.blending,R.blendEquation,R.blendSrc,R.blendDst),t.setTexture(R.texture,1),h.drawElements(h.TRIANGLES,6,h.UNSIGNED_SHORT,0))}}}f.enable(h.CULL_FACE),f.enable(h.DEPTH_TEST),f.setDepthWrite(!0),t.resetGLState()}}},p.WebGLObjects=function(t,e,n){function r(e){var n=c.get(e);e.geometry instanceof p.Geometry&&n.updateFromObject(e);var r=n.index,a=n.attributes;null!==r&&i(r,t.ELEMENT_ARRAY_BUFFER);for(var o in a)i(a[o],t.ARRAY_BUFFER);var s=n.morphAttributes;for(var o in s)for(var u=s[o],l=0,d=u.length;l<d;l++)i(u[l],t.ARRAY_BUFFER);return n}function i(t,n){var r=t instanceof p.InterleavedBufferAttribute?t.data:t,i=e.get(r);void 0===i.__webglBuffer?a(i,r,n):i.version!==r.version&&o(i,r,n)}function a(e,n,r){e.__webglBuffer=t.createBuffer(),t.bindBuffer(r,e.__webglBuffer);var i=n.dynamic?t.DYNAMIC_DRAW:t.STATIC_DRAW;t.bufferData(r,n.array,i),e.version=n.version}function o(e,n,r){t.bindBuffer(r,e.__webglBuffer),!1===n.dynamic||-1===n.updateRange.count?t.bufferSubData(r,0,n.array):0===n.updateRange.count||(t.bufferSubData(r,n.updateRange.offset*n.array.BYTES_PER_ELEMENT,n.array.subarray(n.updateRange.offset,n.updateRange.offset+n.updateRange.count)),n.updateRange.count=0),e.version=n.version}function s(t){return t instanceof p.InterleavedBufferAttribute?e.get(t.data).__webglBuffer:e.get(t).__webglBuffer}function u(n){var r=e.get(n);if(void 0!==r.wireframe)return r.wireframe;var a=[],o=n.index,s=n.attributes,u=s.position;if(null!==o)for(var c={},d=o.array,h=0,f=d.length;h<f;h+=3){var m=d[h+0],g=d[h+1],v=d[h+2];l(c,m,g)&&a.push(m,g),l(c,g,v)&&a.push(g,v),l(c,v,m)&&a.push(v,m)}else for(var d=s.position.array,h=0,f=d.length/3-1;h<f;h+=3){var m=h+0,g=h+1,v=h+2;a.push(m,g,g,v,v,m)}var y=u.count>65535?Uint32Array:Uint16Array,_=new p.BufferAttribute(new y(a),1);return i(_,t.ELEMENT_ARRAY_BUFFER),r.wireframe=_,_}function l(t,e,n){if(e>n){var r=e;e=n,n=r}var i=t[e];return void 0===i?(t[e]=[n],!0):-1===i.indexOf(n)&&(i.push(n),!0)}var c=new p.WebGLGeometries(t,e,n);this.getAttributeBuffer=s,this.getWireframeAttribute=u,this.update=r},p.WebGLProgram=function(){function t(t){switch(t){case p.LinearEncoding:return["Linear","( value )"];case p.sRGBEncoding:return["sRGB","( value )"];case p.RGBEEncoding:return["RGBE","( value )"];case p.RGBM7Encoding:return["RGBM","( value, 7.0 )"];case p.RGBM16Encoding:return["RGBM","( value, 16.0 )"];case p.RGBDEncoding:return["RGBD","( value, 256.0 )"];case p.GammaEncoding:return["Gamma","( value, float( GAMMA_FACTOR ) )"];default:throw new Error("unsupported encoding: "+t)}}function e(e,n){var r=t(n);return"vec4 "+e+"( vec4 value ) { return "+r[0]+"ToLinear"+r[1]+"; }"}function n(e,n){var r=t(n);return"vec4 "+e+"( vec4 value ) { return LinearTo"+r[0]+r[1]+"; }"}function r(t,e){var n;switch(e){case p.LinearToneMapping:n="Linear";break;case p.ReinhardToneMapping:n="Reinhard";break;case p.Uncharted2ToneMapping:n="Uncharted2";break;case p.CineonToneMapping:n="OptimizedCineon";break;default:throw new Error("unsupported toneMapping: "+e)}return"vec3 "+t+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}function i(t,e,n){return t=t||{},[t.derivatives||e.envMapCubeUV||e.bumpMap||e.normalMap||e.flatShading?"#extension GL_OES_standard_derivatives : enable":"",(t.fragDepth||e.logarithmicDepthBuffer)&&n.get("EXT_frag_depth")?"#extension GL_EXT_frag_depth : enable":"",t.drawBuffers&&n.get("WEBGL_draw_buffers")?"#extension GL_EXT_draw_buffers : require":"",(t.shaderTextureLOD||e.envMap)&&n.get("EXT_shader_texture_lod")?"#extension GL_EXT_shader_texture_lod : enable":""].filter(u).join("\n")}function a(t){var e=[];for(var n in t){var r=t[n];!1!==r&&e.push("#define "+n+" "+r)}return e.join("\n")}function o(t,e,n){for(var r={},i=t.getProgramParameter(e,t.ACTIVE_UNIFORMS),a=0;a<i;a++){var o=t.getActiveUniform(e,a),s=o.name,u=t.getUniformLocation(e,s),l=f.exec(s);if(l){var c=l[1],d=l[2],h=r[c];h||(h=r[c]={}),h[d]=u}else if(l=m.exec(s)){var p=l[1],v=l[2],y=l[3],_=r[p];_||(_=r[p]=[]);var b=_[v];b||(b=_[v]={}),b[y]=u}else if(l=g.exec(s)){var p=l[1];r[p]=u}else r[s]=u}return r}function s(t,e,n){for(var r={},i=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES),a=0;a<i;a++){var o=t.getActiveAttrib(e,a),s=o.name;r[s]=t.getAttribLocation(e,s)}return r}function u(t){return""!==t}function l(t,e){return t.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights)}function c(t){function e(t,e){var n=p.ShaderChunk[e];if(void 0===n)throw new Error("Can not resolve #include <"+e+">");return c(n)}var n=/#include +<([\w\d.]+)>/g;return t.replace(n,e)}function d(t){function e(t,e,n,r){for(var i="",a=parseInt(e);a<parseInt(n);a++)i+=r.replace(/\[ i \]/g,"[ "+a+" ]");return i}var n=/for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g;return t.replace(n,e)}var h=0,f=/^([\w\d_]+)\.([\w\d_]+)$/,m=/^([\w\d_]+)\[(\d+)\]\.([\w\d_]+)$/,g=/^([\w\d_]+)\[0\]$/;return function(t,f,m,g){var v=t.context,y=m.extensions,_=m.defines,b=m.__webglShader.vertexShader,E=m.__webglShader.fragmentShader,w="SHADOWMAP_TYPE_BASIC";g.shadowMapType===p.PCFShadowMap?w="SHADOWMAP_TYPE_PCF":g.shadowMapType===p.PCFSoftShadowMap&&(w="SHADOWMAP_TYPE_PCF_SOFT");var A="ENVMAP_TYPE_CUBE",S="ENVMAP_MODE_REFLECTION",T="ENVMAP_BLENDING_MULTIPLY";if(g.envMap){switch(m.envMap.mapping){case p.CubeReflectionMapping:case p.CubeRefractionMapping:A="ENVMAP_TYPE_CUBE";break;case p.CubeUVReflectionMapping:case p.CubeUVRefractionMapping:A="ENVMAP_TYPE_CUBE_UV";break;case p.EquirectangularReflectionMapping:case p.EquirectangularRefractionMapping:A="ENVMAP_TYPE_EQUIREC";break;case p.SphericalReflectionMapping:A="ENVMAP_TYPE_SPHERE"}switch(m.envMap.mapping){case p.CubeRefractionMapping:case p.EquirectangularRefractionMapping:S="ENVMAP_MODE_REFRACTION"}switch(m.combine){case p.MultiplyOperation:T="ENVMAP_BLENDING_MULTIPLY";break;case p.MixOperation:T="ENVMAP_BLENDING_MIX";break;case p.AddOperation:T="ENVMAP_BLENDING_ADD"}}var x,k,C=t.gammaFactor>0?t.gammaFactor:1,M=i(y,g,t.extensions),R=a(_),L=v.createProgram();m instanceof p.RawShaderMaterial?(x="",k=""):(x=["precision "+g.precision+" float;","precision "+g.precision+" int;","#define SHADER_NAME "+m.__webglShader.name,R,g.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+C,"#define MAX_BONES "+g.maxBones,g.map?"#define USE_MAP":"",g.envMap?"#define USE_ENVMAP":"",g.envMap?"#define "+S:"",g.lightMap?"#define USE_LIGHTMAP":"",g.aoMap?"#define USE_AOMAP":"",g.emissiveMap?"#define USE_EMISSIVEMAP":"",g.bumpMap?"#define USE_BUMPMAP":"",g.normalMap?"#define USE_NORMALMAP":"",g.displacementMap&&g.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",g.specularMap?"#define USE_SPECULARMAP":"",g.roughnessMap?"#define USE_ROUGHNESSMAP":"",g.metalnessMap?"#define USE_METALNESSMAP":"",g.alphaMap?"#define USE_ALPHAMAP":"",g.vertexColors?"#define USE_COLOR":"",g.flatShading?"#define FLAT_SHADED":"",g.skinning?"#define USE_SKINNING":"",g.useVertexTexture?"#define BONE_TEXTURE":"",g.morphTargets?"#define USE_MORPHTARGETS":"",g.morphNormals&&!1===g.flatShading?"#define USE_MORPHNORMALS":"",g.doubleSided?"#define DOUBLE_SIDED":"",g.flipSided?"#define FLIP_SIDED":"",g.shadowMapEnabled?"#define USE_SHADOWMAP":"",g.shadowMapEnabled?"#define "+w:"",g.pointLightShadows>0?"#define POINT_LIGHT_SHADOWS":"",g.sizeAttenuation?"#define USE_SIZEATTENUATION":"",g.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",g.logarithmicDepthBuffer&&t.extensions.get("EXT_frag_depth")?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(u).join("\n"),k=[M,"precision "+g.precision+" float;","precision "+g.precision+" int;","#define SHADER_NAME "+m.__webglShader.name,R,g.alphaTest?"#define ALPHATEST "+g.alphaTest:"","#define GAMMA_FACTOR "+C,g.useFog&&g.fog?"#define USE_FOG":"",g.useFog&&g.fogExp?"#define FOG_EXP2":"",g.map?"#define USE_MAP":"",g.envMap?"#define USE_ENVMAP":"",g.envMap?"#define "+A:"",g.envMap?"#define "+S:"",g.envMap?"#define "+T:"",g.lightMap?"#define USE_LIGHTMAP":"",g.aoMap?"#define USE_AOMAP":"",g.emissiveMap?"#define USE_EMISSIVEMAP":"",g.bumpMap?"#define USE_BUMPMAP":"",g.normalMap?"#define USE_NORMALMAP":"",g.specularMap?"#define USE_SPECULARMAP":"",g.roughnessMap?"#define USE_ROUGHNESSMAP":"",g.metalnessMap?"#define USE_METALNESSMAP":"",g.alphaMap?"#define USE_ALPHAMAP":"",g.vertexColors?"#define USE_COLOR":"",g.flatShading?"#define FLAT_SHADED":"",g.doubleSided?"#define DOUBLE_SIDED":"",g.flipSided?"#define FLIP_SIDED":"",g.shadowMapEnabled?"#define USE_SHADOWMAP":"",g.shadowMapEnabled?"#define "+w:"",g.pointLightShadows>0?"#define POINT_LIGHT_SHADOWS":"",g.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",g.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",g.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",g.logarithmicDepthBuffer&&t.extensions.get("EXT_frag_depth")?"#define USE_LOGDEPTHBUF_EXT":"",g.envMap&&t.extensions.get("EXT_shader_texture_lod")?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;",g.toneMapping!==p.NoToneMapping?"#define TONE_MAPPING":"",g.toneMapping!==p.NoToneMapping?p.ShaderChunk["tonemapping_pars_fragment"]:"",g.toneMapping!==p.NoToneMapping?r("toneMapping",g.toneMapping):"",g.outputEncoding||g.mapEncoding||g.envMapEncoding||g.emissiveMapEncoding?p.ShaderChunk["encodings_pars_fragment"]:"",g.mapEncoding?e("mapTexelToLinear",g.mapEncoding):"",g.envMapEncoding?e("envMapTexelToLinear",g.envMapEncoding):"",g.emissiveMapEncoding?e("emissiveMapTexelToLinear",g.emissiveMapEncoding):"",g.outputEncoding?n("linearToOutputTexel",g.outputEncoding):"","\n"].filter(u).join("\n")),b=c(b,g),b=l(b,g),E=c(E,g),E=l(E,g),m instanceof p.ShaderMaterial==!1&&(b=d(b),E=d(E));var I=x+b,P=k+E,O=p.WebGLShader(v,v.VERTEX_SHADER,I),D=p.WebGLShader(v,v.FRAGMENT_SHADER,P);v.attachShader(L,O),v.attachShader(L,D),void 0!==m.index0AttributeName?v.bindAttribLocation(L,0,m.index0AttributeName):!0===g.morphTargets&&v.bindAttribLocation(L,0,"position"),v.linkProgram(L);var N=v.getProgramInfoLog(L),U=v.getShaderInfoLog(O),F=v.getShaderInfoLog(D),B=!0,j=!0;!1===v.getProgramParameter(L,v.LINK_STATUS)?B=!1:""!==N||""!==U&&""!==F||(j=!1),j&&(this.diagnostics={runnable:B,material:m,programLog:N,vertexShader:{log:U,prefix:x},fragmentShader:{log:F,prefix:k}}),v.deleteShader(O),v.deleteShader(D);var V;this.getUniforms=function(){return void 0===V&&(V=o(v,L)),V};var G;return this.getAttributes=function(){return void 0===G&&(G=s(v,L)),G},this.destroy=function(){v.deleteProgram(L),this.program=void 0},Object.defineProperties(this,{uniforms:{get:function(){return this.getUniforms()}},attributes:{get:function(){return this.getAttributes()}}}),this.id=h++,this.code=f,this.usedTimes=1,this.program=L,this.vertexShader=O,this.fragmentShader=D,this}}(),p.WebGLRenderTarget=function(t,e,n){this.uuid=p.Math.generateUUID(),this.width=t,this.height=e,this.scissor=new p.Vector4(0,0,t,e),this.scissorTest=!1,this.viewport=new p.Vector4(0,0,t,e),n=n||{},void 0===n.minFilter&&(n.minFilter=p.LinearFilter),this.texture=new p.Texture(void 0,void 0,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy),this.depthBuffer=void 0===n.depthBuffer||n.depthBuffer,this.stencilBuffer=void 0===n.stencilBuffer||n.stencilBuffer},p.WebGLRenderTarget.prototype={constructor:p.WebGLRenderTarget,setSize:function(t,e){this.width===t&&this.height===e||(this.width=t,this.height=e,this.dispose()),this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e)},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.width=t.width,this.height=t.height,this.viewport.copy(t.viewport),this.texture=t.texture.clone(),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,this},dispose:function(){this.dispatchEvent({type:"dispose"})}},p.EventDispatcher.prototype.apply(p.WebGLRenderTarget.prototype),p.WebGLRenderTargetCube=function(t,e,n){p.WebGLRenderTarget.call(this,t,e,n),this.activeCubeFace=0,this.activeMipMapLevel=0},p.WebGLRenderTargetCube.prototype=Object.create(p.WebGLRenderTarget.prototype),p.WebGLRenderTargetCube.prototype.constructor=p.WebGLRenderTargetCube,p.WebGLPrograms=function(t,e){function n(t){if(e.floatVertexTextures&&t&&t.skeleton&&t.skeleton.useVertexTexture)return 1024;var n=e.maxVertexUniforms,r=Math.floor((n-20)/4),i=r;return void 0!==t&&t instanceof p.SkinnedMesh&&(i=Math.min(t.skeleton.bones.length,i),t.skeleton.bones.length),i}function r(t,e){var n;return t?t instanceof p.Texture?n=t.encoding:t instanceof p.WebGLRenderTarget&&(n=t.texture.encoding):n=p.LinearEncoding,n===p.LinearEncoding&&e&&(n=p.GammaEncoding),n}var i=[],a={MeshDepthMaterial:"depth",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshStandardMaterial:"standard",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points"},o=["precision","supportsVertexTextures","map","mapEncoding","envMap","envMapMode","envMapEncoding","lightMap","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","displacementMap","specularMap","roughnessMap","metalnessMap","alphaMap","combine","vertexColors","fog","useFog","fogExp","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","shadowMapEnabled","pointLightShadows","toneMapping","physicallyCorrectLights","shadowMapType","alphaTest","doubleSided","flipSided"];this.getParameters=function(i,o,s,u){var l=a[i.type],c=n(u),d=t.getPrecision();return null!==i.precision&&(d=e.getMaxPrecision(i.precision),i.precision),{shaderID:l,precision:d,supportsVertexTextures:e.vertexTextures,outputEncoding:r(t.getCurrentRenderTarget(),t.gammaOutput),map:!!i.map,mapEncoding:r(i.map,t.gammaInput),envMap:!!i.envMap,envMapMode:i.envMap&&i.envMap.mapping,envMapEncoding:r(i.envMap,t.gammaInput),envMapCubeUV:!!i.envMap&&(i.envMap.mapping===p.CubeUVReflectionMapping||i.envMap.mapping===p.CubeUVRefractionMapping),lightMap:!!i.lightMap,aoMap:!!i.aoMap,emissiveMap:!!i.emissiveMap,emissiveMapEncoding:r(i.emissiveMap,t.gammaInput),bumpMap:!!i.bumpMap,normalMap:!!i.normalMap,displacementMap:!!i.displacementMap,roughnessMap:!!i.roughnessMap,metalnessMap:!!i.metalnessMap,specularMap:!!i.specularMap,alphaMap:!!i.alphaMap,combine:i.combine,vertexColors:i.vertexColors,fog:s,useFog:i.fog,fogExp:s instanceof p.FogExp2,flatShading:i.shading===p.FlatShading,sizeAttenuation:i.sizeAttenuation,logarithmicDepthBuffer:e.logarithmicDepthBuffer,skinning:i.skinning,maxBones:c,useVertexTexture:e.floatVertexTextures&&u&&u.skeleton&&u.skeleton.useVertexTexture,morphTargets:i.morphTargets,morphNormals:i.morphNormals,maxMorphTargets:t.maxMorphTargets,maxMorphNormals:t.maxMorphNormals,numDirLights:o.directional.length,numPointLights:o.point.length,numSpotLights:o.spot.length,numHemiLights:o.hemi.length,pointLightShadows:o.shadowsPointLight,shadowMapEnabled:t.shadowMap.enabled&&u.receiveShadow&&o.shadows.length>0,shadowMapType:t.shadowMap.type,toneMapping:t.toneMapping,physicallyCorrectLights:t.physicallyCorrectLights,premultipliedAlpha:i.premultipliedAlpha,alphaTest:i.alphaTest,doubleSided:i.side===p.DoubleSide,flipSided:i.side===p.BackSide}},this.getProgramCode=function(t,e){var n=[];if(e.shaderID?n.push(e.shaderID):(n.push(t.fragmentShader),n.push(t.vertexShader)),void 0!==t.defines)for(var r in t.defines)n.push(r),n.push(t.defines[r]);for(var i=0;i<o.length;i++){var a=o[i];n.push(a),n.push(e[a])}return n.join()},this.acquireProgram=function(e,n,r){for(var a,o=0,s=i.length;o<s;o++){var u=i[o];if(u.code===r){a=u,++a.usedTimes;break}}return void 0===a&&(a=new p.WebGLProgram(t,r,e,n),i.push(a)),a},this.releaseProgram=function(t){if(0==--t.usedTimes){var e=i.indexOf(t);i[e]=i[i.length-1],i.pop(),t.destroy()}},this.programs=i};var g=function(){function t(e){r(this,t),Object.assign(this,e),this.renderer=new m.WebGLRenderer,this.renderer.setClearColor(0,0),this.renderer.setSize(this.width,this.height),this.renderer.setPixelRatio(window.devicePixelRatio),this.el=this.renderer.domElement}return a(t,[{key:"setTexture",value:function(t){this.texture=t,this.mesh=this.createMesh()}},{key:"setSize",value:function(t){var e=t.height,n=t.width;this.height=e,this.width=n,this.renderer.setSize(n,e)}},{key:"createMesh",value:function(){return this.material=new m.MeshBasicMaterial({map:this.texture}),this.geometry=new m.SphereGeometry(1,50,50),this.geometry.scale(-1,1,1),new m.Mesh(this.geometry,this.material)}},{key:"destroy",value:function(){this.geometry.dispose(),this.material.dispose(),this.renderer.dispose()}},{key:"render",value:function(t,e,n){n&&this.renderer.render(t,e)}}]),t}(),v=function(t){var e=1.70158;return--t*t*((e+1)*t+e)+1},y=function(){function t(e){var n=this;r(this,t),Object.assign(this,e),this.el=this.renderer.el,this.theta=this.initialYaw*Math.PI/180,this.phi=0,this.velo=.02,this.rotateStart=new m.Vector2,this.rotateEnd=new m.Vector2,this.rotateDelta=new m.Vector2,this.orientation=new m.Quaternion,this.euler=new m.Euler,this.momentum=!1,this.isUserInteracting=!1,this.addDraggableStyle(),this.onMouseMove=this.onMouseMove.bind(this),this.onMouseDown=this.onMouseDown.bind(this),this.onMouseUp=this.onMouseUp.bind(this),this.onTouchStart=function(t){return n.onMouseDown({clientX:t.touches[0].pageX,clientY:t.touches[0].pageY})},this.onTouchMove=function(t){return n.onMouseMove({clientX:t.touches[0].pageX,clientY:t.touches[0].pageY})},this.onTouchEnd=function(t){return n.onMouseUp()},this.onDeviceMotion=this.onDeviceMotion.bind(this),this.onMessage=this.onMessage.bind(this),this.bindEvents()}return a(t,[{key:"bindEvents",value:function(){this.el.addEventListener("mouseleave",this.onMouseUp),this.el.addEventListener("mousemove",this.onMouseMove),this.el.addEventListener("mousedown",this.onMouseDown),this.el.addEventListener("mouseup",this.onMouseUp),this.el.addEventListener("touchstart",this.onTouchStart),this.el.addEventListener("touchmove",this.onTouchMove),this.el.addEventListener("touchend",this.onTouchEnd),this.isInIframe()||window.addEventListener("devicemotion",this.onDeviceMotion),window.addEventListener("message",this.onMessage)}},{key:"centralize",value:function(){var t=this,e=this.initialYaw*Math.PI/180,n=this.theta,r=this.phi,i=Date.now(),a=function o(){var s=Date.now()-i,u=s/750;return u=u>1?1:u,s>=750?cancelAnimationFrame(a):(t.theta=n+(e-n)*v(u),t.phi=r+(0-r)*v(u),requestAnimationFrame(o))}()}},{key:"isInIframe",value:function(){try{return window.self!==window.top}catch(t){return!0}}},{key:"destroy",value:function(){this.el.removeEventListener("mouseleave",this.onMouseUp),this.el.removeEventListener("mousemove",this.onMouseMove),this.el.removeEventListener("mousedown",this.onMouseDown),this.el.removeEventListener("mouseup",this.onMouseUp),this.el.removeEventListener("touchstart",this.onTouchStart),this.el.removeEventListener("touchmove",this.onTouchMove),this.el.removeEventListener("touchend",this.onTouchEnd),window.removeEventListener("devicemotion",this.onDeviceMotion),window.removeEventListener("message",this.onMessage)}},{key:"getCurrentStyle",value:function(){return"height: ".concat(parseInt(this.el.style.height,10),"px; width: ").concat(parseInt(this.el.style.width,10),"px; user-select: none; -webkit-user-select: none; -webkit-touch-callout: none; -webkit-tap-highlight-color: rgba(0,0,0,0);")}},{key:"addDraggingStyle",value:function(){this.el.setAttribute("style","".concat(this.getCurrentStyle()," cursor: -webkit-grabbing; cursor: -moz-grabbing; cursor: grabbing;"))}},{key:"addDraggableStyle",value:function(){this.el.setAttribute("style","".concat(this.getCurrentStyle()," cursor: -webkit-grab; cursor: -moz-grab; cursor: grab;"))}},{key:"onMessage",value:function(t){var e=t.data,n=e.orientation,r=e.portrait,i=e.rotationRate;i&&this.onDeviceMotion({orientation:n,portrait:r,rotationRate:i})}},{key:"onDeviceMotion",value:function(t){var e,n=void 0!==t.portrait?t.portrait:window.matchMedia("(orientation: portrait)").matches;e=void 0!==t.orientation?t.orientation:void 0!==window.orientation?window.orientation:-90;var r=m.Math.degToRad(t.rotationRate.alpha),i=m.Math.degToRad(t.rotationRate.beta);n?(this.phi=this.verticalPanning?this.phi+r*this.velo:this.phi,this.theta=this.theta-i*this.velo*-1):(this.verticalPanning&&(this.phi=-90===e?this.phi+i*this.velo:this.phi-i*this.velo),this.theta=-90===e?this.theta-r*this.velo:this.theta+r*this.velo),this.adjustPhi()}},{key:"onMouseMove",value:function(t){this.isUserInteracting&&(this.rotateEnd.set(t.clientX,t.clientY),this.rotateDelta.subVectors(this.rotateEnd,this.rotateStart),this.rotateStart.copy(this.rotateEnd),this.phi=this.verticalPanning?this.phi+2*Math.PI*this.rotateDelta.y/this.renderer.height*.3:this.phi,this.theta+=2*Math.PI*this.rotateDelta.x/this.renderer.width*.5,this.adjustPhi())}},{key:"adjustPhi",value:function(){this.phi=m.Math.clamp(this.phi,-Math.PI/1.95,Math.PI/1.95)}},{key:"onMouseDown",value:function(t){this.addDraggingStyle(),this.rotateStart.set(t.clientX,t.clientY),this.isUserInteracting=!0,this.momentum=!1,this.onDragStart&&this.onDragStart()}},{key:"inertia",value:function(){this.momentum&&(this.rotateDelta.y*=.9,this.rotateDelta.x*=.9,this.theta+=.005*this.rotateDelta.x,this.phi=this.verticalPanning?this.phi+.005*this.rotateDelta.y:this.phi,this.adjustPhi())}},{key:"onMouseUp",value:function(){this.isUserInteracting&&this.onDragStop&&this.onDragStop(),this.addDraggableStyle(),this.isUserInteracting=!1,this.momentum=!0,this.inertia()}},{key:"update",value:function(){return(this.phi!==this.previousPhi||this.theta!==this.previousTheta)&&(this.previousPhi=this.phi,this.previousTheta=this.theta,this.euler.set(this.phi,this.theta,0,"YXZ"),this.orientation.setFromEuler(this.euler),this.camera.quaternion.copy(this.orientation),this.inertia(),!0)}}]),t}(),_=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};r(this,t),Object.assign(this,{height:360,width:640,initialYaw:90,verticalPanning:!0},e);var n=this.height,i=this.width,a=(this.container,this.containerId,this.initialYaw),o=this.verticalPanning,s=this.onDragStart,u=this.onDragStop;this.renderer=new g({height:n,width:i}),this.camera=new m.PerspectiveCamera(80,this.width/this.height,.1,100),this.controls=new y({camera:this.camera,renderer:this.renderer,initialYaw:a,verticalPanning:o,onDragStart:s,onDragStop:u}),this.stopVideoLoop=this.stopVideoLoop.bind(this),this.onError=this.onError.bind(this),this.startVideoLoop=this.startVideoLoop.bind(this),this.needsUpdate=!1,this.scene=this.createScene(),this.scene.add(this.camera),this.element=this.getElement(),this.element.addEventListener("playing",this.startVideoLoop),this.element.addEventListener("pause",this.stopVideoLoop),this.element.addEventListener("ended",this.stopVideoLoop),this.texture=this.createTexture(),this.renderer.setTexture(this.texture),this.scene.getObjectByName("photo").children=[this.renderer.mesh],this.target=this.container?this.container:document.querySelector(this.containerId)}return a(t,[{key:"play",value:function(){this.element.play&&this.element.play()}},{key:"pause",value:function(){this.element.pause&&this.element.pause()}},{key:"centralize",value:function(){this.controls.centralize()}},{key:"stopVideoLoop",value:function(){clearTimeout(this.videoLoopId),this.videoLoopId=null,this.needsUpdate=!1}},{key:"destroy",value:function(){this.element.style.display="",clearTimeout(this.videoLoopId),cancelAnimationFrame(this.animationFrameId),this.element.pause&&this.element.pause(),this.target.removeChild(this.renderer.el),this.controls.destroy(),this.renderer.destroy()}},{key:"setSize",value:function(t){var e=t.height,n=t.width;this.camera.aspect=n/e,this.camera.updateProjectionMatrix(),this.renderer.setSize({height:e,width:n})}},{key:"getElement",value:function(){if(this.source&&this.source.tagName)return this.source;var t=document.createElement("video");return t.loop=this.loop||!1,t.muted=this.muted||!1,t.setAttribute("crossorigin","anonymous"),t.setAttribute("webkit-playsinline","true"),t.setAttribute("playsinline","true"),t.setAttribute("src",this.source),t.autoplay=void 0===this.autoplay||this.autoplay,t.addEventListener("error",this.onError),t}},{key:"createTexture",value:function(){var t=new m.Texture(this.element);return t.minFilter=m.LinearFilter,t.magFilter=m.LinearFilter,t.format=m.RGBFormat,t.generateMipmaps=!1,t.needsUpdate=!0,t}},{key:"createScene",value:function(){var t=new m.Scene,e=new m.Object3D;return e.name="photo",t.add(e),t}},{key:"onError",value:function(t){}},{key:"startVideoLoop",value:function(){var t=this;this.videoLoopId&&(clearTimeout(this.videoLoopId),this.videoLoopId=null);!function e(){t.needsUpdate=!0,t.videoLoopId=setTimeout(e,40)}()}},{key:"render",value:function(){var t=this;this.target.appendChild(this.renderer.el),this.element.style.display="none";this.startVideoLoop(),function e(){t.animationFrameId=requestAnimationFrame(e);var n=t.controls.update();t.renderer.render(t.scene,t.camera,t.needsUpdate||n),t.needsUpdate=!1}()}}]),t}(),b=function(t){function e(t){return r(this,e),c(this,s(e).call(this,t))}return o(e,t),a(e,[{key:"createTexture",value:function(){var t=new m.VideoTexture(this.element);return t.minFilter=m.LinearFilter,t.magFilter=m.LinearFilter,t.format=m.RGBFormat,t.generateMipmaps=!1,t.needsUpdate=!0,t}}]),e}(_),E=function(t){function e(t){return r(this,e),c(this,s(e).call(this,t))}return o(e,t),a(e,[{key:"getElement",value:function(){if(this.source&&this.source.tagName)return this.source;var t=document.createElement("img");return t.setAttribute("crossorigin","anonymous"),t.src=this.source,t}}]),e}(_),w=function(t){function e(t){var n;return r(this,e),n=c(this,s(e).call(this,t)),n.context=n.element.getContext("2d"),n}return o(e,t),a(e,[{key:"play",value:function(){this.video.play&&this.video.play()}},{key:"pause",value:function(){this.video.pause&&this.video.pause()}},{key:"destroy",value:function(){this.video.style.display="",h(s(e.prototype),"destroy",this).call(this)}},{key:"getElement",value:function(){this.video=h(s(e.prototype),"getElement",this).call(this),this.video.addEventListener("playing",this.startVideoLoop),this.video.addEventListener("pause",this.stopVideoLoop),this.video.addEventListener("ended",this.stopVideoLoop);var t=document.createElement("canvas");return t.height=this.video.videoHeight,t.width=this.video.videoWidth,t}},{key:"render",value:function(){var t=this;this.target.appendChild(this.renderer.el),this.video.style.display="none";this.startVideoLoop(),function e(){t.animationFrameId=requestAnimationFrame(e);var n=t.video.videoHeight,r=t.video.videoWidth;t.element.height!=n&&(t.element.height=n),t.element.width!=r&&(t.element.width=r),t.context.clearRect(0,0,r,n),t.context.drawImage(t.video,0,0,r,n);var i=t.controls.update();t.renderer.render(t.scene,t.camera,t.needsUpdate||i),t.renderer.mesh.material.map.needsUpdate=!0,t.needsUpdate=!1}()}}]),e}(_),A=function(t){function e(t){var n;return r(this,e),n=c(this,s(e).call(this,t)),n.driver.addEventListener("playing",n.startVideoLoop),n.driver.addEventListener("pause",n.stopVideoLoop),n.driver.addEventListener("ended",n.stopVideoLoop),n.driver.addEventListener("stalled",n.stopVideoLoop),n.driverInitialized=!1,n}return o(e,t),a(e,[{key:"play",value:function(){this.driver.play()}},{key:"pause",value:function(){this.driver.pause()}},{key:"getElement",value:function(){this.source&&this.source.tagName?this.driver=this.source:(this.driver=document.createElement("audio"),this.driver.src=this.source,this.driver.loop=this.loop||!1,this.driver.muted=this.muted||!1,this.driver.setAttribute("crossorigin","anonymous"),this.driver.autoplay=this.autoplay||!0),this.source=this.driver.src,this.driver.src="",this.driver.load();var t=document.createElement("video");return t.setAttribute("crossorigin","anonymous"),t.src=this.source,t.load(),t.addEventListener("error",this.onError),t}},{key:"createTexture",value:function(){var t=new m.VideoTexture(this.element);return t.minFilter=m.LinearFilter,t.magFilter=m.LinearFilter,t.format=m.RGBFormat,t.generateMipmaps=!1,t.needsUpdate=!0,t}},{key:"startVideoLoop",value:function(){var t=this;this.videoLoopId&&(clearTimeout(this.videoLoopId),this.videoLoopId=null);!function e(){t.element.currentTime=t.driver.currentTime,t.needsUpdate=!0,t.videoLoopId=setTimeout(e,40)}()}},{key:"destroy",value:function(){this.driver.style.display="",h(s(e.prototype),"destroy",this).call(this)}},{key:"render",value:function(){var t=this;this.target.appendChild(this.renderer.el),this.element.style.display="none",this.driver.style.display="none";!function e(){var n=t.controls.update();t.renderer.render(t.scene,t.camera,t.needsUpdate||n),t.needsUpdate=!1,t.animationFrameId=requestAnimationFrame(e),t.element.readyState>=t.element.HAVE_FUTURE_DATA&&!t.driverInitialized&&(t.driver.src=t.source,t.driver.load(),t.onDriverReady&&t.onDriverReady(),t.driverInitialized=!0)}()}}]),e}(_),S=function(t){return f.shouldUseAudioDriver()?new A(t):f.shouldUseCanvasInBetween()?new w(t):new b(t)}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(281),i=function(t){return t&&t.__esModule?t:{default:t}}(r);e.default=i.default,t.exports=e["default"]},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),u=n(3),l=r(u),c=n(2),d=r(c),h=n(15),f=r(h),p=n(10),m=r(p),g=n(13),v=r(g),y=n(6),_=r(y),b=n(4),E=r(b),w=n(282),A=r(w),S=n(283),T=r(S),x=function(t){function e(n){(0,a.default)(this,e);var r=(0,s.default)(this,t.call(this,n));return r.settingsUpdate(),r}return(0,d.default)(e,t),(0,l.default)(e,[{key:"template",get:function(){return(0,m.default)(T.default)}},{key:"name",get:function(){return"dvr_controls"}},{key:"events",get:function(){return{"click .live-button":"click"}}},{key:"attributes",get:function(){return{class:"dvr-controls","data-dvr-controls":""}}}]),e.prototype.bindEvents=function(){this.listenTo(this.core.mediaControl,E.default.MEDIACONTROL_CONTAINERCHANGED,this.containerChanged),this.listenTo(this.core.mediaControl,E.default.MEDIACONTROL_RENDERED,this.settingsUpdate),this.listenTo(this.core,E.default.CORE_OPTIONS_CHANGE,this.render),this.core.getCurrentContainer()&&(this.listenToOnce(this.core.getCurrentContainer(),E.default.CONTAINER_TIMEUPDATE,this.render),this.listenTo(this.core.getCurrentContainer(),E.default.CONTAINER_PLAYBACKDVRSTATECHANGED,this.dvrChanged))},e.prototype.containerChanged=function(){this.stopListening(),this.bindEvents()},e.prototype.dvrChanged=function(t){this.settingsUpdate(),this.core.mediaControl.$el.addClass("live"),t?(this.core.mediaControl.$el.addClass("dvr"),this.core.mediaControl.$el.find(".media-control-indicator[data-position], .media-control-indicator[data-duration]").hide()):this.core.mediaControl.$el.removeClass("dvr")},e.prototype.click=function(){var t=this.core.mediaControl,e=t.container;e.isPlaying()||e.play(),t.$el.hasClass("dvr")&&e.seek(e.getDuration())},e.prototype.settingsUpdate=function(){var t=this;this.stopListening(),this.shouldRender()&&(this.render(),this.$el.click(function(){return t.click()})),this.bindEvents()},e.prototype.shouldRender=function(){return(void 0===this.core.options.useDvrControls||!!this.core.options.useDvrControls)&&this.core.getPlaybackType()===v.default.LIVE},e.prototype.render=function(){return this.style=this.style||_.default.getStyleFor(A.default,{baseUrl:this.core.options.baseUrl}),this.$el.html(this.template({live:this.core.i18n.t(""),backToLive:this.core.i18n.t("")})),this.$el.append(this.style),this.shouldRender()&&(this.core.mediaControl.$el.addClass("live"),this.core.mediaControl.$(".media-control-left-panel[data-media-control]").append(this.$el)),this},e}(f.default);e.default=x,t.exports=e["default"]},function(t,e,n){e=t.exports=n(7)(!1),e.push([t.i,'.dvr-controls[data-dvr-controls]{display:inline-block;float:left;color:#fff;line-height:32px;font-size:10px;font-weight:400;margin-left:6px}.dvr-controls[data-dvr-controls] .live-info{cursor:default;font-family:Roboto,Open Sans,Arial,sans-serif;text-transform:uppercase}.dvr-controls[data-dvr-controls] .live-info:before{content:"";display:inline-block;position:relative;width:7px;height:7px;border-radius:3.5px;margin-right:3.5px;background-color:#ff0101}.dvr-controls[data-dvr-controls] .live-info.disabled{opacity:.3}.dvr-controls[data-dvr-controls] .live-info.disabled:before{background-color:#fff}.dvr-controls[data-dvr-controls] .live-button{cursor:pointer;outline:none;display:none;border:0;color:#fff;background-color:transparent;height:32px;padding:0;opacity:.7;font-family:Roboto,Open Sans,Arial,sans-serif;text-transform:uppercase;-webkit-transition:all .1s ease;-moz-transition:all .1s ease;transition:all .1s ease}.dvr-controls[data-dvr-controls] .live-button:before{content:"";display:inline-block;position:relative;width:7px;height:7px;border-radius:3.5px;margin-right:3.5px;background-color:#fff}.dvr-controls[data-dvr-controls] .live-button:hover{opacity:1;text-shadow:hsla(0,0%,100%,.75) 0 0 5px}.dvr .dvr-controls[data-dvr-controls] .live-info{display:none}.dvr .dvr-controls[data-dvr-controls] .live-button{display:block}.dvr.media-control.live[data-media-control] .media-control-layer[data-controls] .bar-container[data-seekbar] .bar-background[data-seekbar] .bar-fill-2[data-seekbar]{background-color:#005aff}.media-control.live[data-media-control] .media-control-layer[data-controls] .bar-container[data-seekbar] .bar-background[data-seekbar] .bar-fill-2[data-seekbar]{background-color:#ff0101}',""])},function(t,e){t.exports='<div class="live-info"><%= live %></div>\r\n<button type="button" class="live-button" aria-label="<%= backToLive %>"><%= backToLive %></button>\r\n'},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(285),i=function(t){return t&&t.__esModule?t:{default:t}}(r);e.default=i.default,t.exports=e["default"]},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),u=n(3),l=r(u),c=n(2),d=r(c),h=n(15),f=r(h),p=n(10),m=r(p),g=n(6),v=r(g),y=n(4),_=r(y),b=n(286),E=r(b),w=n(287),A=r(w),S=n(288),T=r(S),x=function(t){function e(n){(0,a.default)(this,e);var r=(0,s.default)(this,t.call(this,n)),i=n.options.closedCaptionsConfig;return r._title=i&&i.title?i.title:null,r._ariaLabel=i&&i.ariaLabel?i.ariaLabel:"cc-button",r._labelCb=i&&i.labelCallback&&"function"==typeof i.labelCallback?i.labelCallback:function(t){return t.name},r}return(0,d.default)(e,t),(0,l.default)(e,[{key:"name",get:function(){return"closed_captions"}},{key:"template",get:function(){return(0,m.default)(T.default)}},{key:"events",get:function(){return{"click [data-cc-button]":"toggleContextMenu","click [data-cc-select]":"onTrackSelect"}}},{key:"attributes",get:function(){return{class:"cc-controls","data-cc-controls":""}}}]),e.prototype.bindEvents=function(){this.listenTo(this.core.mediaControl,_.default.MEDIACONTROL_CONTAINERCHANGED,this.containerChanged),this.listenTo(this.core.mediaControl,_.default.MEDIACONTROL_RENDERED,this.render),this.listenTo(this.core.mediaControl,_.default.MEDIACONTROL_HIDE,this.hideContextMenu),this.container=this.core.getCurrentContainer(),this.container&&(this.listenTo(this.container,_.default.CONTAINER_SUBTITLE_AVAILABLE,this.onSubtitleAvailable),this.listenTo(this.container,_.default.CONTAINER_SUBTITLE_CHANGED,this.onSubtitleChanged),this.listenTo(this.container,_.default.CONTAINER_STOP,this.onContainerStop))},e.prototype.onContainerStop=function(){this.ccAvailable(!1)},e.prototype.containerChanged=function(){this.ccAvailable(!1),this.stopListening(),this.bindEvents()},e.prototype.onSubtitleAvailable=function(){this.renderCcButton(),this.ccAvailable(!0)},e.prototype.onSubtitleChanged=function(t){this.setCurrentContextMenuElement(t.id)},e.prototype.onTrackSelect=function(t){var e=parseInt(t.target.dataset.ccSelect,10);return this.container.closedCaptionsTrackId=e,this.hideContextMenu(),t.stopPropagation(),!1},e.prototype.ccAvailable=function(t){var e=t?"addClass":"removeClass";this.$el[e]("available")},e.prototype.toggleContextMenu=function(){this.$el.find("ul").toggle()},e.prototype.hideContextMenu=function(){this.$el.find("ul").hide()},e.prototype.contextMenuElement=function(t){return this.$el.find("ul a"+(isNaN(t)?"":'[data-cc-select="'+t+'"]')).parent()},e.prototype.setCurrentContextMenuElement=function(t){if(this._trackId!==t){this.contextMenuElement().removeClass("current"),this.contextMenuElement(t).addClass("current");var e=t>-1?"addClass":"removeClass";this.$ccButton[e]("enabled"),this._trackId=t}},e.prototype.renderCcButton=function(){for(var t=this.container?this.container.closedCaptionsTracks:[],e=0;e<t.length;e++)t[e].label=this._labelCb(t[e]);this.$el.html(this.template({ariaLabel:this._ariaLabel,disabledLabel:this.core.i18n.t("disabled"),title:this._title,tracks:t})),this.$ccButton=this.$el.find("button.cc-button[data-cc-button]"),this.$ccButton.append(E.default),this.$el.append(this.style)},e.prototype.render=function(){this.style||(this.style=v.default.getStyleFor(A.default,{baseUrl:this.core.options.baseUrl})),this.renderCcButton();var t=this.core.mediaControl.$el.find("button[data-fullscreen]");return t[0]?this.$el.insertAfter(t):this.core.mediaControl.$el.find(".media-control-right-panel[data-media-control]").prepend(this.$el),this},e}(f.default);e.default=x,t.exports=e["default"]},function(t,e){t.exports='<svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 49 41.8" style="enable-background:new 0 0 49 41.8;" xml:space="preserve"><path d="M47.1,0H3.2C1.6,0,0,1.2,0,2.8v31.5C0,35.9,1.6,37,3.2,37h11.9l3.2,1.9l4.7,2.7c0.9,0.5,2-0.1,2-1.1V37h22.1 c1.6,0,1.9-1.1,1.9-2.7V2.8C49,1.2,48.7,0,47.1,0z M7.2,18.6c0-4.8,3.5-9.3,9.9-9.3c4.8,0,7.1,2.7,7.1,2.7l-2.5,4 c0,0-1.7-1.7-4.2-1.7c-2.8,0-4.3,2.1-4.3,4.3c0,2.1,1.5,4.4,4.5,4.4c2.5,0,4.9-2.1,4.9-2.1l2.2,4.2c0,0-2.7,2.9-7.6,2.9 C10.8,27.9,7.2,23.5,7.2,18.6z M36.9,27.9c-6.4,0-9.9-4.4-9.9-9.3c0-4.8,3.5-9.3,9.9-9.3C41.7,9.3,44,12,44,12l-2.5,4 c0,0-1.7-1.7-4.2-1.7c-2.8,0-4.3,2.1-4.3,4.3c0,2.1,1.5,4.4,4.5,4.4c2.5,0,4.9-2.1,4.9-2.1l2.2,4.2C44.5,25,41.9,27.9,36.9,27.9z"></path></svg>'},function(t,e,n){e=t.exports=n(7)(!1),e.push([t.i,".cc-controls[data-cc-controls]{float:right;position:relative;display:none}.cc-controls[data-cc-controls].available{display:block}.cc-controls[data-cc-controls] .cc-button{padding:6px!important}.cc-controls[data-cc-controls] .cc-button.enabled{display:block;opacity:1}.cc-controls[data-cc-controls] .cc-button.enabled:hover{opacity:1;text-shadow:none}.cc-controls[data-cc-controls]>ul{list-style-type:none;position:absolute;bottom:25px;border:1px solid #000;display:none;background-color:#e6e6e6}.cc-controls[data-cc-controls] li{font-size:10px}.cc-controls[data-cc-controls] li[data-title]{background-color:#c3c2c2;padding:5px}.cc-controls[data-cc-controls] li a{color:#444;padding:2px 10px;display:block;text-decoration:none}.cc-controls[data-cc-controls] li a:hover{background-color:#555;color:#fff}.cc-controls[data-cc-controls] li a:hover a{color:#fff;text-decoration:none}.cc-controls[data-cc-controls] li.current a{color:red}",""])},function(t,e){t.exports='<button type="button" class="cc-button media-control-button media-control-icon" data-cc-button aria-label="<%= ariaLabel %>"></button>\r\n<ul>\r\n  <% if (title) { %>\r\n  <li data-title><%= title %></li>\r\n  <% }; %>\r\n  <li><a href="#" data-cc-select="-1"><%= disabledLabel %></a></li>\r\n  <% for (var i = 0; i < tracks.length; i++) { %>\r\n    <li><a href="#" data-cc-select="<%= tracks[i].id %>"><%= tracks[i].label %></a></li>\r\n  <% }; %>\r\n</ul>\r\n'},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(290),i=function(t){return t&&t.__esModule?t:{default:t}}(r);e.default=i.default,t.exports=e["default"]},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),u=n(3),l=r(u),c=n(2),d=r(c),h=n(8),f=n(15),p=r(f),m=n(6),g=r(m),v=n(10),y=r(v),_=n(4),b=r(_),E=n(13),w=r(E),A=n(291),S=r(A),T=n(292),x=r(T),k=function(t){function e(n){(0,a.default)(this,e);var r=(0,s.default)(this,t.call(this,n));return r.hoveringOverSeekBar=!1,r.hoverPosition=null,r.duration=null,r.actualLiveTime=!!r.mediaControl.options.actualLiveTime,r.actualLiveTime&&(r.mediaControl.options.actualLiveServerTime?r.actualLiveServerTimeDiff=(new Date).getTime()-new Date(r.mediaControl.options.actualLiveServerTime).getTime():r.actualLiveServerTimeDiff=0),r}return(0,d.default)(e,t),(0,l.default)(e,[{key:"name",get:function(){return"seek_time"}},{key:"template",get:function(){return(0,y.default)(x.default)}},{key:"attributes",get:function(){return{class:"seek-time","data-seek-time":""}}},{key:"mediaControl",get:function(){return this.core.mediaControl}},{key:"mediaControlContainer",get:function(){return this.mediaControl.container}},{key:"isLiveStreamWithDvr",get:function(){return this.mediaControlContainer&&this.mediaControlContainer.getPlaybackType()===w.default.LIVE&&this.mediaControlContainer.isDvrEnabled()}},{key:"durationShown",get:function(){return this.isLiveStreamWithDvr&&!this.useActualLiveTime}},{key:"useActualLiveTime",get:function(){return this.actualLiveTime&&this.isLiveStreamWithDvr}}]),e.prototype.bindEvents=function(){this.listenTo(this.mediaControl,b.default.MEDIACONTROL_RENDERED,this.render),this.listenTo(this.mediaControl,b.default.MEDIACONTROL_MOUSEMOVE_SEEKBAR,this.showTime),this.listenTo(this.mediaControl,b.default.MEDIACONTROL_MOUSELEAVE_SEEKBAR,this.hideTime),this.listenTo(this.mediaControl,b.default.MEDIACONTROL_CONTAINERCHANGED,this.onContainerChanged),this.mediaControlContainer&&(this.listenTo(this.mediaControlContainer,b.default.CONTAINER_PLAYBACKDVRSTATECHANGED,this.update),this.listenTo(this.mediaControlContainer,b.default.CONTAINER_TIMEUPDATE,this.updateDuration))},e.prototype.onContainerChanged=function(){this.stopListening(),this.bindEvents()},e.prototype.updateDuration=function(t){this.duration=t.total,this.update()},e.prototype.showTime=function(t){this.hoveringOverSeekBar=!0,this.calculateHoverPosition(t),this.update()},e.prototype.hideTime=function(){this.hoveringOverSeekBar=!1,this.update()},e.prototype.calculateHoverPosition=function(t){var e=t.pageX-this.mediaControl.$seekBarContainer.offset().left;this.hoverPosition=Math.min(1,Math.max(e/this.mediaControl.$seekBarContainer.width(),0))},e.prototype.getSeekTime=function(){var t=void 0,e=void 0;if(this.useActualLiveTime){var n=new Date((new Date).getTime()-this.actualLiveServerTimeDiff);e=(new Date(n)-n.setHours(0,0,0,0))/1e3,t=e-this.duration+this.hoverPosition*this.duration,t<0&&(t+=86400)}else t=this.hoverPosition*this.duration;return{seekTime:t,secondsSinceMidnight:e}},e.prototype.update=function(){if(this.rendered)if(this.shouldBeVisible()){var t=this.getSeekTime(),e=(0,h.formatTime)(t.seekTime,this.useActualLiveTime);if(e!==this.displayedSeekTime&&(this.$seekTimeEl.text(e),this.displayedSeekTime=e),this.durationShown){this.$durationEl.show();var n=(0,h.formatTime)(this.actualLiveTime?t.secondsSinceMidnight:this.duration,this.actualLiveTime);n!==this.displayedDuration&&(this.$durationEl.text(n),this.displayedDuration=n)}else this.$durationEl.hide();this.$el.show();var r=this.mediaControl.$seekBarContainer.width(),i=this.$el.width(),a=this.hoverPosition*r;a-=i/2,a=Math.max(0,Math.min(a,r-i)),this.$el.css("left",a)}else this.$el.hide(),this.$el.css("left","-100%")},e.prototype.shouldBeVisible=function(){return this.mediaControlContainer&&this.mediaControlContainer.settings.seekEnabled&&this.hoveringOverSeekBar&&null!==this.hoverPosition&&null!==this.duration},e.prototype.render=function(){this.rendered=!0,this.displayedDuration=null,this.displayedSeekTime=null;var t=g.default.getStyleFor(S.default);this.$el.html(this.template()),this.$el.append(t),this.$el.hide(),this.mediaControl.$el.append(this.el),this.$seekTimeEl=this.$el.find("[data-seek-time]"),this.$durationEl=this.$el.find("[data-duration]"),this.$durationEl.hide(),this.update()},e}(p.default);e.default=k,t.exports=e["default"]},function(t,e,n){e=t.exports=n(7)(!1),e.push([t.i,'.seek-time[data-seek-time]{position:absolute;white-space:nowrap;height:20px;line-height:20px;font-size:0;left:-100%;bottom:55px;background-color:rgba(2,2,2,.5);z-index:9999;-webkit-transition:opacity .1s ease;-moz-transition:opacity .1s ease;transition:opacity .1s ease}.seek-time[data-seek-time].hidden[data-seek-time]{opacity:0}.seek-time[data-seek-time] [data-seek-time]{display:inline-block;color:#fff;font-size:10px;padding-left:7px;padding-right:7px;vertical-align:top}.seek-time[data-seek-time] [data-duration]{display:inline-block;color:hsla(0,0%,100%,.5);font-size:10px;padding-right:7px;vertical-align:top}.seek-time[data-seek-time] [data-duration]:before{content:"|";margin-right:7px}',""])},function(t,e){t.exports="<span data-seek-time></span>\r\n<span data-duration></span>\r\n"},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(3),s=r(o),u=n(1),l=r(u),c=n(2),d=r(c),h=n(62),f=r(h),p=n(4),m=r(p),g=function(t){function e(){return(0,a.default)(this,e),(0,l.default)(this,t.apply(this,arguments))}return(0,d.default)(e,t),e.prototype.bindEvents=function(){this.listenTo(this.core,m.default.CORE_CONTAINERS_CREATED,this.onContainersCreated)},e.prototype.onContainersCreated=function(){var t=this.core.containers.filter(function(t){return"no_op"!==t.playback.name})[0]||this.core.containers[0];t&&this.core.containers.forEach(function(e){e!==t&&e.destroy()})},(0,s.default)(e,[{key:"name",get:function(){return"sources"}}]),e}(f.default);e.default=g,t.exports=e["default"]},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(3),s=r(o),u=n(1),l=r(u),c=n(2),d=r(c),h=n(4),f=r(h),p=n(62),m=r(p),g=n(8),v=function(t){function e(){return(0,a.default)(this,e),(0,l.default)(this,t.apply(this,arguments))}return(0,d.default)(e,t),e.prototype.bindEvents=function(){this.listenTo(this.core.mediaControl,f.default.MEDIACONTROL_CONTAINERCHANGED,this.containerChanged);var t=this.core.getCurrentContainer();t&&(this.listenTo(t,f.default.CONTAINER_ENDED,this.ended),this.listenTo(t,f.default.CONTAINER_STOP,this.ended))},e.prototype.containerChanged=function(){this.stopListening(),this.bindEvents()},e.prototype.ended=function(){(void 0===this.core.options.exitFullscreenOnEnd||this.core.options.exitFullscreenOnEnd)&&g.Fullscreen.isFullscreen()&&this.core.toggleFullscreen()},(0,s.default)(e,[{key:"name",get:function(){return"end_video"}}]),e}(m.default);e.default=v,t.exports=e["default"]},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=n(28),a=r(i),o=n(0),s=r(o),u=n(1),l=r(u),c=n(3),d=r(c),h=n(2),f=r(h),p=n(8),m=n(9),g=r(m),v=n(62),y=r(v),_=function(t){function e(n){(0,s.default)(this,e);var r=(0,l.default)(this,t.call(this,n));return r._initializeMessages(),r}return(0,f.default)(e,t),(0,d.default)(e,[{key:"name",get:function(){return"strings"}}]),e.prototype.t=function(t){var e=this._language();return(e&&this._messages[e]||this._messages["en"])[t]||t},e.prototype._language=function(){return this.core.options.language||(0,p.getBrowserLanguage)()},e.prototype._initializeMessages=function(){var t={en:{live:"live",back_to_live:"back to live",disabled:"Disabled",playback_not_supported:"Your browser does not support the playback of this video. Please try using a different browser."},pt:{live:"ao vivo",back_to_live:"voltar para o ao vivo",disabled:"Desativado",playback_not_supported:"Seu navegador no supporta a reproduo deste video. Por favor, tente usar um navegador diferente."},es:{live:"vivo",back_to_live:"volver en vivo",disabled:"Discapacitado",playback_not_supported:"Su navegador no soporta la reproduccin de un video. Por favor, trate de usar un navegador diferente."},ru:{live:" ",back_to_live:"  ",disabled:"",playback_not_supported:"      . ,   ."},fr:{live:"en direct",disabled:"Dsactiv",back_to_live:"retour au direct",playback_not_supported:"Votre navigateur ne supporte pas la lecture de cette vido. Merci de tenter sur un autre navigateur."},tr:{live:"canl",back_to_live:"canl yayna dn",disabled:"Engelli",playback_not_supported:"Taraycnz bu videoyu oynatma desteine sahip deil. Ltfen farkl bir tarayc ile deneyin."}},e=this.core.options.strings||{};this._messages=(0,a.default)(t).reduce(function(n,r){return n[r]=g.default.extend({},t[r],e[r]),n},{}),this._messages["pt-BR"]=this._messages["pt"],this._messages["en-US"]=this._messages["en"],this._messages["es-419"]=this._messages["es"],this._messages["fr-FR"]=this._messages["fr"],this._messages["tr-TR"]=this._messages["tr"]},e}(y.default);e.default=_,t.exports=e["default"]},function(t,e){t.exports='<% if (backdropHeight) { %>\n<div class="backdrop" style="height: <%= backdropHeight%>px;">\n\t<div class="carousel"></div>\n</div>\n<% }; %>\n<% if (spotlightHeight) { %>\n<div class="spotlight" style="height: <%= spotlightHeight%>px;"></div>\n<% }; %>\n'},function(t,e,n){var r=n(298);"string"==typeof r&&(r=[[t.i,r,""]]);n(131)(r,{});r.locals&&(t.exports=r.locals)},function(t,e,n){e=t.exports=n(7)(!1),e.push([t.i,".scrub-thumbnails{position:absolute;bottom:55px;width:100%;-webkit-transition:opacity .3s ease;-moz-transition:opacity .3s ease;-o-transition:opacity .3s ease;transition:opacity .3s ease}.scrub-thumbnails.hidden{opacity:0}.scrub-thumbnails .thumbnail-container{display:inline-block;position:relative;overflow:hidden;background-color:#000}.scrub-thumbnails .thumbnail-container .thumbnail-img{position:absolute;width:auto}.scrub-thumbnails .spotlight{background-color:#000;overflow:hidden;position:absolute;bottom:0;left:0;border:2px solid #fff}.scrub-thumbnails .spotlight img{width:auto}.scrub-thumbnails .backdrop{position:absolute;left:0;bottom:0;right:0;background-color:#000;overflow:hidden}.scrub-thumbnails .backdrop .carousel{position:absolute;top:0;left:0;height:100%;white-space:nowrap}.scrub-thumbnails .backdrop .carousel img{width:auto}",""])},function(t,e,n){var r=n(300);"string"==typeof r&&(r=[[t.i,r,""]]);n(131)(r,{});r.locals&&(t.exports=r.locals)},function(t,e,n){e=t.exports=n(7)(!1),e.push([t.i,'.markers-plugin{pointer-events:none}.markers-plugin .markers-plugin-markers{overflow:hidden;position:absolute;top:0;bottom:0;left:0;right:0}.markers-plugin .markers-plugin-markers>*{pointer-events:auto}.markers-plugin .markers-plugin-markers .standard-marker{position:absolute;-webkit-transform:translateX(-50%);-moz-transform:translateX(-50%);-ms-transform:translateX(-50%);-o-transform:translateX(-50%);transform:translateX(-50%);top:2px;left:0;width:20px;height:20px}.markers-plugin .markers-plugin-markers .standard-marker .standard-marker-inner{position:absolute;left:7.5px;top:7.5px;width:5px;height:5px;border-radius:2.5px;box-shadow:0 0 0 3px hsla(0,0%,78%,.2);background-color:#c8c8c8}.markers-plugin .markers-plugin-markers .standard-marker:hover{cursor:pointer}.markers-plugin .markers-plugin-markers .standard-marker:hover .standard-marker-inner{left:6px;top:6px;width:8px;height:8px;border-radius:4px;box-shadow:0 0 0 6px hsla(0,0%,100%,.2);background-color:#fff}.markers-plugin .markers-plugin-tooltips{position:relative;height:0}.markers-plugin .markers-plugin-tooltips .tooltip-container{position:absolute;white-space:nowrap;line-height:normal}.markers-plugin .markers-plugin-tooltips .tooltip-container>*{pointer-events:auto}.markers-plugin .markers-plugin-tooltips .tooltip-container .image-tooltip,.markers-plugin .markers-plugin-tooltips .tooltip-container .standard-tooltip{display:none;background-color:rgba(2,2,2,.5);color:#fff;font-size:10px;padding:4px 7px;line-height:normal}.markers-plugin .markers-plugin-tooltips .tooltip-container .image-tooltip[data-show="1"],.markers-plugin .markers-plugin-tooltips .tooltip-container .standard-tooltip[data-show="1"]{display:inline-block}',""])},function(t,e,n){"use strict";var r,i,a,o,s,u,l,c=n(302),d=n(316),h=Function.prototype.apply,f=Function.prototype.call,p=Object.create,m=Object.defineProperty,g=Object.defineProperties,v=Object.prototype.hasOwnProperty,y={configurable:!0,enumerable:!1,writable:!0};r=function(t,e){var n;return d(e),v.call(this,"__ee__")?n=this.__ee__:(n=y.value=p(null),m(this,"__ee__",y),y.value=null),n[t]?"object"==typeof n[t]?n[t].push(e):n[t]=[n[t],e]:n[t]=e,this},i=function(t,e){var n,i;return d(e),i=this,r.call(this,t,n=function(){a.call(i,t,n),h.call(e,this,arguments)}),n.__eeOnceListener__=e,this},a=function(t,e){var n,r,i,a;if(d(e),!v.call(this,"__ee__"))return this;if(n=this.__ee__,!n[t])return this;if("object"==typeof(r=n[t]))for(a=0;i=r[a];++a)i!==e&&i.__eeOnceListener__!==e||(2===r.length?n[t]=r[a?0:1]:r.splice(a,1));else r!==e&&r.__eeOnceListener__!==e||delete n[t];return this},o=function(t){var e,n,r,i,a;if(v.call(this,"__ee__")&&(i=this.__ee__[t]))if("object"==typeof i){for(n=arguments.length,a=new Array(n-1),e=1;e<n;++e)a[e-1]=arguments[e];for(i=i.slice(),e=0;r=i[e];++e)h.call(r,this,a)}else switch(arguments.length){case 1:f.call(i,this);break;case 2:f.call(i,this,arguments[1]);break;case 3:f.call(i,this,arguments[1],arguments[2]);break;default:for(n=arguments.length,a=new Array(n-1),e=1;e<n;++e)a[e-1]=arguments[e];h.call(i,this,a)}},s={on:r,once:i,off:a,emit:o},u={on:c(r),once:c(i),off:c(a),emit:c(o)},l=g({},u),t.exports=e=function(t){return null==t?p(l):g(Object(t),u)},e.methods=s},function(t,e,n){"use strict";var r,i=n(303),a=n(311),o=n(312),s=n(313);r=t.exports=function(t,e){var n,r,o,u,l;return arguments.length<2||"string"!=typeof t?(u=e,e=t,t=null):u=arguments[2],null==t?(n=o=!0,r=!1):(n=s.call(t,"c"),r=s.call(t,"e"),o=s.call(t,"w")),l={value:e,configurable:n,enumerable:r,writable:o},u?i(a(u),l):l},r.gs=function(t,e,n){var r,u,l,c;return"string"!=typeof t?(l=n,n=e,e=t,t=null):l=arguments[3],null==e?e=void 0:o(e)?null==n?n=void 0:o(n)||(l=n,n=void 0):(l=e,e=n=void 0),null==t?(r=!0,u=!1):(r=s.call(t,"c"),u=s.call(t,"e")),c={get:e,set:n,configurable:r,enumerable:u},l?i(a(l),c):c}},function(t,e,n){"use strict";t.exports=n(304)()?Object.assign:n(305)},function(t,e,n){"use strict";t.exports=function(){var t,e=Object.assign;return"function"==typeof e&&(t={foo:"raz"},e(t,{bar:"dwa"},{trzy:"trzy"}),t.foo+t.bar+t.trzy==="razdwatrzy")}},function(t,e,n){"use strict";var r=n(306),i=n(310),a=Math.max;t.exports=function(t,e){var n,o,s,u=a(arguments.length,2);for(t=Object(i(t)),s=function(r){try{t[r]=e[r]}catch(i){n||(n=i)}},o=1;o<u;++o)e=arguments[o],r(e).forEach(s);if(void 0!==n)throw n;return t}},function(t,e,n){"use strict";t.exports=n(307)()?Object.keys:n(308)},function(t,e,n){"use strict";t.exports=function(){try{return Object.keys("primitive"),!0}catch(t){return!1}}},function(t,e,n){"use strict";var r=n(89),i=Object.keys;t.exports=function(t){return i(r(t)?Object(t):t)}},function(t,e,n){"use strict";t.exports=function(){}},function(t,e,n){"use strict";var r=n(89);t.exports=function(t){if(!r(t))throw new TypeError("Cannot use null or undefined");return t}},function(t,e,n){"use strict";var r=n(89),i=Array.prototype.forEach,a=Object.create,o=function(t,e){var n;for(n in t)e[n]=t[n]};t.exports=function(t){var e=a(null);return i.call(arguments,function(t){r(t)&&o(Object(t),e)}),e}},function(t,e,n){"use strict";t.exports=function(t){return"function"==typeof t}},function(t,e,n){"use strict";t.exports=n(314)()?String.prototype.contains:n(315)},function(t,e,n){"use strict";var r="razdwatrzy";t.exports=function(){return"function"==typeof r.contains&&(!0===r.contains("dwa")&&!1===r.contains("foo"))}},function(t,e,n){"use strict";var r=String.prototype.indexOf;t.exports=function(t){return r.call(this,t,arguments[1])>-1}},function(t,e,n){"use strict";t.exports=function(t){if("function"!=typeof t)throw new TypeError(t+" is not a function");return t}},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),u=n(2),l=r(u),c=n(9),d=r(c),h=n(134),f=r(h),p=function(t){function e(n,r){(0,a.default)(this,e);var i=(0,s.default)(this,t.call(this,n));return i._tooltipText=r||null,i._tooltipText&&i._setTooltipEl(i._buildTooltipEl()),i}return(0,l.default)(e,t),e.prototype._buildTooltipEl=function(){return(0,d.default)("<div />").addClass("standard-tooltip").text(this._tooltipText)},e}(f.default);e.default=p,t.exports=e["default"]},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),u=n(2),l=r(u),c=n(9),d=r(c),h=n(134),f=r(h),p=function(t){function e(n,r,i,o){(0,a.default)(this,e);var u=(0,s.default)(this,t.call(this,n));return u._tooltipImage=r||null,u._width=i||200,u._height=o||"auto",u._tooltipImage&&u._setTooltipEl(u._buildTooltipEl()),u}return(0,l.default)(e,t),e.prototype._buildTooltipEl=function(){if(!this._tooltipImage)return null;var t=(0,d.default)("<img />").attr("src",this._tooltipImage).css({width:this._width,height:this._height});return t.one("load",this.notifyTooltipChanged.bind(this)),(0,d.default)("<div />").addClass("image-tooltip").append(t)},e}(f.default);e.default=p,t.exports=e["default"]},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(3),s=r(o),u=n(1),l=r(u),c=n(2),d=r(c),h=n(15),f=r(h),p=n(6),m=r(p),g=n(10),v=r(g),y=n(4),_=r(y),b=n(320),E=r(b),w=n(321),A=r(w),S=n(322),T=r(S),x=function(t){function e(){return(0,a.default)(this,e),(0,l.default)(this,t.apply(this,arguments))}return(0,d.default)(e,t),e.prototype.bindEvents=function(){this.listenTo(this.core,_.default.CORE_READY,this.bindPlaybackEvents),this.listenTo(this.core.mediaControl,_.default.MEDIACONTROL_CONTAINERCHANGED,this.reload),this.listenTo(this.core.mediaControl,_.default.MEDIACONTROL_RENDERED,this.render),this.listenTo(this.core.mediaControl,_.default.MEDIACONTROL_HIDE,this.hideSelectLevelMenu)},e.prototype.unBindEvents=function(){this.stopListening(this.core,_.default.CORE_READY),this.stopListening(this.core.mediaControl,_.default.MEDIACONTROL_CONTAINERCHANGED),this.stopListening(this.core.mediaControl,_.default.MEDIACONTROL_RENDERED),this.stopListening(this.core.mediaControl,_.default.MEDIACONTROL_HIDE),this.stopListening(this.core.getCurrentPlayback(),_.default.PLAYBACK_LEVELS_AVAILABLE),this.stopListening(this.core.getCurrentPlayback(),_.default.PLAYBACK_LEVEL_SWITCH_START),this.stopListening(this.core.getCurrentPlayback(),_.default.PLAYBACK_LEVEL_SWITCH_END),this.stopListening(this.core.getCurrentPlayback(),_.default.PLAYBACK_BITRATE),this.stopListening(this.core.getCurrentPlayback(),_.default.PLAYBACK_PAUSE)},e.prototype.bindPlaybackEvents=function(){var t=this.core.getCurrentPlayback();this.listenTo(t,_.default.PLAYBACK_PAUSE,this.playBackPause),this.listenTo(t,_.default.PLAYBACK_LEVELS_AVAILABLE,this.fillLevels),this.listenTo(t,_.default.PLAYBACK_LEVEL_SWITCH_START,this.startLevelSwitch),this.listenTo(t,_.default.PLAYBACK_LEVEL_SWITCH_END,this.stopLevelSwitch),this.listenTo(t,_.default.PLAYBACK_BITRATE,this.updateCurrentLevel),t.levels&&t.levels.length>0&&this.fillLevels(t.levels)},e.prototype.playBackPause=function(){this.core.$(".player-poster, .player-poster svg").show()},e.prototype.reload=function(){this.unBindEvents(),this.bindEvents(),this.bindPlaybackEvents()},e.prototype.shouldRender=function(){if(!this.core.getCurrentContainer())return!1;var t=this.core.getCurrentPlayback();if(!t)return!1;var e=void 0!==t.currentLevel,n=!!(this.levels&&this.levels.length>1);return e&&n},e.prototype.shouldBitrateRender=function(){return!!this.core.getCurrentContainer()&&!(!this.core.getCurrentPlayback()||this.levels||void 0===this.core.options.bitrateSelectorConfig||!this.core.options.bitrateSelectorConfig.bitrates||this.core.options.bitrateSelectorConfig.bitrates.length<2)},e.prototype.render=function(){if(this.shouldRender()){var t=m.default.getStyleFor(T.default,{baseUrl:this.core.options.baseUrl});this.$el.html(this.template({levels:this.levels,title:this.getTitle()})),this.$el.append(t),this.core.mediaControl.$(".media-control-right-panel").append(this.el),this.highlightCurrentLevel()}else if(this.shouldBitrateRender()){this.bitrates=this.core.options.bitrateSelectorConfig.bitrates;var e=m.default.getStyleFor(T.default,{baseUrl:this.core.options.baseUrl});this.$el.html(this.templateBitrate({bitrates:this.bitrates,title:this.getTitle()})),this.$el.append(e),this.core.mediaControl.$(".media-control-right-panel").append(this.el);for(var n=0;n<this.bitrates.length;n++)void 0===this.currentBitrate&&void 0!==this.bitrates[n].default&&this.bitrates[n].default&&(void 0!==this.bitrates[n].src&&this.bitrates[n].src===this.core.options.source||void 0!==this.bitrates[n].srcs&&void 0!==this.core.options.sources&&this.bitrates[n].srcs[0]===this.core.options.sources[0])&&(this.currentBitrate=n);this.highlightCurrentBitrate()}return this},e.prototype.fillLevels=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;void 0===this.selectedLevelId&&(this.selectedLevelId=e),this.levels=t,this.configureLevelsLabels(),this.render()},e.prototype.configureLevelsLabels=function(){if(void 0!==this.core.options.levelSelectorConfig){var t=this.core.options.levelSelectorConfig.labelCallback;if(t&&"function"!=typeof t)throw new TypeError("labelCallback must be a function");var e=this.core.options.levelSelectorConfig.labels,n=e?this.core.options.levelSelectorConfig.labels:{};if(t||e){var r,i;for(var a in this.levels)if(r=this.levels[a],void 0!==r.definition?"smooth"===r.definition||"ld"===r.definition?i="":"sd"===r.definition?i="":"hd"===r.definition?i="":"fhd"===r.definition?i="":"qhd"===r.definition?i="2K":"uhd"===r.definition?i="4K":"od"===r.definition&&(i=""):i=n[r.id],t){var o=t(r,i);void 0!==o&&(r.label=o)}else i&&(r.label=i)}}},e.prototype.findLevelBy=function(t){var e;return this.levels.forEach(function(n){n.id===t&&(e=n)}),e},e.prototype.onLevelSelect=function(t){return this.selectedLevelId=parseInt(t.target.dataset.levelSelectorSelect,10),this.core.getCurrentPlayback().currentLevel!=this.selectedLevelId&&(this.core.getCurrentPlayback().currentLevel=this.selectedLevelId,this.toggleContextMenu(),t.stopPropagation(),!1)},e.prototype.onBitrateSelect=function(t){this.selectedBitrateId=parseInt(t.target.dataset.bitrateSelectorSelect,10);var e=this.core.mediaControl.container.getCurrentTime();return this.isPlay=this.core.getCurrentPlayback().isPlaying(),this.core.configure({source:this.bitrates[this.selectedBitrateId].src,sources:this.bitrates[this.selectedBitrateId].srcs,autoPlay:this.isPlay}),this.core.mediaControl.container.seek(e),this.core.mediaControl.enable(),this.currentBitrate=this.selectedBitrateId,this.toggleContextMenu(),t.stopPropagation(),!1},e.prototype.onShowLevelSelectMenu=function(t){this.toggleContextMenu()},e.prototype.onShowSelectMenu=function(t){this.toggleContextMenu()},e.prototype.hideSelectLevelMenu=function(){this.$(".level_selector ul").hide()},e.prototype.toggleContextMenu=function(){this.$(".level_selector ul").toggle()},e.prototype.buttonElement=function(){return this.$(".level_selector button")},e.prototype.levelElement=function(t){return this.$(".level_selector ul a"+(isNaN(t)?"":'[data-level-selector-select="'+t+'"]')).parent()},e.prototype.bitrateElement=function(t){return this.$(".bitrate_selector ul a"+(isNaN(t)?"":'[data-bitrate-selector-select="'+t+'"]')).parent()},e.prototype.getTitle=function(){return(this.core.options.levelSelectorConfig||{}).title},e.prototype.startLevelSwitch=function(){this.buttonElement().addClass("changing")},e.prototype.stopLevelSwitch=function(){this.buttonElement().removeClass("changing")},e.prototype.updateText=function(t){-1===t?this.buttonElement().text(this.currentLevel?" ("+this.currentLevel.label+")":""):this.buttonElement().text(this.findLevelBy(t).label+"")},e.prototype.updateCurrentLevel=function(t){var e=this.findLevelBy(t.level);this.currentLevel=e||null,this.highlightCurrentLevel()},e.prototype.highlightCurrentLevel=function(){this.levelElement().removeClass("current"),this.currentLevel&&this.levelElement(this.currentLevel.id).addClass("current"),this.updateText(this.selectedLevelId)},e.prototype.highlightCurrentBitrate=function(){this.bitrateElement().removeClass("current"),this.bitrates&&void 0!==this.currentBitrate&&this.bitrates[this.currentBitrate].label&&(this.bitrateElement(this.currentBitrate).addClass("current"),this.buttonElement().text(this.bitrates[this.currentBitrate].label))},(0,s.default)(e,[{key:"name",get:function(){return"level_selector"}},{key:"template",get:function(){return(0,v.default)(E.default)}},{key:"templateBitrate",get:function(){return(0,v.default)(A.default)}},{key:"attributes",get:function(){return{class:this.name,"data-level-selector":""}}},{key:"events",get:function(){return{"click [data-level-selector-select]":"onLevelSelect","click [data-level-selector-button]":"onShowLevelSelectMenu","click [data-bitrate-selector-select]":"onBitrateSelect","click [data-bitrate-selector-button]":"onShowSelectMenu"}}}],[{key:"version",get:function(){return"6.0.17b"}}]),e}(f.default);e.default=x,t.exports=e["default"]},function(t,e){t.exports='<button data-level-selector-button>\n  \n</button>\n<ul>\n  <% if (title) { %>\n  <li data-title><%= title %></li>\n  <% }; %>\n  <li><a href="#" data-level-selector-select="-1"></a></li>\n  <% for (var i = 0; i < levels.length; i++) { %>\n    <li><a href="#" data-level-selector-select="<%= levels[i].id %>"><%= levels[i].label %></a></li>\n  <% }; %>\n</ul>\n'},function(t,e){t.exports='<button data-bitrate-selector-button>\r\n    \r\n</button>\r\n<ul>\r\n    <% if (title) { %>\r\n    <li data-title><%= title %></li>\r\n    <% }; %>\r\n    <% for (var i = 0; i < bitrates.length; i++) { %>\r\n    <li><a href="#" data-bitrate-selector-select="<%= i %>"><%= bitrates[i].label %></a></li>\r\n    <% }; %>\r\n</ul>'},function(t,e,n){e=t.exports=n(7)(!1),e.push([t.i,".level_selector[data-level-selector]{float:right;margin-top:5px;position:relative}.level_selector[data-level-selector] button{font-family:,Roboto,Open Sans,Arial,sans-serif;-webkit-font-smoothing:antialiased;border:none;font-size:10px;width:80px;height:24px;background-color:transparent;border-radius:99em;cursor:pointer;color:#ececec;line-height:24px;text-align:center}.level_selector[data-level-selector] button:hover{background-color:#ff6e0b}.level_selector[data-level-selector] button.changing{-webkit-animation:pulse .5s infinite alternate}.level_selector[data-level-selector]>ul{list-style-type:none;position:absolute;left:-10px;width:100px;bottom:32px;color:#ccc;display:none;background-color:rgba(0,0,0,.8);border-radius:4px}.level_selector[data-level-selector] li{font-size:14px;line-height:33px;height:33px;width:100px}.level_selector[data-level-selector] li[data-title]{background-color:#c3c2c2;padding:5px}.level_selector[data-level-selector] li a{color:#ccc;padding:0 10px;display:block;text-decoration:none}.level_selector[data-level-selector] li a:hover{color:#ff6e0b}.level_selector[data-level-selector] li a:hover a{color:#ff6e0b;text-decoration:none}.level_selector[data-level-selector] li.current a{color:#ff6e0b}@-webkit-keyframes pulse{0%{color:#fff}50%{color:#ff0101}to{color:#b80000}}",""])},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(324),i=function(t){return t&&t.__esModule?t:{default:t}}(r);e.default=i.default,t.exports=e["default"]},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=n(26),a=r(i),o=n(0),s=r(o),u=n(1),l=r(u),c=n(3),d=r(c),h=n(2),f=r(h),p=n(15),m=r(p),g=n(4),v=r(g),y=n(325),_=r(y),b=n(129),E=r(b),w=n(13),A=r(w),S=function(t){function e(n){(0,s.default)(this,e);var r=(0,l.default)(this,t.call(this,n));return r.initialize(),r}return(0,f.default)(e,t),e.prototype._rand=function(t,e){return Math.floor(Math.random()*(e-t+1))+t},(0,d.default)(e,[{key:"name",get:function(){return"ads"}}]),e.prototype.initialize=function(){if(this._isAdPlaying=!1,this._hasPreRollPlayed=!1,this._hasPostRollPlayed=!1,this._preRoll=!1,this._midRoll=!1,this._postRoll=!1,this._videoText={},this._padRoll="",this._liveOpened=!1,"ads"in this._options){if("preRoll"in this._options.ads){if(!("src"in this._options.ads.preRoll))throw"No source";this._preRoll=this._options.ads.preRoll}if("midRoll"in this._options.ads){if(!("src"in this._options.ads.midRoll))throw"No source";this._midRoll=this._options.ads.midRoll,"string"==typeof this._midRoll.src&&(this._midRoll.src=[this._midRoll.src]),"at"in this._midRoll&&"object"!=(0,a.default)(this._midRoll.at)&&(this._midRoll.at=[this._midRoll.at])}if("postRoll"in this._options.ads){if(!("src"in this._options.ads.postRoll))throw"No source";this._postRoll=this._options.ads.postRoll}if("text"in this._options.ads){var t=this._options.ads.text;"wait"in t&&(this._videoText.wait=t.wait),"skip"in t&&(this._videoText.skip=t.skip)}this._adReporter=new E.default(this.options.powerStats.baseurl,this.options.powerStats.reportserver,this.options.powerStats.siteid,this.options.powerStats.contentid,this.options.powerStats.videoid,this.options.powerStats.username)}void 0!==this._options.adpad&&""!==this._options.adpad&&(this._padRoll=this._options.adpad),void 0!==this._options.liveopened&&(this._liveOpened=this._options.liveopened),this.bindEvents()},e.prototype.bindEvents=function(){this.listenTo(this.core,v.default.CORE_READY,function(){var t=this.core.getCurrentContainer();t.listenTo(t.playback,v.default.PLAYBACK_PLAY_INTENT,this._onPlaybackPlayIntent.bind(this,t)),t.listenTo(t.playback,v.default.PLAYBACK_PLAY,this._onPlaybackPlay.bind(this,t)),t.listenTo(t.playback,v.default.PLAYBACK_TIMEUPDATE,this._onPlaybackTimeUpdate.bind(this,t)),t.listenTo(t.playback,v.default.PLAYBACK_ENDED,this._onPlaybackEnd.bind(this)),t.listenTo(t,v.default.CONTAINER_OPEN_LIVE,this._onPlaybackOpenLive.bind(this,t)),t.listenTo(t,v.default.CONTAINER_CLOSE_LIVE,this._onPlaybackCloseLive.bind(this,t))}.bind(this))},e.prototype._onPlaybackPlayIntent=function(t){if(this._isAdPlaying)void 0!==t.playback&&t.playback.pause();else{if(""!==this._padRoll&&!this._liveOpened)return void this.playPadRoll(t);if(!this._preRoll||this._hasPreRollPlayed)return;this.playPreRoll(t)}},e.prototype._onPlaybackPlay=function(t){if(this._isAdPlaying)void 0!==t.playback&&t.playback.pause();else{if(""!==this._padRoll&&!this._liveOpened)return void this.playPadRoll(t);if(!this._preRoll||this._hasPreRollPlayed)return;this.playPreRoll(t)}},e.prototype._onPlaybackTimeUpdate=function(t){var e=t.currentTime,n=t.getDuration();if(this._midRoll){var r;r="at"in this._midRoll?this._midRoll.at:[Math.floor(n/2)];for(var i,a,o=!1,s=0;s<r.length;s++)i=r[s],Math.floor(e)==i&&(a=s,o=!0);o&&(this._midRoll.at.length===this._midRoll.src.length?this.playMidRoll(t,a):this.playMidRoll(t))}},e.prototype._onPlaybackEnd=function(){if(this._isAdPlaying=!1,this._hasPreRollPlayed=!1,this._postRoll){var t=this.core.getCurrentContainer();this.playPostRoll(t)}},e.prototype._onPlaybackOpenLive=function(t){if(!this._liveOpened){this._isAdPlaying=!1,this._hasPreRollPlayed=!1,this._liveOpened=!0;try{this.video.stop()}catch(e){console.log("failed to stop adpad")}setTimeout(function(){t.playback.getPlaybackType()===A.default.LIVE&&t.playback.seekPercentage(100),t.playback.play()},100)}},e.prototype._onPlaybackCloseLive=function(t){if(this._liveOpened)return this._isAdPlaying=!1,this._hasPreRollPlayed=!1,this._liveOpened=!1,""===this._padRoll||this._liveOpened?void 0:void this.playPadRoll(t)},e.prototype.playPreRoll=function(t){if(!this._isAdPlaying){this._isAdPlaying=!0;var e;e="object"===(0,a.default)(this._preRoll.src)?this._preRoll.src[this._rand(0,this._preRoll.src.length-1)]:this._preRoll.src,t.playback.pause(),this.video=new _.default(e,this._preRoll.skip,this._preRoll.timeout),this.video.onEnd=this._onPreRollEnd.bind(this,this.video,t.playback),"wait"in this._videoText&&(this.video.text.wait=this._videoText.wait),"skip"in this._videoText&&(this.video.text.skip=this._videoText.skip),this._preRoll.muteButton&&this.video.attachMuteButton(),t.$el.append(this.video.wrapper),this.video.play(),"onPlay"in this._preRoll&&this._preRoll.onPlay(this._preRoll,{position:"preroll"}),this._hasPreRollPlayed=!0;var n={adMode:"pre",adId:this._preRoll.adId};this._adReporter.send("",n)}},e.prototype.playMidRoll=function(t,e){if(!this._isAdPlaying){this._isAdPlaying=!0,t.playback.pause(),t.playback.seek(parseInt(Math.floor(t.currentTime+1)));var n;n=void 0===e?this._midRoll.src[this._rand(0,this._midRoll.src.length-1)]:this._midRoll.src[e],this.video=new _.default(n,this._midRoll.skip,this._midRoll.timeout),this._midRoll.muteButton&&this.video.attachMuteButton(),t.$el.append(this.video.wrapper),this.video.play(),"onPlay"in this._midRoll&&this._midRoll.onPlay(this._midRoll,{position:"preroll"}),this.video.onEnd=function(){this._isAdPlaying=!1,setTimeout(function(){t.playback.play()},100)}.bind(this);var r={adMode:"mid",adId:this._midRoll.adId};this._adReporter.send("",r)}},e.prototype.playPostRoll=function(t){if(!this._isAdPlaying){this._isAdPlaying=!0,this._hasPostRollPlayed=!0;var e;e="object"===(0,a.default)(this._postRoll.src)?this._postRoll.src[this._rand(0,this._postRoll.src.length-1)]:this._postRoll.src,this.video=new _.default(e),this._postRoll.muteButton&&this.video.attachMuteButton(),t.$el.append(this.video.wrapper),this.video.play(),"onPlay"in this._postRoll&&this._postRoll.onPlay(this._postRoll,{position:"preroll"}),this.video.onEnd=function(){this._isAdPlaying=!1}.bind(this);var n={adMode:"post",adId:this._postRoll.adId};this._adReporter.send("",n)}},e.prototype.playPadRoll=function(t){if(!this._isAdPlaying){this._isAdPlaying=!0,void 0!==t.playback&&(t.playback.getPlaybackType()===A.default.LIVE?t.playback.stop():t.playback.pause());var e=this._padRoll;this.video=new _.default(e,!1,-1),this._preRoll.muteButton&&this.video.attachMuteButton(),t.$el.append(this.video.wrapper),this.video.play()}},e.prototype._onPreRollEnd=function(t,e){this._isAdPlaying=!1,setTimeout(function(){e.play()},100)},e.prototype._onMidRollEnd=function(t,e){this._isAdPlaying=!1,setTimeout(function(){e.play()},100)},e}(m.default);e.default=S,t.exports=e["default"]},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(102),s=(r(o),n(9)),u=(r(s),function(){function t(e,n,r){(0,a.default)(this,t),this.text={wait:"$ | %",skip:"$ |  "},this.onEnd=!1,this.wrapper=this._initWrapper(),this.video=this._initVideo(e),this.wrapper.appendChild(this.video),this.muteButton=this._initMuteButton(),this.videodur=-1,n&&(this.skipButton=this._initSkipButton(r),this.wrapper.appendChild(this.skipButton)),void 0!==r&&parseInt(r,10)<0&&(this.video.loop="loop"),this.attachMuteButton()}return t.prototype._initWrapper=function(){var t=document.createElement("div");return t.style.display="block",t.style.position="absolute",t.style.width="100%",t.style.height="100%",t.style.top="0px",t.style.left="0px",t.style.zIndex=9998,t},t.prototype._initVideo=function(t){var e=document.createElement("video");return e.style.display="block",e.style.position="absolute",e.style.width="100%",e.style.height="100%",e.controls=!1,e.src=t,e.setAttribute("playsinline","playsinline"),e.setAttribute("x-webkit-playsinline","true"),e.setAttribute("x5-playsinline","true"),e.addEventListener("ended",this._end.bind(this)),e.addEventListener("loadedmetadata",this._loadedmetadata.bind(this)),e},t.prototype._initSkipButton=function(t){var e=document.createElement("button");return e.style.display="none",e.style.position="absolute",e.style.top="10px",e.style.right="41px",e.style.padding="5px",e.style.backgroundColor="#000",e.style.border="solid thin #000",e.style.fontSize="12px",e.style.color="#FFF",e.disabled=!0,e.addEventListener("click",this._end.bind(this)),this._skipButtonCountdown(e,t),e},t.prototype._initMuteButton=function(){var t=document.createElement("div");t.style.position="absolute",t.style.top="10px",t.style.right="7px",t.style.padding="6px",t.style.backgroundColor="#000",t.style.border="solid thin #000",t.style.color="#FFF",t.style.width="30px",t.style.height="28px",t.style.color="#FFF",t.style.textAlign="center";var e=document.createElement("img");return e.setAttribute("id","adVolume"),e.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAAPCAYAAADphp8SAAABG0lEQVR42r2TvUrEQBSFp7ERG2EbH8BKENdOwVps5jFSWFlZCXmJkCXk/5eQEJI8gg+wrc+wsLBgtbDN9QwkMGYnDgg6cBgI93w5ufeGsb8+TdPwvu+pbdv1ryFVVfGu62iUqsZxnEUcx48/QpCCZE1rDMM4SZLkPc9zAuxFCcEn0VSqFwL0KkBpmh6CILhkdV2TTjIgiqInGO8HWCRguFesLEvSaYR4nrdEgj2MW9M0TwG9HlJ9sKIoSKcRhCS3wiTMgFzZtn0+JPpkWZaRTtKkLmDaQLujROg66ST3KAzDGzy7O+rRZDc4Cmmqmam9fZuaYtG47/skawZUDHv0PLuUaCJ3XZdGqWosyzpDkgftbyJgSEe41+w/zxdhrWBcCd4RLgAAAABJRU5ErkJggg==",e.style.width="18px",e.style.height="15px",t.appendChild(e),t.addEventListener("click",function(){this.video.muted=!this.video.muted,this.video.muted?e.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABMAAAAPCAYAAAAGRPQsAAABDUlEQVR42sWTS2rDMBRFNSgUsinvwB1l2lGmXoN3YeM//mD8iZFtCAQC2kHW9PpuGgWRFAQ1tIKDnu6VriVbFuIv2jRN7rIsJKW8bgoahsGd55k0m4J4N2Ty6yA+Hj2j/a7rPnnOKYqindZQs6bYO4hxHMmGXtj3/Yox9xeEAK7VXTviaWRDh3me99627QqNewXu9dFxnDfBBdkwXwUC67petcf1dxBa0zRkwwzzfX9XVZXSHtdnaDezLEuyYQblea6gFUWxAtSsXR6BxpdxeQI9o/00Tc8YZ1kmcVzAGkIJ3sv1QCBPJhPD2ydJ0iPEfIdxHMswDD9+vG9BELi8iDSb/00E8k6I+6v4j/YFNcdpRqtXL2YAAAAASUVORK5CYII=":e.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAAPCAYAAADphp8SAAABG0lEQVR42r2TvUrEQBSFp7ERG2EbH8BKENdOwVps5jFSWFlZCXmJkCXk/5eQEJI8gg+wrc+wsLBgtbDN9QwkMGYnDgg6cBgI93w5ufeGsb8+TdPwvu+pbdv1ryFVVfGu62iUqsZxnEUcx48/QpCCZE1rDMM4SZLkPc9zAuxFCcEn0VSqFwL0KkBpmh6CILhkdV2TTjIgiqInGO8HWCRguFesLEvSaYR4nrdEgj2MW9M0TwG9HlJ9sKIoSKcRhCS3wiTMgFzZtn0+JPpkWZaRTtKkLmDaQLujROg66ST3KAzDGzy7O+rRZDc4Cmmqmam9fZuaYtG47/skawZUDHv0PLuUaCJ3XZdGqWosyzpDkgftbyJgSEe41+w/zxdhrWBcCd4RLgAAAABJRU5ErkJggg=="}.bind(this)),t},t.prototype._skipButtonCountdown=function(t,e){var n=setInterval(function(){t.style.display="block",this.videodur>0&&this.videodur--,e>0?(t.innerHTML=this.text.wait.replace("%",e).replace("$",this.videodur>=0?this.videodur:" "),e--):this.videodur>0?(t.innerHTML=this.text.skip.replace("$",this.videodur),t.disabled=!1):0==this.videodur?(t.style.display="none",clearInterval(n)):(t.innerHTML=" ",t.disabled=!1)}.bind(this),1e3)},t.prototype._end=function(t){t&&t.preventDefault(),this.wrapper.parentNode.removeChild(this.wrapper),"function"==typeof this.onEnd&&this.onEnd()},t.prototype._loadedmetadata=function(t){this.videodur=Math.floor(this.video.duration),void 0!==this.skipButton||this.video.loop||(this.text.wait="%",this.skipButton=this._initSkipButton(Math.floor(this.video.duration)),this.wrapper.appendChild(this.skipButton))},t.prototype.play=function(){var t=this,e=this.video.play();e&&e.catch&&e.catch(function(){t.video.muted=!0,t.video.play()})},t.prototype.pause=function(){this.video.pause()},t.prototype.attachMuteButton=function(){this.wrapper.appendChild(this.muteButton)},t.prototype.stop=function(){this.video.pause(),this.wrapper&&this.wrapper.parentNode&&this.wrapper.parentNode.removeChild(this.wrapper)},t}());e.default=u,t.exports=e["default"]},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=n(26),a=r(i),o=n(0),s=r(o),u=n(1),l=r(u),c=n(2),d=r(c),h=n(15),f=r(h),p=n(4),m=r(p),g=function(t){function e(n){(0,s.default)(this,e);var r=(0,l.default)(this,t.call(this,n));return r.initialize(),r}return(0,d.default)(e,t),e.prototype.initialize=function(){if(this.BLOCK_REGEX=/[0-9]+(?:\r\n|\r|\n)([0-9]{2}:[0-9]{2}:[0-9]{2}(?:,|\.)[0-9]{3}) --> ([0-9]{2}:[0-9]{2}:[0-9]{2}(?:,|\.)[0-9]{3})(?:\r\n|\r|\n)((?:.*(?:\r\n|\r|\n))*?)(?:\r\n|\r|\n)/g,this.subtitles=[],this.element=null,this.active=!1,this.lastMediaControlButtonClick=new Date,this.polyfill(),!(!1 in this._options)){var t=this._options.subtitle;if("object"===(void 0===t?"undefined":(0,a.default)(t))){if("src"in t&&(this.options.src=t.src),""==this.options.src)return;"auto"in t&&(this.options.auto=!0===t.auto,this.options.auto&&(this.active=!0)),"backgroundColor"in t&&(this.options.backgroundColor=t.backgroundColor),"color"in t&&(this.options.color=t.color),"fontSize"in t&&(this.options.fontSize=t.fontSize),"fontWeight"in t&&(this.options.fontWeight=t.fontWeight),"textShadow"in t&&(this.options.textShadow=t.textShadow)}else{if("string"!=typeof t)return;this.options.src=t,this.options.auto=!0}this.initializeElement(),this.fetchSubtitle(this.onSubtitlesFetched.bind(this))}},e.prototype.bindEvents=function(){this.listenTo(this.core,m.default.CORE_CONTAINERS_CREATED,this.containersCreated),this.listenTo(this.core.mediaControl,m.default.MEDIACONTROL_SHOW,this.onMediaControlShow),this.listenTo(this.core.mediaControl,m.default.MEDIACONTROL_HIDE,this.onMediaControlHide),this.listenTo(this.core.mediaControl,m.default.MEDIACONTROL_CONTAINERCHANGED,this.onContainerChanged)},e.prototype.containersCreated=function(){this.core.containers[0].$el.append(this.element),this.listenTo(this.core.containers[0].playback,m.default.PLAYBACK_TIMEUPDATE,this.run)},e.prototype.onContainerChanged=function(){0!==this.subtitles.length&&(this.element.parentNode.removeChild(this.element),this.subtitle=[],this.initialize(),this.containersCreated())},e.prototype.onSubtitlesFetched=function(t){this.parseSubtitle(t)},e.prototype.polyfill=function(){Array.prototype.find||(Array.prototype.find=function(t){if(null===this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!=typeof t)throw new TypeError("predicate must be a function");for(var e,n=Object(this),r=n.length>>>0,i=arguments[1],a=0;a<r;a++)if(e=n[a],t.call(i,e,a,n))return e})},e.prototype.fetchSubtitle=function(t){var e=new XMLHttpRequest;e.open("GET",this.options.src,!0),e.onreadystatechange=function(){4==e.readyState&&200==e.status&&t&&t(e.responseText)},e.send()},e.prototype.parseSubtitle=function(t){for(var e=t.match(this.BLOCK_REGEX),n=0;n<e.length;n++){for(var r=null,i=null,a="",o=e[n],s=o.split(/(?:\r\n|\r|\n)/),u=s[1].split(" --\x3e "),r=this.humanDurationToSeconds(u[0].trim()),i=this.humanDurationToSeconds(u[1].trim()),l=2;l<s.length;l++){var c=s[l].trim();a.length>0&&(a+="<br />"),a+=c}this.subtitles.push({startTime:r,endTime:i,text:a})}},e.prototype.humanDurationToSeconds=function(t){t=t.split(":");var e=t[0],n=t[1],r=t[2].replace(",","."),i=0;return i+=60*parseFloat(e)*60,i+=60*parseFloat(n),i+=parseFloat(r)},e.prototype.initializeElement=function(){var t=document.createElement("div");t.style.display="block",t.style.position="absolute",t.style.left="50%",t.style.bottom="50px",t.style.color=this.options.color,t.style.backgroundColor=this.options.backgroundColor,t.style.fontSize=this.options.fontSize,t.style.fontWeight=this.options.fontWeight,t.style.textShadow=this.options.textShadow,t.style.transform="translateX(-50%)",t.style.boxSizing="border-box",t.style.padding="7px",t.style.opacity="0",t.style.pointerEvents="none",t.style.maxWidth="90%",t.style.whiteSpace="normal",t.style.zIndex=1,this.element=t},e.prototype.addButtonToMediaControl=function(){var t=this.core.mediaControl.$el.children(".media-control-layer").children(".media-control-right-panel"),e=document.createElement("button");e.classList.add("media-control-button"),e.classList.add("media-control-icon"),e.classList.add("media-control-subtitle-toggler"),e.innerHTML=this.getMediaControlButtonSVG(),this.active&&(e.style.opacity="1"),t.append(e),this.core.$el.on("click",this.onMediaControlButtonClick.bind(this))},e.prototype.getMediaControlButtonSVG=function(){return'<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 1000 1000" enable-background="new 0 0 1000 1000" xml:space="preserve" style="pointer-events: none"><metadata> Svg Vector Icons : http://www.onlinewebfonts.com/icon </metadata><g><path d="M893.4,599V500H401.1V599H893.4z M893.4,794.5v-98.9H695.5v98.9H893.4z M598.9,794.5v-98.9H106.6v98.9H598.9z M106.6,500V599h197.8V500H106.6z M893.4,106.7c26.1,0,48.7,10,67.9,29.9s28.8,42.9,28.8,69v588.9c0,26.1-9.6,49.1-28.8,69c-19.2,19.9-41.8,29.9-67.9,29.9H106.6c-26.1,0-48.7-10-67.9-29.9c-19.2-19.9-28.8-42.9-28.8-69V205.5c0-26.1,9.6-49.1,28.8-69s41.8-29.9,67.9-29.9H893.4z"/></g></svg>'},e.prototype.onMediaControlButtonClick=function(t){t.target.classList.contains("media-control-subtitle-toggler")&&(new Date-this.lastMediaControlButtonClick<300||(this.lastMediaControlButtonClick=new Date,this.active?(this.active=!1,t.target.style.opacity=".5",this.hideElement()):(this.active=!0,t.target.style.opacity="1")))},e.prototype.hideElement=function(){this.element&&(this.element.style.opacity="0")},e.prototype.showElement=function(t){this.active&&this.element&&(this.element.innerHTML=t,this.element.style.opacity="1")},e.prototype.onMediaControlShow=function(){this.element&&(this.element.style.bottom="100px")},e.prototype.onMediaControlHide=function(){this.element&&(this.element.style.bottom="50px")},e.prototype.run=function(t){var e=this.subtitles.find(function(e){return t.current>=e.startTime&&t.current<=e.endTime});e?this.showElement(e.text):this.hideElement()},e}(f.default);e.default=g,t.exports=e["default"]},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(328),i=function(t){return t&&t.__esModule?t:{default:t}}(r);e.default=i.default,t.exports=e["default"]},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(3),s=r(o),u=n(1),l=r(u),c=n(2),d=r(c),h=n(15),f=r(h),p=n(10),m=r(p),g=n(6),v=r(g),y=n(4),_=r(y),b=n(329),E=r(b),w=n(330),A=r(w),S=[{value:"0.5",label:"0.5x"},{value:"0.75",label:"0.75x"},{value:"1.0",label:"1.0x"},{value:"1.5",label:"1.5x"},{value:"2.0",label:"2.0x"}],T=function(t){function e(){return(0,a.default)(this,e),(0,l.default)(this,t.apply(this,arguments))}return(0,d.default)(e,t),e.prototype.bindEvents=function(){this.listenTo(this.core.mediaControl,_.default.MEDIACONTROL_CONTAINERCHANGED,this.reload),this.listenTo(this.core.mediaControl,_.default.MEDIACONTROL_RENDERED,this.render),this.listenTo(this.core.mediaControl,_.default.MEDIACONTROL_HIDE,this.hideContextMenu),this.listenTo(this.core.mediaControl,e.MEDIACONTROL_PLAYBACKRATE,this.updatePlaybackRate)},e.prototype.unBindEvents=function(){this.stopListening(this.core.mediaControl,_.default.MEDIACONTROL_CONTAINERCHANGED),this.stopListening(this.core.mediaControl,_.default.MEDIACONTROL_RENDERED),this.stopListening(this.core.mediaControl,_.default.MEDIACONTROL_HIDE)},e.prototype.reload=function(){this.unBindEvents(),this.bindEvents()},e.prototype.shouldRender=function(){if(!this.core.getCurrentContainer())return!1;var t=this.core.getCurrentPlayback();return"video"==t.tagName||"audio"==t.tagName},e.prototype.render=function(){var t=this.core.options.playbackRateConfig||{};if(this.playbackRates||(this.playbackRates=t.options||S),this.selectedRate||(this.selectedRate=t.defaultValue||"1.0"),this.shouldRender()){var e=(0,m.default)(E.default),n=e({playbackRates:this.playbackRates,title:this.getTitle()});this.$el.html(n);var r=v.default.getStyleFor(A.default,{baseUrl:this.core.options.baseUrl});this.$el.append(r),this.core.mediaControl.$(".media-control-right-panel").append(this.el),this.updateText()}return this},e.prototype.onRateSelect=function(t){var e=t.target.dataset.playbackRateSelect;return this.setSelectedRate(e),this.toggleContextMenu(),t.stopPropagation(),!1},e.prototype.onShowMenu=function(t){this.toggleContextMenu()},e.prototype.toggleContextMenu=function(){this.$(".playback_rate ul").toggle()},e.prototype.hideContextMenu=function(){this.$(".playback_rate ul").hide()},e.prototype.updatePlaybackRate=function(t){this.setSelectedRate(t)},e.prototype.setSelectedRate=function(t){this.core.$el.find("video").get(0).playbackRate=t,this.selectedRate=t,this.updateText()},e.prototype.setActiveListItem=function(t){this.$("a").removeClass("active"),this.$('a[data-playback-rate-select="'+t+'"]').addClass("active")},e.prototype.buttonElement=function(){return this.$(".playback_rate button")},e.prototype.getTitle=function(){var t=this,e=this.selectedRate;return this.playbackRates.forEach(function(n){n.value==t.selectedRate&&(e=n.label)}),e},e.prototype.updateText=function(){this.buttonElement().text(this.getTitle()),this.setActiveListItem(this.selectedRate)},(0,s.default)(e,[{key:"name",get:function(){return"playback_rate"}},{key:"template",get:function(){return(0,m.default)(E.default)}},{key:"attributes",get:function(){return{class:this.name,"data-playback-rate-select":""}}},{key:"events",get:function(){return{"click [data-playback-rate-select]":"onRateSelect","click [data-playback-rate-button]":"onShowMenu"}}}]),e}(f.default);e.default=T,T.type="core",T.MEDIACONTROL_PLAYBACKRATE="playbackRate",t.exports=e["default"]},function(t,e){t.exports='<button data-playback-rate-button>\r\n  <%= title %>\r\n</button>\r\n<ul>\r\n  <% for (var i = 0; i < playbackRates.length; i++) { %>\r\n    <li><a href="#" data-playback-rate-select="<%= playbackRates[i].value %>"><%= playbackRates[i].label %></a></li>\r\n  <% }; %>\r\n</ul>\r\n'},function(t,e,n){e=t.exports=n(7)(!1),e.push([t.i,'.playback_rate[data-playback-rate-select]{float:right;margin-top:5px;position:relative}.playback_rate[data-playback-rate-select] button{font-family:,Roboto,Open Sans,Arial,sans-serif;-webkit-font-smoothing:antialiased;border:none;font-size:10px;cursor:pointer;width:50px;height:24px;background-color:transparent;border-radius:99em;color:#ececec;line-height:24px;text-align:center}.playback_rate[data-playback-rate-select] button:hover{background-color:#ff6e0b}.playback_rate[data-playback-rate-select] button.changing{-webkit-animation:pulse .5s infinite alternate}.playback_rate[data-playback-rate-select]>ul{display:none;list-style-type:none;position:absolute;left:-5px;width:60px;bottom:32px;color:#ccc;border-radius:4px;background-color:rgba(0,0,0,.8)}.playback_rate[data-playback-rate-select] li{position:relative;font-size:14px;line-height:33px;height:33px}.playback_rate[data-playback-rate-select] li[data-title]{background-color:#c3c2c2;padding:5px}.playback_rate[data-playback-rate-select] li a{color:#aaa;padding:2px 10px 2px 15px;display:block;text-decoration:none}.playback_rate[data-playback-rate-select] li a.active{background-color:#000;font-weight:700;color:#fff}.playback_rate[data-playback-rate-select] li a.active:before{content:"\\2713";position:absolute;top:2px;left:4px}.playback_rate[data-playback-rate-select] li a:hover{color:#fff;text-decoration:none}@-webkit-keyframes pulse{0%{color:#fff}50%{color:#ff0101}to{color:#b80000}}',""])},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),u=n(3),l=r(u),c=n(2),d=r(c),h=n(15),f=r(h),p=n(4),m=r(p),g=n(6),v=r(g),y=n(10),_=r(y),b=n(37),E=r(b),w=n(127),A=r(w),S=n(332),T=r(S),x=n(333),k=r(x),C=n(334),M=r(C),R=n(128),L=r(R),I=n(335),P=r(I),O=n(337),D=n(339),N=function(t){function e(n){(0,a.default)(this,e);var r=(0,s.default)(this,t.call(this,n));return r._shortcut=(0,L.default)(n,"options.powerStats.shortcut",["command+shift+s","ctrl+shift+s"]),r._iconPosition=(0,L.default)(n,"options.powerStats.iconPosition","top-right"),r.metrics={},r}return(0,d.default)(e,t),(0,l.default)(e,[{key:"name",get:function(){return"power-stats-ui"}},{key:"template",get:function(){return(0,_.default)(k.default)}},{key:"templatep2p",get:function(){return(0,_.default)(M.default)}},{key:"attributes",get:function(){return{"data-pwplayer-nerd-stats":"",class:"pwplayer-nerd-stats"}}},{key:"events",get:function(){return{"click [data-show-stats-button]":"showOrHide","click [data-close-button]":"hide"}}},{key:"statsBoxElem",get:function(){return".pwplayer-nerd-stats[data-pwplayer-nerd-stats] .stats-box"}},{key:"statsBoxWidthThreshold",get:function(){return 720}},{key:"playerWidth",get:function(){var t=this.container.playback.el;return void 0!==t.videoWidth&&0!==t.videoWidth?t.videoWidth:void 0!==this.core.playerInfo&&void 0!==this.core.playerInfo.computedSize?this.core.playerInfo.computedSize.width:0}},{key:"playerHeight",get:function(){var t=this.container.playback.el;return void 0!==t.videoHeight&&0!==t.videoHeight?t.videoHeight:void 0!==this.core.playerInfo&&void 0!==this.core.playerInfo.computedSize?this.core.playerInfo.computedSize.height:0}}]),e.prototype.bindEvents=function(){this.listenToOnce(this.core,m.default.CORE_READY,this.init),this.listenTo(this.core.mediaControl,m.default.MEDIACONTROL_CONTAINERCHANGED,this.reload)},e.prototype.unBindEvents=function(){this.stopListening(this.core,m.default.CORE_READY),this.stopListening(this.core.mediaControl,m.default.MEDIACONTROL_CONTAINERCHANGED)},e.prototype.init=function(){var t=this;this.container=this.core.getCurrentContainer();var e=this.container.getPlugin("powerplayer_stats");void 0===e?(console.error("power-stats not available."),this.disable()):(D.bind(this._shortcut,function(){return t.showOrHide()}),E.default.on(this.core.options.playerId+":"+m.default.PLAYER_RESIZE,this.onPlayerResize,this),this.listenTo(e,A.default.REPORT_EVENT,this.updateMetrics),this.updateMetrics(e._metrics),this.render())},e.prototype.reload=function(){this.unBindEvents(),this.bindEvents(),this.init()},e.prototype.showOrHide=function(t){this.showing?this.hide(t):this.show(t)},e.prototype.show=function(t){this.core.$el.find(this.statsBoxElem).show(),this.showing=!0,t&&t.stopPropagation()},e.prototype.hide=function(t){this.core.$el.find(this.statsBoxElem).hide(),this.showing=!1,t&&t.stopPropagation()},e.prototype.onPlayerResize=function(){this.setStatsBoxSize()},e.prototype.addGeneralMetrics=function(){this.metrics.general={displayResolution:this.playerWidth+"x"+this.playerHeight,volume:this.container.volume}},e.prototype.updateMetrics=function(t){this.metrics=(0,P.default)(t),this.addGeneralMetrics();var e=this.core.$el.find(this.statsBoxElem).scrollTop();this.metrics.p2pstatus&&this.metrics.p2pstatus.totalMb>0?this.$el.html(this.templatep2p({metrics:O.format(this.metrics),iconPosition:this._iconPosition})):this.$el.html(this.template({metrics:O.format(this.metrics),iconPosition:this._iconPosition})),this.setStatsBoxSize(),this.core.$el.find(this.statsBoxElem).scrollTop(e),this.showing||this.hide()},e.prototype.setStatsBoxSize=function(){this.playerWidth>=this.statsBoxWidthThreshold?(this.$el.find(this.statsBoxElem).addClass("wide"),this.$el.find(this.statsBoxElem).removeClass("narrow")):(this.$el.find(this.statsBoxElem).removeClass("wide"),this.$el.find(this.statsBoxElem).addClass("narrow"))},e.prototype.render=function(){var t=v.default.getStyleFor(T.default,{baseUrl:this.options.baseUrl});return this.core.$el.append(t),this.core.$el.append(this.$el),this.hide(),this},e}(f.default);e.default=N,t.exports=e["default"]},function(t,e,n){e=t.exports=n(7)(!1),e.push([t.i,".pwplayer-nerd-stats[data-pwplayer-nerd-stats] .stats-box{position:absolute;display:inline-block;top:2em;left:2em;padding:5px;margin:0;line-height:20px;font-size:11px;box-shadow:0 0 0 1px hsla(0,0%,100%,.15);background:rgba(0,0,0,.8);color:#fff;z-index:10000;overflow:auto;max-height:300px}.pwplayer-nerd-stats[data-pwplayer-nerd-stats] .stats-box.narrow,.pwplayer-nerd-stats[data-pwplayer-nerd-stats] .stats-box.wide{width:230px}.pwplayer-nerd-stats[data-pwplayer-nerd-stats] .stats-box ul{display:inline-block;float:left;padding:5px;width:210px}.pwplayer-nerd-stats[data-pwplayer-nerd-stats] .stats-box ul,li{list-style-type:none}.pwplayer-nerd-stats[data-pwplayer-nerd-stats] .stats-box li:nth-child(2n){background:hsla(0,0%,100%,.15)}.pwplayer-nerd-stats[data-pwplayer-nerd-stats] .stats-box li{padding:0 5px;text-align:left}.pwplayer-nerd-stats[data-pwplayer-nerd-stats] .stats-box li.title{text-align:center;font-weight:700}.pwplayer-nerd-stats[data-pwplayer-nerd-stats] .stats-box li div{padding-left:5px;margin:0;float:right}.pwplayer-nerd-stats[data-pwplayer-nerd-stats] .stats-box a.close-button{position:absolute;right:.3em;top:0;font-size:18px;cursor:pointer}.pwplayer-nerd-stats[data-pwplayer-nerd-stats] .icon-show-stats a{z-index:1000;position:absolute;float:right;color:#fff;display:none;cursor:pointer}.pwplayer-nerd-stats[data-pwplayer-nerd-stats] .icon-show-stats.top-right a{display:block;top:5px;right:10px}.pwplayer-nerd-stats[data-pwplayer-nerd-stats] .icon-show-stats.top-left a{display:block;top:5px;left:10px}.pwplayer-nerd-stats[data-pwplayer-nerd-stats] .icon-show-stats.bottom-right a{display:block;right:10px;bottom:5px}.pwplayer-nerd-stats[data-pwplayer-nerd-stats] .icon-show-stats.bottom-left a{display:block;bottom:5px;left:10px}",""])},function(t,e){t.exports='<% general = metrics.general %>\r\n<% counters = metrics.counters %>\r\n<% timers = metrics.timers %>\r\n<% extra = metrics.extra %>\r\n<% p2pstatus = metrics.p2pstatus %>\r\n\r\n\x3c!--<div class="icon-show-stats <%= iconPosition %>" data-show-stats-button>\r\n    <a>&#9432;</a>\r\n</div>--\x3e\r\n\r\n<div class="stats-box">\r\n    <a class="close-button" data-close-button>&times;</a>\r\n\r\n    <ul>\r\n        <li class="title"><span></span></li>\r\n        <li>\r\n            :\r\n            <div><span><%= general.displayResolution %></span></div>\r\n        </li>\r\n        <li>\r\n            :\r\n            <div><span><%= general.volume %></span></div>\r\n        </li>\r\n        <li>\r\n            :\r\n            <div><span><%= counters.fps %> /</span></div>\r\n        </li>\r\n        <li>\r\n            :\r\n            <div><span><%= extra.duration %> </span></div>\r\n        </li>\r\n        <li>\r\n            :\r\n            <div><span><%= extra.playbackName %></span></div>\r\n        </li>\r\n     </ul>\r\n</div>\r\n'},function(t,e){t.exports='<% general = metrics.general %>\r\n<% counters = metrics.counters %>\r\n<% timers = metrics.timers %>\r\n<% extra = metrics.extra %>\r\n<% p2pstatus = metrics.p2pstatus %>\r\n\r\n\x3c!--<div class="icon-show-stats <%= iconPosition %>" data-show-stats-button>\r\n    <a>&#9432;</a>\r\n</div>--\x3e\r\n\r\n<div class="stats-box">\r\n    <a class="close-button" data-close-button>&times;</a>\r\n\r\n    <ul>\r\n        <li class="title"><span></span></li>\r\n        <li>\r\n            :\r\n            <div><span><%= general.displayResolution %></span></div>\r\n        </li>\r\n        <li>\r\n            :\r\n            <div><span><%= counters.fps %> /</span></div>\r\n        </li>\r\n        <li>\r\n            :\r\n            <div><span><%= extra.playbackName %></span></div>\r\n        </li>\r\n        <li>\r\n            :\r\n            <div><span><%= p2pstatus.totalMb %> MB</span></div>\r\n        </li>\r\n        <li>\r\n            :\r\n            <div><span><%= p2pstatus.totalbps %> Mbps</span></div>\r\n        </li>\r\n        <li>\r\n            P2P:\r\n            <div><span><%= p2pstatus.p2pMb %> MB</span></div>\r\n        </li>\r\n        <li>\r\n            P2P:\r\n            <div><span><%= p2pstatus.p2pbps %> Mbps</span></div>\r\n        </li>\r\n        <li>\r\n            P2P:\r\n            <div><span><%= p2pstatus.p2pcount %></span></div>\r\n        </li>\r\n        <li>\r\n            P2P:\r\n            <div><span><%= p2pstatus.uploadMb %> MB</span></div>\r\n        </li>\r\n    </ul>\r\n</div>\r\n'},function(t,e,n){(function(t,n){function r(t,e){return t.set(e[0],e[1]),t}function i(t,e){return t.add(e),t}function a(t,e){for(var n=-1,r=t?t.length:0;++n<r&&!1!==e(t[n],n,t););return t}function o(t,e){for(var n=-1,r=e.length,i=t.length;++n<r;)t[i+n]=e[n];return t}function s(t,e,n,r){var i=-1,a=t?t.length:0;for(r&&a&&(n=t[++i]);++i<a;)n=e(n,t[i],i,t);return n}function u(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r}function l(t,e){return null==t?void 0:t[e]}function c(t){var e=!1;if(null!=t&&"function"!=typeof t.toString)try{e=!!(t+"")}catch(n){}return e}function d(t){var e=-1,n=Array(t.size);return t.forEach(function(t,r){n[++e]=[r,t]}),n}function h(t,e){return function(n){return t(e(n))}}function f(t){var e=-1,n=Array(t.size);return t.forEach(function(t){n[++e]=t}),n}function p(t){var e=-1,n=t?t.length:0;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function m(){this.__data__=De?De(null):{}}function g(t){return this.has(t)&&delete this.__data__[t]}function v(t){var e=this.__data__;if(De){var n=e[t];return n===Mt?void 0:n}return ve.call(e,t)?e[t]:void 0}function y(t){var e=this.__data__;return De?void 0!==e[t]:ve.call(e,t)}function _(t,e){return this.__data__[t]=De&&void 0===e?Mt:e,this}function b(t){var e=-1,n=t?t.length:0;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function E(){this.__data__=[]}function w(t){var e=this.__data__,n=j(e,t);return!(n<0)&&(n==e.length-1?e.pop():xe.call(e,n,1),!0)}function A(t){var e=this.__data__,n=j(e,t);return n<0?void 0:e[n][1]}function S(t){return j(this.__data__,t)>-1}function T(t,e){var n=this.__data__,r=j(n,t);return r<0?n.push([t,e]):n[r][1]=e,this}function x(t){var e=-1,n=t?t.length:0;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function k(){this.__data__={hash:new p,map:new(Le||b),string:new p}}function C(t){return ot(this,t)["delete"](t)}function M(t){return ot(this,t).get(t)}function R(t){return ot(this,t).has(t)}function L(t,e){return ot(this,t).set(t,e),this}function I(t){this.__data__=new b(t)}function P(){this.__data__=new b}function O(t){return this.__data__["delete"](t)}function D(t){return this.__data__.get(t)}function N(t){return this.__data__.has(t)}function U(t,e){var n=this.__data__;if(n instanceof b){var r=n.__data__;if(!Le||r.length<Ct-1)return r.push([t,e]),this;n=this.__data__=new x(r)}return n.set(t,e),this}function F(t,e){var n=Ke(t)||yt(t)?u(t.length,String):[],r=n.length,i=!!r;for(var a in t)!e&&!ve.call(t,a)||i&&("length"==a||dt(a,r))||n.push(a);return n}function B(t,e,n){var r=t[e];ve.call(t,e)&&vt(r,n)&&(void 0!==n||e in t)||(t[e]=n)}function j(t,e){for(var n=t.length;n--;)if(vt(t[n][0],e))return n;return-1}function V(t,e){return t&&rt(e,Tt(e),t)}function G(t,e,n,r,i,o,s){var u;if(r&&(u=o?r(t,i,o,s):r(t)),void 0!==u)return u;if(!At(t))return t;var l=Ke(t);if(l){if(u=ut(t),!e)return nt(t,u)}else{var d=He(t),h=d==Ot||d==Dt;if(Ye(t))return q(t,e);if(d==Ft||d==Lt||h&&!o){if(c(t))return o?t:{};if(u=lt(h?{}:t),!e)return it(t,V(u,t))}else{if(!ie[d])return o?t:{};u=ct(t,d,G,e)}}s||(s=new I);var f=s.get(t);if(f)return f;if(s.set(t,u),!l)var p=n?at(t):Tt(t);return a(p||t,function(i,a){p&&(a=i,i=t[a]),B(u,a,G(i,e,n,r,a,t,s))}),u}function z(t){return At(t)?Se(t):{}}function H(t,e,n){var r=e(t);return Ke(t)?r:o(r,n(t))}function K(t){return ye.call(t)}function Y(t){return!(!At(t)||ft(t))&&(Et(t)||c(t)?_e:ne).test(mt(t))}function W(t){if(!pt(t))return Me(t);var e=[];for(var n in Object(t))ve.call(t,n)&&"constructor"!=n&&e.push(n);return e}function q(t,e){if(e)return t.slice();var n=new t.constructor(t.length);return t.copy(n),n}function X(t){var e=new t.constructor(t.byteLength);return new we(e).set(new we(t)),e}function $(t,e){var n=e?X(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.byteLength)}function Z(t,e,n){return s(e?n(d(t),!0):d(t),r,new t.constructor)}function Q(t){var e=new t.constructor(t.source,ee.exec(t));return e.lastIndex=t.lastIndex,e}function J(t,e,n){return s(e?n(f(t),!0):f(t),i,new t.constructor)}function tt(t){return Ge?Object(Ge.call(t)):{}}function et(t,e){var n=e?X(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.length)}function nt(t,e){var n=-1,r=t.length;for(e||(e=Array(r));++n<r;)e[n]=t[n];return e}function rt(t,e,n,r){n||(n={});for(var i=-1,a=e.length;++i<a;){var o=e[i],s=r?r(n[o],t[o],o,n,t):void 0;B(n,o,void 0===s?t[o]:s)}return n}function it(t,e){return rt(t,ze(t),e)}function at(t){return H(t,Tt,ze)}function ot(t,e){var n=t.__data__;return ht(e)?n["string"==typeof e?"string":"hash"]:n.map}function st(t,e){var n=l(t,e);return Y(n)?n:void 0}function ut(t){var e=t.length,n=t.constructor(e);return e&&"string"==typeof t[0]&&ve.call(t,"index")&&(n.index=t.index,n.input=t.input),n}function lt(t){return"function"!=typeof t.constructor||pt(t)?{}:z(Ae(t))}function ct(t,e,n,r){var i=t.constructor;switch(e){case zt:return X(t);case It:case Pt:return new i(+t);case Ht:return $(t,r);case Kt:case Yt:case Wt:case qt:case Xt:case $t:case Zt:case Qt:case Jt:return et(t,r);case Nt:return Z(t,r,n);case Ut:case Vt:return new i(t);case Bt:return Q(t);case jt:return J(t,r,n);case Gt:return tt(t)}}function dt(t,e){return!!(e=null==e?Rt:e)&&("number"==typeof t||re.test(t))&&t>-1&&t%1==0&&t<e}function ht(t){var e=typeof t;return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t}function ft(t){return!!me&&me in t}function pt(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||fe)}function mt(t){if(null!=t){try{return ge.call(t)}catch(e){}try{return t+""}catch(e){}}return""}function gt(t){return G(t,!0,!0)}function vt(t,e){return t===e||t!==t&&e!==e}function yt(t){return bt(t)&&ve.call(t,"callee")&&(!Te.call(t,"callee")||ye.call(t)==Lt)}function _t(t){return null!=t&&wt(t.length)&&!Et(t)}function bt(t){return St(t)&&_t(t)}function Et(t){var e=At(t)?ye.call(t):"";return e==Ot||e==Dt}function wt(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=Rt}function At(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function St(t){return!!t&&"object"==typeof t}function Tt(t){return _t(t)?F(t):W(t)}function xt(){return[]}function kt(){return!1}var Ct=200,Mt="__lodash_hash_undefined__",Rt=9007199254740991,Lt="[object Arguments]",It="[object Boolean]",Pt="[object Date]",Ot="[object Function]",Dt="[object GeneratorFunction]",Nt="[object Map]",Ut="[object Number]",Ft="[object Object]",Bt="[object RegExp]",jt="[object Set]",Vt="[object String]",Gt="[object Symbol]",zt="[object ArrayBuffer]",Ht="[object DataView]",Kt="[object Float32Array]",Yt="[object Float64Array]",Wt="[object Int8Array]",qt="[object Int16Array]",Xt="[object Int32Array]",$t="[object Uint8Array]",Zt="[object Uint8ClampedArray]",Qt="[object Uint16Array]",Jt="[object Uint32Array]",te=/[\\^$.*+?()[\]{}|]/g,ee=/\w*$/,ne=/^\[object .+?Constructor\]$/,re=/^(?:0|[1-9]\d*)$/,ie={};ie[Lt]=ie["[object Array]"]=ie[zt]=ie[Ht]=ie[It]=ie[Pt]=ie[Kt]=ie[Yt]=ie[Wt]=ie[qt]=ie[Xt]=ie[Nt]=ie[Ut]=ie[Ft]=ie[Bt]=ie[jt]=ie[Vt]=ie[Gt]=ie[$t]=ie[Zt]=ie[Qt]=ie[Jt]=!0,ie["[object Error]"]=ie[Ot]=ie["[object WeakMap]"]=!1;var ae="object"==typeof t&&t&&t.Object===Object&&t,oe="object"==typeof self&&self&&self.Object===Object&&self,se=ae||oe||Function("return this")(),ue="object"==typeof e&&e&&!e.nodeType&&e,le=ue&&"object"==typeof n&&n&&!n.nodeType&&n,ce=le&&le.exports===ue,de=Array.prototype,he=Function.prototype,fe=Object.prototype,pe=se["__core-js_shared__"],me=function(){var t=/[^.]+$/.exec(pe&&pe.keys&&pe.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}(),ge=he.toString,ve=fe.hasOwnProperty,ye=fe.toString,_e=RegExp("^"+ge.call(ve).replace(te,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),be=ce?se.Buffer:void 0,Ee=se.Symbol,we=se.Uint8Array,Ae=h(Object.getPrototypeOf,Object),Se=Object.create,Te=fe.propertyIsEnumerable,xe=de.splice,ke=Object.getOwnPropertySymbols,Ce=be?be.isBuffer:void 0,Me=h(Object.keys,Object),Re=st(se,"DataView"),Le=st(se,"Map"),Ie=st(se,"Promise"),Pe=st(se,"Set"),Oe=st(se,"WeakMap"),De=st(Object,"create"),Ne=mt(Re),Ue=mt(Le),Fe=mt(Ie),Be=mt(Pe),je=mt(Oe),Ve=Ee?Ee.prototype:void 0,Ge=Ve?Ve.valueOf:void 0;p.prototype.clear=m,p.prototype["delete"]=g,p.prototype.get=v,p.prototype.has=y,p.prototype.set=_,b.prototype.clear=E,b.prototype["delete"]=w,b.prototype.get=A,b.prototype.has=S,b.prototype.set=T,x.prototype.clear=k,x.prototype["delete"]=C,x.prototype.get=M,x.prototype.has=R,x.prototype.set=L,I.prototype.clear=P,I.prototype["delete"]=O,I.prototype.get=D,I.prototype.has=N,I.prototype.set=U;var ze=ke?h(ke,Object):xt,He=K;(Re&&He(new Re(new ArrayBuffer(1)))!=Ht||Le&&He(new Le)!=Nt||Ie&&"[object Promise]"!=He(Ie.resolve())||Pe&&He(new Pe)!=jt||Oe&&"[object WeakMap]"!=He(new Oe))&&(He=function(t){var e=ye.call(t),n=e==Ft?t.constructor:void 0,r=n?mt(n):void 0;if(r)switch(r){case Ne:return Ht;case Ue:return Nt;case Fe:return"[object Promise]";case Be:return jt;case je:return"[object WeakMap]"}return e});var Ke=Array.isArray,Ye=Ce||kt;n.exports=gt}).call(e,n(46),n(336)(t))},function(t,e){t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),t.webpackPolyfill=1),t}},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=n(28),a=r(i),o=n(0),s=r(o),u=n(338),l=new u.Scale({ms:1,sec:1e3,min:6e4,hours:36e5}),c=new u.Scale({"%":1}),d={general:{volume:{scale:c}},timers:{startup:{scale:l},watch:{scale:l},pause:{scale:l},buffering:{scale:l},session:{scale:l},latency:{scale:l}},extra:{buffersize:{scale:l},duration:{scale:l},currentTime:{scale:l},bitrateWeightedMean:{unit:"bps"},bitrateMostUsed:{unit:"bps"},bandwidth:{unit:"bps"},watchedPercentage:{scale:c},bufferingPercentage:{scale:c}}},h=function(){function t(){(0,s.default)(this,t)}return t.format=function(t){var e={};return(0,a.default)(t).forEach(function(n){e[n]={};var r=d[n];(0,a.default)(t[n]).forEach(function(i){var a=t[n][i];if(r&&r[i]&&"number"==typeof a&&!isNaN(a)){var o=r[i].scale||"SI",s=r[i].unit||"";e[n][i]=u(a,{scale:o,unit:s,decimals:2})}else e[n][i]=a})}),e},t}();e.default=h,t.exports=e["default"]},function(t,e,n){var r,i,a;!function(n,o){i=[],r=o,void 0!==(a="function"==typeof r?r.apply(e,i):r)&&(t.exports=a)}(0,function(){"use strict";function t(t,e){var n;for(n in e)m(e,n)&&(t[n]=e[n])}function e(e,n){var r,i;for(r=0,i=arguments.length;r<i;++r)(n=arguments[r])&&t(e,n);return e}function n(t,e){return e.length-t.length}function r(t,e){return t.factor-e.factor}function i(t){return t.replace(/([.*+?=^!:${}()|[\]\/\\])/g,"\\$1")}function a(t,e){var n,r;for(n=0,r=t.length;n<r;++n)e(t[n],n)}function o(t,e){var n;for(n in t)m(t,n)&&e(t[n],n)}function s(t){return null!=t}function u(t,e){for(;y(e);)e=t[e];return e}function l(t,e){if(!e)return Math.round(t);var n=Math.pow(10,e);return Math.round(t*n)/n}function c(t){this._prefixes=t;var e=[],a=[];o(t,function(t,n){e.push(i(n)),a.push({factor:t,prefix:n})});var s=this._lcPrefixes={};o(t,function(e,n){var r=n.toLowerCase();m(t,r)||(s[r]=n)}),a.sort(r),this._list=a,e.sort(n),this._regexp=new RegExp("^\\s*(\\d+(?:\\.\\d+)?)\\s*("+e.join("|")+")\\s*(.*)\\s*?$","i")}function d(t,n){n=e({},b,n);var r=p(t,n),i=r.prefix+n.unit;return l(r.value,n.decimals)+(i?n.separator+i:"")}function h(t,e){var n=f(t,e);return n.value*n.factor}function f(t,n){if(!y(t))throw new TypeError("str must be a string");n=e({},b,n);var r=u(_,n.scale);if(!r)throw new Error("missing scale");var i=r.parse(t,n.strict);if(!i)throw new Error("cannot parse str");return i}function p(t,n){if(0===t)return{value:0,prefix:""};if(!v(t))throw new TypeError("value must be a number");n=e({},b,n);var r=u(_,n.scale);if(!r)throw new Error("missing scale");var i,a=n.prefix;if(s(a)){if(!m(r._prefixes,a))throw new Error("invalid prefix");i=r._prefixes[a]}else{var o=r.findPrefix(t);a=o.prefix,i=o.factor}return t/=i,{prefix:a,value:t}}var m=function(t){return function(e,n){return e&&t.call(e,n)}}(Object.prototype.hasOwnProperty),g=function(t){return function(e){return t.call(e)}}(Object.prototype.toString),v=function(t){return function(e){return e===e&&g(e)===t}}(g(0)),y=function(t){return function(e){return g(e)===t}}(g(""));c.create=function(t,e,n){var r={};return a(t,function(t,i){r[t]=Math.pow(e,i+(n||0))}),new c(r)},c.prototype.findPrefix=function(t){for(var e,n,r=this._list,i=0,a=r.length-1;i!==a;)e=i+a+1>>1,n=r[e].factor,n>t?a=e-1:i=e;return r[i]},c.prototype.parse=function(t,e){var n=t.match(this._regexp);if(!n)return null;var r,i=n[2];if(m(this._prefixes,i))r=this._prefixes[i];else{if(e||(i=i.toLowerCase(),!m(this._lcPrefixes,i)))return null;i=this._lcPrefixes[i],r=this._prefixes[i]}return{factor:r,prefix:i,unit:n[3],value:+n[1]}};var _={binary:c.create(",ki,Mi,Gi,Ti,Pi,Ei,Zi,Yi".split(","),1024),SI:c.create("y,z,a,f,p,n,,m,,k,M,G,T,P,E,Z,Y".split(","),1e3,-8)},b={scale:"SI",strict:!1,unit:"",decimals:2,separator:" "};return d.parse=h,h.raw=f,d.raw=p,d.Scale=c,d})},function(t,e,n){var r;!function(i,a,o){function s(t,e,n){if(t.addEventListener)return void t.addEventListener(e,n,!1);t.attachEvent("on"+e,n)}function u(t){if("keypress"==t.type){var e=String.fromCharCode(t.which);return t.shiftKey||(e=e.toLowerCase()),e}return E[t.which]?E[t.which]:w[t.which]?w[t.which]:String.fromCharCode(t.which).toLowerCase()}function l(t,e){return t.sort().join(",")===e.sort().join(",")}function c(t){var e=[];return t.shiftKey&&e.push("shift"),t.altKey&&e.push("alt"),t.ctrlKey&&e.push("ctrl"),t.metaKey&&e.push("meta"),e}function d(t){if(t.preventDefault)return void t.preventDefault();t.returnValue=!1}function h(t){if(t.stopPropagation)return void t.stopPropagation();t.cancelBubble=!0}function f(t){return"shift"==t||"ctrl"==t||"alt"==t||"meta"==t}function p(){if(!b){b={};for(var t in E)t>95&&t<112||E.hasOwnProperty(t)&&(b[E[t]]=t)}return b}function m(t,e,n){return n||(n=p()[t]?"keydown":"keypress"),"keypress"==n&&e.length&&(n="keydown"),n}function g(t){return"+"===t?["+"]:(t=t.replace(/\+{2}/g,"+plus"),t.split("+"))}function v(t,e){var n,r,i,a=[];for(n=g(t),i=0;i<n.length;++i)r=n[i],S[r]&&(r=S[r]),e&&"keypress"!=e&&A[r]&&(r=A[r],a.push("shift")),f(r)&&a.push(r);return e=m(r,a,e),{key:r,modifiers:a,action:e}}function y(t,e){return null!==t&&t!==a&&(t===e||y(t.parentNode,e))}function _(t){function e(t){t=t||{};var e,n=!1;for(e in b)t[e]?n=!0:b[e]=0;n||(A=!1)}function n(t,e,n,r,i,a){var o,s,u=[],c=n.type;if(!g._callbacks[t])return[];for("keyup"==c&&f(t)&&(e=[t]),o=0;o<g._callbacks[t].length;++o)if(s=g._callbacks[t][o],(r||!s.seq||b[s.seq]==s.level)&&c==s.action&&("keypress"==c&&!n.metaKey&&!n.ctrlKey||l(e,s.modifiers))){var d=!r&&s.combo==i,h=r&&s.seq==r&&s.level==a;(d||h)&&g._callbacks[t].splice(o,1),u.push(s)}return u}function r(t,e,n,r){g.stopCallback(e,e.target||e.srcElement,n,r)||!1===t(e,n)&&(d(e),h(e))}function i(t){"number"!=typeof t.which&&(t.which=t.keyCode);var e=u(t);if(e)return"keyup"==t.type&&E===e?void(E=!1):void g.handleKey(e,c(t),t)}function o(){clearTimeout(y),y=setTimeout(e,1e3)}function p(t,n,i,a){function s(n){r(i,n,t),"keyup"!==a&&(E=u(n)),setTimeout(e,10)}b[t]=0;for(var l=0;l<n.length;++l){var c=l+1===n.length,d=c?s:function(e){return function(){A=e,++b[t],o()}}(a||v(n[l+1]).action);m(n[l],d,a,t,l)}}function m(t,e,r,i,a){g._directMap[t+":"+r]=e,t=t.replace(/\s+/g," ");var o,s=t.split(" ");if(s.length>1)return void p(t,s,e,r);o=v(t,r),g._callbacks[o.key]=g._callbacks[o.key]||[],n(o.key,o.modifiers,{type:o.action},i,t,a),g._callbacks[o.key][i?"unshift":"push"]({callback:e,modifiers:o.modifiers,action:o.action,seq:i,level:a,combo:t})}var g=this;if(t=t||a,!(g instanceof _))return new _(t);g.target=t,g._callbacks={},g._directMap={};var y,b={},E=!1,w=!1,A=!1;g._handleKey=function(t,i,a){var o,s=n(t,i,a),u={},l=0,c=!1;for(o=0;o<s.length;++o)s[o].seq&&(l=Math.max(l,s[o].level));for(o=0;o<s.length;++o)if(s[o].seq){if(s[o].level!=l)continue;c=!0,u[s[o].seq]=1,r(s[o].callback,a,s[o].combo,s[o].seq)}else c||r(s[o].callback,a,s[o].combo);var d="keypress"==a.type&&w;a.type!=A||f(t)||d||e(u),w=c&&"keydown"==a.type},g._bindMultiple=function(t,e,n){for(var r=0;r<t.length;++r)m(t[r],e,n)},s(t,"keypress",i),s(t,"keydown",i),s(t,"keyup",i)}if(i){for(var b,E={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"},w={106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},A={"~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\"},S={option:"alt",command:"meta",return:"enter",escape:"esc",plus:"+",mod:/Mac|iPod|iPhone|iPad/.test(navigator.platform)?"meta":"ctrl"},T=1;T<20;++T)E[111+T]="f"+T;for(T=0;T<=9;++T)E[T+96]=T.toString();_.prototype.bind=function(t,e,n){var r=this;return t=t instanceof Array?t:[t],r._bindMultiple.call(r,t,e,n),r},_.prototype.unbind=function(t,e){var n=this;return n.bind.call(n,t,function(){},e)},_.prototype.trigger=function(t,e){var n=this;return n._directMap[t+":"+e]&&n._directMap[t+":"+e]({},t),n},_.prototype.reset=function(){var t=this;return t._callbacks={},t._directMap={},t},_.prototype.stopCallback=function(t,e){var n=this;return!((" "+e.className+" ").indexOf(" mousetrap ")>-1)&&(!y(e,n.target)&&("INPUT"==e.tagName||"SELECT"==e.tagName||"TEXTAREA"==e.tagName||e.isContentEditable))},_.prototype.handleKey=function(){var t=this;return t._handleKey.apply(t,arguments)},_.addKeycodes=function(t){for(var e in t)t.hasOwnProperty(e)&&(E[e]=t[e]);b=null},_.init=function(){var t=_(a);for(var e in t)"_"!==e.charAt(0)&&(_[e]=function(e){return function(){return t[e].apply(t,arguments)}}(e))},_.init(),i.Mousetrap=_,void 0!==t&&t.exports&&(t.exports=_),void 0!==(r=function(){return _}.call(e,n,e,t))&&(t.exports=r)}}("undefined"!=typeof window?window:null,"undefined"!=typeof window?document:null)},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(341),i=function(t){return t&&t.__esModule?t:{default:t}}(r);e.default=i.default,t.exports=e["default"]},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),u=n(3),l=r(u),c=n(2),d=r(c),h=n(15),f=r(h),p=n(4),m=r(p),g=n(6),v=r(g),y=n(10),_=r(y),b=n(342),E=r(b),w=n(343),A=r(w),S=n(137),T=(r(S),function(t){function e(n){(0,a.default)(this,e);var r=(0,s.default)(this,t.call(this,n));return r.bindEvents(),r}return(0,d.default)(e,t),(0,l.default)(e,[{key:"name",get:function(){return"context_menu"}},{key:"attributes",get:function(){return{class:"context-menu"}}},{key:"mediaControl",get:function(){return this.core.mediaControl}},{key:"template",get:function(){return(0,_.default)(A.default)}},{key:"exposeVersion",get:function(){return{label:"PowerPlayer v"+pwplayer.version,name:"version"}}},{key:"copyURL",get:function(){return{label:"",name:"copyURL"}}},{key:"copyURLCurrentTime",get:function(){return{label:"",name:"copyURLCurrentTime"}}},{key:"loop",get:function(){return{label:": ",name:"loop",class:this.core.options.loop?"":""}}},{key:"stats",get:function(){return{label:"",name:"stats"}}},{key:"loopEnable",get:function(){return this.core.getCurrentPlayback().el.loop}},{key:"events",get:function(){return{"click [data-copyURL]":"onCopyURL","click [data-copyURLCurrentTime]":"onCopyURLCurrentTime","click [data-loop]":"onToggleLoop","click [data-stats]":"onPlaybackStats"}}}]),e.prototype.bindEvents=function(){this.mediaControl&&(this.listenTo(this.mediaControl,m.default.MEDIACONTROL_CONTAINERCHANGED,this.containerChanged),this.container&&(this.listenTo(this.container,m.default.CONTAINER_CONTEXTMENU,this.toggleContextMenu),this.listenTo(this.container,m.default.CONTAINER_CLICK,this.hide))),window&&window.addEventListener("click",this.hide.bind(this))},e.prototype.destroy=function(){window&&window.addEventListener("click",this.hide.bind(this)),this.stopListening(),t.prototype.destroy.call(this)},e.prototype.containerChanged=function(){this.container=this.core.getCurrentContainer(),this.stopListening(),this.bindEvents()},e.prototype.toggleContextMenu=function(t){t.preventDefault(),this.show(t.offsetY,t.offsetX)},e.prototype.show=function(t,e){this.hide(),this.$el.css({top:t,left:e}),this.$el.show()},e.prototype.hide=function(){this.$el.hide()},e.prototype.copyToClipboard=function(t,e){if(e){var n=$('<textarea class="copytextarea"/>');n.text(t),e.append(n);document.querySelector(".copytextarea").select();try{document.execCommand("copy")}catch(r){throw Error(r)}n.remove()}},e.prototype.onCopyURL=function(){this.copyToClipboard(window.location.href,this.$el)},e.prototype.onCopyURLCurrentTime=function(){var t=window.location.href,e=Math.floor(this.container.getCurrentTime());if(""==window.location.search)t+="?s="+e;else if(-1==window.location.search.split(/[\?=&]/g).indexOf("s"))t+="&s="+e;else{var n=window.location.search.split(/s=\d+&*/g)[1];""==n?t=""+window.location.href.replace(window.location.search,"")+n+"?s="+e:(n=window.location.search.split(/s=\d+&*/g).join(""),t=""+window.location.href.replace(window.location.search,"")+n+"&s="+e)}this.copyToClipboard(t,this.$el)},e.prototype.onToggleLoop=function(){this.core.options.loop=!this.loopEnable,this.core.getCurrentPlayback().el.loop=!this.loopEnable,this.$el.find("[data-loop]").toggleClass("on",this.loopEnable),this.$el.find("[data-loop]").toggleClass("off",!this.loopEnable)},e.prototype.onPlaybackStats=function(){var t=this.core.getPlugin("power-stats-ui");void 0!==t&&t.show()},e.prototype.render=function(){return this.menuOptions=[this.exposeVersion,this.stats,this.copyURL,this.loop],this.$el.html(this.template({options:this.menuOptions})),this.$el.append(v.default.getStyleFor(E.default)),this.core.$el.append(this.$el),this.hide(),this.disable(),this},e}(f.default));e.default=T,t.exports=e["default"]},function(t,e,n){e=t.exports=n(7)(!1),e.push([t.i,'.context-menu{z-index:10000;position:absolute;top:0;left:0;text-align:center}.context-menu .context-menu-list{font-family:Proxima Nova;font-size:12px;line-height:12px;list-style-type:none;text-align:left;padding:5px;margin-left:auto;margin-right:auto;background-color:rgba(0,0,0,.75);border:1px solid #666;border-radius:4px}.context-menu .context-menu-list .context-menu-list-item{color:#fff;padding:5px;cursor:pointer}.context-menu .context-menu-list .context-menu-list-item:hover{color:#2b669a}.context-menu .context-menu-list .context-menu-list-item[data-version]{pointer-events:none}.context-menu .context-menu-list .context-menu-list-item[data-loop].on:after{content:"ON"}.context-menu .context-menu-list .context-menu-list-item[data-loop].off:after{content:"OFF"}',""])},function(t,e){t.exports='<ul class="context-menu-list">\r\n    <% if(options) { %>\r\n    <% for (var i = 0; i < options.length; i++) { %>\r\n    <li class="context-menu-list-item <%=options[i].class%>" data-<%=options[i].name%>><%=options[i].label%></li>\r\n    <% } %>\r\n    <% } %>\r\n</ul>\r\n'},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(345),i=function(t){return t&&t.__esModule?t:{default:t}}(r);e.default=i.default,t.exports=e["default"]},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),u=n(3),l=r(u),c=n(2),d=r(c),h=n(15),f=r(h),p=n(4),m=r(p),g=function(t){function e(n){(0,a.default)(this,e);var r=(0,s.default)(this,t.call(this,n));return r.initialize(),r}return(0,d.default)(e,t),(0,l.default)(e,[{key:"name",get:function(){return"tips"}}]),e.prototype.initialize=function(){this.wrapper=this._initWrapper(),this.bindEvents()},e.prototype._initWrapper=function(){var t=document.createElement("div");return t.style.display="none",t.style.position="absolute",t.style.top="10px",t.style.right="41px",t.style.padding="5px",t.style.backgroundColor="#000",t.style.border="solid thin #000",t.style.fontSize="12px",t.style.color="#FFF",t.style.zIndex=9997,t},e.prototype.bindEvents=function(){this.listenToOnce(this.core,m.default.CORE_READY,function(){var t=this.core.getCurrentContainer();t.$el.append(this.wrapper),t.listenToOnce(t.playback,m.default.PLAYBACK_SEEK_LASTPOSTION,this._onPlaybackSeekLastpostion.bind(this)),t.listenTo(t.playback,m.default.PLAYBACK_BUFFERFULL,this._onPlaybackBufferfull.bind(this))}.bind(this))},e.prototype.formatSeconds=function(t){var e=parseInt(t),n=0,r=0;e>60&&(n=parseInt(e/60),e=parseInt(e%60),n>60&&(r=parseInt(n/60),n=parseInt(n%60)));var i=parseInt(e)+"";return n>0&&(i=parseInt(n)+""+i),r>0&&(i=parseInt(r)+""+i),i},e.prototype._onPlaybackSeekLastpostion=function(t){if(void 0!==this.wrapper){this.wrapper.style.display="block";var e=this.formatSeconds(t);this.wrapper.innerHTML=""+e+", "}},e.prototype._onPlaybackBufferfull=function(t){void 0!==this.wrapper&&(this.wrapper.style.display="none")},e}(f.default);e.default=g,t.exports=e["default"]}])});